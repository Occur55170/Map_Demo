import{V as q,O as V,m as A,M as W,b as I,S as G,c as Q,a as U,_ as X,d as H,e as K,f as $,g as ee,h as te,i as ae,j as re,k as oe,F as ne,P as se,l as le,I as ie}from"./logo-2b1bcc57.js";import{_ as de,r as ce,c as P,o as ue,$ as me,n as Z,a as h,b as y,d as M,e as Y,f as C,m as ye,g as pe,h as fe,i as ge,j as L}from"./index-1deeabde.js";const be={props:{},setup(B,{emit:d}){const S=A,r=I,e=ce({defaultCenter:[121.326776,24.655499],defaultCenterZoom:14,targetNum:1,conditionWrap:!1,layerSelect:!1,currentLayers:[],layers:[],mapLayers:P(()=>e.layers.map((o,t)=>({label:o.group_title,value:o.value,layers:o.group_layers,groupClass:o.group_class}))),baseMapsOptions:P(()=>I.sourceData()),selectLock:!1,mapCount:1,map1:null,map2:null,map1LayerStatus:[],map2LayerStatus:[],deleteLightbox:!1,dimensionMap:{map1:"2D",map2:"2D"},toSearchDimensionStatus:P(()=>{let o=e.targetNum==1?"map1":"map2";return e.dimensionMap[o]==="2D"}),ol3d:null,selectValueTemp:0,areaData:{nodeRef:null,overlay:null,tribeAreaData:{}}}),D=new q({projection:"EPSG:4326",center:e.defaultCenter,zoom:e.defaultCenterZoom});let f=null;function E(){e.map1=new W({target:"map1",layers:[I.sourceFun("default")],view:D,controls:[]})}function F(o,t){const n=new re({source:new oe({features:[new ne({geometry:new se([o,t]),name:"Null Island",population:4e3,rainfall:500})]}),style:new le({image:new ie({anchor:[.5,100],anchorXUnits:"fraction",anchorYUnits:"pixels",src:"https://www.ockert-cnc.de/wp-content/uploads/2016/12/map-marker-icon-100x100.png"})})});let a=e.targetNum==1?"map1":"map2";e[a].addLayer(n)}function j({action:o,value:t}){var p;let n=((p=e.map1)==null?void 0:p.getTarget())==null?"map2":"map1",a=e[n].getView();switch(o){case"In":a.animate({zoom:a.getZoom()+1});break;case"Out":a.animate({zoom:a.getZoom()-1});break;case"toNorth":a.animate({rotation:0});break;case"moveTo":if(t){const{xAxis:m,yAxis:b}=t;a.animate({center:[m,b],zoom:10,duration:100})}else navigator.geolocation.getCurrentPosition(function(m){a.animate({center:[m.coords.longitude,m.coords.latitude],zoom:17,duration:100}),F(m.coords.longitude,m.coords.latitude)});break;case"fullScreen":let i=document.getElementById(`map${e.targetNum}`);i.requestFullscreen?i.requestFullscreen():i.msRequestFullscreen?i.msRequestFullscreen():i.mozRequestFullScreen?i.mozRequestFullScreen():i.webkitRequestFullscreen&&i.webkitRequestFullscreen();break}}function k({action:o,value:t}){var p;let n=e.targetNum==1?e.map1:e.map2,a=n==null?void 0:n.getLayers();switch(o){case"layerMode":if(t.checked){e.layers[t.nodeIndex].group_layers[t.subNodeIndex].single_tiles||(a.getArray().forEach(z=>{z.get("id")&&z.get("id").includes(`node${t.nodeIndex}_subNode${t.subNodeIndex}_nestedSubNode`)&&n.removeLayer(z)}),x("delete",n.getTarget(),t.id));let s=t.nestedSubNodeIndex||e.selectValueTemp,g=S.getLayer(e.layers[t.nodeIndex].group_layers[t.subNodeIndex],s,t.id);n.addLayer(g),t.id==="node0_subNode3_nestedSubNodeundefined"&&k({action:"layerMode",value:{checked:!0,id:"node0_subNode4_nestedSubNodeundefined",nestedSubNode:!1,nestedSubNodeIndex:void 0,nodeIndex:0,subNodeIndex:4}}),t.id==="node0_subNode4_nestedSubNodeundefined"&&l(n),x("add",n.getTarget(),t.id)}else{let s=a.getArray(),g;switch(t.id){case"node0_subNode0_nestedSubNodeundefined":g=s.filter(u=>u.get("id")==="node0_subNode0_nestedSubNodeundefined"),g.forEach(u=>{n.removeLayer(u)});break;case"node3_subNode1_nestedSubNodeundefined":g=s.filter(u=>u.get("id")==="node3_subNode1_nestedSubNodeundefined"),g.forEach(u=>{n.removeLayer(u)});break;default:s.forEach(u=>{u.get("id")==t.id&&n.removeLayer(u)});break}x("delete",n.getTarget(),t.id)}break;case"selectLayerMode":if(e.selectLock)return;t.layerName==="all"?a.getArray().filter(u=>u.get("name")!=="default").forEach(u=>{n.removeLayer(u)}):a.getArray().forEach(g=>{g.get("id")==t.id&&n.removeLayer(g)});break;case"changeOrder":if(e.selectLock)return;let i=A.getLayerIndex(t.id),m=S.getLayer(e.layers[i.nodeIndex].group_layers[i.subNodeIndex],i.nestedSubNodeIndex,t.id);if(t.movement==="up"){if(t.key+1==a.getArray().length)return;t.checked=!1,k({action:"layerMode",value:t}),a.insertAt(t.key+1,m)}if(t.movement==="down"){if(t.key-1==0)return;t.checked=!1,k({action:"layerMode",value:t}),a.insertAt(t.key-1,m)}break;case"changeLayerVisible":if(e.selectLock)return;let b=!a.getArray()[t.key].getVisible();a.getArray()[t.key].setVisible(b);break;case"baseMap":let w=r.sourceFun(t.layerName);a.extend([w]),a.getArray().forEach(s=>{s.get("name")!==t.layerName&&n.removeLayer(s)});break;case"changeMapCount":if(e.mapCount===t)return;let N=e.targetNum!==1?"map1":"map2";e.mapCount=t;let J=e[`${N}LayerStatus`].filter(s=>s!=="3D").map(s=>A.getLayerIndex(s));if(t===2&&(e[N]=new W({target:N,layers:[I.sourceFun("default"),...J.map(s=>S.getLayer(e.layers[s.nodeIndex].group_layers[s.subNodeIndex],s.nestedSubNodeIndex,s.id))],view:D,controls:[]}),((p=e[`${N}LayerStatus`])==null?void 0:p.indexOf("3D"))!==-1)){f=new V({map:e[N]}),f.setEnabled(!0),Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0NzM3MWFhYS0xMjNlLTQ3MTMtODFjZS0xZjMzM2I5NGZiYTEiLCJpZCI6MTMwODE4LCJpYXQiOjE2ODQwNzM3Mjl9.UYu4kBialPo19dcvosHzZTpg2BD1zkFQnjCD78YiiYo";let s=f.getCesiumScene({});s.terrainProvider=Cesium.createWorldTerrain({})}if(t===1){e[N]=null;const s=document.getElementById(N);for(;s.firstChild;)s.removeChild(s.firstChild)}break;case"changeDimensionMap":let T=e.targetNum==1?"map1":"map2";if(e.dimensionMap[T]=t,t==="3D"){f=new V({map:n}),f.setEnabled(!0),Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0NzM3MWFhYS0xMjNlLTQ3MTMtODFjZS0xZjMzM2I5NGZiYTEiLCJpZCI6MTMwODE4LCJpYXQiOjE2ODQwNzM3Mjl9.UYu4kBialPo19dcvosHzZTpg2BD1zkFQnjCD78YiiYo";let s=f.getCesiumScene({});s.terrainProvider=Cesium.createWorldTerrain({}),e[`${T}LayerStatus`].push("3D")}else f.setEnabled(!1),e[`${T}LayerStatus`]=e[`${T}LayerStatus`].filter(s=>s!=="3D");break}_()}function v(o){var n;e.targetNum=o;let t=e.targetNum!==1?"map1":"map2";if(e.mapCount===1){if(!e[`map${o}`]){let a=e[`map${o}LayerStatus`].filter(i=>i!=="3D");if(a.includes("node0_subNode4_nestedSubNodeundefined")){let i=a.splice(a.indexOf("node0_subNode4_nestedSubNodeundefined"),1)[0];a.push(i)}let p=a.map(i=>A.getLayerIndex(i));e[`map${o}`]=new W({target:`map${o}`,layers:[I.sourceFun("default"),...p.map(i=>S.getLayer(e.layers[i.nodeIndex].group_layers[i.subNodeIndex],i.nestedSubNodeIndex,i.layeredIndex))],view:D,controls:[]}),l(e[`map${o}`]),((n=e[`map${o}LayerStatus`])==null?void 0:n.indexOf("3D"))!==-1&&(f=new V({map:e[`map${o}`]}),f.setEnabled(!0))}if(e[t]){e[t]=null;const a=document.getElementById(t);for(;a.firstChild;)a.removeChild(a.firstChild)}}Z(()=>{_()})}function _(){var n;let o=e.targetNum==1?e.map1:e.map2;const t=(n=o==null?void 0:o.getLayers())==null?void 0:n.getArray();e.currentLayers=t==null?void 0:t.map(a=>({label:a.get("label"),id:a.get("id"),visible:a.getVisible()}))}function O(){e.conditionWrap=!e.conditionWrap}function x(o,t,n){if(o==="add")e[`${t}LayerStatus`].push(n);else if(o==="delete"){let a=e[`${t}LayerStatus`].findIndex(p=>p===n);e[`${t}LayerStatus`].splice(a,1)}else console.log("error")}function l(o){var n;let t=new G({layers:(n=o==null?void 0:o.getLayers())==null?void 0:n.getArray(),condition:Q});o.addInteraction(t),t.on("select",a=>{let p=a.selected;a.selected[0]?(e.areaData.overlay=new U({element:e.areaData.nodeRef,autoPan:!0,autoPanAnimation:{duration:250}}),o.addOverlay(e.areaData.overlay),e.areaData.overlay.setPosition(a.mapBrowserEvent.coordinate),p.forEach(i=>{let m=i.getProperties();Object.entries(m).forEach(b=>{const w=b[0],R=b[1];e.areaData.tribeAreaData[w]=R})})):(o.removeOverlay(e.areaData.overlay),e.areaData.overlay=null)})}function c(){(e.targetNum==1?e.map1:e.map2).removeOverlay(e.areaData.overlay),e.areaData.overlay=null}return ue(async()=>{await me.ajax({url:"https://api.edtest.site/layers",method:"GET"}).done(o=>{e.layers=o.map((t,n)=>(t.group_layers.forEach((a,p)=>{let i=p,m;a.id=`node${n}_subNode${i}_nestedSubNode${m}`,a.single_tiles||a.tiles_list.forEach((b,w)=>{m=w,b.id=`node${n}_subNode${i}_nestedSubNode${m}`})}),{...t,value:n})),Z(()=>{E(),_()})}).fail(o=>{console.log("Fail",o)})}),{state:e,props:B,mapControl:j,layerControl:k,getCurrentLayerNames:_,changeTarget:v,conditionWrap:O,closeMapData:c}}},Le={class:"SearchBar position-absolute"},_e=y("img",{src:X,alt:"",class:"mb-2"},null,-1),Ne={class:"w-100 d-flex flex-nowrap mapWrap",id:"mapWrap"},he={key:0,class:"middleLine"},Ce={class:"condition position-absolute"},ke={class:"mb-2"},xe={key:1,class:"mb-4"},Se={key:1},we={key:0,class:"lightWrap w-100 h-100 d-flex justify-content-center align-items-center"},Ie={class:"p-4 rounded bg-white",style:{width:"250px"}},Me=y("p",{class:"text-center fw-bold"},"是否要刪除全部圖層",-1),De={class:"d-flex justify-content-around"};function Oe(B,d,S,r,e,D){var _,O,x;const f=H,E=K,F=$,j=ee,k=te,v=ae;return L(),h("div",null,[y("div",Le,[_e,M(f,{dimensionMapStatus:r.state.toSearchDimensionStatus,currentLayers:r.state.currentLayers,mapCount:r.state.mapCount,onOnLayerControl:d[0]||(d[0]=({action:l,value:c})=>{r.layerControl({action:l,value:c})}),onOnChangeTarget:d[1]||(d[1]=l=>{r.changeTarget(l)}),onConditionWrap:d[2]||(d[2]=l=>{r.conditionWrap(l)})},null,8,["dimensionMapStatus","currentLayers","mapCount"])]),M(E,{class:"mapSourceOption",baseMapsOptions:r.state.baseMapsOptions,onOnChangeBaseMaps:d[3]||(d[3]=({action:l,value:c})=>{r.layerControl({action:l,value:c})})},null,8,["baseMapsOptions"]),M(F,{class:"asideTool position-absolute top-50 translate-middle-y",id:"asideTool",onOnMapControl:d[4]||(d[4]=({action:l,value:c})=>{r.mapControl({action:l,value:c})})}),y("div",Ne,[y("div",{id:"map1",class:Y({"w-100":((_=r.state.map1)==null?void 0:_.getTarget())=="map1"})},null,2),r.state.mapCount===2?(L(),h("div",he)):C("",!0),y("div",{id:"map2",class:Y({"w-100":((O=r.state.map2)==null?void 0:O.getTarget())=="map2"})},null,2)]),y("div",Ce,[y("div",ke,[r.state.conditionWrap?C("",!0):(L(),h("button",{key:0,class:"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5",onClick:d[5]||(d[5]=l=>r.state.conditionWrap=!0)}," 圖層選項 ")),r.state.conditionWrap?(L(),h("div",xe,[M(j,ye({mapLayers:r.state.mapLayers,currentLayers:r.state.currentLayers,onClose:()=>{r.state.conditionWrap=!1},showSelectLayerValue:l=>{r.state.selectValueTemp=l}},{onOnMapControl:d[6]||(d[6]=({action:l,value:c})=>{r.mapControl({action:l,value:c})}),onOnLayerControl:d[7]||(d[7]=({action:l,value:c})=>{r.layerControl({action:l,value:c})})}),null,16)])):C("",!0)]),y("div",null,[r.state.layerSelect?C("",!0):(L(),h("button",{key:0,class:"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5",onClick:d[8]||(d[8]=l=>r.state.layerSelect=!0)}," 已選擇的圖層 ")),r.state.layerSelect?(L(),h("div",Se,[M(k,pe(fe({selectLock:r.state.selectLock,currentLayers:r.state.currentLayers,onClose:()=>{r.state.layerSelect=!1},onChangLayerVisible:l=>{r.layerControl(l)},onChangeOrderLayer:({action:l,value:c})=>{r.layerControl({action:l,value:c})},onLockLayer:()=>{r.state.selectLock=!r.state.selectLock},onDeleteLayer:({action:l,value:c})=>{c.layerName=="all"?r.state.deleteLightbox=!0:r.layerControl({action:l,value:c})},onDeleteLayerAll:()=>{r.state.deleteLightbox=!0}})),null,16)])):C("",!0)])]),r.state.deleteLightbox?(L(),h("div",we,[y("div",Ie,[Me,y("div",De,[y("button",{class:"rounded px-3 py-1 bg-steel text-white border-0",onClick:d[9]||(d[9]=()=>{r.layerControl({action:"selectLayerMode",value:{layerName:"all"}}),r.state.deleteLightbox=!1})},"確定"),y("button",{class:"rounded px-3 py-1 bg-secondary bg-gradient text-white border-0",onClick:d[10]||(d[10]=()=>{r.state.deleteLightbox=!1})},"取消")])])])):C("",!0),y("div",{id:"popup",style:{position:"fixed",top:"100%",left:"100%"},ref:l=>{r.state.areaData.nodeRef=l}},[(x=r.state.areaData)!=null&&x.overlay?(L(),ge(v,{key:0,class:"areaData",closeMapData:()=>{r.closeMapData()},tribeAreaData:r.state.areaData.tribeAreaData,maxHeight:500},null,8,["closeMapData","tribeAreaData"])):C("",!0)],512)])}const Fe=de(be,[["render",Oe]]);export{Fe as default};
//# sourceMappingURL=Wes-ea2e3fb9.js.map
