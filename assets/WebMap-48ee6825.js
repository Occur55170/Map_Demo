import{V as q,O as V,m as A,M as W,b as M,S as G,c as Q,a as U,_ as X,d as H,e as K,f as $,g as ee,h as te,i as ae,j as re,k as oe,F as ne,P as se,l as le,I as ie}from"./logo-2b1bcc57.js";import{_ as de,r as ce,c as P,o as ue,$ as me,n as Z,a as C,b as y,d as I,e as Y,f as h,m as ye,g as pe,h as fe,i as ge,j as _}from"./index-1deeabde.js";const be={props:{},setup(B,{emit:d}){const S=A,a=M,e=ce({defaultCenter:[121.326776,24.655499],defaultCenterZoom:14,targetNum:1,conditionWrap:!1,layerSelect:!1,currentLayers:[],layers:[],mapLayers:P(()=>e.layers.map((o,t)=>({label:o.group_title,value:o.value,layers:o.group_layers,groupClass:o.group_class}))),baseMapsOptions:P(()=>M.sourceData()),selectLock:!1,mapCount:1,map1:null,map2:null,map1LayerStatus:[],map2LayerStatus:[],deleteLightbox:!1,dimensionMap:{map1:"2D",map2:"2D"},toSearchDimensionStatus:P(()=>{let o=e.targetNum==1?"map1":"map2";return e.dimensionMap[o]==="2D"}),ol3d:null,selectValueTemp:0,areaData:{nodeRef:null,overlay:null,tribeAreaData:{}}}),D=new q({projection:"EPSG:4326",center:e.defaultCenter,zoom:e.defaultCenterZoom});let f=null;function E(){e.map1=new W({target:"map1",layers:[M.sourceFun("default")],view:D,controls:[]})}function F(o,t){const n=new re({source:new oe({features:[new ne({geometry:new se([o,t]),name:"Null Island",population:4e3,rainfall:500})]}),style:new le({image:new ie({anchor:[.5,100],anchorXUnits:"fraction",anchorYUnits:"pixels",src:"https://www.ockert-cnc.de/wp-content/uploads/2016/12/map-marker-icon-100x100.png"})})});let r=e.targetNum==1?"map1":"map2";e[r].addLayer(n)}function j({action:o,value:t}){var p;let n=((p=e.map1)==null?void 0:p.getTarget())==null?"map2":"map1",r=e[n].getView();switch(o){case"In":r.animate({zoom:r.getZoom()+1});break;case"Out":r.animate({zoom:r.getZoom()-1});break;case"toNorth":r.animate({rotation:0});break;case"moveTo":if(t){const{xAxis:c,yAxis:b}=t;r.animate({center:[c,b],zoom:10,duration:100})}else navigator.geolocation.getCurrentPosition(function(c){r.animate({center:[c.coords.longitude,c.coords.latitude],zoom:17,duration:100}),F(c.coords.longitude,c.coords.latitude)});break;case"fullScreen":let i=document.getElementById(`map${e.targetNum}`);i.requestFullscreen?i.requestFullscreen():i.msRequestFullscreen?i.msRequestFullscreen():i.mozRequestFullScreen?i.mozRequestFullScreen():i.webkitRequestFullscreen&&i.webkitRequestFullscreen();break}}function k({action:o,value:t}){var p;let n=e.targetNum==1?e.map1:e.map2,r=n==null?void 0:n.getLayers();switch(o){case"layerMode":if(t.checked){e.layers[t.nodeIndex].group_layers[t.subNodeIndex].single_tiles||(r.getArray().forEach(z=>{z.get("id")&&z.get("id").includes(`node${t.nodeIndex}_subNode${t.subNodeIndex}_nestedSubNode`)&&n.removeLayer(z)}),x("delete",n.getTarget(),t.id));let s=t.nestedSubNodeIndex||e.selectValueTemp,g=S.getLayer(e.layers[t.nodeIndex].group_layers[t.subNodeIndex],s,t.id);n.addLayer(g),t.id==="node0_subNode3_nestedSubNodeundefined"&&k({action:"layerMode",value:{checked:!0,id:"node0_subNode4_nestedSubNodeundefined",nestedSubNode:!1,nestedSubNodeIndex:void 0,nodeIndex:0,subNodeIndex:4}}),t.id==="node0_subNode4_nestedSubNodeundefined"&&l(n),x("add",n.getTarget(),t.id)}else{let s=r.getArray(),g;switch(t.id){case"node0_subNode0_nestedSubNodeundefined":g=s.filter(m=>m.get("id")==="node0_subNode0_nestedSubNodeundefined"),g.forEach(m=>{n.removeLayer(m)});break;case"node3_subNode1_nestedSubNodeundefined":g=s.filter(m=>m.get("id")==="node3_subNode1_nestedSubNodeundefined"),g.forEach(m=>{n.removeLayer(m)});break;default:s.forEach(m=>{m.get("id")==t.id&&n.removeLayer(m)});break}x("delete",n.getTarget(),t.id)}break;case"selectLayerMode":if(e.selectLock)return;t.layerName==="all"?r.getArray().filter(m=>m.get("name")!=="default").forEach(m=>{n.removeLayer(m)}):r.getArray().forEach(g=>{g.get("id")==t.id&&n.removeLayer(g)});break;case"changeOrder":if(e.selectLock)return;let i=A.getLayerIndex(t.id),c=S.getLayer(e.layers[i.nodeIndex].group_layers[i.subNodeIndex],i.nestedSubNodeIndex,t.id);if(t.movement==="up"){if(t.key+1==r.getArray().length)return;t.checked=!1,k({action:"layerMode",value:t}),r.insertAt(t.key+1,c)}if(t.movement==="down"){if(t.key-1==0)return;t.checked=!1,k({action:"layerMode",value:t}),r.insertAt(t.key-1,c)}break;case"changeLayerVisible":if(e.selectLock)return;let b=!r.getArray()[t.key].getVisible();r.getArray()[t.key].setVisible(b);break;case"baseMap":let w=a.sourceFun(t.layerName);r.extend([w]),r.getArray().forEach(s=>{s.get("name")!==t.layerName&&n.removeLayer(s)});break;case"changeMapCount":if(e.mapCount===t)return;let N=e.targetNum!==1?"map1":"map2";e.mapCount=t;let J=e[`${N}LayerStatus`].filter(s=>s!=="3D").map(s=>A.getLayerIndex(s));if(t===2&&(e[N]=new W({target:N,layers:[M.sourceFun("default"),...J.map(s=>S.getLayer(e.layers[s.nodeIndex].group_layers[s.subNodeIndex],s.nestedSubNodeIndex,s.id))],view:D,controls:[]}),((p=e[`${N}LayerStatus`])==null?void 0:p.indexOf("3D"))!==-1)){f=new V({map:e[N]}),f.setEnabled(!0),Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0NzM3MWFhYS0xMjNlLTQ3MTMtODFjZS0xZjMzM2I5NGZiYTEiLCJpZCI6MTMwODE4LCJpYXQiOjE2ODQwNzM3Mjl9.UYu4kBialPo19dcvosHzZTpg2BD1zkFQnjCD78YiiYo";let s=f.getCesiumScene({});s.terrainProvider=Cesium.createWorldTerrain({})}if(t===1){e[N]=null;const s=document.getElementById(N);for(;s.firstChild;)s.removeChild(s.firstChild)}break;case"changeDimensionMap":let O=e.targetNum==1?"map1":"map2";if(e.dimensionMap[O]=t,t==="3D"){f=new V({map:n}),f.setEnabled(!0),Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0NzM3MWFhYS0xMjNlLTQ3MTMtODFjZS0xZjMzM2I5NGZiYTEiLCJpZCI6MTMwODE4LCJpYXQiOjE2ODQwNzM3Mjl9.UYu4kBialPo19dcvosHzZTpg2BD1zkFQnjCD78YiiYo";let s=f.getCesiumScene({});s.terrainProvider=Cesium.createWorldTerrain({}),e[`${O}LayerStatus`].push("3D")}else f.setEnabled(!1),e[`${O}LayerStatus`]=e[`${O}LayerStatus`].filter(s=>s!=="3D");break}L()}function v(o){var n;e.targetNum=o;let t=e.targetNum!==1?"map1":"map2";if(e.mapCount===1){if(!e[`map${o}`]){let r=e[`map${o}LayerStatus`].filter(i=>i!=="3D");r.includes("node0_subNode4_nestedSubNodeundefined")&&(r=[...r.filter(c=>c!=="node0_subNode4_nestedSubNodeundefined"),"node0_subNode4_nestedSubNodeundefined"]);let p=r.map(i=>A.getLayerIndex(i));e[`map${o}`]=new W({target:`map${o}`,layers:[M.sourceFun("default"),...p.map(i=>S.getLayer(e.layers[i.nodeIndex].group_layers[i.subNodeIndex],i.nestedSubNodeIndex,i.layeredIndex))],view:D,controls:[]}),l(e[`map${o}`]),((n=e[`map${o}LayerStatus`])==null?void 0:n.indexOf("3D"))!==-1&&(f=new V({map:e[`map${o}`]}),f.setEnabled(!0))}if(e[t]){e[t]=null;const r=document.getElementById(t);for(;r.firstChild;)r.removeChild(r.firstChild)}}Z(()=>{L()})}function L(){var n;let o=e.targetNum==1?e.map1:e.map2;const t=(n=o==null?void 0:o.getLayers())==null?void 0:n.getArray();e.currentLayers=t==null?void 0:t.map(r=>({label:r.get("label"),id:r.get("id"),visible:r.getVisible()}))}function T(){e.conditionWrap=!e.conditionWrap}function x(o,t,n){if(o==="add")e[`${t}LayerStatus`].push(n);else if(o==="delete"){let r=e[`${t}LayerStatus`].findIndex(p=>p===n);e[`${t}LayerStatus`].splice(r,1)}else console.log("error")}function l(o){var n;let t=new G({layers:(n=o==null?void 0:o.getLayers())==null?void 0:n.getArray(),condition:Q});o.addInteraction(t),t.on("select",r=>{let p=r.selected;r.selected[0]?(e.areaData.overlay=new U({element:e.areaData.nodeRef,autoPan:!0,autoPanAnimation:{duration:250}}),o.addOverlay(e.areaData.overlay),e.areaData.overlay.setPosition(r.mapBrowserEvent.coordinate),p.forEach(i=>{let c=i.getProperties();Object.entries(c).forEach(b=>{const w=b[0],R=b[1];e.areaData.tribeAreaData[w]=R})})):(o.removeOverlay(e.areaData.overlay),e.areaData.overlay=null)})}function u(){(e.targetNum==1?e.map1:e.map2).removeOverlay(e.areaData.overlay),e.areaData.overlay=null}return ue(async()=>{await me.ajax({url:"https://api.edtest.site/layers",method:"GET"}).done(o=>{e.layers=o.map((t,n)=>(t.group_layers.forEach((r,p)=>{let i=p,c;r.id=`node${n}_subNode${i}_nestedSubNode${c}`,r.single_tiles||r.tiles_list.forEach((b,w)=>{c=w,b.id=`node${n}_subNode${i}_nestedSubNode${c}`})}),{...t,value:n})),Z(()=>{E(),L()})}).fail(o=>{console.log("Fail",o)})}),{state:e,props:B,mapControl:j,layerControl:k,getCurrentLayerNames:L,changeTarget:v,conditionWrap:T,closeMapData:u}}},_e={class:"SearchBar position-absolute"},Le=y("img",{src:X,alt:"",class:"mb-2"},null,-1),Ne={class:"w-100 d-flex flex-nowrap mapWrap",id:"mapWrap"},Ce={key:0,class:"middleLine"},he={class:"condition position-absolute"},ke={class:"mb-2"},xe={key:1,class:"mb-4"},Se={key:1},we={key:0,class:"lightWrap w-100 h-100 d-flex justify-content-center align-items-center"},Me={class:"p-4 rounded bg-white",style:{width:"250px"}},Ie=y("p",{class:"text-center fw-bold"},"是否要刪除全部圖層",-1),De={class:"d-flex justify-content-around"};function Te(B,d,S,a,e,D){var L,T,x;const f=H,E=K,F=$,j=ee,k=te,v=ae;return _(),C("div",null,[y("div",_e,[Le,I(f,{dimensionMapStatus:a.state.toSearchDimensionStatus,currentLayers:a.state.currentLayers,mapCount:a.state.mapCount,onOnLayerControl:d[0]||(d[0]=({action:l,value:u})=>{a.layerControl({action:l,value:u})}),onOnChangeTarget:d[1]||(d[1]=l=>{a.changeTarget(l)}),onConditionWrap:d[2]||(d[2]=l=>{a.conditionWrap(l)})},null,8,["dimensionMapStatus","currentLayers","mapCount"])]),I(E,{class:"mapSourceOption",baseMapsOptions:a.state.baseMapsOptions,onOnChangeBaseMaps:d[3]||(d[3]=({action:l,value:u})=>{a.layerControl({action:l,value:u})})},null,8,["baseMapsOptions"]),I(F,{class:"asideTool position-absolute top-50 translate-middle-y",id:"asideTool",onOnMapControl:d[4]||(d[4]=({action:l,value:u})=>{a.mapControl({action:l,value:u})})}),y("div",Ne,[y("div",{id:"map1",class:Y({"w-100":((L=a.state.map1)==null?void 0:L.getTarget())=="map1"})},null,2),a.state.mapCount===2?(_(),C("div",Ce)):h("",!0),y("div",{id:"map2",class:Y({"w-100":((T=a.state.map2)==null?void 0:T.getTarget())=="map2"})},null,2)]),y("div",he,[y("div",ke,[a.state.conditionWrap?h("",!0):(_(),C("button",{key:0,class:"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5",onClick:d[5]||(d[5]=l=>a.state.conditionWrap=!0)}," 圖層選項 ")),a.state.conditionWrap?(_(),C("div",xe,[I(j,ye({mapLayers:a.state.mapLayers,currentLayers:a.state.currentLayers,onClose:()=>{a.state.conditionWrap=!1},showSelectLayerValue:l=>{a.state.selectValueTemp=l}},{onOnMapControl:d[6]||(d[6]=({action:l,value:u})=>{a.mapControl({action:l,value:u})}),onOnLayerControl:d[7]||(d[7]=({action:l,value:u})=>{a.layerControl({action:l,value:u})})}),null,16)])):h("",!0)]),y("div",null,[a.state.layerSelect?h("",!0):(_(),C("button",{key:0,class:"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5",onClick:d[8]||(d[8]=l=>a.state.layerSelect=!0)}," 已選擇的圖層 ")),a.state.layerSelect?(_(),C("div",Se,[I(k,pe(fe({selectLock:a.state.selectLock,currentLayers:a.state.currentLayers,onClose:()=>{a.state.layerSelect=!1},onChangLayerVisible:l=>{a.layerControl(l)},onChangeOrderLayer:({action:l,value:u})=>{a.layerControl({action:l,value:u})},onLockLayer:()=>{a.state.selectLock=!a.state.selectLock},onDeleteLayer:({action:l,value:u})=>{u.layerName=="all"?a.state.deleteLightbox=!0:a.layerControl({action:l,value:u})},onDeleteLayerAll:()=>{a.state.deleteLightbox=!0}})),null,16)])):h("",!0)])]),a.state.deleteLightbox?(_(),C("div",we,[y("div",Me,[Ie,y("div",De,[y("button",{class:"rounded px-3 py-1 bg-steel text-white border-0",onClick:d[9]||(d[9]=()=>{a.layerControl({action:"selectLayerMode",value:{layerName:"all"}}),a.state.deleteLightbox=!1})},"確定"),y("button",{class:"rounded px-3 py-1 bg-secondary bg-gradient text-white border-0",onClick:d[10]||(d[10]=()=>{a.state.deleteLightbox=!1})},"取消")])])])):h("",!0),y("div",{id:"popup",style:{position:"fixed",top:"100%",left:"100%"},ref:l=>{a.state.areaData.nodeRef=l}},[(x=a.state.areaData)!=null&&x.overlay?(_(),ge(v,{key:0,class:"areaData",closeMapData:()=>{a.closeMapData()},tribeAreaData:a.state.areaData.tribeAreaData,maxHeight:500},null,8,["closeMapData","tribeAreaData"])):h("",!0)],512)])}const Fe=de(be,[["render",Te]]);export{Fe as default};
//# sourceMappingURL=WebMap-48ee6825.js.map
