import{I as go,d as Un,O as mo,S as Es,X as Xn}from"./OSM-113d511a.js";import{B as Hn,u as zt,l as Yt,E as Ce,a as ie,b as _o,c as je,o as ei,e as ye,d as ti,m as po,f as yo,g as xo,i as lt,h as Co,j as wo,k as Kn,t as mt,n as q,p as So,q as Ge,I as le,r as $n,s as Pe,v as _t,w as Ut,x as Xt,y as Ht,z as on,A as vo,C as bo,D as To,F as j,G as qn,H as Lo,J as Eo,R as Io,K as fs,L as gs,M as Ro,N as Ei,O as Kt,P as $t,Q as Yi,S as Fo,T as De,U as ko,V as te,W as Ze,X as qt,Y as Ii,Z as Zn,_ as Mo,$ as Po,a0 as et,a1 as Do,a2 as Ui,a3 as qe,a4 as ms,a5 as Oo,a6 as ft,a7 as Ao,a8 as an,a9 as pt,aa as Go,ab as _s,ac as yt,ad as Bo,ae as No,af as ln,ag as Wo,ah as ve,ai as Je,aj as cn,ak as Jn,al as Vo,am as jo,an as zo,ao as Yo,ap as Ye,aq as Qn,ar as Uo,as as Xo,at as Is,au as er,av as Ho,aw as tr,ax as Ko,ay as ct,az as $o,aA as ir,aB as ps,aC as qo,aD as bi,aE as Zo,aF as Jo,aG as Qo,aH as ea,aI as ta,aJ as ia,aK as sr,aL as K,aM as nr,aN as sa,aO as na,aP as vt,aQ as Ke,aR as ce,aS as ra,aT as rr,aU as ss,aV as hn,aW as di,aX as Wt,aY as dn,aZ as oa,a_ as aa,a$ as la,b0 as ca,b1 as ha,b2 as da,b3 as ua,b4 as or,b5 as ar,b6 as fa,b7 as ga,b8 as lr,b9 as ma,ba as un,bb as _a,bc as pa,bd as ya,be as xa,bf as Ca,bg as wa,bh as Sa,bi as va,bj as cr,bk as ba,bl as Ta,bm as La,bn as Ea,bo as fn,bp as hr,bq as Ia,br as Ra,bs as Ri,bt as Fa,bu as ka,bv as ys,bw as Ma,bx as Pa,by as Da,bz as Oa,bA as Aa,bB as Ga,bC as dr,bD as ur,bE as Ba,bF as gn,bG as Na,bH as ui,bI as Ti,bJ as xt,bK as fr,bL as gr,bM as Wa,bN as Rs,bO as Va,bP as ja,bQ as mn,bR as za,bS as Ya,bT as Ua,bU as Xa,bV as _n,bW as Ha,bX as Ka,bY as pn,bZ as $a,b_ as qa,b$ as Za,c0 as Ja,c1 as ze,c2 as xs,c3 as Cs,c4 as Qa,c5 as el}from"./proj4-56d3a803.js";import{g as tl,_ as Te,r as Le,f as Xi,o as E,c as I,a as m,n as Fi,p as bt,e as Tt,h as il,i as ae,t as N,j as ki,F as we,k as Se,l as P,u as mr,$ as Me,w as J,m as xe,q as _r,s as sl,v as ht,b as nl,x as rl,y as pr,z as yr,A as yn,B as kt,C as ol,D as al,E as xn}from"./index-c6184125.js";import{D as fi,a as Mi,c as ll,T as At}from"./TileWMS-71fd586c.js";class Fs extends Hn{constructor(e){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),e)if(typeof e.getSimplifiedGeometry=="function"){const t=e;this.setGeometry(t)}else{const t=e;this.setProperties(t)}}clone(){const e=new Fs(this.hasProperties()?this.getProperties():null);e.setGeometryName(this.getGeometryName());const t=this.getGeometry();t&&e.setGeometry(t.clone());const i=this.getStyle();return i&&e.setStyle(i),e}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(zt(this.geometryChangeKey_),this.geometryChangeKey_=null);const e=this.getGeometry();e&&(this.geometryChangeKey_=Yt(e,Ce.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(e){this.set(this.geometryName_,e)}setStyle(e){this.style_=e,this.styleFunction_=e?cl(e):void 0,this.changed()}setId(e){this.id_=e,this.changed()}setGeometryName(e){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=e,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function cl(n){if(typeof n=="function")return n;let e;return Array.isArray(n)?e=n:(ie(typeof n.getZIndex=="function",41),e=[n]),function(){return e}}const Ct=Fs;class ks{constructor(e){e=e||{},this.color_=e.color!==void 0?e.color:null}clone(){const e=this.getColor();return new ks({color:Array.isArray(e)?e.slice():e||void 0})}getColor(){return this.color_}setColor(e){this.color_=e}}const wt=ks;function Pi(n,e,t,i,s,r,o){let a,l;const h=(t-e)/i;if(h===1)a=e;else if(h===2)a=e,l=s;else if(h!==0){let c=n[e],d=n[e+1],u=0;const f=[0];for(let p=e+i;p<t;p+=i){const x=n[p],y=n[p+1];u+=Math.sqrt((x-c)*(x-c)+(y-d)*(y-d)),f.push(u),c=x,d=y}const g=s*u,_=_o(f,g);_<0?(l=(g-f[-_-2])/(f[-_-1]-f[-_-2]),a=e+(-_-2)*i):a=e+_*i}o=o>1?o:2,r=r||new Array(o);for(let c=0;c<o;++c)r[c]=a===void 0?NaN:l===void 0?n[a+c]:je(n[a+c],n[a+i+c],l);return r}function ws(n,e,t,i,s,r){if(t==e)return null;let o;if(s<n[e+i-1])return r?(o=n.slice(e,e+i),o[i-1]=s,o):null;if(n[t-1]<s)return r?(o=n.slice(t-i,t),o[i-1]=s,o):null;if(s==n[e+i-1])return n.slice(e,e+i);let a=e/i,l=t/i;for(;a<l;){const u=a+l>>1;s<n[(u+1)*i-1]?l=u:a=u+1}const h=n[a*i-1];if(s==h)return n.slice((a-1)*i,(a-1)*i+i);const c=n[(a+1)*i-1],d=(s-h)/(c-h);o=[];for(let u=0;u<i-1;++u)o.push(je(n[(a-1)*i+u],n[a*i+u],d));return o.push(s),o}function hl(n,e,t,i,s,r,o){if(o)return ws(n,e,t[t.length-1],i,s,r);let a;if(s<n[i-1])return r?(a=n.slice(0,i),a[i-1]=s,a):null;if(n[n.length-1]<s)return r?(a=n.slice(n.length-i),a[i-1]=s,a):null;for(let l=0,h=t.length;l<h;++l){const c=t[l];if(e!=c){if(s<n[e+i-1])return null;if(s<=n[c-1])return ws(n,e,c,i,s,!1);e=c}}return null}function xr(n,e,t,i){let s=n[e],r=n[e+1],o=0;for(let a=e+i;a<t;a+=i){const l=n[a],h=n[a+1];o+=Math.sqrt((l-s)*(l-s)+(h-r)*(h-r)),s=l,r=h}return o}class Di extends ei{constructor(e,t){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendCoordinate(e){this.flatCoordinates?ye(this.flatCoordinates,e):this.flatCoordinates=e.slice(),this.changed()}clone(){const e=new Di(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,s){return s<ti(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(po(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),yo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,e,t,i,s))}forEachSegment(e){return xo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinateAtM(e,t){return this.layout!="XYM"&&this.layout!="XYZM"?null:(t=t!==void 0?t:!1,ws(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t))}getCoordinates(){return lt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(e,t){return Pi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,this.stride)}getLength(){return xr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(e){const t=[];return t.length=Co(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new Di(t,"XY")}getType(){return"LineString"}intersectsExtent(e){return wo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Kn(this.flatCoordinates,0,e,this.stride),this.changed()}}const Oi=Di;class Ms{constructor(e){e=e||{},this.color_=e.color!==void 0?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=e.lineDash!==void 0?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width}clone(){const e=this.getColor();return new Ms({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(e){this.color_=e}setLineCap(e){this.lineCap_=e}setLineDash(e){this.lineDash_=e}setLineDashOffset(e){this.lineDashOffset_=e}setLineJoin(e){this.lineJoin_=e}setMiterLimit(e){this.miterLimit_=e}setWidth(e){this.width_=e}}const gt=Ms;class Ps{constructor(e){this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.scaleArray_=mt(e.scale),this.displacement_=e.displacement,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new Ps({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return q()}getImage(e){return q()}getHitDetectionImage(){return q()}getPixelRatio(e){return 1}getImageState(){return q()}getImageSize(){return q()}getOrigin(){return q()}getSize(){return q()}setDisplacement(e){this.displacement_=e}setOpacity(e){this.opacity_=e}setRotateWithView(e){this.rotateWithView_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=mt(e)}listenImageChange(e){q()}load(){q()}unlistenImageChange(e){q()}}const Cr=Ps;function be(n){return Array.isArray(n)?So(n):n}class Ds extends Cr{constructor(e){const t=e.rotateWithView!==void 0?e.rotateWithView:!1;super({opacity:1,rotateWithView:t,rotation:e.rotation!==void 0?e.rotation:0,scale:e.scale!==void 0?e.scale:1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode}),this.canvas_=void 0,this.hitDetectionCanvas_=null,this.fill_=e.fill!==void 0?e.fill:null,this.origin_=[0,0],this.points_=e.points,this.radius_=e.radius!==void 0?e.radius:e.radius1,this.radius2_=e.radius2,this.angle_=e.angle!==void 0?e.angle:0,this.stroke_=e.stroke!==void 0?e.stroke:null,this.size_=null,this.renderOptions_=null,this.render()}clone(){const e=this.getScale(),t=new Ds({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}getAnchor(){const e=this.size_;if(!e)return null;const t=this.getDisplacement(),i=this.getScaleArray();return[e[0]/2-t[0]/i[0],e[1]/2+t[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(e){this.fill_=e,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_}getImage(e){let t=this.canvas_[e];if(!t){const i=this.renderOptions_,s=Ge(i.size*e,i.size*e);this.draw_(i,s,e),t=s.canvas,this.canvas_[e]=t}return t}getPixelRatio(e){return e}getImageSize(){return this.size_}getImageState(){return le.LOADED}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e,this.render()}listenImageChange(e){}load(){}unlistenImageChange(e){}calculateLineJoinSize_(e,t,i){if(t===0||this.points_===1/0||e!=="bevel"&&e!=="miter")return t;let s=this.radius_,r=this.radius2_===void 0?s:this.radius2_;if(s<r){const C=s;s=r,r=C}const o=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/o,l=r*Math.sin(a),h=Math.sqrt(r*r-l*l),c=s-h,d=Math.sqrt(l*l+c*c),u=d/l;if(e==="miter"&&u<=i)return u*t;const f=t/2/u,g=t/2*(c/d),p=Math.sqrt((s+f)*(s+f)+g*g)-s;if(this.radius2_===void 0||e==="bevel")return p*2;const x=s*Math.sin(a),y=Math.sqrt(s*s-x*x),w=r-y,S=Math.sqrt(x*x+w*w)/x;if(S<=i){const C=S*t/2-r-s;return 2*Math.max(p,C)}return p*2}createRenderOptions(){let e=_t,t=0,i=null,s=0,r,o=0;this.stroke_&&(r=this.stroke_.getColor(),r===null&&(r=Ut),r=be(r),o=this.stroke_.getWidth(),o===void 0&&(o=Xt),i=this.stroke_.getLineDash(),s=this.stroke_.getLineDashOffset(),e=this.stroke_.getLineJoin(),e===void 0&&(e=_t),t=this.stroke_.getMiterLimit(),t===void 0&&(t=Ht));const a=this.calculateLineJoinSize_(e,o,t),l=Math.max(this.radius_,this.radius2_||0),h=Math.ceil(2*l+a);return{strokeStyle:r,strokeWidth:o,size:h,lineDash:i,lineDashOffset:s,lineJoin:e,miterLimit:t}}render(){this.renderOptions_=this.createRenderOptions();const e=this.renderOptions_.size;this.canvas_={},this.size_=[e,e]}draw_(e,t,i){if(t.scale(i,i),t.translate(e.size/2,e.size/2),this.createPath_(t),this.fill_){let s=this.fill_.getColor();s===null&&(s=Pe),t.fillStyle=be(s),t.fill()}this.stroke_&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}createHitDetectionCanvas_(e){if(this.fill_){let t=this.fill_.getColor(),i=0;if(typeof t=="string"&&(t=$n(t)),t===null?i=1:Array.isArray(t)&&(i=t.length===4?t[3]:1),i===0){const s=Ge(e.size,e.size);this.hitDetectionCanvas_=s.canvas,this.drawHitDetectionCanvas_(e,s)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))}createPath_(e){let t=this.points_;const i=this.radius_;if(t===1/0)e.arc(0,0,i,0,2*Math.PI);else{const s=this.radius2_===void 0?i:this.radius2_;this.radius2_!==void 0&&(t*=2);const r=this.angle_-Math.PI/2,o=2*Math.PI/t;for(let a=0;a<t;a++){const l=r+a*o,h=a%2===0?i:s;e.lineTo(h*Math.cos(l),h*Math.sin(l))}e.closePath()}}drawHitDetectionCanvas_(e,t){t.translate(e.size/2,e.size/2),this.createPath_(t),t.fillStyle=Pe,t.fill(),this.stroke_&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}}const wr=Ds;class Os extends wr{constructor(e){e=e||{radius:5},super({points:1/0,fill:e.fill,radius:e.radius,stroke:e.stroke,scale:e.scale!==void 0?e.scale:1,rotation:e.rotation!==void 0?e.rotation:0,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode})}clone(){const e=this.getScale(),t=new Os({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}setRadius(e){this.radius_=e,this.render()}}const As=Os;class Ue{constructor(e){e=e||{},this.geometry_=null,this.geometryFunction_=Cn,e.geometry!==void 0&&this.setGeometry(e.geometry),this.fill_=e.fill!==void 0?e.fill:null,this.image_=e.image!==void 0?e.image:null,this.renderer_=e.renderer!==void 0?e.renderer:null,this.hitDetectionRenderer_=e.hitDetectionRenderer!==void 0?e.hitDetectionRenderer:null,this.stroke_=e.stroke!==void 0?e.stroke:null,this.text_=e.text!==void 0?e.text:null,this.zIndex_=e.zIndex}clone(){let e=this.getGeometry();return e&&typeof e=="object"&&(e=e.clone()),new Ue({geometry:e,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(e){this.renderer_=e}setHitDetectionRenderer(e){this.hitDetectionRenderer_=e}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(e){this.fill_=e}getImage(){return this.image_}setImage(e){this.image_=e}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e}getText(){return this.text_}setText(e){this.text_=e}getZIndex(){return this.zIndex_}setGeometry(e){typeof e=="function"?this.geometryFunction_=e:typeof e=="string"?this.geometryFunction_=function(t){return t.get(e)}:e?e!==void 0&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=Cn,this.geometry_=e}setZIndex(e){this.zIndex_=e}}function dl(n){let e;if(typeof n=="function")e=n;else{let t;Array.isArray(n)?t=n:(ie(typeof n.getZIndex=="function",41),t=[n]),e=function(){return t}}return e}let ns=null;function ul(n,e){if(!ns){const t=new wt({color:"rgba(255,255,255,0.4)"}),i=new gt({color:"#3399CC",width:1.25});ns=[new Ue({image:new As({fill:t,stroke:i,radius:5}),fill:t,stroke:i})]}return ns}function fl(){const n={},e=[255,255,255,1],t=[0,153,255,1],i=3;return n.Polygon=[new Ue({fill:new wt({color:[255,255,255,.5]})})],n.MultiPolygon=n.Polygon,n.LineString=[new Ue({stroke:new gt({color:e,width:i+2})}),new Ue({stroke:new gt({color:t,width:i})})],n.MultiLineString=n.LineString,n.Circle=n.Polygon.concat(n.LineString),n.Point=[new Ue({image:new As({radius:i*2,fill:new wt({color:t}),stroke:new gt({color:e,width:i/2})}),zIndex:1/0})],n.MultiPoint=n.Point,n.GeometryCollection=n.Polygon.concat(n.LineString,n.Point),n}function Cn(n){return n.getGeometry()}const tt=Ue,gl="#333";class Gs{constructor(e){e=e||{},this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.scale_=e.scale,this.scaleArray_=mt(e.scale!==void 0?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.justify_=e.justify,this.textBaseline_=e.textBaseline,this.fill_=e.fill!==void 0?e.fill:new wt({color:gl}),this.maxAngle_=e.maxAngle!==void 0?e.maxAngle:Math.PI/4,this.placement_=e.placement!==void 0?e.placement:"point",this.overflow_=!!e.overflow,this.stroke_=e.stroke!==void 0?e.stroke:null,this.offsetX_=e.offsetX!==void 0?e.offsetX:0,this.offsetY_=e.offsetY!==void 0?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=e.padding===void 0?null:e.padding}clone(){const e=this.getScale();return new Gs({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}setOverflow(e){this.overflow_=e}setFont(e){this.font_=e}setMaxAngle(e){this.maxAngle_=e}setOffsetX(e){this.offsetX_=e}setOffsetY(e){this.offsetY_=e}setPlacement(e){this.placement_=e}setRotateWithView(e){this.rotateWithView_=e}setFill(e){this.fill_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=mt(e!==void 0?e:1)}setStroke(e){this.stroke_=e}setText(e){this.text_=e}setTextAlign(e){this.textAlign_=e}setJustify(e){this.justify_=e}setTextBaseline(e){this.textBaseline_=e}setBackgroundFill(e){this.backgroundFill_=e}setBackgroundStroke(e){this.backgroundStroke_=e}setPadding(e){this.padding_=e}}const ml=Gs;function _l(n,e,t,i,s){Sr(n,e,t||0,i||n.length-1,s||pl)}function Sr(n,e,t,i,s){for(;i>t;){if(i-t>600){var r=i-t+1,o=e-t+1,a=Math.log(r),l=.5*Math.exp(2*a/3),h=.5*Math.sqrt(a*l*(r-l)/r)*(o-r/2<0?-1:1),c=Math.max(t,Math.floor(e-o*l/r+h)),d=Math.min(i,Math.floor(e+(r-o)*l/r+h));Sr(n,e,c,d,s)}var u=n[e],f=t,g=i;for(Mt(n,t,e),s(n[i],u)>0&&Mt(n,t,i);f<g;){for(Mt(n,f,g),f++,g--;s(n[f],u)<0;)f++;for(;s(n[g],u)>0;)g--}s(n[t],u)===0?Mt(n,t,g):(g++,Mt(n,g,i)),g<=e&&(t=g+1),e<=g&&(i=g-1)}}function Mt(n,e,t){var i=n[e];n[e]=n[t],n[t]=i}function pl(n,e){return n<e?-1:n>e?1:0}let vr=class{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const i=[];if(!mi(e,t))return i;const s=this.toBBox,r=[];for(;t;){for(let o=0;o<t.children.length;o++){const a=t.children[o],l=t.leaf?s(a):a;mi(e,l)&&(t.leaf?i.push(a):os(e,l)?this._all(a,i):r.push(a))}t=r.pop()}return i}collides(e){let t=this.data;if(!mi(e,t))return!1;const i=[];for(;t;){for(let s=0;s<t.children.length;s++){const r=t.children[s],o=t.leaf?this.toBBox(r):r;if(mi(e,o)){if(t.leaf||os(e,o))return!0;i.push(r)}}t=i.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let i=0;i<e.length;i++)this.insert(e[i]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const i=this.data;this.data=t,t=i}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=at([]),this}remove(e,t){if(!e)return this;let i=this.data;const s=this.toBBox(e),r=[],o=[];let a,l,h;for(;i||r.length;){if(i||(i=r.pop(),l=r[r.length-1],a=o.pop(),h=!0),i.leaf){const c=yl(e,i.children,t);if(c!==-1)return i.children.splice(c,1),r.push(i),this._condense(r),this}!h&&!i.leaf&&os(i,s)?(r.push(i),o.push(a),a=0,l=i,i=i.children[0]):l?(a++,i=l.children[a],h=!1):i=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const i=[];for(;e;)e.leaf?t.push(...e.children):i.push(...e.children),e=i.pop();return t}_build(e,t,i,s){const r=i-t+1;let o=this._maxEntries,a;if(r<=o)return a=at(e.slice(t,i+1)),st(a,this.toBBox),a;s||(s=Math.ceil(Math.log(r)/Math.log(o)),o=Math.ceil(r/Math.pow(o,s-1))),a=at([]),a.leaf=!1,a.height=s;const l=Math.ceil(r/o),h=l*Math.ceil(Math.sqrt(o));wn(e,t,i,h,this.compareMinX);for(let c=t;c<=i;c+=h){const d=Math.min(c+h-1,i);wn(e,c,d,l,this.compareMinY);for(let u=c;u<=d;u+=l){const f=Math.min(u+l-1,d);a.children.push(this._build(e,u,f,s-1))}}return st(a,this.toBBox),a}_chooseSubtree(e,t,i,s){for(;s.push(t),!(t.leaf||s.length-1===i);){let r=1/0,o=1/0,a;for(let l=0;l<t.children.length;l++){const h=t.children[l],c=rs(h),d=wl(e,h)-c;d<o?(o=d,r=c<r?c:r,a=h):d===o&&c<r&&(r=c,a=h)}t=a||t.children[0]}return t}_insert(e,t,i){const s=i?e:this.toBBox(e),r=[],o=this._chooseSubtree(s,this.data,t,r);for(o.children.push(e),Bt(o,s);t>=0&&r[t].children.length>this._maxEntries;)this._split(r,t),t--;this._adjustParentBBoxes(s,r,t)}_split(e,t){const i=e[t],s=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,s);const o=this._chooseSplitIndex(i,r,s),a=at(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,st(i,this.toBBox),st(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(i,a)}_splitRoot(e,t){this.data=at([e,t]),this.data.height=e.height+1,this.data.leaf=!1,st(this.data,this.toBBox)}_chooseSplitIndex(e,t,i){let s,r=1/0,o=1/0;for(let a=t;a<=i-t;a++){const l=Gt(e,0,a,this.toBBox),h=Gt(e,a,i,this.toBBox),c=Sl(l,h),d=rs(l)+rs(h);c<r?(r=c,s=a,o=d<o?d:o):c===r&&d<o&&(o=d,s=a)}return s||i-t}_chooseSplitAxis(e,t,i){const s=e.leaf?this.compareMinX:xl,r=e.leaf?this.compareMinY:Cl,o=this._allDistMargin(e,t,i,s),a=this._allDistMargin(e,t,i,r);o<a&&e.children.sort(s)}_allDistMargin(e,t,i,s){e.children.sort(s);const r=this.toBBox,o=Gt(e,0,t,r),a=Gt(e,i-t,i,r);let l=gi(o)+gi(a);for(let h=t;h<i-t;h++){const c=e.children[h];Bt(o,e.leaf?r(c):c),l+=gi(o)}for(let h=i-t-1;h>=t;h--){const c=e.children[h];Bt(a,e.leaf?r(c):c),l+=gi(a)}return l}_adjustParentBBoxes(e,t,i){for(let s=i;s>=0;s--)Bt(t[s],e)}_condense(e){for(let t=e.length-1,i;t>=0;t--)e[t].children.length===0?t>0?(i=e[t-1].children,i.splice(i.indexOf(e[t]),1)):this.clear():st(e[t],this.toBBox)}};function yl(n,e,t){if(!t)return e.indexOf(n);for(let i=0;i<e.length;i++)if(t(n,e[i]))return i;return-1}function st(n,e){Gt(n,0,n.children.length,e,n)}function Gt(n,e,t,i,s){s||(s=at(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(let r=e;r<t;r++){const o=n.children[r];Bt(s,n.leaf?i(o):o)}return s}function Bt(n,e){return n.minX=Math.min(n.minX,e.minX),n.minY=Math.min(n.minY,e.minY),n.maxX=Math.max(n.maxX,e.maxX),n.maxY=Math.max(n.maxY,e.maxY),n}function xl(n,e){return n.minX-e.minX}function Cl(n,e){return n.minY-e.minY}function rs(n){return(n.maxX-n.minX)*(n.maxY-n.minY)}function gi(n){return n.maxX-n.minX+(n.maxY-n.minY)}function wl(n,e){return(Math.max(e.maxX,n.maxX)-Math.min(e.minX,n.minX))*(Math.max(e.maxY,n.maxY)-Math.min(e.minY,n.minY))}function Sl(n,e){const t=Math.max(n.minX,e.minX),i=Math.max(n.minY,e.minY),s=Math.min(n.maxX,e.maxX),r=Math.min(n.maxY,e.maxY);return Math.max(0,s-t)*Math.max(0,r-i)}function os(n,e){return n.minX<=e.minX&&n.minY<=e.minY&&e.maxX<=n.maxX&&e.maxY<=n.maxY}function mi(n,e){return e.minX<=n.maxX&&e.minY<=n.maxY&&e.maxX>=n.minX&&e.maxY>=n.minY}function at(n){return{children:n,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function wn(n,e,t,i,s){const r=[e,t];for(;r.length;){if(t=r.pop(),e=r.pop(),t-e<=i)continue;const o=e+Math.ceil((t-e)/i/2)*i;_l(n,o,e,t,s),r.push(e,o,o,t)}}let Pt=null;class vl extends vo{constructor(e,t,i,s,r,o){super(),this.hitDetectionImage_=null,this.image_=e,this.crossOrigin_=s,this.canvas_={},this.color_=o,this.unlisten_=null,this.imageState_=r,this.size_=i,this.src_=t,this.tainted_}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===le.LOADED){Pt||(Pt=Ge(1,1,void 0,{willReadFrequently:!0})),Pt.drawImage(this.image_,0,0);try{Pt.getImageData(0,0,1,1),this.tainted_=!1}catch{Pt=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(Ce.CHANGE)}handleImageError_(){this.imageState_=le.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=le.LOADED,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()}getImage(e){return this.image_||this.initializeImage_(),this.replaceColor_(e),this.canvas_[e]?this.canvas_[e]:this.image_}getPixelRatio(e){return this.replaceColor_(e),this.canvas_[e]?e:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const e=this.size_[0],t=this.size_[1],i=Ge(e,t);i.fillRect(0,0,e,t),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===le.IDLE){this.image_||this.initializeImage_(),this.imageState_=le.LOADING;try{this.image_.src=this.src_}catch{this.handleImageError_()}this.unlisten_=bo(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}}replaceColor_(e){if(!this.color_||this.canvas_[e]||this.imageState_!==le.LOADED)return;const t=this.image_,i=document.createElement("canvas");i.width=Math.ceil(t.width*e),i.height=Math.ceil(t.height*e);const s=i.getContext("2d");s.scale(e,e),s.drawImage(t,0,0),s.globalCompositeOperation="multiply",s.fillStyle=To(this.color_),s.fillRect(0,0,i.width/e,i.height/e),s.globalCompositeOperation="destination-in",s.drawImage(t,0,0),this.canvas_[e]=i}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function bl(n,e,t,i,s,r){let o=on.get(e,i,r);return o||(o=new vl(n,e,t,i,s,r),on.set(e,i,r,o)),o}class Bs extends Cr{constructor(e){e=e||{};const t=e.opacity!==void 0?e.opacity:1,i=e.rotation!==void 0?e.rotation:0,s=e.scale!==void 0?e.scale:1,r=e.rotateWithView!==void 0?e.rotateWithView:!1;super({opacity:t,rotation:i,scale:s,displacement:e.displacement!==void 0?e.displacement:[0,0],rotateWithView:r,declutterMode:e.declutterMode}),this.anchor_=e.anchor!==void 0?e.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=e.anchorOrigin!==void 0?e.anchorOrigin:"top-left",this.anchorXUnits_=e.anchorXUnits!==void 0?e.anchorXUnits:"fraction",this.anchorYUnits_=e.anchorYUnits!==void 0?e.anchorYUnits:"fraction",this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null;const o=e.img!==void 0?e.img:null;this.imgSize_=e.imgSize;let a=e.src;ie(!(a!==void 0&&o),4),ie(!o||o&&this.imgSize_,5),(a===void 0||a.length===0)&&o&&(a=o.src||j(o)),ie(a!==void 0&&a.length>0,6),ie(!((e.width!==void 0||e.height!==void 0)&&e.scale!==void 0),69);const l=e.src!==void 0?le.IDLE:le.LOADED;if(this.color_=e.color!==void 0?$n(e.color):null,this.iconImage_=bl(o,a,this.imgSize_!==void 0?this.imgSize_:null,this.crossOrigin_,l,this.color_),this.offset_=e.offset!==void 0?e.offset:[0,0],this.offsetOrigin_=e.offsetOrigin!==void 0?e.offsetOrigin:"top-left",this.origin_=null,this.size_=e.size!==void 0?e.size:null,this.width_=e.width,this.height_=e.height,this.width_!==void 0||this.height_!==void 0){const h=this.getImage(1),c=()=>{this.updateScaleFromWidthAndHeight(this.width_,this.height_)};h.width>0?this.updateScaleFromWidthAndHeight(this.width_,this.height_):h.addEventListener("load",c)}}clone(){const e=this.getScale();return new Bs({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,imgSize:this.imgSize_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:Array.isArray(e)?e.slice():e,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode(),width:this.width_,height:this.height_})}updateScaleFromWidthAndHeight(e,t){const i=this.getImage(1);e!==void 0&&t!==void 0?super.setScale([e/i.width,t/i.height]):e!==void 0?super.setScale([e/i.width,e/i.width]):t!==void 0?super.setScale([t/i.height,t/i.height]):super.setScale([1,1])}getAnchor(){let e=this.normalizedAnchor_;if(!e){e=this.anchor_;const s=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!s)return null;e=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(e[0]*=s[0]),this.anchorYUnits_=="fraction"&&(e[1]*=s[1])}if(this.anchorOrigin_!="top-left"){if(!s)return null;e===this.anchor_&&(e=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(e[0]=-e[0]+s[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(e[1]=-e[1]+s[1])}this.normalizedAnchor_=e}const t=this.getDisplacement(),i=this.getScaleArray();return[e[0]-t[0]/i[0],e[1]+t[1]/i[1]]}setAnchor(e){this.anchor_=e,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(e){return this.iconImage_.getImage(e)}getPixelRatio(e){return this.iconImage_.getPixelRatio(e)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let e=this.offset_;if(this.offsetOrigin_!="top-left"){const t=this.getSize(),i=this.iconImage_.getSize();if(!t||!i)return null;e=e.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(e[0]=i[0]-t[0]-e[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(e[1]=i[1]-t[1]-e[1])}return this.origin_=e,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){return this.width_}getHeight(){return this.height_}setWidth(e){this.width_=e,this.updateScaleFromWidthAndHeight(e,this.height_)}setHeight(e){this.height_=e,this.updateScaleFromWidthAndHeight(this.width_,e)}setScale(e){super.setScale(e);const t=this.getImage(1);if(t){const i=Array.isArray(e)?e[0]:e;i!==void 0&&(this.width_=i*t.width);const s=Array.isArray(e)?e[1]:e;s!==void 0&&(this.height_=s*t.height)}}listenImageChange(e){this.iconImage_.addEventListener(Ce.CHANGE,e)}load(){this.iconImage_.load()}unlistenImageChange(e){this.iconImage_.removeEventListener(Ce.CHANGE,e)}}const St=Bs;function Sn(n){return new tt({fill:Zt(n,""),stroke:Jt(n,""),text:Tl(n),image:Ll(n)})}function Zt(n,e){const t=n[e+"fill-color"];if(t)return new wt({color:t})}function Jt(n,e){const t=n[e+"stroke-width"],i=n[e+"stroke-color"];if(!(!t&&!i))return new gt({width:t,color:i,lineCap:n[e+"stroke-line-cap"],lineJoin:n[e+"stroke-line-join"],lineDash:n[e+"stroke-line-dash"],lineDashOffset:n[e+"stroke-line-dash-offset"],miterLimit:n[e+"stroke-miter-limit"]})}function Tl(n){const e=n["text-value"];return e?new ml({text:e,font:n["text-font"],maxAngle:n["text-max-angle"],offsetX:n["text-offset-x"],offsetY:n["text-offset-y"],overflow:n["text-overflow"],placement:n["text-placement"],scale:n["text-scale"],rotateWithView:n["text-rotate-with-view"],rotation:n["text-rotation"],textAlign:n["text-align"],justify:n["text-justify"],textBaseline:n["text-baseline"],padding:n["text-padding"],fill:Zt(n,"text-"),backgroundFill:Zt(n,"text-background-"),stroke:Jt(n,"text-"),backgroundStroke:Jt(n,"text-background-")}):void 0}function Ll(n){const e=n["icon-src"],t=n["icon-img"];if(e||t)return new St({src:e,img:t,imgSize:n["icon-img-size"],anchor:n["icon-anchor"],anchorOrigin:n["icon-anchor-origin"],anchorXUnits:n["icon-anchor-x-units"],anchorYUnits:n["icon-anchor-y-units"],color:n["icon-color"],crossOrigin:n["icon-cross-origin"],offset:n["icon-offset"],displacement:n["icon-displacement"],opacity:n["icon-opacity"],scale:n["icon-scale"],rotation:n["icon-rotation"],rotateWithView:n["icon-rotate-with-view"],size:n["icon-size"],declutterMode:n["icon-declutter-mode"]});const i=n["shape-points"];if(i){const r="shape-";return new wr({points:i,fill:Zt(n,r),stroke:Jt(n,r),radius:n["shape-radius"],radius1:n["shape-radius1"],radius2:n["shape-radius2"],angle:n["shape-angle"],displacement:n["shape-displacement"],rotation:n["shape-rotation"],rotateWithView:n["shape-rotate-with-view"],scale:n["shape-scale"],declutterMode:n["shape-declutter-mode"]})}const s=n["circle-radius"];if(s){const r="circle-";return new As({radius:s,fill:Zt(n,r),stroke:Jt(n,r),displacement:n["circle-displacement"],scale:n["circle-scale"],rotation:n["circle-rotation"],rotateWithView:n["circle-rotate-with-view"],declutterMode:n["circle-declutter-mode"]})}}const vn={RENDER_ORDER:"renderOrder"};class El extends qn{constructor(e){e=e||{};const t=Object.assign({},e);delete t.style,delete t.renderBuffer,delete t.updateWhileAnimating,delete t.updateWhileInteracting,super(t),this.declutter_=e.declutter!==void 0?e.declutter:!1,this.renderBuffer_=e.renderBuffer!==void 0?e.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(e.style),this.updateWhileAnimating_=e.updateWhileAnimating!==void 0?e.updateWhileAnimating:!1,this.updateWhileInteracting_=e.updateWhileInteracting!==void 0?e.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(e){return super.getFeatures(e)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(vn.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(e){e.declutterTree||(e.declutterTree=new vr(9)),this.getRenderer().renderDeclutter(e)}setRenderOrder(e){this.set(vn.RENDER_ORDER,e)}setStyle(e){let t;if(e===void 0)t=ul;else if(e===null)t=null;else if(typeof e=="function")t=e;else if(e instanceof tt)t=e;else if(Array.isArray(e)){const i=e.length,s=new Array(i);for(let r=0;r<i;++r){const o=e[r];o instanceof tt?s[r]=o:s[r]=Sn(o)}t=s}else t=Sn(e);this.style_=t,this.styleFunction_=e===null?void 0:dl(this.style_),this.changed()}}const br=El,ii={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},_i=[ii.FILL],Xe=[ii.STROKE],Qe=[ii.BEGIN_PATH],bn=[ii.CLOSE_PATH],B=ii;class Il{drawCustom(e,t,i,s){}drawGeometry(e){}setStyle(e){}drawCircle(e,t){}drawFeature(e,t){}drawGeometryCollection(e,t){}drawLineString(e,t){}drawMultiLineString(e,t){}drawMultiPoint(e,t){}drawMultiPolygon(e,t){}drawPoint(e,t){}drawPolygon(e,t){}drawText(e,t){}setFillStrokeStyle(e,t){}setImageStyle(e,t){}setTextStyle(e,t){}}const Tr=Il;class Rl extends Tr{constructor(e,t,i,s){super(),this.tolerance=e,this.maxExtent=t,this.pixelRatio=s,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(e){const t=this.pixelRatio;return t==1?e:e.map(function(i){return i*t})}appendFlatPointCoordinates(e,t){const i=this.getBufferedMaxExtent(),s=this.tmpCoordinate_,r=this.coordinates;let o=r.length;for(let a=0,l=e.length;a<l;a+=t)s[0]=e[a],s[1]=e[a+1],Lo(i,s)&&(r[o++]=s[0],r[o++]=s[1]);return o}appendFlatLineCoordinates(e,t,i,s,r,o){const a=this.coordinates;let l=a.length;const h=this.getBufferedMaxExtent();o&&(t+=s);let c=e[t],d=e[t+1];const u=this.tmpCoordinate_;let f=!0,g,_,p;for(g=t+s;g<i;g+=s)u[0]=e[g],u[1]=e[g+1],p=Eo(h,u),p!==_?(f&&(a[l++]=c,a[l++]=d,f=!1),a[l++]=u[0],a[l++]=u[1]):p===Io.INTERSECTING?(a[l++]=u[0],a[l++]=u[1],f=!1):f=!0,c=u[0],d=u[1],_=p;return(r&&f||g===t+s)&&(a[l++]=c,a[l++]=d),l}drawCustomCoordinates_(e,t,i,s,r){for(let o=0,a=i.length;o<a;++o){const l=i[o],h=this.appendFlatLineCoordinates(e,t,l,s,!1,!1);r.push(h),t=l}return t}drawCustom(e,t,i,s){this.beginGeometry(e,t);const r=e.getType(),o=e.getStride(),a=this.coordinates.length;let l,h,c,d,u;switch(r){case"MultiPolygon":l=e.getOrientedFlatCoordinates(),d=[];const f=e.getEndss();u=0;for(let g=0,_=f.length;g<_;++g){const p=[];u=this.drawCustomCoordinates_(l,u,f[g],o,p),d.push(p)}this.instructions.push([B.CUSTOM,a,d,e,i,gs]),this.hitDetectionInstructions.push([B.CUSTOM,a,d,e,s||i,gs]);break;case"Polygon":case"MultiLineString":c=[],l=r=="Polygon"?e.getOrientedFlatCoordinates():e.getFlatCoordinates(),u=this.drawCustomCoordinates_(l,0,e.getEnds(),o,c),this.instructions.push([B.CUSTOM,a,c,e,i,fs]),this.hitDetectionInstructions.push([B.CUSTOM,a,c,e,s||i,fs]);break;case"LineString":case"Circle":l=e.getFlatCoordinates(),h=this.appendFlatLineCoordinates(l,0,l.length,o,!1,!1),this.instructions.push([B.CUSTOM,a,h,e,i,lt]),this.hitDetectionInstructions.push([B.CUSTOM,a,h,e,s||i,lt]);break;case"MultiPoint":l=e.getFlatCoordinates(),h=this.appendFlatPointCoordinates(l,o),h>a&&(this.instructions.push([B.CUSTOM,a,h,e,i,lt]),this.hitDetectionInstructions.push([B.CUSTOM,a,h,e,s||i,lt]));break;case"Point":l=e.getFlatCoordinates(),this.coordinates.push(l[0],l[1]),h=this.coordinates.length,this.instructions.push([B.CUSTOM,a,h,e,i]),this.hitDetectionInstructions.push([B.CUSTOM,a,h,e,s||i]);break}this.endGeometry(t)}beginGeometry(e,t){this.beginGeometryInstruction1_=[B.BEGIN_GEOMETRY,t,0,e],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[B.BEGIN_GEOMETRY,t,0,e],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const e=this.hitDetectionInstructions;e.reverse();let t;const i=e.length;let s,r,o=-1;for(t=0;t<i;++t)s=e[t],r=s[0],r==B.END_GEOMETRY?o=t:r==B.BEGIN_GEOMETRY&&(s[2]=t,Ro(this.hitDetectionInstructions,o,t),o=-1)}setFillStrokeStyle(e,t){const i=this.state;if(e){const s=e.getColor();i.fillStyle=be(s||Pe)}else i.fillStyle=void 0;if(t){const s=t.getColor();i.strokeStyle=be(s||Ut);const r=t.getLineCap();i.lineCap=r!==void 0?r:Ei;const o=t.getLineDash();i.lineDash=o?o.slice():Kt;const a=t.getLineDashOffset();i.lineDashOffset=a||$t;const l=t.getLineJoin();i.lineJoin=l!==void 0?l:_t;const h=t.getWidth();i.lineWidth=h!==void 0?h:Xt;const c=t.getMiterLimit();i.miterLimit=c!==void 0?c:Ht,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0}createFill(e){const t=e.fillStyle,i=[B.SET_FILL_STYLE,t];return typeof t!="string"&&i.push(!0),i}applyStroke(e){this.instructions.push(this.createStroke(e))}createStroke(e){return[B.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,this.applyPixelRatio(e.lineDash),e.lineDashOffset*this.pixelRatio]}updateFillStyle(e,t){const i=e.fillStyle;(typeof i!="string"||e.currentFillStyle!=i)&&(i!==void 0&&this.instructions.push(t.call(this,e)),e.currentFillStyle=i)}updateStrokeStyle(e,t){const i=e.strokeStyle,s=e.lineCap,r=e.lineDash,o=e.lineDashOffset,a=e.lineJoin,l=e.lineWidth,h=e.miterLimit;(e.currentStrokeStyle!=i||e.currentLineCap!=s||r!=e.currentLineDash&&!Yi(e.currentLineDash,r)||e.currentLineDashOffset!=o||e.currentLineJoin!=a||e.currentLineWidth!=l||e.currentMiterLimit!=h)&&(i!==void 0&&t.call(this,e),e.currentStrokeStyle=i,e.currentLineCap=s,e.currentLineDash=r,e.currentLineDashOffset=o,e.currentLineJoin=a,e.currentLineWidth=l,e.currentMiterLimit=h)}endGeometry(e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const t=[B.END_GEOMETRY,e];this.instructions.push(t),this.hitDetectionInstructions.push(t)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Fo(this.maxExtent),this.maxLineWidth>0)){const e=this.resolution*(this.maxLineWidth+1)/2;De(this.bufferedMaxExtent_,e,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}const si=Rl;class Fl extends si{constructor(e,t,i,s){super(e,t,i,s),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(e,t){if(!this.image_)return;this.beginGeometry(e,t);const i=e.getFlatCoordinates(),s=e.getStride(),r=this.coordinates.length,o=this.appendFlatPointCoordinates(i,s);this.instructions.push([B.DRAW_IMAGE,r,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([B.DRAW_IMAGE,r,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}drawMultiPoint(e,t){if(!this.image_)return;this.beginGeometry(e,t);const i=e.getFlatCoordinates(),s=e.getStride(),r=this.coordinates.length,o=this.appendFlatPointCoordinates(i,s);this.instructions.push([B.DRAW_IMAGE,r,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([B.DRAW_IMAGE,r,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(e,t){const i=e.getAnchor(),s=e.getSize(),r=e.getOrigin();this.imagePixelRatio_=e.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=e.getHitDetectionImage(),this.image_=e.getImage(this.pixelRatio),this.height_=s[1],this.opacity_=e.getOpacity(),this.originX_=r[0],this.originY_=r[1],this.rotateWithView_=e.getRotateWithView(),this.rotation_=e.getRotation(),this.scale_=e.getScaleArray(),this.width_=s[0],this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}const kl=Fl;class Ml extends si{constructor(e,t,i,s){super(e,t,i,s)}drawFlatCoordinates_(e,t,i,s){const r=this.coordinates.length,o=this.appendFlatLineCoordinates(e,t,i,s,!1,!1),a=[B.MOVE_TO_LINE_TO,r,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),i}drawLineString(e,t){const i=this.state,s=i.strokeStyle,r=i.lineWidth;if(s===void 0||r===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(e,t),this.hitDetectionInstructions.push([B.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,Kt,$t],Qe);const o=e.getFlatCoordinates(),a=e.getStride();this.drawFlatCoordinates_(o,0,o.length,a),this.hitDetectionInstructions.push(Xe),this.endGeometry(t)}drawMultiLineString(e,t){const i=this.state,s=i.strokeStyle,r=i.lineWidth;if(s===void 0||r===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(e,t),this.hitDetectionInstructions.push([B.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset],Qe);const o=e.getEnds(),a=e.getFlatCoordinates(),l=e.getStride();let h=0;for(let c=0,d=o.length;c<d;++c)h=this.drawFlatCoordinates_(a,h,o[c],l);this.hitDetectionInstructions.push(Xe),this.endGeometry(t)}finish(){const e=this.state;return e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&this.instructions.push(Xe),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(e){e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(Xe),e.lastStroke=this.coordinates.length),e.lastStroke=0,super.applyStroke(e),this.instructions.push(Qe)}}const Pl=Ml;class Dl extends si{constructor(e,t,i,s){super(e,t,i,s)}drawFlatCoordinatess_(e,t,i,s){const r=this.state,o=r.fillStyle!==void 0,a=r.strokeStyle!==void 0,l=i.length;this.instructions.push(Qe),this.hitDetectionInstructions.push(Qe);for(let h=0;h<l;++h){const c=i[h],d=this.coordinates.length,u=this.appendFlatLineCoordinates(e,t,c,s,!0,!a),f=[B.MOVE_TO_LINE_TO,d,u];this.instructions.push(f),this.hitDetectionInstructions.push(f),a&&(this.instructions.push(bn),this.hitDetectionInstructions.push(bn)),t=c}return o&&(this.instructions.push(_i),this.hitDetectionInstructions.push(_i)),a&&(this.instructions.push(Xe),this.hitDetectionInstructions.push(Xe)),t}drawCircle(e,t){const i=this.state,s=i.fillStyle,r=i.strokeStyle;if(s===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([B.SET_FILL_STYLE,Pe]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([B.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const o=e.getFlatCoordinates(),a=e.getStride(),l=this.coordinates.length;this.appendFlatLineCoordinates(o,0,o.length,a,!1,!1);const h=[B.CIRCLE,l];this.instructions.push(Qe,h),this.hitDetectionInstructions.push(Qe,h),i.fillStyle!==void 0&&(this.instructions.push(_i),this.hitDetectionInstructions.push(_i)),i.strokeStyle!==void 0&&(this.instructions.push(Xe),this.hitDetectionInstructions.push(Xe)),this.endGeometry(t)}drawPolygon(e,t){const i=this.state,s=i.fillStyle,r=i.strokeStyle;if(s===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([B.SET_FILL_STYLE,Pe]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([B.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const o=e.getEnds(),a=e.getOrientedFlatCoordinates(),l=e.getStride();this.drawFlatCoordinatess_(a,0,o,l),this.endGeometry(t)}drawMultiPolygon(e,t){const i=this.state,s=i.fillStyle,r=i.strokeStyle;if(s===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([B.SET_FILL_STYLE,Pe]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([B.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const o=e.getEndss(),a=e.getOrientedFlatCoordinates(),l=e.getStride();let h=0;for(let c=0,d=o.length;c<d;++c)h=this.drawFlatCoordinatess_(a,h,o[c],l);this.endGeometry(t)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const e=this.tolerance;if(e!==0){const t=this.coordinates;for(let i=0,s=t.length;i<s;++i)t[i]=ko(t[i],e)}return super.finish()}setFillStrokeStyles_(){const e=this.state;e.fillStyle!==void 0&&this.updateFillStyle(e,this.createFill),e.strokeStyle!==void 0&&this.updateStrokeStyle(e,this.applyStroke)}}const Tn=Dl;function Ol(n,e,t,i,s){let r=t,o=t,a=0,l=0,h=t,c,d,u,f,g,_,p,x,y,w;for(d=t;d<i;d+=s){const R=e[d],S=e[d+1];g!==void 0&&(y=R-g,w=S-_,f=Math.sqrt(y*y+w*w),p!==void 0&&(l+=u,c=Math.acos((p*y+x*w)/(u*f)),c>n&&(l>a&&(a=l,r=h,o=d),l=0,h=d-s)),u=f,p=y,x=w),g=R,_=S}return l+=f,l>a?[h,d]:[r,o]}const Vt={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class Al extends si{constructor(e,t,i,s){super(e,t,i,s),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterImageWithText_=void 0}finish(){const e=super.finish();return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e}drawText(e,t){const i=this.textFillState_,s=this.textStrokeState_,r=this.textState_;if(this.text_===""||!r||!i&&!s)return;const o=this.coordinates;let a=o.length;const l=e.getType();let h=null,c=e.getStride();if(r.placement==="line"&&(l=="LineString"||l=="MultiLineString"||l=="Polygon"||l=="MultiPolygon")){if(!te(this.getBufferedMaxExtent(),e.getExtent()))return;let d;if(h=e.getFlatCoordinates(),l=="LineString")d=[h.length];else if(l=="MultiLineString")d=e.getEnds();else if(l=="Polygon")d=e.getEnds().slice(0,1);else if(l=="MultiPolygon"){const _=e.getEndss();d=[];for(let p=0,x=_.length;p<x;++p)d.push(_[p][0])}this.beginGeometry(e,t);const u=r.textAlign;let f=0,g;for(let _=0,p=d.length;_<p;++_){if(u==null){const y=Ol(r.maxAngle,h,f,d[_],c);f=y[0],g=y[1]}else g=d[_];for(let y=f;y<g;y+=c)o.push(h[y],h[y+1]);const x=o.length;f=d[_],this.drawChars_(a,x),a=x}this.endGeometry(t)}else{let d=r.overflow?null:[];switch(l){case"Point":case"MultiPoint":h=e.getFlatCoordinates();break;case"LineString":h=e.getFlatMidpoint();break;case"Circle":h=e.getCenter();break;case"MultiLineString":h=e.getFlatMidpoints(),c=2;break;case"Polygon":h=e.getFlatInteriorPoint(),r.overflow||d.push(h[2]/this.resolution),c=3;break;case"MultiPolygon":const p=e.getFlatInteriorPoints();h=[];for(let x=0,y=p.length;x<y;x+=3)r.overflow||d.push(p[x+2]/this.resolution),h.push(p[x],p[x+1]);if(h.length===0)return;c=2;break}const u=this.appendFlatPointCoordinates(h,c);if(u===a)return;if(d&&(u-a)/2!==h.length/c){let p=a/2;d=d.filter((x,y)=>{const w=o[(p+y)*2]===h[y*c]&&o[(p+y)*2+1]===h[y*c+1];return w||--p,w})}this.saveTextStates_(),(r.backgroundFill||r.backgroundStroke)&&(this.setFillStrokeStyle(r.backgroundFill,r.backgroundStroke),r.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),r.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(e,t);let f=r.padding;if(f!=Ze&&(r.scale[0]<0||r.scale[1]<0)){let p=r.padding[0],x=r.padding[1],y=r.padding[2],w=r.padding[3];r.scale[0]<0&&(x=-x,w=-w),r.scale[1]<0&&(p=-p,y=-y),f=[p,x,y,w]}const g=this.pixelRatio;this.instructions.push([B.DRAW_IMAGE,a,u,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,void 0,this.declutterImageWithText_,f==Ze?Ze:f.map(function(p){return p*g}),!!r.backgroundFill,!!r.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]);const _=1/g;this.hitDetectionInstructions.push([B.DRAW_IMAGE,a,u,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[_,_],NaN,void 0,this.declutterImageWithText_,f,!!r.backgroundFill,!!r.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]),this.endGeometry(t)}}saveTextStates_(){const e=this.textStrokeState_,t=this.textState_,i=this.textFillState_,s=this.strokeKey_;e&&(s in this.strokeStates||(this.strokeStates[s]={strokeStyle:e.strokeStyle,lineCap:e.lineCap,lineDashOffset:e.lineDashOffset,lineWidth:e.lineWidth,lineJoin:e.lineJoin,miterLimit:e.miterLimit,lineDash:e.lineDash}));const r=this.textKey_;r in this.textStates||(this.textStates[r]={font:t.font,textAlign:t.textAlign||qt,justify:t.justify,textBaseline:t.textBaseline||Ii,scale:t.scale});const o=this.fillKey_;i&&(o in this.fillStates||(this.fillStates[o]={fillStyle:i.fillStyle}))}drawChars_(e,t){const i=this.textStrokeState_,s=this.textState_,r=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,h=Vt[s.textBaseline],c=this.textOffsetY_*l,d=this.text_,u=i?i.lineWidth*Math.abs(s.scale[0])/2:0;this.instructions.push([B.DRAW_CHARS,e,t,h,s.overflow,a,s.maxAngle,l,c,r,u*l,d,o,1]),this.hitDetectionInstructions.push([B.DRAW_CHARS,e,t,h,s.overflow,a,s.maxAngle,1,c,r,u,d,o,1/l])}setTextStyle(e,t){let i,s,r;if(!e)this.text_="";else{const o=e.getFill();o?(s=this.textFillState_,s||(s={},this.textFillState_=s),s.fillStyle=be(o.getColor()||Pe)):(s=null,this.textFillState_=s);const a=e.getStroke();if(!a)r=null,this.textStrokeState_=r;else{r=this.textStrokeState_,r||(r={},this.textStrokeState_=r);const g=a.getLineDash(),_=a.getLineDashOffset(),p=a.getWidth(),x=a.getMiterLimit();r.lineCap=a.getLineCap()||Ei,r.lineDash=g?g.slice():Kt,r.lineDashOffset=_===void 0?$t:_,r.lineJoin=a.getLineJoin()||_t,r.lineWidth=p===void 0?Xt:p,r.miterLimit=x===void 0?Ht:x,r.strokeStyle=be(a.getColor()||Ut)}i=this.textState_;const l=e.getFont()||Zn;Mo(l);const h=e.getScaleArray();i.overflow=e.getOverflow(),i.font=l,i.maxAngle=e.getMaxAngle(),i.placement=e.getPlacement(),i.textAlign=e.getTextAlign(),i.justify=e.getJustify(),i.textBaseline=e.getTextBaseline()||Ii,i.backgroundFill=e.getBackgroundFill(),i.backgroundStroke=e.getBackgroundStroke(),i.padding=e.getPadding()||Ze,i.scale=h===void 0?[1,1]:h;const c=e.getOffsetX(),d=e.getOffsetY(),u=e.getRotateWithView(),f=e.getRotation();this.text_=e.getText()||"",this.textOffsetX_=c===void 0?0:c,this.textOffsetY_=d===void 0?0:d,this.textRotateWithView_=u===void 0?!1:u,this.textRotation_=f===void 0?0:f,this.strokeKey_=r?(typeof r.strokeStyle=="string"?r.strokeStyle:j(r.strokeStyle))+r.lineCap+r.lineDashOffset+"|"+r.lineWidth+r.lineJoin+r.miterLimit+"["+r.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=s?typeof s.fillStyle=="string"?s.fillStyle:"|"+j(s.fillStyle):""}this.declutterImageWithText_=t}}const Gl={Circle:Tn,Default:si,Image:kl,LineString:Pl,Polygon:Tn,Text:Al};class Bl{constructor(e,t,i,s){this.tolerance_=e,this.maxExtent_=t,this.pixelRatio_=s,this.resolution_=i,this.buildersByZIndex_={}}finish(){const e={};for(const t in this.buildersByZIndex_){e[t]=e[t]||{};const i=this.buildersByZIndex_[t];for(const s in i){const r=i[s].finish();e[t][s]=r}}return e}getBuilder(e,t){const i=e!==void 0?e.toString():"0";let s=this.buildersByZIndex_[i];s===void 0&&(s={},this.buildersByZIndex_[i]=s);let r=s[t];if(r===void 0){const o=Gl[t];r=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),s[t]=r}return r}}const Ai=Bl;function Nl(n,e,t,i,s,r,o,a,l,h,c,d){let u=n[e],f=n[e+1],g=0,_=0,p=0,x=0;function y(){g=u,_=f,e+=i,u=n[e],f=n[e+1],x+=p,p=Math.sqrt((u-g)*(u-g)+(f-_)*(f-_))}do y();while(e<t-i&&x+p<r);let w=p===0?0:(r-x)/p;const R=je(g,u,w),S=je(_,f,w),C=e-i,b=x,v=r+a*l(h,s,c);for(;e<t-i&&x+p<v;)y();w=p===0?0:(v-x)/p;const L=je(g,u,w),T=je(_,f,w);let M;if(d){const O=[R,S,L,T];Po(O,0,4,2,d,O,O),M=O[0]>O[2]}else M=R>L;const W=Math.PI,V=[],H=C+i===e;e=C,p=0,x=b,u=n[e],f=n[e+1];let A;if(H){y(),A=Math.atan2(f-_,u-g),M&&(A+=A>0?-W:W);const O=(L+R)/2,G=(T+S)/2;return V[0]=[O,G,(v-r)/2,A,s],V}s=s.replace(/\n/g," ");for(let O=0,G=s.length;O<G;){y();let D=Math.atan2(f-_,u-g);if(M&&(D+=D>0?-W:W),A!==void 0){let se=D-A;if(se+=se>W?-2*W:se<-W?2*W:0,Math.abs(se)>o)return null}A=D;const U=O;let z=0;for(;O<G;++O){const se=M?G-O-1:O,re=a*l(h,s[se],c);if(e+i<t&&x+p<r+z+re/2)break;z+=re}if(O===U)continue;const $=M?s.substring(G-U,G-O):s.substring(U,O);w=p===0?0:(r+z/2-x)/p;const F=je(g,u,w),ne=je(_,f,w);V.push([F,ne,z/2,D,$]),r+=z}return V}const nt=pt(),Be=[],Re=[],Fe=[],Ne=[];function Ln(n){return n[3].declutterBox}const Wl=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function En(n,e){return(e==="start"||e==="end")&&!Wl.test(n)&&(e=e==="start"?"left":"right"),Vt[e]}function Vl(n,e,t){return t>0&&n.push(`
`,""),n.push(e,""),n}class jl{constructor(e,t,i,s){this.overlaps=i,this.pixelRatio=t,this.resolution=e,this.alignFill_,this.instructions=s.instructions,this.coordinates=s.coordinates,this.coordinateCache_={},this.renderedTransform_=et(),this.hitDetectionInstructions=s.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=s.fillStates||{},this.strokeStates=s.strokeStates||{},this.textStates=s.textStates||{},this.widths_={},this.labels_={}}createLabel(e,t,i,s){const r=e+t+i+s;if(this.labels_[r])return this.labels_[r];const o=s?this.strokeStates[s]:null,a=i?this.fillStates[i]:null,l=this.textStates[t],h=this.pixelRatio,c=[l.scale[0]*h,l.scale[1]*h],d=Array.isArray(e),u=l.justify?Vt[l.justify]:En(Array.isArray(e)?e[0]:e,l.textAlign||qt),f=s&&o.lineWidth?o.lineWidth:0,g=d?e:e.split(`
`).reduce(Vl,[]),{width:_,height:p,widths:x,heights:y,lineWidths:w}=Do(l,g),R=_+f,S=[],C=(R+2)*c[0],b=(p+f)*c[1],v={width:C<0?Math.floor(C):Math.ceil(C),height:b<0?Math.floor(b):Math.ceil(b),contextInstructions:S};(c[0]!=1||c[1]!=1)&&S.push("scale",c),s&&(S.push("strokeStyle",o.strokeStyle),S.push("lineWidth",f),S.push("lineCap",o.lineCap),S.push("lineJoin",o.lineJoin),S.push("miterLimit",o.miterLimit),S.push("setLineDash",[o.lineDash]),S.push("lineDashOffset",o.lineDashOffset)),i&&S.push("fillStyle",a.fillStyle),S.push("textBaseline","middle"),S.push("textAlign","center");const L=.5-u;let T=u*R+L*f;const M=[],W=[];let V=0,H=0,A=0,O=0,G;for(let D=0,U=g.length;D<U;D+=2){const z=g[D];if(z===`
`){H+=V,V=0,T=u*R+L*f,++O;continue}const $=g[D+1]||l.font;$!==G&&(s&&M.push("font",$),i&&W.push("font",$),G=$),V=Math.max(V,y[A]);const F=[z,T+L*x[A]+u*(x[A]-w[O]),.5*(f+V)+H];T+=x[A],s&&M.push("strokeText",F),i&&W.push("fillText",F),++A}return Array.prototype.push.apply(S,M),Array.prototype.push.apply(S,W),this.labels_[r]=v,v}replayTextBackground_(e,t,i,s,r,o,a){e.beginPath(),e.moveTo.apply(e,t),e.lineTo.apply(e,i),e.lineTo.apply(e,s),e.lineTo.apply(e,r),e.lineTo.apply(e,t),o&&(this.alignFill_=o[2],this.fill_(e)),a&&(this.setStrokeStyle_(e,a),e.stroke())}calculateImageOrLabelDimensions_(e,t,i,s,r,o,a,l,h,c,d,u,f,g,_,p){a*=u[0],l*=u[1];let x=i-a,y=s-l;const w=r+h>e?e-h:r,R=o+c>t?t-c:o,S=g[3]+w*u[0]+g[1],C=g[0]+R*u[1]+g[2],b=x-g[3],v=y-g[0];(_||d!==0)&&(Be[0]=b,Ne[0]=b,Be[1]=v,Re[1]=v,Re[0]=b+S,Fe[0]=Re[0],Fe[1]=v+C,Ne[1]=Fe[1]);let L;return d!==0?(L=Ui(et(),i,s,1,1,d,-i,-s),qe(L,Be),qe(L,Re),qe(L,Fe),qe(L,Ne),ms(Math.min(Be[0],Re[0],Fe[0],Ne[0]),Math.min(Be[1],Re[1],Fe[1],Ne[1]),Math.max(Be[0],Re[0],Fe[0],Ne[0]),Math.max(Be[1],Re[1],Fe[1],Ne[1]),nt)):ms(Math.min(b,b+S),Math.min(v,v+C),Math.max(b,b+S),Math.max(v,v+C),nt),f&&(x=Math.round(x),y=Math.round(y)),{drawImageX:x,drawImageY:y,drawImageW:w,drawImageH:R,originX:h,originY:c,declutterBox:{minX:nt[0],minY:nt[1],maxX:nt[2],maxY:nt[3],value:p},canvasTransform:L,scale:u}}replayImageOrLabel_(e,t,i,s,r,o,a){const l=!!(o||a),h=s.declutterBox,c=e.canvas,d=a?a[2]*s.scale[0]/2:0;return h.minX-d<=c.width/t&&h.maxX+d>=0&&h.minY-d<=c.height/t&&h.maxY+d>=0&&(l&&this.replayTextBackground_(e,Be,Re,Fe,Ne,o,a),Oo(e,s.canvasTransform,r,i,s.originX,s.originY,s.drawImageW,s.drawImageH,s.drawImageX,s.drawImageY,s.scale)),!0}fill_(e){if(this.alignFill_){const t=qe(this.renderedTransform_,[0,0]),i=512*this.pixelRatio;e.save(),e.translate(t[0]%i,t[1]%i),e.rotate(this.viewRotation_)}e.fill(),this.alignFill_&&e.restore()}setStrokeStyle_(e,t){e.strokeStyle=t[1],e.lineWidth=t[2],e.lineCap=t[3],e.lineJoin=t[4],e.miterLimit=t[5],e.lineDashOffset=t[7],e.setLineDash(t[6])}drawLabelWithPointPlacement_(e,t,i,s){const r=this.textStates[t],o=this.createLabel(e,t,s,i),a=this.strokeStates[i],l=this.pixelRatio,h=En(Array.isArray(e)?e[0]:e,r.textAlign||qt),c=Vt[r.textBaseline||Ii],d=a&&a.lineWidth?a.lineWidth:0,u=o.width/l-2*r.scale[0],f=h*u+2*(.5-h)*d,g=c*o.height/l+2*(.5-c)*d;return{label:o,anchorX:f,anchorY:g}}execute_(e,t,i,s,r,o,a,l){let h;this.pixelCoordinates_&&Yi(i,this.renderedTransform_)?h=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),h=ft(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),Ao(this.renderedTransform_,i));let c=0;const d=s.length;let u=0,f,g,_,p,x,y,w,R,S,C,b,v,L=0,T=0,M=null,W=null;const V=this.coordinateCache_,H=this.viewRotation_,A=Math.round(Math.atan2(-i[1],i[0])*1e12)/1e12,O={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:H},G=this.instructions!=s||this.overlaps?0:200;let D,U,z,$;for(;c<d;){const F=s[c];switch(F[0]){case B.BEGIN_GEOMETRY:D=F[1],$=F[3],D.getGeometry()?a!==void 0&&!te(a,$.getExtent())?c=F[2]+1:++c:c=F[2];break;case B.BEGIN_PATH:L>G&&(this.fill_(e),L=0),T>G&&(e.stroke(),T=0),!L&&!T&&(e.beginPath(),p=NaN,x=NaN),++c;break;case B.CIRCLE:u=F[1];const se=h[u],re=h[u+1],$i=h[u+2],io=h[u+3],Xs=$i-se,Hs=io-re,Ks=Math.sqrt(Xs*Xs+Hs*Hs);e.moveTo(se+Ks,re),e.arc(se,re,Ks,0,2*Math.PI,!0),++c;break;case B.CLOSE_PATH:e.closePath(),++c;break;case B.CUSTOM:u=F[1],f=F[2];const so=F[3],no=F[4],$s=F.length==6?F[5]:void 0;O.geometry=so,O.feature=D,c in V||(V[c]=[]);const Lt=V[c];$s?$s(h,u,f,2,Lt):(Lt[0]=h[u],Lt[1]=h[u+1],Lt.length=2),no(Lt,O),++c;break;case B.DRAW_IMAGE:u=F[1],f=F[2],R=F[3],g=F[4],_=F[5];let qi=F[6];const ro=F[7],oo=F[8],ao=F[9],qs=F[10];let Zi=F[11];const lo=F[12];let oi=F[13];const Zs=F[14],Et=F[15];if(!R&&F.length>=20){S=F[19],C=F[20],b=F[21],v=F[22];const de=this.drawLabelWithPointPlacement_(S,C,b,v);R=de.label,F[3]=R;const it=F[23];g=(de.anchorX-it)*this.pixelRatio,F[4]=g;const me=F[24];_=(de.anchorY-me)*this.pixelRatio,F[5]=_,qi=R.height,F[6]=qi,oi=R.width,F[13]=oi}let Ji;F.length>25&&(Ji=F[25]);let Qi,ai,li;F.length>17?(Qi=F[16],ai=F[17],li=F[18]):(Qi=Ze,ai=!1,li=!1),qs&&A?Zi+=H:!qs&&!A&&(Zi-=H);let co=0;for(;u<f;u+=2){if(Ji&&Ji[co++]<oi/this.pixelRatio)continue;const de=this.calculateImageOrLabelDimensions_(R.width,R.height,h[u],h[u+1],oi,qi,g,_,oo,ao,Zi,lo,r,Qi,ai||li,D),it=[e,t,R,de,ro,ai?M:null,li?W:null];if(l){if(Zs==="none")continue;if(Zs==="obstacle"){l.insert(de.declutterBox);continue}else{let me,Ee;if(Et){const ue=f-u;if(!Et[ue]){Et[ue]=it;continue}if(me=Et[ue],delete Et[ue],Ee=Ln(me),l.collides(Ee))continue}if(l.collides(de.declutterBox))continue;me&&(l.insert(Ee),this.replayImageOrLabel_.apply(this,me)),l.insert(de.declutterBox)}}this.replayImageOrLabel_.apply(this,it)}++c;break;case B.DRAW_CHARS:const Js=F[1],Qs=F[2],es=F[3],ho=F[4];v=F[5];const uo=F[6],en=F[7],tn=F[8];b=F[9];const ts=F[10];S=F[11],C=F[12];const sn=[F[13],F[13]],is=this.textStates[C],It=is.font,Rt=[is.scale[0]*en,is.scale[1]*en];let Ft;It in this.widths_?Ft=this.widths_[It]:(Ft={},this.widths_[It]=Ft);const nn=xr(h,Js,Qs,2),rn=Math.abs(Rt[0])*an(It,S,Ft);if(ho||rn<=nn){const de=this.textStates[C].textAlign,it=(nn-rn)*Vt[de],me=Nl(h,Js,Qs,2,S,it,uo,Math.abs(Rt[0]),an,It,Ft,A?0:this.viewRotation_);e:if(me){const Ee=[];let ue,ci,hi,oe,_e;if(b)for(ue=0,ci=me.length;ue<ci;++ue){_e=me[ue],hi=_e[4],oe=this.createLabel(hi,C,"",b),g=_e[2]+(Rt[0]<0?-ts:ts),_=es*oe.height+(.5-es)*2*ts*Rt[1]/Rt[0]-tn;const Ie=this.calculateImageOrLabelDimensions_(oe.width,oe.height,_e[0],_e[1],oe.width,oe.height,g,_,0,0,_e[3],sn,!1,Ze,!1,D);if(l&&l.collides(Ie.declutterBox))break e;Ee.push([e,t,oe,Ie,1,null,null])}if(v)for(ue=0,ci=me.length;ue<ci;++ue){_e=me[ue],hi=_e[4],oe=this.createLabel(hi,C,v,""),g=_e[2],_=es*oe.height-tn;const Ie=this.calculateImageOrLabelDimensions_(oe.width,oe.height,_e[0],_e[1],oe.width,oe.height,g,_,0,0,_e[3],sn,!1,Ze,!1,D);if(l&&l.collides(Ie.declutterBox))break e;Ee.push([e,t,oe,Ie,1,null,null])}l&&l.load(Ee.map(Ln));for(let Ie=0,fo=Ee.length;Ie<fo;++Ie)this.replayImageOrLabel_.apply(this,Ee[Ie])}}++c;break;case B.END_GEOMETRY:if(o!==void 0){D=F[1];const de=o(D,$);if(de)return de}++c;break;case B.FILL:G?L++:this.fill_(e),++c;break;case B.MOVE_TO_LINE_TO:for(u=F[1],f=F[2],U=h[u],z=h[u+1],y=U+.5|0,w=z+.5|0,(y!==p||w!==x)&&(e.moveTo(U,z),p=y,x=w),u+=2;u<f;u+=2)U=h[u],z=h[u+1],y=U+.5|0,w=z+.5|0,(u==f-2||y!==p||w!==x)&&(e.lineTo(U,z),p=y,x=w);++c;break;case B.SET_FILL_STYLE:M=F,this.alignFill_=F[2],L&&(this.fill_(e),L=0,T&&(e.stroke(),T=0)),e.fillStyle=F[1],++c;break;case B.SET_STROKE_STYLE:W=F,T&&(e.stroke(),T=0),this.setStrokeStyle_(e,F),++c;break;case B.STROKE:G?T++:e.stroke(),++c;break;default:++c;break}}L&&this.fill_(e),T&&e.stroke()}execute(e,t,i,s,r,o){this.viewRotation_=s,this.execute_(e,t,i,this.instructions,r,void 0,void 0,o)}executeHitDetection(e,t,i,s,r){return this.viewRotation_=i,this.execute_(e,1,t,this.hitDetectionInstructions,!0,s,r)}}const zl=jl,as=["Polygon","Circle","LineString","Image","Text","Default"];class Yl{constructor(e,t,i,s,r,o){this.maxExtent_=e,this.overlaps_=s,this.pixelRatio_=i,this.resolution_=t,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=et(),this.createExecutors_(r)}clip(e,t){const i=this.getClipCoords(t);e.beginPath(),e.moveTo(i[0],i[1]),e.lineTo(i[2],i[3]),e.lineTo(i[4],i[5]),e.lineTo(i[6],i[7]),e.clip()}createExecutors_(e){for(const t in e){let i=this.executorsByZIndex_[t];i===void 0&&(i={},this.executorsByZIndex_[t]=i);const s=e[t];for(const r in s){const o=s[r];i[r]=new zl(this.resolution_,this.pixelRatio_,this.overlaps_,o)}}}hasExecutors(e){for(const t in this.executorsByZIndex_){const i=this.executorsByZIndex_[t];for(let s=0,r=e.length;s<r;++s)if(e[s]in i)return!0}return!1}forEachFeatureAtCoordinate(e,t,i,s,r,o){s=Math.round(s);const a=s*2+1,l=Ui(this.hitDetectionTransform_,s+.5,s+.5,1/t,-1/t,-i,-e[0],-e[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=Ge(a,a,void 0,{willReadFrequently:!0}));const c=this.hitDetectionContext_;c.canvas.width!==a||c.canvas.height!==a?(c.canvas.width=a,c.canvas.height=a):h||c.clearRect(0,0,a,a);let d;this.renderBuffer_!==void 0&&(d=pt(),Go(d,e),De(d,t*(this.renderBuffer_+s),d));const u=Ul(s);let f;function g(S,C){const b=c.getImageData(0,0,a,a).data;for(let v=0,L=u.length;v<L;v++)if(b[u[v]]>0){if(!o||f!=="Image"&&f!=="Text"||o.includes(S)){const T=(u[v]-3)/4,M=s-T%a,W=s-(T/a|0),V=r(S,C,M*M+W*W);if(V)return V}c.clearRect(0,0,a,a);break}}const _=Object.keys(this.executorsByZIndex_).map(Number);_.sort(_s);let p,x,y,w,R;for(p=_.length-1;p>=0;--p){const S=_[p].toString();for(y=this.executorsByZIndex_[S],x=as.length-1;x>=0;--x)if(f=as[x],w=y[f],w!==void 0&&(R=w.executeHitDetection(c,l,i,g,d),R))return R}}getClipCoords(e){const t=this.maxExtent_;if(!t)return null;const i=t[0],s=t[1],r=t[2],o=t[3],a=[i,s,i,o,r,o,r,s];return ft(a,0,8,2,e,a),a}isEmpty(){return yt(this.executorsByZIndex_)}execute(e,t,i,s,r,o,a){const l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(_s),this.maxExtent_&&(e.save(),this.clip(e,i)),o=o||as;let h,c,d,u,f,g;for(a&&l.reverse(),h=0,c=l.length;h<c;++h){const _=l[h].toString();for(f=this.executorsByZIndex_[_],d=0,u=o.length;d<u;++d){const p=o[d];g=f[p],g!==void 0&&g.execute(e,t,i,s,r,a)}}this.maxExtent_&&e.restore()}}const ls={};function Ul(n){if(ls[n]!==void 0)return ls[n];const e=n*2+1,t=n*n,i=new Array(t+1);for(let r=0;r<=n;++r)for(let o=0;o<=n;++o){const a=r*r+o*o;if(a>t)break;let l=i[a];l||(l=[],i[a]=l),l.push(((n+r)*e+(n+o))*4+3),r>0&&l.push(((n-r)*e+(n+o))*4+3),o>0&&(l.push(((n+r)*e+(n-o))*4+3),r>0&&l.push(((n-r)*e+(n-o))*4+3))}const s=[];for(let r=0,o=i.length;r<o;++r)i[r]&&s.push(...i[r]);return ls[n]=s,s}const Gi=Yl;class Xl extends Tr{constructor(e,t,i,s,r,o,a){super(),this.context_=e,this.pixelRatio_=t,this.extent_=i,this.transform_=s,this.transformRotation_=s?Bo(Math.atan2(s[1],s[0]),10):0,this.viewRotation_=r,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=et()}drawImages_(e,t,i,s){if(!this.image_)return;const r=ft(e,t,i,s,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,l=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=l*this.imageOpacity_);let h=this.imageRotation_;this.transformRotation_===0&&(h-=this.viewRotation_),this.imageRotateWithView_&&(h+=this.viewRotation_);for(let c=0,d=r.length;c<d;c+=2){const u=r[c]-this.imageAnchorX_,f=r[c+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const g=u+this.imageAnchorX_,_=f+this.imageAnchorY_;Ui(a,g,_,1,1,h,-g,-_),o.setTransform.apply(o,a),o.translate(g,_),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.setTransform(1,0,0,1,0,0)}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,u,f,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=l)}drawText_(e,t,i,s){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const r=ft(e,t,i,s,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);t<i;t+=s){const l=r[t]+this.textOffsetX_,h=r[t+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.translate(l-this.textOffsetX_,h-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.setTransform(1,0,0,1,0,0)):(this.textStrokeState_&&o.strokeText(this.text_,l,h),this.textFillState_&&o.fillText(this.text_,l,h))}}moveToLineTo_(e,t,i,s,r){const o=this.context_,a=ft(e,t,i,s,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let l=a.length;r&&(l-=2);for(let h=2;h<l;h+=2)o.lineTo(a[h],a[h+1]);return r&&o.closePath(),i}drawRings_(e,t,i,s){for(let r=0,o=i.length;r<o;++r)t=this.moveToLineTo_(e,t,i[r],s,!0);return t}drawCircle(e){if(te(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=No(e,this.transform_,this.pixelCoordinates_),i=t[2]-t[0],s=t[3]-t[1],r=Math.sqrt(i*i+s*s),o=this.context_;o.beginPath(),o.arc(t[0],t[1],r,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(e.getCenter(),0,2,2)}}setStyle(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())}setTransform(e){this.transform_=e}drawGeometry(e){switch(e.getType()){case"Point":this.drawPoint(e);break;case"LineString":this.drawLineString(e);break;case"Polygon":this.drawPolygon(e);break;case"MultiPoint":this.drawMultiPoint(e);break;case"MultiLineString":this.drawMultiLineString(e);break;case"MultiPolygon":this.drawMultiPolygon(e);break;case"GeometryCollection":this.drawGeometryCollection(e);break;case"Circle":this.drawCircle(e);break}}drawFeature(e,t){const i=t.getGeometryFunction()(e);!i||!te(this.extent_,i.getExtent())||(this.setStyle(t),this.drawGeometry(i))}drawGeometryCollection(e){const t=e.getGeometriesArray();for(let i=0,s=t.length;i<s;++i)this.drawGeometry(t[i])}drawPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(t,0,t.length,i),this.text_!==""&&this.drawText_(t,0,t.length,i)}drawMultiPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(t,0,t.length,i),this.text_!==""&&this.drawText_(t,0,t.length,i)}drawLineString(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!te(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const t=this.context_,i=e.getFlatCoordinates();t.beginPath(),this.moveToLineTo_(i,0,i.length,e.getStride(),!1),t.stroke()}if(this.text_!==""){const t=e.getFlatMidpoint();this.drawText_(t,0,2,2)}}}drawMultiLineString(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getExtent();if(te(this.extent_,t)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,s=e.getFlatCoordinates();let r=0;const o=e.getEnds(),a=e.getStride();i.beginPath();for(let l=0,h=o.length;l<h;++l)r=this.moveToLineTo_(s,r,o[l],a,!1);i.stroke()}if(this.text_!==""){const i=e.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!te(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_;t.beginPath(),this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride()),this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoint();this.drawText_(t,0,2,2)}}}drawMultiPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!te(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_,i=e.getOrientedFlatCoordinates();let s=0;const r=e.getEndss(),o=e.getStride();t.beginPath();for(let a=0,l=r.length;a<l;++a){const h=r[a];s=this.drawRings_(i,s,h,o)}this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoints();this.drawText_(t,0,t.length,2)}}}setContextFillState_(e){const t=this.context_,i=this.contextFillState_;i?i.fillStyle!=e.fillStyle&&(i.fillStyle=e.fillStyle,t.fillStyle=e.fillStyle):(t.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})}setContextStrokeState_(e){const t=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=e.lineCap&&(i.lineCap=e.lineCap,t.lineCap=e.lineCap),Yi(i.lineDash,e.lineDash)||t.setLineDash(i.lineDash=e.lineDash),i.lineDashOffset!=e.lineDashOffset&&(i.lineDashOffset=e.lineDashOffset,t.lineDashOffset=e.lineDashOffset),i.lineJoin!=e.lineJoin&&(i.lineJoin=e.lineJoin,t.lineJoin=e.lineJoin),i.lineWidth!=e.lineWidth&&(i.lineWidth=e.lineWidth,t.lineWidth=e.lineWidth),i.miterLimit!=e.miterLimit&&(i.miterLimit=e.miterLimit,t.miterLimit=e.miterLimit),i.strokeStyle!=e.strokeStyle&&(i.strokeStyle=e.strokeStyle,t.strokeStyle=e.strokeStyle)):(t.lineCap=e.lineCap,t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.miterLimit=e.miterLimit,t.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})}setContextTextState_(e){const t=this.context_,i=this.contextTextState_,s=e.textAlign?e.textAlign:qt;i?(i.font!=e.font&&(i.font=e.font,t.font=e.font),i.textAlign!=s&&(i.textAlign=s,t.textAlign=s),i.textBaseline!=e.textBaseline&&(i.textBaseline=e.textBaseline,t.textBaseline=e.textBaseline)):(t.font=e.font,t.textAlign=s,t.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:s,textBaseline:e.textBaseline})}setFillStrokeStyle(e,t){if(!e)this.fillState_=null;else{const i=e.getColor();this.fillState_={fillStyle:be(i||Pe)}}if(!t)this.strokeState_=null;else{const i=t.getColor(),s=t.getLineCap(),r=t.getLineDash(),o=t.getLineDashOffset(),a=t.getLineJoin(),l=t.getWidth(),h=t.getMiterLimit(),c=r||Kt;this.strokeState_={lineCap:s!==void 0?s:Ei,lineDash:this.pixelRatio_===1?c:c.map(d=>d*this.pixelRatio_),lineDashOffset:(o||$t)*this.pixelRatio_,lineJoin:a!==void 0?a:_t,lineWidth:(l!==void 0?l:Xt)*this.pixelRatio_,miterLimit:h!==void 0?h:Ht,strokeStyle:be(i||Ut)}}}setImageStyle(e){let t;if(!e||!(t=e.getSize())){this.image_=null;return}const i=e.getPixelRatio(this.pixelRatio_),s=e.getAnchor(),r=e.getOrigin();this.image_=e.getImage(this.pixelRatio_),this.imageAnchorX_=s[0]*i,this.imageAnchorY_=s[1]*i,this.imageHeight_=t[1]*i,this.imageOpacity_=e.getOpacity(),this.imageOriginX_=r[0],this.imageOriginY_=r[1],this.imageRotateWithView_=e.getRotateWithView(),this.imageRotation_=e.getRotation();const o=e.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/i,o[1]*this.pixelRatio_/i],this.imageWidth_=t[0]*i}setTextStyle(e){if(!e)this.text_="";else{const t=e.getFill();if(!t)this.textFillState_=null;else{const f=t.getColor();this.textFillState_={fillStyle:be(f||Pe)}}const i=e.getStroke();if(!i)this.textStrokeState_=null;else{const f=i.getColor(),g=i.getLineCap(),_=i.getLineDash(),p=i.getLineDashOffset(),x=i.getLineJoin(),y=i.getWidth(),w=i.getMiterLimit();this.textStrokeState_={lineCap:g!==void 0?g:Ei,lineDash:_||Kt,lineDashOffset:p||$t,lineJoin:x!==void 0?x:_t,lineWidth:y!==void 0?y:Xt,miterLimit:w!==void 0?w:Ht,strokeStyle:be(f||Ut)}}const s=e.getFont(),r=e.getOffsetX(),o=e.getOffsetY(),a=e.getRotateWithView(),l=e.getRotation(),h=e.getScaleArray(),c=e.getText(),d=e.getTextAlign(),u=e.getTextBaseline();this.textState_={font:s!==void 0?s:Zn,textAlign:d!==void 0?d:qt,textBaseline:u!==void 0?u:Ii},this.text_=c!==void 0?Array.isArray(c)?c.reduce((f,g,_)=>f+=_%2?" ":g,""):c:"",this.textOffsetX_=r!==void 0?this.pixelRatio_*r:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}}}const Lr=Xl,ge=.5;function Er(n,e,t,i,s,r,o){const a=n[0]*ge,l=n[1]*ge,h=Ge(a,l);h.imageSmoothingEnabled=!1;const c=h.canvas,d=new Lr(h,ge,s,null,o),u=t.length,f=Math.floor((256*256*256-1)/u),g={};for(let p=1;p<=u;++p){const x=t[p-1],y=x.getStyleFunction()||i;if(!i)continue;let w=y(x,r);if(!w)continue;Array.isArray(w)||(w=[w]);const S=(p*f).toString(16).padStart(7,"#00000");for(let C=0,b=w.length;C<b;++C){const v=w[C],L=v.getGeometryFunction()(x);if(!L||!te(s,L.getExtent()))continue;const T=v.clone(),M=T.getFill();M&&M.setColor(S);const W=T.getStroke();W&&(W.setColor(S),W.setLineDash(null)),T.setText(void 0);const V=v.getImage();if(V&&V.getOpacity()!==0){const G=V.getImageSize();if(!G)continue;const D=Ge(G[0],G[1],void 0,{alpha:!1}),U=D.canvas;D.fillStyle=S,D.fillRect(0,0,U.width,U.height),T.setImage(new St({img:U,imgSize:G,anchor:V.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:V.getOrigin(),opacity:1,size:V.getSize(),scale:V.getScale(),rotation:V.getRotation(),rotateWithView:V.getRotateWithView()}))}const H=T.getZIndex()||0;let A=g[H];A||(A={},g[H]=A,A.Polygon=[],A.Circle=[],A.LineString=[],A.Point=[]);const O=L.getType();if(O==="GeometryCollection"){const G=L.getGeometriesArrayRecursive();for(let D=0,U=G.length;D<U;++D){const z=G[D];A[z.getType().replace("Multi","")].push(z,T)}}else A[O.replace("Multi","")].push(L,T)}}const _=Object.keys(g).map(Number).sort(_s);for(let p=0,x=_.length;p<x;++p){const y=g[_[p]];for(const w in y){const R=y[w];for(let S=0,C=R.length;S<C;S+=2){d.setStyle(R[S+1]);for(let b=0,v=e.length;b<v;++b)d.setTransform(e[b]),d.drawGeometry(R[S])}}}return h.getImageData(0,0,c.width,c.height)}function Ir(n,e,t){const i=[];if(t){const s=Math.floor(Math.round(n[0])*ge),r=Math.floor(Math.round(n[1])*ge),o=(ln(s,0,t.width-1)+ln(r,0,t.height-1)*t.width)*4,a=t.data[o],l=t.data[o+1],c=t.data[o+2]+256*(l+256*a),d=Math.floor((256*256*256-1)/e.length);c&&c%d===0&&i.push(e[c/d-1])}return i}const Hl=.5,Rr={Point:tc,LineString:Jl,Polygon:sc,MultiPoint:ic,MultiLineString:Ql,MultiPolygon:ec,GeometryCollection:Zl,Circle:$l};function Kl(n,e){return parseInt(j(n),10)-parseInt(j(e),10)}function Fr(n,e){const t=Ss(n,e);return t*t}function Ss(n,e){return Hl*n/e}function $l(n,e,t,i,s){const r=t.getFill(),o=t.getStroke();if(r||o){const l=n.getBuilder(t.getZIndex(),"Circle");l.setFillStrokeStyle(r,o),l.drawCircle(e,i)}const a=t.getText();if(a&&a.getText()){const l=(s||n).getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,i)}}function Bi(n,e,t,i,s,r,o){let a=!1;const l=t.getImage();if(l){const h=l.getImageState();h==le.LOADED||h==le.ERROR?l.unlistenImageChange(s):(h==le.IDLE&&l.load(),l.listenImageChange(s),a=!0)}return ql(n,e,t,i,r,o),a}function ql(n,e,t,i,s,r){const o=t.getGeometryFunction()(e);if(!o)return;const a=o.simplifyTransformed(i,s);if(t.getRenderer())kr(n,a,t,e);else{const h=Rr[a.getType()];h(n,a,t,e,r)}}function kr(n,e,t,i){if(e.getType()=="GeometryCollection"){const r=e.getGeometries();for(let o=0,a=r.length;o<a;++o)kr(n,r[o],t,i);return}n.getBuilder(t.getZIndex(),"Default").drawCustom(e,i,t.getRenderer(),t.getHitDetectionRenderer())}function Zl(n,e,t,i,s){const r=e.getGeometriesArray();let o,a;for(o=0,a=r.length;o<a;++o){const l=Rr[r[o].getType()];l(n,r[o],t,i,s)}}function Jl(n,e,t,i,s){const r=t.getStroke();if(r){const a=n.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawLineString(e,i)}const o=t.getText();if(o&&o.getText()){const a=(s||n).getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,i)}}function Ql(n,e,t,i,s){const r=t.getStroke();if(r){const a=n.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawMultiLineString(e,i)}const o=t.getText();if(o&&o.getText()){const a=(s||n).getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,i)}}function ec(n,e,t,i,s){const r=t.getFill(),o=t.getStroke();if(o||r){const l=n.getBuilder(t.getZIndex(),"Polygon");l.setFillStrokeStyle(r,o),l.drawMultiPolygon(e,i)}const a=t.getText();if(a&&a.getText()){const l=(s||n).getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,i)}}function tc(n,e,t,i,s){const r=t.getImage(),o=t.getText();let a;if(r){if(r.getImageState()!=le.LOADED)return;let l=n;if(s){const c=r.getDeclutterMode();if(c!=="none")if(l=s,c==="obstacle"){const d=n.getBuilder(t.getZIndex(),"Image");d.setImageStyle(r,a),d.drawPoint(e,i)}else o&&o.getText()&&(a={})}const h=l.getBuilder(t.getZIndex(),"Image");h.setImageStyle(r,a),h.drawPoint(e,i)}if(o&&o.getText()){let l=n;s&&(l=s);const h=l.getBuilder(t.getZIndex(),"Text");h.setTextStyle(o,a),h.drawText(e,i)}}function ic(n,e,t,i,s){const r=t.getImage(),o=t.getText();let a;if(r){if(r.getImageState()!=le.LOADED)return;let l=n;if(s){const c=r.getDeclutterMode();if(c!=="none")if(l=s,c==="obstacle"){const d=n.getBuilder(t.getZIndex(),"Image");d.setImageStyle(r,a),d.drawMultiPoint(e,i)}else o&&o.getText()&&(a={})}const h=l.getBuilder(t.getZIndex(),"Image");h.setImageStyle(r,a),h.drawMultiPoint(e,i)}if(o&&o.getText()){let l=n;s&&(l=s);const h=l.getBuilder(t.getZIndex(),"Text");h.setTextStyle(o,a),h.drawText(e,i)}}function sc(n,e,t,i,s){const r=t.getFill(),o=t.getStroke();if(r||o){const l=n.getBuilder(t.getZIndex(),"Polygon");l.setFillStrokeStyle(r,o),l.drawPolygon(e,i)}const a=t.getText();if(a&&a.getText()){const l=(s||n).getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,i)}}class nc extends Wo{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=pt(),this.wrappedRenderedExtent_=pt(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.declutterExecutorGroup=null,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(e,t,i){const s=t.extent,r=t.viewState,o=r.center,a=r.resolution,l=r.projection,h=r.rotation,c=l.getExtent(),d=this.getLayer().getSource(),u=t.pixelRatio,f=t.viewHints,g=!(f[ve.ANIMATING]||f[ve.INTERACTING]),_=this.compositionContext_,p=Math.round(t.size[0]*u),x=Math.round(t.size[1]*u),y=d.getWrapX()&&l.canWrapX(),w=y?Je(c):null,R=y?Math.ceil((s[2]-c[2])/w)+1:1;let S=y?Math.floor((s[0]-c[0])/w):0;do{const C=this.getRenderTransform(o,a,h,u,p,x,S*w);e.execute(_,1,C,h,g,void 0,i)}while(++S<R)}setupCompositionContext_(){if(this.opacity_!==1){const e=Ge(this.context.canvas.width,this.context.canvas.height,cn);this.compositionContext_=e}else this.compositionContext_=this.context}releaseCompositionContext_(){if(this.opacity_!==1){const e=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=e,Jn(this.compositionContext_),cn.push(this.compositionContext_.canvas),this.compositionContext_=null}}renderDeclutter(e){this.declutterExecutorGroup&&(this.setupCompositionContext_(),this.renderWorlds(this.declutterExecutorGroup,e,e.declutterTree),this.releaseCompositionContext_())}renderFrame(e,t){const i=e.pixelRatio,s=e.layerStatesArray[e.layerIndex];Vo(this.pixelTransform,1/i,1/i),jo(this.inversePixelTransform,this.pixelTransform);const r=zo(this.pixelTransform);this.useContainer(t,r,this.getBackground(e));const o=this.context,a=o.canvas,l=this.replayGroup_,h=this.declutterExecutorGroup;if((!l||l.isEmpty())&&(!h||h.isEmpty()))return null;const c=Math.round(e.size[0]*i),d=Math.round(e.size[1]*i);a.width!=c||a.height!=d?(a.width=c,a.height=d,a.style.transform!==r&&(a.style.transform=r)):this.containerReused||o.clearRect(0,0,c,d),this.preRender(o,e);const u=e.viewState;u.projection,this.opacity_=s.opacity,this.setupCompositionContext_();let f=!1,g=!0;if(s.extent&&this.clipping){const _=Yo(s.extent);g=te(_,e.extent),f=g&&!Ye(_,e.extent),f&&this.clipUnrotated(this.compositionContext_,e,_)}return g&&this.renderWorlds(l,e),f&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(o,e),this.renderedRotation_!==u.rotation&&(this.renderedRotation_=u.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(e){return new Promise(t=>{if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const i=[this.context.canvas.width,this.context.canvas.height];qe(this.pixelTransform,i);const s=this.renderedCenter_,r=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,h=this.getLayer(),c=[],d=i[0]*ge,u=i[1]*ge;c.push(this.getRenderTransform(s,r,o,ge,d,u,0).slice());const f=h.getSource(),g=a.getExtent();if(f.getWrapX()&&a.canWrapX()&&!Ye(g,l)){let _=l[0];const p=Je(g);let x=0,y;for(;_<g[0];)--x,y=p*x,c.push(this.getRenderTransform(s,r,o,ge,d,u,y).slice()),_+=p;for(x=0,_=l[2];_>g[2];)++x,y=p*x,c.push(this.getRenderTransform(s,r,o,ge,d,u,y).slice()),_-=p}this.hitDetectionImageData_=Er(i,c,this.renderedFeatures_,h.getStyleFunction(),l,r,o)}t(Ir(e,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(e,t,i,s,r){if(!this.replayGroup_)return;const o=t.viewState.resolution,a=t.viewState.rotation,l=this.getLayer(),h={},c=function(f,g,_){const p=j(f),x=h[p];if(x){if(x!==!0&&_<x.distanceSq){if(_===0)return h[p]=!0,r.splice(r.lastIndexOf(x),1),s(f,l,g);x.geometry=g,x.distanceSq=_}}else{if(_===0)return h[p]=!0,s(f,l,g);r.push(h[p]={feature:f,layer:l,geometry:g,distanceSq:_,callback:s})}};let d;const u=[this.replayGroup_];return this.declutterExecutorGroup&&u.push(this.declutterExecutorGroup),u.some(f=>d=f.forEachFeatureAtCoordinate(e,o,a,i,c,f===this.declutterExecutorGroup&&t.declutterTree?t.declutterTree.all().map(g=>g.value):null)),d}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){const t=this.getLayer(),i=t.getSource();if(!i)return!1;const s=e.viewHints[ve.ANIMATING],r=e.viewHints[ve.INTERACTING],o=t.getUpdateWhileAnimating(),a=t.getUpdateWhileInteracting();if(this.ready&&!o&&s||!a&&r)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=e.extent,h=e.viewState,c=h.projection,d=h.resolution,u=e.pixelRatio,f=t.getRevision(),g=t.getRenderBuffer();let _=t.getRenderOrder();_===void 0&&(_=Kl);const p=h.center.slice(),x=De(l,g*d),y=x.slice(),w=[x.slice()],R=c.getExtent();if(i.getWrapX()&&c.canWrapX()&&!Ye(R,e.extent)){const A=Je(R),O=Math.max(Je(x)/2,A);x[0]=R[0]-O,x[2]=R[2]+O,Qn(p,c);const G=Uo(w[0],c);G[0]<R[0]&&G[2]<R[2]?w.push([G[0]+A,G[1],G[2]+A,G[3]]):G[0]>R[0]&&G[2]>R[2]&&w.push([G[0]-A,G[1],G[2]-A,G[3]])}if(this.ready&&this.renderedResolution_==d&&this.renderedRevision_==f&&this.renderedRenderOrder_==_&&Ye(this.wrappedRenderedExtent_,x))return Yi(this.renderedExtent_,y)||(this.hitDetectionImageData_=null,this.renderedExtent_=y),this.renderedCenter_=p,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const S=new Ai(Ss(d,u),x,d,u);let C;this.getLayer().getDeclutter()&&(C=new Ai(Ss(d,u),x,d,u));let b;for(let A=0,O=w.length;A<O;++A)i.loadFeatures(w[A],d,c);const v=Fr(d,u);let L=!0;const T=A=>{let O;const G=A.getStyleFunction()||t.getStyleFunction();if(G&&(O=G(A,d)),O){const D=this.renderFeature(A,v,O,S,b,C);L=L&&!D}},M=Xo(x),W=i.getFeaturesInExtent(M);_&&W.sort(_);for(let A=0,O=W.length;A<O;++A)T(W[A]);this.renderedFeatures_=W,this.ready=L;const V=S.finish(),H=new Gi(x,d,u,i.getOverlaps(),V,t.getRenderBuffer());return C&&(this.declutterExecutorGroup=new Gi(x,d,u,i.getOverlaps(),C.finish(),t.getRenderBuffer())),this.renderedResolution_=d,this.renderedRevision_=f,this.renderedRenderOrder_=_,this.renderedExtent_=y,this.wrappedRenderedExtent_=x,this.renderedCenter_=p,this.renderedProjection_=c,this.replayGroup_=H,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,i,s,r,o){if(!i)return!1;let a=!1;if(Array.isArray(i))for(let l=0,h=i.length;l<h;++l)a=Bi(s,e,i[l],t,this.boundHandleStyleImageChange_,r,o)||a;else a=Bi(s,e,i,t,this.boundHandleStyleImageChange_,r,o);return a}}const rc=nc;class oc extends br{constructor(e){super(e)}createRenderer(){return new rc(this)}}const He=oc;class ac{constructor(e){this.rbush_=new vr(e),this.items_={}}insert(e,t){const i={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(i),this.items_[j(t)]=i}load(e,t){const i=new Array(t.length);for(let s=0,r=t.length;s<r;s++){const o=e[s],a=t[s],l={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};i[s]=l,this.items_[j(a)]=l}this.rbush_.load(i)}remove(e){const t=j(e),i=this.items_[t];return delete this.items_[t],this.rbush_.remove(i)!==null}update(e,t){const i=this.items_[j(t)],s=[i.minX,i.minY,i.maxX,i.maxY];Is(s,e)||(this.remove(t),this.insert(e,t))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(e){const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(t).map(function(s){return s.value})}forEach(e){return this.forEach_(this.getAll(),e)}forEachInExtent(e,t){return this.forEach_(this.getInExtent(e),t)}forEach_(e,t){let i;for(let s=0,r=e.length;s<r;s++)if(i=t(e[s]),i)return i;return i}isEmpty(){return yt(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(e){const t=this.rbush_.toJSON();return ms(t.minX,t.minY,t.maxX,t.maxY,e)}concat(e){this.rbush_.load(e.rbush_.all());for(const t in e.items_)this.items_[t]=e.items_[t]}}const In=ac,pe={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function lc(n,e){return[[-1/0,-1/0,1/0,1/0]]}function cc(n,e){return[n]}let hc=!1;function Mr(n,e,t,i,s,r,o){const a=new XMLHttpRequest;a.open("GET",typeof n=="function"?n(t,i,s):n,!0),e.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=hc,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){const h=e.getType();let c;h=="json"||h=="text"?c=a.responseText:h=="xml"?(c=a.responseXML,c||(c=new DOMParser().parseFromString(a.responseText,"application/xml"))):h=="arraybuffer"&&(c=a.response),c?r(e.readFeatures(c,{extent:t,featureProjection:s}),e.readProjection(c)):o()}else o()},a.onerror=o,a.send()}function Rn(n,e){return function(t,i,s,r,o){const a=this;Mr(n,e,t,i,s,function(l,h){a.addFeatures(l),r!==void 0&&r(l)},o||er)}}class We extends ir{constructor(e,t,i){super(e),this.feature=t,this.features=i}}class dc extends Ho{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:e.wrapX!==void 0?e.wrapX:!0}),this.on,this.once,this.un,this.loader_=er,this.format_=e.format,this.overlaps_=e.overlaps===void 0?!0:e.overlaps,this.url_=e.url,e.loader!==void 0?this.loader_=e.loader:this.url_!==void 0&&(ie(this.format_,7),this.loader_=Rn(this.url_,this.format_)),this.strategy_=e.strategy!==void 0?e.strategy:lc;const t=e.useSpatialIndex!==void 0?e.useSpatialIndex:!0;this.featuresRtree_=t?new In:null,this.loadedExtentsRtree_=new In,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let i,s;Array.isArray(e.features)?s=e.features:e.features&&(i=e.features,s=i.getArray()),!t&&i===void 0&&(i=new tr(s)),s!==void 0&&this.addFeaturesInternal(s),i!==void 0&&this.bindFeaturesCollection_(i)}addFeature(e){this.addFeatureInternal(e),this.changed()}addFeatureInternal(e){const t=j(e);if(!this.addToIndex_(t,e)){this.featuresCollection_&&this.featuresCollection_.remove(e);return}this.setupChangeEvents_(t,e);const i=e.getGeometry();if(i){const s=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(s,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new We(pe.ADDFEATURE,e))}setupChangeEvents_(e,t){this.featureChangeKeys_[e]=[Yt(t,Ce.CHANGE,this.handleFeatureChange_,this),Yt(t,Ko.PROPERTYCHANGE,this.handleFeatureChange_,this)]}addToIndex_(e,t){let i=!0;const s=t.getId();return s!==void 0&&(s.toString()in this.idIndex_?i=!1:this.idIndex_[s.toString()]=t),i&&(ie(!(e in this.uidIndex_),30),this.uidIndex_[e]=t),i}addFeatures(e){this.addFeaturesInternal(e),this.changed()}addFeaturesInternal(e){const t=[],i=[],s=[];for(let r=0,o=e.length;r<o;r++){const a=e[r],l=j(a);this.addToIndex_(l,a)&&i.push(a)}for(let r=0,o=i.length;r<o;r++){const a=i[r],l=j(a);this.setupChangeEvents_(l,a);const h=a.getGeometry();if(h){const c=h.getExtent();t.push(c),s.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(t,s),this.hasListener(pe.ADDFEATURE))for(let r=0,o=i.length;r<o;r++)this.dispatchEvent(new We(pe.ADDFEATURE,i[r]))}bindFeaturesCollection_(e){let t=!1;this.addEventListener(pe.ADDFEATURE,function(i){t||(t=!0,e.push(i.feature),t=!1)}),this.addEventListener(pe.REMOVEFEATURE,function(i){t||(t=!0,e.remove(i.feature),t=!1)}),e.addEventListener(ct.ADD,i=>{t||(t=!0,this.addFeature(i.element),t=!1)}),e.addEventListener(ct.REMOVE,i=>{t||(t=!0,this.removeFeature(i.element),t=!1)}),this.featuresCollection_=e}clear(e){if(e){for(const i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(zt);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const i=s=>{this.removeFeatureInternal(s)};this.featuresRtree_.forEach(i);for(const s in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[s])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const t=new We(pe.CLEAR);this.dispatchEvent(t),this.changed()}forEachFeature(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureAtCoordinateDirect(e,t){const i=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(i,function(s){if(s.getGeometry().intersectsCoordinate(e))return t(s)})}forEachFeatureInExtent(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureIntersectingExtent(e,t){return this.forEachFeatureInExtent(e,function(i){if(i.getGeometry().intersectsExtent(e)){const r=t(i);if(r)return r}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),yt(this.nullGeometryFeatures_)||ye(e,Object.values(this.nullGeometryFeatures_))),e}getFeaturesAtCoordinate(e){const t=[];return this.forEachFeatureAtCoordinateDirect(e,function(i){t.push(i)}),t}getFeaturesInExtent(e,t){if(this.featuresRtree_){if(!(t&&t.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(e);const s=$o(e,t);return[].concat(...s.map(r=>this.featuresRtree_.getInExtent(r)))}else if(this.featuresCollection_)return this.featuresCollection_.getArray().slice(0);return[]}getClosestFeatureToCoordinate(e,t){const i=e[0],s=e[1];let r=null;const o=[NaN,NaN];let a=1/0;const l=[-1/0,-1/0,1/0,1/0];return t=t||ps,this.featuresRtree_.forEachInExtent(l,function(h){if(t(h)){const c=h.getGeometry(),d=a;if(a=c.closestPointXY(i,s,o,a),a<d){r=h;const u=Math.sqrt(a);l[0]=i-u,l[1]=s-u,l[2]=i+u,l[3]=s+u}}}),r}getExtent(e){return this.featuresRtree_.getExtent(e)}getFeatureById(e){const t=this.idIndex_[e.toString()];return t!==void 0?t:null}getFeatureByUid(e){const t=this.uidIndex_[e];return t!==void 0?t:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(e){const t=e.target,i=j(t),s=t.getGeometry();if(!s)i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[i]=t);else{const o=s.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(o,t)):this.featuresRtree_&&this.featuresRtree_.update(o,t)}const r=t.getId();if(r!==void 0){const o=r.toString();this.idIndex_[o]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[o]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[i]=t;this.changed(),this.dispatchEvent(new We(pe.CHANGEFEATURE,t))}hasFeature(e){const t=e.getId();return t!==void 0?t in this.idIndex_:j(e)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&yt(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(e,t,i){const s=this.loadedExtentsRtree_,r=this.strategy_(e,t,i);for(let o=0,a=r.length;o<a;++o){const l=r[o];s.forEachInExtent(l,function(c){return Ye(c.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new We(pe.FEATURESLOADSTART)),this.loader_.call(this,l,t,i,c=>{--this.loadingExtentsCount_,this.dispatchEvent(new We(pe.FEATURESLOADEND,void 0,c))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new We(pe.FEATURESLOADERROR))}),s.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(e){const t=this.loadedExtentsRtree_;let i;t.forEachInExtent(e,function(s){if(Is(s.extent,e))return i=s,!0}),i&&t.remove(i)}removeFeature(e){if(!e)return;const t=j(e);t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e),this.removeFeatureInternal(e)&&this.changed()}removeFeatureInternal(e){const t=j(e),i=this.featureChangeKeys_[t];if(!i)return;i.forEach(zt),delete this.featureChangeKeys_[t];const s=e.getId();return s!==void 0&&delete this.idIndex_[s.toString()],delete this.uidIndex_[t],this.dispatchEvent(new We(pe.REMOVEFEATURE,e)),e}removeFromIdIndex_(e){let t=!1;for(const i in this.idIndex_)if(this.idIndex_[i]===e){delete this.idIndex_[i],t=!0;break}return t}setLoader(e){this.loader_=e}setUrl(e){ie(this.format_,7),this.url_=e,this.setLoader(Rn(e,this.format_))}}const Oe=dc;function uc(n,e){const t=n.canvas;e=e||{};const i=e.pixelRatio||qo,s=e.size;s&&(t.width=s[0]*i,t.height=s[1]*i,t.style.width=s[0]+"px",t.style.height=s[1]+"px");const r=[0,0,t.width,t.height],o=bi(et(),i,i);return new Lr(n,i,r,o,0)}const ee={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class fc extends Hn{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+Zo,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(ee.ELEMENT,this.handleElementChanged),this.addChangeListener(ee.MAP,this.handleMapChanged),this.addChangeListener(ee.OFFSET,this.handleOffsetChanged),this.addChangeListener(ee.POSITION,this.handlePositionChanged),this.addChangeListener(ee.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(ee.ELEMENT)}getId(){return this.id}getMap(){return this.get(ee.MAP)||null}getOffset(){return this.get(ee.OFFSET)}getPosition(){return this.get(ee.POSITION)}getPositioning(){return this.get(ee.POSITIONING)}handleElementChanged(){Jo(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(Qo(this.element),zt(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=Yt(e,ea.POSTRENDER,this.render,this),this.updatePixelPosition();const t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(ee.ELEMENT,e)}setMap(e){this.set(ee.MAP,e)}setOffset(e){this.set(ee.OFFSET,e)}setPosition(e){this.set(ee.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(ee.POSITION))return;const i=this.getRect(t.getTargetElement(),t.getSize()),s=this.getElement(),r=this.getRect(s,[ta(s),ia(s)]);e=e||{};const o=e.margin===void 0?20:e.margin;if(!Ye(i,r)){const a=r[0]-i[0],l=i[2]-r[2],h=r[1]-i[1],c=i[3]-r[3],d=[0,0];if(a<0?d[0]=a-o:l<0&&(d[0]=Math.abs(l)+o),h<0?d[1]=h-o:c<0&&(d[1]=Math.abs(c)+o),d[0]!==0||d[1]!==0){const u=t.getView().getCenterInternal(),f=t.getPixelFromCoordinateInternal(u);if(!f)return;const g=[f[0]+d[0],f[1]+d[1]],_=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(g),duration:_.duration,easing:_.easing})}}}getRect(e,t){const i=e.getBoundingClientRect(),s=i.left+window.pageXOffset,r=i.top+window.pageYOffset;return[s,r,s+t[0],r+t[1]]}setPositioning(e){this.set(ee.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t){this.setVisible(!1);return}const i=e.getPixelFromCoordinate(t),s=e.getSize();this.updateRenderedPosition(i,s)}updateRenderedPosition(e,t){const i=this.element.style,s=this.getOffset(),r=this.getPositioning();this.setVisible(!0);const o=Math.round(e[0]+s[0])+"px",a=Math.round(e[1]+s[1])+"px";let l="0%",h="0%";r=="bottom-right"||r=="center-right"||r=="top-right"?l="-100%":(r=="bottom-center"||r=="center-center"||r=="top-center")&&(l="-50%"),r=="bottom-left"||r=="bottom-center"||r=="bottom-right"?h="-100%":(r=="center-left"||r=="center-center"||r=="center-right")&&(h="-50%");const c=`translate(${l}, ${h}) translate(${o}, ${a})`;this.rendered.transform_!=c&&(this.rendered.transform_=c,i.transform=c)}getOptions(){return this.options}}const Pr=fc,Fn=[];class gc extends sr{constructor(e,t,i,s){super(e,t,{transition:0}),this.context_={},this.executorGroups={},this.declutterExecutorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=s.bind(void 0,this),this.wrappedTileCoord=i}getContext(e){const t=j(e);return t in this.context_||(this.context_[t]=Ge(1,1,Fn)),this.context_[t]}hasContext(e){return j(e)in this.context_}getImage(e){return this.hasContext(e)?this.getContext(e).canvas:null}getReplayState(e){const t=j(e);return t in this.replayState_||(this.replayState_[t]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[t]}load(){this.getSourceTiles()}release(){for(const e in this.context_){const t=this.context_[e];Jn(t),Fn.push(t.canvas),delete this.context_[e]}super.release()}}const mc=gc;let _c=class extends sr{constructor(e,t,i,s,r,o){super(e,t,o),this.extent=null,this.format_=s,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=r,this.url_=i,this.key=i}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==K.IDLE&&(this.setState(K.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(e,t){this.setFeatures(e)}onError(){this.setState(K.ERROR)}setFeatures(e){this.features_=e,this.setState(K.LOADED)}setLoader(e){this.loader_=e}};const pc=_c;class yc extends Oe{constructor(e){super({attributions:e.attributions,wrapX:e.wrapX}),this.resolution=void 0,this.distance=e.distance!==void 0?e.distance:20,this.minDistance=e.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=e.geometryFunction||function(t){const i=t.getGeometry();return ie(i.getType()=="Point",10),i},this.createCustomCluster_=e.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(e.source||null)}clear(e){this.features.length=0,super.clear(e)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(e,t,i){this.source.loadFeatures(e,t,i),t!==this.resolution&&(this.resolution=t,this.refresh())}setDistance(e){this.updateDistance(e,this.minDistance)}setMinDistance(e){this.updateDistance(this.distance,e)}getMinDistance(){return this.minDistance}setSource(e){this.source&&this.source.removeEventListener(Ce.CHANGE,this.boundRefresh_),this.source=e,e&&e.addEventListener(Ce.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(e,t){const i=e===0?0:Math.min(t,e)/e,s=e!==this.distance||this.interpolationRatio!==i;this.distance=e,this.minDistance=t,this.interpolationRatio=i,s&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;const e=pt(),t=this.distance*this.resolution,i=this.source.getFeatures(),s={};for(let r=0,o=i.length;r<o;r++){const a=i[r];if(!(j(a)in s)){const l=this.geometryFunction(a);if(l){const h=l.getCoordinates();nr(h,e),De(e,t,e);const c=this.source.getFeaturesInExtent(e).filter(function(d){const u=j(d);return u in s?!1:(s[u]=!0,!0)});this.features.push(this.createCluster(c,e))}}}}createCluster(e,t){const i=[0,0];for(let a=e.length-1;a>=0;--a){const l=this.geometryFunction(e[a]);l?sa(i,l.getCoordinates()):e.splice(a,1)}na(i,1/e.length);const s=vt(t),r=this.interpolationRatio,o=new Ke([i[0]*(1-r)+s[0]*r,i[1]*(1-r)+s[1]*r]);return this.createCustomCluster_?this.createCustomCluster_(o,e):new Ct({geometry:o,features:e})}}const Dr=yc,Ve=4,kn=[101,101];class xc extends go{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:Un,this.params_=Object.assign({},e.params),this.v13_=!0,this.updateV13_(),this.serverType_=e.serverType,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.image_=null,this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5}getFeatureInfoUrl(e,t,i,s){if(this.url_===void 0)return;const r=ce(i),o=this.getProjection();o&&o!==r&&(t=ra(o,r,e,t),e=rr(e,r,o));const a=ss(e,t,0,kn),l={SERVICE:"WMS",VERSION:fi,REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};Object.assign(l,this.params_,s);const h=hn((e[0]-a[0])/t,Ve),c=hn((a[3]-e[1])/t,Ve);return l[this.v13_?"I":"X"]=h,l[this.v13_?"J":"Y"]=c,this.getRequestUrl_(a,kn,1,o||r,l)}getLegendUrl(e,t){if(this.url_===void 0)return;const i={SERVICE:"WMS",VERSION:fi,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(t===void 0||t.LAYER===void 0){const s=this.params_.LAYERS;if(!(!Array.isArray(s)||s.length===1))return;i.LAYER=s}if(e!==void 0){const s=this.getProjection()?this.getProjection().getMetersPerUnit():1,r=28e-5;i.SCALE=e*s/r}return Object.assign(i,t),Mi(this.url_,i)}getParams(){return this.params_}getImageInternal(e,t,i,s){if(this.url_===void 0)return null;t=this.findNearestResolution(t),i!=1&&(!this.hidpi_||this.serverType_===void 0)&&(i=1);const r=t/i,o=vt(e),a=di(Je(e)/r,Ve),l=di(Wt(e)/r,Ve),h=ss(o,r,0,[a,l]),c=di(this.ratio_*Je(e)/r,Ve),d=di(this.ratio_*Wt(e)/r,Ve),u=ss(o,r,0,[c,d]),f=this.image_;if(f&&this.renderedRevision_==this.getRevision()&&f.getResolution()==t&&f.getPixelRatio()==i&&Ye(f.getExtent(),h))return f;const g={SERVICE:"WMS",VERSION:fi,REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};Object.assign(g,this.params_),this.imageSize_[0]=dn(Je(u)/r,Ve),this.imageSize_[1]=dn(Wt(u)/r,Ve);const _=this.getRequestUrl_(u,this.imageSize_,i,s,g);return this.image_=new oa(u,t,i,_,this.crossOrigin_,this.imageLoadFunction_),this.renderedRevision_=this.getRevision(),this.image_.addEventListener(Ce.CHANGE,this.handleImageChange.bind(this)),this.image_}getImageLoadFunction(){return this.imageLoadFunction_}getRequestUrl_(e,t,i,s,r){if(ie(this.url_!==void 0,9),r[this.v13_?"CRS":"SRS"]=s.getCode(),"STYLES"in this.params_||(r.STYLES=""),i!=1)switch(this.serverType_){case"geoserver":const l=90*i+.5|0;"FORMAT_OPTIONS"in r?r.FORMAT_OPTIONS+=";dpi:"+l:r.FORMAT_OPTIONS="dpi:"+l;break;case"mapserver":r.MAP_RESOLUTION=90*i;break;case"carmentaserver":case"qgis":r.DPI=90*i;break;default:ie(!1,8);break}r.WIDTH=t[0],r.HEIGHT=t[1];const o=s.getAxisOrientation();let a;return this.v13_&&o.substr(0,2)=="ne"?a=[e[1],e[0],e[3],e[2]]:a=e,r.BBOX=a.join(","),Mi(this.url_,r)}getUrl(){return this.url_}setImageLoadFunction(e){this.image_=null,this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.image_=null,this.changed())}updateParams(e){Object.assign(this.params_,e),this.updateV13_(),this.image_=null,this.changed()}updateV13_(){const e=this.params_.VERSION||fi;this.v13_=ll(e,"1.3")>=0}}const Cc=xc;class wc extends aa{constructor(e){const t=e.projection||"EPSG:3857",i=e.extent||la(t),s=e.tileGrid||ca({extent:i,maxResolution:e.maxResolution,maxZoom:e.maxZoom!==void 0?e.maxZoom:22,minZoom:e.minZoom,tileSize:e.tileSize||512});super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,interpolate:!0,opaque:!1,projection:t,state:e.state,tileGrid:s,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:vc,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX===void 0?!0:e.wrapX,transition:e.transition,zDirection:e.zDirection===void 0?1:e.zDirection}),this.format_=e.format?e.format:null,this.sourceTileCache=new ha(this.tileCache.highWaterMark),this.overlaps_=e.overlaps==null?!0:e.overlaps,this.tileClass=e.tileClass?e.tileClass:pc,this.tileGrids_={}}getFeaturesInExtent(e){const t=[],i=this.tileCache;if(i.getCount()===0)return t;const s=da(i.peekFirstKey())[0],r=this.tileGrid;return i.forEach(function(o){if(o.tileCoord[0]!==s||o.getState()!==K.LOADED)return;const a=o.getSourceTiles();for(let l=0,h=a.length;l<h;++l){const c=a[l],d=c.tileCoord;if(te(e,r.getTileCoordExtent(d))){const u=c.getFeatures();if(u)for(let f=0,g=u.length;f<g;++f){const _=u[f],p=_.getGeometry();te(e,p.getExtent())&&t.push(_)}}}}),t}getOverlaps(){return this.overlaps_}clear(){this.tileCache.clear(),this.sourceTileCache.clear()}expireCache(e,t){const i=this.getTileCacheForProjection(e),s=Object.keys(t).reduce((r,o)=>{const a=ua(o),l=i.peek(a);if(l){const h=l.sourceTiles;for(let c=0,d=h.length;c<d;++c)r[h[c].getKey()]=!0}return r},{});super.expireCache(e,t),this.sourceTileCache.expireCache(s)}getSourceTiles(e,t,i){if(i.getState()===K.IDLE){i.setState(K.LOADING);const s=i.wrappedTileCoord,r=this.getTileGridForProjection(t),o=r.getTileCoordExtent(s),a=s[0],l=r.getResolution(a);De(o,-l,o);const h=this.tileGrid,c=h.getExtent();c&&or(o,c,o);const d=h.getZForResolution(l,this.zDirection);h.forEachTileCoord(o,d,u=>{const f=this.tileUrlFunction(u,e,t),g=this.sourceTileCache.containsKey(f)?this.sourceTileCache.get(f):new this.tileClass(u,f?K.IDLE:K.EMPTY,f,this.format_,this.tileLoadFunction);i.sourceTiles.push(g);const _=g.getState();if(_<K.LOADED){const p=x=>{this.handleTileChange(x);const y=g.getState();if(y===K.LOADED||y===K.ERROR){const w=g.getKey();w in i.errorTileKeys?g.getState()===K.LOADED&&delete i.errorTileKeys[w]:i.loadingSourceTiles--,y===K.ERROR?i.errorTileKeys[w]=!0:g.removeEventListener(Ce.CHANGE,p),i.loadingSourceTiles===0&&i.setState(yt(i.errorTileKeys)?K.LOADED:K.ERROR)}};g.addEventListener(Ce.CHANGE,p),i.loadingSourceTiles++}_===K.IDLE&&(g.extent=h.getTileCoordExtent(u),g.projection=t,g.resolution=h.getResolution(u[0]),this.sourceTileCache.set(f,g),g.load())}),i.loadingSourceTiles||i.setState(i.sourceTiles.some(u=>u.getState()===K.ERROR)?K.ERROR:K.LOADED)}return i.sourceTiles}getTile(e,t,i,s,r){const o=fa(e,t,i),a=this.getKey();let l;if(this.tileCache.containsKey(o)&&(l=this.tileCache.get(o),l.key===a))return l;const h=[e,t,i];let c=this.getTileCoordForTileUrlFunction(h,r);const d=this.getTileGrid().getExtent(),u=this.getTileGridForProjection(r);if(c&&d){const _=u.getTileCoordExtent(c);De(_,-u.getResolution(e),_),te(d,_)||(c=null)}let f=!0;if(c!==null){const _=this.tileGrid,p=u.getResolution(e),x=_.getZForResolution(p,1),y=u.getTileCoordExtent(c);De(y,-p,y),_.forEachTileCoord(y,x,w=>{f=f&&!this.tileUrlFunction(w,s,r)})}const g=new mc(h,f?K.EMPTY:K.IDLE,c,this.getSourceTiles.bind(this,s,r));return g.key=a,l?(g.interimTile=l,g.refreshInterimChain(),this.tileCache.replace(o,g)):this.tileCache.set(o,g),g}getTileGridForProjection(e){const t=e.getCode();let i=this.tileGrids_[t];if(!i){const s=this.tileGrid,r=s.getResolutions().slice(),o=r.map(function(h,c){return s.getOrigin(c)}),a=r.map(function(h,c){return s.getTileSize(c)}),l=ga+1;for(let h=r.length;h<l;++h)r.push(r[h-1]/2),o.push(o[h-1]),a.push(a[h-1]);i=new ar({extent:s.getExtent(),origins:o,resolutions:r,tileSizes:a}),this.tileGrids_[t]=i}return i}getTilePixelRatio(e){return e}getTilePixelSize(e,t,i){const s=this.getTileGridForProjection(i),r=mt(s.getTileSize(e),this.tmpSize);return[Math.round(r[0]*t),Math.round(r[1]*t)]}updateCacheSize(e,t){super.updateCacheSize(e*2,t),this.sourceTileCache.highWaterMark=this.getTileCacheForProjection(t).highWaterMark}}const Sc=wc;function vc(n,e){n.setLoader(function(t,i,s){Mr(e,n.getFormat(),t,i,s,n.onLoad.bind(n),n.onError.bind(n))})}class bc extends ar{constructor(e){super({extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes}),this.matrixIds_=e.matrixIds}getMatrixId(e){return this.matrixIds_[e]}getMatrixIds(){return this.matrixIds_}}const Tc=bc;class Lc extends lr{constructor(e){const t=e.requestEncoding!==void 0?e.requestEncoding:"KVP",i=e.tileGrid;let s=e.urls;s===void 0&&e.url!==void 0&&(s=ma(e.url)),super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,urls:s,wrapX:e.wrapX!==void 0?e.wrapX:!1,transition:e.transition,zDirection:e.zDirection}),this.version_=e.version!==void 0?e.version:"1.0.0",this.format_=e.format!==void 0?e.format:"image/jpeg",this.dimensions_=e.dimensions!==void 0?e.dimensions:{},this.layer_=e.layer,this.matrixSet_=e.matrixSet,this.style_=e.style,this.requestEncoding_=t,this.setKey(this.getKeyForDimensions_()),s&&s.length>0&&(this.tileUrlFunction=un(s.map(this.createFromWMTSTemplate.bind(this))))}setUrls(e){this.urls=e;const t=e.join(`
`);this.setTileUrlFunction(un(e.map(this.createFromWMTSTemplate.bind(this))),t)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){const e=this.urls?this.urls.slice(0):[];for(const t in this.dimensions_)e.push(t+"-"+this.dimensions_[t]);return e.join("/")}updateDimensions(e){Object.assign(this.dimensions_,e),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(e){const t=this.requestEncoding_,i={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};t=="KVP"&&Object.assign(i,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),e=t=="KVP"?Mi(e,i):e.replace(/\{(\w+?)\}/g,function(o,a){return a.toLowerCase()in i?i[a.toLowerCase()]:o});const s=this.tileGrid,r=this.dimensions_;return function(o,a,l){if(!o)return;const h={TileMatrix:s.getMatrixId(o[0]),TileCol:o[1],TileRow:o[2]};Object.assign(h,r);let c=e;return t=="KVP"?c=Mi(c,h):c=c.replace(/\{(\w+?)\}/g,function(d,u){return h[u]}),c}}}const Ec=Lc;class Ic{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.supportedMediaTypes=null}getReadOptions(e,t){if(t){let i=t.dataProjection?ce(t.dataProjection):this.readProjection(e);t.extent&&i&&i.getUnits()==="tile-pixels"&&(i=ce(i),i.setWorldExtent(t.extent)),t={dataProjection:i,featureProjection:t.featureProjection}}return this.adaptOptions(t)}adaptOptions(e){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},e)}getType(){return q()}readFeature(e,t){return q()}readFeatures(e,t){return q()}readGeometry(e,t){return q()}readProjection(e){return q()}writeFeature(e,t){return q()}writeFeatures(e,t){return q()}writeGeometry(e,t){return q()}}const Or=Ic;function Ns(n,e,t){const i=t?ce(t.featureProjection):null,s=t?ce(t.dataProjection):null;let r;if(i&&s&&!_a(i,s)?r=(e?n.clone():n).transform(e?i:s,e?s:i):r=n,e&&t&&t.decimals!==void 0){const o=Math.pow(10,t.decimals),a=function(l){for(let h=0,c=l.length;h<c;++h)l[h]=Math.round(l[h]*o)/o;return l};r===n&&(r=n.clone()),r.applyTransform(a)}return r}class Ni extends ei{constructor(e,t,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(e[0]))this.setCoordinates(e,t);else if(t!==void 0&&i)this.setFlatCoordinates(t,e),this.ends_=i;else{let s=this.getLayout();const r=e,o=[],a=[];for(let l=0,h=r.length;l<h;++l){const c=r[l];l===0&&(s=c.getLayout()),ye(o,c.getFlatCoordinates()),a.push(o.length)}this.setFlatCoordinates(s,o),this.ends_=a}}appendLineString(e){this.flatCoordinates?ye(this.flatCoordinates,e.getFlatCoordinates().slice()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new Ni(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,i,s){return s<ti(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(pa(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),ya(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,t,i,s))}getCoordinateAtM(e,t,i){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(t=t!==void 0?t:!1,i=i!==void 0?i:!1,hl(this.flatCoordinates,0,this.ends_,this.stride,e,t,i))}getCoordinates(){return fs(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(e){return e<0||this.ends_.length<=e?null:new Oi(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLineStrings(){const e=this.flatCoordinates,t=this.ends_,i=this.layout,s=[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=t[o],h=new Oi(e.slice(r,l),i);s.push(h),r=l}return s}getFlatMidpoints(){const e=[],t=this.flatCoordinates;let i=0;const s=this.ends_,r=this.stride;for(let o=0,a=s.length;o<a;++o){const l=s[o],h=Pi(t,i,l,r,.5);ye(e,h),i=l}return e}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=xa(this.flatCoordinates,0,this.ends_,this.stride,e,t,0,i),new Ni(t,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(e){return Ca(this.flatCoordinates,0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=wa(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}const Ar=Ni;class Ws extends ei{constructor(e,t){super(),t&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendPoint(e){this.flatCoordinates?ye(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.changed()}clone(){const e=new Ws(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,s){if(s<ti(this.getExtent(),e,t))return s;const r=this.flatCoordinates,o=this.stride;for(let a=0,l=r.length;a<l;a+=o){const h=Sa(e,t,r[a],r[a+1]);if(h<s){s=h;for(let c=0;c<o;++c)i[c]=r[a+c];i.length=o}}return s}getCoordinates(){return lt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(e){const t=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return e<0||t<=e?null:new Ke(this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride),this.layout)}getPoints(){const e=this.flatCoordinates,t=this.layout,i=this.stride,s=[];for(let r=0,o=e.length;r<o;r+=i){const a=new Ke(e.slice(r,r+i),t);s.push(a)}return s}getType(){return"MultiPoint"}intersectsExtent(e){const t=this.flatCoordinates,i=this.stride;for(let s=0,r=t.length;s<r;s+=i){const o=t[s],a=t[s+1];if(va(e,o,a))return!0}return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Kn(this.flatCoordinates,0,e,this.stride),this.changed()}}const Vs=Ws;function Gr(n,e,t,i){const s=[];let r=pt();for(let o=0,a=t.length;o<a;++o){const l=t[o];r=cr(n,e,l[0],i),s.push((r[0]+r[2])/2,(r[1]+r[3])/2),e=l[l.length-1]}return s}class Wi extends ei{constructor(e,t,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(e[0])){let s=this.getLayout();const r=e,o=[],a=[];for(let l=0,h=r.length;l<h;++l){const c=r[l];l===0&&(s=c.getLayout());const d=o.length,u=c.getEnds();for(let f=0,g=u.length;f<g;++f)u[f]+=d;ye(o,c.getFlatCoordinates()),a.push(u)}t=s,e=o,i=a}t!==void 0&&i?(this.setFlatCoordinates(t,e),this.endss_=i):this.setCoordinates(e,t)}appendPolygon(e){let t;if(!this.flatCoordinates)this.flatCoordinates=e.getFlatCoordinates().slice(),t=e.getEnds().slice(),this.endss_.push();else{const i=this.flatCoordinates.length;ye(this.flatCoordinates,e.getFlatCoordinates()),t=e.getEnds().slice();for(let s=0,r=t.length;s<r;++s)t[s]+=i}this.endss_.push(t),this.changed()}clone(){const e=this.endss_.length,t=new Array(e);for(let s=0;s<e;++s)t[s]=this.endss_[s].slice();const i=new Wi(this.flatCoordinates.slice(),this.layout,t);return i.applyProperties(this),i}closestPointXY(e,t,i,s){return s<ti(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ba(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ta(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,e,t,i,s))}containsXY(e,t){return La(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,t)}getArea(){return Ea(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),fn(t,0,this.endss_,this.stride,e)):t=this.flatCoordinates,gs(t,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const e=Gr(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=hr(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new Vs(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;Ia(e,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=fn(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=Ra(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(e),t,0,i),new Wi(t,"XY",i)}getPolygon(e){if(e<0||this.endss_.length<=e)return null;let t;if(e===0)t=0;else{const r=this.endss_[e-1];t=r[r.length-1]}const i=this.endss_[e].slice(),s=i[i.length-1];if(t!==0)for(let r=0,o=i.length;r<o;++r)i[r]-=t;return new Ri(this.flatCoordinates.slice(t,s),this.layout,i)}getPolygons(){const e=this.layout,t=this.flatCoordinates,i=this.endss_,s=[];let r=0;for(let o=0,a=i.length;o<a;++o){const l=i[o].slice(),h=l[l.length-1];if(r!==0)for(let d=0,u=l.length;d<u;++d)l[d]-=r;const c=new Ri(t.slice(r,h),e,l);s.push(c),r=h}return s}getType(){return"MultiPolygon"}intersectsExtent(e){return Fa(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=ka(this.flatCoordinates,0,e,this.stride,this.endss_);if(i.length===0)this.flatCoordinates.length=0;else{const s=i[i.length-1];this.flatCoordinates.length=s.length===0?0:s[s.length-1]}this.changed()}}const Br=Wi;var js={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */js.read=function(n,e,t,i,s){var r,o,a=s*8-i-1,l=(1<<a)-1,h=l>>1,c=-7,d=t?s-1:0,u=t?-1:1,f=n[e+d];for(d+=u,r=f&(1<<-c)-1,f>>=-c,c+=a;c>0;r=r*256+n[e+d],d+=u,c-=8);for(o=r&(1<<-c)-1,r>>=-c,c+=i;c>0;o=o*256+n[e+d],d+=u,c-=8);if(r===0)r=1-h;else{if(r===l)return o?NaN:(f?-1:1)*(1/0);o=o+Math.pow(2,i),r=r-h}return(f?-1:1)*o*Math.pow(2,r-i)};js.write=function(n,e,t,i,s,r){var o,a,l,h=r*8-s-1,c=(1<<h)-1,d=c>>1,u=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:r-1,g=i?1:-1,_=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=c):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+d>=1?e+=u/l:e+=u*Math.pow(2,1-d),e*l>=2&&(o++,l/=2),o+d>=c?(a=0,o=c):o+d>=1?(a=(e*l-1)*Math.pow(2,s),o=o+d):(a=e*Math.pow(2,d-1)*Math.pow(2,s),o=0));s>=8;n[t+f]=a&255,f+=g,a/=256,s-=8);for(o=o<<s|a,h+=s;h>0;n[t+f]=o&255,f+=g,o/=256,h-=8);n[t+f-g]|=_*128};var Rc=X,pi=js;function X(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}X.Varint=0;X.Fixed64=1;X.Bytes=2;X.Fixed32=5;var vs=65536*65536,Mn=1/vs,Fc=12,Nr=typeof TextDecoder>"u"?null:new TextDecoder("utf8");X.prototype={destroy:function(){this.buf=null},readFields:function(n,e,t){for(t=t||this.length;this.pos<t;){var i=this.readVarint(),s=i>>3,r=this.pos;this.type=i&7,n(s,e,this),this.pos===r&&this.skip(i)}return e},readMessage:function(n,e){return this.readFields(n,e,this.readVarint()+this.pos)},readFixed32:function(){var n=yi(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=Dn(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=yi(this.buf,this.pos)+yi(this.buf,this.pos+4)*vs;return this.pos+=8,n},readSFixed64:function(){var n=yi(this.buf,this.pos)+Dn(this.buf,this.pos+4)*vs;return this.pos+=8,n},readFloat:function(){var n=pi.read(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=pi.read(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var e=this.buf,t,i;return i=e[this.pos++],t=i&127,i<128||(i=e[this.pos++],t|=(i&127)<<7,i<128)||(i=e[this.pos++],t|=(i&127)<<14,i<128)||(i=e[this.pos++],t|=(i&127)<<21,i<128)?t:(i=e[this.pos],t|=(i&15)<<28,kc(t,n,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2===1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=Fc&&Nr?Uc(this.buf,e,n):Yc(this.buf,e,n)},readBytes:function(){var n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e},readPackedVarint:function(n,e){if(this.type!==X.Bytes)return n.push(this.readVarint(e));var t=ke(this);for(n=n||[];this.pos<t;)n.push(this.readVarint(e));return n},readPackedSVarint:function(n){if(this.type!==X.Bytes)return n.push(this.readSVarint());var e=ke(this);for(n=n||[];this.pos<e;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==X.Bytes)return n.push(this.readBoolean());var e=ke(this);for(n=n||[];this.pos<e;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==X.Bytes)return n.push(this.readFloat());var e=ke(this);for(n=n||[];this.pos<e;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==X.Bytes)return n.push(this.readDouble());var e=ke(this);for(n=n||[];this.pos<e;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==X.Bytes)return n.push(this.readFixed32());var e=ke(this);for(n=n||[];this.pos<e;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==X.Bytes)return n.push(this.readSFixed32());var e=ke(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==X.Bytes)return n.push(this.readFixed64());var e=ke(this);for(n=n||[];this.pos<e;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==X.Bytes)return n.push(this.readSFixed64());var e=ke(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed64());return n},skip:function(n){var e=n&7;if(e===X.Varint)for(;this.buf[this.pos++]>127;);else if(e===X.Bytes)this.pos=this.readVarint()+this.pos;else if(e===X.Fixed32)this.pos+=4;else if(e===X.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(n,e){this.writeVarint(n<<3|e)},realloc:function(n){for(var e=this.length||16;e<this.pos+n;)e*=2;if(e!==this.length){var t=new Uint8Array(e);t.set(this.buf),this.buf=t,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),ot(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),ot(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),ot(this.buf,n&-1,this.pos),ot(this.buf,Math.floor(n*Mn),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),ot(this.buf,n&-1,this.pos),ot(this.buf,Math.floor(n*Mn),this.pos+4),this.pos+=8},writeVarint:function(n){if(n=+n||0,n>268435455||n<0){Mc(n,this);return}this.realloc(4),this.buf[this.pos++]=n&127|(n>127?128:0),!(n<=127)&&(this.buf[this.pos++]=(n>>>=7)&127|(n>127?128:0),!(n<=127)&&(this.buf[this.pos++]=(n>>>=7)&127|(n>127?128:0),!(n<=127)&&(this.buf[this.pos++]=n>>>7&127)))},writeSVarint:function(n){this.writeVarint(n<0?-n*2-1:n*2)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(n.length*4),this.pos++;var e=this.pos;this.pos=Xc(this.buf,n,this.pos);var t=this.pos-e;t>=128&&Pn(e,t,this),this.pos=e-1,this.writeVarint(t),this.pos+=t},writeFloat:function(n){this.realloc(4),pi.write(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),pi.write(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var e=n.length;this.writeVarint(e),this.realloc(e);for(var t=0;t<e;t++)this.buf[this.pos++]=n[t]},writeRawMessage:function(n,e){this.pos++;var t=this.pos;n(e,this);var i=this.pos-t;i>=128&&Pn(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeMessage:function(n,e,t){this.writeTag(n,X.Bytes),this.writeRawMessage(e,t)},writePackedVarint:function(n,e){e.length&&this.writeMessage(n,Oc,e)},writePackedSVarint:function(n,e){e.length&&this.writeMessage(n,Ac,e)},writePackedBoolean:function(n,e){e.length&&this.writeMessage(n,Nc,e)},writePackedFloat:function(n,e){e.length&&this.writeMessage(n,Gc,e)},writePackedDouble:function(n,e){e.length&&this.writeMessage(n,Bc,e)},writePackedFixed32:function(n,e){e.length&&this.writeMessage(n,Wc,e)},writePackedSFixed32:function(n,e){e.length&&this.writeMessage(n,Vc,e)},writePackedFixed64:function(n,e){e.length&&this.writeMessage(n,jc,e)},writePackedSFixed64:function(n,e){e.length&&this.writeMessage(n,zc,e)},writeBytesField:function(n,e){this.writeTag(n,X.Bytes),this.writeBytes(e)},writeFixed32Field:function(n,e){this.writeTag(n,X.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(n,e){this.writeTag(n,X.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(n,e){this.writeTag(n,X.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(n,e){this.writeTag(n,X.Fixed64),this.writeSFixed64(e)},writeVarintField:function(n,e){this.writeTag(n,X.Varint),this.writeVarint(e)},writeSVarintField:function(n,e){this.writeTag(n,X.Varint),this.writeSVarint(e)},writeStringField:function(n,e){this.writeTag(n,X.Bytes),this.writeString(e)},writeFloatField:function(n,e){this.writeTag(n,X.Fixed32),this.writeFloat(e)},writeDoubleField:function(n,e){this.writeTag(n,X.Fixed64),this.writeDouble(e)},writeBooleanField:function(n,e){this.writeVarintField(n,!!e)}};function kc(n,e,t){var i=t.buf,s,r;if(r=i[t.pos++],s=(r&112)>>4,r<128||(r=i[t.pos++],s|=(r&127)<<3,r<128)||(r=i[t.pos++],s|=(r&127)<<10,r<128)||(r=i[t.pos++],s|=(r&127)<<17,r<128)||(r=i[t.pos++],s|=(r&127)<<24,r<128)||(r=i[t.pos++],s|=(r&1)<<31,r<128))return rt(n,s,e);throw new Error("Expected varint not more than 10 bytes")}function ke(n){return n.type===X.Bytes?n.readVarint()+n.pos:n.pos+1}function rt(n,e,t){return t?e*4294967296+(n>>>0):(e>>>0)*4294967296+(n>>>0)}function Mc(n,e){var t,i;if(n>=0?(t=n%4294967296|0,i=n/4294967296|0):(t=~(-n%4294967296),i=~(-n/4294967296),t^4294967295?t=t+1|0:(t=0,i=i+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),Pc(t,i,e),Dc(i,e)}function Pc(n,e,t){t.buf[t.pos++]=n&127|128,n>>>=7,t.buf[t.pos++]=n&127|128,n>>>=7,t.buf[t.pos++]=n&127|128,n>>>=7,t.buf[t.pos++]=n&127|128,n>>>=7,t.buf[t.pos]=n&127}function Dc(n,e){var t=(n&7)<<4;e.buf[e.pos++]|=t|((n>>>=3)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127)))))}function Pn(n,e,t){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));t.realloc(i);for(var s=t.pos-1;s>=n;s--)t.buf[s+i]=t.buf[s]}function Oc(n,e){for(var t=0;t<n.length;t++)e.writeVarint(n[t])}function Ac(n,e){for(var t=0;t<n.length;t++)e.writeSVarint(n[t])}function Gc(n,e){for(var t=0;t<n.length;t++)e.writeFloat(n[t])}function Bc(n,e){for(var t=0;t<n.length;t++)e.writeDouble(n[t])}function Nc(n,e){for(var t=0;t<n.length;t++)e.writeBoolean(n[t])}function Wc(n,e){for(var t=0;t<n.length;t++)e.writeFixed32(n[t])}function Vc(n,e){for(var t=0;t<n.length;t++)e.writeSFixed32(n[t])}function jc(n,e){for(var t=0;t<n.length;t++)e.writeFixed64(n[t])}function zc(n,e){for(var t=0;t<n.length;t++)e.writeSFixed64(n[t])}function yi(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+n[e+3]*16777216}function ot(n,e,t){n[t]=e,n[t+1]=e>>>8,n[t+2]=e>>>16,n[t+3]=e>>>24}function Dn(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+(n[e+3]<<24)}function Yc(n,e,t){for(var i="",s=e;s<t;){var r=n[s],o=null,a=r>239?4:r>223?3:r>191?2:1;if(s+a>t)break;var l,h,c;a===1?r<128&&(o=r):a===2?(l=n[s+1],(l&192)===128&&(o=(r&31)<<6|l&63,o<=127&&(o=null))):a===3?(l=n[s+1],h=n[s+2],(l&192)===128&&(h&192)===128&&(o=(r&15)<<12|(l&63)<<6|h&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):a===4&&(l=n[s+1],h=n[s+2],c=n[s+3],(l&192)===128&&(h&192)===128&&(c&192)===128&&(o=(r&15)<<18|(l&63)<<12|(h&63)<<6|c&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,a=1):o>65535&&(o-=65536,i+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),i+=String.fromCharCode(o),s+=a}return i}function Uc(n,e,t){return Nr.decode(n.subarray(e,t))}function Xc(n,e,t){for(var i=0,s,r;i<e.length;i++){if(s=e.charCodeAt(i),s>55295&&s<57344)if(r)if(s<56320){n[t++]=239,n[t++]=191,n[t++]=189,r=s;continue}else s=r-55296<<10|s-56320|65536,r=null;else{s>56319||i+1===e.length?(n[t++]=239,n[t++]=191,n[t++]=189):r=s;continue}else r&&(n[t++]=239,n[t++]=191,n[t++]=189,r=null);s<128?n[t++]=s:(s<2048?n[t++]=s>>6|192:(s<65536?n[t++]=s>>12|224:(n[t++]=s>>18|240,n[t++]=s>>12&63|128),n[t++]=s>>6&63|128),n[t++]=s&63|128)}return t}const Hc=tl(Rc);class Vi extends ys{constructor(e){super(),this.geometries_=e||null,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(zt),this.changeEventsKeys_.length=0}listenGeometriesChange_(){if(this.geometries_)for(let e=0,t=this.geometries_.length;e<t;++e)this.changeEventsKeys_.push(Yt(this.geometries_[e],Ce.CHANGE,this.changed,this))}clone(){const e=new Vi(null);return e.setGeometries(this.geometries_),e.applyProperties(this),e}closestPointXY(e,t,i,s){if(s<ti(this.getExtent(),e,t))return s;const r=this.geometries_;for(let o=0,a=r.length;o<a;++o)s=r[o].closestPointXY(e,t,i,s);return s}containsXY(e,t){const i=this.geometries_;for(let s=0,r=i.length;s<r;++s)if(i[s].containsXY(e,t))return!0;return!1}computeExtent(e){Ma(e);const t=this.geometries_;for(let i=0,s=t.length;i<s;++i)Pa(e,t[i].getExtent());return e}getGeometries(){return On(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let e=[];const t=this.geometries_;for(let i=0,s=t.length;i<s;++i)t[i].getType()===this.getType()?e=e.concat(t[i].getGeometriesArrayRecursive()):e.push(t[i]);return e}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=[],i=this.geometries_;let s=!1;for(let r=0,o=i.length;r<o;++r){const a=i[r],l=a.getSimplifiedGeometry(e);t.push(l),l!==a&&(s=!0)}if(s){const r=new Vi(null);return r.setGeometriesArray(t),r}return this.simplifiedGeometryMaxMinSquaredTolerance=e,this}getType(){return"GeometryCollection"}intersectsExtent(e){const t=this.geometries_;for(let i=0,s=t.length;i<s;++i)if(t[i].intersectsExtent(e))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(e,t){const i=this.geometries_;for(let s=0,r=i.length;s<r;++s)i[s].rotate(e,t);this.changed()}scale(e,t,i){i||(i=vt(this.getExtent()));const s=this.geometries_;for(let r=0,o=s.length;r<o;++r)s[r].scale(e,t,i);this.changed()}setGeometries(e){this.setGeometriesArray(On(e))}setGeometriesArray(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()}applyTransform(e){const t=this.geometries_;for(let i=0,s=t.length;i<s;++i)t[i].applyTransform(e);this.changed()}translate(e,t){const i=this.geometries_;for(let s=0,r=i.length;s<r;++s)i[s].translate(e,t);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function On(n){const e=[];for(let t=0,i=n.length;t<i;++t)e.push(n[t].clone());return e}const Kc=Vi,An=et();class Qt{constructor(e,t,i,s,r){this.styleFunction,this.extent_,this.id_=r,this.type_=e,this.flatCoordinates_=t,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=i,this.properties_=s}get(e){return this.properties_[e]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?nr(this.flatCoordinates_):cr(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const e=vt(this.getExtent());this.flatInteriorPoints_=Da(this.flatCoordinates_,0,this.ends_,2,e,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const e=Gr(this.flatCoordinates_,0,this.ends_,2);this.flatInteriorPoints_=hr(this.flatCoordinates_,0,this.ends_,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=Pi(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const e=this.flatCoordinates_;let t=0;const i=this.ends_;for(let s=0,r=i.length;s<r;++s){const o=i[s],a=Pi(e,t,o,2,.5);ye(this.flatMidpoints_,a),t=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(e){return this}simplifyTransformed(e,t){return this}getProperties(){return this.properties_}getStride(){return 2}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(e){e=ce(e);const t=e.getExtent(),i=e.getWorldExtent();if(t&&i){const s=Wt(i)/Wt(t);Ui(An,i[0],i[3],s,-s,0,0,0),ft(this.flatCoordinates_,0,this.flatCoordinates_.length,2,An,this.flatCoordinates_)}}getEnds(){return this.ends_}}Qt.prototype.getEndss=Qt.prototype.getEnds;Qt.prototype.getFlatCoordinates=Qt.prototype.getOrientedFlatCoordinates;const Gn=Qt;class $c extends Or{constructor(e){super(),e=e||{},this.dataProjection=new Oa({code:"",units:"tile-pixels"}),this.featureClass_=e.featureClass?e.featureClass:Gn,this.geometryName_=e.geometryName,this.layerName_=e.layerName?e.layerName:"layer",this.layers_=e.layers?e.layers:null,this.idProperty_=e.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(e,t,i,s){e.pos=t.geometry;const r=e.readVarint()+e.pos;let o=1,a=0,l=0,h=0,c=0,d=0;for(;e.pos<r;){if(!a){const u=e.readVarint();o=u&7,a=u>>3}a--,o===1||o===2?(l+=e.readSVarint(),h+=e.readSVarint(),o===1&&c>d&&(s.push(c),d=c),i.push(l,h),c+=2):o===7?c>d&&(i.push(i[d],i[d+1]),c+=2):ie(!1,59)}c>d&&(s.push(c),d=c)}createFeature_(e,t,i){const s=t.type;if(s===0)return null;let r;const o=t.properties;let a;this.idProperty_?(a=o[this.idProperty_],delete o[this.idProperty_]):a=t.id,o[this.layerName_]=t.layer.name;const l=[],h=[];this.readRawGeometry_(e,t,l,h);const c=eh(s,h.length);if(this.featureClass_===Gn)r=new this.featureClass_(c,l,h,o,a),r.transform(i.dataProjection);else{let d;if(c=="Polygon"){const g=Aa(l,h);d=g.length>1?new Br(l,"XY",g):new Ri(l,"XY",h)}else d=c==="Point"?new Ke(l,"XY"):c==="LineString"?new Oi(l,"XY"):c==="MultiPoint"?new Vs(l,"XY"):c==="MultiLineString"?new Ar(l,"XY",h):null;const u=this.featureClass_;r=new u,this.geometryName_&&r.setGeometryName(this.geometryName_);const f=Ns(d,!1,i);r.setGeometry(f),a!==void 0&&r.setId(a),r.setProperties(o,!0)}return r}getType(){return"arraybuffer"}readFeatures(e,t){const i=this.layers_;t=this.adaptOptions(t);const s=ce(t.dataProjection);s.setWorldExtent(t.extent),t.dataProjection=s;const r=new Hc(e),o=r.readFields(qc,{}),a=[];for(const l in o){if(i&&!i.includes(l))continue;const h=o[l],c=h?[0,0,h.extent,h.extent]:null;s.setExtent(c);for(let d=0,u=h.length;d<u;++d){const f=Qc(r,h,d),g=this.createFeature_(r,f,t);g!==null&&a.push(g)}}return a}readProjection(e){return this.dataProjection}setLayers(e){this.layers_=e}}function qc(n,e,t){if(n===3){const i={keys:[],values:[],features:[]},s=t.readVarint()+t.pos;t.readFields(Zc,i,s),i.length=i.features.length,i.length&&(e[i.name]=i)}}function Zc(n,e,t){if(n===15)e.version=t.readVarint();else if(n===1)e.name=t.readString();else if(n===5)e.extent=t.readVarint();else if(n===2)e.features.push(t.pos);else if(n===3)e.keys.push(t.readString());else if(n===4){let i=null;const s=t.readVarint()+t.pos;for(;t.pos<s;)n=t.readVarint()>>3,i=n===1?t.readString():n===2?t.readFloat():n===3?t.readDouble():n===4?t.readVarint64():n===5?t.readVarint():n===6?t.readSVarint():n===7?t.readBoolean():null;e.values.push(i)}}function Jc(n,e,t){if(n==1)e.id=t.readVarint();else if(n==2){const i=t.readVarint()+t.pos;for(;t.pos<i;){const s=e.layer.keys[t.readVarint()],r=e.layer.values[t.readVarint()];e.properties[s]=r}}else n==3?e.type=t.readVarint():n==4&&(e.geometry=t.pos)}function Qc(n,e,t){n.pos=e.features[t];const i=n.readVarint()+n.pos,s={layer:e,type:0,properties:{}};return n.readFields(Jc,s,i),s}function eh(n,e){let t;return n===1?t=e===1?"Point":"MultiPoint":n===2?t=e===1?"LineString":"MultiLineString":n===3&&(t="Polygon"),t}const th=$c,ih={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},sh={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class nh extends Ga{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.tmpTransform_=et()}prepareTile(e,t,i){let s;const r=e.getState();return(r===K.LOADED||r===K.ERROR)&&(this.updateExecutorGroup_(e,t,i),this.tileImageNeedsRender_(e)&&(s=!0)),s}getTile(e,t,i,s){const r=s.pixelRatio,o=s.viewState,a=o.resolution,l=o.projection,h=this.getLayer(),c=h.getSource().getTile(e,t,i,r,l),d=s.viewHints,u=!(d[ve.ANIMATING]||d[ve.INTERACTING]);return(u||!c.wantedResolution)&&(c.wantedResolution=a),this.prepareTile(c,r,l)&&(u||Date.now()-s.time<8)&&h.getRenderMode()!=="vector"&&this.renderTileImage_(c,s),super.getTile(e,t,i,s)}isDrawableTile(e){const t=this.getLayer();return super.isDrawableTile(e)&&(t.getRenderMode()==="vector"?j(t)in e.executorGroups:e.hasContext(t))}getTileImage(e){return e.getImage(this.getLayer())}prepareFrame(e){const t=this.getLayer().getRevision();return this.renderedLayerRevision_!==t&&(this.renderedLayerRevision_=t,this.renderedTiles.length=0),super.prepareFrame(e)}updateExecutorGroup_(e,t,i){const s=this.getLayer(),r=s.getRevision(),o=s.getRenderOrder()||null,a=e.wantedResolution,l=e.getReplayState(s);if(!l.dirty&&l.renderedResolution===a&&l.renderedRevision==r&&l.renderedRenderOrder==o)return;const h=s.getSource(),c=s.getDeclutter(),d=h.getTileGrid(),f=h.getTileGridForProjection(i).getTileCoordExtent(e.wrappedTileCoord),g=h.getSourceTiles(t,i,e),_=j(s);delete e.hitDetectionImageData[_],e.executorGroups[_]=[],c&&(e.declutterExecutorGroups[_]=[]),l.dirty=!1;for(let p=0,x=g.length;p<x;++p){const y=g[p];if(y.getState()!=K.LOADED)continue;const w=y.tileCoord,R=d.getTileCoordExtent(w),S=or(f,R),C=De(S,s.getRenderBuffer()*a,this.tmpExtent),b=Is(R,S)?null:C,v=new Ai(0,C,a,t),L=c?new Ai(0,S,a,t):void 0,T=Fr(a,t),M=function(O){let G;const D=O.getStyleFunction()||s.getStyleFunction();if(D&&(G=D(O,a)),G){const U=this.renderFeature(O,T,G,v,L);l.dirty=l.dirty||U}},W=y.getFeatures();o&&o!==l.renderedRenderOrder&&W.sort(o);for(let O=0,G=W.length;O<G;++O){const D=W[O];(!b||te(b,D.getGeometry().getExtent()))&&M.call(this,D)}const V=v.finish(),H=s.getRenderMode()!=="vector"&&c&&g.length===1?null:S,A=new Gi(H,a,t,h.getOverlaps(),V,s.getRenderBuffer());if(e.executorGroups[_].push(A),L){const O=new Gi(null,a,t,h.getOverlaps(),L.finish(),s.getRenderBuffer());e.declutterExecutorGroups[_].push(O)}}l.renderedRevision=r,l.renderedRenderOrder=o,l.renderedResolution=a}forEachFeatureAtCoordinate(e,t,i,s,r){const o=t.viewState.resolution,a=t.viewState.rotation;i=i??0;const l=this.getLayer(),c=l.getSource().getTileGridForProjection(t.viewState.projection),d=dr([e]);De(d,o*i,d);const u={},f=function(p,x,y){let w=p.getId();w===void 0&&(w=j(p));const R=u[w];if(R){if(R!==!0&&y<R.distanceSq){if(y===0)return u[w]=!0,r.splice(r.lastIndexOf(R),1),s(p,l,x);R.geometry=x,R.distanceSq=y}}else{if(y===0)return u[w]=!0,s(p,l,x);r.push(u[w]={feature:p,layer:l,geometry:x,distanceSq:y,callback:s})}},g=this.renderedTiles;let _;for(let p=0,x=g.length;!_&&p<x;++p){const y=g[p],w=c.getTileCoordExtent(y.wrappedTileCoord);if(!te(w,d))continue;const R=j(l),S=[y.executorGroups[R]],C=y.declutterExecutorGroups[R];C&&S.push(C),S.some(b=>{const v=b===C?t.declutterTree.all().map(L=>L.value):null;for(let L=0,T=b.length;L<T;++L)if(_=b[L].forEachFeatureAtCoordinate(e,o,a,i,f,v),_)return!0})}return _}getFeatures(e){return new Promise((t,i)=>{const s=this.getLayer(),r=j(s),o=s.getSource(),a=this.renderedProjection,l=a.getExtent(),h=this.renderedResolution,c=o.getTileGridForProjection(a),d=qe(this.renderedPixelToCoordinateTransform_,e.slice()),u=c.getTileCoordForCoordAndResolution(d,h);let f;for(let w=0,R=this.renderedTiles.length;w<R;++w)if(u.toString()===this.renderedTiles[w].tileCoord.toString()){if(f=this.renderedTiles[w],f.getState()===K.LOADED){const S=c.getTileCoordExtent(f.tileCoord);o.getWrapX()&&a.canWrapX()&&!Ye(l,S)&&Qn(d,a);break}f=void 0}if(!f||f.loadingSourceTiles>0){t([]);return}const g=c.getTileCoordExtent(f.wrappedTileCoord),_=ur(g),p=[(d[0]-_[0])/h,(_[1]-d[1])/h],x=f.getSourceTiles().reduce(function(w,R){return w.concat(R.getFeatures())},[]);let y=f.hitDetectionImageData[r];if(!y){const w=mt(c.getTileSize(c.getZForResolution(h,o.zDirection))),R=this.renderedRotation_,S=[this.getRenderTransform(c.getTileCoordCenter(f.wrappedTileCoord),h,0,ge,w[0]*ge,w[1]*ge,0)];y=Er(w,S,x,s.getStyleFunction(),c.getTileCoordExtent(f.wrappedTileCoord),f.getReplayState(s).renderedResolution,R),f.hitDetectionImageData[r]=y}t(Ir(p,x,y))})}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.renderedLayerRevision_!==void 0&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}renderDeclutter(e){const t=this.context,i=t.globalAlpha;t.globalAlpha=this.getLayer().getOpacity();const s=e.viewHints,r=!(s[ve.ANIMATING]||s[ve.INTERACTING]),o=this.renderedTiles;for(let a=0,l=o.length;a<l;++a){const h=o[a],c=h.declutterExecutorGroups[j(this.getLayer())];if(c)for(let d=c.length-1;d>=0;--d)c[d].execute(this.context,1,this.getTileRenderTransform(h,e),e.viewState.rotation,r,void 0,e.declutterTree)}t.globalAlpha=i}getTileRenderTransform(e,t){const i=t.pixelRatio,s=t.viewState,r=s.center,o=s.resolution,a=s.rotation,l=t.size,h=Math.round(l[0]*i),c=Math.round(l[1]*i),u=this.getLayer().getSource().getTileGridForProjection(t.viewState.projection),f=e.tileCoord,g=u.getTileCoordExtent(e.wrappedTileCoord),_=u.getTileCoordExtent(f,this.tmpExtent)[0]-g[0];return Ba(bi(this.inversePixelTransform.slice(),1/i,1/i),this.getRenderTransform(r,o,a,i,h,c,_))}postRender(e,t){const i=t.viewHints,s=!(i[ve.ANIMATING]||i[ve.INTERACTING]);this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice(),this.renderedRotation_=t.viewState.rotation;const r=this.getLayer(),o=r.getRenderMode(),a=e.globalAlpha;e.globalAlpha=r.getOpacity();const l=sh[o],h=t.viewState,c=h.rotation,d=r.getSource(),f=d.getTileGridForProjection(h.projection).getZForResolution(h.resolution,d.zDirection),g=this.renderedTiles,_=[],p=[];let x=!0;for(let y=g.length-1;y>=0;--y){const w=g[y];x=x&&!w.getReplayState(r).dirty;const R=w.executorGroups[j(r)].filter(L=>L.hasExecutors(l));if(R.length===0)continue;const S=this.getTileRenderTransform(w,t),C=w.tileCoord[0];let b=!1;const v=R[0].getClipCoords(S);if(v){for(let L=0,T=_.length;L<T;++L)if(f!==C&&C<p[L]){const M=_[L];te([v[0],v[3],v[4],v[7]],[M[0],M[3],M[4],M[7]])&&(b||(e.save(),b=!0),e.beginPath(),e.moveTo(v[0],v[1]),e.lineTo(v[2],v[3]),e.lineTo(v[4],v[5]),e.lineTo(v[6],v[7]),e.moveTo(M[6],M[7]),e.lineTo(M[4],M[5]),e.lineTo(M[2],M[3]),e.lineTo(M[0],M[1]),e.clip())}_.push(v),p.push(C)}for(let L=0,T=R.length;L<T;++L)R[L].execute(e,1,S,c,s,l);b&&e.restore()}e.globalAlpha=a,this.ready=x,super.postRender(e,t)}renderFeature(e,t,i,s,r){if(!i)return!1;let o=!1;if(Array.isArray(i))for(let a=0,l=i.length;a<l;++a)o=Bi(s,e,i[a],t,this.boundHandleStyleImageChange_,void 0,r)||o;else o=Bi(s,e,i,t,this.boundHandleStyleImageChange_,void 0,r);return o}tileImageNeedsRender_(e){const t=this.getLayer();if(t.getRenderMode()==="vector")return!1;const i=e.getReplayState(t),s=t.getRevision(),r=e.wantedResolution;return i.renderedTileResolution!==r||i.renderedTileRevision!==s}renderTileImage_(e,t){const i=this.getLayer(),s=e.getReplayState(i),r=i.getRevision(),o=e.executorGroups[j(i)];s.renderedTileRevision=r;const a=e.wrappedTileCoord,l=a[0],h=i.getSource();let c=t.pixelRatio;const u=t.viewState.projection,f=h.getTileGridForProjection(u),g=f.getResolution(e.tileCoord[0]),_=t.pixelRatio/e.wantedResolution*g,p=f.getResolution(l),x=e.getContext(i);c=Math.round(Math.max(c,_/c));const y=h.getTilePixelSize(l,c,u);x.canvas.width=y[0],x.canvas.height=y[1];const w=c/_;if(w!==1){const b=gn(this.tmpTransform_);bi(b,w,w),x.setTransform.apply(x,b)}const R=f.getTileCoordExtent(a,this.tmpExtent),S=_/p,C=gn(this.tmpTransform_);bi(C,S,-S),Na(C,-R[0],-R[3]);for(let b=0,v=o.length;b<v;++b)o[b].execute(x,w,C,0,!0,ih[i.getRenderMode()]);s.renderedTileResolution=e.wantedResolution}}const rh=nh;class oh extends br{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un;const i=e.renderMode||"hybrid";ie(i=="hybrid"||i=="vector",28),this.renderMode_=i,this.setPreload(e.preload?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new rh(this)}getFeatures(e){return super.getFeatures(e)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(ui.PRELOAD)}getUseInterimTilesOnError(){return this.get(ui.USE_INTERIM_TILES_ON_ERROR)}setPreload(e){this.set(ui.PRELOAD,e)}setUseInterimTilesOnError(e){this.set(ui.USE_INTERIM_TILES_ON_ERROR,e)}}const Wr=oh;class ah extends Or{constructor(){super()}getType(){return"json"}readFeature(e,t){return this.readFeatureFromObject(xi(e),this.getReadOptions(e,t))}readFeatures(e,t){return this.readFeaturesFromObject(xi(e),this.getReadOptions(e,t))}readFeatureFromObject(e,t){return q()}readFeaturesFromObject(e,t){return q()}readGeometry(e,t){return this.readGeometryFromObject(xi(e),this.getReadOptions(e,t))}readGeometryFromObject(e,t){return q()}readProjection(e){return this.readProjectionFromObject(xi(e))}readProjectionFromObject(e){return q()}writeFeature(e,t){return JSON.stringify(this.writeFeatureObject(e,t))}writeFeatureObject(e,t){return q()}writeFeatures(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))}writeFeaturesObject(e,t){return q()}writeGeometry(e,t){return JSON.stringify(this.writeGeometryObject(e,t))}writeGeometryObject(e,t){return q()}}function xi(n){if(typeof n=="string"){const e=JSON.parse(n);return e||null}else if(n!==null)return n;return null}const lh=ah;class ch extends lh{constructor(e){e=e||{},super(),this.dataProjection=ce(e.dataProjection?e.dataProjection:"EPSG:4326"),e.featureProjection&&(this.defaultFeatureProjection=ce(e.featureProjection)),this.geometryName_=e.geometryName,this.extractGeometryName_=e.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(e,t){let i=null;e.type==="Feature"?i=e:i={type:"Feature",geometry:e,properties:null};const s=bs(i.geometry,t),r=new Ct;return this.geometryName_?r.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in i!==void 0&&r.setGeometryName(i.geometry_name),r.setGeometry(s),"id"in i&&r.setId(i.id),i.properties&&r.setProperties(i.properties,!0),r}readFeaturesFromObject(e,t){const i=e;let s=null;if(i.type==="FeatureCollection"){const r=e;s=[];const o=r.features;for(let a=0,l=o.length;a<l;++a)s.push(this.readFeatureFromObject(o[a],t))}else s=[this.readFeatureFromObject(e,t)];return s}readGeometryFromObject(e,t){return bs(e,t)}readProjectionFromObject(e){const t=e.crs;let i;return t?t.type=="name"?i=ce(t.properties.name):t.type==="EPSG"?i=ce("EPSG:"+t.properties.code):ie(!1,36):i=this.dataProjection,i}writeFeatureObject(e,t){t=this.adaptOptions(t);const i={type:"Feature",geometry:null,properties:null},s=e.getId();if(s!==void 0&&(i.id=s),!e.hasProperties())return i;const r=e.getProperties(),o=e.getGeometry();return o&&(i.geometry=Ts(o,t),delete r[e.getGeometryName()]),yt(r)||(i.properties=r),i}writeFeaturesObject(e,t){t=this.adaptOptions(t);const i=[];for(let s=0,r=e.length;s<r;++s)i.push(this.writeFeatureObject(e[s],t));return{type:"FeatureCollection",features:i}}writeGeometryObject(e,t){return Ts(e,this.adaptOptions(t))}}function bs(n,e){if(!n)return null;let t;switch(n.type){case"Point":{t=dh(n);break}case"LineString":{t=uh(n);break}case"Polygon":{t=_h(n);break}case"MultiPoint":{t=gh(n);break}case"MultiLineString":{t=fh(n);break}case"MultiPolygon":{t=mh(n);break}case"GeometryCollection":{t=hh(n);break}default:throw new Error("Unsupported GeoJSON type: "+n.type)}return Ns(t,!1,e)}function hh(n,e){const t=n.geometries.map(function(i){return bs(i,e)});return new Kc(t)}function dh(n){return new Ke(n.coordinates)}function uh(n){return new Oi(n.coordinates)}function fh(n){return new Ar(n.coordinates)}function gh(n){return new Vs(n.coordinates)}function mh(n){return new Br(n.coordinates)}function _h(n){return new Ri(n.coordinates)}function Ts(n,e){n=Ns(n,!0,e);const t=n.getType();let i;switch(t){case"Point":{i=Sh(n);break}case"LineString":{i=yh(n);break}case"Polygon":{i=vh(n,e);break}case"MultiPoint":{i=Ch(n);break}case"MultiLineString":{i=xh(n);break}case"MultiPolygon":{i=wh(n,e);break}case"GeometryCollection":{i=ph(n,e);break}case"Circle":{i={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+t)}return i}function ph(n,e){return e=Object.assign({},e),delete e.featureProjection,{type:"GeometryCollection",geometries:n.getGeometriesArray().map(function(i){return Ts(i,e)})}}function yh(n,e){return{type:"LineString",coordinates:n.getCoordinates()}}function xh(n,e){return{type:"MultiLineString",coordinates:n.getCoordinates()}}function Ch(n,e){return{type:"MultiPoint",coordinates:n.getCoordinates()}}function wh(n,e){let t;return e&&(t=e.rightHanded),{type:"MultiPolygon",coordinates:n.getCoordinates(t)}}function Sh(n,e){return{type:"Point",coordinates:n.getCoordinates()}}function vh(n,e){let t;return e&&(t=e.rightHanded),{type:"Polygon",coordinates:n.getCoordinates(t)}}const cs=ch;function bh(n,e){if(n.match(/^[a-z]+:\/\//i))return n;if(n.match(/^\/\//))return window.location.protocol+n;if(n.match(/^[a-z]+:/i))return n;const t=document.implementation.createHTMLDocument(),i=t.createElement("base"),s=t.createElement("a");return t.head.appendChild(i),t.body.appendChild(s),e&&(i.href=e),s.href=n,s.href}const Th=(()=>{let n=0;const e=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(n+=1,`u${e()}${n}`)})();function Ae(n){const e=[];for(let t=0,i=n.length;t<i;t++)e.push(n[t]);return e}function ji(n,e){const i=(n.ownerDocument.defaultView||window).getComputedStyle(n).getPropertyValue(e);return i?parseFloat(i.replace("px","")):0}function Lh(n){const e=ji(n,"border-left-width"),t=ji(n,"border-right-width");return n.clientWidth+e+t}function Eh(n){const e=ji(n,"border-top-width"),t=ji(n,"border-bottom-width");return n.clientHeight+e+t}function Vr(n,e={}){const t=e.width||Lh(n),i=e.height||Eh(n);return{width:t,height:i}}function Ih(){let n,e;try{e=process}catch{}const t=e&&e.env?e.env.devicePixelRatio:null;return t&&(n=parseInt(t,10),Number.isNaN(n)&&(n=1)),n||window.devicePixelRatio||1}const fe=16384;function Rh(n){(n.width>fe||n.height>fe)&&(n.width>fe&&n.height>fe?n.width>n.height?(n.height*=fe/n.width,n.width=fe):(n.width*=fe/n.height,n.height=fe):n.width>fe?(n.height*=fe/n.width,n.width=fe):(n.width*=fe/n.height,n.height=fe))}function zi(n){return new Promise((e,t)=>{const i=new Image;i.decode=()=>e(i),i.onload=()=>e(i),i.onerror=t,i.crossOrigin="anonymous",i.decoding="async",i.src=n})}async function Fh(n){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(n)).then(encodeURIComponent).then(e=>`data:image/svg+xml;charset=utf-8,${e}`)}async function kh(n,e,t){const i="http://www.w3.org/2000/svg",s=document.createElementNS(i,"svg"),r=document.createElementNS(i,"foreignObject");return s.setAttribute("width",`${e}`),s.setAttribute("height",`${t}`),s.setAttribute("viewBox",`0 0 ${e} ${t}`),r.setAttribute("width","100%"),r.setAttribute("height","100%"),r.setAttribute("x","0"),r.setAttribute("y","0"),r.setAttribute("externalResourcesRequired","true"),s.appendChild(r),r.appendChild(n),Fh(s)}const he=(n,e)=>{if(n instanceof e)return!0;const t=Object.getPrototypeOf(n);return t===null?!1:t.constructor.name===e.name||he(t,e)};function Mh(n){const e=n.getPropertyValue("content");return`${n.cssText} content: '${e.replace(/'|"/g,"")}';`}function Ph(n){return Ae(n).map(e=>{const t=n.getPropertyValue(e),i=n.getPropertyPriority(e);return`${e}: ${t}${i?" !important":""};`}).join(" ")}function Dh(n,e,t){const i=`.${n}:${e}`,s=t.cssText?Mh(t):Ph(t);return document.createTextNode(`${i}{${s}}`)}function Bn(n,e,t){const i=window.getComputedStyle(n,t),s=i.getPropertyValue("content");if(s===""||s==="none")return;const r=Th();try{e.className=`${e.className} ${r}`}catch{return}const o=document.createElement("style");o.appendChild(Dh(r,t,i)),e.appendChild(o)}function Oh(n,e){Bn(n,e,":before"),Bn(n,e,":after")}const Nn="application/font-woff",Wn="image/jpeg",Ah={woff:Nn,woff2:Nn,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:Wn,jpeg:Wn,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function Gh(n){const e=/\.([^./]*?)$/g.exec(n);return e?e[1]:""}function zs(n){const e=Gh(n).toLowerCase();return Ah[e]||""}function Bh(n){return n.split(/,/)[1]}function Ls(n){return n.search(/^(data:)/)!==-1}function jr(n,e){return`data:${e};base64,${n}`}async function zr(n,e,t){const i=await fetch(n,e);if(i.status===404)throw new Error(`Resource "${i.url}" not found`);const s=await i.blob();return new Promise((r,o)=>{const a=new FileReader;a.onerror=o,a.onloadend=()=>{try{r(t({res:i,result:a.result}))}catch(l){o(l)}},a.readAsDataURL(s)})}const hs={};function Nh(n,e,t){let i=n.replace(/\?.*/,"");return t&&(i=n),/ttf|otf|eot|woff2?/i.test(i)&&(i=i.replace(/.*\//,"")),e?`[${e}]${i}`:i}async function Ys(n,e,t){const i=Nh(n,e,t.includeQueryParams);if(hs[i]!=null)return hs[i];t.cacheBust&&(n+=(/\?/.test(n)?"&":"?")+new Date().getTime());let s;try{const r=await zr(n,t.fetchRequestInit,({res:o,result:a})=>(e||(e=o.headers.get("Content-Type")||""),Bh(a)));s=jr(r,e)}catch(r){s=t.imagePlaceholder||"";let o=`Failed to fetch resource: ${n}`;r&&(o=typeof r=="string"?r:r.message),o&&console.warn(o)}return hs[i]=s,s}async function Wh(n){const e=n.toDataURL();return e==="data:,"?n.cloneNode(!1):zi(e)}async function Vh(n,e){if(n.currentSrc){const r=document.createElement("canvas"),o=r.getContext("2d");r.width=n.clientWidth,r.height=n.clientHeight,o==null||o.drawImage(n,0,0,r.width,r.height);const a=r.toDataURL();return zi(a)}const t=n.poster,i=zs(t),s=await Ys(t,i,e);return zi(s)}async function jh(n){var e;try{if(!((e=n==null?void 0:n.contentDocument)===null||e===void 0)&&e.body)return await Hi(n.contentDocument.body,{},!0)}catch{}return n.cloneNode(!1)}async function zh(n,e){return he(n,HTMLCanvasElement)?Wh(n):he(n,HTMLVideoElement)?Vh(n,e):he(n,HTMLIFrameElement)?jh(n):n.cloneNode(!1)}const Yh=n=>n.tagName!=null&&n.tagName.toUpperCase()==="SLOT";async function Uh(n,e,t){var i,s;let r=[];return Yh(n)&&n.assignedNodes?r=Ae(n.assignedNodes()):he(n,HTMLIFrameElement)&&(!((i=n.contentDocument)===null||i===void 0)&&i.body)?r=Ae(n.contentDocument.body.childNodes):r=Ae(((s=n.shadowRoot)!==null&&s!==void 0?s:n).childNodes),r.length===0||he(n,HTMLVideoElement)||await r.reduce((o,a)=>o.then(()=>Hi(a,t)).then(l=>{l&&e.appendChild(l)}),Promise.resolve()),e}function Xh(n,e){const t=e.style;if(!t)return;const i=window.getComputedStyle(n);i.cssText?(t.cssText=i.cssText,t.transformOrigin=i.transformOrigin):Ae(i).forEach(s=>{let r=i.getPropertyValue(s);s==="font-size"&&r.endsWith("px")&&(r=`${Math.floor(parseFloat(r.substring(0,r.length-2)))-.1}px`),he(n,HTMLIFrameElement)&&s==="display"&&r==="inline"&&(r="block"),s==="d"&&e.getAttribute("d")&&(r=`path(${e.getAttribute("d")})`),t.setProperty(s,r,i.getPropertyPriority(s))})}function Hh(n,e){he(n,HTMLTextAreaElement)&&(e.innerHTML=n.value),he(n,HTMLInputElement)&&e.setAttribute("value",n.value)}function Kh(n,e){if(he(n,HTMLSelectElement)){const t=e,i=Array.from(t.children).find(s=>n.value===s.getAttribute("value"));i&&i.setAttribute("selected","")}}function $h(n,e){return he(e,Element)&&(Xh(n,e),Oh(n,e),Hh(n,e),Kh(n,e)),e}async function qh(n,e){const t=n.querySelectorAll?n.querySelectorAll("use"):[];if(t.length===0)return n;const i={};for(let r=0;r<t.length;r++){const a=t[r].getAttribute("xlink:href");if(a){const l=n.querySelector(a),h=document.querySelector(a);!l&&h&&!i[a]&&(i[a]=await Hi(h,e,!0))}}const s=Object.values(i);if(s.length){const r="http://www.w3.org/1999/xhtml",o=document.createElementNS(r,"svg");o.setAttribute("xmlns",r),o.style.position="absolute",o.style.width="0",o.style.height="0",o.style.overflow="hidden",o.style.display="none";const a=document.createElementNS(r,"defs");o.appendChild(a);for(let l=0;l<s.length;l++)a.appendChild(s[l]);n.appendChild(o)}return n}async function Hi(n,e,t){return!t&&e.filter&&!e.filter(n)?null:Promise.resolve(n).then(i=>zh(i,e)).then(i=>Uh(n,i,e)).then(i=>$h(n,i)).then(i=>qh(i,e))}const Yr=/url\((['"]?)([^'"]+?)\1\)/g,Zh=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,Jh=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function Qh(n){const e=n.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${e})(['"]?\\))`,"g")}function ed(n){const e=[];return n.replace(Yr,(t,i,s)=>(e.push(s),t)),e.filter(t=>!Ls(t))}async function td(n,e,t,i,s){try{const r=t?bh(e,t):e,o=zs(e);let a;if(s){const l=await s(r);a=jr(l,o)}else a=await Ys(r,o,i);return n.replace(Qh(e),`$1${a}$3`)}catch{}return n}function id(n,{preferredFontFormat:e}){return e?n.replace(Jh,t=>{for(;;){const[i,,s]=Zh.exec(t)||[];if(!s)return"";if(s===e)return`src: ${i};`}}):n}function Ur(n){return n.search(Yr)!==-1}async function Xr(n,e,t){if(!Ur(n))return n;const i=id(n,t);return ed(i).reduce((r,o)=>r.then(a=>td(a,o,e,t)),Promise.resolve(i))}async function Ci(n,e,t){var i;const s=(i=e.style)===null||i===void 0?void 0:i.getPropertyValue(n);if(s){const r=await Xr(s,null,t);return e.style.setProperty(n,r,e.style.getPropertyPriority(n)),!0}return!1}async function sd(n,e){await Ci("background",n,e)||await Ci("background-image",n,e),await Ci("mask",n,e)||await Ci("mask-image",n,e)}async function nd(n,e){const t=he(n,HTMLImageElement);if(!(t&&!Ls(n.src))&&!(he(n,SVGImageElement)&&!Ls(n.href.baseVal)))return;const i=t?n.src:n.href.baseVal,s=await Ys(i,zs(i),e);await new Promise((r,o)=>{n.onload=r,n.onerror=o;const a=n;a.decode&&(a.decode=r),a.loading==="lazy"&&(a.loading="eager"),t?(n.srcset="",n.src=s):n.href.baseVal=s})}async function rd(n,e){const i=Ae(n.childNodes).map(s=>Hr(s,e));await Promise.all(i).then(()=>n)}async function Hr(n,e){he(n,Element)&&(await sd(n,e),await nd(n,e),await rd(n,e))}function od(n,e){const{style:t}=n;e.backgroundColor&&(t.backgroundColor=e.backgroundColor),e.width&&(t.width=`${e.width}px`),e.height&&(t.height=`${e.height}px`);const i=e.style;return i!=null&&Object.keys(i).forEach(s=>{t[s]=i[s]}),n}const Vn={};async function jn(n){let e=Vn[n];if(e!=null)return e;const i=await(await fetch(n)).text();return e={url:n,cssText:i},Vn[n]=e,e}async function zn(n,e){let t=n.cssText;const i=/url\(["']?([^"')]+)["']?\)/g,r=(t.match(/url\([^)]+\)/g)||[]).map(async o=>{let a=o.replace(i,"$1");return a.startsWith("https://")||(a=new URL(a,n.url).href),zr(a,e.fetchRequestInit,({result:l})=>(t=t.replace(o,`url(${l})`),[o,l]))});return Promise.all(r).then(()=>t)}function Yn(n){if(n==null)return[];const e=[],t=/(\/\*[\s\S]*?\*\/)/gi;let i=n.replace(t,"");const s=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const l=s.exec(i);if(l===null)break;e.push(l[0])}i=i.replace(s,"");const r=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,o="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",a=new RegExp(o,"gi");for(;;){let l=r.exec(i);if(l===null){if(l=a.exec(i),l===null)break;r.lastIndex=a.lastIndex}else a.lastIndex=r.lastIndex;e.push(l[0])}return e}async function ad(n,e){const t=[],i=[];return n.forEach(s=>{if("cssRules"in s)try{Ae(s.cssRules||[]).forEach((r,o)=>{if(r.type===CSSRule.IMPORT_RULE){let a=o+1;const l=r.href,h=jn(l).then(c=>zn(c,e)).then(c=>Yn(c).forEach(d=>{try{s.insertRule(d,d.startsWith("@import")?a+=1:s.cssRules.length)}catch(u){console.error("Error inserting rule from remote css",{rule:d,error:u})}})).catch(c=>{console.error("Error loading remote css",c.toString())});i.push(h)}})}catch(r){const o=n.find(a=>a.href==null)||document.styleSheets[0];s.href!=null&&i.push(jn(s.href).then(a=>zn(a,e)).then(a=>Yn(a).forEach(l=>{o.insertRule(l,s.cssRules.length)})).catch(a=>{console.error("Error loading remote stylesheet",a)})),console.error("Error inlining remote css file",r)}}),Promise.all(i).then(()=>(n.forEach(s=>{if("cssRules"in s)try{Ae(s.cssRules||[]).forEach(r=>{t.push(r)})}catch(r){console.error(`Error while reading CSS rules from ${s.href}`,r)}}),t))}function ld(n){return n.filter(e=>e.type===CSSRule.FONT_FACE_RULE).filter(e=>Ur(e.style.getPropertyValue("src")))}async function cd(n,e){if(n.ownerDocument==null)throw new Error("Provided element is not within a Document");const t=Ae(n.ownerDocument.styleSheets),i=await ad(t,e);return ld(i)}async function hd(n,e){const t=await cd(n,e);return(await Promise.all(t.map(s=>{const r=s.parentStyleSheet?s.parentStyleSheet.href:null;return Xr(s.cssText,r,e)}))).join(`
`)}async function dd(n,e){const t=e.fontEmbedCSS!=null?e.fontEmbedCSS:e.skipFonts?null:await hd(n,e);if(t){const i=document.createElement("style"),s=document.createTextNode(t);i.appendChild(s),n.firstChild?n.insertBefore(i,n.firstChild):n.appendChild(i)}}async function ud(n,e={}){const{width:t,height:i}=Vr(n,e),s=await Hi(n,e,!0);return await dd(s,e),await Hr(s,e),od(s,e),await kh(s,t,i)}async function fd(n,e={}){const{width:t,height:i}=Vr(n,e),s=await ud(n,e),r=await zi(s),o=document.createElement("canvas"),a=o.getContext("2d"),l=e.pixelRatio||Ih(),h=e.canvasWidth||t,c=e.canvasHeight||i;return o.width=h*l,o.height=c*l,e.skipAutoScale||Rh(o),o.style.width=`${h}`,o.style.height=`${c}`,e.backgroundColor&&(a.fillStyle=e.backgroundColor,a.fillRect(0,0,o.width,o.height)),a.drawImage(r,0,0,o.width,o.height),o}async function gd(n,e={}){return(await fd(n,e)).toDataURL()}const Kr="/Map_Demo/assets/currentPosition-33b00a21.svg";const md={props:{coordinate:{type:Object,default:{}}},setup(n,{emit:e}){let t;const i=Le({imgSrc:"dddd"});return Xi(async()=>{t=new Ti({target:"imgMap",layers:[new xt({preload:1/0,crossOrigin:"Anonymous",source:new mo}),new He({source:new Oe({features:[new Ct({geometry:new Ke(n.coordinate),population:4e3,rainfall:500})]}),style:new tt({image:new St({anchor:[.5,100],anchorXUnits:"fraction",anchorYUnits:"pixels",src:Kr})})})],view:new fr({projection:"EPSG:4326",center:n.coordinate,zoom:14})}),t.once("loadend",function(){gd(t.getTargetElement()).then(function(s){document.getElementById("imgMap")!==null&&(document.getElementById("imgMap").remove(),i.imgSrc=s)})})}),{props:n,state:i}}},_d=n=>(bt("data-v-0bd15485"),n=n(),Tt(),n),pd={class:"position-relative",style:{overflow:"hidden"}},yd=_d(()=>m("div",{id:"imgMap",class:"position-absolute",style:{width:"600px",height:"600px"}},null,-1));function xd(n,e,t,i,s,r){return E(),I("div",pd,[yd,m("div",{style:Fi([{background:`url('${i.state.imgSrc}')`,"background-size":"cover"},{width:"100%",height:"200px"}])},null,4)])}const Cd=Te(md,[["render",xd],["__scopeId","data-v-0bd15485"]]),wd="/Map_Demo/assets/vector-a2cf21ef.svg";const Sd={props:{popup:{type:Object,default:{}},closeAreaData:{Type:Function,default:()=>{}},maxHeight:{Type:Number,default:0},coordinate:{type:Object,default:{}}},setup(n,{emit:e}){const t=mr(),i=Le({type:0,media:"photo",scrollY:!1,tribeData:{},showAreaDataWindow:!1,oldPopupId:""});async function s(d){return await Me.ajax({url:`https://api.edtest.site/tribe?tribeCode=${d}`,method:"GET"}).done(f=>f).fail(f=>(i.type=0,n.closeAreaData(),!1))}async function r(d){return await Me.ajax({url:`https://api.edtest.site/historicalDiseaster?id=${d}`,method:"GET"}).done(f=>f).fail(f=>(i.type=0,n.closeAreaData(),!1))}async function o(d){return await Me.ajax({url:`https://api.edtest.site/rainData?stationName=${d}`,method:"GET"}).done(f=>f).fail(f=>(i.type=0,n.closeAreaData(),!1))}async function a(d){return await Me.ajax({url:`https://api.edtest.site/harvestDrill?projNo=${d}`,method:"GET"}).done(f=>f).fail(f=>(i.type=0,n.closeAreaData(),!1))}function l(d){return{basic:d.get("Basin"),full:d.get("Full"),risk:d.get("Risk"),note01:d.get("Note01"),note02:d.get("Note02"),stra_1:d.get("Stra_1"),stra_2:d.get("Stra_2"),link:`https://246.swcb.gov.tw/Content/Debris/${d.get("Debrisno")}.jpg`}}function h(d){return{activity:d.get("ACTIVITY"),slideKind:d.get("SLIDE_KIND"),slideType:d.get("SLOPE_TYPE"),slideAng:d.get("SLUMP_ANG"),identifier:d.get("IDENTIFIER")}}async function c(d){var u;if(d==null){i.type=0,(u=this.props)==null||u.closeAreaData();return}if(d.popupData=="新竹縣原住民部落範圍"){s(d.popupId).then(f=>{i.type=1,i.tribeData=f}).then(()=>{i.showAreaDataWindow=!0});return}if(d.popupData=="近年歷史災害82處部落點位"){r(`近年歷史災害82處部落點位.${d.popupId}`).then(f=>{i.type=2,i.tribeData=f.data}).then(()=>{i.showAreaDataWindow=!0});return}if(d.popupData=="雨量站"){o(d.popupId).then(f=>{i.type=3,f.data!==null&&(i.tribeData=f.data)}).then(()=>{i.showAreaDataWindow=!0});return}if(d.popupData=="工程鑽探"){console.log("搜尋工程鑽探"),console.log(d.coordinate),a(d.popupId).then(f=>{i.type=4,f.data!==null&&(i.harvestDrill=f.data,i.coordinate=d.coordinate)}).then(()=>{i.showAreaDataWindow=!0});return}if(d.popupData=="土石流潛勢溪流"){i.type=5,i.potentialDebrisFlowTorrent=l(n.popup.temp),i.showAreaDataWindow=!0;return}if(d.popupData=="落石分布"){i.type=6,i.rockfall=h(d.temp),i.showAreaDataWindow=!0;return}}return Xi(()=>{c(n.popup),i.oldPopupId=n.popup.popupId}),il(()=>{i.oldPopupId!==n.popup.popupId&&(c(n.popup),i.oldPopupId=n.popup.popupId)}),{router:t,props:n,state:i}}},Y=n=>(bt("data-v-a012482b"),n=n(),Tt(),n),vd={key:0},bd={class:"row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold"},Td=Y(()=>m("p",null,"詳細資訊",-1)),Ld=Y(()=>m("svg",{width:"32",height:"32",viewBox:"0 0 24 24"},[m("path",{fill:"currentColor",d:"M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10zm0-11.414L9.172 7.757L7.757 9.172L10.586 12l-2.829 2.828l1.415 1.415L12 13.414l2.828 2.829l1.415-1.415L13.414 12l2.829-2.828l-1.415-1.415L12 10.586z"})],-1)),Ed=[Ld],Id={class:"row mx-0 align-items-center p-2 position-relative"},Rd={class:"d-flex flex-nowrap align-items-center justify-content-between my-2"},Fd={href:"#"},kd=Y(()=>m("img",{src:wd,alt:""},null,-1)),Md={class:"border-bottom row flex-nowrap p-2 my-3 cursor-pointer mx-0"},Pd={key:0,class:"py-2 px-4"},Dd={class:"d-flex flex-wrap justify-content-between"},Od={class:"w-50 mb-4"},Ad={class:"mb-0"},Gd=["src"],Bd={key:1,class:"py-2 px-4"},Nd=Y(()=>m("div",null,"尚無影片",-1)),Wd=[Nd],Vd={key:1},jd={class:"row mx-0 align-items-center px-2 py-4 position-relative"},zd={key:0,class:"row mx-0 mb-2"},Yd=Y(()=>m("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"事件: ",-1)),Ud={class:"col-8 py-1 px-2 bg-grey-light text-start"},Xd={key:1,class:"row mx-0 mb-2"},Hd=Y(()=>m("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"發生時間: ",-1)),Kd={class:"col-8 py-1 px-2 bg-grey-light text-start"},$d={key:2,class:"row mx-0 mb-2"},qd=Y(()=>m("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"鄉鎮: ",-1)),Zd={class:"col-8 py-1 px-2 bg-grey-light text-start"},Jd={key:3,class:"row mx-0 mb-2"},Qd=Y(()=>m("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"地方: ",-1)),eu={class:"col-8 py-1 px-2 bg-grey-light text-start"},tu={key:4,class:"row mx-0 mb-2"},iu=Y(()=>m("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"村落: ",-1)),su={class:"col-8 py-1 px-2 bg-grey-light text-start"},nu={key:5,class:"row mx-0 mb-2"},ru=Y(()=>m("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"災害種類: ",-1)),ou={class:"col-8 py-1 px-2 bg-grey-light text-start"},au={key:6,class:"row mx-0 mb-2"},lu=Y(()=>m("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"描述: ",-1)),cu={class:"col-8 py-1 px-2 bg-grey-light text-start"},hu={key:2},du={class:"p-2 p-sm-3"},uu=Y(()=>m("p",{class:"text-start px-0 fw-bold"},"雨量站",-1)),fu=Y(()=>m("hr",null,null,-1)),gu={class:"p-0 p-sm-2"},mu=Y(()=>m("p",null,"單位:mm ",-1)),_u={class:"rainfall border-bottom border-grey w-100"},pu=Y(()=>m("thead",null,[m("tr",{class:"text-center"},[m("td",{class:"bg-blueDeep text-white border border-white p-2"},"10分鐘"),m("td",{class:"bg-blueDeep text-white border border-white p-2"},"時雨量"),m("td",{class:"bg-blueDeep text-white border border-white p-2"},"3小時"),m("td",{class:"bg-blueDeep text-white border border-white p-2"},"6小時"),m("td",{class:"bg-blueDeep text-white border border-white p-2"},"12小時"),m("td",{class:"bg-blueDeep text-white border border-white p-2"},"24小時")])],-1)),yu={class:"text-center"},xu={class:"p-2"},Cu={class:"p-2"},wu={class:"p-2"},Su={class:"p-2"},vu={class:"p-2"},bu={class:"p-2"},Tu={key:3},Lu={class:"row mx-0 align-items-center px-2 py-4 position-relative"},Eu={key:0,class:"row mx-0 mb-2"},Iu=Y(()=>m("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"計畫編號: ",-1)),Ru={class:"col-8 py-1 px-2 bg-grey-light text-start"},Fu={key:1,class:"row mx-0 mb-2"},ku=Y(()=>m("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"計畫名稱: ",-1)),Mu={class:"col-8 py-1 px-2 bg-grey-light text-start"},Pu={key:2,class:"row mx-0 mb-2"},Du=Y(()=>m("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"執行單位: ",-1)),Ou={class:"col-8 py-1 px-2 bg-grey-light text-start"},Au={key:3,class:"row mx-0 mb-2"},Gu=Y(()=>m("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"委託單位: ",-1)),Bu={class:"col-8 py-1 px-2 bg-grey-light text-start"},Nu={key:4,class:"row mx-0 mb-2"},Wu=Y(()=>m("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"孔: ",-1)),Vu={class:"col-8 py-1 px-2 bg-grey-light text-start"},ju={class:"row mx-0 mb-2"},zu=Y(()=>m("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"連結: ",-1)),Yu=["href"],Uu={key:4},Xu={class:"row mx-0 align-items-center px-2 py-4 position-relative"},Hu={key:0,class:"row mx-0 mb-2"},Ku=Y(()=>m("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"主流: ",-1)),$u={class:"col-8 py-1 px-2 bg-grey-light text-start"},qu={key:1,class:"row mx-0 mb-2"},Zu=Y(()=>m("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"位置: ",-1)),Ju={class:"col-8 py-1 px-2 bg-grey-light text-start"},Qu={key:2,class:"row mx-0 mb-2"},ef=Y(()=>m("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"風險程度: ",-1)),tf={class:"col-8 py-1 px-2 bg-grey-light text-start"},sf={key:3,class:"row mx-0 mb-2"},nf=Y(()=>m("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"筆記1: ",-1)),rf={class:"col-8 py-1 px-2 bg-grey-light text-start"},of={key:4,class:"row mx-0 mb-2"},af=Y(()=>m("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"筆記2: ",-1)),lf={class:"col-8 py-1 px-2 bg-grey-light text-start"},cf={key:5,class:"row mx-0 mb-2"},hf=Y(()=>m("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"連結: ",-1)),df=["href"],uf={key:5},ff={class:"row mx-0 align-items-center px-2 py-4 position-relative"},gf={key:0,class:"row mx-0 mb-2"},mf=Y(()=>m("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"活動: ",-1)),_f={class:"col-8 py-1 px-2 bg-grey-light text-start"},pf={key:1,class:"row mx-0 mb-2"},yf=Y(()=>m("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"種類: ",-1)),xf={class:"col-8 py-1 px-2 bg-grey-light text-start"},Cf={key:2,class:"row mx-0 mb-2"},wf=Y(()=>m("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"類型: ",-1)),Sf={class:"col-8 py-1 px-2 bg-grey-light text-start"},vf={key:3,class:"row mx-0 mb-2"},bf=Y(()=>m("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"坡度: ",-1)),Tf={class:"col-8 py-1 px-2 bg-grey-light text-start"},Lf={key:4,class:"row mx-0 mb-2"},Ef=Y(()=>m("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"記錄者: ",-1)),If={class:"col-8 py-1 px-2 bg-grey-light text-start"};function Rf(n,e,t,i,s,r){var a,l,h,c,d,u,f,g,_,p,x,y,w,R,S,C,b,v,L,T,M,W,V;const o=Cd;return i.state.showAreaDataWindow?(E(),I("div",{key:0,class:"bg-white rounded py-2",style:Fi([{"overflow-y":"auto"},{"max-height":i.props.maxHeight+"px"}])},[i.state.type===1?(E(),I("div",vd,[m("div",bd,[Td,m("div",{class:"position-absolute col-auto end-0 cursor-pointer",style:{top:"10px"},onClick:e[0]||(e[0]=(...H)=>i.props.closeAreaData&&i.props.closeAreaData(...H))},Ed)]),ae(o,{coordinate:i.props.popup.coordinate,type:i.state.type},null,8,["coordinate","type"]),m("div",Id,[m("div",Rd,[m("span",null,N((l=(a=i.state.tribeData)==null?void 0:a.basicInformation)==null?void 0:l.tribeName),1),m("div",{class:"p-2 bg-steel w-auto text-white d-inline-block rounded-2 cursor-pointer",onClick:e[1]||(e[1]=()=>{i.router.push({name:"detail",params:{id:i.props.popup.popupId}})})},"更多資訊")]),m("p",null,"描述: "+N((c=(h=i.state.tribeData)==null?void 0:h.basicInformation)==null?void 0:c.description),1),m("p",null,N((u=(d=i.state.tribeData)==null?void 0:d.basicInformation)==null?void 0:u.area),1),m("a",Fd,[kd,ki(" "+N((p=(_=(g=(f=i.state.tribeData)==null?void 0:f.basicInformation)==null?void 0:g.coordinates)==null?void 0:_.WGS84)==null?void 0:p.lat)+" , "+N((R=(w=(y=(x=i.state.tribeData)==null?void 0:x.basicInformation)==null?void 0:y.coordinates)==null?void 0:w.WGS84)==null?void 0:R.lng),1)])]),m("div",null,[m("div",Md,[m("div",{class:"col-6 cursor-pointer",onClick:e[2]||(e[2]=H=>i.state.media="photo")},"相片"),m("div",{class:"col-6 cursor-pointer",onClick:e[3]||(e[3]=H=>i.state.media="video")},"影片")]),i.state.media==="photo"?(E(),I("div",Pd,[m("div",Dd,[(E(!0),I(we,null,Se((C=(S=i.state)==null?void 0:S.tribeData)==null?void 0:C.culturalLandscape,H=>(E(),I("div",Od,[m("p",Ad,N(H.name),1),m("img",{src:H.image,alt:"",class:"w-100"},null,8,Gd)]))),256))])])):P("",!0),i.state.media==="video"?(E(),I("div",Bd,Wd)):P("",!0)])])):P("",!0),i.state.type===2?(E(),I("div",Vd,[m("div",jd,[i.state.tribeData.event?(E(),I("div",zd,[Yd,m("div",Ud,N(i.state.tribeData.event),1)])):P("",!0),i.state.tribeData.date?(E(),I("div",Xd,[Hd,m("div",Kd,N(i.state.tribeData.date),1)])):P("",!0),i.state.tribeData.township?(E(),I("div",$d,[qd,m("div",Zd,N(i.state.tribeData.township),1)])):P("",!0),i.state.tribeData.village?(E(),I("div",Jd,[Qd,m("div",eu,N(i.state.tribeData.village),1)])):P("",!0),i.state.tribeData.place?(E(),I("div",tu,[iu,m("div",su,N(i.state.tribeData.place),1)])):P("",!0),i.state.tribeData.category?(E(),I("div",nu,[ru,m("div",ou,N(i.state.tribeData.category),1)])):P("",!0),i.state.tribeData.description?(E(),I("div",au,[lu,m("div",cu,N(i.state.tribeData.description),1)])):P("",!0)])])):P("",!0),i.state.type===3?(E(),I("div",hu,[m("div",du,[uu,fu,m("div",gu,[m("p",null,"觀測時間: "+N((b=i.state.tribeData)==null?void 0:b.viewDatetime),1),mu,m("table",_u,[pu,m("tbody",null,[m("tr",yu,[m("td",xu,N((v=i.state.tribeData)==null?void 0:v.min_10),1),m("td",Cu,N((L=i.state.tribeData)==null?void 0:L.hour_1),1),m("td",wu,N((T=i.state.tribeData)==null?void 0:T.hour_3),1),m("td",Su,N((M=i.state.tribeData)==null?void 0:M.hour_6),1),m("td",vu,N((W=i.state.tribeData)==null?void 0:W.hour_12),1),m("td",bu,N((V=i.state.tribeData)==null?void 0:V.hour_24),1)])])])])])])):P("",!0),i.state.type===4?(E(),I("div",Tu,[m("div",Lu,[i.state.harvestDrill.projNo?(E(),I("div",Eu,[Iu,m("div",Ru,N(i.state.harvestDrill.projNo),1)])):P("",!0),i.state.harvestDrill.projName?(E(),I("div",Fu,[ku,m("div",Mu,N(i.state.harvestDrill.projName),1)])):P("",!0),i.state.harvestDrill.exename?(E(),I("div",Pu,[Du,m("div",Ou,N(i.state.harvestDrill.exename),1)])):P("",!0),i.state.harvestDrill.orgname?(E(),I("div",Au,[Gu,m("div",Bu,N(i.state.harvestDrill.orgname),1)])):P("",!0),i.state.harvestDrill.drillHoleCount?(E(),I("div",Nu,[Wu,m("div",Vu,N(i.state.harvestDrill.drillHoleCount),1)])):P("",!0),m("div",ju,[zu,m("a",{href:"https://geotech.gsmma.gov.tw/imoeagis/Home/Map?lng="+i.state.coordinate[0]+"&lat="+i.state.coordinate[1],class:"col-8 py-1 px-2 bg-grey-light text-start"}," 網址鏈接 ",8,Yu)])])])):P("",!0),i.state.type===5?(E(),I("div",Uu,[m("div",Xu,[i.state.potentialDebrisFlowTorrent.basic?(E(),I("div",Hu,[Ku,m("div",$u,N(i.state.potentialDebrisFlowTorrent.basic),1)])):P("",!0),i.state.potentialDebrisFlowTorrent.full?(E(),I("div",qu,[Zu,m("div",Ju,N(i.state.potentialDebrisFlowTorrent.full),1)])):P("",!0),i.state.potentialDebrisFlowTorrent.risk?(E(),I("div",Qu,[ef,m("div",tf,N(i.state.potentialDebrisFlowTorrent.risk),1)])):P("",!0),i.state.potentialDebrisFlowTorrent.note01?(E(),I("div",sf,[nf,m("div",rf,N(i.state.potentialDebrisFlowTorrent.note01),1)])):P("",!0),i.state.potentialDebrisFlowTorrent.note02?(E(),I("div",of,[af,m("div",lf,N(i.state.potentialDebrisFlowTorrent.note02),1)])):P("",!0),i.state.potentialDebrisFlowTorrent.link?(E(),I("div",cf,[hf,m("a",{href:i.state.potentialDebrisFlowTorrent.link,class:"col-8 py-1 px-2 bg-grey-light text-start"}," 網址鏈接 ",8,df)])):P("",!0)])])):P("",!0),i.state.type===6?(E(),I("div",uf,[m("div",ff,[i.state.rockfall.activity?(E(),I("div",gf,[mf,m("div",_f,N(i.state.rockfall.activity),1)])):P("",!0),i.state.rockfall.slideKind?(E(),I("div",pf,[yf,m("div",xf,N(i.state.rockfall.slideKind),1)])):P("",!0),i.state.rockfall.slideType?(E(),I("div",Cf,[wf,m("div",Sf,N(i.state.rockfall.slideType),1)])):P("",!0),i.state.rockfall.slideAng?(E(),I("div",vf,[bf,m("div",Tf,N(i.state.rockfall.slideAng),1)])):P("",!0),i.state.rockfall.identifier?(E(),I("div",Lf,[Ef,m("div",If,N(i.state.rockfall.identifier),1)])):P("",!0)])])):P("",!0)],4)):P("",!0)}const Ff=Te(Sd,[["render",Rf],["__scopeId","data-v-a012482b"]]),kf="/Map_Demo/assets/2D-m-0cdbc246.svg",Mf="/Map_Demo/assets/3D-m-4ecf18c0.svg",Pf="/Map_Demo/assets/vector-m-1fc5cf13.svg",Df="/Map_Demo/assets/selectVector-m-e4f4d97a.svg",Of="/Map_Demo/assets/singleWindow-m-4635df1a.svg",Af="/Map_Demo/assets/doubleWindow-m-cccef2df.svg";const Gf={props:{currentLayers:{type:Array,default:[]},mapCount:{type:Number,default:1},dimensionMapStatus:{type:Boolean,default:!1},openConditionWrap:{type:Function,default:()=>{}},openLayerSelect:{type:Function,default:()=>{}},onLayerControl:{type:Function,default:()=>{}},onChangeMapCount:{type:Function,default:()=>{}}},setup(n,{emit:e}){const t=Le({toolSwitch:{threeDimensionalBtn:!1,layerConditionBtn:!1,splitWindowBtn:!1},targetNum:1});function i(o,a){Object.keys(t.toolSwitch).forEach(l=>{l===o?t.toolSwitch[o]?t.toolSwitch[o]=!1:t.toolSwitch[o]=!0:t.toolSwitch[l]=!1})}function s(o,a){o==="changeMapCount"&&(t.toolSwitch.splitWindowBtn=!1),n.onLayerControl({action:o,value:a})}function r(){e("conditionWrap")}return{props:n,state:t,toolSwitch:i,onLayerControl:s,conditionWrap:r}}},Bf={class:"w-100"},Nf={class:"list-unstyled d-flex align-items-center justify-content-around py-2 flex-nowrap w-100 bg-white mb-0"},Wf=m("img",{src:kf},null,-1),Vf=[Wf],jf=m("img",{src:Mf},null,-1),zf=[jf],Yf=m("img",{src:Pf},null,-1),Uf=[Yf],Xf=m("img",{src:Df},null,-1),Hf=[Xf],Kf={class:"text-white"},$f=m("img",{src:Of},null,-1),qf=[$f],Zf=m("img",{src:Af},null,-1),Jf=[Zf];function Qf(n,e,t,i,s,r){return E(),I("div",Bf,[m("ul",Nf,[m("li",null,[m("div",null,[i.props.dimensionMapStatus?(E(),I("div",{key:0,class:"navbarBtn",onClick:e[0]||(e[0]=J(o=>(i.toolSwitch("threeDimensionalBtn"),i.onLayerControl("changeDimensionMap","3D")),["prevent"]))},Vf)):(E(),I("div",{key:1,class:"navbarBtn",onClick:e[1]||(e[1]=J(o=>(i.toolSwitch("threeDimensionalBtn"),i.onLayerControl("changeDimensionMap","2D")),["prevent"]))},zf))])]),m("li",null,[m("div",{class:"navbarBtn",onClick:e[2]||(e[2]=o=>i.props.openConditionWrap())},Uf)]),m("li",null,[m("div",{class:"navbarBtn",onClick:e[3]||(e[3]=o=>i.props.openLayerSelect())},Hf)]),m("li",null,[m("div",Kf,[i.props.mapCount===1?(E(),I("div",{key:0,class:"navbarBtn",onClick:e[4]||(e[4]=J(o=>i.props.onChangeMapCount(2),["prevent"]))},qf)):P("",!0),i.props.mapCount===2?(E(),I("div",{key:1,class:"navbarBtn",onClick:e[5]||(e[5]=J(o=>i.props.onChangeMapCount(1),["prevent"]))},Jf)):P("",!0)])])])])}const eg=Te(Gf,[["render",Qf]]),tg="/Map_Demo/assets/lockOpen-34ad2519.svg",$r="/Map_Demo/assets/deleteLayer-f326d138.svg",ig="/Map_Demo/assets/arrow_up-75a5d1eb.svg",sg="/Map_Demo/assets/arrow_down-57e34976.svg",ng="/Map_Demo/assets/eyes-e3c32f20.svg";const rg={props:{onClose:{type:Function,default:()=>{}},onDeleteLayer:{type:Function,default:()=>{}},onLockLayer:{type:Function,default:()=>{}},currentLayers:{type:Array,default:[]},selectLock:{type:Boolean,default:!1},onLayerControl:{type:Function,default:()=>{}}},setup(n,{emit:e}){const t=Le({});function i(s){n.onLayerControl({action:"setOpacity",value:{key:s.target.getAttribute("nodeindex"),value:s.target.value}});const r=parseFloat(Number(s.target.value));document.getElementById(`opacityControl${s.target.getAttribute("nodeindex")}`).innerText=r.toFixed(2)}return{props:n,state:t,updateOpacity:i}}},$e=n=>(bt("data-v-9aa686f1"),n=n(),Tt(),n),og={class:"layerSelect bg-white"},ag={class:"row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold"},lg=$e(()=>m("p",{class:"mb-0 fs-5"},"已選擇的圖層",-1)),cg=$e(()=>m("hr",{class:"my-0"},null,-1)),hg={class:"py-3 px-4 content",style:{"overflow-y":"scroll","max-height":"40vh"}},dg={class:"allControl d-flex align-items-center justify-content-end mb-0"},ug=$e(()=>m("img",{src:tg,alt:""},null,-1)),fg=$e(()=>m("img",{src:$r,alt:""},null,-1)),gg={class:"list-unstyled d-flex flex-wrap flex-column-reverse"},mg={key:0,class:"d-flex justify-content-between align-items-center border-bottom py-2 flex-wrap"},_g={class:"tool"},pg=["onClick"],yg=$e(()=>m("img",{src:ig,alt:""},null,-1)),xg=[yg],Cg=["onClick"],wg=$e(()=>m("img",{src:sg,alt:""},null,-1)),Sg=[wg],vg=["onClick"],bg=$e(()=>m("img",{src:ng,alt:""},null,-1)),Tg=[bg],Lg=["onClick"],Eg=$e(()=>m("img",{src:$r,alt:""},null,-1)),Ig=[Eg],Rg={class:"w-100 mt-2 d-flex align-items-center"},Fg=["nodeIndex"],kg=["id"];function Mg(n,e,t,i,s,r){return E(),I("div",og,[m("div",ag,[lg,m("a",{href:"#",class:"closeBtn bg-dark text-decoration-none rounded-circle position-absolute d-flex align-items-center justify-content-center",onClick:e[0]||(e[0]=J((...o)=>i.props.onClose&&i.props.onClose(...o),["prevent"]))})]),cg,m("div",hg,[m("div",dg,[m("a",{href:"",class:xe(["d-flex align-items-center text-decoration-none me-3",{lockUp:i.props.selectLock,unlock:!i.props.selectLock}]),onClick:e[1]||(e[1]=J(()=>{i.props.onLockLayer()},["prevent"]))},[ug,ki(" 鎖定圖層 ")],2),m("a",{href:"",class:xe(["d-flex align-items-center text-decoration-none",{disabled:i.props.currentLayers.length<=1}]),onClick:e[2]||(e[2]=J(()=>{i.props.currentLayers.length>0&&i.props.onDeleteLayer({action:"selectLayerMode",value:{layerName:"all"}})},["prevent"]))},[fg,ki(" 全部取消 ")],2)]),m("ul",gg,[(E(!0),I(we,null,Se(i.props.currentLayers,(o,a)=>(E(),I("li",null,[o.id?(E(),I("div",mg,[m("div",null,N(o==null?void 0:o.label),1),m("div",_g,[m("a",{href:"",onClick:J(l=>i.props.onLayerControl({action:"changeOrder",value:{movement:"up",id:o.id,key:a}}),["prevent"])},xg,8,pg),m("a",{href:"",onClick:J(l=>i.props.onLayerControl({action:"changeOrder",value:{movement:"down",id:o.id,key:a}}),["prevent"])},Sg,8,Cg),m("a",{href:"",class:xe({Invisible:!(o!=null&&o.visible)}),onClick:J(()=>{i.props.onLayerControl({action:"changeLayerVisible",value:{key:a}})},["prevent"])},Tg,10,vg),m("a",{href:"",onClick:J(l=>i.props.onDeleteLayer({action:"selectLayerMode",value:{id:o==null?void 0:o.id}}),["prevent"])},Ig,8,Lg)]),m("label",Rg,[m("input",{id:"opacity-input",class:"w-75 me-2",type:"range",min:"0",max:"1",step:"0.01",value:"1",nodeIndex:a,onInput:e[3]||(e[3]=(...l)=>i.updateOpacity&&i.updateOpacity(...l))},null,40,Fg),m("span",{id:`opacityControl${a}`},"1",8,kg)])])):P("",!0)]))),256))])])])}const Pg=Te(rg,[["render",Mg],["__scopeId","data-v-9aa686f1"]]);const Dg={props:{text:{type:String,default:"測試"},styles:{type:String,default:""},status:{type:Boolean,default:!0}},setup(n,{emit:e}){const t=_r(),i=nl,s=sl(null),r=Le({overLayerHeight:ht(()=>{var o;return((o=s==null?void 0:s.value)==null?void 0:o.offsetHeight)+10}),overLayerWidth:ht(()=>{var o;return((o=s==null?void 0:s.value)==null?void 0:o.offsetWidth)+10}),accordionListRef:null,accordionListRefHeight:ht(()=>{var o;return(o=r.accordionListRef)==null?void 0:o.offsetHeight}),accordionListRefWidth:ht(()=>{var o;return(o=r.accordionListRef)==null?void 0:o.offsetWidth})});return Xi(()=>{Me(".initOverLay").parent().addClass("position-relative")}),{state:r,props:n,store:t,route:i,overLayCom:s}}};function Og(n,e,t,i,s,r){return i.store.state.isInit?(E(),I("div",{key:0,class:"initOverLay",onClick:e[0]||(e[0]=o=>i.store.dispatch("updateLayerStatus",!1)),style:Fi({height:i.state.overLayerHeight+"px",width:i.state.overLayerWidth+"px"}),ref:o=>{i.state.accordionListRef=o}},[m("div",{class:"tipText text-white fw-bold fs-3",style:Fi(i.props.styles)},N(i.props.text),5)],4)):P("",!0)}const Ki=Te(Dg,[["render",Og]]);gr.defs("EPSG:3826","+proj=tmerc +lat_0=0 +lon_0=121 +k=0.9999 +x_0=250000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +type=crs");Wa(gr);const Li={getLayer:(n,e,t)=>{var h,c;let i,s;const r=n.layer_type,o=n.figure_type,a=n.single_tiles?"":`- ${(h=n.tiles_list[e])==null?void 0:h.title}`,l=[];if(r==="WMS"){const d=n.single_tiles?n.tiles_url:n.tiles_list[e].tile_url;switch(o){case"Point":if(d){const u=new URL(d),f=u.origin,g=u.pathname,_=u.searchParams,p={};for(const[x,y]of _.entries())p[x]=y;l[0]=f+g,l[1]=p}s=new At({maxzoom:18,minzoom:3,url:l[0],params:l[1],serverType:"mapserver",crossOrigin:"anonymous"});break;case"Surface":if(d){const u=new URL(d),f=u.origin,g=u.pathname,_=u.searchParams,p={};for(const[x,y]of _.entries())p[x]=y;l[0]=f+g,l[1]=p}s=new At({maxzoom:18,minzoom:3,url:l[0],params:l[1],serverType:"mapserver"});break;case"Line":if(d){const u=new URL(d),f=u.origin,g=u.pathname,_=u.searchParams,p={};for(const[x,y]of _.entries())p[x]=y;l[0]=f+g,l[1]=p}s=new At({maxzoom:18,minzoom:3,url:l[0],params:l[1],serverType:"mapserver"});break;default:console.log("error-otherWMSLayer:",o)}i=new xt({id:t,label:`${n.title}${a}`,source:new At({name:n.title,url:s.getUrls()[0],params:s.getParams(),serverType:"geoserver",crossOrigin:"anonymous",projection:(c=s.getParams())==null?void 0:c.SRS}),style:"default",maxZoom:20})}if(r==="WMTS")switch(o){case"Surface":const d="EPSG:3857",u=[-20037508342789244e-9,-20037508342789244e-9,20037508342789244e-9,20037508342789244e-9],f=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],g=[156543.03392804097,78271.51696402048,39135.75848201024,19567.87924100512,9783.93962050256,4891.96981025128,2445.98490512564,1222.99245256282,611.49622628141,305.748113140705,152.8740565703525,76.43702828517625,38.21851414258813,19.109257071294063,9.554628535647032,4.777314267823516,2.388657133911758,1.194328566955879,.5971642834779395,.29858214173896974,.14929107086948487];s=new Ec({url:n.tiles_url,layer:n.name,requestEncoding:"REST",matrixSet:"GoogleMapsCompatible",format:"image/png",transparente:!0,projection:d,tileGrid:new Tc({origin:ur(u),matrixIds:f,resolutions:g}),style:"default",maxZoom:20}),i=new xt({name:n.name,id:t,label:`${n.title}${a}`,title:n.title,type:"overlay",opacity:1,visible:!0,source:s});break;default:console.log("error-otherWMSLayer:",o)}if(r==="WFS"){const d=new Oe({format:new cs,url:n.tiles_url,strategy:cc}),u=new He().getStyleFunction()(),f={},g=n.title==="新竹縣原住民部落範圍"?function(_){const p=_.values_.部落名稱;function x(){const w=new Set,R="0123456789ABCDEF";let S;do{S="#";for(let C=0;C<6;C++)S+=R[Math.floor(Math.random()*16)]}while(w.has(S));return w.add(S),f[p]=S,S}return new tt({fill:new wt({color:f[p]===void 0?x():f[p]})})}:u;i=new He({id:t,label:`${n.title}${a}`,source:d,style:g})}if(r==="GeoJson"){const d=n.single_tiles?n.tiles_url:n.tiles_list[e].tile_url;switch(o){case"Line":if(d){const u=new URL(d),{origin:f,pathname:g,searchParams:_}=u,p={};for(const[x,y]of _.entries())p[x]=y;l[0]=f+g,l[1]=p}s=new Oe({url:n.tiles_url,format:new cs({geometryName:n.title})});break;case"Point":if(d){const u=new URL(d),{origin:f,pathname:g,searchParams:_}=u,p={};for(const[x,y]of _.entries())p[x]=y;l[0]=f+g,l[1]=p}s=new Oe({url:n.tiles_url,format:new cs({geometryName:n.title})});break;default:console.log("error-otherWMSLayer:",o)}i=new He({id:t,label:`${n.title}${a}`,source:s})}if(r==="Image")switch(o){case"Surface":const d=new Es({url:n.tiles_image_urls[0],projection:"EPSG:4326",imageExtent:n.image_options.image_extent,interpolate:!0});i=new Rs({id:t,label:`${n.title}${a}`,source:d,ext:{currentLayerKey:0,tilesImageUrls:n.tiles_image_urls,imageExtent:n.image_options.image_extent}});break;default:console.log("error-otherWMSLayer:",o)}return i},getLayerIndex:n=>{let e,t,i;return n?(n.split("_").forEach((s,r)=>{switch(r){case 0:e=Number(s.split("node")[1]);break;case 1:t=Number(s.split("subNode")[1]);break;case 2:i=s.split("nestedSubNode")[1]!=="undefined"?Number(s.split("nestedSubNode")[1]):"undefined";break}}),{nodeIndex:e,subNodeIndex:t,nestedSubNodeIndex:i,id:n}):{nodeIndex:e,subNodeIndex:t,nestedSubNodeIndex:i,id:n}},resetLayerId:(n,e,t)=>{const i={};n.split("_").forEach(r=>{const[o,a]=r.split("ode");i[o+"ode"]=a}),i[e]=t;let s="";return Object.entries(i).forEach((r,o)=>{s+=`${r[0]}${r[1]}`,o+1!==Object.entries(i).length&&(s+="_")}),s}};let Nt=[];const wi={getBaseMapData:n=>{let e;return Number.isInteger(n)?e=Nt[n]:e=n.layer,new xt({preload:1/0,name:e.name,label:e.label,type:e.mapType,baseId:e.baseId,source:new Xn({url:e.url}),crossOrigin:"anonymous"})},setBaseMapData:n=>{Nt=n},getCurrentBase:()=>Nt.filter(n=>n.onCurrent),showBaseMapData:()=>{console.log(Nt)}};function Ag(){return Nt}const Gg={props:{onClose:{type:Function,default:()=>{}},mapLayers:{type:Array,default:[]},currentLayers:{type:Array,default:[]},showSelectLayerValue:{type:Function,default:()=>{}},tribeQuery:{type:Object,default:{}},moveToMap:{type:Function,default:()=>{}}},setup(n,{emit:e}){const t=Li,i=mr(),s=Le({DropDown:null,TilesListValue:0,conditionYear:"",conditionTown:"",selectLayerOption:[]});function r(u,f){e("onLayerControl",{action:u,value:f})}function o(u){s.DropDown!==u?s.DropDown=u:s.DropDown=null}function a(u,f){let g=f.elementSource==="input"?u.target.checked:!0;r("layerMode",{checked:g,nodeIndex:f.nodeIndex,subNodeIndex:f.subNodeIndex,nestedSubNodeIndex:String(f.nestedSubNodeIndex)?f.nestedSubNodeIndex:void 0,id:f.single_tiles||!u.target.selectedOptions?f.id:u.target.selectedOptions[0].id})}async function l(){const u=await Me.ajax(`https://api.edtest.site/tribes?${"years="+s.conditionYear}&${"township="+s.conditionTown}`,"GET");s.selectLayerOption=u}function h(u){s.conditionYear=u.target.value,l()}function c(u){s.conditionTown=u.target.value,l()}function d(u){let f=s.selectLayerOption.find(g=>g.tribeCode==u.target.value);n.moveToMap(f.coordinates)}return rl(()=>s.TilesListValue,(u,f)=>{n.showSelectLayerValue(u)}),{props:n,state:s,router:i,mapList:t,onLayerControl:r,openLayerList:o,LayerCheckBoxChange:a,tribeYear:h,tribeTown:c,moveMap:d}}},qr=n=>(bt("data-v-48d095fb"),n=n(),Tt(),n),Bg={class:"condition bg-white"},Ng={class:"row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold border-bottom"},Wg=qr(()=>m("p",{class:"mb-0 fs-5"},"圖層選項",-1)),Vg={class:"py-3 px-4 content",style:{"max-height":"40vh","overflow-y":"scroll"}},jg={class:"mb-2 landBoundary"},zg={class:"mb-2"},Yg=["onClick"],Ug=qr(()=>m("path",{fill:"currentColor",d:"M8 5v14l11-7z"},null,-1)),Xg=[Ug],Hg={class:"ms-3 my-2"},Kg={key:0,class:"d-flex flex-wrap"},$g=["id","checked","onChange"],qg=["for"],Zg={class:"me-2"},Jg=["src"],Qg={key:0,class:"w-100"},em=["value"],tm=["value"],im=["value"],sm={key:1},nm={class:"my-2"},rm=["checked","onChange"],om=["onChange"],am=["value","id"],lm={class:"d-flex flex-wrap px-2 pt-1",style:{background:"#f4f4f4"}},cm=["src"],hm={class:"fw-bold"},dm={key:2,class:"d-flex flex-wrap px-2 pt-1",style:{background:"#f4f4f4"}},um=["href"];function fm(n,e,t,i,s,r){return E(),I("div",Bg,[m("div",Ng,[Wg,m("a",{href:"#",class:"closeBtn bg-dark text-decoration-none rounded-circle position-absolute d-flex align-items-center justify-content-center",onClick:e[0]||(e[0]=J((...o)=>i.props.onClose&&i.props.onClose(...o),["prevent"]))})]),m("div",Vg,[m("div",jg,[(E(!0),I(we,null,Se(i.props.mapLayers,(o,a)=>(E(),I("div",zg,[m("div",{class:"title d-flex align-items-center fw-bold text-black order-1 mb-1 text-decoration-none",onClick:l=>i.openLayerList(a)},[m("div",{class:xe(o.groupClass)},null,2),m("div",null,N(o.label),1),(E(),I("svg",{viewBox:"0 0 24 24",class:xe({openTitle:i.state.DropDown==a})},Xg,2))],8,Yg),i.state.DropDown==a?(E(!0),I(we,{key:0},Se(o.layers,(l,h)=>(E(),I("div",Hg,[l.single_tiles&&l.info_box==null?(E(),I("div",Kg,[m("input",{type:"checkbox",class:"me-2",id:l.id,checked:i.props.currentLayers.some(c=>c.id===l.id),onChange:c=>{i.LayerCheckBoxChange(c,{nodeIndex:a,subNode:l,subNodeIndex:h,nestedSubNodeIndex:"",single_tiles:l.single_tiles,elementSource:"input",id:l.id})}},null,40,$g),m("label",{for:l.id},[m("span",Zg,N(l.title),1),l.icon?(E(),I("img",{key:0,alt:"",src:l.icon},null,8,Jg)):P("",!0)],8,qg),l.title==="新竹縣原住民部落範圍"?(E(),I("div",Qg,[i.props.tribeQuery.years!==void 0?(E(),I("select",{key:0,class:"me-2",placeholder:"請選擇年度",onChange:e[1]||(e[1]=(...c)=>i.tribeYear&&i.tribeYear(...c))},[(E(!0),I(we,null,Se(i.props.tribeQuery.years,(c,d)=>(E(),I("option",{value:c},N(c),9,em))),256))],32)):P("",!0),i.props.tribeQuery.township!==void 0?(E(),I("select",{key:1,class:"me-2",placeholder:"請選擇鄉鎮",onChange:e[2]||(e[2]=(...c)=>i.tribeTown&&i.tribeTown(...c))},[(E(!0),I(we,null,Se(i.props.tribeQuery.township,(c,d)=>(E(),I("option",{value:c},N(c),9,tm))),256))],32)):P("",!0),i.state.selectLayerOption.length!==0?(E(),I("select",{key:2,class:"me-2",onChange:e[3]||(e[3]=(...c)=>i.moveMap&&i.moveMap(...c))},[(E(!0),I(we,null,Se(i.state.selectLayerOption,(c,d)=>(E(),I("option",{value:c.tribeCode},N(c.tribeName),9,im))),256))],32)):P("",!0)])):P("",!0)])):(E(),I("div",sm,[m("div",nm,[m("input",{type:"checkbox",checked:i.props.currentLayers.some(c=>{let d=i.mapList.getLayerIndex(c.id);return d.nodeIndex==a&&d.subNodeIndex==h}),onChange:c=>{i.LayerCheckBoxChange(c,{nodeIndex:a,subNode:l,subNodeIndex:h,nestedSubNodeIndex:"",single_tiles:!0,elementSource:"input",id:l.id})}},null,40,rm),ki(" "+N(l.title)+" ",1),l.tiles_list!=null?pr((E(),I("select",{key:0,name:"",id:"",class:"mx-2","onUpdate:modelValue":e[4]||(e[4]=c=>i.state.TilesListValue=c),onChange:c=>{i.LayerCheckBoxChange(c,{nodeIndex:a,subNode:l,subNodeIndex:h,nestedSubNodeIndex:i.state.TilesListValue,single_tiles:l.single_tiles,elementSource:"select",id:l.id})}},[(E(!0),I(we,null,Se(l.tiles_list,(c,d)=>(E(),I("option",{value:d,id:c.id,key:d},N(c.title),9,am))),128))],40,om)),[[yr,i.state.TilesListValue]]):P("",!0)]),m("div",lm,[(E(!0),I(we,null,Se(l.info_box.items_group,c=>(E(),I("span",{class:"me-2 d-flex flex-wrap align-items-center mb-1",key:c},[c.icon?(E(),I("img",{key:0,src:c.icon,alt:"",class:"me-1"},null,8,cm)):P("",!0),m("span",hm,N(c.text),1)]))),128))])])),l.legend?(E(),I("div",dm,[m("a",{class:"me-1",href:l.legend,target:"_blank",style:{"text-decoration":"none",color:"#a87777"}},"圖例連結",8,um)])):P("",!0)]))),256)):P("",!0)]))),256))])])])}const gm=Te(Gg,[["render",fm],["__scopeId","data-v-48d095fb"]]),mm="/Map_Demo/assets/2D-70e1bbad.svg",_m="/Map_Demo/assets/3D-cb71f302.svg",pm="/Map_Demo/assets/baseLayer-3608307c.svg",Zr="/Map_Demo/assets/singleWindow-1afc73e5.svg",Jr="/Map_Demo/assets/doubleWindows-82f012fb.svg";const ym={props:{currentLayers:{type:Array,default:[]},mapCount:{type:Number,default:1},dimensionMapStatus:{type:Boolean,default:!1},onChangeMapCount:{type:Function,default:()=>{}},onChangeTarget:{type:Function,default:()=>{}}},setup(n,{emit:e}){const t=Le({toolSwitch:{threeDimensionalBtn:!1,layerConditionBtn:!1,splitWindowBtn:!1},targetNum:1});function i(o,a){Object.keys(t.toolSwitch).forEach(l=>{l===o?t.toolSwitch[o]?t.toolSwitch[o]=!1:t.toolSwitch[o]=!0:t.toolSwitch[l]=!1})}function s(o,a){e("onLayerControl",{action:o,value:a})}function r(){e("conditionWrap")}return{props:n,state:t,toolSwitch:i,onLayerControl:s,conditionWrap:r}}},ni=n=>(bt("data-v-b6e344e0"),n=n(),Tt(),n),xm={class:"list-unstyled d-inline-flex align-items-center flex-nowrap w-full"},Cm={class:"me-4 position-relative"},wm={class:"MapFeatureBtn text-white"},Sm=ni(()=>m("img",{src:mm},null,-1)),vm=[Sm],bm=ni(()=>m("img",{src:_m},null,-1)),Tm=[bm],Lm={class:"me-4 position-relative"},Em=ni(()=>m("img",{src:pm,alt:""},null,-1)),Im=[Em],Rm={class:"position-relative"},Fm={key:0,src:Zr,alt:""},km={key:1,src:Jr,alt:""},Mm={key:0,class:"list-unstyled position-absolute start-0 top-100 p-0"},Pm={class:"mt-2"},Dm=ni(()=>m("img",{src:Zr,alt:""},null,-1)),Om=[Dm],Am={class:"mt-2"},Gm=ni(()=>m("img",{src:Jr,alt:""},null,-1)),Bm=[Gm],Nm={class:"switchControl d-flex position-fixed rounded-pill p-2",id:"switchControl",style:{"z-index":"99"}};function Wm(n,e,t,i,s,r){const o=Ki;return E(),I("div",null,[m("ul",xm,[ae(o,{text:"圖層操控工具"}),m("li",Cm,[m("div",wm,[i.props.dimensionMapStatus?(E(),I("a",{key:0,href:"",onClick:e[0]||(e[0]=J(a=>(i.toolSwitch("threeDimensionalBtn"),i.onLayerControl("changeDimensionMap","3D")),["prevent"]))},vm)):(E(),I("a",{key:1,href:"",onClick:e[1]||(e[1]=J(a=>(i.toolSwitch("threeDimensionalBtn"),i.onLayerControl("changeDimensionMap","2D")),["prevent"]))},Tm))])]),m("li",Lm,[m("a",{href:"",class:"MapFeatureBtn text-white",onClick:e[2]||(e[2]=J(a=>(i.toolSwitch("layerConditionBtn"),i.conditionWrap()),["prevent"]))},Im)]),m("li",Rm,[m("a",{href:"",class:"MapFeatureBtn text-white",onClick:e[3]||(e[3]=J(a=>i.toolSwitch("splitWindowBtn"),["prevent"]))},[i.props.mapCount===1?(E(),I("img",Fm)):P("",!0),i.props.mapCount===2?(E(),I("img",km)):P("",!0)]),i.state.toolSwitch.splitWindowBtn?(E(),I("ul",Mm,[m("li",Pm,[m("a",{href:"",class:"text-white MapFeatureBtn",onClick:e[4]||(e[4]=J(a=>i.props.onChangeMapCount(1),["prevent"]))},Om)]),m("li",Am,[m("a",{href:"",class:"text-white MapFeatureBtn",onClick:e[5]||(e[5]=J(a=>i.props.onChangeMapCount(2),["prevent"]))},Bm)])])):P("",!0)])]),m("div",Nm,[ae(o,{text:"左右視窗切換工具"}),m("div",{class:xe(["fs-3 text-white rounded-pill",{active:i.state.targetNum===1}]),onClick:e[6]||(e[6]=()=>{i.state.targetNum=1,i.props.onChangeTarget(1)})},"左",2),m("div",{class:xe(["fs-3 text-white rounded-pill",{active:i.state.targetNum===2}]),onClick:e[7]||(e[7]=()=>{i.state.targetNum=2,i.props.onChangeTarget(2)})},"右",2)])])}const Vm=Te(ym,[["render",Wm],["__scopeId","data-v-b6e344e0"]]);const jm={props:{baseMapList:{type:Array,default:[]},onChangeBaseMaps:{type:Function,default:()=>{}}},setup(n,{emit:e}){return{state:Le({selectMap:0,mapSourceList:[]}),props:n}}},zm=["value"];function Ym(n,e,t,i,s,r){const o=Ki;return E(),I("div",null,[ae(o,{text:"底圖切換工具"}),pr(m("select",{name:"",id:"",class:"w-100 fs-6 fs-sm-5","onUpdate:modelValue":e[0]||(e[0]=a=>i.state.selectMap=a),onChange:e[1]||(e[1]=a=>{let l=i.props.baseMapList.find(h=>h.baseId===i.state.selectMap);i.props.onChangeBaseMaps({action:"baseMap",value:l})})},[(E(!0),I(we,null,Se(i.props.baseMapList,(a,l)=>(E(),I("option",{class:"w-100",key:l,value:a.baseId},N(a.label),9,zm))),128))],544),[[yr,i.state.selectMap]])])}const Um=Te(jm,[["render",Ym],["__scopeId","data-v-dab735f0"]]),Xm="/Map_Demo/assets/zoomIn-c80b5dd3.svg",Hm="/Map_Demo/assets/zoomOut-88993246.svg",Km="/Map_Demo/assets/compass-1c1efd7a.svg",$m="/Map_Demo/assets/location-b52d62b2.svg",qm="/Map_Demo/assets/zoom-8acdf5b3.svg";const Zm={props:{id:{Type:String,default:0},map:{},onChangeTarget:{type:Function,default:()=>{}}},setup(n,{emit:e}){const t=Le({targetNum:1});function i(s){e("onMapControl",{action:s})}return{props:n,state:t,onMapControl:i}}},ri=n=>(bt("data-v-1f287015"),n=n(),Tt(),n),Jm={class:"d-flex flex-nowrap flex-column"},Qm={class:"switchControl d-block d-sm-none rounded-4 p-2 mb-2",id:"switchControl",style:{"z-index":"99"}},e_=ri(()=>m("img",{src:Xm,alt:"zoomIn"},null,-1)),t_=[e_],i_=ri(()=>m("img",{src:Hm,alt:"zoomOut"},null,-1)),s_=[i_],n_=ri(()=>m("img",{src:Km,alt:"compass"},null,-1)),r_=[n_],o_=ri(()=>m("img",{src:$m,alt:"location"},null,-1)),a_=[o_],l_=ri(()=>m("img",{src:qm,alt:"zoom"},null,-1)),c_=[l_];function h_(n,e,t,i,s,r){const o=Ki;return E(),I("div",Jm,[ae(o,{text:"地圖操控工具"}),m("div",Qm,[m("div",{class:xe(["text-white text-center rounded",{active:i.state.targetNum===1}]),onClick:e[0]||(e[0]=()=>{i.state.targetNum=1,i.props.onChangeTarget(1)})},"上",2),m("div",{class:xe(["text-white text-center rounded",{active:i.state.targetNum===2}]),onClick:e[1]||(e[1]=()=>{i.state.targetNum=2,i.props.onChangeTarget(2)})},"下",2)]),m("a",{href:"#",class:"d-none d-sm-block order-1 mb-0",onClick:e[2]||(e[2]=J(a=>i.onMapControl("In"),["prevent"]))},t_),m("a",{href:"#",class:"d-none d-sm-block order-1 mb-2",onClick:e[3]||(e[3]=J(a=>i.onMapControl("Out"),["prevent"]))},s_),m("a",{href:"#",class:"order-1 mb-2",onClick:e[4]||(e[4]=J(a=>i.onMapControl("toNorth"),["prevent"]))},r_),m("a",{href:"#",class:"order-1 mb-2",onClick:e[5]||(e[5]=J(a=>i.onMapControl("moveTo"),["prevent"]))},a_),m("a",{href:"#",class:"order-1",onClick:e[6]||(e[6]=J(a=>i.onMapControl("fullScreen"),["prevent"]))},c_)])}const d_=Te(Zm,[["render",h_],["__scopeId","data-v-1f287015"]]),u_={SELECT:"select"};class f_ extends ir{constructor(e,t,i,s){super(e),this.selected=t,this.deselected=i,this.mapBrowserEvent=s}}const Si={};class Us extends Va{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=e.condition?e.condition:ja,this.addCondition_=e.addCondition?e.addCondition:mn,this.removeCondition_=e.removeCondition?e.removeCondition:mn,this.toggleCondition_=e.toggleCondition?e.toggleCondition:za,this.multi_=e.multi?e.multi:!1,this.filter_=e.filter?e.filter:ps,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.style_=e.style!==void 0?e.style:g_(),this.features_=e.features||new tr;let t;if(e.layers)if(typeof e.layers=="function")t=e.layers;else{const i=e.layers;t=function(s){return i.includes(s)}}else t=ps;this.layerFilter_=t,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(e,t){this.featureLayerAssociation_[j(e)]=t}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(e){return this.featureLayerAssociation_[j(e)]}setHitTolerance(e){this.hitTolerance_=e}setMap(e){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(e),e?(this.features_.addEventListener(ct.ADD,this.boundAddFeature_),this.features_.addEventListener(ct.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(ct.ADD,this.boundAddFeature_),this.features_.removeEventListener(ct.REMOVE,this.boundRemoveFeature_))}addFeature_(e){const t=e.element;if(this.style_&&this.applySelectedStyle_(t),!this.getLayer(t)){const i=this.getMap().getAllLayers().find(function(s){if(s instanceof He&&s.getSource()&&s.getSource().hasFeature(t))return s});i&&this.addFeatureLayerAssociation_(t,i)}}removeFeature_(e){this.style_&&this.restorePreviousStyle_(e.element)}getStyle(){return this.style_}applySelectedStyle_(e){const t=j(e);t in Si||(Si[t]=e.getStyle()),e.setStyle(this.style_)}restorePreviousStyle_(e){const t=this.getMap().getInteractions().getArray();for(let s=t.length-1;s>=0;--s){const r=t[s];if(r!==this&&r instanceof Us&&r.getStyle()&&r.getFeatures().getArray().lastIndexOf(e)!==-1){e.setStyle(r.getStyle());return}}const i=j(e);e.setStyle(Si[i]),delete Si[i]}removeFeatureLayerAssociation_(e){delete this.featureLayerAssociation_[j(e)]}handleEvent(e){if(!this.condition_(e))return!0;const t=this.addCondition_(e),i=this.removeCondition_(e),s=this.toggleCondition_(e),r=!t&&!i&&!s,o=e.map,a=this.getFeatures(),l=[],h=[];if(r){Ya(this.featureLayerAssociation_),o.forEachFeatureAtPixel(e.pixel,(c,d)=>{if(!(!(c instanceof Ct)||!this.filter_(c,d)))return this.addFeatureLayerAssociation_(c,d),h.push(c),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let c=a.getLength()-1;c>=0;--c){const d=a.item(c),u=h.indexOf(d);u>-1?h.splice(u,1):(a.remove(d),l.push(d))}h.length!==0&&a.extend(h)}else{o.forEachFeatureAtPixel(e.pixel,(c,d)=>{if(!(!(c instanceof Ct)||!this.filter_(c,d)))return(t||s)&&!a.getArray().includes(c)?(this.addFeatureLayerAssociation_(c,d),h.push(c)):(i||s)&&a.getArray().includes(c)&&(l.push(c),this.removeFeatureLayerAssociation_(c)),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let c=l.length-1;c>=0;--c)a.remove(l[c]);a.extend(h)}return(h.length>0||l.length>0)&&this.dispatchEvent(new f_(u_.SELECT,h,l,e)),!0}}function g_(){const n=fl();return ye(n.Polygon,n.LineString),ye(n.GeometryCollection,n.LineString),function(e){return e.getGeometry()?n[e.getGeometry().getType()]:null}}const m_=Us,ds="units",__=[1,2,5],Dt=25.4/.28;class p_ extends Ua{constructor(e){e=e||{};const t=document.createElement("div");t.style.pointerEvents="none",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un;const i=e.className!==void 0?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=i+"-inner",this.element.className=i+" "+Xa,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth!==void 0?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(ds,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(ds)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(ds,e)}setDpi(e){this.dpi_=e}updateElement_(){const e=this.viewState_;if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=e.center,i=e.projection,s=this.getUnits(),r=s=="degrees"?"degrees":"m";let o=_n(i,e.resolution,t,r);const a=this.minWidth_*(this.dpi_||Dt)/Dt,l=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||Dt)/Dt:void 0;let h=a*o,c="";if(s=="degrees"){const w=Ha.degrees;h*=w,h<w/60?(c="″",o*=3600):h<w?(c="′",o*=60):c="°"}else s=="imperial"?h<.9144?(c="in",o/=.0254):h<1609.344?(c="ft",o/=.3048):(c="mi",o/=1609.344):s=="nautical"?(o/=1852,c="NM"):s=="metric"?h<.001?(c="μm",o*=1e6):h<1?(c="mm",o*=1e3):h<1e3?c="m":(c="km",o/=1e3):s=="us"?h<.9144?(c="in",o*=39.37):h<1609.344?(c="ft",o/=.30480061):(c="mi",o/=1609.3472):ie(!1,33);let d=3*Math.floor(Math.log(a*o)/Math.log(10)),u,f,g,_,p,x;for(;;){g=Math.floor(d/3);const w=Math.pow(10,g);if(u=__[(d%3+3)%3]*w,f=Math.round(u/o),isNaN(f)){this.element.style.display="none",this.renderedVisible_=!1;return}if(l!==void 0&&f>=l){u=_,f=p,g=x;break}else if(f>=a)break;_=u,p=f,x=g,++d}const y=this.scaleBar_?this.createScaleBar(f,u,c):u.toFixed(g<0?-g:0)+" "+c;this.renderedHTML_!=y&&(this.innerElement_.innerHTML=y,this.renderedHTML_=y),this.renderedWidth_!=f&&(this.innerElement_.style.width=f+"px",this.renderedWidth_=f),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,t,i){const s=this.getScaleForResolution(),r=s<1?Math.round(1/s).toLocaleString()+" : 1":"1 : "+Math.round(s).toLocaleString(),o=this.scaleBarSteps_,a=e/o,l=[this.createMarker("absolute")];for(let c=0;c<o;++c){const d=c%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";l.push(`<div><div class="ol-scale-singlebar ${d}" style="width: ${a}px;"></div>`+this.createMarker("relative")+(c%2===0||o===2?this.createStepText(c,e,!1,t,i):"")+"</div>")}return l.push(this.createStepText(o,e,!0,t,i)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+r+"</div>":"")+l.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e==="absolute"?3:-10}px;"></div>`}createStepText(e,t,i,s,r){const a=(e===0?0:Math.round(s/this.scaleBarSteps_*e*100)/100)+(e===0?"":" "+r),l=e===0?-3:t/this.scaleBarSteps_*-1,h=e===0?0:t/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${l}px;text-align: ${e===0?"left":"center"};min-width: ${h}px;left: ${i?t+"px":"unset"};">`+a+"</div>"}getScaleForResolution(){const e=_n(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),t=this.dpi_||Dt,i=1e3/25.4;return e*i*t}render(e){const t=e.frameState;t?this.viewState_=t.viewState:this.viewState_=null,this.updateElement_()}}const y_=p_,Z={};Z.obj=function(n){return n};Z.supportsImageRenderingPixelatedResult_=void 0;Z.imageRenderingValueResult_=void 0;Z.supportsImageRenderingPixelated=function(){if(Z.supportsImageRenderingPixelatedResult_===void 0){const n=document.createElement("canvas");n.setAttribute("style","image-rendering: -moz-crisp-edges; image-rendering: pixelated;");const e=n.style.imageRendering;Z.supportsImageRenderingPixelatedResult_=!!e,Z.supportsImageRenderingPixelatedResult_&&(Z.imageRenderingValueResult_=e)}return Z.supportsImageRenderingPixelatedResult_};Z.imageRenderingValue=function(){return Z.supportsImageRenderingPixelated(),Z.imageRenderingValueResult_||""};Z.getSourceProjection=function(n){return n.get("olcs.projection")||n.getProjection()};function dt(n,e,t){return n.on(e,t)}let x_=0;function Q(n){return n.olcs_uid||(n.olcs_uid=++x_)}function C_(n,e){const t=n.length,i=Array(n.length);for(let s=0;s<t;s++)i[s]={index:s,value:n[s]};i.sort((s,r)=>e(s.value,r.value)||s.index-r.index);for(let s=0;s<n.length;s++)n[s]=i[s].value}function w_(n){return n&&n.parentNode?n.parentNode.removeChild(n):null}function S_(n){for(;n.lastChild;)n.removeChild(n.lastChild)}function us(n){const e=Cesium.GroundPolylinePrimitive;return e&&e.isSupported(n)}const v_=function(){const e=new Ka({projection:"EPSG:3857",wrapX:!0}).getTileCoordForTileUrlFunction([6,-31,22]);return e&&e[1]===33&&e[2]===22}();class Qr{constructor(e,t,i){this.source_=t,this.projection_=null,this.fallbackProj_=i||null,this.ready_=!1,this.tilingScheme_=null,this.rectangle_=null,this.map_=e,this.shouldRequestNextLevel=!1;const s=this.source_.get("olcs.proxy");s&&(typeof s=="function"?this.proxy_={getURL:s}:typeof s=="string"&&(this.proxy_=new Cesium.DefaultProxy(s))),this.errorEvent_=new Cesium.Event,this.emptyCanvas_=document.createElement("canvas"),this.emptyCanvas_.width=1,this.emptyCanvas_.height=1,this.source_.on("change",r=>{this.handleSourceChanged_()}),this.handleSourceChanged_()}handleSourceChanged_(e){if(!this.ready_&&this.source_.getState()=="ready"){this.projection_=Z.getSourceProjection(this.source_)||this.fallbackProj_;const t={numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1};if(this.source_.tileGrid!==null&&this.source_.tileGrid.forEachTileCoord(this.projection_.getExtent(),0,([i,s,r])=>{t.numberOfLevelZeroTilesX=s+1,t.numberOfLevelZeroTilesY=r+1}),this.projection_.getCode()==="EPSG:4326")this.shouldRequestNextLevel=t.numberOfLevelZeroTilesX===1&&t.numberOfLevelZeroTilesY===1,this.tilingScheme_=new Cesium.GeographicTilingScheme(t);else if(this.projection_.getCode()==="EPSG:3857")this.shouldRequestNextLevel=!1,this.tilingScheme_=new Cesium.WebMercatorTilingScheme(t);else return;this.rectangle_=this.tilingScheme_.rectangle,this.ready_=!0}}getTileCredits(e,t,i){const s=this.source_.getAttributions();if(!s)return[];const r=this.map_.getView().calculateExtent(this.map_.getSize()),o=this.map_.getView().getCenter(),a=this.shouldRequestNextLevel?i+1:i;return eo(s,a,o,r)}requestImage(e,t,i){const s=this.source_.getTileUrlFunction();if(s&&this.projection_){const r=this.shouldRequestNextLevel?i+1:i;let o=t;v_||(o=-t-1);let a=s.call(this.source_,[r,e,o],1,this.projection_);return this.proxy_&&(a=this.proxy_.getURL(a)),a?Cesium.ImageryProvider.loadImage(this,a):this.emptyCanvas_}else return this.emptyCanvas_}}Object.defineProperties(Qr.prototype,{ready:{get:function(){return this.ready_}},rectangle:{get:function(){return this.rectangle_}},tileWidth:{get:function(){const n=this.source_.getTileGrid();return n?Array.isArray(n.getTileSize(0))?n.getTileSize(0)[0]:n.getTileSize(0):256}},tileHeight:{get:function(){const n=this.source_.getTileGrid();return n?Array.isArray(n.getTileSize(0))?n.getTileSize(0)[1]:n.getTileSize(0):256}},maximumLevel:{get:function(){const n=this.source_.getTileGrid();return n?n.getMaxZoom():18}},minimumLevel:{get:function(){return 0}},tilingScheme:{get:function(){return this.tilingScheme_}},tileDiscardPolicy:{get:function(){}},errorEvent:{get:function(){return this.errorEvent_}},proxy:{get:function(){return this.proxy_}},hasAlphaChannel:{get:function(){return!0}},pickFeatures:{get:function(){}}});const b_=new th,T_=[new tt({stroke:new gt({color:"blue",width:2})})];class L_{constructor(e){this.urls=e.urls,this.ready=!0,this.readyPromise=Promise.resolve(!0),this.tileWidth=256,this.tileHeight=256,this.maximumLevel=e.maximumLevel||20,this.minimumLevel=e.minimumLevel||0,this.tilingScheme=new Cesium.WebMercatorTilingScheme,this.rectangle=e.rectangle||this.tilingScheme.rectangle,this.errorEvent=new Cesium.Event,this.credit=e.credit,this.hasAlphaChannel=!0,this.styleFunction_=e.styleFunction||(()=>T_),this.projection_=ce("EPSG:3857"),this.emptyCanvas_=document.createElement("canvas"),this.emptyCanvas_.width=1,this.emptyCanvas_.height=1,this.tileRectangle_=new Cesium.Rectangle;const t=e.cacheSize!==void 0?e.cacheSize:50;this.tileCache=new pn(t),this.featureCache=e.featureCache||new pn(t);const i=$a(this.projection_);this.tileFunction_=qa(this.urls,i)}getTileCredits(){return[]}pickFeatures(){}getTileFeatures(e,t,i){const s=this.getCacheKey_(e,t,i);let r;if(this.featureCache.containsKey(s)&&(r=this.featureCache.get(s)),!r){const o=this.getUrl_(e,t,i);if(r=fetch(o).then(a=>a.ok?a:Promise.reject(a)).then(a=>a.arrayBuffer()).then(a=>this.readFeaturesFromBuffer(a)),this.featureCache.set(s,r),this.featureCache.getCount()>2*this.featureCache.highWaterMark)for(;this.featureCache.canExpireCache();)this.featureCache.pop()}return r}readFeaturesFromBuffer(e){let t;const i=b_.readFeatures(e,t),s=this.tileWidth/4096;return i.forEach(r=>{const o=r.getFlatCoordinates();for(let a=0;a<o.length;++a)o[a]*=s}),i}getUrl_(e,t,i){return this.tileFunction_([e,t,i])}getCacheKey_(e,t,i){return`${e}_${t}_${i}`}requestImage(e,t,i,s){if(i<this.minimumLevel)return this.emptyCanvas_;try{const r=this.getCacheKey_(i,e,t);let o;if(this.tileCache.containsKey(r)&&(o=this.tileCache.get(r)),!o&&(o=this.getTileFeatures(i,e,t).then(a=>{this.tilingScheme.tileXYToNativeRectangle(e,t,i,this.tileRectangle_);const l=(this.tileRectangle_.east-this.tileRectangle_.west)/this.tileWidth;return this.rasterizeFeatures(a,this.styleFunction_,l)}),this.tileCache.set(r,o),this.tileCache.getCount()>2*this.tileCache.highWaterMark))for(;this.tileCache.canExpireCache();)this.tileCache.pop();return o}catch(r){console.trace(r),this.raiseEvent("could not render pbf to tile",r)}}rasterizeFeatures(e,t,i){const s=document.createElement("canvas"),r=uc(s.getContext("2d"),{size:[this.tileWidth,this.tileHeight]});return e.forEach(o=>{const a=t(o,i);a&&a.forEach(l=>{r.setStyle(l),r.drawGeometry(o)})}),s}}const k={};k.computePixelSizeAtCoordinate=function(n,e){const t=n.camera,i=n.canvas,s=t.frustum,r=Cesium.Cartesian3.magnitude(Cesium.Cartesian3.subtract(t.position,e,new Cesium.Cartesian3));return s.getPixelDimensions(i.clientWidth,i.clientHeight,r,n.pixelRatio,new Cesium.Cartesian2)};k.computeBoundingBoxAtTarget=function(n,e,t){const i=k.computePixelSizeAtCoordinate(n,e),s=Cesium.Transforms.eastNorthUpToFixedFrame(e),r=Cesium.Matrix4.multiplyByPoint(s,new Cesium.Cartesian3(-i.x*t,-i.y*t,0),new Cesium.Cartesian3),o=Cesium.Matrix4.multiplyByPoint(s,new Cesium.Cartesian3(i.x*t,i.y*t,0),new Cesium.Cartesian3);return Cesium.Ellipsoid.WGS84.cartesianArrayToCartographicArray([r,o])};k.applyHeightOffsetToGeometry=function(n,e){n.applyTransform((t,i,s)=>{if(console.assert(t===i),s!==void 0&&s>=3)for(let r=0;r<i.length;r+=s)i[r+2]=i[r+2]+e;return i})};k.createMatrixAtCoordinates=function(n,e=0,t=Cesium.Cartesian3.ZERO,i=new Cesium.Cartesian3(1,1,1)){const s=k.ol4326CoordinateToCesiumCartesian(n),r=Cesium.Transforms.eastNorthUpToFixedFrame(s),o=Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Z,-e),a=Cesium.Matrix4.fromTranslationQuaternionRotationScale(t,o,i);return Cesium.Matrix4.multiply(r,a,new Cesium.Matrix4)};k.rotateAroundAxis=function(n,e,t,i,s){const r=Cesium.Math.clamp,o=Cesium.defaultValue,a=s||{},l=o(a.duration,500),h=o(a.easing,Za),c=a.callback;let d=0;const u=new Cesium.Matrix4,f=Date.now(),g=function(){const p=Date.now()-f,x=h(r(p/l,0,1));console.assert(x>=d),n.transform.clone(u);const y=(x-d)*e;d=x,n.lookAtTransform(i),n.rotate(t,y),n.lookAtTransform(u),x<1?window.requestAnimationFrame(g):c&&c()};window.requestAnimationFrame(g)};k.setHeadingUsingBottomCenter=function(n,e,t,i){const s=n.camera,r=k.computeAngleToZenith(n,t),o=s.right,a=Cesium.Quaternion.fromAxisAngle(o,r),l=Cesium.Matrix3.fromQuaternion(a),h=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(s.position,t,h);const c=new Cesium.Cartesian3;Cesium.Matrix3.multiplyByVector(l,h,c),Cesium.Cartesian3.add(c,t,c);const d=Cesium.Matrix4.fromTranslation(c),u=k.rotateAroundAxis;u(s,e,c,d,i)};k.pickOnTerrainOrEllipsoid=function(n,e){const t=n.camera.getPickRay(e);return n.globe.pick(t,n)||n.camera.pickEllipsoid(e)};k.pickBottomPoint=function(n){const e=n.canvas,t=new Cesium.Cartesian2(e.clientWidth/2,e.clientHeight);return k.pickOnTerrainOrEllipsoid(n,t)};k.pickCenterPoint=function(n){const e=n.canvas,t=new Cesium.Cartesian2(e.clientWidth/2,e.clientHeight/2);return k.pickOnTerrainOrEllipsoid(n,t)};k.computeSignedTiltAngleOnGlobe=function(n){const e=n.camera,t=new Cesium.Ray(e.position,e.direction);let i=n.globe.pick(t,n);if(!i){const a=Cesium.Ellipsoid.WGS84,l=Cesium.IntersectionTests.rayEllipsoid(t,a);l&&(i=Cesium.Ray.getPoint(t,l.start))}if(!i)return;const s=new Cesium.Cartesian3;Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(i,s);const r=k.signedAngleBetween,o=r(e.direction,s,e.right)-Math.PI;return Cesium.Math.convertLongitudeRange(o)};k.bottomFovRay=function(n){const e=n.camera,t=e.frustum.fovy/2,i=e.direction,s=Cesium.Quaternion.fromAxisAngle(e.right,t),r=Cesium.Matrix3.fromQuaternion(s),o=new Cesium.Cartesian3;return Cesium.Matrix3.multiplyByVector(r,i,o),new Cesium.Ray(e.position,o)};k.signedAngleBetween=function(n,e,t){const i=new Cesium.Cartesian3,s=new Cesium.Cartesian3,r=new Cesium.Cartesian3;Cesium.Cartesian3.normalize(n,i),Cesium.Cartesian3.normalize(e,s),Cesium.Cartesian3.cross(i,s,r);const o=Cesium.Cartesian3.dot(i,s),a=Cesium.Cartesian3.magnitude(r),l=Cesium.Cartesian3.dot(t,r),h=Math.atan2(a,o);return l>=0?h:-h};k.computeAngleToZenith=function(n,e){const t=n.camera,i=t.frustum.fovy/2,s=k.bottomFovRay(n),r=Cesium.Cartesian3.clone(s.direction);Cesium.Cartesian3.negate(r,r);const o=new Cesium.Cartesian3;Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(e,o);const a=new Cesium.Cartesian3;return Cesium.Cartesian3.negate(t.right,a),k.signedAngleBetween(o,r,a)+i};k.extentToRectangle=function(n,e){if(n&&e){const t=Ja(n,e,"EPSG:4326");return Cesium.Rectangle.fromDegrees(t[0],t[1],t[2],t[3])}else return null};k.sourceToImageryProvider=function(n,e,t,i){const s=e.get("olcs_skip");if(s)return null;let r=null;if(e instanceof Cc&&e.getUrl()&&e.getImageLoadFunction()===Un){const o={"olcs.proxy":e.get("olcs.proxy"),"olcs.extent":e.get("olcs.extent"),"olcs.projection":e.get("olcs.projection"),"olcs.imagesource":e};e=new At({url:e.getUrl(),attributions:e.getAttributions(),projection:e.getProjection(),params:e.getParams()}),e.setProperties(o)}if(e instanceof lr){let o=Z.getSourceProjection(e);if(o||(o=t),k.isCesiumProjection(o))r=new Qr(n,e,t);else return null}else if(e instanceof Es){let o=Z.getSourceProjection(e);if(o||(o=t),k.isCesiumProjection(o))r=new Cesium.SingleTileImageryProvider({url:e.getUrl(),rectangle:new Cesium.Rectangle.fromDegrees(e.getImageExtent()[0],e.getImageExtent()[1],e.getImageExtent()[2],e.getImageExtent()[3])});else return null}else if(e instanceof Sc){let o=Z.getSourceProjection(e);if(o||(o=t),s===!1){const a=o.getCode().split(":")[1],l=e.urls.map(_=>_.replace(a,"3857")),h=i.getExtent(),c=k.extentToRectangle(h,o),d=e.get("olcs_minimumLevel"),u=e.getAttributions(),f=i.getStyleFunction();let g;if(h&&u){const _=vt(h);g=eo(u,0,_,h)[0]}return r=new L_({credit:g,rectangle:c,minimumLevel:d,styleFunction:f,urls:l}),r}return null}else return null;return r};k.tileLayerToImageryLayer=function(n,e,t){if(!(e instanceof xt)&&!(e instanceof Rs)&&!(e instanceof Wr))return null;const i=e.getSource();if(!i)return null;let s=i.get("olcs_provider");if(s||(s=this.sourceToImageryProvider(n,i,t,e)),!s)return null;const r={},a=e.get("olcs.extent")||e.getExtent();return a&&(r.rectangle=k.extentToRectangle(a,t)),new Cesium.ImageryLayer(s,r)};k.updateCesiumLayerProperties=function(n,e){let t=1,i=!0;[n.layer].concat(n.parents).forEach(s=>{const r=s.getOpacity();r!==void 0&&(t*=r);const o=s.getVisible();o!==void 0&&(i&=o)}),e.alpha=t,e.show=i};k.ol4326CoordinateToCesiumCartesian=function(n){const e=n;return e.length>2?Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]):Cesium.Cartesian3.fromDegrees(e[0],e[1])};k.ol4326CoordinateArrayToCsCartesians=function(n){console.assert(n!==null);const e=k.ol4326CoordinateToCesiumCartesian,t=[];for(let i=0;i<n.length;++i)t.push(e(n[i]));return t};k.olGeometryCloneTo4326=function(n,e){console.assert(e);const t=ce("EPSG:4326"),i=ce(e);if(i.getCode()!==t.getCode()){const s=n.getProperties();n=n.clone(),n.transform(i,t),n.setProperties(s)}return n};k.convertColorToCesium=function(n){if(n=n||"black",Array.isArray(n))return new Cesium.Color(Cesium.Color.byteToFloat(n[0]),Cesium.Color.byteToFloat(n[1]),Cesium.Color.byteToFloat(n[2]),n[3]);if(typeof n=="string")return Cesium.Color.fromCssColorString(n);if(n instanceof CanvasPattern||n instanceof CanvasGradient){const e=document.createElement("canvas"),t=e.getContext("2d");return e.width=e.height=256,t.fillStyle=n,t.fillRect(0,0,e.width,e.height),new Cesium.ImageMaterialProperty({image:e})}console.assert(!1,"impossible")};k.convertUrlToCesium=function(n){let e="";const t=/\{(\d|[a-z])-(\d|[a-z])\}/,i=t.exec(n);if(i){n=n.replace(t,"{s}");const s=i[1].charCodeAt(0),r=i[2].charCodeAt(0);let o;for(o=s;o<=r;++o)e+=String.fromCharCode(o)}return{url:n,subdomains:e}};k.resetToNorthZenith=function(n,e){return new Promise((t,i)=>{const s=e.camera,r=k.pickBottomPoint(e);if(!r){i("Could not get bottom pivot");return}const o=n.getView().getRotation();if(o===void 0){i("The view is not initialized");return}const a=k.computeAngleToZenith(e,r);k.setHeadingUsingBottomCenter(e,o,r);const l=Cesium.Matrix4.fromTranslation(r),h=s.right,c={callback:()=>{const d=n.getView();k.normalizeView(d),t()}};k.rotateAroundAxis(s,-a,h,l,c)})};k.rotateAroundBottomCenter=function(n,e){return new Promise((t,i)=>{const s=n.camera,r=k.pickBottomPoint(n);if(!r){i("could not get bottom pivot");return}const o={callback:t},a=Cesium.Matrix4.fromTranslation(r),l=s.right,h=k.rotateAroundAxis;h(s,-e,l,a,o)})};k.normalizeView=function(n,e=0){const t=n.getResolution();n.setRotation(e),n.constrainResolution?n.setResolution(n.constrainResolution(t)):n.setResolution(n.getConstrainedResolution(t))};k.isCesiumProjection=function(n){const e=n.getCode()==="EPSG:3857",t=n.getCode()==="EPSG:4326";return e||t};function eo(n,e,t,i){const s={viewState:{zoom:e,center:t},extent:i};if(!n)return[];let r=n(s);return Array.isArray(r)||(r=[r]),r.map(o=>new Cesium.Credit(o,!0))}function E_(n,e,t,i){const s=t.canvas,o=t.camera.frustum.fovy;console.assert(!isNaN(o));const a=i.getMetersPerUnit(),l=n*s.clientHeight,h=Math.cos(Math.abs(e));return l*a*h/2/Math.tan(o/2)}function I_(n,e,t,i){const s=t.canvas,o=t.camera.frustum.fovy;console.assert(!isNaN(o));const a=i.getMetersPerUnit(),l=2*n*Math.tan(o/2),h=Math.cos(Math.abs(e));return l/a/h/s.clientHeight}class R_{constructor(e){this.ol3d=e,this.scene_=e.getCesiumScene(),this.canvas_=this.scene_.canvas,this._boundNotifyRepaintRequired=this.notifyRepaintRequired.bind(this),this.repaintEventNames_=["mousemove","mousedown","mouseup","touchstart","touchend","touchmove","pointerdown","pointerup","pointermove","wheel"],this.enable()}enable(){this.scene_.requestRenderMode=!0,this.scene_.maximumRenderTimeChange=1e3;for(const e of this.repaintEventNames_)this.canvas_.addEventListener(e,this._boundNotifyRepaintRequired,!1);window.addEventListener("resize",this._boundNotifyRepaintRequired,!1),this.ol3d.getOlMap().getLayerGroup().on("change",this._boundNotifyRepaintRequired)}disable(){for(const e of this.repaintEventNames_)this.canvas_.removeEventListener(e,this._boundNotifyRepaintRequired,!1);window.removeEventListener("resize",this._boundNotifyRepaintRequired,!1),this.ol3d.getOlMap().getLayerGroup().un("change",this._boundNotifyRepaintRequired),this.scene_.requestRenderMode=!1}restartRenderLoop(){this.notifyRepaintRequired()}notifyRepaintRequired(){this.scene_.requestRender()}}function vi(n){return n*180/Math.PI}function Ot(n){return n*Math.PI/180}class ut{constructor(e,t){this.scene_=e,this.cam_=e.camera,this.map_=t,this.view_=null,this.viewListenKey_=null,this.toLonLat_=ut.identityProjection,this.fromLonLat_=ut.identityProjection,this.tilt_=0,this.distance_=0,this.lastCameraViewMatrix_=null,this.viewUpdateInProgress_=!1,this.map_.on("change:view",i=>{this.setView_(this.map_.getView())}),this.setView_(this.map_.getView())}static identityProjection(e,t,i){const s=i||e.length;if(t)for(let r=0;r<s;++r)t[r]=e[r];return e}setView_(e){if(this.view_&&(ze(this.viewListenKey_),this.viewListenKey_=null),this.view_=e,e){const t=xs(e.getProjection(),"EPSG:4326"),i=xs("EPSG:4326",e.getProjection());console.assert(t&&i),this.toLonLat_=t,this.fromLonLat_=i,this.viewListenKey_=e.on("propertychange",s=>this.handleViewEvent_(s)),this.readFromView()}else this.toLonLat_=ut.identityProjection,this.fromLonLat_=ut.identityProjection}handleViewEvent_(e){this.viewUpdateInProgress_||this.readFromView()}setHeading(e){this.view_&&this.view_.setRotation(e)}getHeading(){return this.view_?this.view_.getRotation()||0:void 0}setTilt(e){this.tilt_=e,this.updateCamera_()}getTilt(){return this.tilt_}setDistance(e){this.distance_=e,this.updateCamera_(),this.updateView()}getDistance(){return this.distance_}setCenter(e){this.view_&&this.view_.setCenter(e)}getCenter(){if(this.view_)return this.view_.getCenter()}setPosition(e){if(!this.toLonLat_)return;const t=this.toLonLat_(e);console.assert(t);const i=new Cesium.Cartographic(Ot(t[0]),Ot(t[1]),this.getAltitude());this.cam_.setView({destination:Cesium.Ellipsoid.WGS84.cartographicToCartesian(i)}),this.updateView()}getPosition(){if(!this.fromLonLat_)return;const e=Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position),t=this.fromLonLat_([vi(e.longitude),vi(e.latitude)]);return console.assert(t),t}setAltitude(e){const t=Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position);t.height=e,this.cam_.position=Cesium.Ellipsoid.WGS84.cartographicToCartesian(t),this.updateView()}getAltitude(){return Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position).height}updateCamera_(){if(!this.view_||!this.toLonLat_)return;const e=this.view_.getCenter();if(!e)return;const t=this.toLonLat_(e);console.assert(t);const i=new Cesium.Cartographic(Ot(t[0]),Ot(t[1]));if(this.scene_.globe){const o=this.scene_.globe.getHeight(i);i.height=o||0}const s=Cesium.Ellipsoid.WGS84.cartographicToCartesian(i),r={pitch:this.tilt_-Cesium.Math.PI_OVER_TWO,heading:-this.view_.getRotation(),roll:void 0};this.cam_.setView({destination:s,orientation:r}),this.cam_.moveBackward(this.distance_),this.checkCameraChange(!0)}readFromView(){if(!this.view_||!this.toLonLat_)return;const e=this.view_.getCenter();if(e==null)return;const t=this.toLonLat_(e);console.assert(t);const i=this.view_.getResolution();this.distance_=this.calcDistanceForResolution(i||0,Ot(t[1])),this.updateCamera_()}updateView(){if(!this.view_||!this.fromLonLat_)return;this.viewUpdateInProgress_=!0;const e=Cesium.Ellipsoid.WGS84,t=this.scene_,i=k.pickCenterPoint(t);let s=i;if(!s){const o=t.globe,a=this.cam_.positionCartographic.clone(),l=o.getHeight(a);a.height=l||0,s=Cesium.Ellipsoid.WGS84.cartographicToCartesian(a)}this.distance_=Cesium.Cartesian3.distance(s,this.cam_.position);const r=e.cartesianToCartographic(s);if(this.view_.setCenter(this.fromLonLat_([vi(r.longitude),vi(r.latitude)])),this.view_.setResolution(this.calcResolutionForDistance(this.distance_,r?r.latitude:0)),i){const o=this.cam_.position,a=new Cesium.Cartesian3;e.geocentricSurfaceNormal(i,a);const l=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(o,i,l),Cesium.Cartesian3.normalize(l,l);const h=this.cam_.up,c=this.cam_.right,d=new Cesium.Cartesian3(-i.y,i.x,0),u=Cesium.Cartesian3.angleBetween(c,d),g=Cesium.Cartesian3.cross(i,h,new Cesium.Cartesian3).z;this.view_.setRotation(g<0?u:-u);const _=Math.acos(Cesium.Cartesian3.dot(a,l));this.tilt_=isNaN(_)?0:_}else this.view_.setRotation(this.cam_.heading),this.tilt_=-this.cam_.pitch+Math.PI/2;this.viewUpdateInProgress_=!1}checkCameraChange(e){const t=this.lastCameraViewMatrix_,i=this.cam_.viewMatrix;(!t||!Cesium.Matrix4.equalsEpsilon(t,i,1e-5))&&(this.lastCameraViewMatrix_=i.clone(),e!==!0&&this.updateView())}calcDistanceForResolution(e,t){return E_(e,t,this.scene_,this.view_.getProjection())}calcResolutionForDistance(e,t){return I_(e,t,this.scene_,this.view_.getProjection())}}class to{constructor(e,t){this.map=e,this.view=e.getView(),this.scene=t,this.olLayers=e.getLayerGroup().getLayers(),this.mapLayerGroup=e.getLayerGroup(),this.layerMap={},this.olLayerListenKeys={},this.olGroupListenKeys_={}}synchronize(){this.destroyAll(),this.addLayers_(this.mapLayerGroup)}orderLayers(){}addLayers_(e){const t=[{layer:e,parents:[]}];for(;t.length>0;){const i=t.splice(0,1)[0],s=i.layer,r=Q(s).toString();this.olLayerListenKeys[r]=[],console.assert(!this.layerMap[r]);let o=null;if(s instanceof Cs)this.listenForGroupChanges_(s),s!==this.mapLayerGroup&&(o=this.createSingleLayerCounterparts(i)),o||s.getLayers().forEach(a=>{if(a){const l={layer:a,parents:s===this.mapLayerGroup?[]:[i.layer].concat(i.parents)};t.push(l)}});else if(o=this.createSingleLayerCounterparts(i),!o){const a=r,l=i,h=c=>{const d=this.createSingleLayerCounterparts(l);d&&(l.layer.un("change",h),this.addCesiumObjects_(d,a,l.layer),this.orderLayers())};this.olLayerListenKeys[r].push(dt(l.layer,"change",h))}o&&this.addCesiumObjects_(o,r,s)}this.orderLayers()}addCesiumObjects_(e,t,i){this.layerMap[t]=e,this.olLayerListenKeys[t].push(dt(i,"change:zIndex",()=>this.orderLayers())),e.forEach(s=>{this.addCesiumObject(s)})}removeAndDestroySingleLayer_(e){const t=Q(e).toString(),i=this.layerMap[t];return i&&(i.forEach(s=>{this.removeSingleCesiumObject(s,!1),this.destroyCesiumObject(s)}),this.olLayerListenKeys[t].forEach(ze),delete this.olLayerListenKeys[t]),delete this.layerMap[t],!!i}unlistenSingleGroup_(e){if(e===this.mapLayerGroup)return;const t=Q(e).toString();this.olGroupListenKeys_[t].forEach(s=>{ze(s)}),delete this.olGroupListenKeys_[t],delete this.layerMap[t]}removeLayer_(e){if(e){const t=[e];for(;t.length>0;){const i=t.splice(0,1)[0],s=this.removeAndDestroySingleLayer_(i);i instanceof Cs&&(this.unlistenSingleGroup_(i),s||i.getLayers().forEach(r=>{t.push(r)}))}}}listenForGroupChanges_(e){const t=Q(e).toString();console.assert(this.olGroupListenKeys_[t]===void 0);const i=[];this.olGroupListenKeys_[t]=i;let s=[];const r=(function(){const o=e.getLayers();o&&(s=[o.on("add",a=>{this.addLayers_(a.element)}),o.on("remove",a=>{this.removeLayer_(a.element)})],i.push(...s))}).bind(this);r(),i.push(e.on("change:layers",o=>{s.forEach(a=>{const l=i.indexOf(a);l>=0&&i.splice(l,1),ze(a)}),r()}))}destroyAll(){this.removeAllCesiumObjects(!0);let e;for(e in this.olGroupListenKeys_)this.olGroupListenKeys_[e].forEach(ze);for(e in this.olLayerListenKeys)this.olLayerListenKeys[e].forEach(ze);this.olGroupListenKeys_={},this.olLayerListenKeys={},this.layerMap={}}addCesiumObject(e){}destroyCesiumObject(e){}removeSingleCesiumObject(e,t){}removeAllCesiumObjects(e){}createSingleLayerCounterparts(e){}}class F_ extends to{constructor(e,t){super(e,t),this.cesiumLayers_=t.imageryLayers,this.ourLayers_=new Cesium.ImageryLayerCollection}addCesiumObject(e){this.cesiumLayers_.add(e),this.ourLayers_.add(e)}destroyCesiumObject(e){e.destroy()}removeSingleCesiumObject(e,t){this.cesiumLayers_.remove(e,t),this.ourLayers_.remove(e,!1)}removeAllCesiumObjects(e){for(let t=0;t<this.ourLayers_.length;++t)this.cesiumLayers_.remove(this.ourLayers_.get(t),e);this.ourLayers_.removeAll(!1)}convertLayerToCesiumImageries(e,t){const i=k.tileLayerToImageryLayer(this.map,e,t);return i?[i]:null}createSingleLayerCounterparts(e){const t=e.layer,i=Q(t).toString(),s=this.view.getProjection();console.assert(s);const r=this.convertLayerToCesiumImageries(t,s);if(r){const o=[];if([e.layer].concat(e.parents).forEach(a=>{o.push(a.on(["change:opacity","change:visible"],()=>{console.assert(r);for(let l=0;l<r.length;++l)k.updateCesiumLayerProperties(e,r[l])}))}),t.getStyleFunction){let a=t.getStyleFunction();o.push(t.on("change",()=>{const l=t.getStyleFunction();if(a!==l){a=l;for(let h=0;h<r.length;++h){const c=r[h];c._imageryCache&&c.imageryProvider.cache_&&(c._imageryCache={},c.imageryProvider.cache_={},c.imageryProvider.styleFunction_=l)}this.scene.requestRender()}}))}for(let a=0;a<r.length;++a)k.updateCesiumLayerProperties(e,r[a]);o.push(t.on("change:extent",a=>{for(let l=0;l<r.length;++l)this.cesiumLayers_.remove(r[l],!0),this.ourLayers_.remove(r[l],!1);delete this.layerMap[Q(t)],this.synchronize()})),o.push(t.on("change",a=>{for(let l=0;l<r.length;++l){const h=this.cesiumLayers_.indexOf(r[l]);h>=0&&(this.cesiumLayers_.remove(r[l],!1),this.cesiumLayers_.add(r[l],h))}})),this.olLayerListenKeys[i].push(...o)}return Array.isArray(r)?r:null}orderLayers(){const e=[],t={},i=[this.mapLayerGroup];for(;i.length>0;){const s=i.splice(0,1)[0];if(e.push(s),t[Q(s)]=s.getZIndex()||0,s instanceof Cs){const r=s.getLayers();r&&i.unshift(...r.getArray())}}C_(e,(s,r)=>t[Q(s)]-t[Q(r)]),e.forEach(s=>{const r=Q(s).toString(),o=this.layerMap[r];o&&o.forEach(a=>{this.raiseToTop(a)})})}raiseToTop(e){this.cesiumLayers_.raiseToTop(e)}}class k_{constructor(e,t){const i=new Cesium.BillboardCollection({scene:t}),s=new Cesium.PrimitiveCollection;this.olListenKeys=[],this.rootCollection_=new Cesium.PrimitiveCollection,this.context={projection:e,billboards:i,featureToCesiumMap:{},primitives:s},this.rootCollection_.add(i),this.rootCollection_.add(s)}destroy(){this.olListenKeys.forEach(ze),this.olListenKeys.length=0}getRootPrimitive(){return this.rootCollection_}}class M_{constructor(e){this.scene=e,this.boundOnRemoveOrClearFeatureListener_=this.onRemoveOrClearFeature_.bind(this),this.defaultBillboardEyeOffset_=new Cesium.Cartesian3(0,0,10)}onRemoveOrClearFeature_(e){const t=e.target;console.assert(t instanceof Oe);const i=Z.obj(t).olcs_cancellers;if(i){const s=e.feature;if(s){const r=Q(s),o=i[r];o&&(o(),delete i[r])}else{for(const r in i)i.hasOwnProperty(r)&&i[r]();Z.obj(t).olcs_cancellers={}}}}setReferenceForPicking(e,t,i){i.olLayer=e,i.olFeature=t}createColoredPrimitive(e,t,i,s,r,o){const a=function(u,f){const g=new Cesium.GeometryInstance({geometry:u});return f&&!(f instanceof Cesium.ImageMaterialProperty)&&(g.attributes={color:Cesium.ColorGeometryInstanceAttribute.fromColor(f)}),g},l={flat:!0,renderState:{depthTest:{enabled:!0}}};o!==void 0&&(l.renderState||(l.renderState={}),l.renderState.lineWidth=o);const h=a(s,r),c=this.getHeightReference(e,t,i);let d;if(c===Cesium.HeightReference.CLAMP_TO_GROUND){const u=h.geometry.constructor;if(u&&!u.createShadowVolume)return null;d=new Cesium.GroundPrimitive({geometryInstances:h})}else d=new Cesium.Primitive({geometryInstances:h});if(r instanceof Cesium.ImageMaterialProperty){const u=r.image.getValue().toDataURL();d.appearance=new Cesium.MaterialAppearance({flat:!0,renderState:{depthTest:{enabled:!0}},material:new Cesium.Material({fabric:{type:"Image",uniforms:{image:u}}})})}else d.appearance=new Cesium.PerInstanceColorAppearance(l);return this.setReferenceForPicking(e,t,d),d}extractColorFromOlStyle(e,t){const i=e.getFill()?e.getFill().getColor():null,s=e.getStroke()?e.getStroke().getColor():null;let r="black";return s&&t?r=s:i&&(r=i),k.convertColorToCesium(r)}extractLineWidthFromOlStyle(e){const t=e.getStroke()?e.getStroke().getWidth():void 0;return t!==void 0?t:1}wrapFillAndOutlineGeometries(e,t,i,s,r,o){const a=this.extractColorFromOlStyle(o,!1),l=this.extractColorFromOlStyle(o,!0),h=new Cesium.PrimitiveCollection;if(o.getFill()){const c=this.createColoredPrimitive(e,t,i,s,a);console.assert(!!c),h.add(c)}if(o.getStroke()&&r){const c=this.extractLineWidthFromOlStyle(o),d=this.createColoredPrimitive(e,t,i,r,l,c);d&&h.add(d)}return h}addTextStyle(e,t,i,s,r){let o;if(r instanceof Cesium.PrimitiveCollection?o=r:(o=new Cesium.PrimitiveCollection,o.add(r)),!s.getText())return o;const a=s.getText(),l=this.olGeometry4326TextPartToCesium(e,t,i,a);return l&&o.add(l),o}csAddBillboard(e,t,i,s,r,o){t.eyeOffset||(t.eyeOffset=this.defaultBillboardEyeOffset_);const a=e.add(t);return this.setReferenceForPicking(i,s,a),a}olCircleGeometryToCesium(e,t,i,s,r){i=k.olGeometryCloneTo4326(i,s),console.assert(i.getType()=="Circle");let o=i.getCenter();const a=o.length==3?o[2]:0;let l=o.slice();l[0]+=i.getRadius(),o=k.ol4326CoordinateToCesiumCartesian(o),l=k.ol4326CoordinateToCesiumCartesian(l);const h=Cesium.Cartesian3.distance(o,l),c=new Cesium.CircleGeometry({center:o,radius:h,height:a});let d,u;if(this.getHeightReference(e,t,i)===Cesium.HeightReference.CLAMP_TO_GROUND){const g=this.extractLineWidthFromOlStyle(r);if(g){const _=Qa(i.getCenter(),h),p=k.ol4326CoordinateArrayToCsCartesians(_.getLinearRing(0).getCoordinates());if(us(this.scene))d=new Cesium.GroundPolylinePrimitive({geometryInstances:new Cesium.GeometryInstance({geometry:new Cesium.GroundPolylineGeometry({positions:p,width:g})}),appearance:new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(t,r,!0)}),classificationType:Cesium.ClassificationType.TERRAIN}),d.readyPromise.then(()=>{this.setReferenceForPicking(e,t,d._primitive)});else{const x=this.extractColorFromOlStyle(r,!0);d=this.createStackedGroundCorridors(e,t,g,x,p)}}}else u=new Cesium.CircleOutlineGeometry({center:o,radius:h,extrudedHeight:a,height:a});const f=this.wrapFillAndOutlineGeometries(e,t,i,c,u,r);return d&&f.add(d),this.addTextStyle(e,t,i,r,f)}createStackedGroundCorridors(e,t,i,s,r){Array.isArray(r[0])||(r=[r]),i=Math.max(3,i);const o=[];let a=0;for(const l of[1e3,4e3,16e3,64e3,254e3,1e6,1e7]){i*=2.14;const h={width:i,vertexFormat:Cesium.VertexFormat.POSITION_ONLY};for(const c of r)h.positions=c,o.push(new Cesium.GeometryInstance({geometry:new Cesium.CorridorGeometry(h),attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(s),distanceDisplayCondition:new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(a,l-1)}}));a=l}return new Cesium.GroundPrimitive({geometryInstances:o})}olLineStringGeometryToCesium(e,t,i,s,r){i=k.olGeometryCloneTo4326(i,s),console.assert(i.getType()=="LineString");const o=k.ol4326CoordinateArrayToCsCartesians(i.getCoordinates()),a=this.extractLineWidthFromOlStyle(r);let l;const h=this.getHeightReference(e,t,i);if(h===Cesium.HeightReference.CLAMP_TO_GROUND&&!us(this.scene)){const c=this.extractColorFromOlStyle(r,!0);l=this.createStackedGroundCorridors(e,t,a,c,o)}else{const c=new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(t,r,!0)}),d={positions:o,width:a},u={appearance:c};if(h===Cesium.HeightReference.CLAMP_TO_GROUND){const f=new Cesium.GroundPolylineGeometry(d);u.geometryInstances=new Cesium.GeometryInstance({geometry:f}),l=new Cesium.GroundPolylinePrimitive(u),l.readyPromise.then(()=>{this.setReferenceForPicking(e,t,l._primitive)})}else{d.vertexFormat=c.vertexFormat;const f=new Cesium.PolylineGeometry(d);u.geometryInstances=new Cesium.GeometryInstance({geometry:f}),l=new Cesium.Primitive(u)}}return this.setReferenceForPicking(e,t,l),this.addTextStyle(e,t,i,r,l)}olPolygonGeometryToCesium(e,t,i,s,r){i=k.olGeometryCloneTo4326(i,s),console.assert(i.getType()=="Polygon");const o=this.getHeightReference(e,t,i);let a,l,h;if(i.getCoordinates()[0].length==5&&t.getGeometry().get("olcs.polygon_kind")==="rectangle"){const d=i.getCoordinates()[0],u=dr(d),f=Cesium.Rectangle.fromDegrees(u[0],u[1],u[2],u[3]);let g=0;if(d[0].length==3)for(let _=0;_<d.length;_++)g=Math.max(g,d[_][2]);a=new Cesium.RectangleGeometry({ellipsoid:Cesium.Ellipsoid.WGS84,rectangle:f,height:g}),l=new Cesium.RectangleOutlineGeometry({ellipsoid:Cesium.Ellipsoid.WGS84,rectangle:f,height:g})}else{const d=i.getLinearRings(),u={},f=u;console.assert(d.length>0);for(let g=0;g<d.length;++g){const _=d[g].getCoordinates(),p=k.ol4326CoordinateArrayToCsCartesians(_);console.assert(p&&p.length>0),g==0?u.positions=p:(u.holes||(u.holes=[]),u.holes.push({positions:p}))}if(a=new Cesium.PolygonGeometry({polygonHierarchy:f,perPositionHeight:!0}),o===Cesium.HeightReference.CLAMP_TO_GROUND){const g=this.extractLineWidthFromOlStyle(r);if(g>0){const _=[u.positions];if(u.holes)for(let p=0;p<u.holes.length;++p)_.push(u.holes[p].positions);if(us(this.scene)){const p=new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(t,r,!0)}),x=[];for(const w of _){const R=new Cesium.GroundPolylineGeometry({positions:w,width:g});x.push(new Cesium.GeometryInstance({geometry:R}))}const y={appearance:p,geometryInstances:x};h=new Cesium.GroundPolylinePrimitive(y),h.readyPromise.then(()=>{this.setReferenceForPicking(e,t,h._primitive)})}else{const p=this.extractColorFromOlStyle(r,!0);h=this.createStackedGroundCorridors(e,t,g,p,_)}}}else l=new Cesium.PolygonOutlineGeometry({polygonHierarchy:u,perPositionHeight:!0})}const c=this.wrapFillAndOutlineGeometries(e,t,i,a,l,r);return h&&c.add(h),this.addTextStyle(e,t,i,r,c)}getHeightReference(e,t,i){let s=i.get("altitudeMode");s===void 0&&(s=t.get("altitudeMode")),s===void 0&&(s=e.get("altitudeMode"));let r=Cesium.HeightReference.NONE;return s==="clampToGround"?r=Cesium.HeightReference.CLAMP_TO_GROUND:s==="relativeToGround"&&(r=Cesium.HeightReference.RELATIVE_TO_GROUND),r}createBillboardFromImage(e,t,i,s,r,o,a,l){o instanceof St&&o.load();const h=o.getImage(1),c=function(u){return u.src!=""&&u.naturalHeight!=0&&u.naturalWidth!=0&&u.complete},d=(function(){if(!h||!(h instanceof HTMLCanvasElement||h instanceof Image||h instanceof HTMLImageElement))return;const u=i.getCoordinates(),f=k.ol4326CoordinateToCesiumCartesian(u);let g;const _=o.getOpacity();_!==void 0&&(g=new Cesium.Color(1,1,1,_));const p=o.getScale(),x=this.getHeightReference(e,t,i),y={image:h,color:g,scale:p,heightReference:x,position:f};if(Object.assign(y,t.get("cesiumOptions")),o instanceof St){const R=o.getAnchor();R&&(y.pixelOffset=new Cesium.Cartesian2((h.width/2-R[0])*p,(h.height/2-R[1])*p))}const w=this.csAddBillboard(a,y,e,t,i,r);l&&l(w)}).bind(this);if(h instanceof Image&&!c(h)){let u=!1;const f=e.getSource(),g=function(){u=!0};f.on(["removefeature","clear"],this.boundOnRemoveOrClearFeatureListener_);let _=Z.obj(f).olcs_cancellers;_||(_=Z.obj(f).olcs_cancellers={});const p=Q(t);_[p]&&_[p](),_[p]=g;const x=function(){h.removeEventListener("load",x),!a.isDestroyed()&&!u&&d()};h.addEventListener("load",x)}else d()}olPointGeometryToCesium(e,t,i,s,r,o,a){console.assert(i.getType()=="Point"),i=k.olGeometryCloneTo4326(i,s);let l=null;const h=r.getImage();if(h){const c=i.get("olcs_model")||t.get("olcs_model");if(c){const d=c(),u=Object.assign({},{scene:this.scene},d.cesiumOptions),f=Cesium.Model.fromGltf(u);l=new Cesium.PrimitiveCollection,l.add(f),d.debugModelMatrix&&l.add(new Cesium.DebugModelMatrixPrimitive({modelMatrix:d.debugModelMatrix}))}else this.createBillboardFromImage(e,t,i,s,r,h,o,a)}return r.getText()?this.addTextStyle(e,t,i,r,l||new Cesium.Primitive):l}olMultiGeometryToCesium(e,t,i,s,r,o,a){const l=function(c,d){const u=new Cesium.PrimitiveCollection;return c.forEach(f=>{u.add(d(e,t,f,s,r))}),u};let h;switch(i.getType()){case"MultiPoint":if(i=i,h=i.getPoints(),r.getText()){const c=new Cesium.PrimitiveCollection;return h.forEach(d=>{console.assert(d);const u=this.olPointGeometryToCesium(e,t,d,s,r,o,a);u&&c.add(u)}),c}else return h.forEach(c=>{console.assert(c),this.olPointGeometryToCesium(e,t,c,s,r,o,a)}),null;case"MultiLineString":return i=i,h=i.getLineStrings(),l(h,this.olLineStringGeometryToCesium.bind(this));case"MultiPolygon":return i=i,h=i.getPolygons(),l(h,this.olPolygonGeometryToCesium.bind(this));default:console.assert(!1,`Unhandled multi geometry type${i.getType()}`)}}olGeometry4326TextPartToCesium(e,t,i,s){const r=s.getText();if(!r)return null;const o=new Cesium.LabelCollection({scene:this.scene}),a=vt(i.getExtent());if(i instanceof ei){const g=i.getFirstCoordinate();a[2]=g.length==3?g[2]:0}const l={};l.position=k.ol4326CoordinateToCesiumCartesian(a),l.text=r,l.heightReference=this.getHeightReference(e,t,i);const h=s.getOffsetX(),c=s.getOffsetY();if(h!=0&&c!=0){const g=new Cesium.Cartesian2(h,c);l.pixelOffset=g}l.font=s.getFont()||"10px sans-serif";let d;s.getFill()&&(l.fillColor=this.extractColorFromOlStyle(s,!1),d=Cesium.LabelStyle.FILL),s.getStroke()&&(l.outlineWidth=this.extractLineWidthFromOlStyle(s),l.outlineColor=this.extractColorFromOlStyle(s,!0),d=Cesium.LabelStyle.OUTLINE),s.getFill()&&s.getStroke()&&(d=Cesium.LabelStyle.FILL_AND_OUTLINE),l.style=d;let u;switch(s.getTextAlign()){case"left":u=Cesium.HorizontalOrigin.LEFT;break;case"right":u=Cesium.HorizontalOrigin.RIGHT;break;case"center":default:u=Cesium.HorizontalOrigin.CENTER}if(l.horizontalOrigin=u,s.getTextBaseline()){let g;switch(s.getTextBaseline()){case"top":g=Cesium.VerticalOrigin.TOP;break;case"middle":g=Cesium.VerticalOrigin.CENTER;break;case"bottom":g=Cesium.VerticalOrigin.BOTTOM;break;case"alphabetic":g=Cesium.VerticalOrigin.TOP;break;case"hanging":g=Cesium.VerticalOrigin.BOTTOM;break;default:console.assert(!1,`unhandled baseline ${s.getTextBaseline()}`)}l.verticalOrigin=g}const f=o.add(l);return this.setReferenceForPicking(e,t,f),o}olStyleToCesium(e,t,i){const s=t.getFill(),r=t.getStroke();if(i&&!r||!i&&!s)return null;let o=i?r.getColor():s.getColor();return o=k.convertColorToCesium(o),i&&r.getLineDash()?Cesium.Material.fromType("Stripe",{horizontal:!1,repeat:500,evenColor:o,oddColor:new Cesium.Color(0,0,0,0)}):Cesium.Material.fromType("Color",{color:o})}computePlainStyle(e,t,i,s){const r=t.getStyleFunction();let o=null;return r&&(o=r(t,s)),!o&&i&&(o=i(t,s)),o?Array.isArray(o)?o:[o]:null}getGeometryFromFeature(e,t,i){if(i)return i;const s=e.get("olcs.3d_geometry");if(s&&s instanceof ys)return s;if(t){const r=t.getGeometryFunction()(e);if(r instanceof ys)return r}return e.getGeometry()}olFeatureToCesium(e,t,i,s,r){let o=this.getGeometryFromFeature(t,i,r);if(!o)return null;const a=s.projection,l=function(h){const c=s.featureToCesiumMap[Q(t)];c instanceof Array?c.push(h):s.featureToCesiumMap[Q(t)]=[h]};switch(o.getType()){case"GeometryCollection":const h=new Cesium.PrimitiveCollection;return o.getGeometries().forEach(g=>{if(g){const _=this.olFeatureToCesium(e,t,i,s,g);_&&h.add(_)}}),h;case"Point":o=o;const d=s.billboards,u=this.olPointGeometryToCesium(e,t,o,a,i,d,l);return u||null;case"Circle":return o=o,this.olCircleGeometryToCesium(e,t,o,a,i);case"LineString":return o=o,this.olLineStringGeometryToCesium(e,t,o,a,i);case"Polygon":return o=o,this.olPolygonGeometryToCesium(e,t,o,a,i);case"MultiPoint":case"MultiLineString":case"MultiPolygon":const f=this.olMultiGeometryToCesium(e,t,o,a,i,s.billboards,l);return f||null;case"LinearRing":throw new Error("LinearRing should only be part of polygon.");default:throw new Error(`Ol geom type not handled : ${o.getType()}`)}}olVectorLayerToCesium(e,t,i){const s=t.getProjection(),r=t.getResolution();if(r===void 0||!s)throw console.assert(!1,"View not ready"),new Error("View not ready");let o=e.getSource();o instanceof Dr&&(o=o.getSource()),console.assert(o instanceof Oe);const a=o.getFeatures(),l=new k_(s,this.scene),h=l.context;for(let c=0;c<a.length;++c){const d=a[c];if(!d)continue;const u=e.getStyleFunction(),f=this.computePlainStyle(e,d,u,r);if(!f||!f.length)continue;let g=null;for(let _=0;_<f.length;_++){const p=this.olFeatureToCesium(e,d,f[_],h);if(p){if(!g)g=p;else if(p){let x=0,y;for(;y=p.get(x);)g.add(y),x++}}}g&&(i[Q(d)]=g,l.getRootPrimitive().add(g))}return l}convert(e,t,i,s){const r=t.getProjection(),o=t.getResolution();if(o==null||!r)return null;const a=e.getStyleFunction(),l=this.computePlainStyle(e,i,a,o);if(!l||!l.length)return null;s.projection=r;let h=null;for(let c=0;c<l.length;c++){const d=this.olFeatureToCesium(e,i,l[c],s);if(!h)h=d;else if(d){let u=0,f;for(;f=d.get(u);)h.add(f),u++}}return h}}class P_ extends to{constructor(e,t,i){super(e,t),this.converter=i||new M_(t),this.csAllPrimitives_=new Cesium.PrimitiveCollection,t.primitives.add(this.csAllPrimitives_),this.csAllPrimitives_.destroyPrimitives=!1}addCesiumObject(e){console.assert(e),e.getRootPrimitive().counterpart=e,this.csAllPrimitives_.add(e.getRootPrimitive())}destroyCesiumObject(e){e.getRootPrimitive().destroy()}removeSingleCesiumObject(e,t){e.destroy(),this.csAllPrimitives_.destroyPrimitives=t,this.csAllPrimitives_.remove(e.getRootPrimitive()),this.csAllPrimitives_.destroyPrimitives=!1}removeAllCesiumObjects(e){if(this.csAllPrimitives_.destroyPrimitives=e,e)for(let t=0;t<this.csAllPrimitives_.length;++t)this.csAllPrimitives_.get(t).counterpart.destroy();this.csAllPrimitives_.removeAll(),this.csAllPrimitives_.destroyPrimitives=!1}updateLayerVisibility(e,t){let i=!0;[e.layer].concat(e.parents).forEach(s=>{const r=s.getVisible();r!==void 0?i&=r:i=!1}),t.show=i}createSingleLayerCounterparts(e){const t=e.layer;if(!(t instanceof He)||t instanceof Wr)return null;console.assert(t instanceof qn);let i=t.getSource();if(i instanceof Dr&&(i=i.getSource()),!i)return null;console.assert(i instanceof Oe),console.assert(this.view);const s=this.view,r={},o=this.converter.olVectorLayerToCesium(t,s,r),a=o.getRootPrimitive(),l=o.olListenKeys;[e.layer].concat(e.parents).forEach(d=>{l.push(dt(d,"change:visible",()=>{this.updateLayerVisibility(e,a)}))}),this.updateLayerVisibility(e,a);const h=(function(d){console.assert(t instanceof He||t instanceof Rs);const u=o.context,f=this.converter.convert(t,s,d,u);f&&(r[Q(d)]=f,a.add(f))}).bind(this),c=(function(d){const u=Q(d),f=o.context,g=f.featureToCesiumMap[u];g&&(delete f.featureToCesiumMap[u],g.forEach(p=>{p instanceof Cesium.Billboard&&f.billboards.remove(p)}));const _=r[u];delete r[u],_&&a.remove(_)}).bind(this);return l.push(dt(i,"addfeature",d=>{console.assert(d.feature),h(d.feature)})),l.push(dt(i,"removefeature",d=>{console.assert(d.feature),c(d.feature)})),l.push(dt(i,"changefeature",d=>{const u=d.feature;console.assert(u),c(u),h(u)})),o?[o]:null}}class D_ extends Pr{constructor(e){const t=e.parent;super(t.getOptions()),this.scenePostRenderListenerRemover_=null,this.scene_=e.scene,this.synchronizer_=e.synchronizer,this.parent_=t,this.positionWGS84_=void 0,this.observer_=new MutationObserver(this.handleElementChanged.bind(this)),this.attributeObserver_=[],this.listenerKeys_=[];const i=s=>this.setPropertyFromEvent_(s);this.listenerKeys_.push(this.parent_.on("change:position",i)),this.listenerKeys_.push(this.parent_.on("change:element",i)),this.listenerKeys_.push(this.parent_.on("change:offset",i)),this.listenerKeys_.push(this.parent_.on("change:position",i)),this.listenerKeys_.push(this.parent_.on("change:positioning",i)),this.setProperties(this.parent_.getProperties()),this.handleMapChanged(),this.handleElementChanged()}observeTarget_(e){if(this.observer_){this.observer_.disconnect(),this.observer_.observe(e,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),this.attributeObserver_.forEach(t=>{t.disconnect()}),this.attributeObserver_.length=0;for(let t=0;t<e.childNodes.length;t++){const i=e.childNodes[t];if(i.nodeType===1){const s=new MutationObserver(this.handleElementChanged.bind(this));s.observe(i,{attributes:!0,subtree:!0}),this.attributeObserver_.push(s)}}}}setPropertyFromEvent_(e){e.target&&e.key&&this.set(e.key,e.target.get(e.key))}getScene(){return this.scene_}handleMapChanged(){this.scenePostRenderListenerRemover_&&(this.scenePostRenderListenerRemover_(),w_(this.element)),this.scenePostRenderListenerRemover_=null;const e=this.getScene();if(e){this.scenePostRenderListenerRemover_=e.postRender.addEventListener(this.updatePixelPosition.bind(this)),this.updatePixelPosition();const t=this.stopEvent?this.synchronizer_.getOverlayContainerStopEvent():this.synchronizer_.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element)}}handlePositionChanged(){const e=this.getPosition();if(e){const t=this.parent_.getMap().getView().getProjection();this.positionWGS84_=rr(e,t,"EPSG:4326")}else this.positionWGS84_=void 0;this.updatePixelPosition()}handleElementChanged(){function e(i,s){const r=i.cloneNode();i.nodeName==="CANVAS"&&r.getContext("2d").drawImage(i,0,0),s&&s.appendChild(r),i.nodeType!=Node.TEXT_NODE&&r.addEventListener("click",a=>{i.dispatchEvent(new MouseEvent("click",a)),a.stopPropagation()});const o=i.childNodes;for(let a=0;a<o.length;a++)o[a]&&e(o[a],r);return r}S_(this.element);const t=this.getElement();if(t&&t.parentNode&&t.parentNode.childNodes)for(const i of t.parentNode.childNodes){const s=e(i,null);this.element.appendChild(s)}t.parentNode&&this.observeTarget_(t.parentNode)}updatePixelPosition(){const e=this.positionWGS84_;if(!this.scene_||!e){this.setVisible(!1);return}let t=0;if(e.length===2){const d=this.scene_.globe.getHeight(Cesium.Cartographic.fromDegrees(e[0],e[1]));d&&this.scene_.globe.tilesLoaded&&(e[2]=d),d&&(t=d)}else t=e[2];const i=Cesium.Cartesian3.fromDegrees(e[0],e[1],t),s=this.scene_.camera,r=new Cesium.BoundingSphere(new Cesium.Cartesian3,6356752);if(!new Cesium.Occluder(r,s.position).isPointVisible(i)){this.setVisible(!1);return}if(s.frustum.computeCullingVolume(s.position,s.direction,s.up).computeVisibility(new Cesium.BoundingSphere(i))!==1){this.setVisible(!1);return}this.setVisible(!0);const l=this.scene_.cartesianToCanvasCoordinates(i),h=[l.x,l.y],c=[this.scene_.canvas.width,this.scene_.canvas.height];this.updateRenderedPosition(h,c)}destroy(){this.scenePostRenderListenerRemover_&&this.scenePostRenderListenerRemover_(),this.observer_&&this.observer_.disconnect(),ze(this.listenerKeys_),this.listenerKeys_.splice(0),this.element.removeNode?this.element.removeNode(!0):this.element.remove(),this.element=null}}class O_{constructor(e,t){this.map=e,this.overlays_=this.map.getOverlays(),this.scene=t,this.overlayContainerStopEvent_=document.createElement("DIV"),this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",["click","dblclick","mousedown","touchstart","MSPointerDown","pointerdown","mousewheel","wheel"].forEach(s=>{this.overlayContainerStopEvent_.addEventListener(s,r=>r.stopPropagation())}),this.scene.canvas.parentElement.appendChild(this.overlayContainerStopEvent_),this.overlayContainer_=document.createElement("DIV"),this.overlayContainer_.className="ol-overlaycontainer",this.scene.canvas.parentElement.appendChild(this.overlayContainer_),this.overlayMap_={}}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOverlayContainer(){return this.overlayContainer_}synchronize(){this.destroyAll(),this.addOverlays(),this.overlays_.on("add",this.addOverlayFromEvent_.bind(this)),this.overlays_.on("remove",this.removeOverlayFromEvent_.bind(this))}addOverlayFromEvent_(e){const t=e.element;this.addOverlay(t)}addOverlays(){this.overlays_.forEach(e=>{this.addOverlay(e)})}addOverlay(e){if(!e)return;const t=new D_({scene:this.scene,synchronizer:this,parent:e}),i=Q(e).toString();this.overlayMap_[i]=t}removeOverlayFromEvent_(e){const t=e.element;this.removeOverlay(t)}removeOverlay(e){const t=Q(e).toString(),i=this.overlayMap_[t];i&&(i.destroy(),delete this.overlayMap_[t])}destroyAll(){Object.keys(this.overlayMap_).forEach(e=>{this.overlayMap_[e].destroy(),delete this.overlayMap_[e]})}}class jt{constructor(e){this.autoRenderLoop_=null,this.map_=e.map,this.time_=e.time||function(){return Cesium.JulianDate.now()},this.to4326Transform_=xs(this.map_.getView().getProjection(),"EPSG:4326"),this.resolutionScale_=1,this.canvasClientWidth_=0,this.canvasClientHeight_=0,this.resolutionScaleChanged_=!0;const t="position:absolute;top:0;left:0;width:100%;height:100%;";this.container_=document.createElement("DIV");const i=document.createAttribute("style");i.value=`${t}visibility:hidden;`,this.container_.setAttributeNode(i);let s=e.target||this.map_.getViewport();if(typeof s=="string"&&(s=document.getElementById(s)),s.appendChild(this.container_),this.isOverMap_=!e.target,this.isOverMap_&&e.stopOpenLayersEventsPropagation){const d=["click","dblclick","mousedown","touchstart","MSPointerDown","pointerdown","mousewheel","wheel"];for(let u=0,f=d.length;u<f;++u)this.container_.addEventListener(d[u],g=>g.stopPropagation())}this.canvas_=document.createElement("CANVAS");const r=document.createAttribute("style");r.value=t,this.canvas_.setAttributeNode(r),Z.supportsImageRenderingPixelated()&&(this.canvas_.style.imageRendering=Z.imageRenderingValue()),this.canvas_.oncontextmenu=function(){return!1},this.canvas_.onselectstart=function(){return!1},this.container_.appendChild(this.canvas_),this.enabled_=!1,this.pausedInteractions_=[],this.hiddenRootGroup_=null;const o=e.sceneOptions!==void 0?e.sceneOptions:{};o.canvas=this.canvas_,o.scene3DOnly=!0,this.scene_=new Cesium.Scene(o);const a=this.scene_.screenSpaceCameraController;a.tiltEventTypes.push({eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.SHIFT}),a.tiltEventTypes.push({eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.ALT}),a.enableLook=!1,this.scene_.camera.constrainedAxis=Cesium.Cartesian3.UNIT_Z,this.camera_=new ut(this.scene_,this.map_),this.globe_=new Cesium.Globe(Cesium.Ellipsoid.WGS84),this.globe_.baseColor=Cesium.Color.WHITE,this.scene_.globe=this.globe_,this.scene_.skyAtmosphere=new Cesium.SkyAtmosphere;const l=new Cesium.SingleTileImageryProvider({url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",rectangle:Cesium.Rectangle.fromDegrees(0,0,1,1)});this.globe_.imageryLayers.addImageryProvider(l,0),this.dataSourceCollection_=new Cesium.DataSourceCollection,this.dataSourceDisplay_=new Cesium.DataSourceDisplay({scene:this.scene_,dataSourceCollection:this.dataSourceCollection_});const h=e.createSynchronizers?e.createSynchronizers(this.map_,this.scene_,this.dataSourceCollection_):[new F_(this.map_,this.scene_),new P_(this.map_,this.scene_),new O_(this.map_,this.scene_)];this.handleResize_();for(let d=h.length-1;d>=0;--d)h[d].synchronize();this.lastFrameTime_=0,this.renderId_=void 0,this.targetFrameRate_=Number.POSITIVE_INFINITY,this.blockCesiumRendering_=!1,this.warmingUp_=!1,this.trackedFeature_=null,this.trackedEntity_=null,this.entityView_=null,this.needTrackedEntityUpdate_=!1,this.boundingSphereScratch_=new Cesium.BoundingSphere,new Cesium.EventHelper().add(this.scene_.postRender,jt.prototype.updateTrackedEntity_,this),Cesium.Camera.enableSuspendTerrainAdjustment=!1}render_(){this.renderId_!==void 0&&(cancelAnimationFrame(this.renderId_),this.renderId_=void 0),(this.enabled_||this.warmingUp_)&&!this.blockCesiumRendering_&&(this.renderId_=requestAnimationFrame(this.onAnimationFrame_.bind(this)))}onAnimationFrame_(e){this.renderId_=void 0;const t=1e3/this.targetFrameRate_;if(e-this.lastFrameTime_<t){this.render_();return}this.lastFrameTime_=e;const s=this.time_();if(this.scene_.initializeFrame(),this.handleResize_(),this.dataSourceDisplay_.update(s),this.entityView_){const r=this.trackedEntity_;this.dataSourceDisplay_.getBoundingSphere(r,!1,this.boundingSphereScratch_)===Cesium.BoundingSphereState.DONE&&(this.boundingSphereScratch_.radius=1,this.entityView_.update(s,this.boundingSphereScratch_))}this.scene_.render(s),this.camera_.checkCameraChange(),this.render_()}updateTrackedEntity_(){if(!this.needTrackedEntityUpdate_)return;const e=this.trackedEntity_,t=this.scene_,i=this.dataSourceDisplay_.getBoundingSphere(e,!1,this.boundingSphereScratch_);if(i===Cesium.BoundingSphereState.PENDING)return;t.screenSpaceCameraController.enableTilt=!1;const s=i!==Cesium.BoundingSphereState.FAILED?this.boundingSphereScratch_:void 0;s&&(s.radius=1),this.entityView_=new Cesium.EntityView(e,t,t.mapProjection.ellipsoid),this.entityView_.update(this.time_(),s),this.needTrackedEntityUpdate_=!1}handleResize_(){let e=this.canvas_.clientWidth,t=this.canvas_.clientHeight;if(e===0|t===0||e===this.canvasClientWidth_&&t===this.canvasClientHeight_&&!this.resolutionScaleChanged_)return;let i=this.resolutionScale_;Z.supportsImageRenderingPixelated()||(i*=window.devicePixelRatio||1),this.resolutionScaleChanged_=!1,this.canvasClientWidth_=e,this.canvasClientHeight_=t,e*=i,t*=i,this.canvas_.width=e,this.canvas_.height=t,this.scene_.camera.frustum.aspectRatio=e/t}getCamera(){return this.camera_}getOlMap(){return this.map_}getOlView(){const e=this.map_.getView();return console.assert(e),e}getCesiumScene(){return this.scene_}getDataSources(){return this.dataSourceCollection_}getDataSourceDisplay(){return this.dataSourceDisplay_}getEnabled(){return this.enabled_}setEnabled(e){if(this.enabled_===e)return;this.enabled_=e,this.container_.style.visibility=this.enabled_?"visible":"hidden";let t;if(this.enabled_){if(this.throwOnUnitializedMap_(),this.isOverMap_){t=this.map_.getInteractions(),t.forEach((s,r,o)=>{this.pausedInteractions_.push(s)}),t.clear(),this.map_.addInteraction=s=>this.pausedInteractions_.push(s),this.map_.removeInteraction=s=>this.pausedInteractions_=this.pausedInteractions_.filter(r=>r!==s);const i=this.map_.getLayerGroup();i.getVisible()&&(this.hiddenRootGroup_=i,this.hiddenRootGroup_.setVisible(!1)),this.map_.getOverlayContainer().classList.add("olcs-hideoverlay")}this.camera_.readFromView(),this.render_()}else this.isOverMap_&&(t=this.map_.getInteractions(),this.pausedInteractions_.forEach(i=>{t.push(i)}),this.pausedInteractions_.length=0,this.map_.addInteraction=i=>this.map_.getInteractions().push(i),this.map_.removeInteraction=i=>this.map_.getInteractions().remove(i),this.map_.getOverlayContainer().classList.remove("olcs-hideoverlay"),this.hiddenRootGroup_&&(this.hiddenRootGroup_.setVisible(!0),this.hiddenRootGroup_=null)),this.camera_.updateView()}warmUp(e,t){if(this.enabled_)return;this.throwOnUnitializedMap_(),this.camera_.readFromView();const i=this.globe_.ellipsoid,s=this.scene_.camera,r=i.cartesianToCartographic(s.position);r.height<e&&(r.height=e,s.position=i.cartographicToCartesian(r)),this.warmingUp_=!0,this.render_(),setTimeout(()=>{this.warmingUp_=!1},t)}setBlockCesiumRendering(e){this.blockCesiumRendering_!==e&&(this.blockCesiumRendering_=e,this.render_())}enableAutoRenderLoop(){this.autoRenderLoop_||(this.autoRenderLoop_=new R_(this))}getAutoRenderLoop(){return this.autoRenderLoop_}setResolutionScale(e){e=Math.max(0,e),e!==this.resolutionScale_&&(this.resolutionScale_=Math.max(0,e),this.resolutionScaleChanged_=!0,this.autoRenderLoop_&&this.autoRenderLoop_.restartRenderLoop())}setTargetFrameRate(e){this.targetFrameRate_!==e&&(this.targetFrameRate_=e,this.render_())}throwOnUnitializedMap_(){const t=this.map_.getView(),i=t.getCenter();if(!t.isDef()||isNaN(i[0])||isNaN(i[1]))throw new Error(`The OpenLayers map is not properly initialized: ${i} / ${t.getResolution()}`)}get trackedFeature(){return this.trackedFeature_}set trackedFeature(e){if(this.trackedFeature_!==e){const t=this.scene_;if(!e||!e.getGeometry()){this.needTrackedEntityUpdate_=!1,t.screenSpaceCameraController.enableTilt=!0,this.trackedEntity_&&this.dataSourceDisplay_.defaultDataSource.entities.remove(this.trackedEntity_),this.trackedEntity_=null,this.trackedFeature_=null,this.entityView_=null,t.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);return}this.trackedFeature_=e,this.needTrackedEntityUpdate_=!0;const i=this.to4326Transform_,s=function(){const o=e.getGeometry();console.assert(o instanceof Ke);const a=o.getCoordinates(),l=i(a,void 0,a.length);return k.ol4326CoordinateToCesiumCartesian(l)},r={position:new Cesium.CallbackProperty((o,a)=>s(),!1),point:{pixelSize:1,color:Cesium.Color.TRANSPARENT}};this.trackedEntity_=this.dataSourceDisplay_.defaultDataSource.entities.add(r)}}}const A_="/Map_Demo/assets/logo-deeb5201.svg";const G_={props:{},setup(n,{emit:e}){const t=Li,i=_r(),s=Le({defaultCenter:[121.326776,24.655499],defaultCenterZoom:14,targetNum:1,conditionWrap:!1,layerSelect:!1,currentLayers:[],layers:[],mapLayers:ht(()=>s.layers.map((C,b)=>({label:C.group_title,value:C.value,layers:C.group_layers,groupClass:C.group_class}))),selectLock:!1,mapCount:1,map1:null,map2:null,map1LayerStatus:[],map2LayerStatus:[],temp:{map1BaseStatus:0,map2BaseStatus:0},deleteLightbox:!1,dimensionMap:{map1:"2D",map2:"2D"},toSearchDimensionStatus:ht(()=>{let S=s.targetNum==1?"map1":"map2";return s.dimensionMap[S]==="2D"}),ol3d:null,selectValueTemp:0,popup:{nodeRef:null,overlay:null,popupId:0,coordinate:[],popupData:""},comSize:{wrapHeight:"",wrapWidth:""},tribeQuery:{}});let r=null;const o=new fr({projection:"EPSG:4326",center:s.defaultCenter,zoom:s.defaultCenterZoom,minZoom:8,maxZoom:16});function a(){s.map1=new Ti({target:"map1",layers:[wi.getBaseMapData(0)],view:o,controls:[]}),s.map1.addControl(new y_({units:"metric"}))}function l(S,C){const b=new He({source:new Oe({features:[new Ct({geometry:new Ke([S,C]),population:4e3,rainfall:500})]}),style:new tt({image:new St({anchor:[.5,100],anchorXUnits:"fraction",anchorYUnits:"pixels",src:Kr})})});let v=s.targetNum==1?"map1":"map2";s[v].addLayer(b)}function h({action:S,value:C}){var L;let b=((L=s.map1)==null?void 0:L.getTarget())==null?"map2":"map1",v=s[b].getView();switch(S){case"In":v.animate({zoom:v.getZoom()+1});break;case"Out":v.animate({zoom:v.getZoom()-1});break;case"toNorth":v.animate({rotation:0});break;case"moveTo":if(C){const{xAxis:M,yAxis:W}=C;v.animate({center:[M,W],zoom:17,duration:100})}else navigator.geolocation.getCurrentPosition(function(M){v.animate({center:[M.coords.longitude,M.coords.latitude],zoom:17,duration:100}),l(M.coords.longitude,M.coords.latitude)});break;case"fullScreen":let T=document.getElementById(`map${s.targetNum}`);T.requestFullscreen?T.requestFullscreen():T.msRequestFullscreen?T.msRequestFullscreen():T.mozRequestFullScreen?T.mozRequestFullScreen():T.webkitRequestFullscreen&&T.webkitRequestFullscreen();break}}function c({action:S,value:C}){var L;let b=s.targetNum==1?s.map1:s.map2,v=b==null?void 0:b.getLayers();switch(S){case"layerMode":if(C.checked){let D=C.nestedSubNodeIndex,U=s.layers[C.nodeIndex].group_layers[C.subNodeIndex].single_tiles,z=s.layers[C.nodeIndex].group_layers[C.subNodeIndex].info_box!==null;(!U||z)&&(v.getArray().forEach(ne=>{ne.get("id")&&ne.get("id").includes(`node${C.nodeIndex}_subNode${C.subNodeIndex}_nestedSubNode`)&&b.removeLayer(ne)}),D=s.selectValueTemp,C.id=t.resetLayerId(C.id,"nestedSubNode",s.selectValueTemp));let $=t.getLayer(s.layers[C.nodeIndex].group_layers[C.subNodeIndex],D,C.id);if(b.addLayer($),["雷達回波預測","累積雨量預測","氣溫預測"].includes($.get("label"))){const{currentLayerKey:F,tilesImageUrls:ne,imageExtent:se}=$.get("ext"),re=C.id.split("_nestedSubNode")[0];((L=s.temp)==null?void 0:L[`${re}count`])===void 0&&(s.temp[`${re}count`]=F),s.temp[re]=setInterval(function(){s.temp[`${re}count`]=s.temp[`${re}count`]+1>4?0:s.temp[`${re}count`]+1;let $i=new Es({url:ne[s.temp[`${re}count`]],projection:"EPSG:4326",imageExtent:se,interpolate:!0});$.setSource($i)},1e3)}["新竹縣原住民部落範圍","近年歷史災害82處部落點位","雨量站","工程鑽探","土石流潛勢溪流","落石分布"].includes($.get("label"))&&(p(b,$.label),y(C,$.get("label"))),_("add",b.getTarget(),C.id)}else{let U=function(z){const $=C.id.split("_nestedSubNode")[0];D.filter(ne=>{var se;return(se=ne==null?void 0:ne.get("id"))==null?void 0:se.includes($)}).forEach(ne=>{b.removeLayer(ne)})},D=v.getArray();if(U(),s.layers[C.nodeIndex].group_layers[C.subNodeIndex].layer_type==="WFS"&&(y(C),s.popup.popupId=0,s.popup.popupData="",s.popup.overlay&&(b.removeOverlay(s.popup.overlay),s.popup.overlay=null)),["雷達回波預測","累積雨量預測","氣溫預測"].includes(s.layers[C.nodeIndex].group_layers[C.subNodeIndex].title)){const z=C.id.split("_nestedSubNode")[0];clearInterval(s.temp[z]),delete s.temp[`${z}count`]}_("delete",b.getTarget(),C.id)}break;case"selectLayerMode":if(s.selectLock)return;C.layerName==="all"?v.getArray().filter(z=>z.get("id")!==void 0).forEach(z=>{c({action:"layerMode",value:{checked:!1,...t.getLayerIndex(z.get("id"))}})}):c({action:"layerMode",value:{checked:!1,...t.getLayerIndex(C.id)}});break;case"changeOrder":if(s.selectLock)return;let{nodeIndex:T,subNodeIndex:M,nestedSubNodeIndex:W}=t.getLayerIndex(C.id),V=t.getLayer(s.layers[T].group_layers[M],W,C.id);if(C.movement==="up"){if(C.key+1==v.getArray().length)return;let D={checked:!1,nodeIndex:T,subNodeIndex:M,nestedSubNodeIndex:W,id:C.id};c({action:"layerMode",value:D}),v.insertAt(C.key+1,V)}if(C.movement==="down"){if(C.key-1==0)return;let D={checked:!1,nodeIndex:T,subNodeIndex:M,nestedSubNodeIndex:W,id:C.id};c({action:"layerMode",value:D}),v.insertAt(C.key-1,V)}break;case"changeLayerVisible":if(s.selectLock)return;let H=!v.getArray()[C.key].getVisible();v.getArray()[C.key].setVisible(H);break;case"baseMap":s.temp[`map${s.targetNum}BaseStatus`]=C.baseId;let A=new xt({preload:1/0,name:C.name,label:C.label,type:C.mapType,baseId:C.baseId,source:new Xn({url:C.url}),crossOrigin:"anonymous"}),O=b==null?void 0:b.getLayers().getArray();v.insertAt(0,A),O.forEach(D=>(D.get("type")=="base"&&D.get("baseId")!==C.baseId&&b.removeLayer(D),!0));break;case"changeDimensionMap":let G=s.targetNum==1?"map1":"map2";if(s.dimensionMap[G]=C,C==="3D"){const U=v.getArray().find($=>$.get("label").includes("近年歷史災害82處部落點位"));U&&s[`map${s.targetNum}`].removeLayer(U),r=new jt({map:b}),r.setEnabled(!0),Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0NzM3MWFhYS0xMjNlLTQ3MTMtODFjZS0xZjMzM2I5NGZiYTEiLCJpZCI6MTMwODE4LCJpYXQiOjE2ODQwNzM3Mjl9.UYu4kBialPo19dcvosHzZTpg2BD1zkFQnjCD78YiiYo";let z=r.getCesiumScene({});z.terrainProvider=Cesium.createWorldTerrain({}),s[`${G}LayerStatus`].push("3D")}else r.setEnabled(!1),s[`${G}LayerStatus`]=s[`${G}LayerStatus`].filter(D=>D!=="3D"),s[`map${s.targetNum}LayerStatus`].forEach(D=>{let{nodeIndex:U,subNodeIndex:z,nestedSubNodeIndex:$}=t.getLayerIndex(D);return t.getLayer(s.layers[U].group_layers[z],$,C.id).get("label").includes("近年歷史災害82處部落點位")&&c({action:"layerMode",value:{checked:!0,nodeIndex:U,subNodeIndex:z,nestedSubNodeIndex:$,id:D}}),D});break;case"setOpacity":v.getArray()[C.key].setOpacity(Number(C.value));break}f()}function d(S){var L;if(s.mapCount===S)return;let C=s.targetNum!==1?"map1":"map2";s.mapCount=S;let v=s[`${C}LayerStatus`].filter(T=>T!=="3D").map(T=>Li.getLayerIndex(T));if(S===2&&(s[C]=new Ti({target:C,layers:[wi.getBaseMapData(0),...v.map(T=>t.getLayer(s.layers[T.nodeIndex].group_layers[T.subNodeIndex],T.nestedSubNodeIndex,T.id))],view:o,controls:[]}),((L=s[`${C}LayerStatus`])==null?void 0:L.indexOf("3D"))!==-1)){r=new jt({map:s[C]}),r.setEnabled(!0),Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0NzM3MWFhYS0xMjNlLTQ3MTMtODFjZS0xZjMzM2I5NGZiYTEiLCJpZCI6MTMwODE4LCJpYXQiOjE2ODQwNzM3Mjl9.UYu4kBialPo19dcvosHzZTpg2BD1zkFQnjCD78YiiYo";let T=r.getCesiumScene({});T.terrainProvider=Cesium.createWorldTerrain({})}if(S===1){s[C]=null;const T=document.getElementById(C);for(;T.firstChild;)T.removeChild(T.firstChild)}}function u(S){var b;s.targetNum=S;let C=s.targetNum!==1?"map1":"map2";if(s.mapCount===1){if(!s[`map${S}`]){let v=s[`map${S}LayerStatus`].filter(T=>T!=="3D");v.includes("node0_subNode4_nestedSubNodeundefined")&&(v=[...v.filter(M=>M!=="node0_subNode4_nestedSubNodeundefined"),"node0_subNode4_nestedSubNodeundefined"]);let L=v.map(T=>Li.getLayerIndex(T));s[`map${S}`]=new Ti({target:`map${S}`,layers:[wi.getBaseMapData(s.temp[`map${s.targetNum}BaseStatus`]),...L.map(T=>t.getLayer(s.layers[T.nodeIndex].group_layers[T.subNodeIndex],T.nestedSubNodeIndex,T.id))],view:o,controls:[]}),p(s[`map${S}`]),((b=s[`map${S}LayerStatus`])==null?void 0:b.indexOf("3D"))!==-1&&(r=new jt({map:s[`map${S}`]}),r.setEnabled(!0))}if(s[C]){s[C]=null;const v=document.getElementById(C);for(;v.firstChild;)v.removeChild(v.firstChild)}}yn(()=>{f()})}function f(){var b;let S=s.targetNum==1?s.map1:s.map2;const C=(b=S==null?void 0:S.getLayers())==null?void 0:b.getArray();s.currentLayers=C==null?void 0:C.map(v=>({label:v.get("label"),id:v.get("id"),visible:v.getVisible()}))}function g(){s.conditionWrap=!s.conditionWrap}function _(S,C,b){if(S==="add")s[`${C}LayerStatus`].push(b);else if(S==="delete"){let v=s[`${C}LayerStatus`].findIndex(L=>L===b);s[`${C}LayerStatus`].splice(v,1)}else console.log("error")}function p(S){var b;let C=new m_({layers:(b=S==null?void 0:S.getLayers())==null?void 0:b.getArray(),condition:el});S.addInteraction(C),C.on("select",v=>{let L=v.selected[0];if(L){s.popup.overlay=new Pr({element:s.popup.nodeRef,autoPan:!0,autoPanAnimation:{duration:250}}),s.popup.overlay.setPosition(v.mapBrowserEvent.coordinate),S.addOverlay(s.popup.overlay);let T=(L.getId()??L.getGeometryName()).split(".");if(s.popup.popupData=T[0],s.popup.coordinate=v.mapBrowserEvent.coordinate,T[0]==="新竹縣原住民部落範圍"){s.popup.popupId=L.get("編號");return}if(T[0]==="近年歷史災害82處部落點位"){s.popup.popupId=T[1];return}if(T[0]==="雨量站"){s.popup.popupId=L.get("Name");return}if(T[0]==="工程鑽探"){console.log("選到工程鑽探"),s.popup.popupId=L.get("name").split("_")[0];return}if(T[0]==="土石流潛勢溪流"){s.popup.popupId=L.get("ID"),s.popup.temp=L;return}if(T[0]==="落石分布"){s.popup.popupId=L.get("DATA_ID"),s.popup.temp=L;return}}else S.removeOverlay(s.popup.overlay),s.popup.overlay=null,s.popup={nodeRef:null,overlay:null,popupId:0,coordinate:[],popupData:""}})}function x(){(s.targetNum==1?s.map1:s.map2).removeOverlay(s.popup.overlay),s.popup.overlay=null}function y(S,C){const{checked:b,id:v}=S;if(!b){s.selectLayerOption={};return}C==="新竹縣原住民部落範圍"&&Me.ajax({url:"https://api.edtest.site/tribeQuery",method:"GET",success:L=>{s.tribeQuery=L},error:L=>{console.log(L)}})}function w(S){let C={action:"moveTo",value:{xAxis:S.WGS84.lng,yAxis:S.WGS84.lat}};h(C)}Xi(async()=>{let S=Me.ajax({url:"https://api.edtest.site/underLayers",method:"GET"}).done(b=>b),C=Me.ajax({url:"https://api.edtest.site/layers",method:"GET"}).done(b=>b);Promise.all([S,C]).then(b=>{let v=b[0].data.map((L,T)=>({mapType:"base",baseId:T,onCurrent:!1,...L}));wi.setBaseMapData(v),s.temp.map1BaseStatus=0,s.temp.baseMapList=Ag(),s.layers=b[1].map((L,T)=>(L.group_layers.forEach((M,W)=>{let V=W,H;M.id=`node${T}_subNode${V}_nestedSubNode${H}`,M.single_tiles||M.tiles_list.forEach((A,O)=>{H=O,A.id=`node${T}_subNode${V}_nestedSubNode${H}`})}),{...L,value:T})),yn(()=>{a(),f()})}),s.comSize.wrapHeight=window.innerHeight,s.comSize.wrapWidth=window.innerWidth,i.dispatch("updateWindowWidth",window.innerWidth),window.onresize=b=>{s.comSize.wrapHeight=b.target.innerHeight,s.comSize.wrapWidth=b.target.innerWidth,i.dispatch("updateWindowWidth",window.innerWidth)}});function R(){console.log(s.map1.getLayers().getArray())}return{state:s,props:n,store:i,mapControl:h,layerControl:c,changeTarget:u,conditionWrap:g,closeAreaData:x,moveToMap:w,changeMapCount:d,show:R}}},B_={class:"w-100 d-flex justify-content-between flex-sm-row flex-wrap flex-sm-nowrap mapWrap",id:"mapWrap"},N_={key:0,class:"middleLine"},W_={class:"SearchBar d-block d-sm-block position-fixed w-100 w-sm-auto position-sm-absolute p-3 p-sm-0"},V_={class:"d-flex align-items-center justify-content-between justify-content-sm-start"},j_=m("img",{src:A_,alt:"",class:"logo col-5 col-sm-auto me-0 me-sm-5"},null,-1),z_={class:"conditionCom d-none d-sm-block position-absolute"},Y_={class:"mb-4"},U_={key:1,class:"mb-4"},X_={key:1},H_={class:"m-Navbar d-flex d-sm-none position-relative w-100"},K_={class:"position-absolute bottom-100 w-100",style:{"max-height":"70vh","overflow-y":"scroll"}},$_={key:0},q_={key:0,class:"lightWrap w-100 h-100 d-flex justify-content-center align-items-center"},Z_={class:"p-4 rounded bg-white",style:{width:"250px"}},J_=m("p",{class:"text-center fw-bold"},"是否要取消全部圖層",-1),Q_={class:"d-flex justify-content-around"};function ep(n,e,t,i,s,r){var g,_,p,x;const o=d_,a=Um,l=Vm,h=gm,c=Ki,d=Pg,u=eg,f=Ff;return E(),I("div",null,[m("div",B_,[m("div",{id:"map1",class:xe({"w-100":((g=i.state.map1)==null?void 0:g.getTarget())=="map1","h-100":i.state.mapCount===1,"h-50":i.state.mapCount===2&&i.state.comSize.wrapWidth<600,middleMap:(_=i.state.map1)==null?void 0:_.getTarget()})},null,2),i.state.mapCount===2?(E(),I("div",N_)):P("",!0),m("div",{id:"map2",class:xe({"w-100":((p=i.state.map2)==null?void 0:p.getTarget())=="map2","h-100":i.state.mapCount===1,"h-50":i.state.mapCount===2&&i.state.comSize.wrapWidth<600,middleMap:(x=i.state.map2)==null?void 0:x.getTarget()})},null,2)]),ae(o,{class:"asideTool position-absolute top-50 translate-middle-y",id:"asideTool",onChangeTarget:y=>{i.changeTarget(y)},onOnMapControl:e[0]||(e[0]=({action:y,value:w})=>{i.mapControl({action:y,value:w})})},null,8,["onChangeTarget"]),m("div",W_,[m("div",V_,[j_,ae(a,{class:"mapSourceOption col-5 col-sm-auto d-block d-sm-block",baseMapList:i.state.temp.baseMapList,onChangeBaseMaps:({action:y,value:w})=>{i.layerControl({action:y,value:w})}},null,8,["baseMapList","onChangeBaseMaps"])]),ae(l,kt({class:"mt-4 d-none d-sm-block"},{dimensionMapStatus:i.state.toSearchDimensionStatus,currentLayers:i.state.currentLayers,mapCount:i.state.mapCount,onChangeBaseMaps:({action:y,value:w})=>{i.layerControl({action:y,value:w})},onChangeMapCount:y=>{i.changeMapCount(y)}},{onChangeTarget:y=>{i.changeTarget(y)},onOnLayerControl:e[1]||(e[1]=({action:y,value:w})=>{i.layerControl({action:y,value:w})}),onConditionWrap:e[2]||(e[2]=y=>{i.conditionWrap(y)})}),null,16,["onChangeTarget"])]),m("div",z_,[m("div",Y_,[i.state.conditionWrap?P("",!0):(E(),I("button",{key:0,class:"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5",onClick:e[3]||(e[3]=y=>i.state.conditionWrap=!0)}," 圖層選項 ")),i.state.conditionWrap?(E(),I("div",U_,[ae(h,kt({tribeQuery:i.state.tribeQuery,mapLayers:i.state.mapLayers,currentLayers:i.state.currentLayers,onClose:()=>{i.state.conditionWrap=!1},showSelectLayerValue:y=>{i.state.selectValueTemp=y},moveToMap:y=>{i.moveToMap(y)}},{onOnLayerControl:e[4]||(e[4]=({action:y,value:w})=>{i.layerControl({action:y,value:w})})}),null,16)])):P("",!0),ae(c,{text:"可選擇要加入的圖層",styles:"right: 105%;top: 0;text-align: right;"})]),m("div",null,[i.state.layerSelect?P("",!0):(E(),I("button",{key:0,class:"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5",onClick:e[5]||(e[5]=y=>i.state.layerSelect=!0)}," 已選擇的圖層 ")),i.state.layerSelect?(E(),I("div",X_,[ae(d,ol(al({selectLock:i.state.selectLock,currentLayers:i.state.currentLayers,onClose:()=>{i.state.layerSelect=!1},onLockLayer:()=>{i.state.selectLock=!i.state.selectLock},onDeleteLayer:({action:y,value:w})=>{w.layerName=="all"?i.state.deleteLightbox=!0:i.layerControl({action:y,value:w})},onDeleteLayerAll:()=>{i.state.deleteLightbox=!0},onLayerControl:({action:y,value:w})=>{i.layerControl({action:y,value:w})}})),null,16)])):P("",!0),ae(c,{text:"顯示已經選擇的圖層",styles:"right: 105%;top: 0;text-align: right;"})])]),m("div",H_,[m("div",K_,[i.state.conditionWrap?(E(),xn(h,kt({key:0,class:"w-100"},{mapLayers:i.state.mapLayers,currentLayers:i.state.currentLayers,onClose:()=>{i.state.conditionWrap=!1},showSelectLayerValue:y=>{i.state.selectValueTemp=y}},{onOnLayerControl:e[6]||(e[6]=({action:y,value:w})=>{i.layerControl({action:y,value:w})})}),null,16)):P("",!0)]),i.state.layerSelect?(E(),I("div",$_,[ae(d,kt({class:"position-absolute bottom-100 w-100"},{selectLock:i.state.selectLock,currentLayers:i.state.currentLayers,onClose:()=>{i.state.layerSelect=!1},onLockLayer:()=>{i.state.selectLock=!i.state.selectLock},onDeleteLayer:({action:y,value:w})=>{w.layerName=="all"?i.state.deleteLightbox=!0:i.layerControl({action:y,value:w})},onDeleteLayerAll:()=>{i.state.deleteLightbox=!0},onChangLayerVisible:y=>{i.layerControl(y)},onChangeOrderLayer:({action:y,value:w})=>{i.layerControl({action:y,value:w})},onLayerControl:({action:y,value:w})=>{i.layerControl({action:y,value:w})}}),null,16)])):P("",!0),ae(u,kt({dimensionMapStatus:i.state.toSearchDimensionStatus,currentLayers:i.state.currentLayers,mapCount:i.state.mapCount,openConditionWrap:()=>{i.state.conditionWrap=!i.state.conditionWrap,i.state.layerSelect=!1},openLayerSelect:()=>{i.state.layerSelect=!i.state.layerSelect,i.state.conditionWrap=!1},onLayerControl:({action:y,value:w})=>{i.layerControl({action:y,value:w})},onChangeMapCount:y=>{i.changeMapCount(y)},onChangeTarget:y=>{i.changeTarget(y)}},{onConditionWrap:e[7]||(e[7]=y=>{i.conditionWrap(y)})}),null,16)]),i.state.deleteLightbox?(E(),I("div",q_,[m("div",Z_,[J_,m("div",Q_,[m("button",{class:"rounded px-3 py-1 bg-steel text-white border-0",onClick:e[8]||(e[8]=()=>{i.layerControl({action:"selectLayerMode",value:{layerName:"all"}}),i.state.deleteLightbox=!1})},"確定"),m("button",{class:"rounded px-3 py-1 bg-secondary bg-gradient text-white border-0",onClick:e[9]||(e[9]=()=>{i.state.deleteLightbox=!1})},"取消")])])])):P("",!0),m("div",{id:"popup",class:"popup position-absolute bottom-0",ref:y=>{i.state.popup.nodeRef=y}},[i.state.popup.popupId!==0?(E(),xn(f,{key:0,class:"areaData",closeAreaData:()=>{i.closeAreaData()},popup:i.state.popup,maxHeight:500},null,8,["closeAreaData","popup"])):P("",!0)],512),i.store.state.isInit?(E(),I("div",{key:1,class:"stepOverLayer position-absolute top-0 start-0 w-100 h-100 bg-black opacity-50",id:"firstEnter",onClick:e[10]||(e[10]=()=>{i.store.dispatch("updateLayerStatus",!1)})})):P("",!0)])}const ap=Te(G_,[["render",ep]]);export{ap as default};
//# sourceMappingURL=WebMap-dbdd8b0c.js.map
