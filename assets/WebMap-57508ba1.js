import{V as q,O as V,m as A,M as W,b as I,S as G,c as Q,a as U,_ as X,d as H,e as K,f as $,g as ee,h as te,i as ae,j as oe,k as re,l as ne,F as se,P as ie,n as le,I as de}from"./logo-154edc6f.js";import{_ as ce,r as ue,c as P,o as me,$ as ye,n as Z,a as _,b as m,d as Y,e as C,f as h,m as pe,g as fe,h as ge,i as be,j as b}from"./index-b90eb3a0.js";const Le={props:{},setup(B,{emit:i}){const x=A,o=I,e=ue({defaultCenter:[121.326776,24.655499],defaultCenterZoom:14,targetNum:1,conditionWrap:!1,layerSelect:!1,currentLayers:[],layers:[],mapLayers:P(()=>e.layers.map((a,t)=>({label:a.group_title,value:a.value,layers:a.group_layers,groupClass:a.group_class}))),baseMapsOptions:P(()=>I.sourceData()),selectLock:!1,mapCount:1,map1:null,map2:null,map1LayerStatus:[],map2LayerStatus:[],deleteLightbox:!1,dimensionMap:{map1:"2D",map2:"2D"},toSearchDimensionStatus:P(()=>{let a=e.targetNum==1?"map1":"map2";return e.dimensionMap[a]==="2D"}),ol3d:null,selectValueTemp:0,areaData:{nodeRef:null,overlay:null,tribeAreaData:{}}}),D=new q({projection:"EPSG:4326",center:e.defaultCenter,zoom:e.defaultCenterZoom});let p=null;function E(){e.map1=new W({target:"map1",layers:[I.sourceFun("default")],view:D,controls:[]})}function v(a,t){const n=new re({source:new ne({features:[new se({geometry:new ie([a,t]),name:"Null Island",population:4e3,rainfall:500})]}),style:new le({image:new de({anchor:[.5,100],anchorXUnits:"fraction",anchorYUnits:"pixels",src:"https://www.ockert-cnc.de/wp-content/uploads/2016/12/map-marker-icon-100x100.png"})})});let r=e.targetNum==1?"map1":"map2";e[r].addLayer(n)}function F({action:a,value:t}){var y;let n=((y=e.map1)==null?void 0:y.getTarget())==null?"map2":"map1",r=e[n].getView();switch(a){case"In":r.animate({zoom:r.getZoom()+1});break;case"Out":r.animate({zoom:r.getZoom()-1});break;case"toNorth":r.animate({rotation:0});break;case"moveTo":if(t){const{xAxis:u,yAxis:g}=t;r.animate({center:[u,g],zoom:10,duration:100})}else navigator.geolocation.getCurrentPosition(function(u){r.animate({center:[u.coords.longitude,u.coords.latitude],zoom:17,duration:100}),v(u.coords.longitude,u.coords.latitude)});break;case"fullScreen":let d=document.getElementById(`map${e.targetNum}`);d.requestFullscreen?d.requestFullscreen():d.msRequestFullscreen?d.msRequestFullscreen():d.mozRequestFullScreen?d.mozRequestFullScreen():d.webkitRequestFullscreen&&d.webkitRequestFullscreen();break}}function N({action:a,value:t}){var y;console.log({action:a,value:t});let n=e.targetNum==1?e.map1:e.map2,r=n==null?void 0:n.getLayers();switch(a){case"layerMode":if(t.checked){e.layers[t.nodeIndex].group_layers[t.subNodeIndex].single_tiles||(r.getArray().forEach(z=>{z.get("id")&&z.get("id").includes(`node${t.nodeIndex}_subNode${t.subNodeIndex}_nestedSubNode`)&&n.removeLayer(z)}),k("delete",n.getTarget(),t.id));let l=t.nestedSubNodeIndex||e.selectValueTemp,f=x.getLayer(e.layers[t.nodeIndex].group_layers[t.subNodeIndex],l,t.id);n.addLayer(f),t.id==="node0_subNode3_nestedSubNodeundefined"&&N({action:"layerMode",value:{checked:!0,id:"node0_subNode4_nestedSubNodeundefined",nestedSubNode:!1,nestedSubNodeIndex:void 0,nodeIndex:0,subNodeIndex:4}}),t.id==="node0_subNode4_nestedSubNodeundefined"&&M(n),k("add",n.getTarget(),t.id)}else{let l=r.getArray(),f;switch(t.id){case"node0_subNode0_nestedSubNodeundefined":f=l.filter(c=>c.get("id")?c==null?void 0:c.get("id").includes("node0_subNode0_nestedSubNode"):!1),f.forEach(c=>{n.removeLayer(c)});break;case"node3_subNode1_nestedSubNodeundefined":f=l.filter(c=>c.get("id")?c==null?void 0:c.get("id").includes("node3_subNode1_nestedSubNodeundefined"):!1),f.forEach(c=>{n.removeLayer(c)});break;default:l.forEach(c=>{c.get("id")==t.id&&n.removeLayer(c)});break}k("delete",n.getTarget(),t.id)}break;case"selectLayerMode":if(e.selectLock)return;t.layerName==="all"?r.getArray().filter(c=>c.get("name")!=="default").forEach(c=>{n.removeLayer(c)}):r.getArray().forEach(f=>{f.get("id")==t.id&&n.removeLayer(f)});break;case"changeOrder":if(e.selectLock)return;let d=A.getLayerIndex(t.id),u=x.getLayer(e.layers[d.nodeIndex].group_layers[d.subNodeIndex],d.nestedSubNodeIndex,t.id);if(t.movement==="up"){if(t.key+1==r.getArray().length)return;t.checked=!1,N({action:"layerMode",value:t}),r.insertAt(t.key+1,u)}if(t.movement==="down"){if(t.key-1==0)return;t.checked=!1,N({action:"layerMode",value:t}),r.insertAt(t.key-1,u)}break;case"changeLayerVisible":if(e.selectLock)return;let g=!r.getArray()[t.key].getVisible();r.getArray()[t.key].setVisible(g);break;case"baseMap":let w=o.sourceFun(t.layerName);r.extend([w]),r.getArray().forEach(l=>{l.get("name")!==t.layerName&&n.removeLayer(l)});break;case"changeMapCount":if(e.mapCount===t)return;let L=e.targetNum!==1?"map1":"map2";e.mapCount=t;let J=e[`${L}LayerStatus`].filter(l=>l!=="3D").map(l=>A.getLayerIndex(l));if(t===2&&(e[L]=new W({target:L,layers:[I.sourceFun("default"),...J.map(l=>x.getLayer(e.layers[l.nodeIndex].group_layers[l.subNodeIndex],l.nestedSubNodeIndex,l.id))],view:D,controls:[]}),((y=e[`${L}LayerStatus`])==null?void 0:y.indexOf("3D"))!==-1)){p=new V({map:e[L]}),p.setEnabled(!0),Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0NzM3MWFhYS0xMjNlLTQ3MTMtODFjZS0xZjMzM2I5NGZiYTEiLCJpZCI6MTMwODE4LCJpYXQiOjE2ODQwNzM3Mjl9.UYu4kBialPo19dcvosHzZTpg2BD1zkFQnjCD78YiiYo";let l=p.getCesiumScene({});l.terrainProvider=Cesium.createWorldTerrain({})}if(t===1){e[L]=null;const l=document.getElementById(L);for(;l.firstChild;)l.removeChild(l.firstChild)}break;case"changeDimensionMap":let O=e.targetNum==1?"map1":"map2";if(e.dimensionMap[O]=t,t==="3D"){p=new V({map:n}),p.setEnabled(!0),Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0NzM3MWFhYS0xMjNlLTQ3MTMtODFjZS0xZjMzM2I5NGZiYTEiLCJpZCI6MTMwODE4LCJpYXQiOjE2ODQwNzM3Mjl9.UYu4kBialPo19dcvosHzZTpg2BD1zkFQnjCD78YiiYo";let l=p.getCesiumScene({});l.terrainProvider=Cesium.createWorldTerrain({}),e[`${O}LayerStatus`].push("3D")}else p.setEnabled(!1),e[`${O}LayerStatus`]=e[`${O}LayerStatus`].filter(l=>l!=="3D");break}S()}function j(a){var n;e.targetNum=a;let t=e.targetNum!==1?"map1":"map2";if(e.mapCount===1){if(!e[`map${a}`]){let r=e[`map${a}LayerStatus`].filter(d=>d!=="3D");r.includes("node0_subNode4_nestedSubNodeundefined")&&(r=[...r.filter(u=>u!=="node0_subNode4_nestedSubNodeundefined"),"node0_subNode4_nestedSubNodeundefined"]);let y=r.map(d=>A.getLayerIndex(d));e[`map${a}`]=new W({target:`map${a}`,layers:[I.sourceFun("default"),...y.map(d=>x.getLayer(e.layers[d.nodeIndex].group_layers[d.subNodeIndex],d.nestedSubNodeIndex,d.layeredIndex))],view:D,controls:[]}),M(e[`map${a}`]),((n=e[`map${a}LayerStatus`])==null?void 0:n.indexOf("3D"))!==-1&&(p=new V({map:e[`map${a}`]}),p.setEnabled(!0))}if(e[t]){e[t]=null;const r=document.getElementById(t);for(;r.firstChild;)r.removeChild(r.firstChild)}}Z(()=>{S()})}function S(){var n;let a=e.targetNum==1?e.map1:e.map2;const t=(n=a==null?void 0:a.getLayers())==null?void 0:n.getArray();e.currentLayers=t==null?void 0:t.map(r=>({label:r.get("label"),id:r.get("id"),visible:r.getVisible()}))}function T(){e.conditionWrap=!e.conditionWrap}function k(a,t,n){if(a==="add")e[`${t}LayerStatus`].push(n);else if(a==="delete"){let r=e[`${t}LayerStatus`].findIndex(y=>y===n);e[`${t}LayerStatus`].splice(r,1)}else console.log("error")}function M(a){var n;let t=new G({layers:(n=a==null?void 0:a.getLayers())==null?void 0:n.getArray(),condition:Q});a.addInteraction(t),t.on("select",r=>{let y=r.selected;r.selected[0]?(e.areaData.overlay=new U({element:e.areaData.nodeRef,autoPan:!0,autoPanAnimation:{duration:250}}),a.addOverlay(e.areaData.overlay),e.areaData.overlay.setPosition(r.mapBrowserEvent.coordinate),y.forEach(d=>{let u=d.getProperties();Object.entries(u).forEach(g=>{const w=g[0],R=g[1];e.areaData.tribeAreaData[w]=R})})):(a.removeOverlay(e.areaData.overlay),e.areaData.overlay=null)})}function s(){(e.targetNum==1?e.map1:e.map2).removeOverlay(e.areaData.overlay),e.areaData.overlay=null}return me(async()=>{await ye.ajax({url:"https://api.edtest.site/layers",method:"GET"}).done(a=>{e.layers=a.map((t,n)=>(t.group_layers.forEach((r,y)=>{let d=y,u;r.id=`node${n}_subNode${d}_nestedSubNode${u}`,r.single_tiles||r.tiles_list.forEach((g,w)=>{u=w,g.id=`node${n}_subNode${d}_nestedSubNode${u}`})}),{...t,value:n})),Z(()=>{E(),S()})}).fail(a=>{console.log("Fail",a)})}),{state:e,props:B,mapControl:F,layerControl:N,getCurrentLayerNames:S,changeTarget:j,conditionWrap:T,closeMapData:s}}},_e={class:"w-100 d-flex flex-nowrap mapWrap",id:"mapWrap"},Ce={key:0,class:"middleLine"},Ne={class:"SearchBar position-absolute"},Se=m("img",{src:X,alt:"",class:"mb-2"},null,-1),ke={class:"condition position-absolute"},he={class:"mb-2"},xe={key:1,class:"mb-4"},Me={key:1},we={key:0,class:"lightWrap w-100 h-100 d-flex justify-content-center align-items-center"},Ie={class:"p-4 rounded bg-white",style:{width:"250px"}},De=m("p",{class:"text-center fw-bold"},"是否要刪除全部圖層",-1),Te={class:"d-flex justify-content-around"},Oe={class:"m-Navbar position-fixed bottom-0 start-0 w-full"};function Ae(B,i,x,o,e,D){var T,k,M;const p=H,E=K,v=$,F=ee,N=te,j=ae,S=oe;return b(),_("div",null,[m("div",_e,[m("div",{id:"map1",class:Y({"w-100":((T=o.state.map1)==null?void 0:T.getTarget())=="map1"})},null,2),o.state.mapCount===2?(b(),_("div",Ce)):C("",!0),m("div",{id:"map2",class:Y({"w-100":((k=o.state.map2)==null?void 0:k.getTarget())=="map2"})},null,2)]),h(p,{class:"asideTool position-absolute top-50 translate-middle-y",id:"asideTool",onOnMapControl:i[0]||(i[0]=({action:s,value:a})=>{o.mapControl({action:s,value:a})})}),h(E,{class:"mapSourceOption position-absolute",baseMapsOptions:o.state.baseMapsOptions,onOnChangeBaseMaps:i[1]||(i[1]=({action:s,value:a})=>{o.layerControl({action:s,value:a})})},null,8,["baseMapsOptions"]),m("div",Ne,[Se,h(v,{dimensionMapStatus:o.state.toSearchDimensionStatus,currentLayers:o.state.currentLayers,mapCount:o.state.mapCount,onOnLayerControl:i[2]||(i[2]=({action:s,value:a})=>{o.layerControl({action:s,value:a})}),onOnChangeTarget:i[3]||(i[3]=s=>{o.changeTarget(s)}),onConditionWrap:i[4]||(i[4]=s=>{o.conditionWrap(s)})},null,8,["dimensionMapStatus","currentLayers","mapCount"])]),m("div",ke,[m("div",he,[o.state.conditionWrap?C("",!0):(b(),_("button",{key:0,class:"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5",onClick:i[5]||(i[5]=s=>o.state.conditionWrap=!0)}," 圖層選項 ")),o.state.conditionWrap?(b(),_("div",xe,[h(F,pe({mapLayers:o.state.mapLayers,currentLayers:o.state.currentLayers,onClose:()=>{o.state.conditionWrap=!1},showSelectLayerValue:s=>{o.state.selectValueTemp=s}},{onOnMapControl:i[6]||(i[6]=({action:s,value:a})=>{o.mapControl({action:s,value:a})}),onOnLayerControl:i[7]||(i[7]=({action:s,value:a})=>{o.layerControl({action:s,value:a})})}),null,16)])):C("",!0)]),m("div",null,[o.state.layerSelect?C("",!0):(b(),_("button",{key:0,class:"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5",onClick:i[8]||(i[8]=s=>o.state.layerSelect=!0)}," 已選擇的圖層 ")),o.state.layerSelect?(b(),_("div",Me,[h(N,fe(ge({selectLock:o.state.selectLock,currentLayers:o.state.currentLayers,onClose:()=>{o.state.layerSelect=!1},onChangLayerVisible:s=>{o.layerControl(s)},onChangeOrderLayer:({action:s,value:a})=>{o.layerControl({action:s,value:a})},onLockLayer:()=>{o.state.selectLock=!o.state.selectLock},onDeleteLayer:({action:s,value:a})=>{a.layerName=="all"?o.state.deleteLightbox=!0:o.layerControl({action:s,value:a})},onDeleteLayerAll:()=>{o.state.deleteLightbox=!0}})),null,16)])):C("",!0)])]),o.state.deleteLightbox?(b(),_("div",we,[m("div",Ie,[De,m("div",Te,[m("button",{class:"rounded px-3 py-1 bg-steel text-white border-0",onClick:i[9]||(i[9]=()=>{o.layerControl({action:"selectLayerMode",value:{layerName:"all"}}),o.state.deleteLightbox=!1})},"確定"),m("button",{class:"rounded px-3 py-1 bg-secondary bg-gradient text-white border-0",onClick:i[10]||(i[10]=()=>{o.state.deleteLightbox=!1})},"取消")])])])):C("",!0),m("div",{id:"popup",class:"position-absolute",ref:s=>{o.state.areaData.nodeRef=s}},[(M=o.state.areaData)!=null&&M.overlay?(b(),be(j,{key:0,class:"areaData",closeMapData:()=>{o.closeMapData()},tribeAreaData:o.state.areaData.tribeAreaData,maxHeight:500},null,8,["closeMapData","tribeAreaData"])):C("",!0)],512),m("div",Oe,[h(S,{dimensionMapStatus:o.state.toSearchDimensionStatus,currentLayers:o.state.currentLayers,mapCount:o.state.mapCount,onOnLayerControl:i[11]||(i[11]=({action:s,value:a})=>{o.layerControl({action:s,value:a})}),onOnChangeTarget:i[12]||(i[12]=s=>{o.changeTarget(s)}),onConditionWrap:i[13]||(i[13]=s=>{o.conditionWrap(s)})},null,8,["dimensionMapStatus","currentLayers","mapCount"])])])}const je=ce(Le,[["render",Ae]]);export{je as default};
//# sourceMappingURL=WebMap-57508ba1.js.map
