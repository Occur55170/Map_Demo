import{V as q,O as W,m as E,M as P,b as M,S as G,c as Q,a as U,_ as X,d as H,e as K,f as $,g as ee,h as te,i as ae,j as oe,k as ne,F as re,P as se,l as le,I as ie}from"./logo-63bf2d7e.js";import{_ as de,r as ce,c as B,o as ue,$ as me,n as Z,a as C,b as y,d as I,e as Y,f as S,m as ye,g as pe,h as fe,i as ge,j as b}from"./index-fd2cfae0.js";const be={props:{},setup(R,{emit:d}){const w=E,o=M,e=ce({defaultCenter:[121.326776,24.655499],defaultCenterZoom:14,targetNum:1,conditionWrap:!1,layerSelect:!1,currentLayers:[],layers:[],mapLayers:B(()=>e.layers.map((n,t)=>({label:n.group_title,value:n.value,layers:n.group_layers,groupClass:n.group_class}))),baseMapsOptions:B(()=>M.sourceData()),selectLock:!1,mapCount:1,map1:null,map2:null,map1LayerStatus:[],map2LayerStatus:[],deleteLightbox:!1,dimensionMap:{map1:"2D",map2:"2D"},toSearchDimensionStatus:B(()=>{let n=e.targetNum==1?"map1":"map2";return e.dimensionMap[n]==="2D"}),ol3d:null,selectValueTemp:0,areaData:{nodeRef:null,overlay:null,tribeAreaData:{}}}),D=new q({projection:"EPSG:4326",center:e.defaultCenter,zoom:e.defaultCenterZoom});let f=null;function F(){e.map1=new P({target:"map1",layers:[M.sourceFun("default")],view:D,controls:[]})}function j(n,t){const r=new oe({source:new ne({features:[new re({geometry:new se([n,t]),name:"Null Island",population:4e3,rainfall:500})]}),style:new le({image:new ie({anchor:[.5,100],anchorXUnits:"fraction",anchorYUnits:"pixels",src:"https://www.ockert-cnc.de/wp-content/uploads/2016/12/map-marker-icon-100x100.png"})})});let a=e.targetNum==1?"map1":"map2";e[a].addLayer(r)}function z({action:n,value:t}){var p;let r=((p=e.map1)==null?void 0:p.getTarget())==null?"map2":"map1",a=e[r].getView();switch(n){case"In":a.animate({zoom:a.getZoom()+1});break;case"Out":a.animate({zoom:a.getZoom()-1});break;case"toNorth":a.animate({rotation:0});break;case"moveTo":if(t){const{xAxis:c,yAxis:L}=t;a.animate({center:[c,L],zoom:10,duration:100})}else navigator.geolocation.getCurrentPosition(function(c){a.animate({center:[c.coords.longitude,c.coords.latitude],zoom:17,duration:100}),j(c.coords.longitude,c.coords.latitude)});break;case"fullScreen":let i=document.getElementById(`map${e.targetNum}`);i.requestFullscreen?i.requestFullscreen():i.msRequestFullscreen?i.msRequestFullscreen():i.mozRequestFullScreen?i.mozRequestFullScreen():i.webkitRequestFullscreen&&i.webkitRequestFullscreen();break}}function k({action:n,value:t}){var p;let r=e.targetNum==1?e.map1:e.map2,a=r==null?void 0:r.getLayers();switch(n){case"layerMode":if(console.log(t.id),t.checked){e.layers[t.nodeIndex].group_layers[t.subNodeIndex].single_tiles||(a.getArray().forEach(v=>{v.get("id")&&v.get("id").includes(`node${t.nodeIndex}_subNode${t.subNodeIndex}_nestedSubNode`)&&r.removeLayer(v)}),x("delete",r.getTarget(),t.id));let s=t.nestedSubNodeIndex||e.selectValueTemp,g=w.getLayer(e.layers[t.nodeIndex].group_layers[t.subNodeIndex],s,t.id);r.addLayer(g),t.id==="node0_subNode3_nestedSubNodeundefined"&&k({action:"layerMode",value:{checked:!0,id:"node0_subNode4_nestedSubNodeundefined",nestedSubNode:!1,nestedSubNodeIndex:void 0,nodeIndex:0,subNodeIndex:4}}),t.id==="node0_subNode4_nestedSubNodeundefined"&&l(r),x("add",r.getTarget(),t.id)}else{let s=a.getArray(),g;switch(t.id){case"node0_subNode0_nestedSubNodeundefined":g=s.filter(m=>m.get("id")==="node0_subNode0_nestedSubNodeundefined"),g.forEach(m=>{r.removeLayer(m)});break;case"node3_subNode1_nestedSubNodeundefined":g=s.filter(m=>m.get("id")==="node3_subNode1_nestedSubNodeundefined"),g.forEach(m=>{r.removeLayer(m)});break;default:s.forEach(m=>{m.get("id")==t.id&&r.removeLayer(m)});break}x("delete",r.getTarget(),t.id)}break;case"selectLayerMode":if(e.selectLock)return;t.layerName==="all"?a.getArray().filter(m=>m.get("name")!=="default").forEach(m=>{r.removeLayer(m)}):a.getArray().forEach(g=>{g.get("id")==t.id&&r.removeLayer(g)});break;case"changeOrder":if(e.selectLock)return;let i=E.getLayerIndex(t.id),c=w.getLayer(e.layers[i.nodeIndex].group_layers[i.subNodeIndex],i.nestedSubNodeIndex,t.id);if(t.movement==="up"){if(t.key+1==a.getArray().length)return;t.checked=!1,k({action:"layerMode",value:t}),a.insertAt(t.key+1,c)}if(t.movement==="down"){if(t.key-1==0)return;t.checked=!1,k({action:"layerMode",value:t}),a.insertAt(t.key-1,c)}break;case"changeLayerVisible":if(e.selectLock)return;let L=!a.getArray()[t.key].getVisible();a.getArray()[t.key].setVisible(L);break;case"baseMap":let N=o.sourceFun(t.layerName);a.extend([N]),a.getArray().forEach(s=>{s.get("name")!==t.layerName&&r.removeLayer(s)});break;case"changeMapCount":if(e.mapCount===t)return;let h=e.targetNum!==1?"map1":"map2";e.mapCount=t;let J=e[`${h}LayerStatus`].filter(s=>s!=="3D").map(s=>E.getLayerIndex(s));if(t===2&&(e[h]=new P({target:h,layers:[M.sourceFun("default"),...J.map(s=>w.getLayer(e.layers[s.nodeIndex].group_layers[s.subNodeIndex],s.nestedSubNodeIndex,s.id))],view:D,controls:[]}),((p=e[`${h}LayerStatus`])==null?void 0:p.indexOf("3D"))!==-1)){f=new W({map:e[h]}),f.setEnabled(!0),Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0NzM3MWFhYS0xMjNlLTQ3MTMtODFjZS0xZjMzM2I5NGZiYTEiLCJpZCI6MTMwODE4LCJpYXQiOjE2ODQwNzM3Mjl9.UYu4kBialPo19dcvosHzZTpg2BD1zkFQnjCD78YiiYo";let s=f.getCesiumScene({});s.terrainProvider=Cesium.createWorldTerrain({})}if(t===1){e[h]=null;const s=document.getElementById(h);for(;s.firstChild;)s.removeChild(s.firstChild)}break;case"changeDimensionMap":let A=e.targetNum==1?"map1":"map2";if(e.dimensionMap[A]=t,t==="3D"){f=new W({map:r}),f.setEnabled(!0),Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0NzM3MWFhYS0xMjNlLTQ3MTMtODFjZS0xZjMzM2I5NGZiYTEiLCJpZCI6MTMwODE4LCJpYXQiOjE2ODQwNzM3Mjl9.UYu4kBialPo19dcvosHzZTpg2BD1zkFQnjCD78YiiYo";let s=f.getCesiumScene({});s.terrainProvider=Cesium.createWorldTerrain({}),e[`${A}LayerStatus`].push("3D")}else f.setEnabled(!1),e[`${A}LayerStatus`]=e[`${A}LayerStatus`].filter(s=>s!=="3D");break}_()}function V(n){var r;e.targetNum=n;let t=e.targetNum!==1?"map1":"map2";if(e.mapCount===1){if(!e[`map${n}`]){let a=e[`map${n}LayerStatus`].filter(i=>i!=="3D");a.includes("node0_subNode4_nestedSubNodeundefined")&&(a=[...a.filter(c=>c!=="node0_subNode4_nestedSubNodeundefined"),"node0_subNode4_nestedSubNodeundefined"]);let p=a.map(i=>E.getLayerIndex(i));e[`map${n}`]=new P({target:`map${n}`,layers:[M.sourceFun("default"),...p.map(i=>w.getLayer(e.layers[i.nodeIndex].group_layers[i.subNodeIndex],i.nestedSubNodeIndex,i.layeredIndex))],view:D,controls:[]}),l(e[`map${n}`]),((r=e[`map${n}LayerStatus`])==null?void 0:r.indexOf("3D"))!==-1&&(f=new W({map:e[`map${n}`]}),f.setEnabled(!0))}if(e[t]){e[t]=null;const a=document.getElementById(t);for(;a.firstChild;)a.removeChild(a.firstChild)}}Z(()=>{_()})}function _(){var r;let n=e.targetNum==1?e.map1:e.map2;const t=(r=n==null?void 0:n.getLayers())==null?void 0:r.getArray();e.currentLayers=t==null?void 0:t.map(a=>({label:a.get("label"),id:a.get("id"),visible:a.getVisible()}))}function T(){e.conditionWrap=!e.conditionWrap}function x(n,t,r){if(n==="add")e[`${t}LayerStatus`].push(r);else if(n==="delete"){let a=e[`${t}LayerStatus`].findIndex(p=>p===r);e[`${t}LayerStatus`].splice(a,1)}else console.log("error")}function l(n){var r;let t=new G({layers:(r=n==null?void 0:n.getLayers())==null?void 0:r.getArray(),condition:Q});n.addInteraction(t),t.on("select",a=>{let p=a.selected;a.selected[0]?(e.areaData.overlay=new U({element:e.areaData.nodeRef,autoPan:!0,autoPanAnimation:{duration:250}}),n.addOverlay(e.areaData.overlay),e.areaData.overlay.setPosition(a.mapBrowserEvent.coordinate),p.forEach(i=>{let c=i.getProperties();Object.entries(c).forEach(L=>{const N=L[0],O=L[1];e.areaData.tribeAreaData[N]=O})})):(n.removeOverlay(e.areaData.overlay),e.areaData.overlay=null)})}function u(){(e.targetNum==1?e.map1:e.map2).removeOverlay(e.areaData.overlay),e.areaData.overlay=null}return ue(async()=>{await me.ajax({url:"https://api.edtest.site/layers",method:"GET"}).done(n=>{e.layers=n.map((t,r)=>(t.group_layers.forEach((a,p)=>{let i=p,c;if(a.id=`node${r}_subNode${i}_nestedSubNode${c}`,["node0_subNode3_nestedSubNodeundefined","node0_subNode4_nestedSubNodeundefined","node0_subNode5_nestedSubNodeundefined"].includes(a.id)){let N=a.tiles_url.replace(/http:\/\//g,"https://");console.log(N)}a.single_tiles||a.tiles_list.forEach((N,O)=>{c=O,N.id=`node${r}_subNode${i}_nestedSubNode${c}`})}),{...t,value:r})),Z(()=>{F(),_()})}).fail(n=>{console.log("Fail",n)})}),{state:e,props:R,mapControl:z,layerControl:k,getCurrentLayerNames:_,changeTarget:V,conditionWrap:T,closeMapData:u}}},_e={class:"SearchBar position-absolute"},Le=y("img",{src:X,alt:"",class:"mb-2"},null,-1),Ne={class:"w-100 d-flex flex-nowrap mapWrap",id:"mapWrap"},he={key:0,class:"middleLine"},Ce={class:"condition position-absolute"},Se={class:"mb-2"},ke={key:1,class:"mb-4"},xe={key:1},we={key:0,class:"lightWrap w-100 h-100 d-flex justify-content-center align-items-center"},Me={class:"p-4 rounded bg-white",style:{width:"250px"}},Ie=y("p",{class:"text-center fw-bold"},"是否要刪除全部圖層",-1),De={class:"d-flex justify-content-around"};function Te(R,d,w,o,e,D){var _,T,x;const f=H,F=K,j=$,z=ee,k=te,V=ae;return b(),C("div",null,[y("div",_e,[Le,I(f,{dimensionMapStatus:o.state.toSearchDimensionStatus,currentLayers:o.state.currentLayers,mapCount:o.state.mapCount,onOnLayerControl:d[0]||(d[0]=({action:l,value:u})=>{o.layerControl({action:l,value:u})}),onOnChangeTarget:d[1]||(d[1]=l=>{o.changeTarget(l)}),onConditionWrap:d[2]||(d[2]=l=>{o.conditionWrap(l)})},null,8,["dimensionMapStatus","currentLayers","mapCount"])]),I(F,{class:"mapSourceOption",baseMapsOptions:o.state.baseMapsOptions,onOnChangeBaseMaps:d[3]||(d[3]=({action:l,value:u})=>{o.layerControl({action:l,value:u})})},null,8,["baseMapsOptions"]),I(j,{class:"asideTool position-absolute top-50 translate-middle-y",id:"asideTool",onOnMapControl:d[4]||(d[4]=({action:l,value:u})=>{o.mapControl({action:l,value:u})})}),y("div",Ne,[y("div",{id:"map1",class:Y({"w-100":((_=o.state.map1)==null?void 0:_.getTarget())=="map1"})},null,2),o.state.mapCount===2?(b(),C("div",he)):S("",!0),y("div",{id:"map2",class:Y({"w-100":((T=o.state.map2)==null?void 0:T.getTarget())=="map2"})},null,2)]),y("div",Ce,[y("div",Se,[o.state.conditionWrap?S("",!0):(b(),C("button",{key:0,class:"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5",onClick:d[5]||(d[5]=l=>o.state.conditionWrap=!0)}," 圖層選項 ")),o.state.conditionWrap?(b(),C("div",ke,[I(z,ye({mapLayers:o.state.mapLayers,currentLayers:o.state.currentLayers,onClose:()=>{o.state.conditionWrap=!1},showSelectLayerValue:l=>{o.state.selectValueTemp=l}},{onOnMapControl:d[6]||(d[6]=({action:l,value:u})=>{o.mapControl({action:l,value:u})}),onOnLayerControl:d[7]||(d[7]=({action:l,value:u})=>{o.layerControl({action:l,value:u})})}),null,16)])):S("",!0)]),y("div",null,[o.state.layerSelect?S("",!0):(b(),C("button",{key:0,class:"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5",onClick:d[8]||(d[8]=l=>o.state.layerSelect=!0)}," 已選擇的圖層 ")),o.state.layerSelect?(b(),C("div",xe,[I(k,pe(fe({selectLock:o.state.selectLock,currentLayers:o.state.currentLayers,onClose:()=>{o.state.layerSelect=!1},onChangLayerVisible:l=>{o.layerControl(l)},onChangeOrderLayer:({action:l,value:u})=>{o.layerControl({action:l,value:u})},onLockLayer:()=>{o.state.selectLock=!o.state.selectLock},onDeleteLayer:({action:l,value:u})=>{u.layerName=="all"?o.state.deleteLightbox=!0:o.layerControl({action:l,value:u})},onDeleteLayerAll:()=>{o.state.deleteLightbox=!0}})),null,16)])):S("",!0)])]),o.state.deleteLightbox?(b(),C("div",we,[y("div",Me,[Ie,y("div",De,[y("button",{class:"rounded px-3 py-1 bg-steel text-white border-0",onClick:d[9]||(d[9]=()=>{o.layerControl({action:"selectLayerMode",value:{layerName:"all"}}),o.state.deleteLightbox=!1})},"確定"),y("button",{class:"rounded px-3 py-1 bg-secondary bg-gradient text-white border-0",onClick:d[10]||(d[10]=()=>{o.state.deleteLightbox=!1})},"取消")])])])):S("",!0),y("div",{id:"popup",style:{position:"fixed",top:"100%",left:"100%"},ref:l=>{o.state.areaData.nodeRef=l}},[(x=o.state.areaData)!=null&&x.overlay?(b(),ge(V,{key:0,class:"areaData",closeMapData:()=>{o.closeMapData()},tribeAreaData:o.state.areaData.tribeAreaData,maxHeight:500},null,8,["closeMapData","tribeAreaData"])):S("",!0)],512)])}const Fe=de(be,[["render",Te]]);export{Fe as default};
//# sourceMappingURL=WebMap-85b48f4c.js.map
