import{B as zt,C as Ht,r as Ut,a as Kt,u as qt,l as Yt,M as Xt,o as Qt,b as Zt,c as Jt,V as me,d as pt,E as Je,g as re,e as es,f as ts,h as ss,s as is,i as gt,P as Ge,F as ye,j as ns,X as ft,k as Re,T as _t,m as Ce,S as He,I as ve,n as yt,p as De,q as os,t as rs,v as et,w as as,x as tt,y as ls,z as Me,A as cs,D as ds,G as st,H as us,J as hs,K as ms,L as it,N as ps,O as ee,Q as Ue,R as A,U as gs,W as fs,Y as R,Z as Ke,_ as de,$ as _s,a0 as ae,a1 as ys,a2 as We,a3 as Cs,a4 as vs,a5 as nt,a6 as bs,a7 as ws,a8 as Ls,a9 as Ss,aa as xs,ab as Ts,ac as Es,ad as Pe,ae as Ms}from"./core-a8cc157c.js";import{_ as K,r as J,f as Ve,o as y,c as C,a as d,n as Fe,p as we,e as Le,g as Ct,h as B,t as M,i as be,F as X,j as Q,k as E,u as vt,$ as te,l as z,w as O,m as bt,q as Ps,s as ue,b as Is,v as wt,x as Lt,y as ot,z as pe,A as ks,B as Os,C as rt}from"./index-4fa1ee36.js";const N={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class Rs extends zt{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+Ht,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(N.ELEMENT,this.handleElementChanged),this.addChangeListener(N.MAP,this.handleMapChanged),this.addChangeListener(N.OFFSET,this.handleOffsetChanged),this.addChangeListener(N.POSITION,this.handlePositionChanged),this.addChangeListener(N.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(N.ELEMENT)}getId(){return this.id}getMap(){return this.get(N.MAP)||null}getOffset(){return this.get(N.OFFSET)}getPosition(){return this.get(N.POSITION)}getPositioning(){return this.get(N.POSITIONING)}handleElementChanged(){Ut(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(Kt(this.element),qt(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=Yt(e,Xt.POSTRENDER,this.render,this),this.updatePixelPosition();const s=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?s.insertBefore(this.element,s.childNodes[0]||null):s.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(N.ELEMENT,e)}setMap(e){this.set(N.MAP,e)}setOffset(e){this.set(N.OFFSET,e)}setPosition(e){this.set(N.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const s=this.getMap();if(!s||!s.getTargetElement()||!this.get(N.POSITION))return;const t=this.getRect(s.getTargetElement(),s.getSize()),i=this.getElement(),o=this.getRect(i,[Qt(i),Zt(i)]);e=e||{};const r=e.margin===void 0?20:e.margin;if(!Jt(t,o)){const a=o[0]-t[0],l=t[2]-o[2],u=o[1]-t[1],c=t[3]-o[3],h=[0,0];if(a<0?h[0]=a-r:l<0&&(h[0]=Math.abs(l)+r),u<0?h[1]=u-r:c<0&&(h[1]=Math.abs(c)+r),h[0]!==0||h[1]!==0){const m=s.getView().getCenterInternal(),p=s.getPixelFromCoordinateInternal(m);if(!p)return;const f=[p[0]+h[0],p[1]+h[1]],S=e.animation||{};s.getView().animateInternal({center:s.getCoordinateFromPixelInternal(f),duration:S.duration,easing:S.easing})}}}getRect(e,s){const t=e.getBoundingClientRect(),i=t.left+window.pageXOffset,o=t.top+window.pageYOffset;return[i,o,i+s[0],o+s[1]]}setPositioning(e){this.set(N.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),s=this.getPosition();if(!e||!e.isRendered()||!s){this.setVisible(!1);return}const t=e.getPixelFromCoordinate(s),i=e.getSize();this.updateRenderedPosition(t,i)}updateRenderedPosition(e,s){const t=this.element.style,i=this.getOffset(),o=this.getPositioning();this.setVisible(!0);const r=Math.round(e[0]+i[0])+"px",a=Math.round(e[1]+i[1])+"px";let l="0%",u="0%";o=="bottom-right"||o=="center-right"||o=="top-right"?l="-100%":(o=="bottom-center"||o=="center-center"||o=="top-center")&&(l="-50%"),o=="bottom-left"||o=="bottom-center"||o=="bottom-right"?u="-100%":(o=="center-left"||o=="center-center"||o=="center-right")&&(u="-50%");const c=`translate(${l}, ${u}) translate(${r}, ${a})`;this.rendered.transform_!=c&&(this.rendered.transform_=c,t.transform=c)}getOptions(){return this.options}}const St=Rs;class Ds extends me{constructor(e){super({attributions:e.attributions,wrapX:e.wrapX}),this.resolution=void 0,this.distance=e.distance!==void 0?e.distance:20,this.minDistance=e.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=e.geometryFunction||function(s){const t=s.getGeometry();return pt(t.getType()=="Point",10),t},this.createCustomCluster_=e.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(e.source||null)}clear(e){this.features.length=0,super.clear(e)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(e,s,t){this.source.loadFeatures(e,s,t),s!==this.resolution&&(this.resolution=s,this.refresh())}setDistance(e){this.updateDistance(e,this.minDistance)}setMinDistance(e){this.updateDistance(this.distance,e)}getMinDistance(){return this.minDistance}setSource(e){this.source&&this.source.removeEventListener(Je.CHANGE,this.boundRefresh_),this.source=e,e&&e.addEventListener(Je.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(e,s){const t=e===0?0:Math.min(s,e)/e,i=e!==this.distance||this.interpolationRatio!==t;this.distance=e,this.minDistance=s,this.interpolationRatio=t,i&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;const e=ns(),s=this.distance*this.resolution,t=this.source.getFeatures(),i={};for(let o=0,r=t.length;o<r;o++){const a=t[o];if(!(re(a)in i)){const l=this.geometryFunction(a);if(l){const u=l.getCoordinates();es(u,e),ts(e,s,e);const c=this.source.getFeaturesInExtent(e).filter(function(h){const m=re(h);return m in i?!1:(i[m]=!0,!0)});this.features.push(this.createCluster(c,e))}}}}createCluster(e,s){const t=[0,0];for(let a=e.length-1;a>=0;--a){const l=this.geometryFunction(e[a]);l?ss(t,l.getCoordinates()):e.splice(a,1)}is(t,1/e.length);const i=gt(s),o=this.interpolationRatio,r=new Ge([t[0]*(1-o)+i[0]*o,t[1]*(1-o)+i[1]*o]);return this.createCustomCluster_?this.createCustomCluster_(r,e):new ye({geometry:r,features:e})}}const xt=Ds,Fs='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class As extends ft{constructor(e){e=e||{};let s;e.attributions!==void 0?s=e.attributions:s=[Fs];const t=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",i=e.url!==void 0?e.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:s,attributionsCollapsible:!1,cacheSize:e.cacheSize,crossOrigin:t,interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:19,opaque:e.opaque!==void 0?e.opaque:!0,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:i,wrapX:e.wrapX,zDirection:e.zDirection})}}const Ns=As;function Gs(n,e){if(n.match(/^[a-z]+:\/\//i))return n;if(n.match(/^\/\//))return window.location.protocol+n;if(n.match(/^[a-z]+:/i))return n;const s=document.implementation.createHTMLDocument(),t=s.createElement("base"),i=s.createElement("a");return s.head.appendChild(t),s.body.appendChild(i),e&&(t.href=e),i.href=n,i.href}const Vs=(()=>{let n=0;const e=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(n+=1,`u${e()}${n}`)})();function Z(n){const e=[];for(let s=0,t=n.length;s<t;s++)e.push(n[s]);return e}function Ae(n,e){const t=(n.ownerDocument.defaultView||window).getComputedStyle(n).getPropertyValue(e);return t?parseFloat(t.replace("px","")):0}function Bs(n){const e=Ae(n,"border-left-width"),s=Ae(n,"border-right-width");return n.clientWidth+e+s}function js(n){const e=Ae(n,"border-top-width"),s=Ae(n,"border-bottom-width");return n.clientHeight+e+s}function Tt(n,e={}){const s=e.width||Bs(n),t=e.height||js(n);return{width:s,height:t}}function Ws(){let n,e;try{e=process}catch{}const s=e&&e.env?e.env.devicePixelRatio:null;return s&&(n=parseInt(s,10),Number.isNaN(n)&&(n=1)),n||window.devicePixelRatio||1}const W=16384;function $s(n){(n.width>W||n.height>W)&&(n.width>W&&n.height>W?n.width>n.height?(n.height*=W/n.width,n.width=W):(n.width*=W/n.height,n.height=W):n.width>W?(n.height*=W/n.width,n.width=W):(n.width*=W/n.height,n.height=W))}function Ne(n){return new Promise((e,s)=>{const t=new Image;t.decode=()=>e(t),t.onload=()=>e(t),t.onerror=s,t.crossOrigin="anonymous",t.decoding="async",t.src=n})}async function zs(n){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(n)).then(encodeURIComponent).then(e=>`data:image/svg+xml;charset=utf-8,${e}`)}async function Hs(n,e,s){const t="http://www.w3.org/2000/svg",i=document.createElementNS(t,"svg"),o=document.createElementNS(t,"foreignObject");return i.setAttribute("width",`${e}`),i.setAttribute("height",`${s}`),i.setAttribute("viewBox",`0 0 ${e} ${s}`),o.setAttribute("width","100%"),o.setAttribute("height","100%"),o.setAttribute("x","0"),o.setAttribute("y","0"),o.setAttribute("externalResourcesRequired","true"),i.appendChild(o),o.appendChild(n),zs(i)}const j=(n,e)=>{if(n instanceof e)return!0;const s=Object.getPrototypeOf(n);return s===null?!1:s.constructor.name===e.name||j(s,e)};function Us(n){const e=n.getPropertyValue("content");return`${n.cssText} content: '${e.replace(/'|"/g,"")}';`}function Ks(n){return Z(n).map(e=>{const s=n.getPropertyValue(e),t=n.getPropertyPriority(e);return`${e}: ${s}${t?" !important":""};`}).join(" ")}function qs(n,e,s){const t=`.${n}:${e}`,i=s.cssText?Us(s):Ks(s);return document.createTextNode(`${t}{${i}}`)}function at(n,e,s){const t=window.getComputedStyle(n,s),i=t.getPropertyValue("content");if(i===""||i==="none")return;const o=Vs();try{e.className=`${e.className} ${o}`}catch{return}const r=document.createElement("style");r.appendChild(qs(o,s,t)),e.appendChild(r)}function Ys(n,e){at(n,e,":before"),at(n,e,":after")}const lt="application/font-woff",ct="image/jpeg",Xs={woff:lt,woff2:lt,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:ct,jpeg:ct,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function Qs(n){const e=/\.([^./]*?)$/g.exec(n);return e?e[1]:""}function Ye(n){const e=Qs(n).toLowerCase();return Xs[e]||""}function Zs(n){return n.split(/,/)[1]}function qe(n){return n.search(/^(data:)/)!==-1}function Et(n,e){return`data:${e};base64,${n}`}async function Mt(n,e,s){const t=await fetch(n,e);if(t.status===404)throw new Error(`Resource "${t.url}" not found`);const i=await t.blob();return new Promise((o,r)=>{const a=new FileReader;a.onerror=r,a.onloadend=()=>{try{o(s({res:t,result:a.result}))}catch(l){r(l)}},a.readAsDataURL(i)})}const $e={};function Js(n,e,s){let t=n.replace(/\?.*/,"");return s&&(t=n),/ttf|otf|eot|woff2?/i.test(t)&&(t=t.replace(/.*\//,"")),e?`[${e}]${t}`:t}async function Xe(n,e,s){const t=Js(n,e,s.includeQueryParams);if($e[t]!=null)return $e[t];s.cacheBust&&(n+=(/\?/.test(n)?"&":"?")+new Date().getTime());let i;try{const o=await Mt(n,s.fetchRequestInit,({res:r,result:a})=>(e||(e=r.headers.get("Content-Type")||""),Zs(a)));i=Et(o,e)}catch(o){i=s.imagePlaceholder||"";let r=`Failed to fetch resource: ${n}`;o&&(r=typeof o=="string"?o:o.message),r&&console.warn(r)}return $e[t]=i,i}async function ei(n){const e=n.toDataURL();return e==="data:,"?n.cloneNode(!1):Ne(e)}async function ti(n,e){if(n.currentSrc){const o=document.createElement("canvas"),r=o.getContext("2d");o.width=n.clientWidth,o.height=n.clientHeight,r==null||r.drawImage(n,0,0,o.width,o.height);const a=o.toDataURL();return Ne(a)}const s=n.poster,t=Ye(s),i=await Xe(s,t,e);return Ne(i)}async function si(n){var e;try{if(!((e=n==null?void 0:n.contentDocument)===null||e===void 0)&&e.body)return await Be(n.contentDocument.body,{},!0)}catch{}return n.cloneNode(!1)}async function ii(n,e){return j(n,HTMLCanvasElement)?ei(n):j(n,HTMLVideoElement)?ti(n,e):j(n,HTMLIFrameElement)?si(n):n.cloneNode(!1)}const ni=n=>n.tagName!=null&&n.tagName.toUpperCase()==="SLOT";async function oi(n,e,s){var t,i;let o=[];return ni(n)&&n.assignedNodes?o=Z(n.assignedNodes()):j(n,HTMLIFrameElement)&&(!((t=n.contentDocument)===null||t===void 0)&&t.body)?o=Z(n.contentDocument.body.childNodes):o=Z(((i=n.shadowRoot)!==null&&i!==void 0?i:n).childNodes),o.length===0||j(n,HTMLVideoElement)||await o.reduce((r,a)=>r.then(()=>Be(a,s)).then(l=>{l&&e.appendChild(l)}),Promise.resolve()),e}function ri(n,e){const s=e.style;if(!s)return;const t=window.getComputedStyle(n);t.cssText?(s.cssText=t.cssText,s.transformOrigin=t.transformOrigin):Z(t).forEach(i=>{let o=t.getPropertyValue(i);i==="font-size"&&o.endsWith("px")&&(o=`${Math.floor(parseFloat(o.substring(0,o.length-2)))-.1}px`),j(n,HTMLIFrameElement)&&i==="display"&&o==="inline"&&(o="block"),i==="d"&&e.getAttribute("d")&&(o=`path(${e.getAttribute("d")})`),s.setProperty(i,o,t.getPropertyPriority(i))})}function ai(n,e){j(n,HTMLTextAreaElement)&&(e.innerHTML=n.value),j(n,HTMLInputElement)&&e.setAttribute("value",n.value)}function li(n,e){if(j(n,HTMLSelectElement)){const s=e,t=Array.from(s.children).find(i=>n.value===i.getAttribute("value"));t&&t.setAttribute("selected","")}}function ci(n,e){return j(e,Element)&&(ri(n,e),Ys(n,e),ai(n,e),li(n,e)),e}async function di(n,e){const s=n.querySelectorAll?n.querySelectorAll("use"):[];if(s.length===0)return n;const t={};for(let o=0;o<s.length;o++){const a=s[o].getAttribute("xlink:href");if(a){const l=n.querySelector(a),u=document.querySelector(a);!l&&u&&!t[a]&&(t[a]=await Be(u,e,!0))}}const i=Object.values(t);if(i.length){const o="http://www.w3.org/1999/xhtml",r=document.createElementNS(o,"svg");r.setAttribute("xmlns",o),r.style.position="absolute",r.style.width="0",r.style.height="0",r.style.overflow="hidden",r.style.display="none";const a=document.createElementNS(o,"defs");r.appendChild(a);for(let l=0;l<i.length;l++)a.appendChild(i[l]);n.appendChild(r)}return n}async function Be(n,e,s){return!s&&e.filter&&!e.filter(n)?null:Promise.resolve(n).then(t=>ii(t,e)).then(t=>oi(n,t,e)).then(t=>ci(n,t)).then(t=>di(t,e))}const Pt=/url\((['"]?)([^'"]+?)\1\)/g,ui=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,hi=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function mi(n){const e=n.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${e})(['"]?\\))`,"g")}function pi(n){const e=[];return n.replace(Pt,(s,t,i)=>(e.push(i),s)),e.filter(s=>!qe(s))}async function gi(n,e,s,t,i){try{const o=s?Gs(e,s):e,r=Ye(e);let a;if(i){const l=await i(o);a=Et(l,r)}else a=await Xe(o,r,t);return n.replace(mi(e),`$1${a}$3`)}catch{}return n}function fi(n,{preferredFontFormat:e}){return e?n.replace(hi,s=>{for(;;){const[t,,i]=ui.exec(s)||[];if(!i)return"";if(i===e)return`src: ${t};`}}):n}function It(n){return n.search(Pt)!==-1}async function kt(n,e,s){if(!It(n))return n;const t=fi(n,s);return pi(t).reduce((o,r)=>o.then(a=>gi(a,r,e,s)),Promise.resolve(t))}async function Ie(n,e,s){var t;const i=(t=e.style)===null||t===void 0?void 0:t.getPropertyValue(n);if(i){const o=await kt(i,null,s);return e.style.setProperty(n,o,e.style.getPropertyPriority(n)),!0}return!1}async function _i(n,e){await Ie("background",n,e)||await Ie("background-image",n,e),await Ie("mask",n,e)||await Ie("mask-image",n,e)}async function yi(n,e){const s=j(n,HTMLImageElement);if(!(s&&!qe(n.src))&&!(j(n,SVGImageElement)&&!qe(n.href.baseVal)))return;const t=s?n.src:n.href.baseVal,i=await Xe(t,Ye(t),e);await new Promise((o,r)=>{n.onload=o,n.onerror=r;const a=n;a.decode&&(a.decode=o),a.loading==="lazy"&&(a.loading="eager"),s?(n.srcset="",n.src=i):n.href.baseVal=i})}async function Ci(n,e){const t=Z(n.childNodes).map(i=>Ot(i,e));await Promise.all(t).then(()=>n)}async function Ot(n,e){j(n,Element)&&(await _i(n,e),await yi(n,e),await Ci(n,e))}function vi(n,e){const{style:s}=n;e.backgroundColor&&(s.backgroundColor=e.backgroundColor),e.width&&(s.width=`${e.width}px`),e.height&&(s.height=`${e.height}px`);const t=e.style;return t!=null&&Object.keys(t).forEach(i=>{s[i]=t[i]}),n}const dt={};async function ut(n){let e=dt[n];if(e!=null)return e;const t=await(await fetch(n)).text();return e={url:n,cssText:t},dt[n]=e,e}async function ht(n,e){let s=n.cssText;const t=/url\(["']?([^"')]+)["']?\)/g,o=(s.match(/url\([^)]+\)/g)||[]).map(async r=>{let a=r.replace(t,"$1");return a.startsWith("https://")||(a=new URL(a,n.url).href),Mt(a,e.fetchRequestInit,({result:l})=>(s=s.replace(r,`url(${l})`),[r,l]))});return Promise.all(o).then(()=>s)}function mt(n){if(n==null)return[];const e=[],s=/(\/\*[\s\S]*?\*\/)/gi;let t=n.replace(s,"");const i=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const l=i.exec(t);if(l===null)break;e.push(l[0])}t=t.replace(i,"");const o=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,r="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",a=new RegExp(r,"gi");for(;;){let l=o.exec(t);if(l===null){if(l=a.exec(t),l===null)break;o.lastIndex=a.lastIndex}else a.lastIndex=o.lastIndex;e.push(l[0])}return e}async function bi(n,e){const s=[],t=[];return n.forEach(i=>{if("cssRules"in i)try{Z(i.cssRules||[]).forEach((o,r)=>{if(o.type===CSSRule.IMPORT_RULE){let a=r+1;const l=o.href,u=ut(l).then(c=>ht(c,e)).then(c=>mt(c).forEach(h=>{try{i.insertRule(h,h.startsWith("@import")?a+=1:i.cssRules.length)}catch(m){console.error("Error inserting rule from remote css",{rule:h,error:m})}})).catch(c=>{console.error("Error loading remote css",c.toString())});t.push(u)}})}catch(o){const r=n.find(a=>a.href==null)||document.styleSheets[0];i.href!=null&&t.push(ut(i.href).then(a=>ht(a,e)).then(a=>mt(a).forEach(l=>{r.insertRule(l,i.cssRules.length)})).catch(a=>{console.error("Error loading remote stylesheet",a)})),console.error("Error inlining remote css file",o)}}),Promise.all(t).then(()=>(n.forEach(i=>{if("cssRules"in i)try{Z(i.cssRules||[]).forEach(o=>{s.push(o)})}catch(o){console.error(`Error while reading CSS rules from ${i.href}`,o)}}),s))}function wi(n){return n.filter(e=>e.type===CSSRule.FONT_FACE_RULE).filter(e=>It(e.style.getPropertyValue("src")))}async function Li(n,e){if(n.ownerDocument==null)throw new Error("Provided element is not within a Document");const s=Z(n.ownerDocument.styleSheets),t=await bi(s,e);return wi(t)}async function Si(n,e){const s=await Li(n,e);return(await Promise.all(s.map(i=>{const o=i.parentStyleSheet?i.parentStyleSheet.href:null;return kt(i.cssText,o,e)}))).join(`
`)}async function xi(n,e){const s=e.fontEmbedCSS!=null?e.fontEmbedCSS:e.skipFonts?null:await Si(n,e);if(s){const t=document.createElement("style"),i=document.createTextNode(s);t.appendChild(i),n.firstChild?n.insertBefore(t,n.firstChild):n.appendChild(t)}}async function Ti(n,e={}){const{width:s,height:t}=Tt(n,e),i=await Be(n,e,!0);return await xi(i,e),await Ot(i,e),vi(i,e),await Hs(i,s,t)}async function Ei(n,e={}){const{width:s,height:t}=Tt(n,e),i=await Ti(n,e),o=await Ne(i),r=document.createElement("canvas"),a=r.getContext("2d"),l=e.pixelRatio||Ws(),u=e.canvasWidth||s,c=e.canvasHeight||t;return r.width=u*l,r.height=c*l,e.skipAutoScale||$s(r),r.style.width=`${u}`,r.style.height=`${c}`,e.backgroundColor&&(a.fillStyle=e.backgroundColor,a.fillRect(0,0,r.width,r.height)),a.drawImage(o,0,0,r.width,r.height),r}async function Mi(n,e={}){return(await Ei(n,e)).toDataURL()}const Rt="/Map_Demo/assets/currentPosition-33b00a21.svg";const Pi={props:{coordinate:{type:Object,default:{}}},setup(n,{emit:e}){let s;const t=J({imgSrc:"dddd"});return Ve(async()=>{s=new Re({target:"imgMap",layers:[new _t({preload:1/0,crossOrigin:"Anonymous",source:new Ns}),new Ce({source:new me({features:[new ye({geometry:new Ge(n.coordinate),population:4e3,rainfall:500})]}),style:new He({image:new ve({anchor:[.5,100],anchorXUnits:"fraction",anchorYUnits:"pixels",src:Rt})})})],view:new yt({projection:"EPSG:4326",center:n.coordinate,zoom:14})}),s.once("loadend",function(){Mi(s.getTargetElement()).then(function(i){document.getElementById("imgMap")!==null&&(document.getElementById("imgMap").remove(),t.imgSrc=i)})})}),{props:n,state:t}}},Ii=n=>(we("data-v-0bd15485"),n=n(),Le(),n),ki={class:"position-relative",style:{overflow:"hidden"}},Oi=Ii(()=>d("div",{id:"imgMap",class:"position-absolute",style:{width:"600px",height:"600px"}},null,-1));function Ri(n,e,s,t,i,o){return y(),C("div",ki,[Oi,d("div",{style:Fe([{background:`url('${t.state.imgSrc}')`,"background-size":"cover"},{width:"100%",height:"200px"}])},null,4)])}const Di=K(Pi,[["render",Ri],["__scopeId","data-v-0bd15485"]]),Fi="/Map_Demo/assets/vector-a2cf21ef.svg";const Ai={props:{popup:{type:Object,default:{}},closeMapData:{Type:Function,default:()=>{}},maxHeight:{Type:Number,default:0},coordinate:{type:Object,default:{}}},setup(n,{emit:e}){const s=vt(),t=J({type:0,media:"photo",scrollY:!1,tribeData:{data:{}}});async function i(a){return await te.ajax({url:`https://api.edtest.site/tribe?tribeCode=${a}`,method:"GET"}).done(u=>u).fail(u=>(console.log("Fail",u),t.type=0,!1))}async function o(a){return await te.ajax({url:`https://api.edtest.site/historicalDiseaster?id=${a}`,method:"GET"}).done(u=>u).fail(u=>(console.log("Fail",u),t.type=0,!1))}async function r(a){return await te.ajax({url:`https://api.edtest.site/rainData?stationName=${a}`,method:"GET"}).done(u=>u).fail(u=>(console.log("Fail",u),t.type=0,!1))}return Ct(n.popup,async a=>{if(console.log(a),a.popupData=="新竹縣原住民部落範圍"){i(a.popupId).then(l=>{t.type=1,t.tribeData=l});return}if(n.popup.popupData=="近年歷史災害82處部落點位"){o(`近年歷史災害82處部落點位.${n.popup.popupId}`).then(l=>{t.type=2,t.tribeData=l.data});return}if(n.popup.popupData=="雨量站"){o(`雨量站.${n.popup.popupId}`).then(l=>{t.type=3,l.data!==null&&(t.tribeData=l.data)});return}}),Ve(async()=>{if(n.popup.popupData=="新竹縣原住民部落範圍"){i(n.popup.popupId).then(a=>{t.type=1,t.tribeData=a});return}if(n.popup.popupData=="近年歷史災害82處部落點位"){o(`近年歷史災害82處部落點位.${n.popup.popupId}`).then(a=>{t.type=2,t.tribeData=a.data});return}if(n.popup.popupData=="雨量站"){r(`雨量站.${n.popup.popupId}`).then(a=>{t.type=3,a.data!==null&&(t.tribeData=a.data)});return}}),{router:s,props:n,state:t}}},V=n=>(we("data-v-47bf7b5c"),n=n(),Le(),n),Ni={key:0},Gi={class:"row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold"},Vi=V(()=>d("p",null,"詳細資訊",-1)),Bi=V(()=>d("svg",{width:"32",height:"32",viewBox:"0 0 24 24"},[d("path",{fill:"currentColor",d:"M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10zm0-11.414L9.172 7.757L7.757 9.172L10.586 12l-2.829 2.828l1.415 1.415L12 13.414l2.828 2.829l1.415-1.415L13.414 12l2.829-2.828l-1.415-1.415L12 10.586z"})],-1)),ji=[Bi],Wi={class:"row mx-0 align-items-center p-2 position-relative"},$i={class:"d-flex flex-nowrap align-items-center justify-content-between my-2"},zi={class:""},Hi={href:"#"},Ui=V(()=>d("img",{src:Fi,alt:""},null,-1)),Ki={class:"border-bottom row flex-nowrap p-2 my-3 cursor-pointer mx-0"},qi={key:0,class:"py-2 px-4"},Yi={class:"d-flex flex-wrap justify-content-between"},Xi={class:"w-50 mb-4"},Qi={class:"mb-0"},Zi=["src"],Ji={key:1,class:"py-2 px-4"},en=V(()=>d("div",null,"尚無影片",-1)),tn=[en],sn={key:1},nn={class:"row mx-0 align-items-center px-2 py-4 position-relative"},on={key:0,class:"row mx-0 mb-2"},rn=V(()=>d("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"事件:",-1)),an={class:"col-8 py-1 px-2 bg-grey-light text-start"},ln={key:1,class:"row mx-0 mb-2"},cn=V(()=>d("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"發生時間:",-1)),dn={class:"col-8 py-1 px-2 bg-grey-light text-start"},un={key:2,class:"row mx-0 mb-2"},hn=V(()=>d("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"鄉鎮: ",-1)),mn={class:"col-8 py-1 px-2 bg-grey-light text-start"},pn={key:3,class:"row mx-0 mb-2"},gn=V(()=>d("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"地方: ",-1)),fn={class:"col-8 py-1 px-2 bg-grey-light text-start"},_n={key:4,class:"row mx-0 mb-2"},yn=V(()=>d("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"村落: ",-1)),Cn={class:"col-8 py-1 px-2 bg-grey-light text-start"},vn={key:5,class:"row mx-0 mb-2"},bn=V(()=>d("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"災害種類: ",-1)),wn={class:"col-8 py-1 px-2 bg-grey-light text-start"},Ln={key:6,class:"row mx-0 mb-2"},Sn=V(()=>d("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"描述: ",-1)),xn={class:"col-8 py-1 px-2 bg-grey-light text-start"},Tn={key:2},En={class:"p-2 p-sm-3"},Mn=V(()=>d("p",{class:"text-start px-0 fw-bold"},"雨量站",-1)),Pn=V(()=>d("hr",null,null,-1)),In={class:"p-0 p-sm-2"},kn=V(()=>d("p",null,"單位:mm ",-1)),On={class:"rainfall border-bottom border-grey w-100"},Rn=V(()=>d("thead",null,[d("tr",{class:"text-center"},[d("td",{class:"bg-blueDeep text-white border border-white p-2"},"10分鐘"),d("td",{class:"bg-blueDeep text-white border border-white p-2"},"時雨量"),d("td",{class:"bg-blueDeep text-white border border-white p-2"},"3小時"),d("td",{class:"bg-blueDeep text-white border border-white p-2"},"6小時"),d("td",{class:"bg-blueDeep text-white border border-white p-2"},"12小時"),d("td",{class:"bg-blueDeep text-white border border-white p-2"},"24小時")])],-1)),Dn={class:"text-center"},Fn={class:"p-2"},An={class:"p-2"},Nn={class:"p-2"},Gn={class:"p-2"},Vn={class:"p-2"},Bn={class:"p-2"};function jn(n,e,s,t,i,o){var a,l,u,c,h,m,p,f,S,x,I,_,T,v,g,w,b,k,L,D,H,q,U,ie,le,xe,Te,ne;const r=Di;return y(),C("div",{class:"bg-white rounded py-2",style:Fe([{"overflow-y":"auto"},{"max-height":t.props.maxHeight+"px"}])},[t.state.type===1?(y(),C("div",Ni,[d("div",Gi,[Vi,d("div",{class:"position-absolute col-auto end-0 cursor-pointer",style:{top:"10px"},onClick:e[0]||(e[0]=(...P)=>t.props.closeMapData&&t.props.closeMapData(...P))},ji)]),B(r,{coordinate:t.props.popup.coordinate,type:t.state.type},null,8,["coordinate","type"]),d("div",Wi,[d("div",$i,[d("span",zi,M((u=(l=(a=t.state)==null?void 0:a.tribeData)==null?void 0:l.basicInformation)==null?void 0:u.tribeName),1),d("div",{class:"p-2 bg-steel w-auto text-white d-inline-block rounded-2 cursor-pointer",onClick:e[1]||(e[1]=()=>{t.router.push({name:"detail",params:{id:t.props.popup.popupId}})})},"更多資訊")]),d("p",null,"描述: "+M((m=(h=(c=t.state)==null?void 0:c.tribeData)==null?void 0:h.basicInformation)==null?void 0:m.description),1),d("p",null,M((S=(f=(p=t.state)==null?void 0:p.tribeData)==null?void 0:f.basicInformation)==null?void 0:S.area),1),d("a",Hi,[Ui,be(" "+M((v=(T=(_=(I=(x=t.state)==null?void 0:x.tribeData)==null?void 0:I.basicInformation)==null?void 0:_.coordinates)==null?void 0:T.WGS84)==null?void 0:v.lat)+" , "+M((L=(k=(b=(w=(g=t.state)==null?void 0:g.tribeData)==null?void 0:w.basicInformation)==null?void 0:b.coordinates)==null?void 0:k.WGS84)==null?void 0:L.lng),1)])]),d("div",null,[d("div",Ki,[d("div",{class:"col-6 cursor-pointer",onClick:e[2]||(e[2]=P=>t.state.media="photo")},"相片"),d("div",{class:"col-6 cursor-pointer",onClick:e[3]||(e[3]=P=>t.state.media="video")},"影片")]),t.state.media==="photo"?(y(),C("div",qi,[d("div",Yi,[(y(!0),C(X,null,Q((H=(D=t.state)==null?void 0:D.tribeData)==null?void 0:H.culturalLandscape,P=>(y(),C("div",Xi,[d("p",Qi,M(P.name),1),d("img",{src:P.image,alt:"",class:"w-100"},null,8,Zi)]))),256))])])):E("",!0),t.state.media==="video"?(y(),C("div",Ji,tn)):E("",!0)])])):E("",!0),t.state.type===2?(y(),C("div",sn,[d("div",nn,[t.state.tribeData.event?(y(),C("div",on,[rn,d("div",an,M(t.state.tribeData.event),1)])):E("",!0),t.state.tribeData.date?(y(),C("div",ln,[cn,d("div",dn,M(t.state.tribeData.date),1)])):E("",!0),t.state.tribeData.township?(y(),C("div",un,[hn,d("div",mn,M(t.state.tribeData.township),1)])):E("",!0),t.state.tribeData.village?(y(),C("div",pn,[gn,d("div",fn,M(t.state.tribeData.village),1)])):E("",!0),t.state.tribeData.place?(y(),C("div",_n,[yn,d("div",Cn,M(t.state.tribeData.place),1)])):E("",!0),t.state.tribeData.category?(y(),C("div",vn,[bn,d("div",wn,M(t.state.tribeData.category),1)])):E("",!0),t.state.tribeData.description?(y(),C("div",Ln,[Sn,d("div",xn,M(t.state.tribeData.description),1)])):E("",!0)])])):E("",!0),t.state.type===3?(y(),C("div",Tn,[d("div",En,[Mn,Pn,d("div",In,[d("p",null,"觀測時間: "+M((q=t.state.tribeData)==null?void 0:q.viewDatetime),1),kn,d("table",On,[Rn,d("tbody",null,[d("tr",Dn,[d("td",Fn,M((U=t.state.tribeData)==null?void 0:U.min_10),1),d("td",An,M((ie=t.state.tribeData)==null?void 0:ie.hour_1),1),d("td",Nn,M((le=t.state.tribeData)==null?void 0:le.hour_3),1),d("td",Gn,M((xe=t.state.tribeData)==null?void 0:xe.hour_6),1),d("td",Vn,M((Te=t.state.tribeData)==null?void 0:Te.hour_12),1),d("td",Bn,M((ne=t.state.tribeData)==null?void 0:ne.hour_24),1)])])])])])])):E("",!0)],4)}const Wn=K(Ai,[["render",jn],["__scopeId","data-v-47bf7b5c"]]),Dt="/Map_Demo/assets/logo-83a41ce3.svg",$n="/Map_Demo/assets/2D-m-0cdbc246.svg",zn="/Map_Demo/assets/3D-m-4ecf18c0.svg",Hn="/Map_Demo/assets/vector-m-1fc5cf13.svg",Un="/Map_Demo/assets/selectVector-m-e4f4d97a.svg",Kn="/Map_Demo/assets/singleWindow-m-4635df1a.svg",qn="/Map_Demo/assets/doubleWindow-m-cccef2df.svg";const Yn={props:{currentLayers:{type:Array,default:[]},mapCount:{type:Number,default:1},dimensionMapStatus:{type:Boolean,default:!1},openConditionWrap:{type:Function,default:()=>{}},openLayerSelect:{type:Function,default:()=>{}},onLayerControl:{type:Function,default:()=>{}},onChangeTarget:{type:Function,default:()=>{}},onChangeMapCount:{type:Function,default:()=>{}}},setup(n,{emit:e}){const s=J({toolSwitch:{threeDimensionalBtn:!1,layerConditionBtn:!1,splitWindowBtn:!1},targetNum:1});function t(r,a){Object.keys(s.toolSwitch).forEach(l=>{l===r?s.toolSwitch[r]?s.toolSwitch[r]=!1:s.toolSwitch[r]=!0:s.toolSwitch[l]=!1})}function i(r,a){r==="changeMapCount"&&(s.toolSwitch.splitWindowBtn=!1),n.onLayerControl({action:r,value:a})}function o(){e("conditionWrap")}return{props:n,state:s,toolSwitch:t,onLayerControl:i,conditionWrap:o}}},Xn={class:"w-100"},Qn={class:"position-fixed top-0 w-100 px-3 d-flex justify-content-between justify-content-sm-end flex-wrap"},Zn=d("img",{src:Dt,class:"w-50 w-lg-100"},null,-1),Jn={class:"switchControl mt-2 me-0 me-sm-2 d-block rounded-4 p-2",id:"switchControl",style:{"z-index":"99"}},eo={class:"list-unstyled d-flex align-items-center justify-content-around py-2 flex-nowrap w-100 bg-white mb-0"},to=d("img",{src:$n},null,-1),so=[to],io=d("img",{src:zn},null,-1),no=[io],oo=d("img",{src:Hn},null,-1),ro=[oo],ao=d("img",{src:Un},null,-1),lo=[ao],co={class:"text-white"},uo=d("img",{src:Kn},null,-1),ho=[uo],mo=d("img",{src:qn},null,-1),po=[mo];function go(n,e,s,t,i,o){return y(),C("div",Xn,[d("div",Qn,[Zn,d("div",Jn,[d("div",{class:z(["text-white rounded-pill",{active:t.state.targetNum===1}]),onClick:e[0]||(e[0]=()=>{t.state.targetNum=1,t.props.onChangeTarget(1)})},"上",2),d("div",{class:z(["text-white rounded-pill",{active:t.state.targetNum===2}]),onClick:e[1]||(e[1]=()=>{t.state.targetNum=2,t.props.onChangeTarget(2)})},"下",2)])]),d("ul",eo,[d("li",null,[d("div",null,[t.props.dimensionMapStatus?(y(),C("div",{key:0,class:"navbarBtn",onClick:e[2]||(e[2]=O(r=>(t.toolSwitch("threeDimensionalBtn"),t.onLayerControl("changeDimensionMap","3D")),["prevent"]))},so)):(y(),C("div",{key:1,class:"navbarBtn",onClick:e[3]||(e[3]=O(r=>(t.toolSwitch("threeDimensionalBtn"),t.onLayerControl("changeDimensionMap","2D")),["prevent"]))},no))])]),d("li",null,[d("div",{class:"navbarBtn",onClick:e[4]||(e[4]=r=>t.props.openConditionWrap())},ro)]),d("li",null,[d("div",{class:"navbarBtn",onClick:e[5]||(e[5]=r=>t.props.openLayerSelect())},lo)]),d("li",null,[d("div",co,[t.props.mapCount===1?(y(),C("div",{key:0,class:"navbarBtn",onClick:e[6]||(e[6]=O(r=>t.props.onChangeMapCount(2),["prevent"]))},ho)):E("",!0),t.props.mapCount===2?(y(),C("div",{key:1,class:"navbarBtn",onClick:e[7]||(e[7]=O(r=>t.props.onChangeMapCount(1),["prevent"]))},po)):E("",!0)])])])])}const fo=K(Yn,[["render",go]]),_o="/Map_Demo/assets/lockOpen-34ad2519.svg",Ft="/Map_Demo/assets/deleteLayer-f326d138.svg",yo="/Map_Demo/assets/arrow_up-75a5d1eb.svg",Co="/Map_Demo/assets/arrow_down-57e34976.svg",vo="/Map_Demo/assets/eyes-e3c32f20.svg";const bo={props:{onClose:{type:Function,default:()=>{}},onDeleteLayer:{type:Function,default:()=>{}},onLockLayer:{type:Function,default:()=>{}},currentLayers:{type:Array,default:[]},selectLock:{type:Boolean,default:!1},onLayerControl:{type:Function,default:()=>{}}},setup(n,{emit:e}){const s=J({});function t(i){n.onLayerControl({action:"setOpacity",value:{key:i.target.getAttribute("nodeindex"),value:i.target.value}});const o=parseFloat(Number(i.target.value));document.getElementById(`opacityControl${i.target.getAttribute("nodeindex")}`).innerText=o.toFixed(2)}return{props:n,state:s,updateOpacity:t}}},se=n=>(we("data-v-9aa686f1"),n=n(),Le(),n),wo={class:"layerSelect bg-white"},Lo={class:"row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold"},So=se(()=>d("p",{class:"mb-0 fs-5"},"已選擇的圖層",-1)),xo=se(()=>d("hr",{class:"my-0"},null,-1)),To={class:"py-3 px-4 content",style:{"overflow-y":"scroll","max-height":"40vh"}},Eo={class:"allControl d-flex align-items-center justify-content-end mb-0"},Mo=se(()=>d("img",{src:_o,alt:""},null,-1)),Po=se(()=>d("img",{src:Ft,alt:""},null,-1)),Io={class:"list-unstyled d-flex flex-wrap flex-column-reverse"},ko={key:0,class:"d-flex justify-content-between align-items-center border-bottom py-2 flex-wrap"},Oo={class:"tool"},Ro=["onClick"],Do=se(()=>d("img",{src:yo,alt:""},null,-1)),Fo=[Do],Ao=["onClick"],No=se(()=>d("img",{src:Co,alt:""},null,-1)),Go=[No],Vo=["onClick"],Bo=se(()=>d("img",{src:vo,alt:""},null,-1)),jo=[Bo],Wo=["onClick"],$o=se(()=>d("img",{src:Ft,alt:""},null,-1)),zo=[$o],Ho={class:"w-100 mt-2 d-flex align-items-center"},Uo=["nodeIndex"],Ko=["id"];function qo(n,e,s,t,i,o){return y(),C("div",wo,[d("div",Lo,[So,d("a",{href:"#",class:"closeBtn bg-dark text-decoration-none rounded-circle position-absolute d-flex align-items-center justify-content-center",onClick:e[0]||(e[0]=O((...r)=>t.props.onClose&&t.props.onClose(...r),["prevent"]))})]),xo,d("div",To,[d("div",Eo,[d("a",{href:"",class:z(["d-flex align-items-center text-decoration-none me-3",{lockUp:t.props.selectLock,unlock:!t.props.selectLock}]),onClick:e[1]||(e[1]=O(()=>{t.props.onLockLayer()},["prevent"]))},[Mo,be(" 鎖定圖層 ")],2),d("a",{href:"",class:z(["d-flex align-items-center text-decoration-none",{disabled:t.props.currentLayers.length<=1}]),onClick:e[2]||(e[2]=O(()=>{t.props.currentLayers.length>0&&t.props.onDeleteLayer({action:"selectLayerMode",value:{layerName:"all"}})},["prevent"]))},[Po,be(" 全部取消 ")],2)]),d("ul",Io,[(y(!0),C(X,null,Q(t.props.currentLayers,(r,a)=>(y(),C("li",null,[r.id?(y(),C("div",ko,[d("div",null,M(r==null?void 0:r.label),1),d("div",Oo,[d("a",{href:"",onClick:O(l=>t.props.onLayerControl({action:"changeOrder",value:{movement:"up",id:r.id,key:a}}),["prevent"])},Fo,8,Ro),d("a",{href:"",onClick:O(l=>t.props.onLayerControl({action:"changeOrder",value:{movement:"down",id:r.id,key:a}}),["prevent"])},Go,8,Ao),d("a",{href:"",class:z({Invisible:!(r!=null&&r.visible)}),onClick:O(()=>{t.props.onLayerControl({action:"changeLayerVisible",value:{key:a}})},["prevent"])},jo,10,Vo),d("a",{href:"",onClick:O(l=>t.props.onDeleteLayer({action:"selectLayerMode",value:{id:r==null?void 0:r.id}}),["prevent"])},zo,8,Wo)]),d("label",Ho,[d("input",{id:"opacity-input",class:"w-75 me-2",type:"range",min:"0",max:"1",step:"0.01",value:"1",nodeIndex:a,onInput:e[3]||(e[3]=(...l)=>t.updateOpacity&&t.updateOpacity(...l))},null,40,Uo),d("span",{id:`opacityControl${a}`},"1",8,Ko)])])):E("",!0)]))),256))])])])}const Yo=K(bo,[["render",qo],["__scopeId","data-v-9aa686f1"]]);const Xo={props:{text:{type:String,default:"測試"},styles:{type:String,default:""},status:{type:Boolean,default:!0}},setup(n,{emit:e}){const s=bt(),t=Is,i=Ps(null),o=J({overLayerHeight:ue(()=>{var r;return((r=i==null?void 0:i.value)==null?void 0:r.offsetHeight)+10}),overLayerWidth:ue(()=>{var r;return((r=i==null?void 0:i.value)==null?void 0:r.offsetWidth)+10}),accordionListRef:null,accordionListRefHeight:ue(()=>{var r;return(r=o.accordionListRef)==null?void 0:r.offsetHeight}),accordionListRefWidth:ue(()=>{var r;return(r=o.accordionListRef)==null?void 0:r.offsetWidth})});return Ve(()=>{te(".initOverLay").parent().addClass("position-relative")}),{state:o,props:n,store:s,route:t,overLayCom:i}}};function Qo(n,e,s,t,i,o){return t.store.state.isInit?(y(),C("div",{key:0,class:"initOverLay",onClick:e[0]||(e[0]=r=>t.store.dispatch("updateLayerStatus",!1)),style:Fe({height:t.state.overLayerHeight+"px",width:t.state.overLayerWidth+"px"}),ref:r=>{t.state.accordionListRef=r}},[d("div",{class:"tipText text-white fw-bold fs-3",style:Fe(t.props.styles)},M(t.props.text),5)],4)):E("",!0)}const je=K(Xo,[["render",Qo]]);const Zo={props:{onClose:{type:Function,default:()=>{}},mapLayers:{type:Array,default:[]},currentLayers:{type:Array,default:[]},showSelectLayerValue:{type:Function,default:()=>{}},selectLayerOption:{type:Object,default:{}},tribeQuery:{type:Object,default:{}},moveToMap:{type:Function,default:()=>{}}},setup(n,{emit:e}){const s=De,t=vt(),i=J({DropDown:null,TilesListValue:0,conditionYear:"",conditionTown:"",selectLayerOption:[]});function o(m,p){e("onLayerControl",{action:m,value:p})}function r(m){i.DropDown!==m?i.DropDown=m:i.DropDown=null}function a(m,p){let f=m.target.checked||typeof m.target.checked==" ";o("layerMode",{checked:f,nodeIndex:p.nodeIndex,subNodeIndex:p.subNodeIndex,nestedSubNodeIndex:String(p.nestedSubNodeIndex)?p.nestedSubNodeIndex:void 0,id:p.single_tiles||!m.target.selectedOptions?p.id:m.target.selectedOptions[0].id})}function l(m){i.conditionYear=m.target.value,c()}function u(m){i.conditionTown=m.target.value,c()}async function c(){const m=await te.ajax(`https://api.edtest.site/tribes?${"years="+i.conditionYear}&${"township="+i.conditionTown}`,"GET");i.selectLayerOption=m}function h(m){let p=i.selectLayerOption.find(f=>f.tribeCode===m.target.value);n.moveToMap(p.coordinates)}return Ct(()=>i.TilesListValue,(m,p)=>{n.showSelectLayerValue(m)}),{props:n,state:i,router:t,mapList:s,onLayerControl:o,openLayerList:r,LayerCheckBoxChange:a,tribeYear:l,tribeTown:u,moveMap:h}}},At=n=>(we("data-v-a584a5fe"),n=n(),Le(),n),Jo={class:"condition bg-white"},er={class:"row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold border-bottom"},tr=At(()=>d("p",{class:"mb-0 fs-5"},"圖層選項",-1)),sr={class:"py-3 px-4 content",style:{"max-height":"40vh","overflow-y":"scroll"}},ir={class:"mb-2 landBoundary"},nr={class:"mb-2"},or=["onClick"],rr=At(()=>d("path",{fill:"currentColor",d:"M8 5v14l11-7z"},null,-1)),ar=[rr],lr={class:"ms-3 mb-1"},cr={key:0},dr=["checked","onChange"],ur={key:0},hr={key:0},mr=["value"],pr=["value"],gr=["value"],fr={key:1},_r=["checked","onChange"],yr=["onChange"],Cr=["value","id"];function vr(n,e,s,t,i,o){return y(),C("div",Jo,[d("div",er,[tr,d("a",{href:"#",class:"closeBtn bg-dark text-decoration-none rounded-circle position-absolute d-flex align-items-center justify-content-center",onClick:e[0]||(e[0]=O((...r)=>t.props.onClose&&t.props.onClose(...r),["prevent"]))})]),d("div",sr,[d("div",ir,[(y(!0),C(X,null,Q(t.props.mapLayers,(r,a)=>(y(),C("div",nr,[d("div",{class:"title d-flex align-items-center fw-bold text-black order-1 mb-1 text-decoration-none",onClick:l=>t.openLayerList(a)},[d("div",{class:z(r.groupClass)},null,2),d("div",null,M(r.label),1),(y(),C("svg",{viewBox:"0 0 24 24",class:z({openTitle:t.state.DropDown==a})},ar,2))],8,or),t.state.DropDown==a?(y(!0),C(X,{key:0},Q(r.layers,(l,u)=>(y(),C("div",lr,[l.single_tiles?(y(),C("div",cr,[d("input",{type:"checkbox",checked:t.props.currentLayers.some(c=>c.id===l.id),onChange:c=>{t.LayerCheckBoxChange(c,{nodeIndex:a,subNode:l,subNodeIndex:u,nestedSubNodeIndex:"",single_tiles:l.single_tiles,id:l.id})}},null,40,dr),be(" "+M(l.title)+" ",1),(y(),C("div",ur,[l.id==="node4_subNode0_nestedSubNodeundefined"?(y(),C("div",hr,[t.props.tribeQuery.years!==void 0?(y(),C("select",{key:0,class:"me-2",onChange:e[1]||(e[1]=(...c)=>t.tribeYear&&t.tribeYear(...c)),placeholder:"請選擇年度"},[(y(!0),C(X,null,Q(t.props.tribeQuery.years,(c,h)=>(y(),C("option",{value:c},M(c),9,mr))),256))],32)):E("",!0),t.props.tribeQuery.township!==void 0?(y(),C("select",{key:1,class:"me-2",onChange:e[2]||(e[2]=(...c)=>t.tribeTown&&t.tribeTown(...c)),placeholder:"請選擇鄉鎮"},[(y(!0),C(X,null,Q(t.props.tribeQuery.township,(c,h)=>(y(),C("option",{value:c},M(c),9,pr))),256))],32)):E("",!0),t.state.selectLayerOption.length!==0?(y(),C("select",{key:2,class:"me-2",onChange:e[3]||(e[3]=(...c)=>t.moveMap&&t.moveMap(...c))},[(y(!0),C(X,null,Q(t.state.selectLayerOption,(c,h)=>(y(),C("option",{value:c.tribeCode},M(c.tribeName),9,gr))),256))],32)):E("",!0)])):E("",!0)]))])):(y(),C("div",fr,[d("input",{type:"checkbox",checked:t.props.currentLayers.some(c=>{let h=t.mapList.getLayerIndex(c.id);return h.nodeIndex==a&&h.subNodeIndex==u}),onChange:c=>{t.LayerCheckBoxChange(c,{nodeIndex:a,subNode:l,subNodeIndex:u,nestedSubNodeIndex:"",single_tiles:l.single_tiles,id:l.id})}},null,40,_r),be(" "+M(l.title)+" ",1),wt(d("select",{name:"",id:"",class:"ms-3","onUpdate:modelValue":e[4]||(e[4]=c=>t.state.TilesListValue=c),onChange:c=>{t.LayerCheckBoxChange(c,{nodeIndex:a,subNode:l,subNodeIndex:u,nestedSubNodeIndex:t.state.TilesListValue,single_tiles:l.single_tiles,id:l.id})}},[(y(!0),C(X,null,Q(l.tiles_list,(c,h)=>(y(),C("option",{value:h,id:c.id},M(c.title),9,Cr))),256))],40,yr),[[Lt,t.state.TilesListValue]])]))]))),256)):E("",!0)]))),256))])])])}const br=K(Zo,[["render",vr],["__scopeId","data-v-a584a5fe"]]),wr="/Map_Demo/assets/2D-70e1bbad.svg",Lr="/Map_Demo/assets/3D-cb71f302.svg",Sr="/Map_Demo/assets/baseLayer-3608307c.svg",Nt="/Map_Demo/assets/singleWindow-1afc73e5.svg",Gt="/Map_Demo/assets/doubleWindows-82f012fb.svg";const xr={props:{currentLayers:{type:Array,default:[]},mapCount:{type:Number,default:1},dimensionMapStatus:{type:Boolean,default:!1},onChangeMapCount:{type:Function,default:()=>{}}},setup(n,{emit:e}){const s=J({toolSwitch:{threeDimensionalBtn:!1,layerConditionBtn:!1,splitWindowBtn:!1},targetNum:1});function t(a,l){Object.keys(s.toolSwitch).forEach(u=>{u===a?s.toolSwitch[a]?s.toolSwitch[a]=!1:s.toolSwitch[a]=!0:s.toolSwitch[u]=!1})}function i(a,l){e("onLayerControl",{action:a,value:l})}function o(){e("conditionWrap")}function r(a){s.targetNum=a,e("onChangeTarget",a)}return{props:n,state:s,toolSwitch:t,onLayerControl:i,conditionWrap:o,onChangeTarget:r}}},Se=n=>(we("data-v-61edd624"),n=n(),Le(),n),Tr={class:"list-unstyled d-inline-flex align-items-center flex-nowrap w-full"},Er={class:"me-4 position-relative"},Mr={class:"MapFeatureBtn text-white"},Pr=Se(()=>d("img",{src:wr},null,-1)),Ir=[Pr],kr=Se(()=>d("img",{src:Lr},null,-1)),Or=[kr],Rr={class:"me-4 position-relative"},Dr=Se(()=>d("img",{src:Sr,alt:""},null,-1)),Fr=[Dr],Ar={class:"position-relative"},Nr={key:0,src:Nt,alt:""},Gr={key:1,src:Gt,alt:""},Vr={key:0,class:"list-unstyled position-absolute start-0 top-100 p-0"},Br={class:"mt-2"},jr=Se(()=>d("img",{src:Nt,alt:""},null,-1)),Wr=[jr],$r={class:"mt-2"},zr=Se(()=>d("img",{src:Gt,alt:""},null,-1)),Hr=[zr],Ur={class:"switchControl d-flex position-fixed rounded-pill translate-middle-x p-2",id:"switchControl",style:{"z-index":"99"}};function Kr(n,e,s,t,i,o){const r=je;return y(),C("div",null,[d("ul",Tr,[B(r,{text:"圖層操控工具"}),d("li",Er,[d("div",Mr,[t.props.dimensionMapStatus?(y(),C("a",{key:0,href:"",onClick:e[0]||(e[0]=O(a=>(t.toolSwitch("threeDimensionalBtn"),t.onLayerControl("changeDimensionMap","3D")),["prevent"]))},Ir)):(y(),C("a",{key:1,href:"",onClick:e[1]||(e[1]=O(a=>(t.toolSwitch("threeDimensionalBtn"),t.onLayerControl("changeDimensionMap","2D")),["prevent"]))},Or))])]),d("li",Rr,[d("a",{href:"",class:"MapFeatureBtn text-white",onClick:e[2]||(e[2]=O(a=>(t.toolSwitch("layerConditionBtn"),t.conditionWrap()),["prevent"]))},Fr)]),d("li",Ar,[d("a",{href:"",class:"MapFeatureBtn text-white",onClick:e[3]||(e[3]=O(a=>t.toolSwitch("splitWindowBtn"),["prevent"]))},[t.props.mapCount===1?(y(),C("img",Nr)):E("",!0),t.props.mapCount===2?(y(),C("img",Gr)):E("",!0)]),t.state.toolSwitch.splitWindowBtn?(y(),C("ul",Vr,[d("li",Br,[d("a",{href:"",class:"text-white MapFeatureBtn",onClick:e[4]||(e[4]=O(a=>t.props.onChangeMapCount(1),["prevent"]))},Wr)]),d("li",$r,[d("a",{href:"",class:"text-white MapFeatureBtn",onClick:e[5]||(e[5]=O(a=>t.props.onChangeMapCount(2),["prevent"]))},Hr)])])):E("",!0)])]),d("div",Ur,[B(r,{text:"左右視窗切換工具"}),d("div",{class:z(["fs-3 text-white rounded-pill",{active:t.state.targetNum===1}]),onClick:e[6]||(e[6]=()=>{t.onChangeTarget(1)})},"左",2),d("div",{class:z(["fs-3 text-white rounded-pill",{active:t.state.targetNum===2}]),onClick:e[7]||(e[7]=()=>{t.onChangeTarget(2)})},"右",2)])])}const qr=K(xr,[["render",Kr],["__scopeId","data-v-61edd624"]]);const Yr={props:{baseMapList:{type:Array,default:[]},onChangeBaseMaps:{type:Function,default:()=>{}}},setup(n,{emit:e}){return{state:J({selectMap:0,mapSourceList:[]}),props:n}}},Xr=["value"];function Qr(n,e,s,t,i,o){const r=je;return y(),C("div",null,[B(r,{text:"底圖切換工具"}),wt(d("select",{name:"",id:"","onUpdate:modelValue":e[0]||(e[0]=a=>t.state.selectMap=a),onChange:e[1]||(e[1]=a=>{let l=t.props.baseMapList.find(u=>u.baseId===t.state.selectMap);t.props.onChangeBaseMaps({action:"baseMap",value:l})})},[(y(!0),C(X,null,Q(t.props.baseMapList,(a,l)=>(y(),C("option",{key:l,value:a.baseId},M(a.label),9,Xr))),128))],544),[[Lt,t.state.selectMap]])])}const Zr=K(Yr,[["render",Qr],["__scopeId","data-v-9c2d2c26"]]),Jr="/Map_Demo/assets/zoomIn-c80b5dd3.svg",ea="/Map_Demo/assets/zoomOut-88993246.svg",ta="/Map_Demo/assets/compass-1c1efd7a.svg",sa="/Map_Demo/assets/location-b52d62b2.svg",ia="/Map_Demo/assets/zoom-8acdf5b3.svg",na={props:{id:{Type:String,default:0},map:{}},setup(n,{emit:e}){function s(t){e("onMapControl",{action:t})}return{props:n,onMapControl:s}}},oa={class:"d-flex flex-nowrap flex-column"},ra=d("img",{src:Jr,alt:"zoomIn"},null,-1),aa=[ra],la=d("img",{src:ea,alt:"zoomOut"},null,-1),ca=[la],da=d("img",{src:ta,alt:"compass"},null,-1),ua=[da],ha=d("img",{src:sa,alt:"location"},null,-1),ma=[ha],pa=d("img",{src:ia,alt:"zoom"},null,-1),ga=[pa];function fa(n,e,s,t,i,o){const r=je;return y(),C("div",oa,[B(r,{text:"地圖操控工具"}),d("a",{href:"#",class:"d-none d-sm-block order-1 mb-0",onClick:e[0]||(e[0]=O(a=>t.onMapControl("In"),["prevent"]))},aa),d("a",{href:"#",class:"d-none d-sm-block order-1 mb-2",onClick:e[1]||(e[1]=O(a=>t.onMapControl("Out"),["prevent"]))},ca),d("a",{href:"#",class:"order-1 mb-2",onClick:e[2]||(e[2]=O(a=>t.onMapControl("toNorth"),["prevent"]))},ua),d("a",{href:"#",class:"order-1 mb-2",onClick:e[3]||(e[3]=O(a=>t.onMapControl("moveTo"),["prevent"]))},ma),d("a",{href:"#",class:"order-1",onClick:e[4]||(e[4]=O(a=>t.onMapControl("fullScreen"),["prevent"]))},ga)])}const _a=K(na,[["render",fa]]),ya={SELECT:"select"};class Ca extends us{constructor(e,s,t,i){super(e),this.selected=s,this.deselected=t,this.mapBrowserEvent=i}}const ke={};class Qe extends os{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=e.condition?e.condition:rs,this.addCondition_=e.addCondition?e.addCondition:et,this.removeCondition_=e.removeCondition?e.removeCondition:et,this.toggleCondition_=e.toggleCondition?e.toggleCondition:as,this.multi_=e.multi?e.multi:!1,this.filter_=e.filter?e.filter:tt,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.style_=e.style!==void 0?e.style:va(),this.features_=e.features||new ls;let s;if(e.layers)if(typeof e.layers=="function")s=e.layers;else{const t=e.layers;s=function(i){return t.includes(i)}}else s=tt;this.layerFilter_=s,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(e,s){this.featureLayerAssociation_[re(e)]=s}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(e){return this.featureLayerAssociation_[re(e)]}setHitTolerance(e){this.hitTolerance_=e}setMap(e){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(e),e?(this.features_.addEventListener(Me.ADD,this.boundAddFeature_),this.features_.addEventListener(Me.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(Me.ADD,this.boundAddFeature_),this.features_.removeEventListener(Me.REMOVE,this.boundRemoveFeature_))}addFeature_(e){const s=e.element;if(this.style_&&this.applySelectedStyle_(s),!this.getLayer(s)){const t=this.getMap().getAllLayers().find(function(i){if(i instanceof Ce&&i.getSource()&&i.getSource().hasFeature(s))return i});t&&this.addFeatureLayerAssociation_(s,t)}}removeFeature_(e){this.style_&&this.restorePreviousStyle_(e.element)}getStyle(){return this.style_}applySelectedStyle_(e){const s=re(e);s in ke||(ke[s]=e.getStyle()),e.setStyle(this.style_)}restorePreviousStyle_(e){const s=this.getMap().getInteractions().getArray();for(let i=s.length-1;i>=0;--i){const o=s[i];if(o!==this&&o instanceof Qe&&o.getStyle()&&o.getFeatures().getArray().lastIndexOf(e)!==-1){e.setStyle(o.getStyle());return}}const t=re(e);e.setStyle(ke[t]),delete ke[t]}removeFeatureLayerAssociation_(e){delete this.featureLayerAssociation_[re(e)]}handleEvent(e){if(!this.condition_(e))return!0;const s=this.addCondition_(e),t=this.removeCondition_(e),i=this.toggleCondition_(e),o=!s&&!t&&!i,r=e.map,a=this.getFeatures(),l=[],u=[];if(o){cs(this.featureLayerAssociation_),r.forEachFeatureAtPixel(e.pixel,(c,h)=>{if(!(!(c instanceof ye)||!this.filter_(c,h)))return this.addFeatureLayerAssociation_(c,h),u.push(c),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let c=a.getLength()-1;c>=0;--c){const h=a.item(c),m=u.indexOf(h);m>-1?u.splice(m,1):(a.remove(h),l.push(h))}u.length!==0&&a.extend(u)}else{r.forEachFeatureAtPixel(e.pixel,(c,h)=>{if(!(!(c instanceof ye)||!this.filter_(c,h)))return(s||i)&&!a.getArray().includes(c)?(this.addFeatureLayerAssociation_(c,h),u.push(c)):(t||i)&&a.getArray().includes(c)&&(l.push(c),this.removeFeatureLayerAssociation_(c)),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let c=l.length-1;c>=0;--c)a.remove(l[c]);a.extend(u)}return(u.length>0||l.length>0)&&this.dispatchEvent(new Ca(ya.SELECT,u,l,e)),!0}}function va(){const n=ds();return st(n.Polygon,n.LineString),st(n.GeometryCollection,n.LineString),function(e){return e.getGeometry()?n[e.getGeometry().getType()]:null}}const ba=Qe,ze="units",wa=[1,2,5],ge=25.4/.28;class La extends hs{constructor(e){e=e||{};const s=document.createElement("div");s.style.pointerEvents="none",super({element:s,render:e.render,target:e.target}),this.on,this.once,this.un;const t=e.className!==void 0?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=t+"-inner",this.element.className=t+" "+ms,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth!==void 0?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(ze,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(ze)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(ze,e)}setDpi(e){this.dpi_=e}updateElement_(){const e=this.viewState_;if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const s=e.center,t=e.projection,i=this.getUnits(),o=i=="degrees"?"degrees":"m";let r=it(t,e.resolution,s,o);const a=this.minWidth_*(this.dpi_||ge)/ge,l=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||ge)/ge:void 0;let u=a*r,c="";if(i=="degrees"){const T=ps.degrees;u*=T,u<T/60?(c="″",r*=3600):u<T?(c="′",r*=60):c="°"}else i=="imperial"?u<.9144?(c="in",r/=.0254):u<1609.344?(c="ft",r/=.3048):(c="mi",r/=1609.344):i=="nautical"?(r/=1852,c="NM"):i=="metric"?u<.001?(c="μm",r*=1e6):u<1?(c="mm",r*=1e3):u<1e3?c="m":(c="km",r/=1e3):i=="us"?u<.9144?(c="in",r*=39.37):u<1609.344?(c="ft",r/=.30480061):(c="mi",r/=1609.3472):pt(!1,33);let h=3*Math.floor(Math.log(a*r)/Math.log(10)),m,p,f,S,x,I;for(;;){f=Math.floor(h/3);const T=Math.pow(10,f);if(m=wa[(h%3+3)%3]*T,p=Math.round(m/r),isNaN(p)){this.element.style.display="none",this.renderedVisible_=!1;return}if(l!==void 0&&p>=l){m=S,p=x,f=I;break}else if(p>=a)break;S=m,x=p,I=f,++h}const _=this.scaleBar_?this.createScaleBar(p,m,c):m.toFixed(f<0?-f:0)+" "+c;this.renderedHTML_!=_&&(this.innerElement_.innerHTML=_,this.renderedHTML_=_),this.renderedWidth_!=p&&(this.innerElement_.style.width=p+"px",this.renderedWidth_=p),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,s,t){const i=this.getScaleForResolution(),o=i<1?Math.round(1/i).toLocaleString()+" : 1":"1 : "+Math.round(i).toLocaleString(),r=this.scaleBarSteps_,a=e/r,l=[this.createMarker("absolute")];for(let c=0;c<r;++c){const h=c%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";l.push(`<div><div class="ol-scale-singlebar ${h}" style="width: ${a}px;"></div>`+this.createMarker("relative")+(c%2===0||r===2?this.createStepText(c,e,!1,s,t):"")+"</div>")}return l.push(this.createStepText(r,e,!0,s,t)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+o+"</div>":"")+l.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e==="absolute"?3:-10}px;"></div>`}createStepText(e,s,t,i,o){const a=(e===0?0:Math.round(i/this.scaleBarSteps_*e*100)/100)+(e===0?"":" "+o),l=e===0?-3:s/this.scaleBarSteps_*-1,u=e===0?0:s/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${l}px;text-align: ${e===0?"left":"center"};min-width: ${u}px;left: ${t?s+"px":"unset"};">`+a+"</div>"}getScaleForResolution(){const e=it(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),s=this.dpi_||ge,t=1e3/25.4;return e*t*s}render(e){const s=e.frameState;s?this.viewState_=s.viewState:this.viewState_=null,this.updateElement_()}}const Sa=La;class xa{constructor(e){this.ol3d=e,this.scene_=e.getCesiumScene(),this.canvas_=this.scene_.canvas,this._boundNotifyRepaintRequired=this.notifyRepaintRequired.bind(this),this.repaintEventNames_=["mousemove","mousedown","mouseup","touchstart","touchend","touchmove","pointerdown","pointerup","pointermove","wheel"],this.enable()}enable(){this.scene_.requestRenderMode=!0,this.scene_.maximumRenderTimeChange=1e3;for(const e of this.repaintEventNames_)this.canvas_.addEventListener(e,this._boundNotifyRepaintRequired,!1);window.addEventListener("resize",this._boundNotifyRepaintRequired,!1),this.ol3d.getOlMap().getLayerGroup().on("change",this._boundNotifyRepaintRequired)}disable(){for(const e of this.repaintEventNames_)this.canvas_.removeEventListener(e,this._boundNotifyRepaintRequired,!1);window.removeEventListener("resize",this._boundNotifyRepaintRequired,!1),this.ol3d.getOlMap().getLayerGroup().un("change",this._boundNotifyRepaintRequired),this.scene_.requestRenderMode=!1}restartRenderLoop(){this.notifyRepaintRequired()}notifyRepaintRequired(){this.scene_.requestRender()}}function Oe(n){return n*180/Math.PI}function fe(n){return n*Math.PI/180}class he{constructor(e,s){this.scene_=e,this.cam_=e.camera,this.map_=s,this.view_=null,this.viewListenKey_=null,this.toLonLat_=he.identityProjection,this.fromLonLat_=he.identityProjection,this.tilt_=0,this.distance_=0,this.lastCameraViewMatrix_=null,this.viewUpdateInProgress_=!1,this.map_.on("change:view",t=>{this.setView_(this.map_.getView())}),this.setView_(this.map_.getView())}static identityProjection(e,s,t){const i=t||e.length;if(s)for(let o=0;o<i;++o)s[o]=e[o];return e}setView_(e){if(this.view_&&(ee(this.viewListenKey_),this.viewListenKey_=null),this.view_=e,e){const s=Ue(e.getProjection(),"EPSG:4326"),t=Ue("EPSG:4326",e.getProjection());console.assert(s&&t),this.toLonLat_=s,this.fromLonLat_=t,this.viewListenKey_=e.on("propertychange",i=>this.handleViewEvent_(i)),this.readFromView()}else this.toLonLat_=he.identityProjection,this.fromLonLat_=he.identityProjection}handleViewEvent_(e){this.viewUpdateInProgress_||this.readFromView()}setHeading(e){this.view_&&this.view_.setRotation(e)}getHeading(){return this.view_?this.view_.getRotation()||0:void 0}setTilt(e){this.tilt_=e,this.updateCamera_()}getTilt(){return this.tilt_}setDistance(e){this.distance_=e,this.updateCamera_(),this.updateView()}getDistance(){return this.distance_}setCenter(e){this.view_&&this.view_.setCenter(e)}getCenter(){if(this.view_)return this.view_.getCenter()}setPosition(e){if(!this.toLonLat_)return;const s=this.toLonLat_(e);console.assert(s);const t=new Cesium.Cartographic(fe(s[0]),fe(s[1]),this.getAltitude());this.cam_.setView({destination:Cesium.Ellipsoid.WGS84.cartographicToCartesian(t)}),this.updateView()}getPosition(){if(!this.fromLonLat_)return;const e=Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position),s=this.fromLonLat_([Oe(e.longitude),Oe(e.latitude)]);return console.assert(s),s}setAltitude(e){const s=Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position);s.height=e,this.cam_.position=Cesium.Ellipsoid.WGS84.cartographicToCartesian(s),this.updateView()}getAltitude(){return Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position).height}updateCamera_(){if(!this.view_||!this.toLonLat_)return;const e=this.view_.getCenter();if(!e)return;const s=this.toLonLat_(e);console.assert(s);const t=new Cesium.Cartographic(fe(s[0]),fe(s[1]));if(this.scene_.globe){const r=this.scene_.globe.getHeight(t);t.height=r||0}const i=Cesium.Ellipsoid.WGS84.cartographicToCartesian(t),o={pitch:this.tilt_-Cesium.Math.PI_OVER_TWO,heading:-this.view_.getRotation(),roll:void 0};this.cam_.setView({destination:i,orientation:o}),this.cam_.moveBackward(this.distance_),this.checkCameraChange(!0)}readFromView(){if(!this.view_||!this.toLonLat_)return;const e=this.view_.getCenter();if(e==null)return;const s=this.toLonLat_(e);console.assert(s);const t=this.view_.getResolution();this.distance_=this.calcDistanceForResolution(t||0,fe(s[1])),this.updateCamera_()}updateView(){if(!this.view_||!this.fromLonLat_)return;this.viewUpdateInProgress_=!0;const e=Cesium.Ellipsoid.WGS84,s=this.scene_,t=A.pickCenterPoint(s);let i=t;if(!i){const r=s.globe,a=this.cam_.positionCartographic.clone(),l=r.getHeight(a);a.height=l||0,i=Cesium.Ellipsoid.WGS84.cartographicToCartesian(a)}this.distance_=Cesium.Cartesian3.distance(i,this.cam_.position);const o=e.cartesianToCartographic(i);if(this.view_.setCenter(this.fromLonLat_([Oe(o.longitude),Oe(o.latitude)])),this.view_.setResolution(this.calcResolutionForDistance(this.distance_,o?o.latitude:0)),t){const r=this.cam_.position,a=new Cesium.Cartesian3;e.geocentricSurfaceNormal(t,a);const l=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(r,t,l),Cesium.Cartesian3.normalize(l,l);const u=this.cam_.up,c=this.cam_.right,h=new Cesium.Cartesian3(-t.y,t.x,0),m=Cesium.Cartesian3.angleBetween(c,h),f=Cesium.Cartesian3.cross(t,u,new Cesium.Cartesian3).z;this.view_.setRotation(f<0?m:-m);const S=Math.acos(Cesium.Cartesian3.dot(a,l));this.tilt_=isNaN(S)?0:S}else this.view_.setRotation(this.cam_.heading),this.tilt_=-this.cam_.pitch+Math.PI/2;this.viewUpdateInProgress_=!1}checkCameraChange(e){const s=this.lastCameraViewMatrix_,t=this.cam_.viewMatrix;(!s||!Cesium.Matrix4.equalsEpsilon(s,t,1e-5))&&(this.lastCameraViewMatrix_=t.clone(),e!==!0&&this.updateView())}calcDistanceForResolution(e,s){return gs(e,s,this.scene_,this.view_.getProjection())}calcResolutionForDistance(e,s){return fs(e,s,this.scene_,this.view_.getProjection())}}class Vt{constructor(e,s){this.map=e,this.view=e.getView(),this.scene=s,this.olLayers=e.getLayerGroup().getLayers(),this.mapLayerGroup=e.getLayerGroup(),this.layerMap={},this.olLayerListenKeys={},this.olGroupListenKeys_={}}synchronize(){this.destroyAll(),this.addLayers_(this.mapLayerGroup)}orderLayers(){}addLayers_(e){const s=[{layer:e,parents:[]}];for(;s.length>0;){const t=s.splice(0,1)[0],i=t.layer,o=R(i).toString();this.olLayerListenKeys[o]=[],console.assert(!this.layerMap[o]);let r=null;if(i instanceof Ke)this.listenForGroupChanges_(i),i!==this.mapLayerGroup&&(r=this.createSingleLayerCounterparts(t)),r||i.getLayers().forEach(a=>{if(a){const l={layer:a,parents:i===this.mapLayerGroup?[]:[t.layer].concat(t.parents)};s.push(l)}});else if(r=this.createSingleLayerCounterparts(t),!r){const a=o,l=t,u=c=>{const h=this.createSingleLayerCounterparts(l);h&&(l.layer.un("change",u),this.addCesiumObjects_(h,a,l.layer),this.orderLayers())};this.olLayerListenKeys[o].push(de(l.layer,"change",u))}r&&this.addCesiumObjects_(r,o,i)}this.orderLayers()}addCesiumObjects_(e,s,t){this.layerMap[s]=e,this.olLayerListenKeys[s].push(de(t,"change:zIndex",()=>this.orderLayers())),e.forEach(i=>{this.addCesiumObject(i)})}removeAndDestroySingleLayer_(e){const s=R(e).toString(),t=this.layerMap[s];return t&&(t.forEach(i=>{this.removeSingleCesiumObject(i,!1),this.destroyCesiumObject(i)}),this.olLayerListenKeys[s].forEach(ee),delete this.olLayerListenKeys[s]),delete this.layerMap[s],!!t}unlistenSingleGroup_(e){if(e===this.mapLayerGroup)return;const s=R(e).toString();this.olGroupListenKeys_[s].forEach(i=>{ee(i)}),delete this.olGroupListenKeys_[s],delete this.layerMap[s]}removeLayer_(e){if(e){const s=[e];for(;s.length>0;){const t=s.splice(0,1)[0],i=this.removeAndDestroySingleLayer_(t);t instanceof Ke&&(this.unlistenSingleGroup_(t),i||t.getLayers().forEach(o=>{s.push(o)}))}}}listenForGroupChanges_(e){const s=R(e).toString();console.assert(this.olGroupListenKeys_[s]===void 0);const t=[];this.olGroupListenKeys_[s]=t;let i=[];const o=(function(){const r=e.getLayers();r&&(i=[r.on("add",a=>{this.addLayers_(a.element)}),r.on("remove",a=>{this.removeLayer_(a.element)})],t.push(...i))}).bind(this);o(),t.push(e.on("change:layers",r=>{i.forEach(a=>{const l=t.indexOf(a);l>=0&&t.splice(l,1),ee(a)}),o()}))}destroyAll(){this.removeAllCesiumObjects(!0);let e;for(e in this.olGroupListenKeys_)this.olGroupListenKeys_[e].forEach(ee);for(e in this.olLayerListenKeys)this.olLayerListenKeys[e].forEach(ee);this.olGroupListenKeys_={},this.olLayerListenKeys={},this.layerMap={}}addCesiumObject(e){}destroyCesiumObject(e){}removeSingleCesiumObject(e,s){}removeAllCesiumObjects(e){}createSingleLayerCounterparts(e){}}class Ta extends Vt{constructor(e,s){super(e,s),this.cesiumLayers_=s.imageryLayers,this.ourLayers_=new Cesium.ImageryLayerCollection}addCesiumObject(e){this.cesiumLayers_.add(e),this.ourLayers_.add(e)}destroyCesiumObject(e){e.destroy()}removeSingleCesiumObject(e,s){this.cesiumLayers_.remove(e,s),this.ourLayers_.remove(e,!1)}removeAllCesiumObjects(e){for(let s=0;s<this.ourLayers_.length;++s)this.cesiumLayers_.remove(this.ourLayers_.get(s),e);this.ourLayers_.removeAll(!1)}convertLayerToCesiumImageries(e,s){const t=A.tileLayerToImageryLayer(this.map,e,s);return t?[t]:null}createSingleLayerCounterparts(e){const s=e.layer,t=R(s).toString(),i=this.view.getProjection();console.assert(i);const o=this.convertLayerToCesiumImageries(s,i);if(o){const r=[];if([e.layer].concat(e.parents).forEach(a=>{r.push(a.on(["change:opacity","change:visible"],()=>{console.assert(o);for(let l=0;l<o.length;++l)A.updateCesiumLayerProperties(e,o[l])}))}),s.getStyleFunction){let a=s.getStyleFunction();r.push(s.on("change",()=>{const l=s.getStyleFunction();if(a!==l){a=l;for(let u=0;u<o.length;++u){const c=o[u];c._imageryCache&&c.imageryProvider.cache_&&(c._imageryCache={},c.imageryProvider.cache_={},c.imageryProvider.styleFunction_=l)}this.scene.requestRender()}}))}for(let a=0;a<o.length;++a)A.updateCesiumLayerProperties(e,o[a]);r.push(s.on("change:extent",a=>{for(let l=0;l<o.length;++l)this.cesiumLayers_.remove(o[l],!0),this.ourLayers_.remove(o[l],!1);delete this.layerMap[R(s)],this.synchronize()})),r.push(s.on("change",a=>{for(let l=0;l<o.length;++l){const u=this.cesiumLayers_.indexOf(o[l]);u>=0&&(this.cesiumLayers_.remove(o[l],!1),this.cesiumLayers_.add(o[l],u))}})),this.olLayerListenKeys[t].push(...r)}return Array.isArray(o)?o:null}orderLayers(){const e=[],s={},t=[this.mapLayerGroup];for(;t.length>0;){const i=t.splice(0,1)[0];if(e.push(i),s[R(i)]=i.getZIndex()||0,i instanceof Ke){const o=i.getLayers();o&&t.unshift(...o.getArray())}}_s(e,(i,o)=>s[R(i)]-s[R(o)]),e.forEach(i=>{const o=R(i).toString(),r=this.layerMap[o];r&&r.forEach(a=>{this.raiseToTop(a)})})}raiseToTop(e){this.cesiumLayers_.raiseToTop(e)}}class Ea{constructor(e,s){const t=new Cesium.BillboardCollection({scene:s}),i=new Cesium.PrimitiveCollection;this.olListenKeys=[],this.rootCollection_=new Cesium.PrimitiveCollection,this.context={projection:e,billboards:t,featureToCesiumMap:{},primitives:i},this.rootCollection_.add(t),this.rootCollection_.add(i)}destroy(){this.olListenKeys.forEach(ee),this.olListenKeys.length=0}getRootPrimitive(){return this.rootCollection_}}class Ma{constructor(e){this.scene=e,this.boundOnRemoveOrClearFeatureListener_=this.onRemoveOrClearFeature_.bind(this),this.defaultBillboardEyeOffset_=new Cesium.Cartesian3(0,0,10)}onRemoveOrClearFeature_(e){const s=e.target;console.assert(s instanceof me);const t=ae.obj(s).olcs_cancellers;if(t){const i=e.feature;if(i){const o=R(i),r=t[o];r&&(r(),delete t[o])}else{for(const o in t)t.hasOwnProperty(o)&&t[o]();ae.obj(s).olcs_cancellers={}}}}setReferenceForPicking(e,s,t){t.olLayer=e,t.olFeature=s}createColoredPrimitive(e,s,t,i,o,r){const a=function(m,p){const f=new Cesium.GeometryInstance({geometry:m});return p&&!(p instanceof Cesium.ImageMaterialProperty)&&(f.attributes={color:Cesium.ColorGeometryInstanceAttribute.fromColor(p)}),f},l={flat:!0,renderState:{depthTest:{enabled:!0}}};r!==void 0&&(l.renderState||(l.renderState={}),l.renderState.lineWidth=r);const u=a(i,o),c=this.getHeightReference(e,s,t);let h;if(c===Cesium.HeightReference.CLAMP_TO_GROUND){const m=u.geometry.constructor;if(m&&!m.createShadowVolume)return null;h=new Cesium.GroundPrimitive({geometryInstances:u})}else h=new Cesium.Primitive({geometryInstances:u});if(o instanceof Cesium.ImageMaterialProperty){const m=o.image.getValue().toDataURL();h.appearance=new Cesium.MaterialAppearance({flat:!0,renderState:{depthTest:{enabled:!0}},material:new Cesium.Material({fabric:{type:"Image",uniforms:{image:m}}})})}else h.appearance=new Cesium.PerInstanceColorAppearance(l);return this.setReferenceForPicking(e,s,h),h}extractColorFromOlStyle(e,s){const t=e.getFill()?e.getFill().getColor():null,i=e.getStroke()?e.getStroke().getColor():null;let o="black";return i&&s?o=i:t&&(o=t),A.convertColorToCesium(o)}extractLineWidthFromOlStyle(e){const s=e.getStroke()?e.getStroke().getWidth():void 0;return s!==void 0?s:1}wrapFillAndOutlineGeometries(e,s,t,i,o,r){const a=this.extractColorFromOlStyle(r,!1),l=this.extractColorFromOlStyle(r,!0),u=new Cesium.PrimitiveCollection;if(r.getFill()){const c=this.createColoredPrimitive(e,s,t,i,a);console.assert(!!c),u.add(c)}if(r.getStroke()&&o){const c=this.extractLineWidthFromOlStyle(r),h=this.createColoredPrimitive(e,s,t,o,l,c);h&&u.add(h)}return u}addTextStyle(e,s,t,i,o){let r;if(o instanceof Cesium.PrimitiveCollection?r=o:(r=new Cesium.PrimitiveCollection,r.add(o)),!i.getText())return r;const a=i.getText(),l=this.olGeometry4326TextPartToCesium(e,s,t,a);return l&&r.add(l),r}csAddBillboard(e,s,t,i,o,r){s.eyeOffset||(s.eyeOffset=this.defaultBillboardEyeOffset_);const a=e.add(s);return this.setReferenceForPicking(t,i,a),a}olCircleGeometryToCesium(e,s,t,i,o){t=A.olGeometryCloneTo4326(t,i),console.assert(t.getType()=="Circle");let r=t.getCenter();const a=r.length==3?r[2]:0;let l=r.slice();l[0]+=t.getRadius(),r=A.ol4326CoordinateToCesiumCartesian(r),l=A.ol4326CoordinateToCesiumCartesian(l);const u=Cesium.Cartesian3.distance(r,l),c=new Cesium.CircleGeometry({center:r,radius:u,height:a});let h,m;if(this.getHeightReference(e,s,t)===Cesium.HeightReference.CLAMP_TO_GROUND){const f=this.extractLineWidthFromOlStyle(o);if(f){const S=ys(t.getCenter(),u),x=A.ol4326CoordinateArrayToCsCartesians(S.getLinearRing(0).getCoordinates());if(We(this.scene))h=new Cesium.GroundPolylinePrimitive({geometryInstances:new Cesium.GeometryInstance({geometry:new Cesium.GroundPolylineGeometry({positions:x,width:f})}),appearance:new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(s,o,!0)}),classificationType:Cesium.ClassificationType.TERRAIN}),h.readyPromise.then(()=>{this.setReferenceForPicking(e,s,h._primitive)});else{const I=this.extractColorFromOlStyle(o,!0);h=this.createStackedGroundCorridors(e,s,f,I,x)}}}else m=new Cesium.CircleOutlineGeometry({center:r,radius:u,extrudedHeight:a,height:a});const p=this.wrapFillAndOutlineGeometries(e,s,t,c,m,o);return h&&p.add(h),this.addTextStyle(e,s,t,o,p)}createStackedGroundCorridors(e,s,t,i,o){Array.isArray(o[0])||(o=[o]),t=Math.max(3,t);const r=[];let a=0;for(const l of[1e3,4e3,16e3,64e3,254e3,1e6,1e7]){t*=2.14;const u={width:t,vertexFormat:Cesium.VertexFormat.POSITION_ONLY};for(const c of o)u.positions=c,r.push(new Cesium.GeometryInstance({geometry:new Cesium.CorridorGeometry(u),attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(i),distanceDisplayCondition:new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(a,l-1)}}));a=l}return new Cesium.GroundPrimitive({geometryInstances:r})}olLineStringGeometryToCesium(e,s,t,i,o){t=A.olGeometryCloneTo4326(t,i),console.assert(t.getType()=="LineString");const r=A.ol4326CoordinateArrayToCsCartesians(t.getCoordinates()),a=this.extractLineWidthFromOlStyle(o);let l;const u=this.getHeightReference(e,s,t);if(u===Cesium.HeightReference.CLAMP_TO_GROUND&&!We(this.scene)){const c=this.extractColorFromOlStyle(o,!0);l=this.createStackedGroundCorridors(e,s,a,c,r)}else{const c=new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(s,o,!0)}),h={positions:r,width:a},m={appearance:c};if(u===Cesium.HeightReference.CLAMP_TO_GROUND){const p=new Cesium.GroundPolylineGeometry(h);m.geometryInstances=new Cesium.GeometryInstance({geometry:p}),l=new Cesium.GroundPolylinePrimitive(m),l.readyPromise.then(()=>{this.setReferenceForPicking(e,s,l._primitive)})}else{h.vertexFormat=c.vertexFormat;const p=new Cesium.PolylineGeometry(h);m.geometryInstances=new Cesium.GeometryInstance({geometry:p}),l=new Cesium.Primitive(m)}}return this.setReferenceForPicking(e,s,l),this.addTextStyle(e,s,t,o,l)}olPolygonGeometryToCesium(e,s,t,i,o){t=A.olGeometryCloneTo4326(t,i),console.assert(t.getType()=="Polygon");const r=this.getHeightReference(e,s,t);let a,l,u;if(t.getCoordinates()[0].length==5&&s.getGeometry().get("olcs.polygon_kind")==="rectangle"){const h=t.getCoordinates()[0],m=Cs(h),p=Cesium.Rectangle.fromDegrees(m[0],m[1],m[2],m[3]);let f=0;if(h[0].length==3)for(let S=0;S<h.length;S++)f=Math.max(f,h[S][2]);a=new Cesium.RectangleGeometry({ellipsoid:Cesium.Ellipsoid.WGS84,rectangle:p,height:f}),l=new Cesium.RectangleOutlineGeometry({ellipsoid:Cesium.Ellipsoid.WGS84,rectangle:p,height:f})}else{const h=t.getLinearRings(),m={},p=m;console.assert(h.length>0);for(let f=0;f<h.length;++f){const S=h[f].getCoordinates(),x=A.ol4326CoordinateArrayToCsCartesians(S);console.assert(x&&x.length>0),f==0?m.positions=x:(m.holes||(m.holes=[]),m.holes.push({positions:x}))}if(a=new Cesium.PolygonGeometry({polygonHierarchy:p,perPositionHeight:!0}),r===Cesium.HeightReference.CLAMP_TO_GROUND){const f=this.extractLineWidthFromOlStyle(o);if(f>0){const S=[m.positions];if(m.holes)for(let x=0;x<m.holes.length;++x)S.push(m.holes[x].positions);if(We(this.scene)){const x=new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(s,o,!0)}),I=[];for(const T of S){const v=new Cesium.GroundPolylineGeometry({positions:T,width:f});I.push(new Cesium.GeometryInstance({geometry:v}))}const _={appearance:x,geometryInstances:I};u=new Cesium.GroundPolylinePrimitive(_),u.readyPromise.then(()=>{this.setReferenceForPicking(e,s,u._primitive)})}else{const x=this.extractColorFromOlStyle(o,!0);u=this.createStackedGroundCorridors(e,s,f,x,S)}}}else l=new Cesium.PolygonOutlineGeometry({polygonHierarchy:m,perPositionHeight:!0})}const c=this.wrapFillAndOutlineGeometries(e,s,t,a,l,o);return u&&c.add(u),this.addTextStyle(e,s,t,o,c)}getHeightReference(e,s,t){let i=t.get("altitudeMode");i===void 0&&(i=s.get("altitudeMode")),i===void 0&&(i=e.get("altitudeMode"));let o=Cesium.HeightReference.NONE;return i==="clampToGround"?o=Cesium.HeightReference.CLAMP_TO_GROUND:i==="relativeToGround"&&(o=Cesium.HeightReference.RELATIVE_TO_GROUND),o}createBillboardFromImage(e,s,t,i,o,r,a,l){r instanceof ve&&r.load();const u=r.getImage(1),c=function(m){return m.src!=""&&m.naturalHeight!=0&&m.naturalWidth!=0&&m.complete},h=(function(){if(!u||!(u instanceof HTMLCanvasElement||u instanceof Image||u instanceof HTMLImageElement))return;const m=t.getCoordinates(),p=A.ol4326CoordinateToCesiumCartesian(m);let f;const S=r.getOpacity();S!==void 0&&(f=new Cesium.Color(1,1,1,S));const x=r.getScale(),I=this.getHeightReference(e,s,t),_={image:u,color:f,scale:x,heightReference:I,position:p};if(Object.assign(_,s.get("cesiumOptions")),r instanceof ve){const v=r.getAnchor();v&&(_.pixelOffset=new Cesium.Cartesian2((u.width/2-v[0])*x,(u.height/2-v[1])*x))}const T=this.csAddBillboard(a,_,e,s,t,o);l&&l(T)}).bind(this);if(u instanceof Image&&!c(u)){let m=!1;const p=e.getSource(),f=function(){m=!0};p.on(["removefeature","clear"],this.boundOnRemoveOrClearFeatureListener_);let S=ae.obj(p).olcs_cancellers;S||(S=ae.obj(p).olcs_cancellers={});const x=R(s);S[x]&&S[x](),S[x]=f;const I=function(){u.removeEventListener("load",I),!a.isDestroyed()&&!m&&h()};u.addEventListener("load",I)}else h()}olPointGeometryToCesium(e,s,t,i,o,r,a){console.assert(t.getType()=="Point"),t=A.olGeometryCloneTo4326(t,i);let l=null;const u=o.getImage();if(u){const c=t.get("olcs_model")||s.get("olcs_model");if(c){const h=c(),m=Object.assign({},{scene:this.scene},h.cesiumOptions),p=Cesium.Model.fromGltf(m);l=new Cesium.PrimitiveCollection,l.add(p),h.debugModelMatrix&&l.add(new Cesium.DebugModelMatrixPrimitive({modelMatrix:h.debugModelMatrix}))}else this.createBillboardFromImage(e,s,t,i,o,u,r,a)}return o.getText()?this.addTextStyle(e,s,t,o,l||new Cesium.Primitive):l}olMultiGeometryToCesium(e,s,t,i,o,r,a){const l=function(c,h){const m=new Cesium.PrimitiveCollection;return c.forEach(p=>{m.add(h(e,s,p,i,o))}),m};let u;switch(t.getType()){case"MultiPoint":if(t=t,u=t.getPoints(),o.getText()){const c=new Cesium.PrimitiveCollection;return u.forEach(h=>{console.assert(h);const m=this.olPointGeometryToCesium(e,s,h,i,o,r,a);m&&c.add(m)}),c}else return u.forEach(c=>{console.assert(c),this.olPointGeometryToCesium(e,s,c,i,o,r,a)}),null;case"MultiLineString":return t=t,u=t.getLineStrings(),l(u,this.olLineStringGeometryToCesium.bind(this));case"MultiPolygon":return t=t,u=t.getPolygons(),l(u,this.olPolygonGeometryToCesium.bind(this));default:console.assert(!1,`Unhandled multi geometry type${t.getType()}`)}}olGeometry4326TextPartToCesium(e,s,t,i){const o=i.getText();if(!o)return null;const r=new Cesium.LabelCollection({scene:this.scene}),a=gt(t.getExtent());if(t instanceof vs){const f=t.getFirstCoordinate();a[2]=f.length==3?f[2]:0}const l={};l.position=A.ol4326CoordinateToCesiumCartesian(a),l.text=o,l.heightReference=this.getHeightReference(e,s,t);const u=i.getOffsetX(),c=i.getOffsetY();if(u!=0&&c!=0){const f=new Cesium.Cartesian2(u,c);l.pixelOffset=f}l.font=i.getFont()||"10px sans-serif";let h;i.getFill()&&(l.fillColor=this.extractColorFromOlStyle(i,!1),h=Cesium.LabelStyle.FILL),i.getStroke()&&(l.outlineWidth=this.extractLineWidthFromOlStyle(i),l.outlineColor=this.extractColorFromOlStyle(i,!0),h=Cesium.LabelStyle.OUTLINE),i.getFill()&&i.getStroke()&&(h=Cesium.LabelStyle.FILL_AND_OUTLINE),l.style=h;let m;switch(i.getTextAlign()){case"left":m=Cesium.HorizontalOrigin.LEFT;break;case"right":m=Cesium.HorizontalOrigin.RIGHT;break;case"center":default:m=Cesium.HorizontalOrigin.CENTER}if(l.horizontalOrigin=m,i.getTextBaseline()){let f;switch(i.getTextBaseline()){case"top":f=Cesium.VerticalOrigin.TOP;break;case"middle":f=Cesium.VerticalOrigin.CENTER;break;case"bottom":f=Cesium.VerticalOrigin.BOTTOM;break;case"alphabetic":f=Cesium.VerticalOrigin.TOP;break;case"hanging":f=Cesium.VerticalOrigin.BOTTOM;break;default:console.assert(!1,`unhandled baseline ${i.getTextBaseline()}`)}l.verticalOrigin=f}const p=r.add(l);return this.setReferenceForPicking(e,s,p),r}olStyleToCesium(e,s,t){const i=s.getFill(),o=s.getStroke();if(t&&!o||!t&&!i)return null;let r=t?o.getColor():i.getColor();return r=A.convertColorToCesium(r),t&&o.getLineDash()?Cesium.Material.fromType("Stripe",{horizontal:!1,repeat:500,evenColor:r,oddColor:new Cesium.Color(0,0,0,0)}):Cesium.Material.fromType("Color",{color:r})}computePlainStyle(e,s,t,i){const o=s.getStyleFunction();let r=null;return o&&(r=o(s,i)),!r&&t&&(r=t(s,i)),r?Array.isArray(r)?r:[r]:null}getGeometryFromFeature(e,s,t){if(t)return t;const i=e.get("olcs.3d_geometry");if(i&&i instanceof nt)return i;if(s){const o=s.getGeometryFunction()(e);if(o instanceof nt)return o}return e.getGeometry()}olFeatureToCesium(e,s,t,i,o){let r=this.getGeometryFromFeature(s,t,o);if(!r)return null;const a=i.projection,l=function(u){const c=i.featureToCesiumMap[R(s)];c instanceof Array?c.push(u):i.featureToCesiumMap[R(s)]=[u]};switch(r.getType()){case"GeometryCollection":const u=new Cesium.PrimitiveCollection;return r.getGeometries().forEach(f=>{if(f){const S=this.olFeatureToCesium(e,s,t,i,f);S&&u.add(S)}}),u;case"Point":r=r;const h=i.billboards,m=this.olPointGeometryToCesium(e,s,r,a,t,h,l);return m||null;case"Circle":return r=r,this.olCircleGeometryToCesium(e,s,r,a,t);case"LineString":return r=r,this.olLineStringGeometryToCesium(e,s,r,a,t);case"Polygon":return r=r,this.olPolygonGeometryToCesium(e,s,r,a,t);case"MultiPoint":case"MultiLineString":case"MultiPolygon":const p=this.olMultiGeometryToCesium(e,s,r,a,t,i.billboards,l);return p||null;case"LinearRing":throw new Error("LinearRing should only be part of polygon.");default:throw new Error(`Ol geom type not handled : ${r.getType()}`)}}olVectorLayerToCesium(e,s,t){const i=s.getProjection(),o=s.getResolution();if(o===void 0||!i)throw console.assert(!1,"View not ready"),new Error("View not ready");let r=e.getSource();r instanceof xt&&(r=r.getSource()),console.assert(r instanceof me);const a=r.getFeatures(),l=new Ea(i,this.scene),u=l.context;for(let c=0;c<a.length;++c){const h=a[c];if(!h)continue;const m=e.getStyleFunction(),p=this.computePlainStyle(e,h,m,o);if(!p||!p.length)continue;let f=null;for(let S=0;S<p.length;S++){const x=this.olFeatureToCesium(e,h,p[S],u);if(x){if(!f)f=x;else if(x){let I=0,_;for(;_=x.get(I);)f.add(_),I++}}}f&&(t[R(h)]=f,l.getRootPrimitive().add(f))}return l}convert(e,s,t,i){const o=s.getProjection(),r=s.getResolution();if(r==null||!o)return null;const a=e.getStyleFunction(),l=this.computePlainStyle(e,t,a,r);if(!l||!l.length)return null;i.projection=o;let u=null;for(let c=0;c<l.length;c++){const h=this.olFeatureToCesium(e,t,l[c],i);if(!u)u=h;else if(h){let m=0,p;for(;p=h.get(m);)u.add(p),m++}}return u}}class Pa extends Vt{constructor(e,s,t){super(e,s),this.converter=t||new Ma(s),this.csAllPrimitives_=new Cesium.PrimitiveCollection,s.primitives.add(this.csAllPrimitives_),this.csAllPrimitives_.destroyPrimitives=!1}addCesiumObject(e){console.assert(e),e.getRootPrimitive().counterpart=e,this.csAllPrimitives_.add(e.getRootPrimitive())}destroyCesiumObject(e){e.getRootPrimitive().destroy()}removeSingleCesiumObject(e,s){e.destroy(),this.csAllPrimitives_.destroyPrimitives=s,this.csAllPrimitives_.remove(e.getRootPrimitive()),this.csAllPrimitives_.destroyPrimitives=!1}removeAllCesiumObjects(e){if(this.csAllPrimitives_.destroyPrimitives=e,e)for(let s=0;s<this.csAllPrimitives_.length;++s)this.csAllPrimitives_.get(s).counterpart.destroy();this.csAllPrimitives_.removeAll(),this.csAllPrimitives_.destroyPrimitives=!1}updateLayerVisibility(e,s){let t=!0;[e.layer].concat(e.parents).forEach(i=>{const o=i.getVisible();o!==void 0?t&=o:t=!1}),s.show=t}createSingleLayerCounterparts(e){const s=e.layer;if(!(s instanceof Ce)||s instanceof bs)return null;console.assert(s instanceof ws);let t=s.getSource();if(t instanceof xt&&(t=t.getSource()),!t)return null;console.assert(t instanceof me),console.assert(this.view);const i=this.view,o={},r=this.converter.olVectorLayerToCesium(s,i,o),a=r.getRootPrimitive(),l=r.olListenKeys;[e.layer].concat(e.parents).forEach(h=>{l.push(de(h,"change:visible",()=>{this.updateLayerVisibility(e,a)}))}),this.updateLayerVisibility(e,a);const u=(function(h){console.assert(s instanceof Ce||s instanceof Ls);const m=r.context,p=this.converter.convert(s,i,h,m);p&&(o[R(h)]=p,a.add(p))}).bind(this),c=(function(h){const m=R(h),p=r.context,f=p.featureToCesiumMap[m];f&&(delete p.featureToCesiumMap[m],f.forEach(x=>{x instanceof Cesium.Billboard&&p.billboards.remove(x)}));const S=o[m];delete o[m],S&&a.remove(S)}).bind(this);return l.push(de(t,"addfeature",h=>{console.assert(h.feature),u(h.feature)})),l.push(de(t,"removefeature",h=>{console.assert(h.feature),c(h.feature)})),l.push(de(t,"changefeature",h=>{const m=h.feature;console.assert(m),c(m),u(m)})),r?[r]:null}}class Ia extends St{constructor(e){const s=e.parent;super(s.getOptions()),this.scenePostRenderListenerRemover_=null,this.scene_=e.scene,this.synchronizer_=e.synchronizer,this.parent_=s,this.positionWGS84_=void 0,this.observer_=new MutationObserver(this.handleElementChanged.bind(this)),this.attributeObserver_=[],this.listenerKeys_=[];const t=i=>this.setPropertyFromEvent_(i);this.listenerKeys_.push(this.parent_.on("change:position",t)),this.listenerKeys_.push(this.parent_.on("change:element",t)),this.listenerKeys_.push(this.parent_.on("change:offset",t)),this.listenerKeys_.push(this.parent_.on("change:position",t)),this.listenerKeys_.push(this.parent_.on("change:positioning",t)),this.setProperties(this.parent_.getProperties()),this.handleMapChanged(),this.handleElementChanged()}observeTarget_(e){if(this.observer_){this.observer_.disconnect(),this.observer_.observe(e,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),this.attributeObserver_.forEach(s=>{s.disconnect()}),this.attributeObserver_.length=0;for(let s=0;s<e.childNodes.length;s++){const t=e.childNodes[s];if(t.nodeType===1){const i=new MutationObserver(this.handleElementChanged.bind(this));i.observe(t,{attributes:!0,subtree:!0}),this.attributeObserver_.push(i)}}}}setPropertyFromEvent_(e){e.target&&e.key&&this.set(e.key,e.target.get(e.key))}getScene(){return this.scene_}handleMapChanged(){this.scenePostRenderListenerRemover_&&(this.scenePostRenderListenerRemover_(),Ss(this.element)),this.scenePostRenderListenerRemover_=null;const e=this.getScene();if(e){this.scenePostRenderListenerRemover_=e.postRender.addEventListener(this.updatePixelPosition.bind(this)),this.updatePixelPosition();const s=this.stopEvent?this.synchronizer_.getOverlayContainerStopEvent():this.synchronizer_.getOverlayContainer();this.insertFirst?s.insertBefore(this.element,s.childNodes[0]||null):s.appendChild(this.element)}}handlePositionChanged(){const e=this.getPosition();if(e){const s=this.parent_.getMap().getView().getProjection();this.positionWGS84_=xs(e,s,"EPSG:4326")}else this.positionWGS84_=void 0;this.updatePixelPosition()}handleElementChanged(){function e(t,i){const o=t.cloneNode();t.nodeName==="CANVAS"&&o.getContext("2d").drawImage(t,0,0),i&&i.appendChild(o),t.nodeType!=Node.TEXT_NODE&&o.addEventListener("click",a=>{t.dispatchEvent(new MouseEvent("click",a)),a.stopPropagation()});const r=t.childNodes;for(let a=0;a<r.length;a++)r[a]&&e(r[a],o);return o}Ts(this.element);const s=this.getElement();if(s&&s.parentNode&&s.parentNode.childNodes)for(const t of s.parentNode.childNodes){const i=e(t,null);this.element.appendChild(i)}s.parentNode&&this.observeTarget_(s.parentNode)}updatePixelPosition(){const e=this.positionWGS84_;if(!this.scene_||!e){this.setVisible(!1);return}let s=0;if(e.length===2){const h=this.scene_.globe.getHeight(Cesium.Cartographic.fromDegrees(e[0],e[1]));h&&this.scene_.globe.tilesLoaded&&(e[2]=h),h&&(s=h)}else s=e[2];const t=Cesium.Cartesian3.fromDegrees(e[0],e[1],s),i=this.scene_.camera,o=new Cesium.BoundingSphere(new Cesium.Cartesian3,6356752);if(!new Cesium.Occluder(o,i.position).isPointVisible(t)){this.setVisible(!1);return}if(i.frustum.computeCullingVolume(i.position,i.direction,i.up).computeVisibility(new Cesium.BoundingSphere(t))!==1){this.setVisible(!1);return}this.setVisible(!0);const l=this.scene_.cartesianToCanvasCoordinates(t),u=[l.x,l.y],c=[this.scene_.canvas.width,this.scene_.canvas.height];this.updateRenderedPosition(u,c)}destroy(){this.scenePostRenderListenerRemover_&&this.scenePostRenderListenerRemover_(),this.observer_&&this.observer_.disconnect(),ee(this.listenerKeys_),this.listenerKeys_.splice(0),this.element.removeNode?this.element.removeNode(!0):this.element.remove(),this.element=null}}class ka{constructor(e,s){this.map=e,this.overlays_=this.map.getOverlays(),this.scene=s,this.overlayContainerStopEvent_=document.createElement("DIV"),this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",["click","dblclick","mousedown","touchstart","MSPointerDown","pointerdown","mousewheel","wheel"].forEach(i=>{this.overlayContainerStopEvent_.addEventListener(i,o=>o.stopPropagation())}),this.scene.canvas.parentElement.appendChild(this.overlayContainerStopEvent_),this.overlayContainer_=document.createElement("DIV"),this.overlayContainer_.className="ol-overlaycontainer",this.scene.canvas.parentElement.appendChild(this.overlayContainer_),this.overlayMap_={}}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOverlayContainer(){return this.overlayContainer_}synchronize(){this.destroyAll(),this.addOverlays(),this.overlays_.on("add",this.addOverlayFromEvent_.bind(this)),this.overlays_.on("remove",this.removeOverlayFromEvent_.bind(this))}addOverlayFromEvent_(e){const s=e.element;this.addOverlay(s)}addOverlays(){this.overlays_.forEach(e=>{this.addOverlay(e)})}addOverlay(e){if(!e)return;const s=new Ia({scene:this.scene,synchronizer:this,parent:e}),t=R(e).toString();this.overlayMap_[t]=s}removeOverlayFromEvent_(e){const s=e.element;this.removeOverlay(s)}removeOverlay(e){const s=R(e).toString(),t=this.overlayMap_[s];t&&(t.destroy(),delete this.overlayMap_[s])}destroyAll(){Object.keys(this.overlayMap_).forEach(e=>{this.overlayMap_[e].destroy(),delete this.overlayMap_[e]})}}class _e{constructor(e){this.autoRenderLoop_=null,this.map_=e.map,this.time_=e.time||function(){return Cesium.JulianDate.now()},this.to4326Transform_=Ue(this.map_.getView().getProjection(),"EPSG:4326"),this.resolutionScale_=1,this.canvasClientWidth_=0,this.canvasClientHeight_=0,this.resolutionScaleChanged_=!0;const s="position:absolute;top:0;left:0;width:100%;height:100%;";this.container_=document.createElement("DIV");const t=document.createAttribute("style");t.value=`${s}visibility:hidden;`,this.container_.setAttributeNode(t);let i=e.target||this.map_.getViewport();if(typeof i=="string"&&(i=document.getElementById(i)),i.appendChild(this.container_),this.isOverMap_=!e.target,this.isOverMap_&&e.stopOpenLayersEventsPropagation){const h=["click","dblclick","mousedown","touchstart","MSPointerDown","pointerdown","mousewheel","wheel"];for(let m=0,p=h.length;m<p;++m)this.container_.addEventListener(h[m],f=>f.stopPropagation())}this.canvas_=document.createElement("CANVAS");const o=document.createAttribute("style");o.value=s,this.canvas_.setAttributeNode(o),ae.supportsImageRenderingPixelated()&&(this.canvas_.style.imageRendering=ae.imageRenderingValue()),this.canvas_.oncontextmenu=function(){return!1},this.canvas_.onselectstart=function(){return!1},this.container_.appendChild(this.canvas_),this.enabled_=!1,this.pausedInteractions_=[],this.hiddenRootGroup_=null;const r=e.sceneOptions!==void 0?e.sceneOptions:{};r.canvas=this.canvas_,r.scene3DOnly=!0,this.scene_=new Cesium.Scene(r);const a=this.scene_.screenSpaceCameraController;a.tiltEventTypes.push({eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.SHIFT}),a.tiltEventTypes.push({eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.ALT}),a.enableLook=!1,this.scene_.camera.constrainedAxis=Cesium.Cartesian3.UNIT_Z,this.camera_=new he(this.scene_,this.map_),this.globe_=new Cesium.Globe(Cesium.Ellipsoid.WGS84),this.globe_.baseColor=Cesium.Color.WHITE,this.scene_.globe=this.globe_,this.scene_.skyAtmosphere=new Cesium.SkyAtmosphere;const l=new Cesium.SingleTileImageryProvider({url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",rectangle:Cesium.Rectangle.fromDegrees(0,0,1,1)});this.globe_.imageryLayers.addImageryProvider(l,0),this.dataSourceCollection_=new Cesium.DataSourceCollection,this.dataSourceDisplay_=new Cesium.DataSourceDisplay({scene:this.scene_,dataSourceCollection:this.dataSourceCollection_});const u=e.createSynchronizers?e.createSynchronizers(this.map_,this.scene_,this.dataSourceCollection_):[new Ta(this.map_,this.scene_),new Pa(this.map_,this.scene_),new ka(this.map_,this.scene_)];this.handleResize_();for(let h=u.length-1;h>=0;--h)u[h].synchronize();this.lastFrameTime_=0,this.renderId_=void 0,this.targetFrameRate_=Number.POSITIVE_INFINITY,this.blockCesiumRendering_=!1,this.warmingUp_=!1,this.trackedFeature_=null,this.trackedEntity_=null,this.entityView_=null,this.needTrackedEntityUpdate_=!1,this.boundingSphereScratch_=new Cesium.BoundingSphere,new Cesium.EventHelper().add(this.scene_.postRender,_e.prototype.updateTrackedEntity_,this),Cesium.Camera.enableSuspendTerrainAdjustment=!1}render_(){this.renderId_!==void 0&&(cancelAnimationFrame(this.renderId_),this.renderId_=void 0),(this.enabled_||this.warmingUp_)&&!this.blockCesiumRendering_&&(this.renderId_=requestAnimationFrame(this.onAnimationFrame_.bind(this)))}onAnimationFrame_(e){this.renderId_=void 0;const s=1e3/this.targetFrameRate_;if(e-this.lastFrameTime_<s){this.render_();return}this.lastFrameTime_=e;const i=this.time_();if(this.scene_.initializeFrame(),this.handleResize_(),this.dataSourceDisplay_.update(i),this.entityView_){const o=this.trackedEntity_;this.dataSourceDisplay_.getBoundingSphere(o,!1,this.boundingSphereScratch_)===Cesium.BoundingSphereState.DONE&&(this.boundingSphereScratch_.radius=1,this.entityView_.update(i,this.boundingSphereScratch_))}this.scene_.render(i),this.camera_.checkCameraChange(),this.render_()}updateTrackedEntity_(){if(!this.needTrackedEntityUpdate_)return;const e=this.trackedEntity_,s=this.scene_,t=this.dataSourceDisplay_.getBoundingSphere(e,!1,this.boundingSphereScratch_);if(t===Cesium.BoundingSphereState.PENDING)return;s.screenSpaceCameraController.enableTilt=!1;const i=t!==Cesium.BoundingSphereState.FAILED?this.boundingSphereScratch_:void 0;i&&(i.radius=1),this.entityView_=new Cesium.EntityView(e,s,s.mapProjection.ellipsoid),this.entityView_.update(this.time_(),i),this.needTrackedEntityUpdate_=!1}handleResize_(){let e=this.canvas_.clientWidth,s=this.canvas_.clientHeight;if(e===0|s===0||e===this.canvasClientWidth_&&s===this.canvasClientHeight_&&!this.resolutionScaleChanged_)return;let t=this.resolutionScale_;ae.supportsImageRenderingPixelated()||(t*=window.devicePixelRatio||1),this.resolutionScaleChanged_=!1,this.canvasClientWidth_=e,this.canvasClientHeight_=s,e*=t,s*=t,this.canvas_.width=e,this.canvas_.height=s,this.scene_.camera.frustum.aspectRatio=e/s}getCamera(){return this.camera_}getOlMap(){return this.map_}getOlView(){const e=this.map_.getView();return console.assert(e),e}getCesiumScene(){return this.scene_}getDataSources(){return this.dataSourceCollection_}getDataSourceDisplay(){return this.dataSourceDisplay_}getEnabled(){return this.enabled_}setEnabled(e){if(this.enabled_===e)return;this.enabled_=e,this.container_.style.visibility=this.enabled_?"visible":"hidden";let s;if(this.enabled_){if(this.throwOnUnitializedMap_(),this.isOverMap_){s=this.map_.getInteractions(),s.forEach((i,o,r)=>{this.pausedInteractions_.push(i)}),s.clear(),this.map_.addInteraction=i=>this.pausedInteractions_.push(i),this.map_.removeInteraction=i=>this.pausedInteractions_=this.pausedInteractions_.filter(o=>o!==i);const t=this.map_.getLayerGroup();t.getVisible()&&(this.hiddenRootGroup_=t,this.hiddenRootGroup_.setVisible(!1)),this.map_.getOverlayContainer().classList.add("olcs-hideoverlay")}this.camera_.readFromView(),this.render_()}else this.isOverMap_&&(s=this.map_.getInteractions(),this.pausedInteractions_.forEach(t=>{s.push(t)}),this.pausedInteractions_.length=0,this.map_.addInteraction=t=>this.map_.getInteractions().push(t),this.map_.removeInteraction=t=>this.map_.getInteractions().remove(t),this.map_.getOverlayContainer().classList.remove("olcs-hideoverlay"),this.hiddenRootGroup_&&(this.hiddenRootGroup_.setVisible(!0),this.hiddenRootGroup_=null)),this.camera_.updateView()}warmUp(e,s){if(this.enabled_)return;this.throwOnUnitializedMap_(),this.camera_.readFromView();const t=this.globe_.ellipsoid,i=this.scene_.camera,o=t.cartesianToCartographic(i.position);o.height<e&&(o.height=e,i.position=t.cartographicToCartesian(o)),this.warmingUp_=!0,this.render_(),setTimeout(()=>{this.warmingUp_=!1},s)}setBlockCesiumRendering(e){this.blockCesiumRendering_!==e&&(this.blockCesiumRendering_=e,this.render_())}enableAutoRenderLoop(){this.autoRenderLoop_||(this.autoRenderLoop_=new xa(this))}getAutoRenderLoop(){return this.autoRenderLoop_}setResolutionScale(e){e=Math.max(0,e),e!==this.resolutionScale_&&(this.resolutionScale_=Math.max(0,e),this.resolutionScaleChanged_=!0,this.autoRenderLoop_&&this.autoRenderLoop_.restartRenderLoop())}setTargetFrameRate(e){this.targetFrameRate_!==e&&(this.targetFrameRate_=e,this.render_())}throwOnUnitializedMap_(){const s=this.map_.getView(),t=s.getCenter();if(!s.isDef()||isNaN(t[0])||isNaN(t[1]))throw new Error(`The OpenLayers map is not properly initialized: ${t} / ${s.getResolution()}`)}get trackedFeature(){return this.trackedFeature_}set trackedFeature(e){if(this.trackedFeature_!==e){const s=this.scene_;if(!e||!e.getGeometry()){this.needTrackedEntityUpdate_=!1,s.screenSpaceCameraController.enableTilt=!0,this.trackedEntity_&&this.dataSourceDisplay_.defaultDataSource.entities.remove(this.trackedEntity_),this.trackedEntity_=null,this.trackedFeature_=null,this.entityView_=null,s.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);return}this.trackedFeature_=e,this.needTrackedEntityUpdate_=!0;const t=this.to4326Transform_,i=function(){const r=e.getGeometry();console.assert(r instanceof Ge);const a=r.getCoordinates(),l=t(a,void 0,a.length);return A.ol4326CoordinateToCesiumCartesian(l)},o={position:new Cesium.CallbackProperty((r,a)=>i(),!1),point:{pixelSize:1,color:Cesium.Color.TRANSPARENT}};this.trackedEntity_=this.dataSourceDisplay_.defaultDataSource.entities.add(o)}}}const Oa={props:{},setup(n,{emit:e}){const s=De,t=bt(),i=J({defaultCenter:[121.326776,24.655499],defaultCenterZoom:14,targetNum:1,conditionWrap:!1,layerSelect:!1,currentLayers:[],layers:[],mapLayers:ue(()=>i.layers.map((v,g)=>({label:v.group_title,value:v.value,layers:v.group_layers,groupClass:v.group_class}))),selectLock:!1,mapCount:1,map1:null,map2:null,map1LayerStatus:[],map2LayerStatus:[],temp:{map1BaseStatus:0,map2BaseStatus:0},deleteLightbox:!1,dimensionMap:{map1:"2D",map2:"2D"},toSearchDimensionStatus:ue(()=>{let v=i.targetNum==1?"map1":"map2";return i.dimensionMap[v]==="2D"}),ol3d:null,selectValueTemp:0,popup:{nodeRef:null,overlay:null,popupId:0,coordinate:[],popupData:""},comSize:{wrapHeight:"",wrapWidth:""},tribeQuery:{}});let o=null;const r=new yt({projection:"EPSG:4326",center:i.defaultCenter,zoom:i.defaultCenterZoom});function a(){i.map1=new Re({target:"map1",layers:[Pe.getBaseMapData(0)],view:r,controls:[]}),i.map1.addControl(new Sa({units:"metric"}))}function l(v,g){const w=new Ce({source:new me({features:[new ye({geometry:new Ge([v,g]),population:4e3,rainfall:500})]}),style:new He({image:new ve({anchor:[.5,100],anchorXUnits:"fraction",anchorYUnits:"pixels",src:Rt})})});let b=i.targetNum==1?"map1":"map2";i[b].addLayer(w)}function u({action:v,value:g}){var k;let w=((k=i.map1)==null?void 0:k.getTarget())==null?"map2":"map1",b=i[w].getView();switch(v){case"In":b.animate({zoom:b.getZoom()+1});break;case"Out":b.animate({zoom:b.getZoom()-1});break;case"toNorth":b.animate({rotation:0});break;case"moveTo":if(g){const{xAxis:D,yAxis:H}=g;b.animate({center:[D,H],zoom:17,duration:100})}else navigator.geolocation.getCurrentPosition(function(D){b.animate({center:[D.coords.longitude,D.coords.latitude],zoom:17,duration:100}),l(D.coords.longitude,D.coords.latitude)});break;case"fullScreen":let L=document.getElementById(`map${i.targetNum}`);L.requestFullscreen?L.requestFullscreen():L.msRequestFullscreen?L.msRequestFullscreen():L.mozRequestFullScreen?L.mozRequestFullScreen():L.webkitRequestFullscreen&&L.webkitRequestFullscreen();break}}function c({action:v,value:g}){var D;let w=i.targetNum==1?i.map1:i.map2,b=w==null?void 0:w.getLayers();switch(v){case"layerMode":if(g.checked){i.layers[g.nodeIndex].group_layers[g.subNodeIndex].single_tiles||(b.getArray().forEach($=>{$.get("id")&&$.get("id").includes(`node${g.nodeIndex}_subNode${g.subNodeIndex}_nestedSubNode`)&&w.removeLayer($)}),S("delete",w.getTarget(),g.id));let P=g.nestedSubNodeIndex||i.selectValueTemp,F=s.getLayer(i.layers[g.nodeIndex].group_layers[g.subNodeIndex],P,g.id);if(w.addLayer(F),(D=F.get("label"))!=null&&D.includes("雷達回波預測")){var k=F.getSource(),L=k.getFeatures()[0];const G=i.layers[g.nodeIndex].group_layers[g.subNodeIndex].image_options.image_extent,$=F.get("extra").url,Ee=gifler($),Ze=G[2]-G[0],oe=G[3]-G[1];Ee.frames(document.createElement("canvas"),function(ce,Y){const Bt=Ze/Y.width,jt=oe/Y.height,Wt=Math.min(Bt,jt),$t=i.map1.getView().getResolution();L.setStyle(new He({image:new ve({img:ce.canvas,imgSize:[Y.width,Y.height],opacity:.8,scale:Wt/$t})})),ce.clearRect(0,0,Y.width,Y.height),ce.drawImage(Y.buffer,Y.x,Y.y),w.render()},!0)}["新竹縣原住民部落範圍","近年歷史災害82處部落點位","雨量站"].includes(F.get("label"))&&(x(w,F.label),_(g)),S("add",w.getTarget(),g.id)}else{let F=function(Ee){P.filter(oe=>{var ce;return(ce=oe==null?void 0:oe.get("id"))==null?void 0:ce.includes(Ee)}).forEach(oe=>{w.removeLayer(oe)})},P=b.getArray();const $={node9_subNode0_nestedSubNode:"node9_subNode0_nestedSubNode",node12_subNode1_nestedSubNode:"node12_subNode1_nestedSubNode"}[g.id]||g.id;F($),i.layers[g.nodeIndex].group_layers[g.subNodeIndex].layer_type==="WFS"&&(_(g),i.popup.popupId=0,i.popup.popupData="",i.popup.overlay&&(w.removeOverlay(i.popup.overlay),i.popup.overlay=null)),S("delete",w.getTarget(),g.id)}break;case"selectLayerMode":if(i.selectLock)return;g.layerName==="all"?b.getArray().filter(G=>G.get("id")!==void 0).forEach(G=>{w.removeLayer(G)}):b.getArray().forEach(F=>{F.get("id")==g.id&&w.removeLayer(F)});break;case"changeOrder":if(i.selectLock)return;let{nodeIndex:H,subNodeIndex:q,nestedSubNodeIndex:U}=s.getLayerIndex(g.id),ie=s.getLayer(i.layers[H].group_layers[q],U,g.id);if(g.movement==="up"){if(g.key+1==b.getArray().length)return;let P={checked:!1,nodeIndex:H,subNodeIndex:q,nestedSubNodeIndex:U,id:g.id};c({action:"layerMode",value:P}),b.insertAt(g.key+1,ie)}if(g.movement==="down"){if(g.key-1==0)return;let P={checked:!1,nodeIndex:H,subNodeIndex:q,nestedSubNodeIndex:U,id:g.id};c({action:"layerMode",value:P}),b.insertAt(g.key-1,ie)}break;case"changeLayerVisible":if(i.selectLock)return;let le=!b.getArray()[g.key].getVisible();b.getArray()[g.key].setVisible(le);break;case"baseMap":i.temp[`map${i.targetNum}BaseStatus`]=g.baseId;let xe=new _t({preload:1/0,name:g.name,label:g.label,type:g.mapType,baseId:g.baseId,source:new ft({url:g.url}),crossOrigin:"anonymous"}),Te=w==null?void 0:w.getLayers().getArray();b.insertAt(0,xe),Te.forEach(P=>(P.get("type")=="base"&&P.get("baseId")!==g.baseId&&w.removeLayer(P),!0));break;case"changeDimensionMap":let ne=i.targetNum==1?"map1":"map2";if(i.dimensionMap[ne]=g,g==="3D"){const F=b.getArray().find($=>$.get("label").includes("近年歷史災害82處部落點位"));F&&i[`map${i.targetNum}`].removeLayer(F),o=new _e({map:w}),o.setEnabled(!0),Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0NzM3MWFhYS0xMjNlLTQ3MTMtODFjZS0xZjMzM2I5NGZiYTEiLCJpZCI6MTMwODE4LCJpYXQiOjE2ODQwNzM3Mjl9.UYu4kBialPo19dcvosHzZTpg2BD1zkFQnjCD78YiiYo";let G=o.getCesiumScene({});G.terrainProvider=Cesium.createWorldTerrain({}),i[`${ne}LayerStatus`].push("3D")}else o.setEnabled(!1),i[`${ne}LayerStatus`]=i[`${ne}LayerStatus`].filter(P=>P!=="3D"),i[`map${i.targetNum}LayerStatus`].forEach(P=>{let{nodeIndex:F,subNodeIndex:G,nestedSubNodeIndex:$}=s.getLayerIndex(P);return s.getLayer(i.layers[F].group_layers[G],$,g.id).get("label").includes("近年歷史災害82處部落點位")&&c({action:"layerMode",value:{checked:!0,nodeIndex:F,subNodeIndex:G,nestedSubNodeIndex:$,id:P}}),P});break;case"setOpacity":b.getArray()[g.key].setOpacity(Number(g.value));break}p()}function h(v){var k;if(i.mapCount===v)return;let g=i.targetNum!==1?"map1":"map2";i.mapCount=v;let b=i[`${g}LayerStatus`].filter(L=>L!=="3D").map(L=>De.getLayerIndex(L));if(v===2&&(i[g]=new Re({target:g,layers:[Pe.getBaseMapData(0),...b.map(L=>s.getLayer(i.layers[L.nodeIndex].group_layers[L.subNodeIndex],L.nestedSubNodeIndex,L.id))],view:r,controls:[]}),((k=i[`${g}LayerStatus`])==null?void 0:k.indexOf("3D"))!==-1)){o=new _e({map:i[g]}),o.setEnabled(!0),Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0NzM3MWFhYS0xMjNlLTQ3MTMtODFjZS0xZjMzM2I5NGZiYTEiLCJpZCI6MTMwODE4LCJpYXQiOjE2ODQwNzM3Mjl9.UYu4kBialPo19dcvosHzZTpg2BD1zkFQnjCD78YiiYo";let L=o.getCesiumScene({});L.terrainProvider=Cesium.createWorldTerrain({})}if(v===1){i[g]=null;const L=document.getElementById(g);for(;L.firstChild;)L.removeChild(L.firstChild)}}function m(v){var w;i.targetNum=v;let g=i.targetNum!==1?"map1":"map2";if(i.mapCount===1){if(!i[`map${v}`]){let b=i[`map${v}LayerStatus`].filter(L=>L!=="3D");b.includes("node0_subNode4_nestedSubNodeundefined")&&(b=[...b.filter(D=>D!=="node0_subNode4_nestedSubNodeundefined"),"node0_subNode4_nestedSubNodeundefined"]);let k=b.map(L=>De.getLayerIndex(L));i[`map${v}`]=new Re({target:`map${v}`,layers:[Pe.getBaseMapData(i.temp[`map${i.targetNum}BaseStatus`]),...k.map(L=>s.getLayer(i.layers[L.nodeIndex].group_layers[L.subNodeIndex],L.nestedSubNodeIndex,L.layeredIndex))],view:r,controls:[]}),x(i[`map${v}`]),((w=i[`map${v}LayerStatus`])==null?void 0:w.indexOf("3D"))!==-1&&(o=new _e({map:i[`map${v}`]}),o.setEnabled(!0))}if(i[g]){i[g]=null;const b=document.getElementById(g);for(;b.firstChild;)b.removeChild(b.firstChild)}}ot(()=>{p()})}function p(){var w;let v=i.targetNum==1?i.map1:i.map2;const g=(w=v==null?void 0:v.getLayers())==null?void 0:w.getArray();i.currentLayers=g==null?void 0:g.map(b=>({label:b.get("label"),id:b.get("id"),visible:b.getVisible()}))}function f(){i.conditionWrap=!i.conditionWrap}function S(v,g,w){if(v==="add")i[`${g}LayerStatus`].push(w);else if(v==="delete"){let b=i[`${g}LayerStatus`].findIndex(k=>k===w);i[`${g}LayerStatus`].splice(b,1)}else console.log("error")}function x(v){var w;let g=new ba({layers:(w=v==null?void 0:v.getLayers())==null?void 0:w.getArray(),condition:Ms});v.addInteraction(g),g.on("select",b=>{let k=b.selected[0];if(k){i.popup.overlay=new St({element:i.popup.nodeRef,autoPan:!0,autoPanAnimation:{duration:250}}),i.popup.overlay.setPosition(b.mapBrowserEvent.coordinate),v.addOverlay(i.popup.overlay);let L=k.getId().split(".");if(i.popup.popupData=L[0],i.popup.coordinate=b.mapBrowserEvent.coordinate,L[0]==="新竹縣原住民部落範圍"){i.popup.popupId=k.get("編號");return}if(L[0]==="近年歷史災害82處部落點位"){i.popup.popupId=L[1];return}if(L[0]==="雨量站"){i.popup.popupId=L[1];return}}else v.removeOverlay(i.popup.overlay),i.popup.overlay=null,i.popup={nodeRef:null,overlay:null,popupId:0,coordinate:[],popupData:""}})}function I(){(i.targetNum==1?i.map1:i.map2).removeOverlay(i.popup.overlay),i.popup.overlay=null}function _(v){const{checked:g,id:w}=v;if(!g){i.selectLayerOption={};return}w==="node4_subNode0_nestedSubNodeundefined"&&te.ajax({url:"https://api.edtest.site/tribeQuery",method:"GET",success:b=>{i.tribeQuery=b},error:b=>{console.log(b)}})}function T(v){let g={action:"moveTo",value:{xAxis:v.WGS84.lng,yAxis:v.WGS84.lat}};u(g)}return Ve(async()=>{let v=te.ajax({url:"https://api.edtest.site/underLayers",method:"GET"}).done(w=>w),g=te.ajax({url:"https://api.edtest.site/layers",method:"GET"}).done(w=>w);Promise.all([v,g]).then(w=>{let b=w[0].data.map((k,L)=>({mapType:"base",baseId:L,onCurrent:!1,...k}));Pe.setBaseMapData(b),i.temp.map1BaseStatus=0,i.temp.baseMapList=Es(),i.layers=w[1].map((k,L)=>(k.group_layers.forEach((D,H)=>{let q=H,U;D.id=`node${L}_subNode${q}_nestedSubNode${U}`,D.single_tiles||D.tiles_list.forEach((ie,le)=>{U=le,ie.id=`node${L}_subNode${q}_nestedSubNode${U}`})}),{...k,value:L})),ot(()=>{a(),p()})}),i.comSize.wrapHeight=window.innerHeight,i.comSize.wrapWidth=window.innerWidth,window.onresize=w=>{i.comSize.wrapHeight=w.target.innerHeight,i.comSize.wrapWidth=w.target.innerWidth}}),{state:i,props:n,store:t,mapControl:u,layerControl:c,changeTarget:m,conditionWrap:f,closeMapData:I,moveToMap:T,changeMapCount:h}}},Ra={class:"w-100 d-flex justify-content-between flex-sm-row flex-wrap flex-sm-nowrap mapWrap",id:"mapWrap"},Da={key:0,class:"middleLine"},Fa={class:"SearchBar d-none d-sm-block position-absolute"},Aa={class:"d-flex align-items-center"},Na=d("img",{src:Dt,alt:"",class:"me-5"},null,-1),Ga={class:"conditionCom d-none d-sm-block position-absolute"},Va={class:"mb-4"},Ba={key:1},ja={class:"m-Navbar d-flex d-sm-none position-fixed bottom-0 start-0 w-100"},Wa={class:"position-absolute bottom-100 w-100",style:{"max-height":"70vh","overflow-y":"scroll"}},$a={key:0},za={key:0,class:"lightWrap w-100 h-100 d-flex justify-content-center align-items-center"},Ha={class:"p-4 rounded bg-white",style:{width:"250px"}},Ua=d("p",{class:"text-center fw-bold"},"是否要取消全部圖層",-1),Ka={class:"d-flex justify-content-around"};function qa(n,e,s,t,i,o){var f,S,x,I;const r=_a,a=Zr,l=qr,u=br,c=je,h=Yo,m=fo,p=Wn;return y(),C("div",null,[d("div",Ra,[d("div",{id:"map1",class:z({"w-100":((f=t.state.map1)==null?void 0:f.getTarget())=="map1","h-100":t.state.mapCount===1,"h-50":t.state.mapCount===2&&t.state.comSize.wrapWidth<600,middleMap:(S=t.state.map1)==null?void 0:S.getTarget()})},null,2),t.state.mapCount===2?(y(),C("div",Da)):E("",!0),d("div",{id:"map2",class:z({"w-100":((x=t.state.map2)==null?void 0:x.getTarget())=="map2","h-100":t.state.mapCount===1,"h-50":t.state.mapCount===2&&t.state.comSize.wrapWidth<600,middleMap:(I=t.state.map2)==null?void 0:I.getTarget()})},null,2)]),B(r,{class:"asideTool position-absolute top-50 translate-middle-y",id:"asideTool",onOnMapControl:e[0]||(e[0]=({action:_,value:T})=>{t.mapControl({action:_,value:T})})}),d("div",Fa,[d("div",Aa,[Na,B(a,{class:"mapSourceOption d-none d-sm-block",baseMapList:t.state.temp.baseMapList,onChangeBaseMaps:({action:_,value:T})=>{t.layerControl({action:_,value:T})}},null,8,["baseMapList","onChangeBaseMaps"])]),B(l,pe({class:"mt-4"},{dimensionMapStatus:t.state.toSearchDimensionStatus,currentLayers:t.state.currentLayers,mapCount:t.state.mapCount,onChangeBaseMaps:({action:_,value:T})=>{t.layerControl({action:_,value:T})},onChangeMapCount:_=>{t.changeMapCount(_)}},{onOnLayerControl:e[1]||(e[1]=({action:_,value:T})=>{t.layerControl(_,T)}),onOnChangeTarget:e[2]||(e[2]=_=>{t.changeTarget(_)}),onConditionWrap:e[3]||(e[3]=_=>{t.conditionWrap(_)})}),null,16)]),d("div",Ga,[d("div",Va,[t.state.conditionWrap?E("",!0):(y(),C("button",{key:0,class:"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5",onClick:e[4]||(e[4]=_=>t.state.conditionWrap=!0)}," 圖層選項 ")),t.state.conditionWrap?(y(),C("div",{key:1,class:"mb-4","on:onLayerControl":e[6]||(e[6]=({action:_,value:T})=>{t.layerControl({action:_,value:T})})},[B(u,pe({tribeQuery:t.state.tribeQuery,mapLayers:t.state.mapLayers,currentLayers:t.state.currentLayers,onClose:()=>{t.state.conditionWrap=!1},showSelectLayerValue:_=>{t.state.selectValueTemp=_},moveToMap:_=>{t.moveToMap(_)}},{onOnLayerControl:e[5]||(e[5]=({action:_,value:T})=>{t.layerControl({action:_,value:T})})}),null,16)],32)):E("",!0),B(c,{text:"可選擇要加入的圖層",styles:"right: 105%;top: 0;text-align: right;"})]),d("div",null,[t.state.layerSelect?E("",!0):(y(),C("button",{key:0,class:"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5",onClick:e[7]||(e[7]=_=>t.state.layerSelect=!0)}," 已選擇的圖層 ")),t.state.layerSelect?(y(),C("div",Ba,[B(h,ks(Os({selectLock:t.state.selectLock,currentLayers:t.state.currentLayers,onClose:()=>{t.state.layerSelect=!1},onLockLayer:()=>{t.state.selectLock=!t.state.selectLock},onDeleteLayer:({action:_,value:T})=>{T.layerName=="all"?t.state.deleteLightbox=!0:t.layerControl({action:_,value:T})},onDeleteLayerAll:()=>{t.state.deleteLightbox=!0},onLayerControl:({action:_,value:T})=>{t.layerControl({action:_,value:T})}})),null,16)])):E("",!0),B(c,{text:"顯示已經選擇的圖層",styles:"right: 105%;top: 0;text-align: right;"})])]),d("div",ja,[d("div",Wa,[t.state.conditionWrap?(y(),rt(u,pe({key:0,class:"w-100"},{mapLayers:t.state.mapLayers,currentLayers:t.state.currentLayers,onClose:()=>{t.state.conditionWrap=!1},showSelectLayerValue:_=>{t.state.selectValueTemp=_}},{onOnLayerControl:e[8]||(e[8]=({action:_,value:T})=>{t.layerControl({action:_,value:T})})}),null,16)):E("",!0)]),t.state.layerSelect?(y(),C("div",$a,[B(h,pe({class:"position-absolute bottom-100 w-100"},{selectLock:t.state.selectLock,currentLayers:t.state.currentLayers,onClose:()=>{t.state.layerSelect=!1},onLockLayer:()=>{t.state.selectLock=!t.state.selectLock},onDeleteLayer:({action:_,value:T})=>{T.layerName=="all"?t.state.deleteLightbox=!0:t.layerControl({action:_,value:T})},onDeleteLayerAll:()=>{t.state.deleteLightbox=!0},onChangLayerVisible:_=>{t.layerControl(_)},onChangeOrderLayer:({action:_,value:T})=>{t.layerControl({action:_,value:T})},onLayerControl:({action:_,value:T})=>{t.layerControl({action:_,value:T})}}),null,16)])):E("",!0),B(m,pe({dimensionMapStatus:t.state.toSearchDimensionStatus,currentLayers:t.state.currentLayers,mapCount:t.state.mapCount,openConditionWrap:()=>{t.state.conditionWrap=!t.state.conditionWrap,t.state.layerSelect=!1},openLayerSelect:()=>{t.state.layerSelect=!t.state.layerSelect,t.state.conditionWrap=!1},onLayerControl:({action:_,value:T})=>{t.layerControl({action:_,value:T})},onChangeMapCount:_=>{t.changeMapCount(_)},onChangeTarget:_=>{t.changeTarget(_)}},{onConditionWrap:e[9]||(e[9]=_=>{t.conditionWrap(_)})}),null,16)]),t.state.deleteLightbox?(y(),C("div",za,[d("div",Ha,[Ua,d("div",Ka,[d("button",{class:"rounded px-3 py-1 bg-steel text-white border-0",onClick:e[10]||(e[10]=()=>{t.layerControl({action:"selectLayerMode",value:{layerName:"all"}}),t.state.deleteLightbox=!1})},"確定"),d("button",{class:"rounded px-3 py-1 bg-secondary bg-gradient text-white border-0",onClick:e[11]||(e[11]=()=>{t.state.deleteLightbox=!1})},"取消")])])])):E("",!0),d("div",{id:"popup",class:"popup position-absolute bottom-0",ref:_=>{t.state.popup.nodeRef=_}},[t.state.popup.popupId!==0?(y(),rt(p,{key:0,class:"areaData",closeMapData:()=>{t.closeMapData()},popup:t.state.popup,maxHeight:500},null,8,["closeMapData","popup"])):E("",!0)],512),t.store.state.isInit?(y(),C("div",{key:1,class:"stepOverLayer position-absolute top-0 start-0 w-100 h-100 bg-black opacity-50",id:"firstEnter",onClick:e[12]||(e[12]=()=>{t.store.dispatch("updateLayerStatus",!1)})})):E("",!0)])}const Qa=K(Oa,[["render",qa]]);export{Qa as default};
//# sourceMappingURL=WebMap-f948b876.js.map
