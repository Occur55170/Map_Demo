import{V as he,a as rt,E as Ue,g as Ke,c as Vt,b as Nt,d as Bt,s as Gt,e as at,P as We,F as lt,f as Wt,M as Se,T as je,O as jt,h as ct,X as dt,m as xe,C as Ht,i as $t,j as qe,k as zt,u as X,l as Ve,n as O,o as Ut,p as Kt,q as R,r as Ne,t as oe,v as qt,w as se,x as Yt,y as De,z as Zt,I as Te,S as Qt,A as Ye,B as Be,D as Xt,G as Jt,H as ei,J as ut,K as ti,L as ii,N as si,Q as Ze,R as ni,U as oi}from"./core-73dbd084.js";import{_ as $,r as Q,f as Ie,o as _,c as C,b as c,n as Me,p as pe,e as ge,g as ht,h as V,t as k,i as me,F as q,j as Y,k as M,u as mt,$ as J,l as j,w as E,m as pt,a as ri,q as re,d as ai,s as gt,v as ft,x as Qe,y as ve,z as li,A as ci,B as Xe}from"./index-261685cb.js";class di extends he{constructor(e){super({attributions:e.attributions,wrapX:e.wrapX}),this.resolution=void 0,this.distance=e.distance!==void 0?e.distance:20,this.minDistance=e.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=e.geometryFunction||function(i){const t=i.getGeometry();return rt(t.getType()=="Point",10),t},this.createCustomCluster_=e.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(e.source||null)}clear(e){this.features.length=0,super.clear(e)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(e,i,t){this.source.loadFeatures(e,i,t),i!==this.resolution&&(this.resolution=i,this.refresh())}setDistance(e){this.updateDistance(e,this.minDistance)}setMinDistance(e){this.updateDistance(this.distance,e)}getMinDistance(){return this.minDistance}setSource(e){this.source&&this.source.removeEventListener(Ue.CHANGE,this.boundRefresh_),this.source=e,e&&e.addEventListener(Ue.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(e,i){const t=e===0?0:Math.min(i,e)/e,s=e!==this.distance||this.interpolationRatio!==t;this.distance=e,this.minDistance=i,this.interpolationRatio=t,s&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;const e=Wt(),i=this.distance*this.resolution,t=this.source.getFeatures(),s={};for(let r=0,o=t.length;r<o;r++){const a=t[r];if(!(Ke(a)in s)){const l=this.geometryFunction(a);if(l){const u=l.getCoordinates();Vt(u,e),Nt(e,i,e);const d=this.source.getFeaturesInExtent(e).filter(function(m){const h=Ke(m);return h in s?!1:(s[h]=!0,!0)});this.features.push(this.createCluster(d,e))}}}}createCluster(e,i){const t=[0,0];for(let a=e.length-1;a>=0;--a){const l=this.geometryFunction(e[a]);l?Bt(t,l.getCoordinates()):e.splice(a,1)}Gt(t,1/e.length);const s=at(i),r=this.interpolationRatio,o=new We([t[0]*(1-r)+s[0]*r,t[1]*(1-r)+s[1]*r]);return this.createCustomCluster_?this.createCustomCluster_(o,e):new lt({geometry:o,features:e})}}const yt=di;function ui(n,e){if(n.match(/^[a-z]+:\/\//i))return n;if(n.match(/^\/\//))return window.location.protocol+n;if(n.match(/^[a-z]+:/i))return n;const i=document.implementation.createHTMLDocument(),t=i.createElement("base"),s=i.createElement("a");return i.head.appendChild(t),i.body.appendChild(s),e&&(t.href=e),s.href=n,s.href}const hi=(()=>{let n=0;const e=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(n+=1,`u${e()}${n}`)})();function Z(n){const e=[];for(let i=0,t=n.length;i<t;i++)e.push(n[i]);return e}function ke(n,e){const t=(n.ownerDocument.defaultView||window).getComputedStyle(n).getPropertyValue(e);return t?parseFloat(t.replace("px","")):0}function mi(n){const e=ke(n,"border-left-width"),i=ke(n,"border-right-width");return n.clientWidth+e+i}function pi(n){const e=ke(n,"border-top-width"),i=ke(n,"border-bottom-width");return n.clientHeight+e+i}function _t(n,e={}){const i=e.width||mi(n),t=e.height||pi(n);return{width:i,height:t}}function gi(){let n,e;try{e=process}catch{}const i=e&&e.env?e.env.devicePixelRatio:null;return i&&(n=parseInt(i,10),Number.isNaN(n)&&(n=1)),n||window.devicePixelRatio||1}const B=16384;function fi(n){(n.width>B||n.height>B)&&(n.width>B&&n.height>B?n.width>n.height?(n.height*=B/n.width,n.width=B):(n.width*=B/n.height,n.height=B):n.width>B?(n.height*=B/n.width,n.width=B):(n.width*=B/n.height,n.height=B))}function Ee(n){return new Promise((e,i)=>{const t=new Image;t.decode=()=>e(t),t.onload=()=>e(t),t.onerror=i,t.crossOrigin="anonymous",t.decoding="async",t.src=n})}async function yi(n){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(n)).then(encodeURIComponent).then(e=>`data:image/svg+xml;charset=utf-8,${e}`)}async function _i(n,e,i){const t="http://www.w3.org/2000/svg",s=document.createElementNS(t,"svg"),r=document.createElementNS(t,"foreignObject");return s.setAttribute("width",`${e}`),s.setAttribute("height",`${i}`),s.setAttribute("viewBox",`0 0 ${e} ${i}`),r.setAttribute("width","100%"),r.setAttribute("height","100%"),r.setAttribute("x","0"),r.setAttribute("y","0"),r.setAttribute("externalResourcesRequired","true"),s.appendChild(r),r.appendChild(n),yi(s)}const N=(n,e)=>{if(n instanceof e)return!0;const i=Object.getPrototypeOf(n);return i===null?!1:i.constructor.name===e.name||N(i,e)};function Ci(n){const e=n.getPropertyValue("content");return`${n.cssText} content: '${e.replace(/'|"/g,"")}';`}function vi(n){return Z(n).map(e=>{const i=n.getPropertyValue(e),t=n.getPropertyPriority(e);return`${e}: ${i}${t?" !important":""};`}).join(" ")}function bi(n,e,i){const t=`.${n}:${e}`,s=i.cssText?Ci(i):vi(i);return document.createTextNode(`${t}{${s}}`)}function Je(n,e,i){const t=window.getComputedStyle(n,i),s=t.getPropertyValue("content");if(s===""||s==="none")return;const r=hi();try{e.className=`${e.className} ${r}`}catch{return}const o=document.createElement("style");o.appendChild(bi(r,i,t)),e.appendChild(o)}function wi(n,e){Je(n,e,":before"),Je(n,e,":after")}const et="application/font-woff",tt="image/jpeg",Li={woff:et,woff2:et,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:tt,jpeg:tt,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function Si(n){const e=/\.([^./]*?)$/g.exec(n);return e?e[1]:""}function He(n){const e=Si(n).toLowerCase();return Li[e]||""}function xi(n){return n.split(/,/)[1]}function Ge(n){return n.search(/^(data:)/)!==-1}function Ct(n,e){return`data:${e};base64,${n}`}async function vt(n,e,i){const t=await fetch(n,e);if(t.status===404)throw new Error(`Resource "${t.url}" not found`);const s=await t.blob();return new Promise((r,o)=>{const a=new FileReader;a.onerror=o,a.onloadend=()=>{try{r(i({res:t,result:a.result}))}catch(l){o(l)}},a.readAsDataURL(s)})}const Ae={};function Ti(n,e,i){let t=n.replace(/\?.*/,"");return i&&(t=n),/ttf|otf|eot|woff2?/i.test(t)&&(t=t.replace(/.*\//,"")),e?`[${e}]${t}`:t}async function $e(n,e,i){const t=Ti(n,e,i.includeQueryParams);if(Ae[t]!=null)return Ae[t];i.cacheBust&&(n+=(/\?/.test(n)?"&":"?")+new Date().getTime());let s;try{const r=await vt(n,i.fetchRequestInit,({res:o,result:a})=>(e||(e=o.headers.get("Content-Type")||""),xi(a)));s=Ct(r,e)}catch(r){s=i.imagePlaceholder||"";let o=`Failed to fetch resource: ${n}`;r&&(o=typeof r=="string"?r:r.message),o&&console.warn(o)}return Ae[t]=s,s}async function Mi(n){const e=n.toDataURL();return e==="data:,"?n.cloneNode(!1):Ee(e)}async function ki(n,e){if(n.currentSrc){const r=document.createElement("canvas"),o=r.getContext("2d");r.width=n.clientWidth,r.height=n.clientHeight,o==null||o.drawImage(n,0,0,r.width,r.height);const a=r.toDataURL();return Ee(a)}const i=n.poster,t=He(i),s=await $e(i,t,e);return Ee(s)}async function Ei(n){var e;try{if(!((e=n==null?void 0:n.contentDocument)===null||e===void 0)&&e.body)return await Re(n.contentDocument.body,{},!0)}catch{}return n.cloneNode(!1)}async function Ii(n,e){return N(n,HTMLCanvasElement)?Mi(n):N(n,HTMLVideoElement)?ki(n,e):N(n,HTMLIFrameElement)?Ei(n):n.cloneNode(!1)}const Ri=n=>n.tagName!=null&&n.tagName.toUpperCase()==="SLOT";async function Pi(n,e,i){var t,s;let r=[];return Ri(n)&&n.assignedNodes?r=Z(n.assignedNodes()):N(n,HTMLIFrameElement)&&(!((t=n.contentDocument)===null||t===void 0)&&t.body)?r=Z(n.contentDocument.body.childNodes):r=Z(((s=n.shadowRoot)!==null&&s!==void 0?s:n).childNodes),r.length===0||N(n,HTMLVideoElement)||await r.reduce((o,a)=>o.then(()=>Re(a,i)).then(l=>{l&&e.appendChild(l)}),Promise.resolve()),e}function Oi(n,e){const i=e.style;if(!i)return;const t=window.getComputedStyle(n);t.cssText?(i.cssText=t.cssText,i.transformOrigin=t.transformOrigin):Z(t).forEach(s=>{let r=t.getPropertyValue(s);s==="font-size"&&r.endsWith("px")&&(r=`${Math.floor(parseFloat(r.substring(0,r.length-2)))-.1}px`),N(n,HTMLIFrameElement)&&s==="display"&&r==="inline"&&(r="block"),s==="d"&&e.getAttribute("d")&&(r=`path(${e.getAttribute("d")})`),i.setProperty(s,r,t.getPropertyPriority(s))})}function Di(n,e){N(n,HTMLTextAreaElement)&&(e.innerHTML=n.value),N(n,HTMLInputElement)&&e.setAttribute("value",n.value)}function Ai(n,e){if(N(n,HTMLSelectElement)){const i=e,t=Array.from(i.children).find(s=>n.value===s.getAttribute("value"));t&&t.setAttribute("selected","")}}function Fi(n,e){return N(e,Element)&&(Oi(n,e),wi(n,e),Di(n,e),Ai(n,e)),e}async function Vi(n,e){const i=n.querySelectorAll?n.querySelectorAll("use"):[];if(i.length===0)return n;const t={};for(let r=0;r<i.length;r++){const a=i[r].getAttribute("xlink:href");if(a){const l=n.querySelector(a),u=document.querySelector(a);!l&&u&&!t[a]&&(t[a]=await Re(u,e,!0))}}const s=Object.values(t);if(s.length){const r="http://www.w3.org/1999/xhtml",o=document.createElementNS(r,"svg");o.setAttribute("xmlns",r),o.style.position="absolute",o.style.width="0",o.style.height="0",o.style.overflow="hidden",o.style.display="none";const a=document.createElementNS(r,"defs");o.appendChild(a);for(let l=0;l<s.length;l++)a.appendChild(s[l]);n.appendChild(o)}return n}async function Re(n,e,i){return!i&&e.filter&&!e.filter(n)?null:Promise.resolve(n).then(t=>Ii(t,e)).then(t=>Pi(n,t,e)).then(t=>Fi(n,t)).then(t=>Vi(t,e))}const bt=/url\((['"]?)([^'"]+?)\1\)/g,Ni=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,Bi=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function Gi(n){const e=n.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${e})(['"]?\\))`,"g")}function Wi(n){const e=[];return n.replace(bt,(i,t,s)=>(e.push(s),i)),e.filter(i=>!Ge(i))}async function ji(n,e,i,t,s){try{const r=i?ui(e,i):e,o=He(e);let a;if(s){const l=await s(r);a=Ct(l,o)}else a=await $e(r,o,t);return n.replace(Gi(e),`$1${a}$3`)}catch{}return n}function Hi(n,{preferredFontFormat:e}){return e?n.replace(Bi,i=>{for(;;){const[t,,s]=Ni.exec(i)||[];if(!s)return"";if(s===e)return`src: ${t};`}}):n}function wt(n){return n.search(bt)!==-1}async function Lt(n,e,i){if(!wt(n))return n;const t=Hi(n,i);return Wi(t).reduce((r,o)=>r.then(a=>ji(a,o,e,i)),Promise.resolve(t))}async function be(n,e,i){var t;const s=(t=e.style)===null||t===void 0?void 0:t.getPropertyValue(n);if(s){const r=await Lt(s,null,i);return e.style.setProperty(n,r,e.style.getPropertyPriority(n)),!0}return!1}async function $i(n,e){await be("background",n,e)||await be("background-image",n,e),await be("mask",n,e)||await be("mask-image",n,e)}async function zi(n,e){const i=N(n,HTMLImageElement);if(!(i&&!Ge(n.src))&&!(N(n,SVGImageElement)&&!Ge(n.href.baseVal)))return;const t=i?n.src:n.href.baseVal,s=await $e(t,He(t),e);await new Promise((r,o)=>{n.onload=r,n.onerror=o;const a=n;a.decode&&(a.decode=r),a.loading==="lazy"&&(a.loading="eager"),i?(n.srcset="",n.src=s):n.href.baseVal=s})}async function Ui(n,e){const t=Z(n.childNodes).map(s=>St(s,e));await Promise.all(t).then(()=>n)}async function St(n,e){N(n,Element)&&(await $i(n,e),await zi(n,e),await Ui(n,e))}function Ki(n,e){const{style:i}=n;e.backgroundColor&&(i.backgroundColor=e.backgroundColor),e.width&&(i.width=`${e.width}px`),e.height&&(i.height=`${e.height}px`);const t=e.style;return t!=null&&Object.keys(t).forEach(s=>{i[s]=t[s]}),n}const it={};async function st(n){let e=it[n];if(e!=null)return e;const t=await(await fetch(n)).text();return e={url:n,cssText:t},it[n]=e,e}async function nt(n,e){let i=n.cssText;const t=/url\(["']?([^"')]+)["']?\)/g,r=(i.match(/url\([^)]+\)/g)||[]).map(async o=>{let a=o.replace(t,"$1");return a.startsWith("https://")||(a=new URL(a,n.url).href),vt(a,e.fetchRequestInit,({result:l})=>(i=i.replace(o,`url(${l})`),[o,l]))});return Promise.all(r).then(()=>i)}function ot(n){if(n==null)return[];const e=[],i=/(\/\*[\s\S]*?\*\/)/gi;let t=n.replace(i,"");const s=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const l=s.exec(t);if(l===null)break;e.push(l[0])}t=t.replace(s,"");const r=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,o="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",a=new RegExp(o,"gi");for(;;){let l=r.exec(t);if(l===null){if(l=a.exec(t),l===null)break;r.lastIndex=a.lastIndex}else a.lastIndex=r.lastIndex;e.push(l[0])}return e}async function qi(n,e){const i=[],t=[];return n.forEach(s=>{if("cssRules"in s)try{Z(s.cssRules||[]).forEach((r,o)=>{if(r.type===CSSRule.IMPORT_RULE){let a=o+1;const l=r.href,u=st(l).then(d=>nt(d,e)).then(d=>ot(d).forEach(m=>{try{s.insertRule(m,m.startsWith("@import")?a+=1:s.cssRules.length)}catch(h){console.error("Error inserting rule from remote css",{rule:m,error:h})}})).catch(d=>{console.error("Error loading remote css",d.toString())});t.push(u)}})}catch(r){const o=n.find(a=>a.href==null)||document.styleSheets[0];s.href!=null&&t.push(st(s.href).then(a=>nt(a,e)).then(a=>ot(a).forEach(l=>{o.insertRule(l,s.cssRules.length)})).catch(a=>{console.error("Error loading remote stylesheet",a)})),console.error("Error inlining remote css file",r)}}),Promise.all(t).then(()=>(n.forEach(s=>{if("cssRules"in s)try{Z(s.cssRules||[]).forEach(r=>{i.push(r)})}catch(r){console.error(`Error while reading CSS rules from ${s.href}`,r)}}),i))}function Yi(n){return n.filter(e=>e.type===CSSRule.FONT_FACE_RULE).filter(e=>wt(e.style.getPropertyValue("src")))}async function Zi(n,e){if(n.ownerDocument==null)throw new Error("Provided element is not within a Document");const i=Z(n.ownerDocument.styleSheets),t=await qi(i,e);return Yi(t)}async function Qi(n,e){const i=await Zi(n,e);return(await Promise.all(i.map(s=>{const r=s.parentStyleSheet?s.parentStyleSheet.href:null;return Lt(s.cssText,r,e)}))).join(`
`)}async function Xi(n,e){const i=e.fontEmbedCSS!=null?e.fontEmbedCSS:e.skipFonts?null:await Qi(n,e);if(i){const t=document.createElement("style"),s=document.createTextNode(i);t.appendChild(s),n.firstChild?n.insertBefore(t,n.firstChild):n.appendChild(t)}}async function Ji(n,e={}){const{width:i,height:t}=_t(n,e),s=await Re(n,e,!0);return await Xi(s,e),await St(s,e),Ki(s,e),await _i(s,i,t)}async function es(n,e={}){const{width:i,height:t}=_t(n,e),s=await Ji(n,e),r=await Ee(s),o=document.createElement("canvas"),a=o.getContext("2d"),l=e.pixelRatio||gi(),u=e.canvasWidth||i,d=e.canvasHeight||t;return o.width=u*l,o.height=d*l,e.skipAutoScale||fi(o),o.style.width=`${u}`,o.style.height=`${d}`,e.backgroundColor&&(a.fillStyle=e.backgroundColor,a.fillRect(0,0,o.width,o.height)),a.drawImage(r,0,0,o.width,o.height),o}async function ts(n,e={}){return(await es(n,e)).toDataURL()}const is="/Map_Demo/assets/currentPosition-33b00a21.svg";const ss={props:{coordinate:{type:Object,default:{}}},setup(n,{emit:e}){let i;const t=Q({imgSrc:"dddd"});return Ie(async()=>{i=new Se({target:"imgMap",layers:[new je({preload:1/0,crossOrigin:"Anonymous",source:new jt})],view:new ct({projection:"EPSG:4326",center:n.coordinate,zoom:14})}),i.once("loadend",function(){ts(i.getTargetElement()).then(function(s){document.getElementById("imgMap")!==null&&(document.getElementById("imgMap").remove(),t.imgSrc=s)})})}),{props:n,state:t}}},ns=n=>(pe("data-v-6ba1c373"),n=n(),ge(),n),os={class:"position-relative",style:{overflow:"hidden"}},rs=ns(()=>c("div",{id:"imgMap",class:"position-absolute",style:{width:"600px",height:"600px"}},null,-1));function as(n,e,i,t,s,r){return _(),C("div",os,[rs,c("div",{style:Me([{background:`url('${t.state.imgSrc}')`,"background-size":"cover"},{width:"100%",height:"200px"}])},null,4)])}const ls=$(ss,[["render",as],["__scopeId","data-v-6ba1c373"]]),cs="/Map_Demo/assets/vector-a2cf21ef.svg";const ds={props:{popup:{type:Object,default:{}},closeMapData:{Type:Function,default:()=>{}},maxHeight:{Type:Number,default:0},coordinate:{type:Object,default:{}}},setup(n,{emit:e}){const i=mt(),t=Q({type:0,media:"photo",scrollY:!1,tribeData:{data:{}}});async function s(o){return await J.ajax({url:`https://api.edtest.site/tribe?tribeCode=${o}`,method:"GET"}).done(l=>l).fail(l=>(console.log("Fail",l),!1))}async function r(o){return await J.ajax({url:`https://api.edtest.site/historicalDiseaster?id=${o}`,method:"GET"}).done(l=>l).fail(l=>(console.log("Fail",l),!1))}return ht(n.popup,async o=>{if(o.popupData=="新竹縣原住民部落範圍"){s(o.popupId).then(a=>{t.type=1,t.tribeData=a});return}if(n.popup.popupData=="近年歷史災害82處部落點位"){r(`近年歷史災害82處部落點位.${n.popup.popupId}`).then(a=>{t.type=2,t.tribeData=a.data});return}}),Ie(async()=>{if(n.popup.popupData=="新竹縣原住民部落範圍"){s(n.popup.popupId).then(o=>{t.type=1,t.tribeData=o});return}if(n.popup.popupData=="近年歷史災害82處部落點位"){r(`近年歷史災害82處部落點位.${n.popup.popupId}`).then(o=>{t.type=2,t.tribeData=o.data});return}}),{router:i,props:n,state:t}}},z=n=>(pe("data-v-5024c2ce"),n=n(),ge(),n),us={key:0},hs=z(()=>c("div",{class:"row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold"},[c("p",null,"詳細資訊")],-1)),ms={class:"row mx-0 align-items-center p-2 position-relative"},ps={class:"d-flex flex-nowrap align-items-center justify-content-between my-2"},gs={class:""},fs={href:"#"},ys=z(()=>c("img",{src:cs,alt:""},null,-1)),_s={class:"border-bottom row flex-nowrap p-2 my-3 cursor-pointer mx-0"},Cs={key:0,class:"py-2 px-4"},vs={class:"d-flex flex-wrap justify-content-between"},bs={class:"w-50 mb-4"},ws={class:"mb-0"},Ls=["src"],Ss={key:1,class:"py-2 px-4"},xs=z(()=>c("div",null,"尚無影片",-1)),Ts=[xs],Ms={key:1},ks={class:"row mx-0 align-items-center px-2 py-4 position-relative"},Es={key:0,class:"row mx-0 mb-2"},Is=z(()=>c("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"事件:",-1)),Rs={class:"col-8 py-1 px-2 bg-grey-light text-start"},Ps={key:1,class:"row mx-0 mb-2"},Os=z(()=>c("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"發生時間:",-1)),Ds={class:"col-8 py-1 px-2 bg-grey-light text-start"},As={key:2,class:"row mx-0 mb-2"},Fs=z(()=>c("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"鄉鎮: ",-1)),Vs={class:"col-8 py-1 px-2 bg-grey-light text-start"},Ns={key:3,class:"row mx-0 mb-2"},Bs=z(()=>c("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"地方: ",-1)),Gs={class:"col-8 py-1 px-2 bg-grey-light text-start"},Ws={key:4,class:"row mx-0 mb-2"},js=z(()=>c("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"村落: ",-1)),Hs={class:"col-8 py-1 px-2 bg-grey-light text-start"},$s={key:5,class:"row mx-0 mb-2"},zs=z(()=>c("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"災害種類: ",-1)),Us={class:"col-8 py-1 px-2 bg-grey-light text-start"},Ks={key:6,class:"row mx-0 mb-2"},qs=z(()=>c("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"描述: ",-1)),Ys={class:"col-8 py-1 px-2 bg-grey-light text-start"};function Zs(n,e,i,t,s,r){var a,l,u,d,m,h,f,y,S,g,L,D,v,p,b,w,I,T,P,H,U;const o=ls;return _(),C("div",{class:"bg-white rounded py-2",style:Me([{"overflow-y":"auto"},{"max-height":t.props.maxHeight+"px",width:"480px"}])},[t.state.type===1?(_(),C("div",us,[hs,V(o,{coordinate:t.props.popup.coordinate,type:t.state.type},null,8,["coordinate","type"]),c("div",ms,[c("div",ps,[c("span",gs,k((u=(l=(a=t.state)==null?void 0:a.tribeData)==null?void 0:l.basicInformation)==null?void 0:u.tribeName),1),c("div",{class:"p-2 bg-steel w-auto text-white d-inline-block rounded-2 cursor-pointer",onClick:e[0]||(e[0]=()=>{t.router.push({path:`/Map_Demo/mapDetails/${t.props.popup.popupId}`})})},"更多資訊")]),c("p",null,"描述: "+k((h=(m=(d=t.state)==null?void 0:d.tribeData)==null?void 0:m.basicInformation)==null?void 0:h.description),1),c("p",null,k((S=(y=(f=t.state)==null?void 0:f.tribeData)==null?void 0:y.basicInformation)==null?void 0:S.area),1),c("a",fs,[ys,me(" "+k((p=(v=(D=(L=(g=t.state)==null?void 0:g.tribeData)==null?void 0:L.basicInformation)==null?void 0:D.coordinates)==null?void 0:v.WGS84)==null?void 0:p.lat)+" , "+k((P=(T=(I=(w=(b=t.state)==null?void 0:b.tribeData)==null?void 0:w.basicInformation)==null?void 0:I.coordinates)==null?void 0:T.WGS84)==null?void 0:P.lng),1)])]),c("div",null,[c("div",_s,[c("div",{class:"col-6 cursor-pointer",onClick:e[1]||(e[1]=G=>t.state.media="photo")},"相片"),c("div",{class:"col-6 cursor-pointer",onClick:e[2]||(e[2]=G=>t.state.media="video")},"影片")]),t.state.media==="photo"?(_(),C("div",Cs,[c("div",vs,[(_(!0),C(q,null,Y((U=(H=t.state)==null?void 0:H.tribeData)==null?void 0:U.culturalLandscape,G=>(_(),C("div",bs,[c("p",ws,k(G.name),1),c("img",{src:G.image,alt:"",class:"w-100"},null,8,Ls)]))),256))])])):M("",!0),t.state.media==="video"?(_(),C("div",Ss,Ts)):M("",!0)])])):M("",!0),t.state.type===2?(_(),C("div",Ms,[c("div",ks,[t.state.tribeData.event?(_(),C("div",Es,[Is,c("div",Rs,k(t.state.tribeData.event),1)])):M("",!0),t.state.tribeData.date?(_(),C("div",Ps,[Os,c("div",Ds,k(t.state.tribeData.date),1)])):M("",!0),t.state.tribeData.township?(_(),C("div",As,[Fs,c("div",Vs,k(t.state.tribeData.township),1)])):M("",!0),t.state.tribeData.village?(_(),C("div",Ns,[Bs,c("div",Gs,k(t.state.tribeData.village),1)])):M("",!0),t.state.tribeData.place?(_(),C("div",Ws,[js,c("div",Hs,k(t.state.tribeData.place),1)])):M("",!0),t.state.tribeData.category?(_(),C("div",$s,[zs,c("div",Us,k(t.state.tribeData.category),1)])):M("",!0),t.state.tribeData.description?(_(),C("div",Ks,[qs,c("div",Ys,k(t.state.tribeData.description),1)])):M("",!0)])])):M("",!0)],4)}const Qs=$(ds,[["render",Zs],["__scopeId","data-v-5024c2ce"]]),xt="/Map_Demo/assets/logo-83a41ce3.svg",Xs="/Map_Demo/assets/2D-m-0cdbc246.svg",Js="/Map_Demo/assets/3D-m-4ecf18c0.svg",en="/Map_Demo/assets/vector-m-1fc5cf13.svg",tn="/Map_Demo/assets/selectVector-m-e4f4d97a.svg",sn="/Map_Demo/assets/singleWindow-m-4635df1a.svg",nn="/Map_Demo/assets/doubleWindow-m-cccef2df.svg";const on={props:{currentLayers:{type:Array,default:[]},mapCount:{type:Number,default:1},dimensionMapStatus:{type:Boolean,default:!1},openConditionWrap:{type:Function,default:()=>{}},openLayerSelect:{type:Function,default:()=>{}},onLayerControl:{type:Function,default:()=>{}},onChangeTarget:{type:Function,default:()=>{}}},setup(n,{emit:e}){const i=Q({toolSwitch:{threeDimensionalBtn:!1,layerConditionBtn:!1,splitWindowBtn:!1},targetNum:1});function t(o,a){Object.keys(i.toolSwitch).forEach(l=>{l===o?i.toolSwitch[o]?i.toolSwitch[o]=!1:i.toolSwitch[o]=!0:i.toolSwitch[l]=!1})}function s(o,a){o==="changeMapCount"&&(i.toolSwitch.splitWindowBtn=!1),n.onLayerControl({action:o,value:a})}function r(){e("conditionWrap")}return{props:n,state:i,toolSwitch:t,onLayerControl:s,conditionWrap:r}}},rn={class:"w-100"},an={class:"position-fixed top-0 w-100 d-flex justify-content-end flex-wrap"},ln=c("img",{src:xt,class:"w-100"},null,-1),cn={class:"switchControl me-2 d-block rounded-4 p-2",id:"switchControl",style:{"z-index":"99"}},dn={class:"list-unstyled d-flex align-items-center justify-content-around py-2 flex-nowrap w-100 bg-white mb-0"},un=c("img",{src:Xs},null,-1),hn=[un],mn=c("img",{src:Js},null,-1),pn=[mn],gn=c("img",{src:en},null,-1),fn=[gn],yn=c("img",{src:tn},null,-1),_n=[yn],Cn={class:"text-white"},vn=c("img",{src:sn},null,-1),bn=[vn],wn=c("img",{src:nn},null,-1),Ln=[wn];function Sn(n,e,i,t,s,r){return _(),C("div",rn,[c("div",an,[ln,c("div",cn,[c("div",{class:j(["text-white rounded-pill",{active:t.state.targetNum===1}]),onClick:e[0]||(e[0]=()=>{t.state.targetNum=1,t.props.onChangeTarget(1)})},"上",2),c("div",{class:j(["text-white rounded-pill",{active:t.state.targetNum===2}]),onClick:e[1]||(e[1]=()=>{t.state.targetNum=2,t.props.onChangeTarget(2)})},"下",2)])]),c("ul",dn,[c("li",null,[c("div",null,[t.props.dimensionMapStatus?(_(),C("div",{key:0,class:"navbarBtn",onClick:e[2]||(e[2]=E(o=>(t.toolSwitch("threeDimensionalBtn"),t.onLayerControl("changeDimensionMap","3D")),["prevent"]))},hn)):(_(),C("div",{key:1,class:"navbarBtn",onClick:e[3]||(e[3]=E(o=>(t.toolSwitch("threeDimensionalBtn"),t.onLayerControl("changeDimensionMap","2D")),["prevent"]))},pn))])]),c("li",null,[c("div",{class:"navbarBtn",onClick:e[4]||(e[4]=o=>t.props.openConditionWrap())},fn)]),c("li",null,[c("div",{class:"navbarBtn",onClick:e[5]||(e[5]=o=>t.props.openLayerSelect())},_n)]),c("li",null,[c("div",Cn,[t.props.mapCount===1?(_(),C("div",{key:0,class:"navbarBtn",onClick:e[6]||(e[6]=E(o=>t.props.onLayerControl({action:"changeMapCount",value:{qty:2}}),["prevent"]))},bn)):M("",!0),t.props.mapCount===2?(_(),C("div",{key:1,class:"navbarBtn",onClick:e[7]||(e[7]=E(o=>t.props.onLayerControl({action:"changeMapCount",value:{qty:1}}),["prevent"]))},Ln)):M("",!0)])])])])}const xn=$(on,[["render",Sn]]);const Tn={props:{onClose:{type:Function,default:()=>{}},onDeleteLayer:{type:Function,default:()=>{}},onLockLayer:{type:Function,default:()=>{}},currentLayers:{type:Array,default:[]},selectLock:{type:Boolean,default:!1},onLayerControl:{type:Function,default:()=>{}}},setup(n,{emit:e}){const i=Q({});function t(s){n.onLayerControl({action:"setOpacity",value:{key:s.target.getAttribute("nodeindex"),value:s.target.value}});const r=parseFloat(Number(s.target.value));document.getElementById(`opacityControl${s.target.getAttribute("nodeindex")}`).innerText=r.toFixed(2)}return{props:n,state:i,updateOpacity:t}}},ee=n=>(pe("data-v-8cce132a"),n=n(),ge(),n),Mn={class:"layerSelect bg-white"},kn={class:"row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold"},En=ee(()=>c("p",{class:"mb-0 fs-5"},"已選擇的圖層",-1)),In=ee(()=>c("hr",{class:"my-0"},null,-1)),Rn={class:"py-3 px-4 content"},Pn={class:"allControl d-flex align-items-center justify-content-end mb-0"},On=ee(()=>c("svg",{viewBox:"0 0 25 24",fill:"currentColor"},[c("path",{d:"M8.02381 9.33333H14.881V7.80952C14.881 7.1746 14.6587 6.63492 14.2143 6.19048C13.7698 5.74603 13.2302 5.52381 12.5952 5.52381C11.9603 5.52381 11.4206 5.74603 10.9762 6.19048C10.5317 6.63492 10.3095 7.1746 10.3095 7.80952H8.78571C8.78571 6.75556 9.15727 5.85702 9.90038 5.1139C10.643 4.3713 11.5413 4 12.5952 4C13.6492 4 14.5477 4.3713 15.2909 5.1139C16.0335 5.85702 16.4048 6.75556 16.4048 7.80952V9.33333H17.1667C17.5857 9.33333 17.9446 9.48241 18.2432 9.78057C18.5414 10.0792 18.6905 10.4381 18.6905 10.8571V18.4762C18.6905 18.8952 18.5414 19.2541 18.2432 19.5528C17.9446 19.8509 17.5857 20 17.1667 20H8.02381C7.60476 20 7.24616 19.8509 6.948 19.5528C6.64933 19.2541 6.5 18.8952 6.5 18.4762V10.8571C6.5 10.4381 6.64933 10.0792 6.948 9.78057C7.24616 9.48241 7.60476 9.33333 8.02381 9.33333ZM12.5952 16.1905C13.0143 16.1905 13.3731 16.0414 13.6718 15.7432C13.97 15.4446 14.119 15.0857 14.119 14.6667C14.119 14.2476 13.97 13.8888 13.6718 13.5901C13.3731 13.2919 13.0143 13.1429 12.5952 13.1429C12.1762 13.1429 11.8176 13.2919 11.5194 13.5901C11.2208 13.8888 11.0714 14.2476 11.0714 14.6667C11.0714 15.0857 11.2208 15.4446 11.5194 15.7432C11.8176 16.0414 12.1762 16.1905 12.5952 16.1905Z"})],-1)),Dn=ee(()=>c("svg",{viewBox:"0 0 25 24",fill:"currentColor"},[c("path",{d:"M7.5 21C6.95 21 6.47933 20.8043 6.088 20.413C5.696 20.021 5.5 19.55 5.5 19V6H4.5V4H9.5V3H15.5V4H20.5V6H19.5V19C19.5 19.55 19.3043 20.021 18.913 20.413C18.521 20.8043 18.05 21 17.5 21H7.5ZM9.5 17H11.5V8H9.5V17ZM13.5 17H15.5V8H13.5V17Z"})],-1)),An={class:"list-unstyled d-flex flex-wrap flex-column-reverse"},Fn={key:0,class:"d-flex justify-content-between align-items-center border-bottom py-2 flex-wrap"},Vn={class:"tool"},Nn=["onClick"],Bn=ee(()=>c("svg",{viewBox:"0 0 25 24",fill:"currentColor"},[c("path",{d:"M9.49991 19.84H15.4999V11.84H20.3399L12.4999 4.00003L4.65991 11.84H9.49991V19.84Z",fill:"#808080"})],-1)),Gn=[Bn],Wn=["onClick"],jn=ee(()=>c("svg",{viewBox:"0 0 25 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[c("path",{d:"M9.49991 4H15.4999V12H20.3399L12.4999 19.84L4.65991 12H9.49991V4Z",fill:"#808080"})],-1)),Hn=[jn],$n=["onClick"],zn=ee(()=>c("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[c("path",{d:"M12.3333 10C11.8029 10 11.2942 10.2107 10.9191 10.5858C10.544 10.9609 10.3333 11.4696 10.3333 12C10.3333 12.5304 10.544 13.0391 10.9191 13.4142C11.2942 13.7893 11.8029 14 12.3333 14C12.8638 14 13.3725 13.7893 13.7475 13.4142C14.1226 13.0391 14.3333 12.5304 14.3333 12C14.3333 11.4696 14.1226 10.9609 13.7475 10.5858C13.3725 10.2107 12.8638 10 12.3333 10ZM12.3333 15.3333C11.4493 15.3333 10.6014 14.9821 9.97631 14.357C9.35119 13.7319 9 12.8841 9 12C9 11.1159 9.35119 10.2681 9.97631 9.64298C10.6014 9.01786 11.4493 8.66667 12.3333 8.66667C13.2174 8.66667 14.0652 9.01786 14.6904 9.64298C15.3155 10.2681 15.6667 11.1159 15.6667 12C15.6667 12.8841 15.3155 13.7319 14.6904 14.357C14.0652 14.9821 13.2174 15.3333 12.3333 15.3333ZM12.3333 7C9 7 6.15333 9.07333 5 12C6.15333 14.9267 9 17 12.3333 17C15.6667 17 18.5133 14.9267 19.6667 12C18.5133 9.07333 15.6667 7 12.3333 7Z",fill:"#808080"})],-1)),Un=[zn],Kn=["onClick"],qn=ee(()=>c("svg",{viewBox:"0 0 25 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[c("path",{d:"M7.5 21C6.95 21 6.47933 20.8043 6.088 20.413C5.696 20.021 5.5 19.55 5.5 19V6H4.5V4H9.5V3H15.5V4H20.5V6H19.5V19C19.5 19.55 19.3043 20.021 18.913 20.413C18.521 20.8043 18.05 21 17.5 21H7.5ZM9.5 17H11.5V8H9.5V17ZM13.5 17H15.5V8H13.5V17Z",fill:"#808080"})],-1)),Yn=[qn],Zn={class:"w-100 mt-2 d-flex align-items-center"},Qn=["nodeIndex"],Xn=["id"];function Jn(n,e,i,t,s,r){return _(),C("div",Mn,[c("div",kn,[En,c("a",{href:"#",class:"closeBtn bg-dark text-decoration-none rounded-circle position-absolute d-flex align-items-center justify-content-center",onClick:e[0]||(e[0]=E((...o)=>t.props.onClose&&t.props.onClose(...o),["prevent"]))})]),In,c("div",Rn,[c("div",Pn,[c("a",{href:"",class:j(["d-flex align-items-center text-decoration-none me-4",{lockUp:t.props.selectLock,unlock:!t.props.selectLock}]),onClick:e[1]||(e[1]=E(()=>{t.props.onLockLayer()},["prevent"]))},[On,me(" 鎖定圖層 ")],2),c("a",{href:"",class:j(["d-flex align-items-center text-decoration-none",{disabled:t.props.currentLayers.length<=1}]),onClick:e[2]||(e[2]=E(()=>{t.props.currentLayers.length>0&&t.props.onDeleteLayer({action:"selectLayerMode",value:{layerName:"all"}})},["prevent"]))},[Dn,me(" 全部刪除 ")],2)]),c("ul",An,[(_(!0),C(q,null,Y(t.props.currentLayers,(o,a)=>(_(),C("li",null,[o.id?(_(),C("div",Fn,[c("div",null,k(o==null?void 0:o.label),1),c("div",Vn,[c("a",{href:"",onClick:E(l=>t.props.onLayerControl({action:"changeOrder",value:{movement:"up",id:o.id,key:a}}),["prevent"])},Gn,8,Nn),c("a",{href:"",onClick:E(l=>t.props.onLayerControl({action:"changeOrder",value:{movement:"down",id:o.id,key:a}}),["prevent"])},Hn,8,Wn),c("a",{href:"",class:j({Invisible:!(o!=null&&o.visible)}),onClick:E(()=>{t.props.onLayerControl({action:"changeLayerVisible",value:{key:a}})},["prevent"])},Un,10,$n),c("a",{href:"",onClick:E(l=>t.props.onDeleteLayer({action:"selectLayerMode",value:{id:o==null?void 0:o.id}}),["prevent"])},Yn,8,Kn)]),c("label",Zn,[c("input",{id:"opacity-input",class:"w-75 me-2",type:"range",min:"0",max:"1",step:"0.01",value:"1",nodeIndex:a,onInput:e[3]||(e[3]=(...l)=>t.updateOpacity&&t.updateOpacity(...l))},null,40,Qn),c("span",{id:`opacityControl${a}`},"1",8,Xn)])])):M("",!0)]))),256))])])])}const eo=$(Tn,[["render",Jn],["__scopeId","data-v-8cce132a"]]);const to={props:{text:{type:String,default:"測試"},styles:{type:String,default:""},status:{type:Boolean,default:!0}},setup(n,{emit:e}){const i=pt(),t=ai,s=ri(null),r=Q({overLayerHeight:re(()=>{var a;return((a=s==null?void 0:s.value)==null?void 0:a.offsetHeight)+10}),overLayerWidth:re(()=>{var a;return((a=s==null?void 0:s.value)==null?void 0:a.offsetWidth)+10}),accordionListRef:null,accordionListRefHeight:re(()=>{var a;return(a=r.accordionListRef)==null?void 0:a.offsetHeight}),accordionListRefWidth:re(()=>{var a;return(a=r.accordionListRef)==null?void 0:a.offsetWidth})});function o(a){console.log(J(".initOverLay").parent()),console.log(r.accordionListRefHeight),console.log(r.accordionListRefWidth)}return Ie(()=>{J(".initOverLay").parent().addClass("position-relative")}),{state:r,props:n,store:i,route:t,overLayCom:s,showClick:o}}};function io(n,e,i,t,s,r){return t.store.state.isInit?(_(),C("div",{key:0,class:"initOverLay",onClick:e[0]||(e[0]=o=>t.store.dispatch("updateLayerStatus",!1)),style:Me({height:t.state.overLayerHeight+"px",width:t.state.overLayerWidth+"px"}),ref:o=>{t.state.accordionListRef=o}},[c("div",{class:"tipText text-white fw-bold fs-3",style:Me(t.props.styles)},k(t.props.text),5)],4)):M("",!0)}const Pe=$(to,[["render",io]]);let de=[];const we={getBaseMapData:n=>{let e;return Number.isInteger(n)?e=de[n]:e=n.layer,new je({preload:1/0,name:e.name,label:e.label,type:e.mapType,baseId:e.baseId,source:new dt({url:e.url}),crossOrigin:"anonymous"})},setBaseMapData:n=>{de=n},getCurrentBase:()=>de.filter(n=>n.onCurrent),showBaseMapData:()=>{console.log(de)}};function so(){return de}const no={props:{onClose:{type:Function,default:()=>{}},mapLayers:{type:Array,default:[]},currentLayers:{type:Array,default:[]},showSelectLayerValue:{type:Function,default:()=>{}},selectLayerOption:{type:Object,default:{}},tribeQuery:{type:Object,default:{}},moveToMap:{type:Function,default:()=>{}}},setup(n,{emit:e}){const i=xe,t=mt(),s=Q({DropDown:null,TilesListValue:0,conditionYear:"",conditionTown:"",selectLayerOption:[]});function r(h,f){e("onLayerControl",{action:h,value:f})}function o(h){s.DropDown!==h?s.DropDown=h:s.DropDown=null}function a(h,f){let y=h.target.checked||typeof h.target.checked==" ";r("layerMode",{checked:y,nodeIndex:f.nodeIndex,subNodeIndex:f.subNodeIndex,nestedSubNodeIndex:String(f.nestedSubNodeIndex)?f.nestedSubNodeIndex:void 0,id:f.single_tiles||!h.target.selectedOptions?f.id:h.target.selectedOptions[0].id})}function l(h){s.conditionYear=h.target.value,d()}function u(h){s.conditionTown=h.target.value,d()}async function d(){const h=await J.ajax(`https://api.edtest.site/tribes?${"years="+s.conditionYear}&${"township="+s.conditionTown}`,"GET");s.selectLayerOption=h}function m(h){let f=s.selectLayerOption.find(y=>y.tribeCode===h.target.value);n.moveToMap(f.coordinates)}return ht(()=>s.TilesListValue,(h,f)=>{n.showSelectLayerValue(h)}),{props:n,state:s,router:t,mapList:i,onLayerControl:r,openLayerList:o,LayerCheckBoxChange:a,tribeYear:l,tribeTown:u,moveMap:m}}},Tt=n=>(pe("data-v-a7e20171"),n=n(),ge(),n),oo={class:"condition bg-white"},ro={class:"row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold border-bottom"},ao=Tt(()=>c("p",{class:"mb-0 fs-5"},"圖層選項",-1)),lo={class:"py-3 px-4 content"},co={class:"mb-2 landBoundary"},uo={class:"mb-2"},ho=["onClick"],mo=Tt(()=>c("path",{fill:"currentColor",d:"M8 5v14l11-7z"},null,-1)),po=[mo],go={class:"ms-3 mb-1"},fo={key:0},yo=["checked","onChange"],_o={key:0},Co={key:0},vo=["value"],bo=["value"],wo=["value"],Lo={key:1},So=["checked","onChange"],xo=["onChange"],To=["value","id"];function Mo(n,e,i,t,s,r){return _(),C("div",oo,[c("div",ro,[ao,c("a",{href:"#",class:"closeBtn bg-dark text-decoration-none rounded-circle position-absolute d-flex align-items-center justify-content-center",onClick:e[0]||(e[0]=E((...o)=>t.props.onClose&&t.props.onClose(...o),["prevent"]))})]),c("div",lo,[c("div",co,[(_(!0),C(q,null,Y(t.props.mapLayers,(o,a)=>(_(),C("div",uo,[c("div",{class:"title d-flex align-items-center fw-bold text-black order-1 mb-1 text-decoration-none",onClick:l=>t.openLayerList(a)},[c("div",{class:j(o.groupClass)},null,2),c("div",null,k(o.label),1),(_(),C("svg",{viewBox:"0 0 24 24",class:j({openTitle:t.state.DropDown==a})},po,2))],8,ho),t.state.DropDown==a?(_(!0),C(q,{key:0},Y(o.layers,(l,u)=>(_(),C("div",go,[l.single_tiles?(_(),C("div",fo,[c("input",{type:"checkbox",checked:t.props.currentLayers.some(d=>d.id===l.id),onChange:d=>{t.LayerCheckBoxChange(d,{nodeIndex:a,subNode:l,subNodeIndex:u,nestedSubNodeIndex:"",single_tiles:l.single_tiles,id:l.id})}},null,40,yo),me(" "+k(l.title)+" ",1),(_(),C("div",_o,[l.id==="node4_subNode0_nestedSubNodeundefined"?(_(),C("div",Co,[t.props.tribeQuery.years!==void 0?(_(),C("select",{key:0,class:"me-2",onChange:e[1]||(e[1]=(...d)=>t.tribeYear&&t.tribeYear(...d)),placeholder:"請選擇年度"},[(_(!0),C(q,null,Y(t.props.tribeQuery.years,(d,m)=>(_(),C("option",{value:d},k(d),9,vo))),256))],32)):M("",!0),t.props.tribeQuery.township!==void 0?(_(),C("select",{key:1,class:"me-2",onChange:e[2]||(e[2]=(...d)=>t.tribeTown&&t.tribeTown(...d)),placeholder:"請選擇鄉鎮"},[(_(!0),C(q,null,Y(t.props.tribeQuery.township,(d,m)=>(_(),C("option",{value:d},k(d),9,bo))),256))],32)):M("",!0),t.state.selectLayerOption.length!==0?(_(),C("select",{key:2,class:"me-2",onChange:e[3]||(e[3]=(...d)=>t.moveMap&&t.moveMap(...d))},[(_(!0),C(q,null,Y(t.state.selectLayerOption,(d,m)=>(_(),C("option",{value:d.tribeCode},k(d.tribeName),9,wo))),256))],32)):M("",!0)])):M("",!0)]))])):(_(),C("div",Lo,[c("input",{type:"checkbox",checked:t.props.currentLayers.some(d=>{let m=t.mapList.getLayerIndex(d.id);return m.nodeIndex==a&&m.subNodeIndex==u}),onChange:d=>{t.LayerCheckBoxChange(d,{nodeIndex:a,subNode:l,subNodeIndex:u,nestedSubNodeIndex:"",single_tiles:l.single_tiles,id:l.id})}},null,40,So),me(" "+k(l.title)+" ",1),gt(c("select",{name:"",id:"",class:"ms-3","onUpdate:modelValue":e[4]||(e[4]=d=>t.state.TilesListValue=d),onChange:d=>{t.LayerCheckBoxChange(d,{nodeIndex:a,subNode:l,subNodeIndex:u,nestedSubNodeIndex:t.state.TilesListValue,single_tiles:l.single_tiles,id:l.id})}},[(_(!0),C(q,null,Y(l.tiles_list,(d,m)=>(_(),C("option",{value:m,id:d.id},k(d.title),9,To))),256))],40,xo),[[ft,t.state.TilesListValue]])]))]))),256)):M("",!0)]))),256))])])])}const ko=$(no,[["render",Mo],["__scopeId","data-v-a7e20171"]]),Eo="/Map_Demo/assets/2D-70e1bbad.svg",Io="/Map_Demo/assets/3D-cb71f302.svg",Ro="/Map_Demo/assets/baseLayer-3608307c.svg",Mt="/Map_Demo/assets/singleWindow-1afc73e5.svg",kt="/Map_Demo/assets/doubleWindows-82f012fb.svg";const Po={props:{currentLayers:{type:Array,default:[]},mapCount:{type:Number,default:1},dimensionMapStatus:{type:Boolean,default:!1}},setup(n,{emit:e}){const i=Q({toolSwitch:{threeDimensionalBtn:!1,layerConditionBtn:!1,splitWindowBtn:!1},targetNum:1});function t(a,l){Object.keys(i.toolSwitch).forEach(u=>{u===a?i.toolSwitch[a]?i.toolSwitch[a]=!1:i.toolSwitch[a]=!0:i.toolSwitch[u]=!1})}function s(a,l){a==="changeMapCount"&&(i.toolSwitch.splitWindowBtn=!1),e("onLayerControl",{action:a,value:l})}function r(){e("conditionWrap")}function o(a){i.targetNum=a,e("onChangeTarget",a)}return{props:n,state:i,toolSwitch:t,onLayerControl:s,conditionWrap:r,onChangeTarget:o}}},fe=n=>(pe("data-v-2a7e9986"),n=n(),ge(),n),Oo={class:"list-unstyled d-inline-flex align-items-center flex-nowrap w-full"},Do={class:"me-4 position-relative"},Ao={class:"MapFeatureBtn text-white"},Fo=fe(()=>c("img",{src:Eo},null,-1)),Vo=[Fo],No=fe(()=>c("img",{src:Io},null,-1)),Bo=[No],Go={class:"me-4 position-relative"},Wo=fe(()=>c("img",{src:Ro,alt:""},null,-1)),jo=[Wo],Ho={class:"position-relative"},$o={key:0,src:Mt,alt:""},zo={key:1,src:kt,alt:""},Uo={key:0,class:"list-unstyled position-absolute start-0 top-100 p-0"},Ko={class:"mt-2"},qo=fe(()=>c("img",{src:Mt,alt:""},null,-1)),Yo=[qo],Zo={class:"mt-2"},Qo=fe(()=>c("img",{src:kt,alt:""},null,-1)),Xo=[Qo],Jo={class:"switchControl d-flex position-fixed rounded-pill translate-middle-x p-2",id:"switchControl",style:{"z-index":"99"}};function er(n,e,i,t,s,r){const o=Pe;return _(),C("div",null,[c("ul",Oo,[V(o,{text:"圖層操控工具"}),c("li",Do,[c("div",Ao,[t.props.dimensionMapStatus?(_(),C("a",{key:0,href:"",onClick:e[0]||(e[0]=E(a=>(t.toolSwitch("threeDimensionalBtn"),t.onLayerControl("changeDimensionMap","3D")),["prevent"]))},Vo)):(_(),C("a",{key:1,href:"",onClick:e[1]||(e[1]=E(a=>(t.toolSwitch("threeDimensionalBtn"),t.onLayerControl("changeDimensionMap","2D")),["prevent"]))},Bo))])]),c("li",Go,[c("a",{href:"",class:"MapFeatureBtn text-white",onClick:e[2]||(e[2]=E(a=>(t.toolSwitch("layerConditionBtn"),t.conditionWrap()),["prevent"]))},jo)]),c("li",Ho,[c("a",{href:"",class:"MapFeatureBtn text-white",onClick:e[3]||(e[3]=E(a=>t.toolSwitch("splitWindowBtn"),["prevent"]))},[t.props.mapCount===1?(_(),C("img",$o)):M("",!0),t.props.mapCount===2?(_(),C("img",zo)):M("",!0)]),t.state.toolSwitch.splitWindowBtn?(_(),C("ul",Uo,[c("li",Ko,[c("a",{href:"",class:"text-white MapFeatureBtn",onClick:e[4]||(e[4]=E(a=>t.onLayerControl("changeMapCount",{qty:1}),["prevent"]))},Yo)]),c("li",Zo,[c("a",{href:"",class:"text-white MapFeatureBtn",onClick:e[5]||(e[5]=E(a=>t.onLayerControl("changeMapCount",{qty:2}),["prevent"]))},Xo)])])):M("",!0)])]),c("div",Jo,[V(o,{text:"左右視窗切換工具"}),c("div",{class:j(["fs-3 text-white rounded-pill",{active:t.state.targetNum===1}]),onClick:e[6]||(e[6]=()=>{t.onChangeTarget(1)})},"左",2),c("div",{class:j(["fs-3 text-white rounded-pill",{active:t.state.targetNum===2}]),onClick:e[7]||(e[7]=()=>{t.onChangeTarget(2)})},"右",2)])])}const tr=$(Po,[["render",er],["__scopeId","data-v-2a7e9986"]]);const ir={props:{baseMapList:{type:Array,default:[]},onChangeBaseMaps:{type:Function,default:()=>{}}},setup(n,{emit:e}){const i=Q({selectMap:0,mapSourceList:[]});function t(){let s="baseMap",r=n.baseMapList.find(o=>o.baseId===i.selectMap);n.onChangeBaseMaps({action:s,value:r})}return{state:i,props:n,onChangeBaseMaps:t}}},sr=["value"];function nr(n,e,i,t,s,r){const o=Pe;return _(),C("div",null,[V(o,{text:"底圖切換工具"}),gt(c("select",{name:"",id:"","onUpdate:modelValue":e[0]||(e[0]=a=>t.state.selectMap=a),onChange:e[1]||(e[1]=a=>{t.onChangeBaseMaps(a)})},[(_(!0),C(q,null,Y(t.props.baseMapList,(a,l)=>(_(),C("option",{key:l,value:a.baseId},k(a.label),9,sr))),128))],544),[[ft,t.state.selectMap]])])}const or=$(ir,[["render",nr],["__scopeId","data-v-cebf3faa"]]),rr="/Map_Demo/assets/zoomIn-c80b5dd3.svg",ar="/Map_Demo/assets/zoomOut-88993246.svg",lr="/Map_Demo/assets/compass-1c1efd7a.svg",cr="/Map_Demo/assets/location-b52d62b2.svg",dr="/Map_Demo/assets/zoom-8acdf5b3.svg",ur={props:{id:{Type:String,default:0},map:{}},setup(n,{emit:e}){function i(t){e("onMapControl",{action:t})}return{props:n,onMapControl:i}}},hr={class:"d-flex flex-nowrap flex-column"},mr=c("img",{src:rr,alt:"zoomIn"},null,-1),pr=[mr],gr=c("img",{src:ar,alt:"zoomOut"},null,-1),fr=[gr],yr=c("img",{src:lr,alt:"compass"},null,-1),_r=[yr],Cr=c("img",{src:cr,alt:"location"},null,-1),vr=[Cr],br=c("img",{src:dr,alt:"zoom"},null,-1),wr=[br];function Lr(n,e,i,t,s,r){const o=Pe;return _(),C("div",hr,[V(o,{text:"地圖操控工具"}),c("a",{href:"#",class:"d-none d-sm-block order-1 mb-0",onClick:e[0]||(e[0]=E(a=>t.onMapControl("In"),["prevent"]))},pr),c("a",{href:"#",class:"d-none d-sm-block order-1 mb-2",onClick:e[1]||(e[1]=E(a=>t.onMapControl("Out"),["prevent"]))},fr),c("a",{href:"#",class:"order-1 mb-2",onClick:e[2]||(e[2]=E(a=>t.onMapControl("toNorth"),["prevent"]))},_r),c("a",{href:"#",class:"order-1 mb-2",onClick:e[3]||(e[3]=E(a=>t.onMapControl("moveTo"),["prevent"]))},vr),c("a",{href:"#",class:"order-1",onClick:e[4]||(e[4]=E(a=>t.onMapControl("fullScreen"),["prevent"]))},wr)])}const Sr=$(ur,[["render",Lr]]),Fe="units",xr=[1,2,5],le=25.4/.28;class Tr extends Ht{constructor(e){e=e||{};const i=document.createElement("div");i.style.pointerEvents="none",super({element:i,render:e.render,target:e.target}),this.on,this.once,this.un;const t=e.className!==void 0?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=t+"-inner",this.element.className=t+" "+$t,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth!==void 0?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(Fe,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(Fe)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(Fe,e)}setDpi(e){this.dpi_=e}updateElement_(){const e=this.viewState_;if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const i=e.center,t=e.projection,s=this.getUnits(),r=s=="degrees"?"degrees":"m";let o=qe(t,e.resolution,i,r);const a=this.minWidth_*(this.dpi_||le)/le,l=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||le)/le:void 0;let u=a*o,d="";if(s=="degrees"){const v=zt.degrees;u*=v,u<v/60?(d="″",o*=3600):u<v?(d="′",o*=60):d="°"}else s=="imperial"?u<.9144?(d="in",o/=.0254):u<1609.344?(d="ft",o/=.3048):(d="mi",o/=1609.344):s=="nautical"?(o/=1852,d="NM"):s=="metric"?u<.001?(d="μm",o*=1e6):u<1?(d="mm",o*=1e3):u<1e3?d="m":(d="km",o/=1e3):s=="us"?u<.9144?(d="in",o*=39.37):u<1609.344?(d="ft",o/=.30480061):(d="mi",o/=1609.3472):rt(!1,33);let m=3*Math.floor(Math.log(a*o)/Math.log(10)),h,f,y,S,g,L;for(;;){y=Math.floor(m/3);const v=Math.pow(10,y);if(h=xr[(m%3+3)%3]*v,f=Math.round(h/o),isNaN(f)){this.element.style.display="none",this.renderedVisible_=!1;return}if(l!==void 0&&f>=l){h=S,f=g,y=L;break}else if(f>=a)break;S=h,g=f,L=y,++m}const D=this.scaleBar_?this.createScaleBar(f,h,d):h.toFixed(y<0?-y:0)+" "+d;this.renderedHTML_!=D&&(this.innerElement_.innerHTML=D,this.renderedHTML_=D),this.renderedWidth_!=f&&(this.innerElement_.style.width=f+"px",this.renderedWidth_=f),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,i,t){const s=this.getScaleForResolution(),r=s<1?Math.round(1/s).toLocaleString()+" : 1":"1 : "+Math.round(s).toLocaleString(),o=this.scaleBarSteps_,a=e/o,l=[this.createMarker("absolute")];for(let d=0;d<o;++d){const m=d%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";l.push(`<div><div class="ol-scale-singlebar ${m}" style="width: ${a}px;"></div>`+this.createMarker("relative")+(d%2===0||o===2?this.createStepText(d,e,!1,i,t):"")+"</div>")}return l.push(this.createStepText(o,e,!0,i,t)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+r+"</div>":"")+l.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e==="absolute"?3:-10}px;"></div>`}createStepText(e,i,t,s,r){const a=(e===0?0:Math.round(s/this.scaleBarSteps_*e*100)/100)+(e===0?"":" "+r),l=e===0?-3:i/this.scaleBarSteps_*-1,u=e===0?0:i/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${l}px;text-align: ${e===0?"left":"center"};min-width: ${u}px;left: ${t?i+"px":"unset"};">`+a+"</div>"}getScaleForResolution(){const e=qe(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),i=this.dpi_||le,t=1e3/25.4;return e*t*i}render(e){const i=e.frameState;i?this.viewState_=i.viewState:this.viewState_=null,this.updateElement_()}}const Mr=Tr;class kr{constructor(e){this.ol3d=e,this.scene_=e.getCesiumScene(),this.canvas_=this.scene_.canvas,this._boundNotifyRepaintRequired=this.notifyRepaintRequired.bind(this),this.repaintEventNames_=["mousemove","mousedown","mouseup","touchstart","touchend","touchmove","pointerdown","pointerup","pointermove","wheel"],this.enable()}enable(){this.scene_.requestRenderMode=!0,this.scene_.maximumRenderTimeChange=1e3;for(const e of this.repaintEventNames_)this.canvas_.addEventListener(e,this._boundNotifyRepaintRequired,!1);window.addEventListener("resize",this._boundNotifyRepaintRequired,!1),this.ol3d.getOlMap().getLayerGroup().on("change",this._boundNotifyRepaintRequired)}disable(){for(const e of this.repaintEventNames_)this.canvas_.removeEventListener(e,this._boundNotifyRepaintRequired,!1);window.removeEventListener("resize",this._boundNotifyRepaintRequired,!1),this.ol3d.getOlMap().getLayerGroup().un("change",this._boundNotifyRepaintRequired),this.scene_.requestRenderMode=!1}restartRenderLoop(){this.notifyRepaintRequired()}notifyRepaintRequired(){this.scene_.requestRender()}}function Le(n){return n*180/Math.PI}function ce(n){return n*Math.PI/180}class ae{constructor(e,i){this.scene_=e,this.cam_=e.camera,this.map_=i,this.view_=null,this.viewListenKey_=null,this.toLonLat_=ae.identityProjection,this.fromLonLat_=ae.identityProjection,this.tilt_=0,this.distance_=0,this.lastCameraViewMatrix_=null,this.viewUpdateInProgress_=!1,this.map_.on("change:view",t=>{this.setView_(this.map_.getView())}),this.setView_(this.map_.getView())}static identityProjection(e,i,t){const s=t||e.length;if(i)for(let r=0;r<s;++r)i[r]=e[r];return e}setView_(e){if(this.view_&&(X(this.viewListenKey_),this.viewListenKey_=null),this.view_=e,e){const i=Ve(e.getProjection(),"EPSG:4326"),t=Ve("EPSG:4326",e.getProjection());console.assert(i&&t),this.toLonLat_=i,this.fromLonLat_=t,this.viewListenKey_=e.on("propertychange",s=>this.handleViewEvent_(s)),this.readFromView()}else this.toLonLat_=ae.identityProjection,this.fromLonLat_=ae.identityProjection}handleViewEvent_(e){this.viewUpdateInProgress_||this.readFromView()}setHeading(e){this.view_&&this.view_.setRotation(e)}getHeading(){return this.view_?this.view_.getRotation()||0:void 0}setTilt(e){this.tilt_=e,this.updateCamera_()}getTilt(){return this.tilt_}setDistance(e){this.distance_=e,this.updateCamera_(),this.updateView()}getDistance(){return this.distance_}setCenter(e){this.view_&&this.view_.setCenter(e)}getCenter(){if(this.view_)return this.view_.getCenter()}setPosition(e){if(!this.toLonLat_)return;const i=this.toLonLat_(e);console.assert(i);const t=new Cesium.Cartographic(ce(i[0]),ce(i[1]),this.getAltitude());this.cam_.setView({destination:Cesium.Ellipsoid.WGS84.cartographicToCartesian(t)}),this.updateView()}getPosition(){if(!this.fromLonLat_)return;const e=Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position),i=this.fromLonLat_([Le(e.longitude),Le(e.latitude)]);return console.assert(i),i}setAltitude(e){const i=Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position);i.height=e,this.cam_.position=Cesium.Ellipsoid.WGS84.cartographicToCartesian(i),this.updateView()}getAltitude(){return Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position).height}updateCamera_(){if(!this.view_||!this.toLonLat_)return;const e=this.view_.getCenter();if(!e)return;const i=this.toLonLat_(e);console.assert(i);const t=new Cesium.Cartographic(ce(i[0]),ce(i[1]));if(this.scene_.globe){const o=this.scene_.globe.getHeight(t);t.height=o||0}const s=Cesium.Ellipsoid.WGS84.cartographicToCartesian(t),r={pitch:this.tilt_-Cesium.Math.PI_OVER_TWO,heading:-this.view_.getRotation(),roll:void 0};this.cam_.setView({destination:s,orientation:r}),this.cam_.moveBackward(this.distance_),this.checkCameraChange(!0)}readFromView(){if(!this.view_||!this.toLonLat_)return;const e=this.view_.getCenter();if(e==null)return;const i=this.toLonLat_(e);console.assert(i);const t=this.view_.getResolution();this.distance_=this.calcDistanceForResolution(t||0,ce(i[1])),this.updateCamera_()}updateView(){if(!this.view_||!this.fromLonLat_)return;this.viewUpdateInProgress_=!0;const e=Cesium.Ellipsoid.WGS84,i=this.scene_,t=O.pickCenterPoint(i);let s=t;if(!s){const o=i.globe,a=this.cam_.positionCartographic.clone(),l=o.getHeight(a);a.height=l||0,s=Cesium.Ellipsoid.WGS84.cartographicToCartesian(a)}this.distance_=Cesium.Cartesian3.distance(s,this.cam_.position);const r=e.cartesianToCartographic(s);if(this.view_.setCenter(this.fromLonLat_([Le(r.longitude),Le(r.latitude)])),this.view_.setResolution(this.calcResolutionForDistance(this.distance_,r?r.latitude:0)),t){const o=this.cam_.position,a=new Cesium.Cartesian3;e.geocentricSurfaceNormal(t,a);const l=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(o,t,l),Cesium.Cartesian3.normalize(l,l);const u=this.cam_.up,d=this.cam_.right,m=new Cesium.Cartesian3(-t.y,t.x,0),h=Cesium.Cartesian3.angleBetween(d,m),y=Cesium.Cartesian3.cross(t,u,new Cesium.Cartesian3).z;this.view_.setRotation(y<0?h:-h);const S=Math.acos(Cesium.Cartesian3.dot(a,l));this.tilt_=isNaN(S)?0:S}else this.view_.setRotation(this.cam_.heading),this.tilt_=-this.cam_.pitch+Math.PI/2;this.viewUpdateInProgress_=!1}checkCameraChange(e){const i=this.lastCameraViewMatrix_,t=this.cam_.viewMatrix;(!i||!Cesium.Matrix4.equalsEpsilon(i,t,1e-5))&&(this.lastCameraViewMatrix_=t.clone(),e!==!0&&this.updateView())}calcDistanceForResolution(e,i){return Ut(e,i,this.scene_,this.view_.getProjection())}calcResolutionForDistance(e,i){return Kt(e,i,this.scene_,this.view_.getProjection())}}class Et{constructor(e,i){this.map=e,this.view=e.getView(),this.scene=i,this.olLayers=e.getLayerGroup().getLayers(),this.mapLayerGroup=e.getLayerGroup(),this.layerMap={},this.olLayerListenKeys={},this.olGroupListenKeys_={}}synchronize(){this.destroyAll(),this.addLayers_(this.mapLayerGroup)}orderLayers(){}addLayers_(e){const i=[{layer:e,parents:[]}];for(;i.length>0;){const t=i.splice(0,1)[0],s=t.layer,r=R(s).toString();this.olLayerListenKeys[r]=[],console.assert(!this.layerMap[r]);let o=null;if(s instanceof Ne)this.listenForGroupChanges_(s),s!==this.mapLayerGroup&&(o=this.createSingleLayerCounterparts(t)),o||s.getLayers().forEach(a=>{if(a){const l={layer:a,parents:s===this.mapLayerGroup?[]:[t.layer].concat(t.parents)};i.push(l)}});else if(o=this.createSingleLayerCounterparts(t),!o){const a=r,l=t,u=d=>{const m=this.createSingleLayerCounterparts(l);m&&(l.layer.un("change",u),this.addCesiumObjects_(m,a,l.layer),this.orderLayers())};this.olLayerListenKeys[r].push(oe(l.layer,"change",u))}o&&this.addCesiumObjects_(o,r,s)}this.orderLayers()}addCesiumObjects_(e,i,t){this.layerMap[i]=e,this.olLayerListenKeys[i].push(oe(t,"change:zIndex",()=>this.orderLayers())),e.forEach(s=>{this.addCesiumObject(s)})}removeAndDestroySingleLayer_(e){const i=R(e).toString(),t=this.layerMap[i];return t&&(t.forEach(s=>{this.removeSingleCesiumObject(s,!1),this.destroyCesiumObject(s)}),this.olLayerListenKeys[i].forEach(X),delete this.olLayerListenKeys[i]),delete this.layerMap[i],!!t}unlistenSingleGroup_(e){if(e===this.mapLayerGroup)return;const i=R(e).toString();this.olGroupListenKeys_[i].forEach(s=>{X(s)}),delete this.olGroupListenKeys_[i],delete this.layerMap[i]}removeLayer_(e){if(e){const i=[e];for(;i.length>0;){const t=i.splice(0,1)[0],s=this.removeAndDestroySingleLayer_(t);t instanceof Ne&&(this.unlistenSingleGroup_(t),s||t.getLayers().forEach(r=>{i.push(r)}))}}}listenForGroupChanges_(e){const i=R(e).toString();console.assert(this.olGroupListenKeys_[i]===void 0);const t=[];this.olGroupListenKeys_[i]=t;let s=[];const r=(function(){const o=e.getLayers();o&&(s=[o.on("add",a=>{this.addLayers_(a.element)}),o.on("remove",a=>{this.removeLayer_(a.element)})],t.push(...s))}).bind(this);r(),t.push(e.on("change:layers",o=>{s.forEach(a=>{const l=t.indexOf(a);l>=0&&t.splice(l,1),X(a)}),r()}))}destroyAll(){this.removeAllCesiumObjects(!0);let e;for(e in this.olGroupListenKeys_)this.olGroupListenKeys_[e].forEach(X);for(e in this.olLayerListenKeys)this.olLayerListenKeys[e].forEach(X);this.olGroupListenKeys_={},this.olLayerListenKeys={},this.layerMap={}}addCesiumObject(e){}destroyCesiumObject(e){}removeSingleCesiumObject(e,i){}removeAllCesiumObjects(e){}createSingleLayerCounterparts(e){}}class Er extends Et{constructor(e,i){super(e,i),this.cesiumLayers_=i.imageryLayers,this.ourLayers_=new Cesium.ImageryLayerCollection}addCesiumObject(e){this.cesiumLayers_.add(e),this.ourLayers_.add(e)}destroyCesiumObject(e){e.destroy()}removeSingleCesiumObject(e,i){this.cesiumLayers_.remove(e,i),this.ourLayers_.remove(e,!1)}removeAllCesiumObjects(e){for(let i=0;i<this.ourLayers_.length;++i)this.cesiumLayers_.remove(this.ourLayers_.get(i),e);this.ourLayers_.removeAll(!1)}convertLayerToCesiumImageries(e,i){const t=O.tileLayerToImageryLayer(this.map,e,i);return t?[t]:null}createSingleLayerCounterparts(e){const i=e.layer,t=R(i).toString(),s=this.view.getProjection();console.assert(s);const r=this.convertLayerToCesiumImageries(i,s);if(r){const o=[];if([e.layer].concat(e.parents).forEach(a=>{o.push(a.on(["change:opacity","change:visible"],()=>{console.assert(r);for(let l=0;l<r.length;++l)O.updateCesiumLayerProperties(e,r[l])}))}),i.getStyleFunction){let a=i.getStyleFunction();o.push(i.on("change",()=>{const l=i.getStyleFunction();if(a!==l){a=l;for(let u=0;u<r.length;++u){const d=r[u];d._imageryCache&&d.imageryProvider.cache_&&(d._imageryCache={},d.imageryProvider.cache_={},d.imageryProvider.styleFunction_=l)}this.scene.requestRender()}}))}for(let a=0;a<r.length;++a)O.updateCesiumLayerProperties(e,r[a]);o.push(i.on("change:extent",a=>{for(let l=0;l<r.length;++l)this.cesiumLayers_.remove(r[l],!0),this.ourLayers_.remove(r[l],!1);delete this.layerMap[R(i)],this.synchronize()})),o.push(i.on("change",a=>{for(let l=0;l<r.length;++l){const u=this.cesiumLayers_.indexOf(r[l]);u>=0&&(this.cesiumLayers_.remove(r[l],!1),this.cesiumLayers_.add(r[l],u))}})),this.olLayerListenKeys[t].push(...o)}return Array.isArray(r)?r:null}orderLayers(){const e=[],i={},t=[this.mapLayerGroup];for(;t.length>0;){const s=t.splice(0,1)[0];if(e.push(s),i[R(s)]=s.getZIndex()||0,s instanceof Ne){const r=s.getLayers();r&&t.unshift(...r.getArray())}}qt(e,(s,r)=>i[R(s)]-i[R(r)]),e.forEach(s=>{const r=R(s).toString(),o=this.layerMap[r];o&&o.forEach(a=>{this.raiseToTop(a)})})}raiseToTop(e){this.cesiumLayers_.raiseToTop(e)}}class Ir{constructor(e,i){const t=new Cesium.BillboardCollection({scene:i}),s=new Cesium.PrimitiveCollection;this.olListenKeys=[],this.rootCollection_=new Cesium.PrimitiveCollection,this.context={projection:e,billboards:t,featureToCesiumMap:{},primitives:s},this.rootCollection_.add(t),this.rootCollection_.add(s)}destroy(){this.olListenKeys.forEach(X),this.olListenKeys.length=0}getRootPrimitive(){return this.rootCollection_}}class Rr{constructor(e){this.scene=e,this.boundOnRemoveOrClearFeatureListener_=this.onRemoveOrClearFeature_.bind(this),this.defaultBillboardEyeOffset_=new Cesium.Cartesian3(0,0,10)}onRemoveOrClearFeature_(e){const i=e.target;console.assert(i instanceof he);const t=se.obj(i).olcs_cancellers;if(t){const s=e.feature;if(s){const r=R(s),o=t[r];o&&(o(),delete t[r])}else{for(const r in t)t.hasOwnProperty(r)&&t[r]();se.obj(i).olcs_cancellers={}}}}setReferenceForPicking(e,i,t){t.olLayer=e,t.olFeature=i}createColoredPrimitive(e,i,t,s,r,o){const a=function(h,f){const y=new Cesium.GeometryInstance({geometry:h});return f&&!(f instanceof Cesium.ImageMaterialProperty)&&(y.attributes={color:Cesium.ColorGeometryInstanceAttribute.fromColor(f)}),y},l={flat:!0,renderState:{depthTest:{enabled:!0}}};o!==void 0&&(l.renderState||(l.renderState={}),l.renderState.lineWidth=o);const u=a(s,r),d=this.getHeightReference(e,i,t);let m;if(d===Cesium.HeightReference.CLAMP_TO_GROUND){const h=u.geometry.constructor;if(h&&!h.createShadowVolume)return null;m=new Cesium.GroundPrimitive({geometryInstances:u})}else m=new Cesium.Primitive({geometryInstances:u});if(r instanceof Cesium.ImageMaterialProperty){const h=r.image.getValue().toDataURL();m.appearance=new Cesium.MaterialAppearance({flat:!0,renderState:{depthTest:{enabled:!0}},material:new Cesium.Material({fabric:{type:"Image",uniforms:{image:h}}})})}else m.appearance=new Cesium.PerInstanceColorAppearance(l);return this.setReferenceForPicking(e,i,m),m}extractColorFromOlStyle(e,i){const t=e.getFill()?e.getFill().getColor():null,s=e.getStroke()?e.getStroke().getColor():null;let r="black";return s&&i?r=s:t&&(r=t),O.convertColorToCesium(r)}extractLineWidthFromOlStyle(e){const i=e.getStroke()?e.getStroke().getWidth():void 0;return i!==void 0?i:1}wrapFillAndOutlineGeometries(e,i,t,s,r,o){const a=this.extractColorFromOlStyle(o,!1),l=this.extractColorFromOlStyle(o,!0),u=new Cesium.PrimitiveCollection;if(o.getFill()){const d=this.createColoredPrimitive(e,i,t,s,a);console.assert(!!d),u.add(d)}if(o.getStroke()&&r){const d=this.extractLineWidthFromOlStyle(o),m=this.createColoredPrimitive(e,i,t,r,l,d);m&&u.add(m)}return u}addTextStyle(e,i,t,s,r){let o;if(r instanceof Cesium.PrimitiveCollection?o=r:(o=new Cesium.PrimitiveCollection,o.add(r)),!s.getText())return o;const a=s.getText(),l=this.olGeometry4326TextPartToCesium(e,i,t,a);return l&&o.add(l),o}csAddBillboard(e,i,t,s,r,o){i.eyeOffset||(i.eyeOffset=this.defaultBillboardEyeOffset_);const a=e.add(i);return this.setReferenceForPicking(t,s,a),a}olCircleGeometryToCesium(e,i,t,s,r){t=O.olGeometryCloneTo4326(t,s),console.assert(t.getType()=="Circle");let o=t.getCenter();const a=o.length==3?o[2]:0;let l=o.slice();l[0]+=t.getRadius(),o=O.ol4326CoordinateToCesiumCartesian(o),l=O.ol4326CoordinateToCesiumCartesian(l);const u=Cesium.Cartesian3.distance(o,l),d=new Cesium.CircleGeometry({center:o,radius:u,height:a});let m,h;if(this.getHeightReference(e,i,t)===Cesium.HeightReference.CLAMP_TO_GROUND){const y=this.extractLineWidthFromOlStyle(r);if(y){const S=Yt(t.getCenter(),u),g=O.ol4326CoordinateArrayToCsCartesians(S.getLinearRing(0).getCoordinates());if(De(this.scene))m=new Cesium.GroundPolylinePrimitive({geometryInstances:new Cesium.GeometryInstance({geometry:new Cesium.GroundPolylineGeometry({positions:g,width:y})}),appearance:new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(i,r,!0)}),classificationType:Cesium.ClassificationType.TERRAIN}),m.readyPromise.then(()=>{this.setReferenceForPicking(e,i,m._primitive)});else{const L=this.extractColorFromOlStyle(r,!0);m=this.createStackedGroundCorridors(e,i,y,L,g)}}}else h=new Cesium.CircleOutlineGeometry({center:o,radius:u,extrudedHeight:a,height:a});const f=this.wrapFillAndOutlineGeometries(e,i,t,d,h,r);return m&&f.add(m),this.addTextStyle(e,i,t,r,f)}createStackedGroundCorridors(e,i,t,s,r){Array.isArray(r[0])||(r=[r]),t=Math.max(3,t);const o=[];let a=0;for(const l of[1e3,4e3,16e3,64e3,254e3,1e6,1e7]){t*=2.14;const u={width:t,vertexFormat:Cesium.VertexFormat.POSITION_ONLY};for(const d of r)u.positions=d,o.push(new Cesium.GeometryInstance({geometry:new Cesium.CorridorGeometry(u),attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(s),distanceDisplayCondition:new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(a,l-1)}}));a=l}return new Cesium.GroundPrimitive({geometryInstances:o})}olLineStringGeometryToCesium(e,i,t,s,r){t=O.olGeometryCloneTo4326(t,s),console.assert(t.getType()=="LineString");const o=O.ol4326CoordinateArrayToCsCartesians(t.getCoordinates()),a=this.extractLineWidthFromOlStyle(r);let l;const u=this.getHeightReference(e,i,t);if(u===Cesium.HeightReference.CLAMP_TO_GROUND&&!De(this.scene)){const d=this.extractColorFromOlStyle(r,!0);l=this.createStackedGroundCorridors(e,i,a,d,o)}else{const d=new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(i,r,!0)}),m={positions:o,width:a},h={appearance:d};if(u===Cesium.HeightReference.CLAMP_TO_GROUND){const f=new Cesium.GroundPolylineGeometry(m);h.geometryInstances=new Cesium.GeometryInstance({geometry:f}),l=new Cesium.GroundPolylinePrimitive(h),l.readyPromise.then(()=>{this.setReferenceForPicking(e,i,l._primitive)})}else{m.vertexFormat=d.vertexFormat;const f=new Cesium.PolylineGeometry(m);h.geometryInstances=new Cesium.GeometryInstance({geometry:f}),l=new Cesium.Primitive(h)}}return this.setReferenceForPicking(e,i,l),this.addTextStyle(e,i,t,r,l)}olPolygonGeometryToCesium(e,i,t,s,r){t=O.olGeometryCloneTo4326(t,s),console.assert(t.getType()=="Polygon");const o=this.getHeightReference(e,i,t);let a,l,u;if(t.getCoordinates()[0].length==5&&i.getGeometry().get("olcs.polygon_kind")==="rectangle"){const m=t.getCoordinates()[0],h=Zt(m),f=Cesium.Rectangle.fromDegrees(h[0],h[1],h[2],h[3]);let y=0;if(m[0].length==3)for(let S=0;S<m.length;S++)y=Math.max(y,m[S][2]);a=new Cesium.RectangleGeometry({ellipsoid:Cesium.Ellipsoid.WGS84,rectangle:f,height:y}),l=new Cesium.RectangleOutlineGeometry({ellipsoid:Cesium.Ellipsoid.WGS84,rectangle:f,height:y})}else{const m=t.getLinearRings(),h={},f=h;console.assert(m.length>0);for(let y=0;y<m.length;++y){const S=m[y].getCoordinates(),g=O.ol4326CoordinateArrayToCsCartesians(S);console.assert(g&&g.length>0),y==0?h.positions=g:(h.holes||(h.holes=[]),h.holes.push({positions:g}))}if(a=new Cesium.PolygonGeometry({polygonHierarchy:f,perPositionHeight:!0}),o===Cesium.HeightReference.CLAMP_TO_GROUND){const y=this.extractLineWidthFromOlStyle(r);if(y>0){const S=[h.positions];if(h.holes)for(let g=0;g<h.holes.length;++g)S.push(h.holes[g].positions);if(De(this.scene)){const g=new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(i,r,!0)}),L=[];for(const v of S){const p=new Cesium.GroundPolylineGeometry({positions:v,width:y});L.push(new Cesium.GeometryInstance({geometry:p}))}const D={appearance:g,geometryInstances:L};u=new Cesium.GroundPolylinePrimitive(D),u.readyPromise.then(()=>{this.setReferenceForPicking(e,i,u._primitive)})}else{const g=this.extractColorFromOlStyle(r,!0);u=this.createStackedGroundCorridors(e,i,y,g,S)}}}else l=new Cesium.PolygonOutlineGeometry({polygonHierarchy:h,perPositionHeight:!0})}const d=this.wrapFillAndOutlineGeometries(e,i,t,a,l,r);return u&&d.add(u),this.addTextStyle(e,i,t,r,d)}getHeightReference(e,i,t){let s=t.get("altitudeMode");s===void 0&&(s=i.get("altitudeMode")),s===void 0&&(s=e.get("altitudeMode"));let r=Cesium.HeightReference.NONE;return s==="clampToGround"?r=Cesium.HeightReference.CLAMP_TO_GROUND:s==="relativeToGround"&&(r=Cesium.HeightReference.RELATIVE_TO_GROUND),r}createBillboardFromImage(e,i,t,s,r,o,a,l){o instanceof Te&&o.load();const u=o.getImage(1),d=function(h){return h.src!=""&&h.naturalHeight!=0&&h.naturalWidth!=0&&h.complete},m=(function(){if(!u||!(u instanceof HTMLCanvasElement||u instanceof Image||u instanceof HTMLImageElement))return;const h=t.getCoordinates(),f=O.ol4326CoordinateToCesiumCartesian(h);let y;const S=o.getOpacity();S!==void 0&&(y=new Cesium.Color(1,1,1,S));const g=o.getScale(),L=this.getHeightReference(e,i,t),D={image:u,color:y,scale:g,heightReference:L,position:f};if(Object.assign(D,i.get("cesiumOptions")),o instanceof Te){const p=o.getAnchor();p&&(D.pixelOffset=new Cesium.Cartesian2((u.width/2-p[0])*g,(u.height/2-p[1])*g))}const v=this.csAddBillboard(a,D,e,i,t,r);l&&l(v)}).bind(this);if(u instanceof Image&&!d(u)){let h=!1;const f=e.getSource(),y=function(){h=!0};f.on(["removefeature","clear"],this.boundOnRemoveOrClearFeatureListener_);let S=se.obj(f).olcs_cancellers;S||(S=se.obj(f).olcs_cancellers={});const g=R(i);S[g]&&S[g](),S[g]=y;const L=function(){u.removeEventListener("load",L),!a.isDestroyed()&&!h&&m()};u.addEventListener("load",L)}else m()}olPointGeometryToCesium(e,i,t,s,r,o,a){console.assert(t.getType()=="Point"),t=O.olGeometryCloneTo4326(t,s);let l=null;const u=r.getImage();if(u){const d=t.get("olcs_model")||i.get("olcs_model");if(d){const m=d(),h=Object.assign({},{scene:this.scene},m.cesiumOptions),f=Cesium.Model.fromGltf(h);l=new Cesium.PrimitiveCollection,l.add(f),m.debugModelMatrix&&l.add(new Cesium.DebugModelMatrixPrimitive({modelMatrix:m.debugModelMatrix}))}else this.createBillboardFromImage(e,i,t,s,r,u,o,a)}return r.getText()?this.addTextStyle(e,i,t,r,l||new Cesium.Primitive):l}olMultiGeometryToCesium(e,i,t,s,r,o,a){const l=function(d,m){const h=new Cesium.PrimitiveCollection;return d.forEach(f=>{h.add(m(e,i,f,s,r))}),h};let u;switch(t.getType()){case"MultiPoint":if(t=t,u=t.getPoints(),r.getText()){const d=new Cesium.PrimitiveCollection;return u.forEach(m=>{console.assert(m);const h=this.olPointGeometryToCesium(e,i,m,s,r,o,a);h&&d.add(h)}),d}else return u.forEach(d=>{console.assert(d),this.olPointGeometryToCesium(e,i,d,s,r,o,a)}),null;case"MultiLineString":return t=t,u=t.getLineStrings(),l(u,this.olLineStringGeometryToCesium.bind(this));case"MultiPolygon":return t=t,u=t.getPolygons(),l(u,this.olPolygonGeometryToCesium.bind(this));default:console.assert(!1,`Unhandled multi geometry type${t.getType()}`)}}olGeometry4326TextPartToCesium(e,i,t,s){const r=s.getText();if(!r)return null;const o=new Cesium.LabelCollection({scene:this.scene}),a=at(t.getExtent());if(t instanceof Qt){const y=t.getFirstCoordinate();a[2]=y.length==3?y[2]:0}const l={};l.position=O.ol4326CoordinateToCesiumCartesian(a),l.text=r,l.heightReference=this.getHeightReference(e,i,t);const u=s.getOffsetX(),d=s.getOffsetY();if(u!=0&&d!=0){const y=new Cesium.Cartesian2(u,d);l.pixelOffset=y}l.font=s.getFont()||"10px sans-serif";let m;s.getFill()&&(l.fillColor=this.extractColorFromOlStyle(s,!1),m=Cesium.LabelStyle.FILL),s.getStroke()&&(l.outlineWidth=this.extractLineWidthFromOlStyle(s),l.outlineColor=this.extractColorFromOlStyle(s,!0),m=Cesium.LabelStyle.OUTLINE),s.getFill()&&s.getStroke()&&(m=Cesium.LabelStyle.FILL_AND_OUTLINE),l.style=m;let h;switch(s.getTextAlign()){case"left":h=Cesium.HorizontalOrigin.LEFT;break;case"right":h=Cesium.HorizontalOrigin.RIGHT;break;case"center":default:h=Cesium.HorizontalOrigin.CENTER}if(l.horizontalOrigin=h,s.getTextBaseline()){let y;switch(s.getTextBaseline()){case"top":y=Cesium.VerticalOrigin.TOP;break;case"middle":y=Cesium.VerticalOrigin.CENTER;break;case"bottom":y=Cesium.VerticalOrigin.BOTTOM;break;case"alphabetic":y=Cesium.VerticalOrigin.TOP;break;case"hanging":y=Cesium.VerticalOrigin.BOTTOM;break;default:console.assert(!1,`unhandled baseline ${s.getTextBaseline()}`)}l.verticalOrigin=y}const f=o.add(l);return this.setReferenceForPicking(e,i,f),o}olStyleToCesium(e,i,t){const s=i.getFill(),r=i.getStroke();if(t&&!r||!t&&!s)return null;let o=t?r.getColor():s.getColor();return o=O.convertColorToCesium(o),t&&r.getLineDash()?Cesium.Material.fromType("Stripe",{horizontal:!1,repeat:500,evenColor:o,oddColor:new Cesium.Color(0,0,0,0)}):Cesium.Material.fromType("Color",{color:o})}computePlainStyle(e,i,t,s){const r=i.getStyleFunction();let o=null;return r&&(o=r(i,s)),!o&&t&&(o=t(i,s)),o?Array.isArray(o)?o:[o]:null}getGeometryFromFeature(e,i,t){if(t)return t;const s=e.get("olcs.3d_geometry");if(s&&s instanceof Ye)return s;if(i){const r=i.getGeometryFunction()(e);if(r instanceof Ye)return r}return e.getGeometry()}olFeatureToCesium(e,i,t,s,r){let o=this.getGeometryFromFeature(i,t,r);if(!o)return null;const a=s.projection,l=function(u){const d=s.featureToCesiumMap[R(i)];d instanceof Array?d.push(u):s.featureToCesiumMap[R(i)]=[u]};switch(o.getType()){case"GeometryCollection":const u=new Cesium.PrimitiveCollection;return o.getGeometries().forEach(y=>{if(y){const S=this.olFeatureToCesium(e,i,t,s,y);S&&u.add(S)}}),u;case"Point":o=o;const m=s.billboards,h=this.olPointGeometryToCesium(e,i,o,a,t,m,l);return h||null;case"Circle":return o=o,this.olCircleGeometryToCesium(e,i,o,a,t);case"LineString":return o=o,this.olLineStringGeometryToCesium(e,i,o,a,t);case"Polygon":return o=o,this.olPolygonGeometryToCesium(e,i,o,a,t);case"MultiPoint":case"MultiLineString":case"MultiPolygon":const f=this.olMultiGeometryToCesium(e,i,o,a,t,s.billboards,l);return f||null;case"LinearRing":throw new Error("LinearRing should only be part of polygon.");default:throw new Error(`Ol geom type not handled : ${o.getType()}`)}}olVectorLayerToCesium(e,i,t){const s=i.getProjection(),r=i.getResolution();if(r===void 0||!s)throw console.assert(!1,"View not ready"),new Error("View not ready");let o=e.getSource();o instanceof yt&&(o=o.getSource()),console.assert(o instanceof he);const a=o.getFeatures(),l=new Ir(s,this.scene),u=l.context;for(let d=0;d<a.length;++d){const m=a[d];if(!m)continue;const h=e.getStyleFunction(),f=this.computePlainStyle(e,m,h,r);if(!f||!f.length)continue;let y=null;for(let S=0;S<f.length;S++){const g=this.olFeatureToCesium(e,m,f[S],u);if(g){if(!y)y=g;else if(g){let L=0,D;for(;D=g.get(L);)y.add(D),L++}}}y&&(t[R(m)]=y,l.getRootPrimitive().add(y))}return l}convert(e,i,t,s){const r=i.getProjection(),o=i.getResolution();if(o==null||!r)return null;const a=e.getStyleFunction(),l=this.computePlainStyle(e,t,a,o);if(!l||!l.length)return null;s.projection=r;let u=null;for(let d=0;d<l.length;d++){const m=this.olFeatureToCesium(e,t,l[d],s);if(!u)u=m;else if(m){let h=0,f;for(;f=m.get(h);)u.add(f),h++}}return u}}class Pr extends Et{constructor(e,i,t){super(e,i),this.converter=t||new Rr(i),this.csAllPrimitives_=new Cesium.PrimitiveCollection,i.primitives.add(this.csAllPrimitives_),this.csAllPrimitives_.destroyPrimitives=!1}addCesiumObject(e){console.assert(e),e.getRootPrimitive().counterpart=e,this.csAllPrimitives_.add(e.getRootPrimitive())}destroyCesiumObject(e){e.getRootPrimitive().destroy()}removeSingleCesiumObject(e,i){e.destroy(),this.csAllPrimitives_.destroyPrimitives=i,this.csAllPrimitives_.remove(e.getRootPrimitive()),this.csAllPrimitives_.destroyPrimitives=!1}removeAllCesiumObjects(e){if(this.csAllPrimitives_.destroyPrimitives=e,e)for(let i=0;i<this.csAllPrimitives_.length;++i)this.csAllPrimitives_.get(i).counterpart.destroy();this.csAllPrimitives_.removeAll(),this.csAllPrimitives_.destroyPrimitives=!1}updateLayerVisibility(e,i){let t=!0;[e.layer].concat(e.parents).forEach(s=>{const r=s.getVisible();r!==void 0?t&=r:t=!1}),i.show=t}createSingleLayerCounterparts(e){const i=e.layer;if(!(i instanceof Be)||i instanceof Xt)return null;console.assert(i instanceof Jt);let t=i.getSource();if(t instanceof yt&&(t=t.getSource()),!t)return null;console.assert(t instanceof he),console.assert(this.view);const s=this.view,r={},o=this.converter.olVectorLayerToCesium(i,s,r),a=o.getRootPrimitive(),l=o.olListenKeys;[e.layer].concat(e.parents).forEach(m=>{l.push(oe(m,"change:visible",()=>{this.updateLayerVisibility(e,a)}))}),this.updateLayerVisibility(e,a);const u=(function(m){console.assert(i instanceof Be||i instanceof ei);const h=o.context,f=this.converter.convert(i,s,m,h);f&&(r[R(m)]=f,a.add(f))}).bind(this),d=(function(m){const h=R(m),f=o.context,y=f.featureToCesiumMap[h];y&&(delete f.featureToCesiumMap[h],y.forEach(g=>{g instanceof Cesium.Billboard&&f.billboards.remove(g)}));const S=r[h];delete r[h],S&&a.remove(S)}).bind(this);return l.push(oe(t,"addfeature",m=>{console.assert(m.feature),u(m.feature)})),l.push(oe(t,"removefeature",m=>{console.assert(m.feature),d(m.feature)})),l.push(oe(t,"changefeature",m=>{const h=m.feature;console.assert(h),d(h),u(h)})),o?[o]:null}}class Or extends ut{constructor(e){const i=e.parent;super(i.getOptions()),this.scenePostRenderListenerRemover_=null,this.scene_=e.scene,this.synchronizer_=e.synchronizer,this.parent_=i,this.positionWGS84_=void 0,this.observer_=new MutationObserver(this.handleElementChanged.bind(this)),this.attributeObserver_=[],this.listenerKeys_=[];const t=s=>this.setPropertyFromEvent_(s);this.listenerKeys_.push(this.parent_.on("change:position",t)),this.listenerKeys_.push(this.parent_.on("change:element",t)),this.listenerKeys_.push(this.parent_.on("change:offset",t)),this.listenerKeys_.push(this.parent_.on("change:position",t)),this.listenerKeys_.push(this.parent_.on("change:positioning",t)),this.setProperties(this.parent_.getProperties()),this.handleMapChanged(),this.handleElementChanged()}observeTarget_(e){if(this.observer_){this.observer_.disconnect(),this.observer_.observe(e,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),this.attributeObserver_.forEach(i=>{i.disconnect()}),this.attributeObserver_.length=0;for(let i=0;i<e.childNodes.length;i++){const t=e.childNodes[i];if(t.nodeType===1){const s=new MutationObserver(this.handleElementChanged.bind(this));s.observe(t,{attributes:!0,subtree:!0}),this.attributeObserver_.push(s)}}}}setPropertyFromEvent_(e){e.target&&e.key&&this.set(e.key,e.target.get(e.key))}getScene(){return this.scene_}handleMapChanged(){this.scenePostRenderListenerRemover_&&(this.scenePostRenderListenerRemover_(),ti(this.element)),this.scenePostRenderListenerRemover_=null;const e=this.getScene();if(e){this.scenePostRenderListenerRemover_=e.postRender.addEventListener(this.updatePixelPosition.bind(this)),this.updatePixelPosition();const i=this.stopEvent?this.synchronizer_.getOverlayContainerStopEvent():this.synchronizer_.getOverlayContainer();this.insertFirst?i.insertBefore(this.element,i.childNodes[0]||null):i.appendChild(this.element)}}handlePositionChanged(){const e=this.getPosition();if(e){const i=this.parent_.getMap().getView().getProjection();this.positionWGS84_=ii(e,i,"EPSG:4326")}else this.positionWGS84_=void 0;this.updatePixelPosition()}handleElementChanged(){function e(t,s){const r=t.cloneNode();t.nodeName==="CANVAS"&&r.getContext("2d").drawImage(t,0,0),s&&s.appendChild(r),t.nodeType!=Node.TEXT_NODE&&r.addEventListener("click",a=>{t.dispatchEvent(new MouseEvent("click",a)),a.stopPropagation()});const o=t.childNodes;for(let a=0;a<o.length;a++)o[a]&&e(o[a],r);return r}si(this.element);const i=this.getElement();if(i&&i.parentNode&&i.parentNode.childNodes)for(const t of i.parentNode.childNodes){const s=e(t,null);this.element.appendChild(s)}i.parentNode&&this.observeTarget_(i.parentNode)}updatePixelPosition(){const e=this.positionWGS84_;if(!this.scene_||!e){this.setVisible(!1);return}let i=0;if(e.length===2){const m=this.scene_.globe.getHeight(Cesium.Cartographic.fromDegrees(e[0],e[1]));m&&this.scene_.globe.tilesLoaded&&(e[2]=m),m&&(i=m)}else i=e[2];const t=Cesium.Cartesian3.fromDegrees(e[0],e[1],i),s=this.scene_.camera,r=new Cesium.BoundingSphere(new Cesium.Cartesian3,6356752);if(!new Cesium.Occluder(r,s.position).isPointVisible(t)){this.setVisible(!1);return}if(s.frustum.computeCullingVolume(s.position,s.direction,s.up).computeVisibility(new Cesium.BoundingSphere(t))!==1){this.setVisible(!1);return}this.setVisible(!0);const l=this.scene_.cartesianToCanvasCoordinates(t),u=[l.x,l.y],d=[this.scene_.canvas.width,this.scene_.canvas.height];this.updateRenderedPosition(u,d)}destroy(){this.scenePostRenderListenerRemover_&&this.scenePostRenderListenerRemover_(),this.observer_&&this.observer_.disconnect(),X(this.listenerKeys_),this.listenerKeys_.splice(0),this.element.removeNode?this.element.removeNode(!0):this.element.remove(),this.element=null}}class Dr{constructor(e,i){this.map=e,this.overlays_=this.map.getOverlays(),this.scene=i,this.overlayContainerStopEvent_=document.createElement("DIV"),this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",["click","dblclick","mousedown","touchstart","MSPointerDown","pointerdown","mousewheel","wheel"].forEach(s=>{this.overlayContainerStopEvent_.addEventListener(s,r=>r.stopPropagation())}),this.scene.canvas.parentElement.appendChild(this.overlayContainerStopEvent_),this.overlayContainer_=document.createElement("DIV"),this.overlayContainer_.className="ol-overlaycontainer",this.scene.canvas.parentElement.appendChild(this.overlayContainer_),this.overlayMap_={}}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOverlayContainer(){return this.overlayContainer_}synchronize(){this.destroyAll(),this.addOverlays(),this.overlays_.on("add",this.addOverlayFromEvent_.bind(this)),this.overlays_.on("remove",this.removeOverlayFromEvent_.bind(this))}addOverlayFromEvent_(e){const i=e.element;this.addOverlay(i)}addOverlays(){this.overlays_.forEach(e=>{this.addOverlay(e)})}addOverlay(e){if(!e)return;const i=new Or({scene:this.scene,synchronizer:this,parent:e}),t=R(e).toString();this.overlayMap_[t]=i}removeOverlayFromEvent_(e){const i=e.element;this.removeOverlay(i)}removeOverlay(e){const i=R(e).toString(),t=this.overlayMap_[i];t&&(t.destroy(),delete this.overlayMap_[i])}destroyAll(){Object.keys(this.overlayMap_).forEach(e=>{this.overlayMap_[e].destroy(),delete this.overlayMap_[e]})}}class ue{constructor(e){this.autoRenderLoop_=null,this.map_=e.map,this.time_=e.time||function(){return Cesium.JulianDate.now()},this.to4326Transform_=Ve(this.map_.getView().getProjection(),"EPSG:4326"),this.resolutionScale_=1,this.canvasClientWidth_=0,this.canvasClientHeight_=0,this.resolutionScaleChanged_=!0;const i="position:absolute;top:0;left:0;width:100%;height:100%;";this.container_=document.createElement("DIV");const t=document.createAttribute("style");t.value=`${i}visibility:hidden;`,this.container_.setAttributeNode(t);let s=e.target||this.map_.getViewport();if(typeof s=="string"&&(s=document.getElementById(s)),s.appendChild(this.container_),this.isOverMap_=!e.target,this.isOverMap_&&e.stopOpenLayersEventsPropagation){const m=["click","dblclick","mousedown","touchstart","MSPointerDown","pointerdown","mousewheel","wheel"];for(let h=0,f=m.length;h<f;++h)this.container_.addEventListener(m[h],y=>y.stopPropagation())}this.canvas_=document.createElement("CANVAS");const r=document.createAttribute("style");r.value=i,this.canvas_.setAttributeNode(r),se.supportsImageRenderingPixelated()&&(this.canvas_.style.imageRendering=se.imageRenderingValue()),this.canvas_.oncontextmenu=function(){return!1},this.canvas_.onselectstart=function(){return!1},this.container_.appendChild(this.canvas_),this.enabled_=!1,this.pausedInteractions_=[],this.hiddenRootGroup_=null;const o=e.sceneOptions!==void 0?e.sceneOptions:{};o.canvas=this.canvas_,o.scene3DOnly=!0,this.scene_=new Cesium.Scene(o);const a=this.scene_.screenSpaceCameraController;a.tiltEventTypes.push({eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.SHIFT}),a.tiltEventTypes.push({eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.ALT}),a.enableLook=!1,this.scene_.camera.constrainedAxis=Cesium.Cartesian3.UNIT_Z,this.camera_=new ae(this.scene_,this.map_),this.globe_=new Cesium.Globe(Cesium.Ellipsoid.WGS84),this.globe_.baseColor=Cesium.Color.WHITE,this.scene_.globe=this.globe_,this.scene_.skyAtmosphere=new Cesium.SkyAtmosphere;const l=new Cesium.SingleTileImageryProvider({url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",rectangle:Cesium.Rectangle.fromDegrees(0,0,1,1)});this.globe_.imageryLayers.addImageryProvider(l,0),this.dataSourceCollection_=new Cesium.DataSourceCollection,this.dataSourceDisplay_=new Cesium.DataSourceDisplay({scene:this.scene_,dataSourceCollection:this.dataSourceCollection_});const u=e.createSynchronizers?e.createSynchronizers(this.map_,this.scene_,this.dataSourceCollection_):[new Er(this.map_,this.scene_),new Pr(this.map_,this.scene_),new Dr(this.map_,this.scene_)];this.handleResize_();for(let m=u.length-1;m>=0;--m)u[m].synchronize();this.lastFrameTime_=0,this.renderId_=void 0,this.targetFrameRate_=Number.POSITIVE_INFINITY,this.blockCesiumRendering_=!1,this.warmingUp_=!1,this.trackedFeature_=null,this.trackedEntity_=null,this.entityView_=null,this.needTrackedEntityUpdate_=!1,this.boundingSphereScratch_=new Cesium.BoundingSphere,new Cesium.EventHelper().add(this.scene_.postRender,ue.prototype.updateTrackedEntity_,this),Cesium.Camera.enableSuspendTerrainAdjustment=!1}render_(){this.renderId_!==void 0&&(cancelAnimationFrame(this.renderId_),this.renderId_=void 0),(this.enabled_||this.warmingUp_)&&!this.blockCesiumRendering_&&(this.renderId_=requestAnimationFrame(this.onAnimationFrame_.bind(this)))}onAnimationFrame_(e){this.renderId_=void 0;const i=1e3/this.targetFrameRate_;if(e-this.lastFrameTime_<i){this.render_();return}this.lastFrameTime_=e;const s=this.time_();if(this.scene_.initializeFrame(),this.handleResize_(),this.dataSourceDisplay_.update(s),this.entityView_){const r=this.trackedEntity_;this.dataSourceDisplay_.getBoundingSphere(r,!1,this.boundingSphereScratch_)===Cesium.BoundingSphereState.DONE&&(this.boundingSphereScratch_.radius=1,this.entityView_.update(s,this.boundingSphereScratch_))}this.scene_.render(s),this.camera_.checkCameraChange(),this.render_()}updateTrackedEntity_(){if(!this.needTrackedEntityUpdate_)return;const e=this.trackedEntity_,i=this.scene_,t=this.dataSourceDisplay_.getBoundingSphere(e,!1,this.boundingSphereScratch_);if(t===Cesium.BoundingSphereState.PENDING)return;i.screenSpaceCameraController.enableTilt=!1;const s=t!==Cesium.BoundingSphereState.FAILED?this.boundingSphereScratch_:void 0;s&&(s.radius=1),this.entityView_=new Cesium.EntityView(e,i,i.mapProjection.ellipsoid),this.entityView_.update(this.time_(),s),this.needTrackedEntityUpdate_=!1}handleResize_(){let e=this.canvas_.clientWidth,i=this.canvas_.clientHeight;if(e===0|i===0||e===this.canvasClientWidth_&&i===this.canvasClientHeight_&&!this.resolutionScaleChanged_)return;let t=this.resolutionScale_;se.supportsImageRenderingPixelated()||(t*=window.devicePixelRatio||1),this.resolutionScaleChanged_=!1,this.canvasClientWidth_=e,this.canvasClientHeight_=i,e*=t,i*=t,this.canvas_.width=e,this.canvas_.height=i,this.scene_.camera.frustum.aspectRatio=e/i}getCamera(){return this.camera_}getOlMap(){return this.map_}getOlView(){const e=this.map_.getView();return console.assert(e),e}getCesiumScene(){return this.scene_}getDataSources(){return this.dataSourceCollection_}getDataSourceDisplay(){return this.dataSourceDisplay_}getEnabled(){return this.enabled_}setEnabled(e){if(this.enabled_===e)return;this.enabled_=e,this.container_.style.visibility=this.enabled_?"visible":"hidden";let i;if(this.enabled_){if(this.throwOnUnitializedMap_(),this.isOverMap_){i=this.map_.getInteractions(),i.forEach((s,r,o)=>{this.pausedInteractions_.push(s)}),i.clear(),this.map_.addInteraction=s=>this.pausedInteractions_.push(s),this.map_.removeInteraction=s=>this.pausedInteractions_=this.pausedInteractions_.filter(r=>r!==s);const t=this.map_.getLayerGroup();t.getVisible()&&(this.hiddenRootGroup_=t,this.hiddenRootGroup_.setVisible(!1)),this.map_.getOverlayContainer().classList.add("olcs-hideoverlay")}this.camera_.readFromView(),this.render_()}else this.isOverMap_&&(i=this.map_.getInteractions(),this.pausedInteractions_.forEach(t=>{i.push(t)}),this.pausedInteractions_.length=0,this.map_.addInteraction=t=>this.map_.getInteractions().push(t),this.map_.removeInteraction=t=>this.map_.getInteractions().remove(t),this.map_.getOverlayContainer().classList.remove("olcs-hideoverlay"),this.hiddenRootGroup_&&(this.hiddenRootGroup_.setVisible(!0),this.hiddenRootGroup_=null)),this.camera_.updateView()}warmUp(e,i){if(this.enabled_)return;this.throwOnUnitializedMap_(),this.camera_.readFromView();const t=this.globe_.ellipsoid,s=this.scene_.camera,r=t.cartesianToCartographic(s.position);r.height<e&&(r.height=e,s.position=t.cartographicToCartesian(r)),this.warmingUp_=!0,this.render_(),setTimeout(()=>{this.warmingUp_=!1},i)}setBlockCesiumRendering(e){this.blockCesiumRendering_!==e&&(this.blockCesiumRendering_=e,this.render_())}enableAutoRenderLoop(){this.autoRenderLoop_||(this.autoRenderLoop_=new kr(this))}getAutoRenderLoop(){return this.autoRenderLoop_}setResolutionScale(e){e=Math.max(0,e),e!==this.resolutionScale_&&(this.resolutionScale_=Math.max(0,e),this.resolutionScaleChanged_=!0,this.autoRenderLoop_&&this.autoRenderLoop_.restartRenderLoop())}setTargetFrameRate(e){this.targetFrameRate_!==e&&(this.targetFrameRate_=e,this.render_())}throwOnUnitializedMap_(){const i=this.map_.getView(),t=i.getCenter();if(!i.isDef()||isNaN(t[0])||isNaN(t[1]))throw new Error(`The OpenLayers map is not properly initialized: ${t} / ${i.getResolution()}`)}get trackedFeature(){return this.trackedFeature_}set trackedFeature(e){if(this.trackedFeature_!==e){const i=this.scene_;if(!e||!e.getGeometry()){this.needTrackedEntityUpdate_=!1,i.screenSpaceCameraController.enableTilt=!0,this.trackedEntity_&&this.dataSourceDisplay_.defaultDataSource.entities.remove(this.trackedEntity_),this.trackedEntity_=null,this.trackedFeature_=null,this.entityView_=null,i.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);return}this.trackedFeature_=e,this.needTrackedEntityUpdate_=!0;const t=this.to4326Transform_,s=function(){const o=e.getGeometry();console.assert(o instanceof We);const a=o.getCoordinates(),l=t(a,void 0,a.length);return O.ol4326CoordinateToCesiumCartesian(l)},r={position:new Cesium.CallbackProperty((o,a)=>s(),!1),point:{pixelSize:1,color:Cesium.Color.TRANSPARENT}};this.trackedEntity_=this.dataSourceDisplay_.defaultDataSource.entities.add(r)}}}const Ar={props:{},setup(n,{emit:e}){const i=xe,t=pt(),s=Q({defaultCenter:[121.326776,24.655499],defaultCenterZoom:14,targetNum:1,conditionWrap:!1,layerSelect:!1,currentLayers:[],layers:[],mapLayers:re(()=>s.layers.map((v,p)=>({label:v.group_title,value:v.value,layers:v.group_layers,groupClass:v.group_class}))),selectLock:!1,mapCount:1,map1:null,map2:null,map1LayerStatus:[],map2LayerStatus:[],temp:{map1BaseStatus:0,map2BaseStatus:0},deleteLightbox:!1,dimensionMap:{map1:"2D",map2:"2D"},toSearchDimensionStatus:re(()=>{let v=s.targetNum==1?"map1":"map2";return s.dimensionMap[v]==="2D"}),ol3d:null,selectValueTemp:0,popup:{nodeRef:null,overlay:null,popupId:0,coordinate:[],popupData:""},comSize:{wrapHeight:"",wrapWidth:"",conditionCom:{}},tribeQuery:{}});let r=null;const o=new ct({projection:"EPSG:4326",center:s.defaultCenter,zoom:s.defaultCenterZoom});function a(){s.map1=new Se({target:"map1",layers:[we.getBaseMapData(0)],view:o,controls:[]}),s.map1.addControl(new Mr({units:"metric"}))}function l(v,p){const b=new Be({source:new he({features:[new lt({geometry:new We([v,p]),population:4e3,rainfall:500})]}),style:new Ze({image:new Te({anchor:[.5,100],anchorXUnits:"fraction",anchorYUnits:"pixels",src:is})})});let w=s.targetNum==1?"map1":"map2";s[w].addLayer(b)}function u({action:v,value:p}){var I;let b=((I=s.map1)==null?void 0:I.getTarget())==null?"map2":"map1",w=s[b].getView();switch(v){case"In":w.animate({zoom:w.getZoom()+1});break;case"Out":w.animate({zoom:w.getZoom()-1});break;case"toNorth":w.animate({rotation:0});break;case"moveTo":if(p){const{xAxis:P,yAxis:H}=p;w.animate({center:[P,H],zoom:17,duration:100})}else navigator.geolocation.getCurrentPosition(function(P){w.animate({center:[P.coords.longitude,P.coords.latitude],zoom:17,duration:100}),l(P.coords.longitude,P.coords.latitude)});break;case"fullScreen":let T=document.getElementById(`map${s.targetNum}`);T.requestFullscreen?T.requestFullscreen():T.msRequestFullscreen?T.msRequestFullscreen():T.mozRequestFullScreen?T.mozRequestFullScreen():T.webkitRequestFullscreen&&T.webkitRequestFullscreen();break}}function d({action:v,value:p}){var P;let b=s.targetNum==1?s.map1:s.map2,w=b==null?void 0:b.getLayers();switch(v){case"layerMode":if(p.checked){s.layers[p.nodeIndex].group_layers[p.subNodeIndex].single_tiles||(w.getArray().forEach(W=>{W.get("id")&&W.get("id").includes(`node${p.nodeIndex}_subNode${p.subNodeIndex}_nestedSubNode`)&&b.removeLayer(W)}),y("delete",b.getTarget(),p.id));let x=p.nestedSubNodeIndex||s.selectValueTemp,A=i.getLayer(s.layers[p.nodeIndex].group_layers[p.subNodeIndex],x,p.id);if(b.addLayer(A),A.get("label").includes("雷達回波預測")){var I=A.getSource(),T=I.getFeatures()[0];const F=s.layers[p.nodeIndex].group_layers[p.subNodeIndex].image_options.image_extent,W="https://occur55170.github.io/Map_Demo/forecast.gif",Ce=gifler(W),ze=F[2]-F[0],ie=F[3]-F[1];Ce.frames(document.createElement("canvas"),function(ne,K){const Ot=ze/K.width,Dt=ie/K.height,At=Math.min(Ot,Dt),Ft=s.map1.getView().getResolution();T.setStyle(new Ze({image:new Te({img:ne.canvas,imgSize:[K.width,K.height],opacity:.8,scale:At/Ft})})),ne.clearRect(0,0,K.width,K.height),ne.drawImage(K.buffer,K.x,K.y),b.render()},!0)}s.layers[p.nodeIndex].group_layers[p.subNodeIndex].layer_type==="WFS"&&(S(b,A.label),L(p)),y("add",b.getTarget(),p.id)}else{let A=function(Ce){x.filter(ie=>{var ne;return(ne=ie==null?void 0:ie.get("id"))==null?void 0:ne.includes(Ce)}).forEach(ie=>{b.removeLayer(ie)})},x=w.getArray();const W={node9_subNode0_nestedSubNode:"node9_subNode0_nestedSubNode",node12_subNode1_nestedSubNode:"node12_subNode1_nestedSubNode"}[p.id]||p.id;A(W),s.layers[p.nodeIndex].group_layers[p.subNodeIndex].layer_type==="WFS"&&(L(p),s.popup.popupId=0,s.popup.popupData="",s.popup.overlay&&(b.removeOverlay(s.popup.overlay),s.popup.overlay=null)),y("delete",b.getTarget(),p.id)}break;case"selectLayerMode":if(s.selectLock)return;p.layerName==="all"?w.getArray().filter(F=>F.get("id")!==void 0).forEach(F=>{b.removeLayer(F)}):w.getArray().forEach(A=>{A.get("id")==p.id&&b.removeLayer(A)});break;case"changeOrder":if(s.selectLock)return;let{nodeIndex:H,subNodeIndex:U,nestedSubNodeIndex:G}=i.getLayerIndex(p.id),ye=i.getLayer(s.layers[H].group_layers[U],G,p.id);if(p.movement==="up"){if(p.key+1==w.getArray().length)return;let x={checked:!1,nodeIndex:H,subNodeIndex:U,nestedSubNodeIndex:G,id:p.id};d({action:"layerMode",value:x}),w.insertAt(p.key+1,ye)}if(p.movement==="down"){if(p.key-1==0)return;let x={checked:!1,nodeIndex:H,subNodeIndex:U,nestedSubNodeIndex:G,id:p.id};d({action:"layerMode",value:x}),w.insertAt(p.key-1,ye)}break;case"changeLayerVisible":if(s.selectLock)return;let Oe=!w.getArray()[p.key].getVisible();w.getArray()[p.key].setVisible(Oe);break;case"baseMap":s.temp[`map${s.targetNum}BaseStatus`]=p.baseId;let It=new je({preload:1/0,name:p.name,label:p.label,type:p.mapType,baseId:p.baseId,source:new dt({url:p.url}),crossOrigin:"anonymous"}),Rt=b==null?void 0:b.getLayers().getArray();w.insertAt(0,It),Rt.forEach(x=>(x.get("type")=="base"&&x.get("baseId")!==p.baseId&&b.removeLayer(x),!0));break;case"changeMapCount":if(s.mapCount===p.qty)return;let te=s.targetNum!==1?"map1":"map2";s.mapCount=p.qty;let Pt=s[`${te}LayerStatus`].filter(x=>x!=="3D").map(x=>xe.getLayerIndex(x));if(p.qty===2&&(s[te]=new Se({target:te,layers:[we.getBaseMapData(0),...Pt.map(x=>i.getLayer(s.layers[x.nodeIndex].group_layers[x.subNodeIndex],x.nestedSubNodeIndex,x.id))],view:o,controls:[]}),((P=s[`${te}LayerStatus`])==null?void 0:P.indexOf("3D"))!==-1)){r=new ue({map:s[te]}),r.setEnabled(!0),Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0NzM3MWFhYS0xMjNlLTQ3MTMtODFjZS0xZjMzM2I5NGZiYTEiLCJpZCI6MTMwODE4LCJpYXQiOjE2ODQwNzM3Mjl9.UYu4kBialPo19dcvosHzZTpg2BD1zkFQnjCD78YiiYo";let x=r.getCesiumScene({});x.terrainProvider=Cesium.createWorldTerrain({})}if(p.qty===1){s[te]=null;const x=document.getElementById(te);for(;x.firstChild;)x.removeChild(x.firstChild)}break;case"changeDimensionMap":let _e=s.targetNum==1?"map1":"map2";if(s.dimensionMap[_e]=p,p==="3D"){const A=w.getArray().find(W=>W.get("label").includes("近年歷史災害82處部落點位"));A&&s[`map${s.targetNum}`].removeLayer(A),r=new ue({map:b}),r.setEnabled(!0),Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0NzM3MWFhYS0xMjNlLTQ3MTMtODFjZS0xZjMzM2I5NGZiYTEiLCJpZCI6MTMwODE4LCJpYXQiOjE2ODQwNzM3Mjl9.UYu4kBialPo19dcvosHzZTpg2BD1zkFQnjCD78YiiYo";let F=r.getCesiumScene({});F.terrainProvider=Cesium.createWorldTerrain({}),s[`${_e}LayerStatus`].push("3D")}else r.setEnabled(!1),s[`${_e}LayerStatus`]=s[`${_e}LayerStatus`].filter(x=>x!=="3D"),s[`map${s.targetNum}LayerStatus`].forEach(x=>{let{nodeIndex:A,subNodeIndex:F,nestedSubNodeIndex:W}=i.getLayerIndex(x);return i.getLayer(s.layers[A].group_layers[F],W,p.id).get("label").includes("近年歷史災害82處部落點位")&&d({action:"layerMode",value:{checked:!0,nodeIndex:A,subNodeIndex:F,nestedSubNodeIndex:W,id:x}}),x});break;case"setOpacity":w.getArray()[p.key].setOpacity(Number(p.value));break}h()}function m(v){var b;s.targetNum=v;let p=s.targetNum!==1?"map1":"map2";if(s.mapCount===1){if(!s[`map${v}`]){let w=s[`map${v}LayerStatus`].filter(T=>T!=="3D");w.includes("node0_subNode4_nestedSubNodeundefined")&&(w=[...w.filter(P=>P!=="node0_subNode4_nestedSubNodeundefined"),"node0_subNode4_nestedSubNodeundefined"]);let I=w.map(T=>xe.getLayerIndex(T));s[`map${v}`]=new Se({target:`map${v}`,layers:[we.getBaseMapData(s.temp[`map${s.targetNum}BaseStatus`]),...I.map(T=>i.getLayer(s.layers[T.nodeIndex].group_layers[T.subNodeIndex],T.nestedSubNodeIndex,T.layeredIndex))],view:o,controls:[]}),S(s[`map${v}`]),((b=s[`map${v}LayerStatus`])==null?void 0:b.indexOf("3D"))!==-1&&(r=new ue({map:s[`map${v}`]}),r.setEnabled(!0))}if(s[p]){s[p]=null;const w=document.getElementById(p);for(;w.firstChild;)w.removeChild(w.firstChild)}}Qe(()=>{h()})}function h(){var b;let v=s.targetNum==1?s.map1:s.map2;const p=(b=v==null?void 0:v.getLayers())==null?void 0:b.getArray();s.currentLayers=p==null?void 0:p.map(w=>({label:w.get("label"),id:w.get("id"),visible:w.getVisible()}))}function f(){s.conditionWrap=!s.conditionWrap}function y(v,p,b){if(v==="add")s[`${p}LayerStatus`].push(b);else if(v==="delete"){let w=s[`${p}LayerStatus`].findIndex(I=>I===b);s[`${p}LayerStatus`].splice(w,1)}else console.log("error")}function S(v){var b;let p=new ni({layers:(b=v==null?void 0:v.getLayers())==null?void 0:b.getArray(),condition:oi});v.addInteraction(p),p.on("select",w=>{let I=w.selected[0];if(I){s.popup.overlay=new ut({element:s.popup.nodeRef,autoPan:!0,autoPanAnimation:{duration:250}}),s.popup.overlay.setPosition(w.mapBrowserEvent.coordinate),v.addOverlay(s.popup.overlay);let T=I.getId().split(".");s.popup.popupData=T[0],s.popup.coordinate=w.mapBrowserEvent.coordinate,T[0]==="新竹縣原住民部落範圍"&&(s.popup.popupId=I.get("編號")),T[0]==="近年歷史災害82處部落點位"&&(s.popup.popupId=T[1])}else v.removeOverlay(s.popup.overlay),s.popup.overlay=null,s.popup={nodeRef:null,overlay:null,popupId:0,coordinate:[],popupData:""}})}function g(){(s.targetNum==1?s.map1:s.map2).removeOverlay(s.popup.overlay),s.popup.overlay=null}function L(v){const{checked:p,id:b}=v;if(!p){s.selectLayerOption={};return}b==="node4_subNode0_nestedSubNodeundefined"&&J.ajax({url:"https://api.edtest.site/tribeQuery",method:"GET",success:w=>{s.tribeQuery=w},error:w=>{console.log(w)}})}function D(v){let p={action:"moveTo",value:{xAxis:v.WGS84.lng,yAxis:v.WGS84.lat}};u(p)}return Ie(async()=>{let v=J.ajax({url:"https://api.edtest.site/underLayers",method:"GET"}).done(b=>b),p=J.ajax({url:"https://api.edtest.site/layers",method:"GET"}).done(b=>b);Promise.all([v,p]).then(b=>{let w=b[0].data.map((I,T)=>({mapType:"base",baseId:T,onCurrent:!1,...I}));we.setBaseMapData(w),s.temp.map1BaseStatus=0,s.temp.baseMapList=so(),s.layers=b[1].map((I,T)=>(I.group_layers.forEach((P,H)=>{let U=H,G;P.id=`node${T}_subNode${U}_nestedSubNode${G}`,P.single_tiles||P.tiles_list.forEach((ye,Oe)=>{G=Oe,ye.id=`node${T}_subNode${U}_nestedSubNode${G}`})}),{...I,value:T})),Qe(()=>{a(),h()})}),s.comSize.wrapHeight=window.innerHeight,s.comSize.wrapWidth=window.innerWidth,window.onresize=b=>{s.comSize.wrapHeight=b.target.innerHeight,s.comSize.wrapWidth=b.target.innerWidth}}),{state:s,props:n,store:t,mapControl:u,layerControl:d,changeTarget:m,conditionWrap:f,closeMapData:g,moveToMap:D}}},Fr={class:"w-100 d-flex justify-content-between flex-sm-row flex-wrap flex-sm-nowrap mapWrap",id:"mapWrap"},Vr={key:0,class:"middleLine"},Nr={class:"SearchBar d-none d-sm-block position-absolute"},Br={class:"d-flex align-items-center"},Gr=c("img",{src:xt,alt:"",class:"me-5"},null,-1),Wr={class:"conditionCom d-none d-sm-block position-absolute"},jr={class:"mb-4"},Hr={key:1},$r={class:"m-Navbar d-flex d-sm-none position-fixed bottom-0 start-0 w-100"},zr={key:1},Ur={key:0,class:"lightWrap w-100 h-100 d-flex justify-content-center align-items-center"},Kr={class:"p-4 rounded bg-white",style:{width:"250px"}},qr=c("p",{class:"text-center fw-bold"},"是否要刪除全部圖層",-1),Yr={class:"d-flex justify-content-around"};function Zr(n,e,i,t,s,r){var y,S;const o=Sr,a=or,l=tr,u=ko,d=Pe,m=eo,h=xn,f=Qs;return _(),C("div",null,[c("div",Fr,[c("div",{id:"map1",class:j({"w-100":((y=t.state.map1)==null?void 0:y.getTarget())=="map1","h-100":t.state.mapCount===1,"h-50":t.state.mapCount===2&&t.state.comSize.wrapWidth<600})},null,2),t.state.mapCount===2?(_(),C("div",Vr)):M("",!0),c("div",{id:"map2",class:j({"w-100":((S=t.state.map2)==null?void 0:S.getTarget())=="map2","h-100":t.state.mapCount===1,"h-50":t.state.mapCount===2&&t.state.comSize.wrapWidth<600})},null,2)]),V(o,{class:"asideTool position-absolute top-50 translate-middle-y",id:"asideTool",onOnMapControl:e[0]||(e[0]=({action:g,value:L})=>{t.mapControl({action:g,value:L})})}),c("div",Nr,[c("div",Br,[Gr,V(a,{class:"mapSourceOption d-none d-sm-block",baseMapList:t.state.temp.baseMapList,onChangeBaseMaps:({action:g,value:L})=>{t.layerControl({action:g,value:L})}},null,8,["baseMapList","onChangeBaseMaps"])]),V(l,ve({class:"mt-4"},{dimensionMapStatus:t.state.toSearchDimensionStatus,currentLayers:t.state.currentLayers,mapCount:t.state.mapCount,onChangeBaseMaps:({action:g,value:L})=>{t.layerControl({action:g,value:L})}},{onOnLayerControl:e[1]||(e[1]=({action:g,value:L})=>{t.layerControl({action:g,value:L})}),onOnChangeTarget:e[2]||(e[2]=g=>{t.changeTarget(g)}),onConditionWrap:e[3]||(e[3]=g=>{t.conditionWrap(g)})}),null,16)]),c("div",Wr,[c("div",jr,[t.state.conditionWrap?M("",!0):(_(),C("button",{key:0,class:"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5",onClick:e[4]||(e[4]=g=>t.state.conditionWrap=!0)}," 圖層選項 ")),t.state.conditionWrap?(_(),C("div",{key:1,class:"mb-4",style:{"max-height":"50%"},ref:g=>{t.state.comSize.conditionCom=g},"on:onLayerControl":e[6]||(e[6]=({action:g,value:L})=>{t.layerControl({action:g,value:L})})},[V(u,ve({tribeQuery:t.state.tribeQuery,mapLayers:t.state.mapLayers,currentLayers:t.state.currentLayers,onClose:()=>{t.state.conditionWrap=!1},showSelectLayerValue:g=>{t.state.selectValueTemp=g},moveToMap:g=>{t.moveToMap(g)}},{onOnLayerControl:e[5]||(e[5]=({action:g,value:L})=>{t.layerControl({action:g,value:L})})}),null,16)],544)):M("",!0),V(d,{text:"可選擇要加入的圖層",styles:"right: 105%;top: 0;text-align: right;"})]),c("div",null,[t.state.layerSelect?M("",!0):(_(),C("button",{key:0,class:"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5",onClick:e[7]||(e[7]=g=>t.state.layerSelect=!0)}," 已選擇的圖層 ")),t.state.layerSelect?(_(),C("div",Hr,[V(m,li(ci({selectLock:t.state.selectLock,currentLayers:t.state.currentLayers,onClose:()=>{t.state.layerSelect=!1},onLockLayer:()=>{t.state.selectLock=!t.state.selectLock},onDeleteLayer:({action:g,value:L})=>{L.layerName=="all"?t.state.deleteLightbox=!0:t.layerControl({action:g,value:L})},onDeleteLayerAll:()=>{t.state.deleteLightbox=!0},onLayerControl:({action:g,value:L})=>{t.layerControl({action:g,value:L})}})),null,16)])):M("",!0),V(d,{text:"顯示已經選擇的圖層",styles:"right: 105%;top: 0;text-align: right;"})])]),c("div",$r,[t.state.conditionWrap?(_(),Xe(u,ve({key:0,class:"position-absolute bottom-100 w-100"},{mapLayers:t.state.mapLayers,currentLayers:t.state.currentLayers,onClose:()=>{t.state.conditionWrap=!1},showSelectLayerValue:g=>{t.state.selectValueTemp=g}},{onOnLayerControl:e[8]||(e[8]=({action:g,value:L})=>{t.layerControl({action:g,value:L})})}),null,16)):M("",!0),t.state.layerSelect?(_(),C("div",zr,[V(m,ve({class:"position-absolute bottom-100 w-100"},{selectLock:t.state.selectLock,currentLayers:t.state.currentLayers,onClose:()=>{t.state.layerSelect=!1},onChangLayerVisible:g=>{t.layerControl(g)},onChangeOrderLayer:({action:g,value:L})=>{t.layerControl({action:g,value:L})},onLockLayer:()=>{t.state.selectLock=!t.state.selectLock},onDeleteLayer:({action:g,value:L})=>{L.layerName=="all"?t.state.deleteLightbox=!0:t.layerControl({action:g,value:L})},onDeleteLayerAll:()=>{t.state.deleteLightbox=!0}},{setOpacity:({action:g,value:L})=>{t.layerControl({action:g,value:L})}}),null,16,["setOpacity"])])):M("",!0),V(h,{dimensionMapStatus:t.state.toSearchDimensionStatus,currentLayers:t.state.currentLayers,mapCount:t.state.mapCount,openConditionWrap:()=>{t.state.conditionWrap=!t.state.conditionWrap,t.state.layerSelect=!1},openLayerSelect:()=>{t.state.layerSelect=!t.state.layerSelect,t.state.conditionWrap=!1},onLayerControl:({action:g,value:L})=>{t.layerControl({action:g,value:L})},onChangeTarget:g=>{t.changeTarget(g)},onConditionWrap:e[9]||(e[9]=g=>{t.conditionWrap(g)})},null,8,["dimensionMapStatus","currentLayers","mapCount","openConditionWrap","openLayerSelect","onLayerControl","onChangeTarget"])]),t.state.deleteLightbox?(_(),C("div",Ur,[c("div",Kr,[qr,c("div",Yr,[c("button",{class:"rounded px-3 py-1 bg-steel text-white border-0",onClick:e[10]||(e[10]=()=>{t.layerControl({action:"selectLayerMode",value:{layerName:"all"}}),t.state.deleteLightbox=!1})},"確定"),c("button",{class:"rounded px-3 py-1 bg-secondary bg-gradient text-white border-0",onClick:e[11]||(e[11]=()=>{t.state.deleteLightbox=!1})},"取消")])])])):M("",!0),c("div",{id:"popup",class:"position-absolute bottom-0",ref:g=>{t.state.popup.nodeRef=g}},[t.state.popup.popupId!==0?(_(),Xe(f,{key:0,class:"areaData",closeMapData:()=>{t.closeMapData()},popup:t.state.popup,maxHeight:500},null,8,["closeMapData","popup"])):M("",!0)],512),t.store.state.isInit?(_(),C("div",{key:1,class:"stepOverLayer",id:"firstEnter",onClick:e[12]||(e[12]=()=>{t.store.dispatch("updateLayerStatus",!1)})})):M("",!0)])}const ea=$(Ar,[["render",Zr]]);export{ea as default};
//# sourceMappingURL=WebMap-7c74745b.js.map
