{"version":3,"file":"WebMap-6627fddd.js","sources":["../../node_modules/ol/Feature.js","../../node_modules/ol/style/Fill.js","../../node_modules/ol/geom/flat/interpolate.js","../../node_modules/ol/geom/flat/length.js","../../node_modules/ol/geom/LineString.js","../../node_modules/ol/style/Stroke.js","../../node_modules/ol/style/Image.js","../../node_modules/ol/colorlike.js","../../node_modules/ol/style/RegularShape.js","../../node_modules/ol/style/Circle.js","../../node_modules/ol/style/Style.js","../../node_modules/ol/style/Text.js","../../node_modules/quickselect/index.js","../../node_modules/rbush/index.js","../../node_modules/ol/style/IconImage.js","../../node_modules/ol/style/Icon.js","../../node_modules/ol/style/flat.js","../../node_modules/ol/layer/BaseVector.js","../../node_modules/ol/render/canvas/Instruction.js","../../node_modules/ol/render/VectorContext.js","../../node_modules/ol/render/canvas/Builder.js","../../node_modules/ol/render/canvas/ImageBuilder.js","../../node_modules/ol/render/canvas/LineStringBuilder.js","../../node_modules/ol/render/canvas/PolygonBuilder.js","../../node_modules/ol/geom/flat/straightchunk.js","../../node_modules/ol/render/canvas/TextBuilder.js","../../node_modules/ol/render/canvas/BuilderGroup.js","../../node_modules/ol/geom/flat/textpath.js","../../node_modules/ol/render/canvas/Executor.js","../../node_modules/ol/render/canvas/ExecutorGroup.js","../../node_modules/ol/render/canvas/Immediate.js","../../node_modules/ol/render/canvas/hitdetect.js","../../node_modules/ol/renderer/vector.js","../../node_modules/ol/renderer/canvas/VectorLayer.js","../../node_modules/ol/layer/Vector.js","../../node_modules/ol/structs/RBush.js","../../node_modules/ol/source/VectorEventType.js","../../node_modules/ol/loadingstrategy.js","../../node_modules/ol/featureloader.js","../../node_modules/ol/source/Vector.js","../../node_modules/ol/render.js","../../node_modules/ol/Overlay.js","../../node_modules/ol/VectorRenderTile.js","../../node_modules/ol/VectorTile.js","../../node_modules/ol/source/Cluster.js","../../node_modules/ol/source/ImageWMS.js","../../node_modules/ol/source/VectorTile.js","../../node_modules/ol/tilegrid/WMTS.js","../../node_modules/ol/source/WMTS.js","../../node_modules/ol/format/Feature.js","../../node_modules/ol/geom/MultiLineString.js","../../node_modules/ol/geom/MultiPoint.js","../../node_modules/ol/geom/flat/center.js","../../node_modules/ol/geom/MultiPolygon.js","../../node_modules/ieee754/index.js","../../node_modules/pbf/index.js","../../node_modules/ol/geom/GeometryCollection.js","../../node_modules/ol/render/Feature.js","../../node_modules/ol/format/MVT.js","../../node_modules/ol/renderer/canvas/VectorTileLayer.js","../../node_modules/ol/layer/VectorTile.js","../../node_modules/ol/format/JSONFeature.js","../../node_modules/ol/format/GeoJSON.js","../../node_modules/html-to-image/es/util.js","../../node_modules/html-to-image/es/clone-pseudos.js","../../node_modules/html-to-image/es/mimes.js","../../node_modules/html-to-image/es/dataurl.js","../../node_modules/html-to-image/es/clone-node.js","../../node_modules/html-to-image/es/embed-resources.js","../../node_modules/html-to-image/es/embed-images.js","../../node_modules/html-to-image/es/apply-style.js","../../node_modules/html-to-image/es/embed-webfonts.js","../../node_modules/html-to-image/es/index.js","../../src/assets/img/icon/currentPosition.svg","../../src/components/AreaImg.vue","../../src/assets/img/icon/vector.svg","../../src/components/AreaData.vue","../../src/assets/img/icon/2D-m.svg","../../src/assets/img/icon/3D-m.svg","../../src/assets/img/icon/vector-m.svg","../../src/assets/img/icon/selectVector-m.svg","../../src/assets/img/icon/singleWindow-m.svg","../../src/assets/img/icon/doubleWindow-m.svg","../../src/components/MNavbar.vue","../../src/assets/img/icon/lockOpen.svg","../../src/assets/img/icon/deleteLayer.svg","../../src/assets/img/icon/arrow_up.svg","../../src/assets/img/icon/arrow_down.svg","../../src/assets/img/icon/eyes.svg","../../src/components/LayerSelector.vue","../../src/components/OverLayer.vue","../../src/config/mapLayerList.js","../../src/config/baseMapList.js","../../src/components/Condition.vue","../../src/assets/img/icon/2D.svg","../../src/assets/img/icon/3D.svg","../../src/assets/img/icon/baseLayer.svg","../../src/assets/img/icon/singleWindow.svg","../../src/assets/img/icon/doubleWindows.svg","../../src/components/SearchBar.vue","../../src/components/MapSourceOption.vue","../../src/assets/img/icon/zoomIn.svg","../../src/assets/img/icon/zoomOut.svg","../../src/assets/img/icon/compass.svg","../../src/assets/img/icon/location.svg","../../src/assets/img/icon/zoom.svg","../../src/components/AsideTool.vue","../../node_modules/ol/interaction/Select.js","../../node_modules/ol/control/ScaleLine.js","../../node_modules/olcs/util.js","../../node_modules/olcs/core/OLImageryProvider.js","../../node_modules/olcs/MVTImageryProvider.js","../../node_modules/olcs/core.js","../../node_modules/olcs/AutoRenderLoop.js","../../node_modules/olcs/math.js","../../node_modules/olcs/Camera.js","../../node_modules/olcs/AbstractSynchronizer.js","../../node_modules/olcs/RasterSynchronizer.js","../../node_modules/olcs/core/VectorLayerCounterpart.js","../../node_modules/olcs/FeatureConverter.js","../../node_modules/olcs/VectorSynchronizer.js","../../node_modules/olcs/SynchronizedOverlay.js","../../node_modules/olcs/OverlaySynchronizer.js","../../node_modules/olcs/OLCesium.js","../../src/assets/logo.svg","../../src/view/WebMap.vue"],"sourcesContent":["/**\n * @module ol/Feature\n */\nimport BaseObject from './Object.js';\nimport EventType from './events/EventType.js';\nimport {assert} from './asserts.js';\nimport {listen, unlistenByKey} from './events.js';\n\n/**\n * @typedef {typeof Feature|typeof import(\"./render/Feature.js\").default} FeatureClass\n */\n\n/**\n * @typedef {Feature|import(\"./render/Feature.js\").default} FeatureLike\n */\n\n/***\n * @template Return\n * @typedef {import(\"./Observable\").OnSignature<import(\"./Observable\").EventTypes, import(\"./events/Event.js\").default, Return> &\n *   import(\"./Observable\").OnSignature<import(\"./ObjectEventType\").Types|'change:geometry', import(\"./Object\").ObjectEvent, Return> &\n *   import(\"./Observable\").CombinedOnSignature<import(\"./Observable\").EventTypes|import(\"./ObjectEventType\").Types\n *     |'change:geometry', Return>} FeatureOnSignature\n */\n\n/***\n * @template Geometry\n * @typedef {Object<string, *> & { geometry?: Geometry }} ObjectWithGeometry\n */\n\n/**\n * @classdesc\n * A vector object for geographic features with a geometry and other\n * attribute properties, similar to the features in vector file formats like\n * GeoJSON.\n *\n * Features can be styled individually with `setStyle`; otherwise they use the\n * style of their vector layer.\n *\n * Note that attribute properties are set as {@link module:ol/Object~BaseObject} properties on\n * the feature object, so they are observable, and have get/set accessors.\n *\n * Typically, a feature has a single geometry property. You can set the\n * geometry using the `setGeometry` method and get it with `getGeometry`.\n * It is possible to store more than one geometry on a feature using attribute\n * properties. By default, the geometry used for rendering is identified by\n * the property name `geometry`. If you want to use another geometry property\n * for rendering, use the `setGeometryName` method to change the attribute\n * property associated with the geometry for the feature.  For example:\n *\n * ```js\n *\n * import Feature from 'ol/Feature.js';\n * import Polygon from 'ol/geom/Polygon.js';\n * import Point from 'ol/geom/Point.js';\n *\n * const feature = new Feature({\n *   geometry: new Polygon(polyCoords),\n *   labelPoint: new Point(labelCoords),\n *   name: 'My Polygon',\n * });\n *\n * // get the polygon geometry\n * const poly = feature.getGeometry();\n *\n * // Render the feature as a point using the coordinates from labelPoint\n * feature.setGeometryName('labelPoint');\n *\n * // get the point geometry\n * const point = feature.getGeometry();\n * ```\n *\n * @api\n * @template {import(\"./geom/Geometry.js\").default} [Geometry=import(\"./geom/Geometry.js\").default]\n */\nclass Feature extends BaseObject {\n  /**\n   * @param {Geometry|ObjectWithGeometry<Geometry>} [geometryOrProperties]\n   *     You may pass a Geometry object directly, or an object literal containing\n   *     properties. If you pass an object literal, you may include a Geometry\n   *     associated with a `geometry` key.\n   */\n  constructor(geometryOrProperties) {\n    super();\n\n    /***\n     * @type {FeatureOnSignature<import(\"./events\").EventsKey>}\n     */\n    this.on;\n\n    /***\n     * @type {FeatureOnSignature<import(\"./events\").EventsKey>}\n     */\n    this.once;\n\n    /***\n     * @type {FeatureOnSignature<void>}\n     */\n    this.un;\n\n    /**\n     * @private\n     * @type {number|string|undefined}\n     */\n    this.id_ = undefined;\n\n    /**\n     * @type {string}\n     * @private\n     */\n    this.geometryName_ = 'geometry';\n\n    /**\n     * User provided style.\n     * @private\n     * @type {import(\"./style/Style.js\").StyleLike}\n     */\n    this.style_ = null;\n\n    /**\n     * @private\n     * @type {import(\"./style/Style.js\").StyleFunction|undefined}\n     */\n    this.styleFunction_ = undefined;\n\n    /**\n     * @private\n     * @type {?import(\"./events.js\").EventsKey}\n     */\n    this.geometryChangeKey_ = null;\n\n    this.addChangeListener(this.geometryName_, this.handleGeometryChanged_);\n\n    if (geometryOrProperties) {\n      if (\n        typeof (\n          /** @type {?} */ (geometryOrProperties).getSimplifiedGeometry\n        ) === 'function'\n      ) {\n        const geometry = /** @type {Geometry} */ (geometryOrProperties);\n        this.setGeometry(geometry);\n      } else {\n        /** @type {Object<string, *>} */\n        const properties = geometryOrProperties;\n        this.setProperties(properties);\n      }\n    }\n  }\n\n  /**\n   * Clone this feature. If the original feature has a geometry it\n   * is also cloned. The feature id is not set in the clone.\n   * @return {Feature<Geometry>} The clone.\n   * @api\n   */\n  clone() {\n    const clone = /** @type {Feature<Geometry>} */ (\n      new Feature(this.hasProperties() ? this.getProperties() : null)\n    );\n    clone.setGeometryName(this.getGeometryName());\n    const geometry = this.getGeometry();\n    if (geometry) {\n      clone.setGeometry(/** @type {Geometry} */ (geometry.clone()));\n    }\n    const style = this.getStyle();\n    if (style) {\n      clone.setStyle(style);\n    }\n    return clone;\n  }\n\n  /**\n   * Get the feature's default geometry.  A feature may have any number of named\n   * geometries.  The \"default\" geometry (the one that is rendered by default) is\n   * set when calling {@link module:ol/Feature~Feature#setGeometry}.\n   * @return {Geometry|undefined} The default geometry for the feature.\n   * @api\n   * @observable\n   */\n  getGeometry() {\n    return /** @type {Geometry|undefined} */ (this.get(this.geometryName_));\n  }\n\n  /**\n   * Get the feature identifier.  This is a stable identifier for the feature and\n   * is either set when reading data from a remote source or set explicitly by\n   * calling {@link module:ol/Feature~Feature#setId}.\n   * @return {number|string|undefined} Id.\n   * @api\n   */\n  getId() {\n    return this.id_;\n  }\n\n  /**\n   * Get the name of the feature's default geometry.  By default, the default\n   * geometry is named `geometry`.\n   * @return {string} Get the property name associated with the default geometry\n   *     for this feature.\n   * @api\n   */\n  getGeometryName() {\n    return this.geometryName_;\n  }\n\n  /**\n   * Get the feature's style. Will return what was provided to the\n   * {@link module:ol/Feature~Feature#setStyle} method.\n   * @return {import(\"./style/Style.js\").StyleLike|undefined} The feature style.\n   * @api\n   */\n  getStyle() {\n    return this.style_;\n  }\n\n  /**\n   * Get the feature's style function.\n   * @return {import(\"./style/Style.js\").StyleFunction|undefined} Return a function\n   * representing the current style of this feature.\n   * @api\n   */\n  getStyleFunction() {\n    return this.styleFunction_;\n  }\n\n  /**\n   * @private\n   */\n  handleGeometryChange_() {\n    this.changed();\n  }\n\n  /**\n   * @private\n   */\n  handleGeometryChanged_() {\n    if (this.geometryChangeKey_) {\n      unlistenByKey(this.geometryChangeKey_);\n      this.geometryChangeKey_ = null;\n    }\n    const geometry = this.getGeometry();\n    if (geometry) {\n      this.geometryChangeKey_ = listen(\n        geometry,\n        EventType.CHANGE,\n        this.handleGeometryChange_,\n        this\n      );\n    }\n    this.changed();\n  }\n\n  /**\n   * Set the default geometry for the feature.  This will update the property\n   * with the name returned by {@link module:ol/Feature~Feature#getGeometryName}.\n   * @param {Geometry|undefined} geometry The new geometry.\n   * @api\n   * @observable\n   */\n  setGeometry(geometry) {\n    this.set(this.geometryName_, geometry);\n  }\n\n  /**\n   * Set the style for the feature to override the layer style.  This can be a\n   * single style object, an array of styles, or a function that takes a\n   * resolution and returns an array of styles. To unset the feature style, call\n   * `setStyle()` without arguments or a falsey value.\n   * @param {import(\"./style/Style.js\").StyleLike} [style] Style for this feature.\n   * @api\n   * @fires module:ol/events/Event~BaseEvent#event:change\n   */\n  setStyle(style) {\n    this.style_ = style;\n    this.styleFunction_ = !style ? undefined : createStyleFunction(style);\n    this.changed();\n  }\n\n  /**\n   * Set the feature id.  The feature id is considered stable and may be used when\n   * requesting features or comparing identifiers returned from a remote source.\n   * The feature id can be used with the\n   * {@link module:ol/source/Vector~VectorSource#getFeatureById} method.\n   * @param {number|string|undefined} id The feature id.\n   * @api\n   * @fires module:ol/events/Event~BaseEvent#event:change\n   */\n  setId(id) {\n    this.id_ = id;\n    this.changed();\n  }\n\n  /**\n   * Set the property name to be used when getting the feature's default geometry.\n   * When calling {@link module:ol/Feature~Feature#getGeometry}, the value of the property with\n   * this name will be returned.\n   * @param {string} name The property name of the default geometry.\n   * @api\n   */\n  setGeometryName(name) {\n    this.removeChangeListener(this.geometryName_, this.handleGeometryChanged_);\n    this.geometryName_ = name;\n    this.addChangeListener(this.geometryName_, this.handleGeometryChanged_);\n    this.handleGeometryChanged_();\n  }\n}\n\n/**\n * Convert the provided object into a feature style function.  Functions passed\n * through unchanged.  Arrays of Style or single style objects wrapped\n * in a new feature style function.\n * @param {!import(\"./style/Style.js\").StyleFunction|!Array<import(\"./style/Style.js\").default>|!import(\"./style/Style.js\").default} obj\n *     A feature style function, a single style, or an array of styles.\n * @return {import(\"./style/Style.js\").StyleFunction} A style function.\n */\nexport function createStyleFunction(obj) {\n  if (typeof obj === 'function') {\n    return obj;\n  }\n  /**\n   * @type {Array<import(\"./style/Style.js\").default>}\n   */\n  let styles;\n  if (Array.isArray(obj)) {\n    styles = obj;\n  } else {\n    assert(typeof (/** @type {?} */ (obj).getZIndex) === 'function', 41); // Expected an `import(\"./style/Style.js\").Style` or an array of `import(\"./style/Style.js\").Style`\n    const style = /** @type {import(\"./style/Style.js\").default} */ (obj);\n    styles = [style];\n  }\n  return function () {\n    return styles;\n  };\n}\nexport default Feature;\n","/**\n * @module ol/style/Fill\n */\n\n/**\n * @typedef {Object} Options\n * @property {import(\"../color.js\").Color|import(\"../colorlike.js\").ColorLike|null} [color=null] A color, gradient or pattern.\n * See {@link module:ol/color~Color} and {@link module:ol/colorlike~ColorLike} for possible formats.\n * Default null; if null, the Canvas/renderer default black will be used.\n */\n\n/**\n * @classdesc\n * Set fill style for vector features.\n * @api\n */\nclass Fill {\n  /**\n   * @param {Options} [options] Options.\n   */\n  constructor(options) {\n    options = options || {};\n\n    /**\n     * @private\n     * @type {import(\"../color.js\").Color|import(\"../colorlike.js\").ColorLike|null}\n     */\n    this.color_ = options.color !== undefined ? options.color : null;\n  }\n\n  /**\n   * Clones the style. The color is not cloned if it is an {@link module:ol/colorlike~ColorLike}.\n   * @return {Fill} The cloned style.\n   * @api\n   */\n  clone() {\n    const color = this.getColor();\n    return new Fill({\n      color: Array.isArray(color) ? color.slice() : color || undefined,\n    });\n  }\n\n  /**\n   * Get the fill color.\n   * @return {import(\"../color.js\").Color|import(\"../colorlike.js\").ColorLike|null} Color.\n   * @api\n   */\n  getColor() {\n    return this.color_;\n  }\n\n  /**\n   * Set the color.\n   *\n   * @param {import(\"../color.js\").Color|import(\"../colorlike.js\").ColorLike|null} color Color.\n   * @api\n   */\n  setColor(color) {\n    this.color_ = color;\n  }\n}\n\nexport default Fill;\n","/**\n * @module ol/geom/flat/interpolate\n */\nimport {binarySearch} from '../../array.js';\nimport {lerp} from '../../math.js';\n\n/**\n * @param {Array<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @param {number} fraction Fraction.\n * @param {Array<number>} [dest] Destination.\n * @param {number} [dimension] Destination dimension (default is `2`)\n * @return {Array<number>} Destination.\n */\nexport function interpolatePoint(\n  flatCoordinates,\n  offset,\n  end,\n  stride,\n  fraction,\n  dest,\n  dimension\n) {\n  let o, t;\n  const n = (end - offset) / stride;\n  if (n === 1) {\n    o = offset;\n  } else if (n === 2) {\n    o = offset;\n    t = fraction;\n  } else if (n !== 0) {\n    let x1 = flatCoordinates[offset];\n    let y1 = flatCoordinates[offset + 1];\n    let length = 0;\n    const cumulativeLengths = [0];\n    for (let i = offset + stride; i < end; i += stride) {\n      const x2 = flatCoordinates[i];\n      const y2 = flatCoordinates[i + 1];\n      length += Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));\n      cumulativeLengths.push(length);\n      x1 = x2;\n      y1 = y2;\n    }\n    const target = fraction * length;\n    const index = binarySearch(cumulativeLengths, target);\n    if (index < 0) {\n      t =\n        (target - cumulativeLengths[-index - 2]) /\n        (cumulativeLengths[-index - 1] - cumulativeLengths[-index - 2]);\n      o = offset + (-index - 2) * stride;\n    } else {\n      o = offset + index * stride;\n    }\n  }\n  dimension = dimension > 1 ? dimension : 2;\n  dest = dest ? dest : new Array(dimension);\n  for (let i = 0; i < dimension; ++i) {\n    dest[i] =\n      o === undefined\n        ? NaN\n        : t === undefined\n        ? flatCoordinates[o + i]\n        : lerp(flatCoordinates[o + i], flatCoordinates[o + stride + i], t);\n  }\n  return dest;\n}\n\n/**\n * @param {Array<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @param {number} m M.\n * @param {boolean} extrapolate Extrapolate.\n * @return {import(\"../../coordinate.js\").Coordinate|null} Coordinate.\n */\nexport function lineStringCoordinateAtM(\n  flatCoordinates,\n  offset,\n  end,\n  stride,\n  m,\n  extrapolate\n) {\n  if (end == offset) {\n    return null;\n  }\n  let coordinate;\n  if (m < flatCoordinates[offset + stride - 1]) {\n    if (extrapolate) {\n      coordinate = flatCoordinates.slice(offset, offset + stride);\n      coordinate[stride - 1] = m;\n      return coordinate;\n    }\n    return null;\n  } else if (flatCoordinates[end - 1] < m) {\n    if (extrapolate) {\n      coordinate = flatCoordinates.slice(end - stride, end);\n      coordinate[stride - 1] = m;\n      return coordinate;\n    }\n    return null;\n  }\n  // FIXME use O(1) search\n  if (m == flatCoordinates[offset + stride - 1]) {\n    return flatCoordinates.slice(offset, offset + stride);\n  }\n  let lo = offset / stride;\n  let hi = end / stride;\n  while (lo < hi) {\n    const mid = (lo + hi) >> 1;\n    if (m < flatCoordinates[(mid + 1) * stride - 1]) {\n      hi = mid;\n    } else {\n      lo = mid + 1;\n    }\n  }\n  const m0 = flatCoordinates[lo * stride - 1];\n  if (m == m0) {\n    return flatCoordinates.slice((lo - 1) * stride, (lo - 1) * stride + stride);\n  }\n  const m1 = flatCoordinates[(lo + 1) * stride - 1];\n  const t = (m - m0) / (m1 - m0);\n  coordinate = [];\n  for (let i = 0; i < stride - 1; ++i) {\n    coordinate.push(\n      lerp(\n        flatCoordinates[(lo - 1) * stride + i],\n        flatCoordinates[lo * stride + i],\n        t\n      )\n    );\n  }\n  coordinate.push(m);\n  return coordinate;\n}\n\n/**\n * @param {Array<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array<number>} ends Ends.\n * @param {number} stride Stride.\n * @param {number} m M.\n * @param {boolean} extrapolate Extrapolate.\n * @param {boolean} interpolate Interpolate.\n * @return {import(\"../../coordinate.js\").Coordinate|null} Coordinate.\n */\nexport function lineStringsCoordinateAtM(\n  flatCoordinates,\n  offset,\n  ends,\n  stride,\n  m,\n  extrapolate,\n  interpolate\n) {\n  if (interpolate) {\n    return lineStringCoordinateAtM(\n      flatCoordinates,\n      offset,\n      ends[ends.length - 1],\n      stride,\n      m,\n      extrapolate\n    );\n  }\n  let coordinate;\n  if (m < flatCoordinates[stride - 1]) {\n    if (extrapolate) {\n      coordinate = flatCoordinates.slice(0, stride);\n      coordinate[stride - 1] = m;\n      return coordinate;\n    }\n    return null;\n  }\n  if (flatCoordinates[flatCoordinates.length - 1] < m) {\n    if (extrapolate) {\n      coordinate = flatCoordinates.slice(flatCoordinates.length - stride);\n      coordinate[stride - 1] = m;\n      return coordinate;\n    }\n    return null;\n  }\n  for (let i = 0, ii = ends.length; i < ii; ++i) {\n    const end = ends[i];\n    if (offset == end) {\n      continue;\n    }\n    if (m < flatCoordinates[offset + stride - 1]) {\n      return null;\n    } else if (m <= flatCoordinates[end - 1]) {\n      return lineStringCoordinateAtM(\n        flatCoordinates,\n        offset,\n        end,\n        stride,\n        m,\n        false\n      );\n    }\n    offset = end;\n  }\n  return null;\n}\n","/**\n * @module ol/geom/flat/length\n */\n\n/**\n * @param {Array<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @return {number} Length.\n */\nexport function lineStringLength(flatCoordinates, offset, end, stride) {\n  let x1 = flatCoordinates[offset];\n  let y1 = flatCoordinates[offset + 1];\n  let length = 0;\n  for (let i = offset + stride; i < end; i += stride) {\n    const x2 = flatCoordinates[i];\n    const y2 = flatCoordinates[i + 1];\n    length += Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));\n    x1 = x2;\n    y1 = y2;\n  }\n  return length;\n}\n\n/**\n * @param {Array<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @return {number} Perimeter.\n */\nexport function linearRingLength(flatCoordinates, offset, end, stride) {\n  let perimeter = lineStringLength(flatCoordinates, offset, end, stride);\n  const dx = flatCoordinates[end - stride] - flatCoordinates[offset];\n  const dy = flatCoordinates[end - stride + 1] - flatCoordinates[offset + 1];\n  perimeter += Math.sqrt(dx * dx + dy * dy);\n  return perimeter;\n}\n","/**\n * @module ol/geom/LineString\n */\nimport SimpleGeometry from './SimpleGeometry.js';\nimport {assignClosestPoint, maxSquaredDelta} from './flat/closest.js';\nimport {closestSquaredDistanceXY} from '../extent.js';\nimport {deflateCoordinates} from './flat/deflate.js';\nimport {douglasPeucker} from './flat/simplify.js';\nimport {extend} from '../array.js';\nimport {forEach as forEachSegment} from './flat/segments.js';\nimport {inflateCoordinates} from './flat/inflate.js';\nimport {interpolatePoint, lineStringCoordinateAtM} from './flat/interpolate.js';\nimport {intersectsLineString} from './flat/intersectsextent.js';\nimport {lineStringLength} from './flat/length.js';\n\n/**\n * @classdesc\n * Linestring geometry.\n *\n * @api\n */\nclass LineString extends SimpleGeometry {\n  /**\n   * @param {Array<import(\"../coordinate.js\").Coordinate>|Array<number>} coordinates Coordinates.\n   *     For internal use, flat coordinates in combination with `layout` are also accepted.\n   * @param {import(\"./Geometry.js\").GeometryLayout} [layout] Layout.\n   */\n  constructor(coordinates, layout) {\n    super();\n\n    /**\n     * @private\n     * @type {import(\"../coordinate.js\").Coordinate}\n     */\n    this.flatMidpoint_ = null;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.flatMidpointRevision_ = -1;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.maxDelta_ = -1;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.maxDeltaRevision_ = -1;\n\n    if (layout !== undefined && !Array.isArray(coordinates[0])) {\n      this.setFlatCoordinates(\n        layout,\n        /** @type {Array<number>} */ (coordinates)\n      );\n    } else {\n      this.setCoordinates(\n        /** @type {Array<import(\"../coordinate.js\").Coordinate>} */ (\n          coordinates\n        ),\n        layout\n      );\n    }\n  }\n\n  /**\n   * Append the passed coordinate to the coordinates of the linestring.\n   * @param {import(\"../coordinate.js\").Coordinate} coordinate Coordinate.\n   * @api\n   */\n  appendCoordinate(coordinate) {\n    if (!this.flatCoordinates) {\n      this.flatCoordinates = coordinate.slice();\n    } else {\n      extend(this.flatCoordinates, coordinate);\n    }\n    this.changed();\n  }\n\n  /**\n   * Make a complete copy of the geometry.\n   * @return {!LineString} Clone.\n   * @api\n   */\n  clone() {\n    const lineString = new LineString(\n      this.flatCoordinates.slice(),\n      this.layout\n    );\n    lineString.applyProperties(this);\n    return lineString;\n  }\n\n  /**\n   * @param {number} x X.\n   * @param {number} y Y.\n   * @param {import(\"../coordinate.js\").Coordinate} closestPoint Closest point.\n   * @param {number} minSquaredDistance Minimum squared distance.\n   * @return {number} Minimum squared distance.\n   */\n  closestPointXY(x, y, closestPoint, minSquaredDistance) {\n    if (minSquaredDistance < closestSquaredDistanceXY(this.getExtent(), x, y)) {\n      return minSquaredDistance;\n    }\n    if (this.maxDeltaRevision_ != this.getRevision()) {\n      this.maxDelta_ = Math.sqrt(\n        maxSquaredDelta(\n          this.flatCoordinates,\n          0,\n          this.flatCoordinates.length,\n          this.stride,\n          0\n        )\n      );\n      this.maxDeltaRevision_ = this.getRevision();\n    }\n    return assignClosestPoint(\n      this.flatCoordinates,\n      0,\n      this.flatCoordinates.length,\n      this.stride,\n      this.maxDelta_,\n      false,\n      x,\n      y,\n      closestPoint,\n      minSquaredDistance\n    );\n  }\n\n  /**\n   * Iterate over each segment, calling the provided callback.\n   * If the callback returns a truthy value the function returns that\n   * value immediately. Otherwise the function returns `false`.\n   *\n   * @param {function(this: S, import(\"../coordinate.js\").Coordinate, import(\"../coordinate.js\").Coordinate): T} callback Function\n   *     called for each segment. The function will receive two arguments, the start and end coordinates of the segment.\n   * @return {T|boolean} Value.\n   * @template T,S\n   * @api\n   */\n  forEachSegment(callback) {\n    return forEachSegment(\n      this.flatCoordinates,\n      0,\n      this.flatCoordinates.length,\n      this.stride,\n      callback\n    );\n  }\n\n  /**\n   * Returns the coordinate at `m` using linear interpolation, or `null` if no\n   * such coordinate exists.\n   *\n   * `extrapolate` controls extrapolation beyond the range of Ms in the\n   * MultiLineString. If `extrapolate` is `true` then Ms less than the first\n   * M will return the first coordinate and Ms greater than the last M will\n   * return the last coordinate.\n   *\n   * @param {number} m M.\n   * @param {boolean} [extrapolate] Extrapolate. Default is `false`.\n   * @return {import(\"../coordinate.js\").Coordinate|null} Coordinate.\n   * @api\n   */\n  getCoordinateAtM(m, extrapolate) {\n    if (this.layout != 'XYM' && this.layout != 'XYZM') {\n      return null;\n    }\n    extrapolate = extrapolate !== undefined ? extrapolate : false;\n    return lineStringCoordinateAtM(\n      this.flatCoordinates,\n      0,\n      this.flatCoordinates.length,\n      this.stride,\n      m,\n      extrapolate\n    );\n  }\n\n  /**\n   * Return the coordinates of the linestring.\n   * @return {Array<import(\"../coordinate.js\").Coordinate>} Coordinates.\n   * @api\n   */\n  getCoordinates() {\n    return inflateCoordinates(\n      this.flatCoordinates,\n      0,\n      this.flatCoordinates.length,\n      this.stride\n    );\n  }\n\n  /**\n   * Return the coordinate at the provided fraction along the linestring.\n   * The `fraction` is a number between 0 and 1, where 0 is the start of the\n   * linestring and 1 is the end.\n   * @param {number} fraction Fraction.\n   * @param {import(\"../coordinate.js\").Coordinate} [dest] Optional coordinate whose values will\n   *     be modified. If not provided, a new coordinate will be returned.\n   * @return {import(\"../coordinate.js\").Coordinate} Coordinate of the interpolated point.\n   * @api\n   */\n  getCoordinateAt(fraction, dest) {\n    return interpolatePoint(\n      this.flatCoordinates,\n      0,\n      this.flatCoordinates.length,\n      this.stride,\n      fraction,\n      dest,\n      this.stride\n    );\n  }\n\n  /**\n   * Return the length of the linestring on projected plane.\n   * @return {number} Length (on projected plane).\n   * @api\n   */\n  getLength() {\n    return lineStringLength(\n      this.flatCoordinates,\n      0,\n      this.flatCoordinates.length,\n      this.stride\n    );\n  }\n\n  /**\n   * @return {Array<number>} Flat midpoint.\n   */\n  getFlatMidpoint() {\n    if (this.flatMidpointRevision_ != this.getRevision()) {\n      this.flatMidpoint_ = this.getCoordinateAt(0.5, this.flatMidpoint_);\n      this.flatMidpointRevision_ = this.getRevision();\n    }\n    return this.flatMidpoint_;\n  }\n\n  /**\n   * @param {number} squaredTolerance Squared tolerance.\n   * @return {LineString} Simplified LineString.\n   * @protected\n   */\n  getSimplifiedGeometryInternal(squaredTolerance) {\n    const simplifiedFlatCoordinates = [];\n    simplifiedFlatCoordinates.length = douglasPeucker(\n      this.flatCoordinates,\n      0,\n      this.flatCoordinates.length,\n      this.stride,\n      squaredTolerance,\n      simplifiedFlatCoordinates,\n      0\n    );\n    return new LineString(simplifiedFlatCoordinates, 'XY');\n  }\n\n  /**\n   * Get the type of this geometry.\n   * @return {import(\"./Geometry.js\").Type} Geometry type.\n   * @api\n   */\n  getType() {\n    return 'LineString';\n  }\n\n  /**\n   * Test if the geometry and the passed extent intersect.\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @return {boolean} `true` if the geometry and the extent intersect.\n   * @api\n   */\n  intersectsExtent(extent) {\n    return intersectsLineString(\n      this.flatCoordinates,\n      0,\n      this.flatCoordinates.length,\n      this.stride,\n      extent\n    );\n  }\n\n  /**\n   * Set the coordinates of the linestring.\n   * @param {!Array<import(\"../coordinate.js\").Coordinate>} coordinates Coordinates.\n   * @param {import(\"./Geometry.js\").GeometryLayout} [layout] Layout.\n   * @api\n   */\n  setCoordinates(coordinates, layout) {\n    this.setLayout(layout, coordinates, 1);\n    if (!this.flatCoordinates) {\n      this.flatCoordinates = [];\n    }\n    this.flatCoordinates.length = deflateCoordinates(\n      this.flatCoordinates,\n      0,\n      coordinates,\n      this.stride\n    );\n    this.changed();\n  }\n}\n\nexport default LineString;\n","/**\n * @module ol/style/Stroke\n */\n\n/**\n * @typedef {Object} Options\n * @property {import(\"../color.js\").Color|import(\"../colorlike.js\").ColorLike} [color] A color, gradient or pattern.\n * See {@link module:ol/color~Color} and {@link module:ol/colorlike~ColorLike} for possible formats.\n * Default null; if null, the Canvas/renderer default black will be used.\n * @property {CanvasLineCap} [lineCap='round'] Line cap style: `butt`, `round`, or `square`.\n * @property {CanvasLineJoin} [lineJoin='round'] Line join style: `bevel`, `round`, or `miter`.\n * @property {Array<number>} [lineDash] Line dash pattern. Default is `null` (no dash).\n * @property {number} [lineDashOffset=0] Line dash offset.\n * @property {number} [miterLimit=10] Miter limit.\n * @property {number} [width] Width.\n */\n\n/**\n * @classdesc\n * Set stroke style for vector features.\n * Note that the defaults given are the Canvas defaults, which will be used if\n * option is not defined. The `get` functions return whatever was entered in\n * the options; they will not return the default.\n * @api\n */\nclass Stroke {\n  /**\n   * @param {Options} [options] Options.\n   */\n  constructor(options) {\n    options = options || {};\n\n    /**\n     * @private\n     * @type {import(\"../color.js\").Color|import(\"../colorlike.js\").ColorLike}\n     */\n    this.color_ = options.color !== undefined ? options.color : null;\n\n    /**\n     * @private\n     * @type {CanvasLineCap|undefined}\n     */\n    this.lineCap_ = options.lineCap;\n\n    /**\n     * @private\n     * @type {Array<number>|null}\n     */\n    this.lineDash_ = options.lineDash !== undefined ? options.lineDash : null;\n\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n    this.lineDashOffset_ = options.lineDashOffset;\n\n    /**\n     * @private\n     * @type {CanvasLineJoin|undefined}\n     */\n    this.lineJoin_ = options.lineJoin;\n\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n    this.miterLimit_ = options.miterLimit;\n\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n    this.width_ = options.width;\n  }\n\n  /**\n   * Clones the style.\n   * @return {Stroke} The cloned style.\n   * @api\n   */\n  clone() {\n    const color = this.getColor();\n    return new Stroke({\n      color: Array.isArray(color) ? color.slice() : color || undefined,\n      lineCap: this.getLineCap(),\n      lineDash: this.getLineDash() ? this.getLineDash().slice() : undefined,\n      lineDashOffset: this.getLineDashOffset(),\n      lineJoin: this.getLineJoin(),\n      miterLimit: this.getMiterLimit(),\n      width: this.getWidth(),\n    });\n  }\n\n  /**\n   * Get the stroke color.\n   * @return {import(\"../color.js\").Color|import(\"../colorlike.js\").ColorLike} Color.\n   * @api\n   */\n  getColor() {\n    return this.color_;\n  }\n\n  /**\n   * Get the line cap type for the stroke.\n   * @return {CanvasLineCap|undefined} Line cap.\n   * @api\n   */\n  getLineCap() {\n    return this.lineCap_;\n  }\n\n  /**\n   * Get the line dash style for the stroke.\n   * @return {Array<number>|null} Line dash.\n   * @api\n   */\n  getLineDash() {\n    return this.lineDash_;\n  }\n\n  /**\n   * Get the line dash offset for the stroke.\n   * @return {number|undefined} Line dash offset.\n   * @api\n   */\n  getLineDashOffset() {\n    return this.lineDashOffset_;\n  }\n\n  /**\n   * Get the line join type for the stroke.\n   * @return {CanvasLineJoin|undefined} Line join.\n   * @api\n   */\n  getLineJoin() {\n    return this.lineJoin_;\n  }\n\n  /**\n   * Get the miter limit for the stroke.\n   * @return {number|undefined} Miter limit.\n   * @api\n   */\n  getMiterLimit() {\n    return this.miterLimit_;\n  }\n\n  /**\n   * Get the stroke width.\n   * @return {number|undefined} Width.\n   * @api\n   */\n  getWidth() {\n    return this.width_;\n  }\n\n  /**\n   * Set the color.\n   *\n   * @param {import(\"../color.js\").Color|import(\"../colorlike.js\").ColorLike} color Color.\n   * @api\n   */\n  setColor(color) {\n    this.color_ = color;\n  }\n\n  /**\n   * Set the line cap.\n   *\n   * @param {CanvasLineCap|undefined} lineCap Line cap.\n   * @api\n   */\n  setLineCap(lineCap) {\n    this.lineCap_ = lineCap;\n  }\n\n  /**\n   * Set the line dash.\n   *\n   * @param {Array<number>|null} lineDash Line dash.\n   * @api\n   */\n  setLineDash(lineDash) {\n    this.lineDash_ = lineDash;\n  }\n\n  /**\n   * Set the line dash offset.\n   *\n   * @param {number|undefined} lineDashOffset Line dash offset.\n   * @api\n   */\n  setLineDashOffset(lineDashOffset) {\n    this.lineDashOffset_ = lineDashOffset;\n  }\n\n  /**\n   * Set the line join.\n   *\n   * @param {CanvasLineJoin|undefined} lineJoin Line join.\n   * @api\n   */\n  setLineJoin(lineJoin) {\n    this.lineJoin_ = lineJoin;\n  }\n\n  /**\n   * Set the miter limit.\n   *\n   * @param {number|undefined} miterLimit Miter limit.\n   * @api\n   */\n  setMiterLimit(miterLimit) {\n    this.miterLimit_ = miterLimit;\n  }\n\n  /**\n   * Set the width.\n   *\n   * @param {number|undefined} width Width.\n   * @api\n   */\n  setWidth(width) {\n    this.width_ = width;\n  }\n}\n\nexport default Stroke;\n","/**\n * @module ol/style/Image\n */\nimport {abstract} from '../util.js';\nimport {toSize} from '../size.js';\n\n/**\n * @typedef {Object} Options\n * @property {number} opacity Opacity.\n * @property {boolean} rotateWithView If the image should get rotated with the view.\n * @property {number} rotation Rotation.\n * @property {number|import(\"../size.js\").Size} scale Scale.\n * @property {Array<number>} displacement Displacement.\n * @property {\"declutter\"|\"obstacle\"|\"none\"|undefined} declutterMode Declutter mode: `declutter`, `obstacle`, 'none */\n\n/**\n * @classdesc\n * A base class used for creating subclasses and not instantiated in\n * apps. Base class for {@link module:ol/style/Icon~Icon}, {@link module:ol/style/Circle~CircleStyle} and\n * {@link module:ol/style/RegularShape~RegularShape}.\n * @abstract\n * @api\n */\nclass ImageStyle {\n  /**\n   * @param {Options} options Options.\n   */\n  constructor(options) {\n    /**\n     * @private\n     * @type {number}\n     */\n    this.opacity_ = options.opacity;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.rotateWithView_ = options.rotateWithView;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.rotation_ = options.rotation;\n\n    /**\n     * @private\n     * @type {number|import(\"../size.js\").Size}\n     */\n    this.scale_ = options.scale;\n\n    /**\n     * @private\n     * @type {import(\"../size.js\").Size}\n     */\n    this.scaleArray_ = toSize(options.scale);\n\n    /**\n     * @private\n     * @type {Array<number>}\n     */\n    this.displacement_ = options.displacement;\n\n    /**\n     * @private\n     * @type {\"declutter\"|\"obstacle\"|\"none\"|undefined}\n     */\n    this.declutterMode_ = options.declutterMode;\n  }\n\n  /**\n   * Clones the style.\n   * @return {ImageStyle} The cloned style.\n   * @api\n   */\n  clone() {\n    const scale = this.getScale();\n    return new ImageStyle({\n      opacity: this.getOpacity(),\n      scale: Array.isArray(scale) ? scale.slice() : scale,\n      rotation: this.getRotation(),\n      rotateWithView: this.getRotateWithView(),\n      displacement: this.getDisplacement().slice(),\n      declutterMode: this.getDeclutterMode(),\n    });\n  }\n\n  /**\n   * Get the symbolizer opacity.\n   * @return {number} Opacity.\n   * @api\n   */\n  getOpacity() {\n    return this.opacity_;\n  }\n\n  /**\n   * Determine whether the symbolizer rotates with the map.\n   * @return {boolean} Rotate with map.\n   * @api\n   */\n  getRotateWithView() {\n    return this.rotateWithView_;\n  }\n\n  /**\n   * Get the symoblizer rotation.\n   * @return {number} Rotation.\n   * @api\n   */\n  getRotation() {\n    return this.rotation_;\n  }\n\n  /**\n   * Get the symbolizer scale.\n   * @return {number|import(\"../size.js\").Size} Scale.\n   * @api\n   */\n  getScale() {\n    return this.scale_;\n  }\n\n  /**\n   * Get the symbolizer scale array.\n   * @return {import(\"../size.js\").Size} Scale array.\n   */\n  getScaleArray() {\n    return this.scaleArray_;\n  }\n\n  /**\n   * Get the displacement of the shape\n   * @return {Array<number>} Shape's center displacement\n   * @api\n   */\n  getDisplacement() {\n    return this.displacement_;\n  }\n\n  /**\n   * Get the declutter mode of the shape\n   * @return {\"declutter\"|\"obstacle\"|\"none\"|undefined} Shape's declutter mode\n   * @api\n   */\n  getDeclutterMode() {\n    return this.declutterMode_;\n  }\n\n  /**\n   * Get the anchor point in pixels. The anchor determines the center point for the\n   * symbolizer.\n   * @abstract\n   * @return {Array<number>} Anchor.\n   */\n  getAnchor() {\n    return abstract();\n  }\n\n  /**\n   * Get the image element for the symbolizer.\n   * @abstract\n   * @param {number} pixelRatio Pixel ratio.\n   * @return {HTMLCanvasElement|HTMLVideoElement|HTMLImageElement} Image element.\n   */\n  getImage(pixelRatio) {\n    return abstract();\n  }\n\n  /**\n   * @abstract\n   * @return {HTMLCanvasElement|HTMLVideoElement|HTMLImageElement} Image element.\n   */\n  getHitDetectionImage() {\n    return abstract();\n  }\n\n  /**\n   * Get the image pixel ratio.\n   * @param {number} pixelRatio Pixel ratio.\n   * @return {number} Pixel ratio.\n   */\n  getPixelRatio(pixelRatio) {\n    return 1;\n  }\n\n  /**\n   * @abstract\n   * @return {import(\"../ImageState.js\").default} Image state.\n   */\n  getImageState() {\n    return abstract();\n  }\n\n  /**\n   * @abstract\n   * @return {import(\"../size.js\").Size} Image size.\n   */\n  getImageSize() {\n    return abstract();\n  }\n\n  /**\n   * Get the origin of the symbolizer.\n   * @abstract\n   * @return {Array<number>} Origin.\n   */\n  getOrigin() {\n    return abstract();\n  }\n\n  /**\n   * Get the size of the symbolizer (in pixels).\n   * @abstract\n   * @return {import(\"../size.js\").Size} Size.\n   */\n  getSize() {\n    return abstract();\n  }\n\n  /**\n   * Set the displacement.\n   *\n   * @param {Array<number>} displacement Displacement.\n   * @api\n   */\n  setDisplacement(displacement) {\n    this.displacement_ = displacement;\n  }\n\n  /**\n   * Set the opacity.\n   *\n   * @param {number} opacity Opacity.\n   * @api\n   */\n  setOpacity(opacity) {\n    this.opacity_ = opacity;\n  }\n\n  /**\n   * Set whether to rotate the style with the view.\n   *\n   * @param {boolean} rotateWithView Rotate with map.\n   * @api\n   */\n  setRotateWithView(rotateWithView) {\n    this.rotateWithView_ = rotateWithView;\n  }\n\n  /**\n   * Set the rotation.\n   *\n   * @param {number} rotation Rotation.\n   * @api\n   */\n  setRotation(rotation) {\n    this.rotation_ = rotation;\n  }\n\n  /**\n   * Set the scale.\n   *\n   * @param {number|import(\"../size.js\").Size} scale Scale.\n   * @api\n   */\n  setScale(scale) {\n    this.scale_ = scale;\n    this.scaleArray_ = toSize(scale);\n  }\n\n  /**\n   * @abstract\n   * @param {function(import(\"../events/Event.js\").default): void} listener Listener function.\n   */\n  listenImageChange(listener) {\n    abstract();\n  }\n\n  /**\n   * Load not yet loaded URI.\n   * @abstract\n   */\n  load() {\n    abstract();\n  }\n\n  /**\n   * @abstract\n   * @param {function(import(\"../events/Event.js\").default): void} listener Listener function.\n   */\n  unlistenImageChange(listener) {\n    abstract();\n  }\n}\n\nexport default ImageStyle;\n","/**\n * @module ol/colorlike\n */\nimport {toString} from './color.js';\n\n/**\n * A type accepted by CanvasRenderingContext2D.fillStyle\n * or CanvasRenderingContext2D.strokeStyle.\n * Represents a color, pattern, or gradient. The origin for patterns and\n * gradients as fill style is an increment of 512 css pixels from map coordinate\n * `[0, 0]`. For seamless repeat patterns, width and height of the pattern image\n * must be a factor of two (2, 4, 8, ..., 512).\n *\n * @typedef {string|CanvasPattern|CanvasGradient} ColorLike\n * @api\n */\n\n/**\n * @param {import(\"./color.js\").Color|ColorLike} color Color.\n * @return {ColorLike} The color as an {@link ol/colorlike~ColorLike}.\n * @api\n */\nexport function asColorLike(color) {\n  if (Array.isArray(color)) {\n    return toString(color);\n  }\n  return color;\n}\n","/**\n * @module ol/style/RegularShape\n */\n\nimport ImageState from '../ImageState.js';\nimport ImageStyle from './Image.js';\nimport {asArray} from '../color.js';\nimport {asColorLike} from '../colorlike.js';\nimport {createCanvasContext2D} from '../dom.js';\nimport {\n  defaultFillStyle,\n  defaultLineJoin,\n  defaultLineWidth,\n  defaultMiterLimit,\n  defaultStrokeStyle,\n} from '../render/canvas.js';\n\n/**\n * Specify radius for regular polygons, or radius1 and radius2 for stars.\n * @typedef {Object} Options\n * @property {import(\"./Fill.js\").default} [fill] Fill style.\n * @property {number} points Number of points for stars and regular polygons. In case of a polygon, the number of points\n * is the number of sides.\n * @property {number} [radius] Radius of a regular polygon.\n * @property {number} [radius1] First radius of a star. Ignored if radius is set.\n * @property {number} [radius2] Second radius of a star.\n * @property {number} [angle=0] Shape's angle in radians. A value of 0 will have one of the shape's points facing up.\n * @property {Array<number>} [displacement=[0, 0]] Displacement of the shape in pixels.\n * Positive values will shift the shape right and up.\n * @property {import(\"./Stroke.js\").default} [stroke] Stroke style.\n * @property {number} [rotation=0] Rotation in radians (positive rotation clockwise).\n * @property {boolean} [rotateWithView=false] Whether to rotate the shape with the view.\n * @property {number|import(\"../size.js\").Size} [scale=1] Scale. Unless two dimensional scaling is required a better\n * result may be obtained with appropriate settings for `radius`, `radius1` and `radius2`.\n * @property {\"declutter\"|\"obstacle\"|\"none\"|undefined} [declutterMode] Declutter mode.\n */\n\n/**\n * @typedef {Object} RenderOptions\n * @property {import(\"../colorlike.js\").ColorLike} [strokeStyle] StrokeStyle.\n * @property {number} strokeWidth StrokeWidth.\n * @property {number} size Size.\n * @property {Array<number>|null} lineDash LineDash.\n * @property {number} lineDashOffset LineDashOffset.\n * @property {CanvasLineJoin} lineJoin LineJoin.\n * @property {number} miterLimit MiterLimit.\n */\n\n/**\n * @classdesc\n * Set regular shape style for vector features. The resulting shape will be\n * a regular polygon when `radius` is provided, or a star when `radius1` and\n * `radius2` are provided.\n * @api\n */\nclass RegularShape extends ImageStyle {\n  /**\n   * @param {Options} options Options.\n   */\n  constructor(options) {\n    /**\n     * @type {boolean}\n     */\n    const rotateWithView =\n      options.rotateWithView !== undefined ? options.rotateWithView : false;\n\n    super({\n      opacity: 1,\n      rotateWithView: rotateWithView,\n      rotation: options.rotation !== undefined ? options.rotation : 0,\n      scale: options.scale !== undefined ? options.scale : 1,\n      displacement:\n        options.displacement !== undefined ? options.displacement : [0, 0],\n      declutterMode: options.declutterMode,\n    });\n\n    /**\n     * @private\n     * @type {Object<number, HTMLCanvasElement>}\n     */\n    this.canvas_ = undefined;\n\n    /**\n     * @private\n     * @type {HTMLCanvasElement}\n     */\n    this.hitDetectionCanvas_ = null;\n\n    /**\n     * @private\n     * @type {import(\"./Fill.js\").default}\n     */\n    this.fill_ = options.fill !== undefined ? options.fill : null;\n\n    /**\n     * @private\n     * @type {Array<number>}\n     */\n    this.origin_ = [0, 0];\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.points_ = options.points;\n\n    /**\n     * @protected\n     * @type {number}\n     */\n    this.radius_ =\n      options.radius !== undefined ? options.radius : options.radius1;\n\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n    this.radius2_ = options.radius2;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.angle_ = options.angle !== undefined ? options.angle : 0;\n\n    /**\n     * @private\n     * @type {import(\"./Stroke.js\").default}\n     */\n    this.stroke_ = options.stroke !== undefined ? options.stroke : null;\n\n    /**\n     * @private\n     * @type {import(\"../size.js\").Size}\n     */\n    this.size_ = null;\n\n    /**\n     * @private\n     * @type {RenderOptions}\n     */\n    this.renderOptions_ = null;\n\n    this.render();\n  }\n\n  /**\n   * Clones the style.\n   * @return {RegularShape} The cloned style.\n   * @api\n   */\n  clone() {\n    const scale = this.getScale();\n    const style = new RegularShape({\n      fill: this.getFill() ? this.getFill().clone() : undefined,\n      points: this.getPoints(),\n      radius: this.getRadius(),\n      radius2: this.getRadius2(),\n      angle: this.getAngle(),\n      stroke: this.getStroke() ? this.getStroke().clone() : undefined,\n      rotation: this.getRotation(),\n      rotateWithView: this.getRotateWithView(),\n      scale: Array.isArray(scale) ? scale.slice() : scale,\n      displacement: this.getDisplacement().slice(),\n      declutterMode: this.getDeclutterMode(),\n    });\n    style.setOpacity(this.getOpacity());\n    return style;\n  }\n\n  /**\n   * Get the anchor point in pixels. The anchor determines the center point for the\n   * symbolizer.\n   * @return {Array<number>} Anchor.\n   * @api\n   */\n  getAnchor() {\n    const size = this.size_;\n    if (!size) {\n      return null;\n    }\n    const displacement = this.getDisplacement();\n    const scale = this.getScaleArray();\n    // anchor is scaled by renderer but displacement should not be scaled\n    // so divide by scale here\n    return [\n      size[0] / 2 - displacement[0] / scale[0],\n      size[1] / 2 + displacement[1] / scale[1],\n    ];\n  }\n\n  /**\n   * Get the angle used in generating the shape.\n   * @return {number} Shape's rotation in radians.\n   * @api\n   */\n  getAngle() {\n    return this.angle_;\n  }\n\n  /**\n   * Get the fill style for the shape.\n   * @return {import(\"./Fill.js\").default} Fill style.\n   * @api\n   */\n  getFill() {\n    return this.fill_;\n  }\n\n  /**\n   * Set the fill style.\n   * @param {import(\"./Fill.js\").default} fill Fill style.\n   * @api\n   */\n  setFill(fill) {\n    this.fill_ = fill;\n    this.render();\n  }\n\n  /**\n   * @return {HTMLCanvasElement} Image element.\n   */\n  getHitDetectionImage() {\n    if (!this.hitDetectionCanvas_) {\n      this.createHitDetectionCanvas_(this.renderOptions_);\n    }\n    return this.hitDetectionCanvas_;\n  }\n\n  /**\n   * Get the image icon.\n   * @param {number} pixelRatio Pixel ratio.\n   * @return {HTMLCanvasElement} Image or Canvas element.\n   * @api\n   */\n  getImage(pixelRatio) {\n    let image = this.canvas_[pixelRatio];\n    if (!image) {\n      const renderOptions = this.renderOptions_;\n      const context = createCanvasContext2D(\n        renderOptions.size * pixelRatio,\n        renderOptions.size * pixelRatio\n      );\n      this.draw_(renderOptions, context, pixelRatio);\n\n      image = context.canvas;\n      this.canvas_[pixelRatio] = image;\n    }\n    return image;\n  }\n\n  /**\n   * Get the image pixel ratio.\n   * @param {number} pixelRatio Pixel ratio.\n   * @return {number} Pixel ratio.\n   */\n  getPixelRatio(pixelRatio) {\n    return pixelRatio;\n  }\n\n  /**\n   * @return {import(\"../size.js\").Size} Image size.\n   */\n  getImageSize() {\n    return this.size_;\n  }\n\n  /**\n   * @return {import(\"../ImageState.js\").default} Image state.\n   */\n  getImageState() {\n    return ImageState.LOADED;\n  }\n\n  /**\n   * Get the origin of the symbolizer.\n   * @return {Array<number>} Origin.\n   * @api\n   */\n  getOrigin() {\n    return this.origin_;\n  }\n\n  /**\n   * Get the number of points for generating the shape.\n   * @return {number} Number of points for stars and regular polygons.\n   * @api\n   */\n  getPoints() {\n    return this.points_;\n  }\n\n  /**\n   * Get the (primary) radius for the shape.\n   * @return {number} Radius.\n   * @api\n   */\n  getRadius() {\n    return this.radius_;\n  }\n\n  /**\n   * Get the secondary radius for the shape.\n   * @return {number|undefined} Radius2.\n   * @api\n   */\n  getRadius2() {\n    return this.radius2_;\n  }\n\n  /**\n   * Get the size of the symbolizer (in pixels).\n   * @return {import(\"../size.js\").Size} Size.\n   * @api\n   */\n  getSize() {\n    return this.size_;\n  }\n\n  /**\n   * Get the stroke style for the shape.\n   * @return {import(\"./Stroke.js\").default} Stroke style.\n   * @api\n   */\n  getStroke() {\n    return this.stroke_;\n  }\n\n  /**\n   * Set the stroke style.\n   * @param {import(\"./Stroke.js\").default} stroke Stroke style.\n   * @api\n   */\n  setStroke(stroke) {\n    this.stroke_ = stroke;\n    this.render();\n  }\n\n  /**\n   * @param {function(import(\"../events/Event.js\").default): void} listener Listener function.\n   */\n  listenImageChange(listener) {}\n\n  /**\n   * Load not yet loaded URI.\n   */\n  load() {}\n\n  /**\n   * @param {function(import(\"../events/Event.js\").default): void} listener Listener function.\n   */\n  unlistenImageChange(listener) {}\n\n  /**\n   * Calculate additional canvas size needed for the miter.\n   * @param {string} lineJoin Line join\n   * @param {number} strokeWidth Stroke width\n   * @param {number} miterLimit Miter limit\n   * @return {number} Additional canvas size needed\n   * @private\n   */\n  calculateLineJoinSize_(lineJoin, strokeWidth, miterLimit) {\n    if (\n      strokeWidth === 0 ||\n      this.points_ === Infinity ||\n      (lineJoin !== 'bevel' && lineJoin !== 'miter')\n    ) {\n      return strokeWidth;\n    }\n    // m  | ^\n    // i  | |\\                  .\n    // t >|  #\\\n    // e  | |\\ \\              .\n    // r      \\s\\\n    //      |  \\t\\          .                 .\n    //          \\r\\                      .   .\n    //      |    \\o\\      .          .  . . .\n    //          e \\k\\            .  .    . .\n    //      |      \\e\\  .    .  .       . .\n    //       d      \\ \\  .  .          . .\n    //      | _ _a_ _\\#  .            . .\n    //   r1          / `             . .\n    //      |                       . .\n    //       b     /               . .\n    //      |                     . .\n    //           / r2            . .\n    //      |                        .   .\n    //         /                           .   .\n    //      |α                                   .   .\n    //       /                                         .   .\n    //      ° center\n    let r1 = this.radius_;\n    let r2 = this.radius2_ === undefined ? r1 : this.radius2_;\n    if (r1 < r2) {\n      const tmp = r1;\n      r1 = r2;\n      r2 = tmp;\n    }\n    const points =\n      this.radius2_ === undefined ? this.points_ : this.points_ * 2;\n    const alpha = (2 * Math.PI) / points;\n    const a = r2 * Math.sin(alpha);\n    const b = Math.sqrt(r2 * r2 - a * a);\n    const d = r1 - b;\n    const e = Math.sqrt(a * a + d * d);\n    const miterRatio = e / a;\n    if (lineJoin === 'miter' && miterRatio <= miterLimit) {\n      return miterRatio * strokeWidth;\n    }\n    // Calculate the distnce from center to the stroke corner where\n    // it was cut short because of the miter limit.\n    //              l\n    //        ----+---- <= distance from center to here is maxr\n    //       /####|k ##\\\n    //      /#####^#####\\\n    //     /#### /+\\# s #\\\n    //    /### h/+++\\# t #\\\n    //   /### t/+++++\\# r #\\\n    //  /### a/+++++++\\# o #\\\n    // /### p/++ fill +\\# k #\\\n    ///#### /+++++^+++++\\# e #\\\n    //#####/+++++/+\\+++++\\#####\\\n    const k = strokeWidth / 2 / miterRatio;\n    const l = (strokeWidth / 2) * (d / e);\n    const maxr = Math.sqrt((r1 + k) * (r1 + k) + l * l);\n    const bevelAdd = maxr - r1;\n    if (this.radius2_ === undefined || lineJoin === 'bevel') {\n      return bevelAdd * 2;\n    }\n    // If outer miter is over the miter limit the inner miter may reach through the\n    // center and be longer than the bevel, same calculation as above but swap r1 / r2.\n    const aa = r1 * Math.sin(alpha);\n    const bb = Math.sqrt(r1 * r1 - aa * aa);\n    const dd = r2 - bb;\n    const ee = Math.sqrt(aa * aa + dd * dd);\n    const innerMiterRatio = ee / aa;\n    if (innerMiterRatio <= miterLimit) {\n      const innerLength = (innerMiterRatio * strokeWidth) / 2 - r2 - r1;\n      return 2 * Math.max(bevelAdd, innerLength);\n    }\n    return bevelAdd * 2;\n  }\n\n  /**\n   * @return {RenderOptions}  The render options\n   * @protected\n   */\n  createRenderOptions() {\n    let lineJoin = defaultLineJoin;\n    let miterLimit = 0;\n    let lineDash = null;\n    let lineDashOffset = 0;\n    let strokeStyle;\n    let strokeWidth = 0;\n\n    if (this.stroke_) {\n      strokeStyle = this.stroke_.getColor();\n      if (strokeStyle === null) {\n        strokeStyle = defaultStrokeStyle;\n      }\n      strokeStyle = asColorLike(strokeStyle);\n      strokeWidth = this.stroke_.getWidth();\n      if (strokeWidth === undefined) {\n        strokeWidth = defaultLineWidth;\n      }\n      lineDash = this.stroke_.getLineDash();\n      lineDashOffset = this.stroke_.getLineDashOffset();\n      lineJoin = this.stroke_.getLineJoin();\n      if (lineJoin === undefined) {\n        lineJoin = defaultLineJoin;\n      }\n      miterLimit = this.stroke_.getMiterLimit();\n      if (miterLimit === undefined) {\n        miterLimit = defaultMiterLimit;\n      }\n    }\n\n    const add = this.calculateLineJoinSize_(lineJoin, strokeWidth, miterLimit);\n    const maxRadius = Math.max(this.radius_, this.radius2_ || 0);\n    const size = Math.ceil(2 * maxRadius + add);\n\n    return {\n      strokeStyle: strokeStyle,\n      strokeWidth: strokeWidth,\n      size: size,\n      lineDash: lineDash,\n      lineDashOffset: lineDashOffset,\n      lineJoin: lineJoin,\n      miterLimit: miterLimit,\n    };\n  }\n\n  /**\n   * @protected\n   */\n  render() {\n    this.renderOptions_ = this.createRenderOptions();\n    const size = this.renderOptions_.size;\n    this.canvas_ = {};\n    this.size_ = [size, size];\n  }\n\n  /**\n   * @private\n   * @param {RenderOptions} renderOptions Render options.\n   * @param {CanvasRenderingContext2D} context The rendering context.\n   * @param {number} pixelRatio The pixel ratio.\n   */\n  draw_(renderOptions, context, pixelRatio) {\n    context.scale(pixelRatio, pixelRatio);\n    // set origin to canvas center\n    context.translate(renderOptions.size / 2, renderOptions.size / 2);\n\n    this.createPath_(context);\n\n    if (this.fill_) {\n      let color = this.fill_.getColor();\n      if (color === null) {\n        color = defaultFillStyle;\n      }\n      context.fillStyle = asColorLike(color);\n      context.fill();\n    }\n    if (this.stroke_) {\n      context.strokeStyle = renderOptions.strokeStyle;\n      context.lineWidth = renderOptions.strokeWidth;\n      if (renderOptions.lineDash) {\n        context.setLineDash(renderOptions.lineDash);\n        context.lineDashOffset = renderOptions.lineDashOffset;\n      }\n      context.lineJoin = renderOptions.lineJoin;\n      context.miterLimit = renderOptions.miterLimit;\n      context.stroke();\n    }\n  }\n\n  /**\n   * @private\n   * @param {RenderOptions} renderOptions Render options.\n   */\n  createHitDetectionCanvas_(renderOptions) {\n    if (this.fill_) {\n      let color = this.fill_.getColor();\n\n      // determine if fill is transparent (or pattern or gradient)\n      let opacity = 0;\n      if (typeof color === 'string') {\n        color = asArray(color);\n      }\n      if (color === null) {\n        opacity = 1;\n      } else if (Array.isArray(color)) {\n        opacity = color.length === 4 ? color[3] : 1;\n      }\n      if (opacity === 0) {\n        // if a transparent fill style is set, create an extra hit-detection image\n        // with a default fill style\n        const context = createCanvasContext2D(\n          renderOptions.size,\n          renderOptions.size\n        );\n        this.hitDetectionCanvas_ = context.canvas;\n\n        this.drawHitDetectionCanvas_(renderOptions, context);\n      }\n    }\n    if (!this.hitDetectionCanvas_) {\n      this.hitDetectionCanvas_ = this.getImage(1);\n    }\n  }\n\n  /**\n   * @private\n   * @param {CanvasRenderingContext2D} context The context to draw in.\n   */\n  createPath_(context) {\n    let points = this.points_;\n    const radius = this.radius_;\n    if (points === Infinity) {\n      context.arc(0, 0, radius, 0, 2 * Math.PI);\n    } else {\n      const radius2 = this.radius2_ === undefined ? radius : this.radius2_;\n      if (this.radius2_ !== undefined) {\n        points *= 2;\n      }\n      const startAngle = this.angle_ - Math.PI / 2;\n      const step = (2 * Math.PI) / points;\n      for (let i = 0; i < points; i++) {\n        const angle0 = startAngle + i * step;\n        const radiusC = i % 2 === 0 ? radius : radius2;\n        context.lineTo(radiusC * Math.cos(angle0), radiusC * Math.sin(angle0));\n      }\n      context.closePath();\n    }\n  }\n\n  /**\n   * @private\n   * @param {RenderOptions} renderOptions Render options.\n   * @param {CanvasRenderingContext2D} context The context.\n   */\n  drawHitDetectionCanvas_(renderOptions, context) {\n    // set origin to canvas center\n    context.translate(renderOptions.size / 2, renderOptions.size / 2);\n\n    this.createPath_(context);\n\n    context.fillStyle = defaultFillStyle;\n    context.fill();\n    if (this.stroke_) {\n      context.strokeStyle = renderOptions.strokeStyle;\n      context.lineWidth = renderOptions.strokeWidth;\n      if (renderOptions.lineDash) {\n        context.setLineDash(renderOptions.lineDash);\n        context.lineDashOffset = renderOptions.lineDashOffset;\n      }\n      context.lineJoin = renderOptions.lineJoin;\n      context.miterLimit = renderOptions.miterLimit;\n      context.stroke();\n    }\n  }\n}\n\nexport default RegularShape;\n","/**\n * @module ol/style/Circle\n */\n\nimport RegularShape from './RegularShape.js';\n\n/**\n * @typedef {Object} Options\n * @property {import(\"./Fill.js\").default} [fill] Fill style.\n * @property {number} radius Circle radius.\n * @property {import(\"./Stroke.js\").default} [stroke] Stroke style.\n * @property {Array<number>} [displacement=[0,0]] displacement\n * @property {number|import(\"../size.js\").Size} [scale=1] Scale. A two dimensional scale will produce an ellipse.\n * Unless two dimensional scaling is required a better result may be obtained with an appropriate setting for `radius`.\n * @property {number} [rotation=0] Rotation in radians\n * (positive rotation clockwise, meaningful only when used in conjunction with a two dimensional scale).\n * @property {boolean} [rotateWithView=false] Whether to rotate the shape with the view\n * (meaningful only when used in conjunction with a two dimensional scale).\n * @property {\"declutter\"|\"obstacle\"|\"none\"|undefined} [declutterMode] Declutter mode\n */\n\n/**\n * @classdesc\n * Set circle style for vector features.\n * @api\n */\nclass CircleStyle extends RegularShape {\n  /**\n   * @param {Options} [options] Options.\n   */\n  constructor(options) {\n    options = options ? options : {radius: 5};\n\n    super({\n      points: Infinity,\n      fill: options.fill,\n      radius: options.radius,\n      stroke: options.stroke,\n      scale: options.scale !== undefined ? options.scale : 1,\n      rotation: options.rotation !== undefined ? options.rotation : 0,\n      rotateWithView:\n        options.rotateWithView !== undefined ? options.rotateWithView : false,\n      displacement:\n        options.displacement !== undefined ? options.displacement : [0, 0],\n      declutterMode: options.declutterMode,\n    });\n  }\n\n  /**\n   * Clones the style.\n   * @return {CircleStyle} The cloned style.\n   * @api\n   */\n  clone() {\n    const scale = this.getScale();\n    const style = new CircleStyle({\n      fill: this.getFill() ? this.getFill().clone() : undefined,\n      stroke: this.getStroke() ? this.getStroke().clone() : undefined,\n      radius: this.getRadius(),\n      scale: Array.isArray(scale) ? scale.slice() : scale,\n      rotation: this.getRotation(),\n      rotateWithView: this.getRotateWithView(),\n      displacement: this.getDisplacement().slice(),\n      declutterMode: this.getDeclutterMode(),\n    });\n    style.setOpacity(this.getOpacity());\n    return style;\n  }\n\n  /**\n   * Set the circle radius.\n   *\n   * @param {number} radius Circle radius.\n   * @api\n   */\n  setRadius(radius) {\n    this.radius_ = radius;\n    this.render();\n  }\n}\n\nexport default CircleStyle;\n","/**\n * @module ol/style/Style\n */\n\nimport CircleStyle from './Circle.js';\nimport Fill from './Fill.js';\nimport Stroke from './Stroke.js';\nimport {assert} from '../asserts.js';\n\n/**\n * A function that takes an {@link module:ol/Feature~Feature} and a `{number}`\n * representing the view's resolution. The function should return a\n * {@link module:ol/style/Style~Style} or an array of them. This way e.g. a\n * vector layer can be styled. If the function returns `undefined`, the\n * feature will not be rendered.\n *\n * @typedef {function(import(\"../Feature.js\").FeatureLike, number):(Style|Array<Style>|void)} StyleFunction\n */\n\n/**\n * A {@link Style}, an array of {@link Style}, or a {@link StyleFunction}.\n * @typedef {Style|Array<Style>|StyleFunction} StyleLike\n */\n\n/**\n * A function that takes an {@link module:ol/Feature~Feature} as argument and returns an\n * {@link module:ol/geom/Geometry~Geometry} that will be rendered and styled for the feature.\n *\n * @typedef {function(import(\"../Feature.js\").FeatureLike):\n *     (import(\"../geom/Geometry.js\").default|import(\"../render/Feature.js\").default|undefined)} GeometryFunction\n */\n\n/**\n * Custom renderer function. Takes two arguments:\n *\n * 1. The pixel coordinates of the geometry in GeoJSON notation.\n * 2. The {@link module:ol/render~State} of the layer renderer.\n *\n * @typedef {function((import(\"../coordinate.js\").Coordinate|Array<import(\"../coordinate.js\").Coordinate>|Array<Array<import(\"../coordinate.js\").Coordinate>>),import(\"../render.js\").State): void} RenderFunction\n */\n\n/**\n * @typedef {Object} Options\n * @property {string|import(\"../geom/Geometry.js\").default|GeometryFunction} [geometry] Feature property or geometry\n * or function returning a geometry to render for this style.\n * @property {import(\"./Fill.js\").default} [fill] Fill style.\n * @property {import(\"./Image.js\").default} [image] Image style.\n * @property {RenderFunction} [renderer] Custom renderer. When configured, `fill`, `stroke` and `image` will be\n * ignored, and the provided function will be called with each render frame for each geometry.\n * @property {RenderFunction} [hitDetectionRenderer] Custom renderer for hit detection. If provided will be used\n * in hit detection rendering.\n * @property {import(\"./Stroke.js\").default} [stroke] Stroke style.\n * @property {import(\"./Text.js\").default} [text] Text style.\n * @property {number} [zIndex] Z index.\n */\n\n/**\n * @classdesc\n * Container for vector feature rendering styles. Any changes made to the style\n * or its children through `set*()` methods will not take effect until the\n * feature or layer that uses the style is re-rendered.\n *\n * ## Feature styles\n *\n * If no style is defined, the following default style is used:\n * ```js\n *  import {Circle, Fill, Stroke, Style} from 'ol/style.js';\n *\n *  const fill = new Fill({\n *    color: 'rgba(255,255,255,0.4)',\n *  });\n *  const stroke = new Stroke({\n *    color: '#3399CC',\n *    width: 1.25,\n *  });\n *  const styles = [\n *    new Style({\n *      image: new Circle({\n *        fill: fill,\n *        stroke: stroke,\n *        radius: 5,\n *      }),\n *      fill: fill,\n *      stroke: stroke,\n *    }),\n *  ];\n * ```\n *\n * A separate editing style has the following defaults:\n * ```js\n *  import {Circle, Fill, Stroke, Style} from 'ol/style.js';\n *\n *  const styles = {};\n *  const white = [255, 255, 255, 1];\n *  const blue = [0, 153, 255, 1];\n *  const width = 3;\n *  styles['Polygon'] = [\n *    new Style({\n *      fill: new Fill({\n *        color: [255, 255, 255, 0.5],\n *      }),\n *    }),\n *  ];\n *  styles['MultiPolygon'] =\n *      styles['Polygon'];\n *  styles['LineString'] = [\n *    new Style({\n *      stroke: new Stroke({\n *        color: white,\n *        width: width + 2,\n *      }),\n *    }),\n *    new Style({\n *      stroke: new Stroke({\n *        color: blue,\n *        width: width,\n *      }),\n *    }),\n *  ];\n *  styles['MultiLineString'] = styles['LineString'];\n *\n *  styles['Circle'] = styles['Polygon'].concat(\n *    styles['LineString']\n *  );\n *\n *  styles['Point'] = [\n *    new Style({\n *      image: new Circle({\n *        radius: width * 2,\n *        fill: new Fill({\n *          color: blue,\n *        }),\n *        stroke: new Stroke({\n *          color: white,\n *          width: width / 2,\n *        }),\n *      }),\n *      zIndex: Infinity,\n *    }),\n *  ];\n *  styles['MultiPoint'] =\n *      styles['Point'];\n *  styles['GeometryCollection'] =\n *      styles['Polygon'].concat(\n *          styles['LineString'],\n *          styles['Point']\n *      );\n * ```\n *\n * @api\n */\nclass Style {\n  /**\n   * @param {Options} [options] Style options.\n   */\n  constructor(options) {\n    options = options || {};\n\n    /**\n     * @private\n     * @type {string|import(\"../geom/Geometry.js\").default|GeometryFunction}\n     */\n    this.geometry_ = null;\n\n    /**\n     * @private\n     * @type {!GeometryFunction}\n     */\n    this.geometryFunction_ = defaultGeometryFunction;\n\n    if (options.geometry !== undefined) {\n      this.setGeometry(options.geometry);\n    }\n\n    /**\n     * @private\n     * @type {import(\"./Fill.js\").default}\n     */\n    this.fill_ = options.fill !== undefined ? options.fill : null;\n\n    /**\n     * @private\n     * @type {import(\"./Image.js\").default}\n     */\n    this.image_ = options.image !== undefined ? options.image : null;\n\n    /**\n     * @private\n     * @type {RenderFunction|null}\n     */\n    this.renderer_ = options.renderer !== undefined ? options.renderer : null;\n\n    /**\n     * @private\n     * @type {RenderFunction|null}\n     */\n    this.hitDetectionRenderer_ =\n      options.hitDetectionRenderer !== undefined\n        ? options.hitDetectionRenderer\n        : null;\n\n    /**\n     * @private\n     * @type {import(\"./Stroke.js\").default}\n     */\n    this.stroke_ = options.stroke !== undefined ? options.stroke : null;\n\n    /**\n     * @private\n     * @type {import(\"./Text.js\").default}\n     */\n    this.text_ = options.text !== undefined ? options.text : null;\n\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n    this.zIndex_ = options.zIndex;\n  }\n\n  /**\n   * Clones the style.\n   * @return {Style} The cloned style.\n   * @api\n   */\n  clone() {\n    let geometry = this.getGeometry();\n    if (geometry && typeof geometry === 'object') {\n      geometry = /** @type {import(\"../geom/Geometry.js\").default} */ (\n        geometry\n      ).clone();\n    }\n    return new Style({\n      geometry: geometry,\n      fill: this.getFill() ? this.getFill().clone() : undefined,\n      image: this.getImage() ? this.getImage().clone() : undefined,\n      renderer: this.getRenderer(),\n      stroke: this.getStroke() ? this.getStroke().clone() : undefined,\n      text: this.getText() ? this.getText().clone() : undefined,\n      zIndex: this.getZIndex(),\n    });\n  }\n\n  /**\n   * Get the custom renderer function that was configured with\n   * {@link #setRenderer} or the `renderer` constructor option.\n   * @return {RenderFunction|null} Custom renderer function.\n   * @api\n   */\n  getRenderer() {\n    return this.renderer_;\n  }\n\n  /**\n   * Sets a custom renderer function for this style. When set, `fill`, `stroke`\n   * and `image` options of the style will be ignored.\n   * @param {RenderFunction|null} renderer Custom renderer function.\n   * @api\n   */\n  setRenderer(renderer) {\n    this.renderer_ = renderer;\n  }\n\n  /**\n   * Sets a custom renderer function for this style used\n   * in hit detection.\n   * @param {RenderFunction|null} renderer Custom renderer function.\n   * @api\n   */\n  setHitDetectionRenderer(renderer) {\n    this.hitDetectionRenderer_ = renderer;\n  }\n\n  /**\n   * Get the custom renderer function that was configured with\n   * {@link #setHitDetectionRenderer} or the `hitDetectionRenderer` constructor option.\n   * @return {RenderFunction|null} Custom renderer function.\n   * @api\n   */\n  getHitDetectionRenderer() {\n    return this.hitDetectionRenderer_;\n  }\n\n  /**\n   * Get the geometry to be rendered.\n   * @return {string|import(\"../geom/Geometry.js\").default|GeometryFunction}\n   * Feature property or geometry or function that returns the geometry that will\n   * be rendered with this style.\n   * @api\n   */\n  getGeometry() {\n    return this.geometry_;\n  }\n\n  /**\n   * Get the function used to generate a geometry for rendering.\n   * @return {!GeometryFunction} Function that is called with a feature\n   * and returns the geometry to render instead of the feature's geometry.\n   * @api\n   */\n  getGeometryFunction() {\n    return this.geometryFunction_;\n  }\n\n  /**\n   * Get the fill style.\n   * @return {import(\"./Fill.js\").default} Fill style.\n   * @api\n   */\n  getFill() {\n    return this.fill_;\n  }\n\n  /**\n   * Set the fill style.\n   * @param {import(\"./Fill.js\").default} fill Fill style.\n   * @api\n   */\n  setFill(fill) {\n    this.fill_ = fill;\n  }\n\n  /**\n   * Get the image style.\n   * @return {import(\"./Image.js\").default} Image style.\n   * @api\n   */\n  getImage() {\n    return this.image_;\n  }\n\n  /**\n   * Set the image style.\n   * @param {import(\"./Image.js\").default} image Image style.\n   * @api\n   */\n  setImage(image) {\n    this.image_ = image;\n  }\n\n  /**\n   * Get the stroke style.\n   * @return {import(\"./Stroke.js\").default} Stroke style.\n   * @api\n   */\n  getStroke() {\n    return this.stroke_;\n  }\n\n  /**\n   * Set the stroke style.\n   * @param {import(\"./Stroke.js\").default} stroke Stroke style.\n   * @api\n   */\n  setStroke(stroke) {\n    this.stroke_ = stroke;\n  }\n\n  /**\n   * Get the text style.\n   * @return {import(\"./Text.js\").default} Text style.\n   * @api\n   */\n  getText() {\n    return this.text_;\n  }\n\n  /**\n   * Set the text style.\n   * @param {import(\"./Text.js\").default} text Text style.\n   * @api\n   */\n  setText(text) {\n    this.text_ = text;\n  }\n\n  /**\n   * Get the z-index for the style.\n   * @return {number|undefined} ZIndex.\n   * @api\n   */\n  getZIndex() {\n    return this.zIndex_;\n  }\n\n  /**\n   * Set a geometry that is rendered instead of the feature's geometry.\n   *\n   * @param {string|import(\"../geom/Geometry.js\").default|GeometryFunction} geometry\n   *     Feature property or geometry or function returning a geometry to render\n   *     for this style.\n   * @api\n   */\n  setGeometry(geometry) {\n    if (typeof geometry === 'function') {\n      this.geometryFunction_ = geometry;\n    } else if (typeof geometry === 'string') {\n      this.geometryFunction_ = function (feature) {\n        return /** @type {import(\"../geom/Geometry.js\").default} */ (\n          feature.get(geometry)\n        );\n      };\n    } else if (!geometry) {\n      this.geometryFunction_ = defaultGeometryFunction;\n    } else if (geometry !== undefined) {\n      this.geometryFunction_ = function () {\n        return /** @type {import(\"../geom/Geometry.js\").default} */ (geometry);\n      };\n    }\n    this.geometry_ = geometry;\n  }\n\n  /**\n   * Set the z-index.\n   *\n   * @param {number|undefined} zIndex ZIndex.\n   * @api\n   */\n  setZIndex(zIndex) {\n    this.zIndex_ = zIndex;\n  }\n}\n\n/**\n * Convert the provided object into a style function.  Functions passed through\n * unchanged.  Arrays of Style or single style objects wrapped in a\n * new style function.\n * @param {StyleFunction|Array<Style>|Style} obj\n *     A style function, a single style, or an array of styles.\n * @return {StyleFunction} A style function.\n */\nexport function toFunction(obj) {\n  let styleFunction;\n\n  if (typeof obj === 'function') {\n    styleFunction = obj;\n  } else {\n    /**\n     * @type {Array<Style>}\n     */\n    let styles;\n    if (Array.isArray(obj)) {\n      styles = obj;\n    } else {\n      assert(typeof (/** @type {?} */ (obj).getZIndex) === 'function', 41); // Expected an `Style` or an array of `Style`\n      const style = /** @type {Style} */ (obj);\n      styles = [style];\n    }\n    styleFunction = function () {\n      return styles;\n    };\n  }\n  return styleFunction;\n}\n\n/**\n * @type {Array<Style>|null}\n */\nlet defaultStyles = null;\n\n/**\n * @param {import(\"../Feature.js\").FeatureLike} feature Feature.\n * @param {number} resolution Resolution.\n * @return {Array<Style>} Style.\n */\nexport function createDefaultStyle(feature, resolution) {\n  // We don't use an immediately-invoked function\n  // and a closure so we don't get an error at script evaluation time in\n  // browsers that do not support Canvas. (import(\"./Circle.js\").CircleStyle does\n  // canvas.getContext('2d') at construction time, which will cause an.error\n  // in such browsers.)\n  if (!defaultStyles) {\n    const fill = new Fill({\n      color: 'rgba(255,255,255,0.4)',\n    });\n    const stroke = new Stroke({\n      color: '#3399CC',\n      width: 1.25,\n    });\n    defaultStyles = [\n      new Style({\n        image: new CircleStyle({\n          fill: fill,\n          stroke: stroke,\n          radius: 5,\n        }),\n        fill: fill,\n        stroke: stroke,\n      }),\n    ];\n  }\n  return defaultStyles;\n}\n\n/**\n * Default styles for editing features.\n * @return {Object<import(\"../geom/Geometry.js\").Type, Array<Style>>} Styles\n */\nexport function createEditingStyle() {\n  /** @type {Object<import(\"../geom/Geometry.js\").Type, Array<Style>>} */\n  const styles = {};\n  const white = [255, 255, 255, 1];\n  const blue = [0, 153, 255, 1];\n  const width = 3;\n  styles['Polygon'] = [\n    new Style({\n      fill: new Fill({\n        color: [255, 255, 255, 0.5],\n      }),\n    }),\n  ];\n  styles['MultiPolygon'] = styles['Polygon'];\n\n  styles['LineString'] = [\n    new Style({\n      stroke: new Stroke({\n        color: white,\n        width: width + 2,\n      }),\n    }),\n    new Style({\n      stroke: new Stroke({\n        color: blue,\n        width: width,\n      }),\n    }),\n  ];\n  styles['MultiLineString'] = styles['LineString'];\n\n  styles['Circle'] = styles['Polygon'].concat(styles['LineString']);\n\n  styles['Point'] = [\n    new Style({\n      image: new CircleStyle({\n        radius: width * 2,\n        fill: new Fill({\n          color: blue,\n        }),\n        stroke: new Stroke({\n          color: white,\n          width: width / 2,\n        }),\n      }),\n      zIndex: Infinity,\n    }),\n  ];\n  styles['MultiPoint'] = styles['Point'];\n\n  styles['GeometryCollection'] = styles['Polygon'].concat(\n    styles['LineString'],\n    styles['Point']\n  );\n\n  return styles;\n}\n\n/**\n * Function that is called with a feature and returns its default geometry.\n * @param {import(\"../Feature.js\").FeatureLike} feature Feature to get the geometry for.\n * @return {import(\"../geom/Geometry.js\").default|import(\"../render/Feature.js\").default|undefined} Geometry to render.\n */\nfunction defaultGeometryFunction(feature) {\n  return feature.getGeometry();\n}\n\nexport default Style;\n","/**\n * @module ol/style/Text\n */\nimport Fill from './Fill.js';\nimport {toSize} from '../size.js';\n\n/**\n * @typedef {'point' | 'line'} TextPlacement\n * Default text placement is `'point'`. Note that\n * `'line'` requires the underlying geometry to be a {@link module:ol/geom/LineString~LineString},\n * {@link module:ol/geom/Polygon~Polygon}, {@link module:ol/geom/MultiLineString~MultiLineString} or\n * {@link module:ol/geom/MultiPolygon~MultiPolygon}.\n */\n\n/**\n * @typedef {'left' | 'center' | 'right'} TextJustify\n */\n\n/**\n * The default fill color to use if no fill was set at construction time; a\n * blackish `#333`.\n *\n * @const {string}\n */\nconst DEFAULT_FILL_COLOR = '#333';\n\n/**\n * @typedef {Object} Options\n * @property {string} [font] Font style as CSS `font` value, see:\n * https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/font. Default is `'10px sans-serif'`\n * @property {number} [maxAngle=Math.PI/4] When `placement` is set to `'line'`, allow a maximum angle between adjacent characters.\n * The expected value is in radians, and the default is 45° (`Math.PI / 4`).\n * @property {number} [offsetX=0] Horizontal text offset in pixels. A positive will shift the text right.\n * @property {number} [offsetY=0] Vertical text offset in pixels. A positive will shift the text down.\n * @property {boolean} [overflow=false] For polygon labels or when `placement` is set to `'line'`, allow text to exceed\n * the width of the polygon at the label position or the length of the path that it follows.\n * @property {TextPlacement} [placement='point'] Text placement.\n * @property {number|import(\"../size.js\").Size} [scale] Scale.\n * @property {boolean} [rotateWithView=false] Whether to rotate the text with the view.\n * @property {number} [rotation=0] Rotation in radians (positive rotation clockwise).\n * @property {string|Array<string>} [text] Text content or rich text content. For plain text provide a string, which can\n * contain line breaks (`\\n`). For rich text provide an array of text/font tuples. A tuple consists of the text to\n * render and the font to use (or `''` to use the text style's font). A line break has to be a separate tuple (i.e. `'\\n', ''`).\n * **Example:** `['foo', 'bold 10px sans-serif', ' bar', 'italic 10px sans-serif', ' baz', '']` will yield \"**foo** *bar* baz\".\n * **Note:** Rich text is not supported for the immediate rendering API.\n * @property {CanvasTextAlign} [textAlign] Text alignment. Possible values: `'left'`, `'right'`, `'center'`, `'end'` or `'start'`.\n * Default is `'center'` for `placement: 'point'`. For `placement: 'line'`, the default is to let the renderer choose a\n * placement where `maxAngle` is not exceeded.\n * @property {TextJustify} [justify] Text justification within the text box.\n * If not set, text is justified towards the `textAlign` anchor.\n * Otherwise, use options `'left'`, `'center'`, or `'right'` to justify the text within the text box.\n * **Note:** `justify` is ignored for immediate rendering and also for `placement: 'line'`.\n * @property {CanvasTextBaseline} [textBaseline='middle'] Text base line. Possible values: `'bottom'`, `'top'`, `'middle'`, `'alphabetic'`,\n * `'hanging'`, `'ideographic'`.\n * @property {import(\"./Fill.js\").default} [fill] Fill style. If none is provided, we'll use a dark fill-style (#333).\n * @property {import(\"./Stroke.js\").default} [stroke] Stroke style.\n * @property {import(\"./Fill.js\").default} [backgroundFill] Fill style for the text background when `placement` is\n * `'point'`. Default is no fill.\n * @property {import(\"./Stroke.js\").default} [backgroundStroke] Stroke style for the text background  when `placement`\n * is `'point'`. Default is no stroke.\n * @property {Array<number>} [padding=[0, 0, 0, 0]] Padding in pixels around the text for decluttering and background. The order of\n * values in the array is `[top, right, bottom, left]`.\n */\n\n/**\n * @classdesc\n * Set text style for vector features.\n * @api\n */\nclass Text {\n  /**\n   * @param {Options} [options] Options.\n   */\n  constructor(options) {\n    options = options || {};\n\n    /**\n     * @private\n     * @type {string|undefined}\n     */\n    this.font_ = options.font;\n\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n    this.rotation_ = options.rotation;\n\n    /**\n     * @private\n     * @type {boolean|undefined}\n     */\n    this.rotateWithView_ = options.rotateWithView;\n\n    /**\n     * @private\n     * @type {number|import(\"../size.js\").Size|undefined}\n     */\n    this.scale_ = options.scale;\n\n    /**\n     * @private\n     * @type {import(\"../size.js\").Size}\n     */\n    this.scaleArray_ = toSize(options.scale !== undefined ? options.scale : 1);\n\n    /**\n     * @private\n     * @type {string|Array<string>|undefined}\n     */\n    this.text_ = options.text;\n\n    /**\n     * @private\n     * @type {CanvasTextAlign|undefined}\n     */\n    this.textAlign_ = options.textAlign;\n\n    /**\n     * @private\n     * @type {TextJustify|undefined}\n     */\n    this.justify_ = options.justify;\n\n    /**\n     * @private\n     * @type {CanvasTextBaseline|undefined}\n     */\n    this.textBaseline_ = options.textBaseline;\n\n    /**\n     * @private\n     * @type {import(\"./Fill.js\").default}\n     */\n    this.fill_ =\n      options.fill !== undefined\n        ? options.fill\n        : new Fill({color: DEFAULT_FILL_COLOR});\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.maxAngle_ =\n      options.maxAngle !== undefined ? options.maxAngle : Math.PI / 4;\n\n    /**\n     * @private\n     * @type {TextPlacement}\n     */\n    this.placement_ =\n      options.placement !== undefined ? options.placement : 'point';\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.overflow_ = !!options.overflow;\n\n    /**\n     * @private\n     * @type {import(\"./Stroke.js\").default}\n     */\n    this.stroke_ = options.stroke !== undefined ? options.stroke : null;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.offsetX_ = options.offsetX !== undefined ? options.offsetX : 0;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.offsetY_ = options.offsetY !== undefined ? options.offsetY : 0;\n\n    /**\n     * @private\n     * @type {import(\"./Fill.js\").default}\n     */\n    this.backgroundFill_ = options.backgroundFill\n      ? options.backgroundFill\n      : null;\n\n    /**\n     * @private\n     * @type {import(\"./Stroke.js\").default}\n     */\n    this.backgroundStroke_ = options.backgroundStroke\n      ? options.backgroundStroke\n      : null;\n\n    /**\n     * @private\n     * @type {Array<number>|null}\n     */\n    this.padding_ = options.padding === undefined ? null : options.padding;\n  }\n\n  /**\n   * Clones the style.\n   * @return {Text} The cloned style.\n   * @api\n   */\n  clone() {\n    const scale = this.getScale();\n    return new Text({\n      font: this.getFont(),\n      placement: this.getPlacement(),\n      maxAngle: this.getMaxAngle(),\n      overflow: this.getOverflow(),\n      rotation: this.getRotation(),\n      rotateWithView: this.getRotateWithView(),\n      scale: Array.isArray(scale) ? scale.slice() : scale,\n      text: this.getText(),\n      textAlign: this.getTextAlign(),\n      justify: this.getJustify(),\n      textBaseline: this.getTextBaseline(),\n      fill: this.getFill() ? this.getFill().clone() : undefined,\n      stroke: this.getStroke() ? this.getStroke().clone() : undefined,\n      offsetX: this.getOffsetX(),\n      offsetY: this.getOffsetY(),\n      backgroundFill: this.getBackgroundFill()\n        ? this.getBackgroundFill().clone()\n        : undefined,\n      backgroundStroke: this.getBackgroundStroke()\n        ? this.getBackgroundStroke().clone()\n        : undefined,\n      padding: this.getPadding() || undefined,\n    });\n  }\n\n  /**\n   * Get the `overflow` configuration.\n   * @return {boolean} Let text overflow the length of the path they follow.\n   * @api\n   */\n  getOverflow() {\n    return this.overflow_;\n  }\n\n  /**\n   * Get the font name.\n   * @return {string|undefined} Font.\n   * @api\n   */\n  getFont() {\n    return this.font_;\n  }\n\n  /**\n   * Get the maximum angle between adjacent characters.\n   * @return {number} Angle in radians.\n   * @api\n   */\n  getMaxAngle() {\n    return this.maxAngle_;\n  }\n\n  /**\n   * Get the label placement.\n   * @return {TextPlacement} Text placement.\n   * @api\n   */\n  getPlacement() {\n    return this.placement_;\n  }\n\n  /**\n   * Get the x-offset for the text.\n   * @return {number} Horizontal text offset.\n   * @api\n   */\n  getOffsetX() {\n    return this.offsetX_;\n  }\n\n  /**\n   * Get the y-offset for the text.\n   * @return {number} Vertical text offset.\n   * @api\n   */\n  getOffsetY() {\n    return this.offsetY_;\n  }\n\n  /**\n   * Get the fill style for the text.\n   * @return {import(\"./Fill.js\").default} Fill style.\n   * @api\n   */\n  getFill() {\n    return this.fill_;\n  }\n\n  /**\n   * Determine whether the text rotates with the map.\n   * @return {boolean|undefined} Rotate with map.\n   * @api\n   */\n  getRotateWithView() {\n    return this.rotateWithView_;\n  }\n\n  /**\n   * Get the text rotation.\n   * @return {number|undefined} Rotation.\n   * @api\n   */\n  getRotation() {\n    return this.rotation_;\n  }\n\n  /**\n   * Get the text scale.\n   * @return {number|import(\"../size.js\").Size|undefined} Scale.\n   * @api\n   */\n  getScale() {\n    return this.scale_;\n  }\n\n  /**\n   * Get the symbolizer scale array.\n   * @return {import(\"../size.js\").Size} Scale array.\n   */\n  getScaleArray() {\n    return this.scaleArray_;\n  }\n\n  /**\n   * Get the stroke style for the text.\n   * @return {import(\"./Stroke.js\").default} Stroke style.\n   * @api\n   */\n  getStroke() {\n    return this.stroke_;\n  }\n\n  /**\n   * Get the text to be rendered.\n   * @return {string|Array<string>|undefined} Text.\n   * @api\n   */\n  getText() {\n    return this.text_;\n  }\n\n  /**\n   * Get the text alignment.\n   * @return {CanvasTextAlign|undefined} Text align.\n   * @api\n   */\n  getTextAlign() {\n    return this.textAlign_;\n  }\n\n  /**\n   * Get the justification.\n   * @return {TextJustify|undefined} Justification.\n   * @api\n   */\n  getJustify() {\n    return this.justify_;\n  }\n\n  /**\n   * Get the text baseline.\n   * @return {CanvasTextBaseline|undefined} Text baseline.\n   * @api\n   */\n  getTextBaseline() {\n    return this.textBaseline_;\n  }\n\n  /**\n   * Get the background fill style for the text.\n   * @return {import(\"./Fill.js\").default} Fill style.\n   * @api\n   */\n  getBackgroundFill() {\n    return this.backgroundFill_;\n  }\n\n  /**\n   * Get the background stroke style for the text.\n   * @return {import(\"./Stroke.js\").default} Stroke style.\n   * @api\n   */\n  getBackgroundStroke() {\n    return this.backgroundStroke_;\n  }\n\n  /**\n   * Get the padding for the text.\n   * @return {Array<number>|null} Padding.\n   * @api\n   */\n  getPadding() {\n    return this.padding_;\n  }\n\n  /**\n   * Set the `overflow` property.\n   *\n   * @param {boolean} overflow Let text overflow the path that it follows.\n   * @api\n   */\n  setOverflow(overflow) {\n    this.overflow_ = overflow;\n  }\n\n  /**\n   * Set the font.\n   *\n   * @param {string|undefined} font Font.\n   * @api\n   */\n  setFont(font) {\n    this.font_ = font;\n  }\n\n  /**\n   * Set the maximum angle between adjacent characters.\n   *\n   * @param {number} maxAngle Angle in radians.\n   * @api\n   */\n  setMaxAngle(maxAngle) {\n    this.maxAngle_ = maxAngle;\n  }\n\n  /**\n   * Set the x offset.\n   *\n   * @param {number} offsetX Horizontal text offset.\n   * @api\n   */\n  setOffsetX(offsetX) {\n    this.offsetX_ = offsetX;\n  }\n\n  /**\n   * Set the y offset.\n   *\n   * @param {number} offsetY Vertical text offset.\n   * @api\n   */\n  setOffsetY(offsetY) {\n    this.offsetY_ = offsetY;\n  }\n\n  /**\n   * Set the text placement.\n   *\n   * @param {TextPlacement} placement Placement.\n   * @api\n   */\n  setPlacement(placement) {\n    this.placement_ = placement;\n  }\n\n  /**\n   * Set whether to rotate the text with the view.\n   *\n   * @param {boolean} rotateWithView Rotate with map.\n   * @api\n   */\n  setRotateWithView(rotateWithView) {\n    this.rotateWithView_ = rotateWithView;\n  }\n\n  /**\n   * Set the fill.\n   *\n   * @param {import(\"./Fill.js\").default} fill Fill style.\n   * @api\n   */\n  setFill(fill) {\n    this.fill_ = fill;\n  }\n\n  /**\n   * Set the rotation.\n   *\n   * @param {number|undefined} rotation Rotation.\n   * @api\n   */\n  setRotation(rotation) {\n    this.rotation_ = rotation;\n  }\n\n  /**\n   * Set the scale.\n   *\n   * @param {number|import(\"../size.js\").Size|undefined} scale Scale.\n   * @api\n   */\n  setScale(scale) {\n    this.scale_ = scale;\n    this.scaleArray_ = toSize(scale !== undefined ? scale : 1);\n  }\n\n  /**\n   * Set the stroke.\n   *\n   * @param {import(\"./Stroke.js\").default} stroke Stroke style.\n   * @api\n   */\n  setStroke(stroke) {\n    this.stroke_ = stroke;\n  }\n\n  /**\n   * Set the text.\n   *\n   * @param {string|Array<string>|undefined} text Text.\n   * @api\n   */\n  setText(text) {\n    this.text_ = text;\n  }\n\n  /**\n   * Set the text alignment.\n   *\n   * @param {CanvasTextAlign|undefined} textAlign Text align.\n   * @api\n   */\n  setTextAlign(textAlign) {\n    this.textAlign_ = textAlign;\n  }\n\n  /**\n   * Set the justification.\n   *\n   * @param {TextJustify|undefined} justify Justification.\n   * @api\n   */\n  setJustify(justify) {\n    this.justify_ = justify;\n  }\n\n  /**\n   * Set the text baseline.\n   *\n   * @param {CanvasTextBaseline|undefined} textBaseline Text baseline.\n   * @api\n   */\n  setTextBaseline(textBaseline) {\n    this.textBaseline_ = textBaseline;\n  }\n\n  /**\n   * Set the background fill.\n   *\n   * @param {import(\"./Fill.js\").default} fill Fill style.\n   * @api\n   */\n  setBackgroundFill(fill) {\n    this.backgroundFill_ = fill;\n  }\n\n  /**\n   * Set the background stroke.\n   *\n   * @param {import(\"./Stroke.js\").default} stroke Stroke style.\n   * @api\n   */\n  setBackgroundStroke(stroke) {\n    this.backgroundStroke_ = stroke;\n  }\n\n  /**\n   * Set the padding (`[top, right, bottom, left]`).\n   *\n   * @param {Array<number>|null} padding Padding.\n   * @api\n   */\n  setPadding(padding) {\n    this.padding_ = padding;\n  }\n}\n\nexport default Text;\n","\nexport default function quickselect(arr, k, left, right, compare) {\n    quickselectStep(arr, k, left || 0, right || (arr.length - 1), compare || defaultCompare);\n}\n\nfunction quickselectStep(arr, k, left, right, compare) {\n\n    while (right > left) {\n        if (right - left > 600) {\n            var n = right - left + 1;\n            var m = k - left + 1;\n            var z = Math.log(n);\n            var s = 0.5 * Math.exp(2 * z / 3);\n            var sd = 0.5 * Math.sqrt(z * s * (n - s) / n) * (m - n / 2 < 0 ? -1 : 1);\n            var newLeft = Math.max(left, Math.floor(k - m * s / n + sd));\n            var newRight = Math.min(right, Math.floor(k + (n - m) * s / n + sd));\n            quickselectStep(arr, k, newLeft, newRight, compare);\n        }\n\n        var t = arr[k];\n        var i = left;\n        var j = right;\n\n        swap(arr, left, k);\n        if (compare(arr[right], t) > 0) swap(arr, left, right);\n\n        while (i < j) {\n            swap(arr, i, j);\n            i++;\n            j--;\n            while (compare(arr[i], t) < 0) i++;\n            while (compare(arr[j], t) > 0) j--;\n        }\n\n        if (compare(arr[left], t) === 0) swap(arr, left, j);\n        else {\n            j++;\n            swap(arr, j, right);\n        }\n\n        if (j <= k) left = j + 1;\n        if (k <= j) right = j - 1;\n    }\n}\n\nfunction swap(arr, i, j) {\n    var tmp = arr[i];\n    arr[i] = arr[j];\n    arr[j] = tmp;\n}\n\nfunction defaultCompare(a, b) {\n    return a < b ? -1 : a > b ? 1 : 0;\n}\n","import quickselect from 'quickselect';\n\nexport default class RBush {\n    constructor(maxEntries = 9) {\n        // max entries in a node is 9 by default; min node fill is 40% for best performance\n        this._maxEntries = Math.max(4, maxEntries);\n        this._minEntries = Math.max(2, Math.ceil(this._maxEntries * 0.4));\n        this.clear();\n    }\n\n    all() {\n        return this._all(this.data, []);\n    }\n\n    search(bbox) {\n        let node = this.data;\n        const result = [];\n\n        if (!intersects(bbox, node)) return result;\n\n        const toBBox = this.toBBox;\n        const nodesToSearch = [];\n\n        while (node) {\n            for (let i = 0; i < node.children.length; i++) {\n                const child = node.children[i];\n                const childBBox = node.leaf ? toBBox(child) : child;\n\n                if (intersects(bbox, childBBox)) {\n                    if (node.leaf) result.push(child);\n                    else if (contains(bbox, childBBox)) this._all(child, result);\n                    else nodesToSearch.push(child);\n                }\n            }\n            node = nodesToSearch.pop();\n        }\n\n        return result;\n    }\n\n    collides(bbox) {\n        let node = this.data;\n\n        if (!intersects(bbox, node)) return false;\n\n        const nodesToSearch = [];\n        while (node) {\n            for (let i = 0; i < node.children.length; i++) {\n                const child = node.children[i];\n                const childBBox = node.leaf ? this.toBBox(child) : child;\n\n                if (intersects(bbox, childBBox)) {\n                    if (node.leaf || contains(bbox, childBBox)) return true;\n                    nodesToSearch.push(child);\n                }\n            }\n            node = nodesToSearch.pop();\n        }\n\n        return false;\n    }\n\n    load(data) {\n        if (!(data && data.length)) return this;\n\n        if (data.length < this._minEntries) {\n            for (let i = 0; i < data.length; i++) {\n                this.insert(data[i]);\n            }\n            return this;\n        }\n\n        // recursively build the tree with the given data from scratch using OMT algorithm\n        let node = this._build(data.slice(), 0, data.length - 1, 0);\n\n        if (!this.data.children.length) {\n            // save as is if tree is empty\n            this.data = node;\n\n        } else if (this.data.height === node.height) {\n            // split root if trees have the same height\n            this._splitRoot(this.data, node);\n\n        } else {\n            if (this.data.height < node.height) {\n                // swap trees if inserted one is bigger\n                const tmpNode = this.data;\n                this.data = node;\n                node = tmpNode;\n            }\n\n            // insert the small tree into the large tree at appropriate level\n            this._insert(node, this.data.height - node.height - 1, true);\n        }\n\n        return this;\n    }\n\n    insert(item) {\n        if (item) this._insert(item, this.data.height - 1);\n        return this;\n    }\n\n    clear() {\n        this.data = createNode([]);\n        return this;\n    }\n\n    remove(item, equalsFn) {\n        if (!item) return this;\n\n        let node = this.data;\n        const bbox = this.toBBox(item);\n        const path = [];\n        const indexes = [];\n        let i, parent, goingUp;\n\n        // depth-first iterative tree traversal\n        while (node || path.length) {\n\n            if (!node) { // go up\n                node = path.pop();\n                parent = path[path.length - 1];\n                i = indexes.pop();\n                goingUp = true;\n            }\n\n            if (node.leaf) { // check current node\n                const index = findItem(item, node.children, equalsFn);\n\n                if (index !== -1) {\n                    // item found, remove the item and condense tree upwards\n                    node.children.splice(index, 1);\n                    path.push(node);\n                    this._condense(path);\n                    return this;\n                }\n            }\n\n            if (!goingUp && !node.leaf && contains(node, bbox)) { // go down\n                path.push(node);\n                indexes.push(i);\n                i = 0;\n                parent = node;\n                node = node.children[0];\n\n            } else if (parent) { // go right\n                i++;\n                node = parent.children[i];\n                goingUp = false;\n\n            } else node = null; // nothing found\n        }\n\n        return this;\n    }\n\n    toBBox(item) { return item; }\n\n    compareMinX(a, b) { return a.minX - b.minX; }\n    compareMinY(a, b) { return a.minY - b.minY; }\n\n    toJSON() { return this.data; }\n\n    fromJSON(data) {\n        this.data = data;\n        return this;\n    }\n\n    _all(node, result) {\n        const nodesToSearch = [];\n        while (node) {\n            if (node.leaf) result.push(...node.children);\n            else nodesToSearch.push(...node.children);\n\n            node = nodesToSearch.pop();\n        }\n        return result;\n    }\n\n    _build(items, left, right, height) {\n\n        const N = right - left + 1;\n        let M = this._maxEntries;\n        let node;\n\n        if (N <= M) {\n            // reached leaf level; return leaf\n            node = createNode(items.slice(left, right + 1));\n            calcBBox(node, this.toBBox);\n            return node;\n        }\n\n        if (!height) {\n            // target height of the bulk-loaded tree\n            height = Math.ceil(Math.log(N) / Math.log(M));\n\n            // target number of root entries to maximize storage utilization\n            M = Math.ceil(N / Math.pow(M, height - 1));\n        }\n\n        node = createNode([]);\n        node.leaf = false;\n        node.height = height;\n\n        // split the items into M mostly square tiles\n\n        const N2 = Math.ceil(N / M);\n        const N1 = N2 * Math.ceil(Math.sqrt(M));\n\n        multiSelect(items, left, right, N1, this.compareMinX);\n\n        for (let i = left; i <= right; i += N1) {\n\n            const right2 = Math.min(i + N1 - 1, right);\n\n            multiSelect(items, i, right2, N2, this.compareMinY);\n\n            for (let j = i; j <= right2; j += N2) {\n\n                const right3 = Math.min(j + N2 - 1, right2);\n\n                // pack each entry recursively\n                node.children.push(this._build(items, j, right3, height - 1));\n            }\n        }\n\n        calcBBox(node, this.toBBox);\n\n        return node;\n    }\n\n    _chooseSubtree(bbox, node, level, path) {\n        while (true) {\n            path.push(node);\n\n            if (node.leaf || path.length - 1 === level) break;\n\n            let minArea = Infinity;\n            let minEnlargement = Infinity;\n            let targetNode;\n\n            for (let i = 0; i < node.children.length; i++) {\n                const child = node.children[i];\n                const area = bboxArea(child);\n                const enlargement = enlargedArea(bbox, child) - area;\n\n                // choose entry with the least area enlargement\n                if (enlargement < minEnlargement) {\n                    minEnlargement = enlargement;\n                    minArea = area < minArea ? area : minArea;\n                    targetNode = child;\n\n                } else if (enlargement === minEnlargement) {\n                    // otherwise choose one with the smallest area\n                    if (area < minArea) {\n                        minArea = area;\n                        targetNode = child;\n                    }\n                }\n            }\n\n            node = targetNode || node.children[0];\n        }\n\n        return node;\n    }\n\n    _insert(item, level, isNode) {\n        const bbox = isNode ? item : this.toBBox(item);\n        const insertPath = [];\n\n        // find the best node for accommodating the item, saving all nodes along the path too\n        const node = this._chooseSubtree(bbox, this.data, level, insertPath);\n\n        // put the item into the node\n        node.children.push(item);\n        extend(node, bbox);\n\n        // split on node overflow; propagate upwards if necessary\n        while (level >= 0) {\n            if (insertPath[level].children.length > this._maxEntries) {\n                this._split(insertPath, level);\n                level--;\n            } else break;\n        }\n\n        // adjust bboxes along the insertion path\n        this._adjustParentBBoxes(bbox, insertPath, level);\n    }\n\n    // split overflowed node into two\n    _split(insertPath, level) {\n        const node = insertPath[level];\n        const M = node.children.length;\n        const m = this._minEntries;\n\n        this._chooseSplitAxis(node, m, M);\n\n        const splitIndex = this._chooseSplitIndex(node, m, M);\n\n        const newNode = createNode(node.children.splice(splitIndex, node.children.length - splitIndex));\n        newNode.height = node.height;\n        newNode.leaf = node.leaf;\n\n        calcBBox(node, this.toBBox);\n        calcBBox(newNode, this.toBBox);\n\n        if (level) insertPath[level - 1].children.push(newNode);\n        else this._splitRoot(node, newNode);\n    }\n\n    _splitRoot(node, newNode) {\n        // split root node\n        this.data = createNode([node, newNode]);\n        this.data.height = node.height + 1;\n        this.data.leaf = false;\n        calcBBox(this.data, this.toBBox);\n    }\n\n    _chooseSplitIndex(node, m, M) {\n        let index;\n        let minOverlap = Infinity;\n        let minArea = Infinity;\n\n        for (let i = m; i <= M - m; i++) {\n            const bbox1 = distBBox(node, 0, i, this.toBBox);\n            const bbox2 = distBBox(node, i, M, this.toBBox);\n\n            const overlap = intersectionArea(bbox1, bbox2);\n            const area = bboxArea(bbox1) + bboxArea(bbox2);\n\n            // choose distribution with minimum overlap\n            if (overlap < minOverlap) {\n                minOverlap = overlap;\n                index = i;\n\n                minArea = area < minArea ? area : minArea;\n\n            } else if (overlap === minOverlap) {\n                // otherwise choose distribution with minimum area\n                if (area < minArea) {\n                    minArea = area;\n                    index = i;\n                }\n            }\n        }\n\n        return index || M - m;\n    }\n\n    // sorts node children by the best axis for split\n    _chooseSplitAxis(node, m, M) {\n        const compareMinX = node.leaf ? this.compareMinX : compareNodeMinX;\n        const compareMinY = node.leaf ? this.compareMinY : compareNodeMinY;\n        const xMargin = this._allDistMargin(node, m, M, compareMinX);\n        const yMargin = this._allDistMargin(node, m, M, compareMinY);\n\n        // if total distributions margin value is minimal for x, sort by minX,\n        // otherwise it's already sorted by minY\n        if (xMargin < yMargin) node.children.sort(compareMinX);\n    }\n\n    // total margin of all possible split distributions where each node is at least m full\n    _allDistMargin(node, m, M, compare) {\n        node.children.sort(compare);\n\n        const toBBox = this.toBBox;\n        const leftBBox = distBBox(node, 0, m, toBBox);\n        const rightBBox = distBBox(node, M - m, M, toBBox);\n        let margin = bboxMargin(leftBBox) + bboxMargin(rightBBox);\n\n        for (let i = m; i < M - m; i++) {\n            const child = node.children[i];\n            extend(leftBBox, node.leaf ? toBBox(child) : child);\n            margin += bboxMargin(leftBBox);\n        }\n\n        for (let i = M - m - 1; i >= m; i--) {\n            const child = node.children[i];\n            extend(rightBBox, node.leaf ? toBBox(child) : child);\n            margin += bboxMargin(rightBBox);\n        }\n\n        return margin;\n    }\n\n    _adjustParentBBoxes(bbox, path, level) {\n        // adjust bboxes along the given tree path\n        for (let i = level; i >= 0; i--) {\n            extend(path[i], bbox);\n        }\n    }\n\n    _condense(path) {\n        // go through the path, removing empty nodes and updating bboxes\n        for (let i = path.length - 1, siblings; i >= 0; i--) {\n            if (path[i].children.length === 0) {\n                if (i > 0) {\n                    siblings = path[i - 1].children;\n                    siblings.splice(siblings.indexOf(path[i]), 1);\n\n                } else this.clear();\n\n            } else calcBBox(path[i], this.toBBox);\n        }\n    }\n}\n\nfunction findItem(item, items, equalsFn) {\n    if (!equalsFn) return items.indexOf(item);\n\n    for (let i = 0; i < items.length; i++) {\n        if (equalsFn(item, items[i])) return i;\n    }\n    return -1;\n}\n\n// calculate node's bbox from bboxes of its children\nfunction calcBBox(node, toBBox) {\n    distBBox(node, 0, node.children.length, toBBox, node);\n}\n\n// min bounding rectangle of node children from k to p-1\nfunction distBBox(node, k, p, toBBox, destNode) {\n    if (!destNode) destNode = createNode(null);\n    destNode.minX = Infinity;\n    destNode.minY = Infinity;\n    destNode.maxX = -Infinity;\n    destNode.maxY = -Infinity;\n\n    for (let i = k; i < p; i++) {\n        const child = node.children[i];\n        extend(destNode, node.leaf ? toBBox(child) : child);\n    }\n\n    return destNode;\n}\n\nfunction extend(a, b) {\n    a.minX = Math.min(a.minX, b.minX);\n    a.minY = Math.min(a.minY, b.minY);\n    a.maxX = Math.max(a.maxX, b.maxX);\n    a.maxY = Math.max(a.maxY, b.maxY);\n    return a;\n}\n\nfunction compareNodeMinX(a, b) { return a.minX - b.minX; }\nfunction compareNodeMinY(a, b) { return a.minY - b.minY; }\n\nfunction bboxArea(a)   { return (a.maxX - a.minX) * (a.maxY - a.minY); }\nfunction bboxMargin(a) { return (a.maxX - a.minX) + (a.maxY - a.minY); }\n\nfunction enlargedArea(a, b) {\n    return (Math.max(b.maxX, a.maxX) - Math.min(b.minX, a.minX)) *\n           (Math.max(b.maxY, a.maxY) - Math.min(b.minY, a.minY));\n}\n\nfunction intersectionArea(a, b) {\n    const minX = Math.max(a.minX, b.minX);\n    const minY = Math.max(a.minY, b.minY);\n    const maxX = Math.min(a.maxX, b.maxX);\n    const maxY = Math.min(a.maxY, b.maxY);\n\n    return Math.max(0, maxX - minX) *\n           Math.max(0, maxY - minY);\n}\n\nfunction contains(a, b) {\n    return a.minX <= b.minX &&\n           a.minY <= b.minY &&\n           b.maxX <= a.maxX &&\n           b.maxY <= a.maxY;\n}\n\nfunction intersects(a, b) {\n    return b.minX <= a.maxX &&\n           b.minY <= a.maxY &&\n           b.maxX >= a.minX &&\n           b.maxY >= a.minY;\n}\n\nfunction createNode(children) {\n    return {\n        children,\n        height: 1,\n        leaf: true,\n        minX: Infinity,\n        minY: Infinity,\n        maxX: -Infinity,\n        maxY: -Infinity\n    };\n}\n\n// sort an array so that items come in groups of n unsorted items, with groups sorted between each other;\n// combines selection algorithm with binary divide & conquer approach\n\nfunction multiSelect(arr, left, right, n, compare) {\n    const stack = [left, right];\n\n    while (stack.length) {\n        right = stack.pop();\n        left = stack.pop();\n\n        if (right - left <= n) continue;\n\n        const mid = left + Math.ceil((right - left) / n / 2) * n;\n        quickselect(arr, mid, left, right, compare);\n\n        stack.push(left, mid, mid, right);\n    }\n}\n","/**\n * @module ol/style/IconImage\n */\n\nimport EventTarget from '../events/Target.js';\nimport EventType from '../events/EventType.js';\nimport ImageState from '../ImageState.js';\nimport {asString} from '../color.js';\nimport {createCanvasContext2D} from '../dom.js';\nimport {shared as iconImageCache} from './IconImageCache.js';\nimport {listenImage} from '../Image.js';\n\n/**\n * @type {CanvasRenderingContext2D}\n */\nlet taintedTestContext = null;\n\nclass IconImage extends EventTarget {\n  /**\n   * @param {HTMLImageElement|HTMLCanvasElement} image Image.\n   * @param {string|undefined} src Src.\n   * @param {import(\"../size.js\").Size} size Size.\n   * @param {?string} crossOrigin Cross origin.\n   * @param {import(\"../ImageState.js\").default} imageState Image state.\n   * @param {import(\"../color.js\").Color} color Color.\n   */\n  constructor(image, src, size, crossOrigin, imageState, color) {\n    super();\n\n    /**\n     * @private\n     * @type {HTMLImageElement|HTMLCanvasElement}\n     */\n    this.hitDetectionImage_ = null;\n\n    /**\n     * @private\n     * @type {HTMLImageElement|HTMLCanvasElement}\n     */\n    this.image_ = image;\n\n    /**\n     * @private\n     * @type {string|null}\n     */\n    this.crossOrigin_ = crossOrigin;\n\n    /**\n     * @private\n     * @type {Object<number, HTMLCanvasElement>}\n     */\n    this.canvas_ = {};\n\n    /**\n     * @private\n     * @type {import(\"../color.js\").Color}\n     */\n    this.color_ = color;\n\n    /**\n     * @private\n     * @type {?function():void}\n     */\n    this.unlisten_ = null;\n\n    /**\n     * @private\n     * @type {import(\"../ImageState.js\").default}\n     */\n    this.imageState_ = imageState;\n\n    /**\n     * @private\n     * @type {import(\"../size.js\").Size}\n     */\n    this.size_ = size;\n\n    /**\n     * @private\n     * @type {string|undefined}\n     */\n    this.src_ = src;\n\n    /**\n     * @private\n     */\n    this.tainted_;\n  }\n\n  /**\n   * @private\n   */\n  initializeImage_() {\n    this.image_ = new Image();\n    if (this.crossOrigin_ !== null) {\n      this.image_.crossOrigin = this.crossOrigin_;\n    }\n  }\n\n  /**\n   * @private\n   * @return {boolean} The image canvas is tainted.\n   */\n  isTainted_() {\n    if (this.tainted_ === undefined && this.imageState_ === ImageState.LOADED) {\n      if (!taintedTestContext) {\n        taintedTestContext = createCanvasContext2D(1, 1, undefined, {\n          willReadFrequently: true,\n        });\n      }\n      taintedTestContext.drawImage(this.image_, 0, 0);\n      try {\n        taintedTestContext.getImageData(0, 0, 1, 1);\n        this.tainted_ = false;\n      } catch (e) {\n        taintedTestContext = null;\n        this.tainted_ = true;\n      }\n    }\n    return this.tainted_ === true;\n  }\n\n  /**\n   * @private\n   */\n  dispatchChangeEvent_() {\n    this.dispatchEvent(EventType.CHANGE);\n  }\n\n  /**\n   * @private\n   */\n  handleImageError_() {\n    this.imageState_ = ImageState.ERROR;\n    this.unlistenImage_();\n    this.dispatchChangeEvent_();\n  }\n\n  /**\n   * @private\n   */\n  handleImageLoad_() {\n    this.imageState_ = ImageState.LOADED;\n    if (this.size_) {\n      this.image_.width = this.size_[0];\n      this.image_.height = this.size_[1];\n    } else {\n      this.size_ = [this.image_.width, this.image_.height];\n    }\n    this.unlistenImage_();\n    this.dispatchChangeEvent_();\n  }\n\n  /**\n   * @param {number} pixelRatio Pixel ratio.\n   * @return {HTMLImageElement|HTMLCanvasElement} Image or Canvas element.\n   */\n  getImage(pixelRatio) {\n    if (!this.image_) {\n      this.initializeImage_();\n    }\n    this.replaceColor_(pixelRatio);\n    return this.canvas_[pixelRatio] ? this.canvas_[pixelRatio] : this.image_;\n  }\n\n  /**\n   * @param {number} pixelRatio Pixel ratio.\n   * @return {number} Image or Canvas element.\n   */\n  getPixelRatio(pixelRatio) {\n    this.replaceColor_(pixelRatio);\n    return this.canvas_[pixelRatio] ? pixelRatio : 1;\n  }\n\n  /**\n   * @return {import(\"../ImageState.js\").default} Image state.\n   */\n  getImageState() {\n    return this.imageState_;\n  }\n\n  /**\n   * @return {HTMLImageElement|HTMLCanvasElement} Image element.\n   */\n  getHitDetectionImage() {\n    if (!this.image_) {\n      this.initializeImage_();\n    }\n    if (!this.hitDetectionImage_) {\n      if (this.isTainted_()) {\n        const width = this.size_[0];\n        const height = this.size_[1];\n        const context = createCanvasContext2D(width, height);\n        context.fillRect(0, 0, width, height);\n        this.hitDetectionImage_ = context.canvas;\n      } else {\n        this.hitDetectionImage_ = this.image_;\n      }\n    }\n    return this.hitDetectionImage_;\n  }\n\n  /**\n   * Get the size of the icon (in pixels).\n   * @return {import(\"../size.js\").Size} Image size.\n   */\n  getSize() {\n    return this.size_;\n  }\n\n  /**\n   * @return {string|undefined} Image src.\n   */\n  getSrc() {\n    return this.src_;\n  }\n\n  /**\n   * Load not yet loaded URI.\n   */\n  load() {\n    if (this.imageState_ !== ImageState.IDLE) {\n      return;\n    }\n    if (!this.image_) {\n      this.initializeImage_();\n    }\n\n    this.imageState_ = ImageState.LOADING;\n    try {\n      /** @type {HTMLImageElement} */ (this.image_).src = this.src_;\n    } catch (e) {\n      this.handleImageError_();\n    }\n    this.unlisten_ = listenImage(\n      this.image_,\n      this.handleImageLoad_.bind(this),\n      this.handleImageError_.bind(this)\n    );\n  }\n\n  /**\n   * @param {number} pixelRatio Pixel ratio.\n   * @private\n   */\n  replaceColor_(pixelRatio) {\n    if (\n      !this.color_ ||\n      this.canvas_[pixelRatio] ||\n      this.imageState_ !== ImageState.LOADED\n    ) {\n      return;\n    }\n\n    const image = this.image_;\n    const canvas = document.createElement('canvas');\n    canvas.width = Math.ceil(image.width * pixelRatio);\n    canvas.height = Math.ceil(image.height * pixelRatio);\n\n    const ctx = canvas.getContext('2d');\n    ctx.scale(pixelRatio, pixelRatio);\n    ctx.drawImage(image, 0, 0);\n\n    ctx.globalCompositeOperation = 'multiply';\n    ctx.fillStyle = asString(this.color_);\n    ctx.fillRect(0, 0, canvas.width / pixelRatio, canvas.height / pixelRatio);\n\n    ctx.globalCompositeOperation = 'destination-in';\n    ctx.drawImage(image, 0, 0);\n\n    this.canvas_[pixelRatio] = canvas;\n  }\n\n  /**\n   * Discards event handlers which listen for load completion or errors.\n   *\n   * @private\n   */\n  unlistenImage_() {\n    if (this.unlisten_) {\n      this.unlisten_();\n      this.unlisten_ = null;\n    }\n  }\n}\n\n/**\n * @param {HTMLImageElement|HTMLCanvasElement} image Image.\n * @param {string} src Src.\n * @param {import(\"../size.js\").Size} size Size.\n * @param {?string} crossOrigin Cross origin.\n * @param {import(\"../ImageState.js\").default} imageState Image state.\n * @param {import(\"../color.js\").Color} color Color.\n * @return {IconImage} Icon image.\n */\nexport function get(image, src, size, crossOrigin, imageState, color) {\n  let iconImage = iconImageCache.get(src, crossOrigin, color);\n  if (!iconImage) {\n    iconImage = new IconImage(image, src, size, crossOrigin, imageState, color);\n    iconImageCache.set(src, crossOrigin, color, iconImage);\n  }\n  return iconImage;\n}\n\nexport default IconImage;\n","/**\n * @module ol/style/Icon\n */\nimport EventType from '../events/EventType.js';\nimport ImageState from '../ImageState.js';\nimport ImageStyle from './Image.js';\nimport {asArray} from '../color.js';\nimport {assert} from '../asserts.js';\nimport {get as getIconImage} from './IconImage.js';\nimport {getUid} from '../util.js';\n\n/**\n * @typedef {'fraction' | 'pixels'} IconAnchorUnits\n * Anchor unit can be either a fraction of the icon size or in pixels.\n */\n\n/**\n * @typedef {'bottom-left' | 'bottom-right' | 'top-left' | 'top-right'} IconOrigin\n * Icon origin. One of 'bottom-left', 'bottom-right', 'top-left', 'top-right'.\n */\n\n/**\n * @typedef {Object} Options\n * @property {Array<number>} [anchor=[0.5, 0.5]] Anchor. Default value is the icon center.\n * @property {IconOrigin} [anchorOrigin='top-left'] Origin of the anchor: `bottom-left`, `bottom-right`,\n * `top-left` or `top-right`.\n * @property {IconAnchorUnits} [anchorXUnits='fraction'] Units in which the anchor x value is\n * specified. A value of `'fraction'` indicates the x value is a fraction of the icon. A value of `'pixels'` indicates\n * the x value in pixels.\n * @property {IconAnchorUnits} [anchorYUnits='fraction'] Units in which the anchor y value is\n * specified. A value of `'fraction'` indicates the y value is a fraction of the icon. A value of `'pixels'` indicates\n * the y value in pixels.\n * @property {import(\"../color.js\").Color|string} [color] Color to tint the icon. If not specified,\n * the icon will be left as is.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images. Note that you must provide a\n * `crossOrigin` value if you want to access pixel data with the Canvas renderer.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image for more detail.\n * @property {HTMLImageElement|HTMLCanvasElement} [img] Image object for the icon. If the `src` option is not provided then the\n * provided image must already be loaded. And in that case, it is required\n * to provide the size of the image, with the `imgSize` option.\n * @property {import(\"../size.js\").Size} [imgSize] Image size in pixels. Only required if `img` is set and `src` is not.\n * The provided `imgSize` needs to match the actual size of the image.\n * @property {Array<number>} [displacement=[0, 0]] Displacement of the icon in pixels.\n * Positive values will shift the icon right and up.\n * @property {number} [opacity=1] Opacity of the icon.\n * @property {number} [width] The width of the icon in pixels. This can't be used together with `scale`.\n * @property {number} [height] The height of the icon in pixels. This can't be used together with `scale`.\n * @property {number|import(\"../size.js\").Size} [scale=1] Scale.\n * @property {boolean} [rotateWithView=false] Whether to rotate the icon with the view.\n * @property {number} [rotation=0] Rotation in radians (positive rotation clockwise).\n * @property {Array<number>} [offset=[0, 0]] Offset which, together with `size` and `offsetOrigin`, defines the\n * sub-rectangle to use from the original (sprite) image.\n * @property {IconOrigin} [offsetOrigin='top-left'] Origin of the offset: `bottom-left`, `bottom-right`,\n * `top-left` or `top-right`.\n * @property {import(\"../size.js\").Size} [size] Icon size in pixels. Used together with `offset` to define the\n * sub-rectangle to use from the original (sprite) image.\n * @property {string} [src] Image source URI.\n * @property {\"declutter\"|\"obstacle\"|\"none\"|undefined} [declutterMode] Declutter mode.\n */\n\n/**\n * @classdesc\n * Set icon style for vector features.\n * @api\n */\nclass Icon extends ImageStyle {\n  /**\n   * @param {Options} [options] Options.\n   */\n  constructor(options) {\n    options = options || {};\n\n    /**\n     * @type {number}\n     */\n    const opacity = options.opacity !== undefined ? options.opacity : 1;\n\n    /**\n     * @type {number}\n     */\n    const rotation = options.rotation !== undefined ? options.rotation : 0;\n\n    /**\n     * @type {number|import(\"../size.js\").Size}\n     */\n    const scale = options.scale !== undefined ? options.scale : 1;\n\n    /**\n     * @type {boolean}\n     */\n    const rotateWithView =\n      options.rotateWithView !== undefined ? options.rotateWithView : false;\n\n    super({\n      opacity: opacity,\n      rotation: rotation,\n      scale: scale,\n      displacement:\n        options.displacement !== undefined ? options.displacement : [0, 0],\n      rotateWithView: rotateWithView,\n      declutterMode: options.declutterMode,\n    });\n\n    /**\n     * @private\n     * @type {Array<number>}\n     */\n    this.anchor_ = options.anchor !== undefined ? options.anchor : [0.5, 0.5];\n\n    /**\n     * @private\n     * @type {Array<number>}\n     */\n    this.normalizedAnchor_ = null;\n\n    /**\n     * @private\n     * @type {IconOrigin}\n     */\n    this.anchorOrigin_ =\n      options.anchorOrigin !== undefined ? options.anchorOrigin : 'top-left';\n\n    /**\n     * @private\n     * @type {IconAnchorUnits}\n     */\n    this.anchorXUnits_ =\n      options.anchorXUnits !== undefined ? options.anchorXUnits : 'fraction';\n\n    /**\n     * @private\n     * @type {IconAnchorUnits}\n     */\n    this.anchorYUnits_ =\n      options.anchorYUnits !== undefined ? options.anchorYUnits : 'fraction';\n\n    /**\n     * @private\n     * @type {?string}\n     */\n    this.crossOrigin_ =\n      options.crossOrigin !== undefined ? options.crossOrigin : null;\n\n    /**\n     * @type {HTMLImageElement|HTMLCanvasElement}\n     */\n    const image = options.img !== undefined ? options.img : null;\n\n    /**\n     * @private\n     * @type {import(\"../size.js\").Size|undefined}\n     */\n    this.imgSize_ = options.imgSize;\n\n    /**\n     * @type {string|undefined}\n     */\n    let src = options.src;\n\n    assert(!(src !== undefined && image), 4); // `image` and `src` cannot be provided at the same time\n    assert(!image || (image && this.imgSize_), 5); // `imgSize` must be set when `image` is provided\n\n    if ((src === undefined || src.length === 0) && image) {\n      src = /** @type {HTMLImageElement} */ (image).src || getUid(image);\n    }\n    assert(src !== undefined && src.length > 0, 6); // A defined and non-empty `src` or `image` must be provided\n\n    // `width` or `height` cannot be provided together with `scale`\n    assert(\n      !(\n        (options.width !== undefined || options.height !== undefined) &&\n        options.scale !== undefined\n      ),\n      69\n    );\n\n    /**\n     * @type {import(\"../ImageState.js\").default}\n     */\n    const imageState =\n      options.src !== undefined ? ImageState.IDLE : ImageState.LOADED;\n\n    /**\n     * @private\n     * @type {import(\"../color.js\").Color}\n     */\n    this.color_ = options.color !== undefined ? asArray(options.color) : null;\n\n    /**\n     * @private\n     * @type {import(\"./IconImage.js\").default}\n     */\n    this.iconImage_ = getIconImage(\n      image,\n      /** @type {string} */ (src),\n      this.imgSize_ !== undefined ? this.imgSize_ : null,\n      this.crossOrigin_,\n      imageState,\n      this.color_\n    );\n\n    /**\n     * @private\n     * @type {Array<number>}\n     */\n    this.offset_ = options.offset !== undefined ? options.offset : [0, 0];\n    /**\n     * @private\n     * @type {IconOrigin}\n     */\n    this.offsetOrigin_ =\n      options.offsetOrigin !== undefined ? options.offsetOrigin : 'top-left';\n\n    /**\n     * @private\n     * @type {Array<number>}\n     */\n    this.origin_ = null;\n\n    /**\n     * @private\n     * @type {import(\"../size.js\").Size}\n     */\n    this.size_ = options.size !== undefined ? options.size : null;\n\n    /**\n     * @type {number|undefined}\n     */\n    this.width_ = options.width;\n\n    /**\n     * @type {number|undefined}\n     */\n    this.height_ = options.height;\n\n    /**\n     * Recalculate the scale if width or height where given.\n     */\n    if (this.width_ !== undefined || this.height_ !== undefined) {\n      const image = this.getImage(1);\n      const setScale = () => {\n        this.updateScaleFromWidthAndHeight(this.width_, this.height_);\n      };\n      if (image.width > 0) {\n        this.updateScaleFromWidthAndHeight(this.width_, this.height_);\n      } else {\n        image.addEventListener('load', setScale);\n      }\n    }\n  }\n\n  /**\n   * Clones the style. The underlying Image/HTMLCanvasElement is not cloned.\n   * @return {Icon} The cloned style.\n   * @api\n   */\n  clone() {\n    const scale = this.getScale();\n    return new Icon({\n      anchor: this.anchor_.slice(),\n      anchorOrigin: this.anchorOrigin_,\n      anchorXUnits: this.anchorXUnits_,\n      anchorYUnits: this.anchorYUnits_,\n      color:\n        this.color_ && this.color_.slice\n          ? this.color_.slice()\n          : this.color_ || undefined,\n      crossOrigin: this.crossOrigin_,\n      imgSize: this.imgSize_,\n      offset: this.offset_.slice(),\n      offsetOrigin: this.offsetOrigin_,\n      opacity: this.getOpacity(),\n      rotateWithView: this.getRotateWithView(),\n      rotation: this.getRotation(),\n      scale: Array.isArray(scale) ? scale.slice() : scale,\n      size: this.size_ !== null ? this.size_.slice() : undefined,\n      src: this.getSrc(),\n      displacement: this.getDisplacement().slice(),\n      declutterMode: this.getDeclutterMode(),\n      width: this.width_,\n      height: this.height_,\n    });\n  }\n\n  /**\n   * Set the scale of the Icon by calculating it from given width and height and the\n   * width and height of the image.\n   *\n   * @private\n   * @param {number} width The width.\n   * @param {number} height The height.\n   */\n  updateScaleFromWidthAndHeight(width, height) {\n    const image = this.getImage(1);\n    if (width !== undefined && height !== undefined) {\n      super.setScale([width / image.width, height / image.height]);\n    } else if (width !== undefined) {\n      super.setScale([width / image.width, width / image.width]);\n    } else if (height !== undefined) {\n      super.setScale([height / image.height, height / image.height]);\n    } else {\n      super.setScale([1, 1]);\n    }\n  }\n\n  /**\n   * Get the anchor point in pixels. The anchor determines the center point for the\n   * symbolizer.\n   * @return {Array<number>} Anchor.\n   * @api\n   */\n  getAnchor() {\n    let anchor = this.normalizedAnchor_;\n    if (!anchor) {\n      anchor = this.anchor_;\n      const size = this.getSize();\n      if (\n        this.anchorXUnits_ == 'fraction' ||\n        this.anchorYUnits_ == 'fraction'\n      ) {\n        if (!size) {\n          return null;\n        }\n        anchor = this.anchor_.slice();\n        if (this.anchorXUnits_ == 'fraction') {\n          anchor[0] *= size[0];\n        }\n        if (this.anchorYUnits_ == 'fraction') {\n          anchor[1] *= size[1];\n        }\n      }\n\n      if (this.anchorOrigin_ != 'top-left') {\n        if (!size) {\n          return null;\n        }\n        if (anchor === this.anchor_) {\n          anchor = this.anchor_.slice();\n        }\n        if (\n          this.anchorOrigin_ == 'top-right' ||\n          this.anchorOrigin_ == 'bottom-right'\n        ) {\n          anchor[0] = -anchor[0] + size[0];\n        }\n        if (\n          this.anchorOrigin_ == 'bottom-left' ||\n          this.anchorOrigin_ == 'bottom-right'\n        ) {\n          anchor[1] = -anchor[1] + size[1];\n        }\n      }\n      this.normalizedAnchor_ = anchor;\n    }\n    const displacement = this.getDisplacement();\n    const scale = this.getScaleArray();\n    // anchor is scaled by renderer but displacement should not be scaled\n    // so divide by scale here\n    return [\n      anchor[0] - displacement[0] / scale[0],\n      anchor[1] + displacement[1] / scale[1],\n    ];\n  }\n\n  /**\n   * Set the anchor point. The anchor determines the center point for the\n   * symbolizer.\n   *\n   * @param {Array<number>} anchor Anchor.\n   * @api\n   */\n  setAnchor(anchor) {\n    this.anchor_ = anchor;\n    this.normalizedAnchor_ = null;\n  }\n\n  /**\n   * Get the icon color.\n   * @return {import(\"../color.js\").Color} Color.\n   * @api\n   */\n  getColor() {\n    return this.color_;\n  }\n\n  /**\n   * Get the image icon.\n   * @param {number} pixelRatio Pixel ratio.\n   * @return {HTMLImageElement|HTMLCanvasElement} Image or Canvas element.\n   * @api\n   */\n  getImage(pixelRatio) {\n    return this.iconImage_.getImage(pixelRatio);\n  }\n\n  /**\n   * Get the pixel ratio.\n   * @param {number} pixelRatio Pixel ratio.\n   * @return {number} The pixel ratio of the image.\n   * @api\n   */\n  getPixelRatio(pixelRatio) {\n    return this.iconImage_.getPixelRatio(pixelRatio);\n  }\n\n  /**\n   * @return {import(\"../size.js\").Size} Image size.\n   */\n  getImageSize() {\n    return this.iconImage_.getSize();\n  }\n\n  /**\n   * @return {import(\"../ImageState.js\").default} Image state.\n   */\n  getImageState() {\n    return this.iconImage_.getImageState();\n  }\n\n  /**\n   * @return {HTMLImageElement|HTMLCanvasElement} Image element.\n   */\n  getHitDetectionImage() {\n    return this.iconImage_.getHitDetectionImage();\n  }\n\n  /**\n   * Get the origin of the symbolizer.\n   * @return {Array<number>} Origin.\n   * @api\n   */\n  getOrigin() {\n    if (this.origin_) {\n      return this.origin_;\n    }\n    let offset = this.offset_;\n\n    if (this.offsetOrigin_ != 'top-left') {\n      const size = this.getSize();\n      const iconImageSize = this.iconImage_.getSize();\n      if (!size || !iconImageSize) {\n        return null;\n      }\n      offset = offset.slice();\n      if (\n        this.offsetOrigin_ == 'top-right' ||\n        this.offsetOrigin_ == 'bottom-right'\n      ) {\n        offset[0] = iconImageSize[0] - size[0] - offset[0];\n      }\n      if (\n        this.offsetOrigin_ == 'bottom-left' ||\n        this.offsetOrigin_ == 'bottom-right'\n      ) {\n        offset[1] = iconImageSize[1] - size[1] - offset[1];\n      }\n    }\n    this.origin_ = offset;\n    return this.origin_;\n  }\n\n  /**\n   * Get the image URL.\n   * @return {string|undefined} Image src.\n   * @api\n   */\n  getSrc() {\n    return this.iconImage_.getSrc();\n  }\n\n  /**\n   * Get the size of the icon (in pixels).\n   * @return {import(\"../size.js\").Size} Image size.\n   * @api\n   */\n  getSize() {\n    return !this.size_ ? this.iconImage_.getSize() : this.size_;\n  }\n\n  /**\n   * Get the width of the icon (in pixels).\n   * @return {number} Icon width (in pixels).\n   * @api\n   */\n  getWidth() {\n    return this.width_;\n  }\n\n  /**\n   * Get the height of the icon (in pixels).\n   * @return {number} Icon height (in pixels).\n   * @api\n   */\n  getHeight() {\n    return this.height_;\n  }\n\n  /**\n   * Set the width of the icon in pixels.\n   *\n   * @param {number} width The width to set.\n   */\n  setWidth(width) {\n    this.width_ = width;\n    this.updateScaleFromWidthAndHeight(width, this.height_);\n  }\n\n  /**\n   * Set the height of the icon in pixels.\n   *\n   * @param {number} height The height to set.\n   */\n  setHeight(height) {\n    this.height_ = height;\n    this.updateScaleFromWidthAndHeight(this.width_, height);\n  }\n\n  /**\n   * Set the scale and updates the width and height correspondingly.\n   *\n   * @param {number|import(\"../size.js\").Size} scale Scale.\n   * @override\n   * @api\n   */\n  setScale(scale) {\n    super.setScale(scale);\n    const image = this.getImage(1);\n    if (image) {\n      const widthScale = Array.isArray(scale) ? scale[0] : scale;\n      if (widthScale !== undefined) {\n        this.width_ = widthScale * image.width;\n      }\n      const heightScale = Array.isArray(scale) ? scale[1] : scale;\n      if (heightScale !== undefined) {\n        this.height_ = heightScale * image.height;\n      }\n    }\n  }\n\n  /**\n   * @param {function(import(\"../events/Event.js\").default): void} listener Listener function.\n   */\n  listenImageChange(listener) {\n    this.iconImage_.addEventListener(EventType.CHANGE, listener);\n  }\n\n  /**\n   * Load not yet loaded URI.\n   * When rendering a feature with an icon style, the vector renderer will\n   * automatically call this method. However, you might want to call this\n   * method yourself for preloading or other purposes.\n   * @api\n   */\n  load() {\n    this.iconImage_.load();\n  }\n\n  /**\n   * @param {function(import(\"../events/Event.js\").default): void} listener Listener function.\n   */\n  unlistenImageChange(listener) {\n    this.iconImage_.removeEventListener(EventType.CHANGE, listener);\n  }\n}\n\nexport default Icon;\n","/**\n * @module ol/style/flat\n */\n\nimport Circle from '../style/Circle.js';\nimport Fill from './Fill.js';\nimport Icon from './Icon.js';\nimport RegularShape from './RegularShape.js';\nimport Stroke from './Stroke.js';\nimport Style from './Style.js';\nimport Text from './Text.js';\n\n/**\n * For static styling, the [layer.setStyle()]{@link module:ol/layer/Vector~VectorLayer#setStyle} method\n * can be called with an object literal that has fill, stroke, text, icon, regular shape, and/or circle properties.\n * @api\n *\n * @typedef {FlatFill & FlatStroke & FlatText & FlatIcon & FlatShape & FlatCircle} FlatStyle\n */\n\n/**\n * A flat style literal or an array of the same.\n *\n * @typedef {FlatStyle|Array<FlatStyle>} FlatStyleLike\n */\n\n/**\n * Fill style properties applied to polygon features.\n *\n * @typedef {Object} FlatFill\n * @property {import(\"../color.js\").Color|import(\"../colorlike.js\").ColorLike} [fill-color] The fill color.\n */\n\n/**\n * Stroke style properties applied to line strings and polygon boundaries.  To apply a stroke, at least one of\n * `stroke-color` or `stroke-width` must be provided.\n *\n * @typedef {Object} FlatStroke\n * @property {import(\"../color.js\").Color|import(\"../colorlike.js\").ColorLike} [stroke-color] The stroke color.\n * @property {number} [stroke-width] Stroke pixel width.\n * @property {CanvasLineCap} [stroke-line-cap='round'] Line cap style: `butt`, `round`, or `square`.\n * @property {CanvasLineJoin} [stroke-line-join='round'] Line join style: `bevel`, `round`, or `miter`.\n * @property {Array<number>} [stroke-line-dash] Line dash pattern.\n * @property {number} [stroke-line-dash-offset=0] Line dash offset.\n * @property {number} [stroke-miter-limit=10] Miter limit.\n */\n\n/**\n * Label style properties applied to all features.  At a minimum, a `text-value` must be provided.\n *\n * @typedef {Object} FlatText\n * @property {string|Array<string>} [text-value] Text content or rich text content. For plain text provide a string, which can\n * contain line breaks (`\\n`). For rich text provide an array of text/font tuples. A tuple consists of the text to\n * render and the font to use (or `''` to use the text style's font). A line break has to be a separate tuple (i.e. `'\\n', ''`).\n * **Example:** `['foo', 'bold 10px sans-serif', ' bar', 'italic 10px sans-serif', ' baz', '']` will yield \"**foo** *bar* baz\".\n * **Note:** Rich text is not supported for the immediate rendering API.\n * @property {string} [text-font] Font style as CSS `font` value, see:\n * https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/font. Default is `'10px sans-serif'`\n * @property {number} [text-max-angle=Math.PI/4] When `text-placement` is set to `'line'`, allow a maximum angle between adjacent characters.\n * The expected value is in radians, and the default is 45° (`Math.PI / 4`).\n * @property {number} [text-offset-x=0] Horizontal text offset in pixels. A positive will shift the text right.\n * @property {number} [text-offset-y=0] Vertical text offset in pixels. A positive will shift the text down.\n * @property {boolean} [text-overflow=false] For polygon labels or when `placement` is set to `'line'`, allow text to exceed\n * the width of the polygon at the label position or the length of the path that it follows.\n * @property {import(\"./Text.js\").TextPlacement} [text-placement='point'] Text placement.\n * @property {number|import(\"../size.js\").Size} [text-scale] Scale.\n * @property {boolean} [text-rotate-with-view=false] Whether to rotate the text with the view.\n * @property {number} [text-rotation=0] Rotation in radians (positive rotation clockwise).\n * @property {CanvasTextAlign} [text-align] Text alignment. Possible values: `'left'`, `'right'`, `'center'`, `'end'` or `'start'`.\n * Default is `'center'` for `text-placement: 'point'`. For `text-placement: 'line'`, the default is to let the renderer choose a\n * placement where `text-max-angle` is not exceeded.\n * @property {import('./Text.js').TextJustify} [text-justify] Text justification within the text box.\n * If not set, text is justified towards the `textAlign` anchor.\n * Otherwise, use options `'left'`, `'center'`, or `'right'` to justify the text within the text box.\n * **Note:** `text-justify` is ignored for immediate rendering and also for `text-placement: 'line'`.\n * @property {CanvasTextBaseline} [text-baseline='middle'] Text base line. Possible values: `'bottom'`, `'top'`, `'middle'`, `'alphabetic'`,\n * `'hanging'`, `'ideographic'`.\n * @property {Array<number>} [text-padding=[0, 0, 0, 0]] Padding in pixels around the text for decluttering and background. The order of\n * values in the array is `[top, right, bottom, left]`.\n * @property {import(\"../color.js\").Color|import(\"../colorlike.js\").ColorLike} [text-fill-color] The fill color.\n * @property {import(\"../color.js\").Color|import(\"../colorlike.js\").ColorLike} [text-background-fill-color] The fill color.\n * @property {import(\"../color.js\").Color|import(\"../colorlike.js\").ColorLike} [text-stroke-color] The stroke color.\n * @property {CanvasLineCap} [text-stroke-line-cap='round'] Line cap style: `butt`, `round`, or `square`.\n * @property {CanvasLineJoin} [text-stroke-line-join='round'] Line join style: `bevel`, `round`, or `miter`.\n * @property {Array<number>} [text-stroke-line-dash] Line dash pattern.\n * @property {number} [text-stroke-line-dash-offset=0] Line dash offset.\n * @property {number} [text-stroke-miter-limit=10] Miter limit.\n * @property {number} [text-stroke-width] Stroke pixel width.\n * @property {import(\"../color.js\").Color|import(\"../colorlike.js\").ColorLike} [text-background-stroke-color] The stroke color.\n * @property {CanvasLineCap} [text-background-stroke-line-cap='round'] Line cap style: `butt`, `round`, or `square`.\n * @property {CanvasLineJoin} [text-background-stroke-line-join='round'] Line join style: `bevel`, `round`, or `miter`.\n * @property {Array<number>} [text-background-stroke-line-dash] Line dash pattern.\n * @property {number} [text-background-stroke-line-dash-offset=0] Line dash offset.\n * @property {number} [text-background-stroke-miter-limit=10] Miter limit.\n * @property {number} [text-background-stroke-width] Stroke pixel width.\n */\n\n/**\n * Icon style properties applied to point features.  One of `icon-src` or `icon-img` must be provided to render\n * points with an icon.\n *\n * @typedef {Object} FlatIcon\n * @property {string} [icon-src] Image source URI.\n * @property {HTMLImageElement|HTMLCanvasElement} [icon-img] Image object for the icon. If the `icon-src` option is not provided then the\n * provided image must already be loaded. And in that case, it is required\n * to provide the size of the image, with the `icon-img-size` option.\n * @property {import(\"../size.js\").Size} [icon-img-size] Image size in pixels. Only required if `icon-img` is set and `icon-src` is not.\n * The provided size needs to match the actual size of the image.\n * @property {Array<number>} [icon-anchor=[0.5, 0.5]] Anchor. Default value is the icon center.\n * @property {import(\"./Icon.js\").IconOrigin} [icon-anchor-origin='top-left'] Origin of the anchor: `bottom-left`, `bottom-right`,\n * `top-left` or `top-right`.\n * @property {import(\"./Icon.js\").IconAnchorUnits} [icon-anchor-x-units='fraction'] Units in which the anchor x value is\n * specified. A value of `'fraction'` indicates the x value is a fraction of the icon. A value of `'pixels'` indicates\n * the x value in pixels.\n * @property {import(\"./Icon.js\").IconAnchorUnits} [icon-anchor-y-units='fraction'] Units in which the anchor y value is\n * specified. A value of `'fraction'` indicates the y value is a fraction of the icon. A value of `'pixels'` indicates\n * the y value in pixels.\n * @property {import(\"../color.js\").Color|string} [icon-color] Color to tint the icon. If not specified,\n * the icon will be left as is.\n * @property {null|string} [icon-cross-origin] The `crossOrigin` attribute for loaded images. Note that you must provide a\n * `icon-cross-origin` value if you want to access pixel data with the Canvas renderer.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image for more detail.\n * @property {Array<number>} [icon-offset=[0, 0]] Offset, which, together with the size and the offset origin, define the\n * sub-rectangle to use from the original icon image.\n * @property {Array<number>} [icon-displacement=[0,0]] Displacement of the icon.\n * @property {import(\"./Icon.js\").IconOrigin} [icon-offset-origin='top-left'] Origin of the offset: `bottom-left`, `bottom-right`,\n * `top-left` or `top-right`.\n * @property {number} [icon-opacity=1] Opacity of the icon.\n * @property {number|import(\"../size.js\").Size} [icon-scale=1] Scale.\n * @property {number} [icon-rotation=0] Rotation in radians (positive rotation clockwise).\n * @property {boolean} [icon-rotate-with-view=false] Whether to rotate the icon with the view.\n * @property {import(\"../size.js\").Size} [icon-size] Icon size in pixel. Can be used together with `icon-offset` to define the\n * sub-rectangle to use from the origin (sprite) icon image.\n * @property {\"declutter\"|\"obstacle\"|\"none\"|undefined} [icon-declutter-mode] Declutter mode\n */\n\n/**\n * Regular shape style properties for rendering point features.  At least `shape-points` must be provided.\n *\n * @typedef {Object} FlatShape\n * @property {number} [shape-points] Number of points for stars and regular polygons. In case of a polygon, the number of points\n * is the number of sides.\n * @property {import(\"../color.js\").Color|import(\"../colorlike.js\").ColorLike} [shape-fill-color] The fill color.\n * @property {import(\"../color.js\").Color|import(\"../colorlike.js\").ColorLike} [shape-stroke-color] The stroke color.\n * @property {number} [shape-stroke-width] Stroke pixel width.\n * @property {CanvasLineCap} [shape-stroke-line-cap='round'] Line cap style: `butt`, `round`, or `square`.\n * @property {CanvasLineJoin} [shape-stroke-line-join='round'] Line join style: `bevel`, `round`, or `miter`.\n * @property {Array<number>} [shape-stroke-line-dash] Line dash pattern.\n * @property {number} [shape-stroke-line-dash-offset=0] Line dash offset.\n * @property {number} [shape-stroke-miter-limit=10] Miter limit.\n * @property {number} [shape-radius] Radius of a regular polygon.\n * @property {number} [shape-radius1] First radius of a star. Ignored if radius is set.\n * @property {number} [shape-radius2] Second radius of a star.\n * @property {number} [shape-angle=0] Shape's angle in radians. A value of 0 will have one of the shape's point facing up.\n * @property {Array<number>} [shape-displacement=[0,0]] Displacement of the shape\n * @property {number} [shape-rotation=0] Rotation in radians (positive rotation clockwise).\n * @property {boolean} [shape-rotate-with-view=false] Whether to rotate the shape with the view.\n * @property {number|import(\"../size.js\").Size} [shape-scale=1] Scale. Unless two dimensional scaling is required a better\n * result may be obtained with appropriate settings for `shape-radius`, `shape-radius1` and `shape-radius2`.\n * @property {\"declutter\"|\"obstacle\"|\"none\"|undefined} [shape-declutter-mode] Declutter mode.\n */\n\n/**\n * Circle style properties for rendering point features.  At least `circle-radius` must be provided.\n *\n * @typedef {Object} FlatCircle\n * @property {number} [circle-radius] Circle radius.\n * @property {import(\"../color.js\").Color|import(\"../colorlike.js\").ColorLike} [circle-fill-color] The fill color.\n * @property {import(\"../color.js\").Color|import(\"../colorlike.js\").ColorLike} [circle-stroke-color] The stroke color.\n * @property {number} [circle-stroke-width] Stroke pixel width.\n * @property {CanvasLineCap} [circle-stroke-line-cap='round'] Line cap style: `butt`, `round`, or `square`.\n * @property {CanvasLineJoin} [circle-stroke-line-join='round'] Line join style: `bevel`, `round`, or `miter`.\n * @property {Array<number>} [circle-stroke-line-dash] Line dash pattern.\n * @property {number} [circle-stroke-line-dash-offset=0] Line dash offset.\n * @property {number} [circle-stroke-miter-limit=10] Miter limit.\n * @property {Array<number>} [circle-displacement=[0,0]] displacement\n * @property {number|import(\"../size.js\").Size} [circle-scale=1] Scale. A two dimensional scale will produce an ellipse.\n * Unless two dimensional scaling is required a better result may be obtained with an appropriate setting for `circle-radius`.\n * @property {number} [circle-rotation=0] Rotation in radians\n * (positive rotation clockwise, meaningful only when used in conjunction with a two dimensional scale).\n * @property {boolean} [circle-rotate-with-view=false] Whether to rotate the shape with the view\n * (meaningful only when used in conjunction with a two dimensional scale).\n * @property {\"declutter\"|\"obstacle\"|\"none\"|undefined} [circle-declutter-mode] Declutter mode\n */\n\n/**\n * @param {FlatStyle} flatStyle A flat style literal.\n * @return {import(\"./Style.js\").default} A style instance.\n */\nexport function toStyle(flatStyle) {\n  const style = new Style({\n    fill: getFill(flatStyle, ''),\n    stroke: getStroke(flatStyle, ''),\n    text: getText(flatStyle),\n    image: getImage(flatStyle),\n  });\n\n  return style;\n}\n\n/**\n * @param {FlatStyle} flatStyle The flat style.\n * @param {string} prefix The property prefix.\n * @return {Fill|undefined} The fill (if any).\n */\nfunction getFill(flatStyle, prefix) {\n  const color = flatStyle[prefix + 'fill-color'];\n  if (!color) {\n    return;\n  }\n\n  return new Fill({color: color});\n}\n\n/**\n * @param {FlatStyle} flatStyle The flat style.\n * @param {string} prefix The property prefix.\n * @return {Stroke|undefined} The stroke (if any).\n */\nfunction getStroke(flatStyle, prefix) {\n  const width = flatStyle[prefix + 'stroke-width'];\n  const color = flatStyle[prefix + 'stroke-color'];\n  if (!width && !color) {\n    return;\n  }\n\n  return new Stroke({\n    width: width,\n    color: color,\n    lineCap: flatStyle[prefix + 'stroke-line-cap'],\n    lineJoin: flatStyle[prefix + 'stroke-line-join'],\n    lineDash: flatStyle[prefix + 'stroke-line-dash'],\n    lineDashOffset: flatStyle[prefix + 'stroke-line-dash-offset'],\n    miterLimit: flatStyle[prefix + 'stroke-miter-limit'],\n  });\n}\n\n/**\n * @param {FlatStyle} flatStyle The flat style.\n * @return {Text|undefined} The text (if any).\n */\nfunction getText(flatStyle) {\n  const value = flatStyle['text-value'];\n  if (!value) {\n    return;\n  }\n\n  const text = new Text({\n    text: value,\n    font: flatStyle['text-font'],\n    maxAngle: flatStyle['text-max-angle'],\n    offsetX: flatStyle['text-offset-x'],\n    offsetY: flatStyle['text-offset-y'],\n    overflow: flatStyle['text-overflow'],\n    placement: flatStyle['text-placement'],\n    scale: flatStyle['text-scale'],\n    rotateWithView: flatStyle['text-rotate-with-view'],\n    rotation: flatStyle['text-rotation'],\n    textAlign: flatStyle['text-align'],\n    justify: flatStyle['text-justify'],\n    textBaseline: flatStyle['text-baseline'],\n    padding: flatStyle['text-padding'],\n    fill: getFill(flatStyle, 'text-'),\n    backgroundFill: getFill(flatStyle, 'text-background-'),\n    stroke: getStroke(flatStyle, 'text-'),\n    backgroundStroke: getStroke(flatStyle, 'text-background-'),\n  });\n\n  return text;\n}\n\n/**\n * @param {FlatStyle} flatStyle The flat style.\n * @return {import(\"./Image.js\").default|undefined} The image (if any).\n */\nfunction getImage(flatStyle) {\n  const iconSrc = flatStyle['icon-src'];\n  const iconImg = flatStyle['icon-img'];\n  if (iconSrc || iconImg) {\n    const icon = new Icon({\n      src: iconSrc,\n      img: iconImg,\n      imgSize: flatStyle['icon-img-size'],\n      anchor: flatStyle['icon-anchor'],\n      anchorOrigin: flatStyle['icon-anchor-origin'],\n      anchorXUnits: flatStyle['icon-anchor-x-units'],\n      anchorYUnits: flatStyle['icon-anchor-y-units'],\n      color: flatStyle['icon-color'],\n      crossOrigin: flatStyle['icon-cross-origin'],\n      offset: flatStyle['icon-offset'],\n      displacement: flatStyle['icon-displacement'],\n      opacity: flatStyle['icon-opacity'],\n      scale: flatStyle['icon-scale'],\n      rotation: flatStyle['icon-rotation'],\n      rotateWithView: flatStyle['icon-rotate-with-view'],\n      size: flatStyle['icon-size'],\n      declutterMode: flatStyle['icon-declutter-mode'],\n    });\n    return icon;\n  }\n\n  const shapePoints = flatStyle['shape-points'];\n  if (shapePoints) {\n    const prefix = 'shape-';\n    const shape = new RegularShape({\n      points: shapePoints,\n      fill: getFill(flatStyle, prefix),\n      stroke: getStroke(flatStyle, prefix),\n      radius: flatStyle['shape-radius'],\n      radius1: flatStyle['shape-radius1'],\n      radius2: flatStyle['shape-radius2'],\n      angle: flatStyle['shape-angle'],\n      displacement: flatStyle['shape-displacement'],\n      rotation: flatStyle['shape-rotation'],\n      rotateWithView: flatStyle['shape-rotate-with-view'],\n      scale: flatStyle['shape-scale'],\n      declutterMode: flatStyle['shape-declutter-mode'],\n    });\n\n    return shape;\n  }\n\n  const circleRadius = flatStyle['circle-radius'];\n  if (circleRadius) {\n    const prefix = 'circle-';\n    const circle = new Circle({\n      radius: circleRadius,\n      fill: getFill(flatStyle, prefix),\n      stroke: getStroke(flatStyle, prefix),\n      displacement: flatStyle['circle-displacement'],\n      scale: flatStyle['circle-scale'],\n      rotation: flatStyle['circle-rotation'],\n      rotateWithView: flatStyle['circle-rotate-with-view'],\n      declutterMode: flatStyle['circle-declutter-mode'],\n    });\n\n    return circle;\n  }\n\n  return;\n}\n","/**\n * @module ol/layer/BaseVector\n */\nimport Layer from './Layer.js';\nimport RBush from 'rbush';\nimport Style, {\n  createDefaultStyle,\n  toFunction as toStyleFunction,\n} from '../style/Style.js';\nimport {toStyle} from '../style/flat.js';\n\n/**\n * @template {import(\"../source/Vector.js\").default|import(\"../source/VectorTile.js\").default} VectorSourceType\n * @typedef {Object} Options\n * @property {string} [className='ol-layer'] A CSS class name to set to the layer element.\n * @property {number} [opacity=1] Opacity (0, 1).\n * @property {boolean} [visible=true] Visibility.\n * @property {import(\"../extent.js\").Extent} [extent] The bounding extent for layer rendering.  The layer will not be\n * rendered outside of this extent.\n * @property {number} [zIndex] The z-index for layer rendering.  At rendering time, the layers\n * will be ordered, first by Z-index and then by position. When `undefined`, a `zIndex` of 0 is assumed\n * for layers that are added to the map's `layers` collection, or `Infinity` when the layer's `setMap()`\n * method was used.\n * @property {number} [minResolution] The minimum resolution (inclusive) at which this layer will be\n * visible.\n * @property {number} [maxResolution] The maximum resolution (exclusive) below which this layer will\n * be visible.\n * @property {number} [minZoom] The minimum view zoom level (exclusive) above which this layer will be\n * visible.\n * @property {number} [maxZoom] The maximum view zoom level (inclusive) at which this layer will\n * be visible.\n * @property {import(\"../render.js\").OrderFunction} [renderOrder] Render order. Function to be used when sorting\n * features before rendering. By default features are drawn in the order that they are created. Use\n * `null` to avoid the sort, but get an undefined draw order.\n * @property {number} [renderBuffer=100] The buffer in pixels around the viewport extent used by the\n * renderer when getting features from the vector source for the rendering or hit-detection.\n * Recommended value: the size of the largest symbol, line width or label.\n * @property {VectorSourceType} [source] Source.\n * @property {import(\"../Map.js\").default} [map] Sets the layer as overlay on a map. The map will not manage\n * this layer in its layers collection, and the layer will be rendered on top. This is useful for\n * temporary layers. The standard way to add a layer to a map and have it managed by the map is to\n * use [map.addLayer()]{@link import(\"../Map.js\").default#addLayer}.\n * @property {boolean} [declutter=false] Declutter images and text. Decluttering is applied to all\n * image and text styles of all Vector and VectorTile layers that have set this to `true`. The priority\n * is defined by the z-index of the layer, the `zIndex` of the style and the render order of features.\n * Higher z-index means higher priority. Within the same z-index, a feature rendered before another has\n * higher priority.\n *\n * As an optimization decluttered features from layers with the same `className` are rendered above\n * the fill and stroke styles of all of those layers regardless of z-index.  To opt out of this\n * behavior and place declutterd features with their own layer configure the layer with a `className`\n * other than `ol-layer`.\n * @property {import(\"../style/Style.js\").StyleLike|import(\"../style/flat.js\").FlatStyleLike|null} [style] Layer style. When set to `null`, only\n * features that have their own style will be rendered. See {@link module:ol/style/Style~Style} for the default style\n * which will be used if this is not set.\n * @property {import(\"./Base.js\").BackgroundColor} [background] Background color for the layer. If not specified, no background\n * will be rendered.\n * @property {boolean} [updateWhileAnimating=false] When set to `true`, feature batches will\n * be recreated during animations. This means that no vectors will be shown clipped, but the\n * setting will have a performance impact for large amounts of vector data. When set to `false`,\n * batches will be recreated when no animation is active.\n * @property {boolean} [updateWhileInteracting=false] When set to `true`, feature batches will\n * be recreated during interactions. See also `updateWhileAnimating`.\n * @property {Object<string, *>} [properties] Arbitrary observable properties. Can be accessed with `#get()` and `#set()`.\n */\n\n/**\n * @enum {string}\n * @private\n */\nconst Property = {\n  RENDER_ORDER: 'renderOrder',\n};\n\n/**\n * @classdesc\n * Vector data that is rendered client-side.\n * Note that any property set in the options is set as a {@link module:ol/Object~BaseObject}\n * property on the layer object; for example, setting `title: 'My Title'` in the\n * options means that `title` is observable, and has get/set accessors.\n *\n * @template {import(\"../source/Vector.js\").default|import(\"../source/VectorTile.js\").default} VectorSourceType\n * @template {import(\"../renderer/canvas/VectorLayer.js\").default|import(\"../renderer/canvas/VectorTileLayer.js\").default|import(\"../renderer/canvas/VectorImageLayer.js\").default|import(\"../renderer/webgl/PointsLayer.js\").default} RendererType\n * @extends {Layer<VectorSourceType, RendererType>}\n * @api\n */\nclass BaseVectorLayer extends Layer {\n  /**\n   * @param {Options<VectorSourceType>} [options] Options.\n   */\n  constructor(options) {\n    options = options ? options : {};\n\n    const baseOptions = Object.assign({}, options);\n\n    delete baseOptions.style;\n    delete baseOptions.renderBuffer;\n    delete baseOptions.updateWhileAnimating;\n    delete baseOptions.updateWhileInteracting;\n    super(baseOptions);\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.declutter_ =\n      options.declutter !== undefined ? options.declutter : false;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.renderBuffer_ =\n      options.renderBuffer !== undefined ? options.renderBuffer : 100;\n\n    /**\n     * User provided style.\n     * @type {import(\"../style/Style.js\").StyleLike}\n     * @private\n     */\n    this.style_ = null;\n\n    /**\n     * Style function for use within the library.\n     * @type {import(\"../style/Style.js\").StyleFunction|undefined}\n     * @private\n     */\n    this.styleFunction_ = undefined;\n\n    this.setStyle(options.style);\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.updateWhileAnimating_ =\n      options.updateWhileAnimating !== undefined\n        ? options.updateWhileAnimating\n        : false;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.updateWhileInteracting_ =\n      options.updateWhileInteracting !== undefined\n        ? options.updateWhileInteracting\n        : false;\n  }\n\n  /**\n   * @return {boolean} Declutter.\n   */\n  getDeclutter() {\n    return this.declutter_;\n  }\n\n  /**\n   * Get the topmost feature that intersects the given pixel on the viewport. Returns a promise\n   * that resolves with an array of features. The array will either contain the topmost feature\n   * when a hit was detected, or it will be empty.\n   *\n   * The hit detection algorithm used for this method is optimized for performance, but is less\n   * accurate than the one used in [map.getFeaturesAtPixel()]{@link import(\"../Map.js\").default#getFeaturesAtPixel}.\n   * Text is not considered, and icons are only represented by their bounding box instead of the exact\n   * image.\n   *\n   * @param {import(\"../pixel.js\").Pixel} pixel Pixel.\n   * @return {Promise<Array<import(\"../Feature\").FeatureLike>>} Promise that resolves with an array of features.\n   * @api\n   */\n  getFeatures(pixel) {\n    return super.getFeatures(pixel);\n  }\n\n  /**\n   * @return {number|undefined} Render buffer.\n   */\n  getRenderBuffer() {\n    return this.renderBuffer_;\n  }\n\n  /**\n   * @return {function(import(\"../Feature.js\").default, import(\"../Feature.js\").default): number|null|undefined} Render\n   *     order.\n   */\n  getRenderOrder() {\n    return /** @type {import(\"../render.js\").OrderFunction|null|undefined} */ (\n      this.get(Property.RENDER_ORDER)\n    );\n  }\n\n  /**\n   * Get the style for features.  This returns whatever was passed to the `style`\n   * option at construction or to the `setStyle` method.\n   * @return {import(\"../style/Style.js\").StyleLike|null|undefined} Layer style.\n   * @api\n   */\n  getStyle() {\n    return this.style_;\n  }\n\n  /**\n   * Get the style function.\n   * @return {import(\"../style/Style.js\").StyleFunction|undefined} Layer style function.\n   * @api\n   */\n  getStyleFunction() {\n    return this.styleFunction_;\n  }\n\n  /**\n   * @return {boolean} Whether the rendered layer should be updated while\n   *     animating.\n   */\n  getUpdateWhileAnimating() {\n    return this.updateWhileAnimating_;\n  }\n\n  /**\n   * @return {boolean} Whether the rendered layer should be updated while\n   *     interacting.\n   */\n  getUpdateWhileInteracting() {\n    return this.updateWhileInteracting_;\n  }\n\n  /**\n   * Render declutter items for this layer\n   * @param {import(\"../Map.js\").FrameState} frameState Frame state.\n   */\n  renderDeclutter(frameState) {\n    if (!frameState.declutterTree) {\n      frameState.declutterTree = new RBush(9);\n    }\n    /** @type {*} */ (this.getRenderer()).renderDeclutter(frameState);\n  }\n\n  /**\n   * @param {import(\"../render.js\").OrderFunction|null|undefined} renderOrder\n   *     Render order.\n   */\n  setRenderOrder(renderOrder) {\n    this.set(Property.RENDER_ORDER, renderOrder);\n  }\n\n  /**\n   * Set the style for features.  This can be a single style object, an array\n   * of styles, or a function that takes a feature and resolution and returns\n   * an array of styles. If set to `null`, the layer has no style (a `null` style),\n   * so only features that have their own styles will be rendered in the layer. Call\n   * `setStyle()` without arguments to reset to the default style. See\n   * [the ol/style/Style module]{@link module:ol/style/Style~Style} for information on the default style.\n   *\n   * If your layer has a static style, you can use \"flat\" style object literals instead of\n   * using the `Style` and symbolizer constructors (`Fill`, `Stroke`, etc.).  See the documentation\n   * for the [flat style types]{@link module:ol/style/flat~FlatStyle} to see what properties are supported.\n   *\n   * @param {import(\"../style/Style.js\").StyleLike|import(\"../style/flat.js\").FlatStyleLike|null} [style] Layer style.\n   * @api\n   */\n  setStyle(style) {\n    /**\n     * @type {import(\"../style/Style.js\").StyleLike|null}\n     */\n    let styleLike;\n\n    if (style === undefined) {\n      styleLike = createDefaultStyle;\n    } else if (style === null) {\n      styleLike = null;\n    } else if (typeof style === 'function') {\n      styleLike = style;\n    } else if (style instanceof Style) {\n      styleLike = style;\n    } else if (Array.isArray(style)) {\n      const len = style.length;\n\n      /**\n       * @type {Array<Style>}\n       */\n      const styles = new Array(len);\n\n      for (let i = 0; i < len; ++i) {\n        const s = style[i];\n        if (s instanceof Style) {\n          styles[i] = s;\n        } else {\n          styles[i] = toStyle(s);\n        }\n      }\n      styleLike = styles;\n    } else {\n      styleLike = toStyle(style);\n    }\n\n    this.style_ = styleLike;\n    this.styleFunction_ =\n      style === null ? undefined : toStyleFunction(this.style_);\n    this.changed();\n  }\n}\n\nexport default BaseVectorLayer;\n","/**\n * @module ol/render/canvas/Instruction\n */\n\n/**\n * @enum {number}\n */\nconst Instruction = {\n  BEGIN_GEOMETRY: 0,\n  BEGIN_PATH: 1,\n  CIRCLE: 2,\n  CLOSE_PATH: 3,\n  CUSTOM: 4,\n  DRAW_CHARS: 5,\n  DRAW_IMAGE: 6,\n  END_GEOMETRY: 7,\n  FILL: 8,\n  MOVE_TO_LINE_TO: 9,\n  SET_FILL_STYLE: 10,\n  SET_STROKE_STYLE: 11,\n  STROKE: 12,\n};\n\n/**\n * @type {Array<Instruction>}\n */\nexport const fillInstruction = [Instruction.FILL];\n\n/**\n * @type {Array<Instruction>}\n */\nexport const strokeInstruction = [Instruction.STROKE];\n\n/**\n * @type {Array<Instruction>}\n */\nexport const beginPathInstruction = [Instruction.BEGIN_PATH];\n\n/**\n * @type {Array<Instruction>}\n */\nexport const closePathInstruction = [Instruction.CLOSE_PATH];\n\nexport default Instruction;\n","/**\n * @module ol/render/VectorContext\n */\n\n/**\n * @classdesc\n * Context for drawing geometries.  A vector context is available on render\n * events and does not need to be constructed directly.\n * @api\n */\nclass VectorContext {\n  /**\n   * Render a geometry with a custom renderer.\n   *\n   * @param {import(\"../geom/SimpleGeometry.js\").default} geometry Geometry.\n   * @param {import(\"../Feature.js\").FeatureLike} feature Feature.\n   * @param {Function} renderer Renderer.\n   * @param {Function} hitDetectionRenderer Renderer.\n   */\n  drawCustom(geometry, feature, renderer, hitDetectionRenderer) {}\n\n  /**\n   * Render a geometry.\n   *\n   * @param {import(\"../geom/Geometry.js\").default} geometry The geometry to render.\n   */\n  drawGeometry(geometry) {}\n\n  /**\n   * Set the rendering style.\n   *\n   * @param {import(\"../style/Style.js\").default} style The rendering style.\n   */\n  setStyle(style) {}\n\n  /**\n   * @param {import(\"../geom/Circle.js\").default} circleGeometry Circle geometry.\n   * @param {import(\"../Feature.js\").default} feature Feature.\n   */\n  drawCircle(circleGeometry, feature) {}\n\n  /**\n   * @param {import(\"../Feature.js\").default} feature Feature.\n   * @param {import(\"../style/Style.js\").default} style Style.\n   */\n  drawFeature(feature, style) {}\n\n  /**\n   * @param {import(\"../geom/GeometryCollection.js\").default} geometryCollectionGeometry Geometry collection.\n   * @param {import(\"../Feature.js\").default} feature Feature.\n   */\n  drawGeometryCollection(geometryCollectionGeometry, feature) {}\n\n  /**\n   * @param {import(\"../geom/LineString.js\").default|import(\"./Feature.js\").default} lineStringGeometry Line string geometry.\n   * @param {import(\"../Feature.js\").FeatureLike} feature Feature.\n   */\n  drawLineString(lineStringGeometry, feature) {}\n\n  /**\n   * @param {import(\"../geom/MultiLineString.js\").default|import(\"./Feature.js\").default} multiLineStringGeometry MultiLineString geometry.\n   * @param {import(\"../Feature.js\").FeatureLike} feature Feature.\n   */\n  drawMultiLineString(multiLineStringGeometry, feature) {}\n\n  /**\n   * @param {import(\"../geom/MultiPoint.js\").default|import(\"./Feature.js\").default} multiPointGeometry MultiPoint geometry.\n   * @param {import(\"../Feature.js\").FeatureLike} feature Feature.\n   */\n  drawMultiPoint(multiPointGeometry, feature) {}\n\n  /**\n   * @param {import(\"../geom/MultiPolygon.js\").default} multiPolygonGeometry MultiPolygon geometry.\n   * @param {import(\"../Feature.js\").FeatureLike} feature Feature.\n   */\n  drawMultiPolygon(multiPolygonGeometry, feature) {}\n\n  /**\n   * @param {import(\"../geom/Point.js\").default|import(\"./Feature.js\").default} pointGeometry Point geometry.\n   * @param {import(\"../Feature.js\").FeatureLike} feature Feature.\n   */\n  drawPoint(pointGeometry, feature) {}\n\n  /**\n   * @param {import(\"../geom/Polygon.js\").default|import(\"./Feature.js\").default} polygonGeometry Polygon geometry.\n   * @param {import(\"../Feature.js\").FeatureLike} feature Feature.\n   */\n  drawPolygon(polygonGeometry, feature) {}\n\n  /**\n   * @param {import(\"../geom/SimpleGeometry.js\").default|import(\"./Feature.js\").default} geometry Geometry.\n   * @param {import(\"../Feature.js\").FeatureLike} feature Feature.\n   */\n  drawText(geometry, feature) {}\n\n  /**\n   * @param {import(\"../style/Fill.js\").default} fillStyle Fill style.\n   * @param {import(\"../style/Stroke.js\").default} strokeStyle Stroke style.\n   */\n  setFillStrokeStyle(fillStyle, strokeStyle) {}\n\n  /**\n   * @param {import(\"../style/Image.js\").default} imageStyle Image style.\n   * @param {import(\"../render/canvas.js\").DeclutterImageWithText} [declutterImageWithText] Shared data for combined decluttering with a text style.\n   */\n  setImageStyle(imageStyle, declutterImageWithText) {}\n\n  /**\n   * @param {import(\"../style/Text.js\").default} textStyle Text style.\n   * @param {import(\"../render/canvas.js\").DeclutterImageWithText} [declutterImageWithText] Shared data for combined decluttering with an image style.\n   */\n  setTextStyle(textStyle, declutterImageWithText) {}\n}\n\nexport default VectorContext;\n","/**\n * @module ol/render/canvas/Builder\n */\nimport CanvasInstruction from './Instruction.js';\nimport Relationship from '../../extent/Relationship.js';\nimport VectorContext from '../VectorContext.js';\nimport {asColorLike} from '../../colorlike.js';\nimport {\n  buffer,\n  clone,\n  containsCoordinate,\n  coordinateRelationship,\n} from '../../extent.js';\nimport {\n  defaultFillStyle,\n  defaultLineCap,\n  defaultLineDash,\n  defaultLineDashOffset,\n  defaultLineJoin,\n  defaultLineWidth,\n  defaultMiterLimit,\n  defaultStrokeStyle,\n} from '../canvas.js';\nimport {equals, reverseSubArray} from '../../array.js';\nimport {\n  inflateCoordinates,\n  inflateCoordinatesArray,\n  inflateMultiCoordinatesArray,\n} from '../../geom/flat/inflate.js';\n\nclass CanvasBuilder extends VectorContext {\n  /**\n   * @param {number} tolerance Tolerance.\n   * @param {import(\"../../extent.js\").Extent} maxExtent Maximum extent.\n   * @param {number} resolution Resolution.\n   * @param {number} pixelRatio Pixel ratio.\n   */\n  constructor(tolerance, maxExtent, resolution, pixelRatio) {\n    super();\n\n    /**\n     * @protected\n     * @type {number}\n     */\n    this.tolerance = tolerance;\n\n    /**\n     * @protected\n     * @const\n     * @type {import(\"../../extent.js\").Extent}\n     */\n    this.maxExtent = maxExtent;\n\n    /**\n     * @protected\n     * @type {number}\n     */\n    this.pixelRatio = pixelRatio;\n\n    /**\n     * @protected\n     * @type {number}\n     */\n    this.maxLineWidth = 0;\n\n    /**\n     * @protected\n     * @const\n     * @type {number}\n     */\n    this.resolution = resolution;\n\n    /**\n     * @private\n     * @type {Array<*>}\n     */\n    this.beginGeometryInstruction1_ = null;\n\n    /**\n     * @private\n     * @type {Array<*>}\n     */\n    this.beginGeometryInstruction2_ = null;\n\n    /**\n     * @private\n     * @type {import(\"../../extent.js\").Extent}\n     */\n    this.bufferedMaxExtent_ = null;\n\n    /**\n     * @protected\n     * @type {Array<*>}\n     */\n    this.instructions = [];\n\n    /**\n     * @protected\n     * @type {Array<number>}\n     */\n    this.coordinates = [];\n\n    /**\n     * @private\n     * @type {import(\"../../coordinate.js\").Coordinate}\n     */\n    this.tmpCoordinate_ = [];\n\n    /**\n     * @protected\n     * @type {Array<*>}\n     */\n    this.hitDetectionInstructions = [];\n\n    /**\n     * @protected\n     * @type {import(\"../canvas.js\").FillStrokeState}\n     */\n    this.state = /** @type {import(\"../canvas.js\").FillStrokeState} */ ({});\n  }\n\n  /**\n   * @protected\n   * @param {Array<number>} dashArray Dash array.\n   * @return {Array<number>} Dash array with pixel ratio applied\n   */\n  applyPixelRatio(dashArray) {\n    const pixelRatio = this.pixelRatio;\n    return pixelRatio == 1\n      ? dashArray\n      : dashArray.map(function (dash) {\n          return dash * pixelRatio;\n        });\n  }\n\n  /**\n   * @param {Array<number>} flatCoordinates Flat coordinates.\n   * @param {number} stride Stride.\n   * @protected\n   * @return {number} My end\n   */\n  appendFlatPointCoordinates(flatCoordinates, stride) {\n    const extent = this.getBufferedMaxExtent();\n    const tmpCoord = this.tmpCoordinate_;\n    const coordinates = this.coordinates;\n    let myEnd = coordinates.length;\n    for (let i = 0, ii = flatCoordinates.length; i < ii; i += stride) {\n      tmpCoord[0] = flatCoordinates[i];\n      tmpCoord[1] = flatCoordinates[i + 1];\n      if (containsCoordinate(extent, tmpCoord)) {\n        coordinates[myEnd++] = tmpCoord[0];\n        coordinates[myEnd++] = tmpCoord[1];\n      }\n    }\n    return myEnd;\n  }\n\n  /**\n   * @param {Array<number>} flatCoordinates Flat coordinates.\n   * @param {number} offset Offset.\n   * @param {number} end End.\n   * @param {number} stride Stride.\n   * @param {boolean} closed Last input coordinate equals first.\n   * @param {boolean} skipFirst Skip first coordinate.\n   * @protected\n   * @return {number} My end.\n   */\n  appendFlatLineCoordinates(\n    flatCoordinates,\n    offset,\n    end,\n    stride,\n    closed,\n    skipFirst\n  ) {\n    const coordinates = this.coordinates;\n    let myEnd = coordinates.length;\n    const extent = this.getBufferedMaxExtent();\n    if (skipFirst) {\n      offset += stride;\n    }\n    let lastXCoord = flatCoordinates[offset];\n    let lastYCoord = flatCoordinates[offset + 1];\n    const nextCoord = this.tmpCoordinate_;\n    let skipped = true;\n\n    let i, lastRel, nextRel;\n    for (i = offset + stride; i < end; i += stride) {\n      nextCoord[0] = flatCoordinates[i];\n      nextCoord[1] = flatCoordinates[i + 1];\n      nextRel = coordinateRelationship(extent, nextCoord);\n      if (nextRel !== lastRel) {\n        if (skipped) {\n          coordinates[myEnd++] = lastXCoord;\n          coordinates[myEnd++] = lastYCoord;\n          skipped = false;\n        }\n        coordinates[myEnd++] = nextCoord[0];\n        coordinates[myEnd++] = nextCoord[1];\n      } else if (nextRel === Relationship.INTERSECTING) {\n        coordinates[myEnd++] = nextCoord[0];\n        coordinates[myEnd++] = nextCoord[1];\n        skipped = false;\n      } else {\n        skipped = true;\n      }\n      lastXCoord = nextCoord[0];\n      lastYCoord = nextCoord[1];\n      lastRel = nextRel;\n    }\n\n    // Last coordinate equals first or only one point to append:\n    if ((closed && skipped) || i === offset + stride) {\n      coordinates[myEnd++] = lastXCoord;\n      coordinates[myEnd++] = lastYCoord;\n    }\n    return myEnd;\n  }\n\n  /**\n   * @param {Array<number>} flatCoordinates Flat coordinates.\n   * @param {number} offset Offset.\n   * @param {Array<number>} ends Ends.\n   * @param {number} stride Stride.\n   * @param {Array<number>} builderEnds Builder ends.\n   * @return {number} Offset.\n   */\n  drawCustomCoordinates_(flatCoordinates, offset, ends, stride, builderEnds) {\n    for (let i = 0, ii = ends.length; i < ii; ++i) {\n      const end = ends[i];\n      const builderEnd = this.appendFlatLineCoordinates(\n        flatCoordinates,\n        offset,\n        end,\n        stride,\n        false,\n        false\n      );\n      builderEnds.push(builderEnd);\n      offset = end;\n    }\n    return offset;\n  }\n\n  /**\n   * @param {import(\"../../geom/SimpleGeometry.js\").default} geometry Geometry.\n   * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n   * @param {Function} renderer Renderer.\n   * @param {Function} hitDetectionRenderer Renderer.\n   */\n  drawCustom(geometry, feature, renderer, hitDetectionRenderer) {\n    this.beginGeometry(geometry, feature);\n\n    const type = geometry.getType();\n    const stride = geometry.getStride();\n    const builderBegin = this.coordinates.length;\n\n    let flatCoordinates, builderEnd, builderEnds, builderEndss;\n    let offset;\n\n    switch (type) {\n      case 'MultiPolygon':\n        flatCoordinates =\n          /** @type {import(\"../../geom/MultiPolygon.js\").default} */ (\n            geometry\n          ).getOrientedFlatCoordinates();\n        builderEndss = [];\n        const endss =\n          /** @type {import(\"../../geom/MultiPolygon.js\").default} */ (\n            geometry\n          ).getEndss();\n        offset = 0;\n        for (let i = 0, ii = endss.length; i < ii; ++i) {\n          const myEnds = [];\n          offset = this.drawCustomCoordinates_(\n            flatCoordinates,\n            offset,\n            endss[i],\n            stride,\n            myEnds\n          );\n          builderEndss.push(myEnds);\n        }\n        this.instructions.push([\n          CanvasInstruction.CUSTOM,\n          builderBegin,\n          builderEndss,\n          geometry,\n          renderer,\n          inflateMultiCoordinatesArray,\n        ]);\n        this.hitDetectionInstructions.push([\n          CanvasInstruction.CUSTOM,\n          builderBegin,\n          builderEndss,\n          geometry,\n          hitDetectionRenderer || renderer,\n          inflateMultiCoordinatesArray,\n        ]);\n        break;\n      case 'Polygon':\n      case 'MultiLineString':\n        builderEnds = [];\n        flatCoordinates =\n          type == 'Polygon'\n            ? /** @type {import(\"../../geom/Polygon.js\").default} */ (\n                geometry\n              ).getOrientedFlatCoordinates()\n            : geometry.getFlatCoordinates();\n        offset = this.drawCustomCoordinates_(\n          flatCoordinates,\n          0,\n          /** @type {import(\"../../geom/Polygon.js\").default|import(\"../../geom/MultiLineString.js\").default} */ (\n            geometry\n          ).getEnds(),\n          stride,\n          builderEnds\n        );\n        this.instructions.push([\n          CanvasInstruction.CUSTOM,\n          builderBegin,\n          builderEnds,\n          geometry,\n          renderer,\n          inflateCoordinatesArray,\n        ]);\n        this.hitDetectionInstructions.push([\n          CanvasInstruction.CUSTOM,\n          builderBegin,\n          builderEnds,\n          geometry,\n          hitDetectionRenderer || renderer,\n          inflateCoordinatesArray,\n        ]);\n        break;\n      case 'LineString':\n      case 'Circle':\n        flatCoordinates = geometry.getFlatCoordinates();\n        builderEnd = this.appendFlatLineCoordinates(\n          flatCoordinates,\n          0,\n          flatCoordinates.length,\n          stride,\n          false,\n          false\n        );\n        this.instructions.push([\n          CanvasInstruction.CUSTOM,\n          builderBegin,\n          builderEnd,\n          geometry,\n          renderer,\n          inflateCoordinates,\n        ]);\n        this.hitDetectionInstructions.push([\n          CanvasInstruction.CUSTOM,\n          builderBegin,\n          builderEnd,\n          geometry,\n          hitDetectionRenderer || renderer,\n          inflateCoordinates,\n        ]);\n        break;\n      case 'MultiPoint':\n        flatCoordinates = geometry.getFlatCoordinates();\n        builderEnd = this.appendFlatPointCoordinates(flatCoordinates, stride);\n\n        if (builderEnd > builderBegin) {\n          this.instructions.push([\n            CanvasInstruction.CUSTOM,\n            builderBegin,\n            builderEnd,\n            geometry,\n            renderer,\n            inflateCoordinates,\n          ]);\n          this.hitDetectionInstructions.push([\n            CanvasInstruction.CUSTOM,\n            builderBegin,\n            builderEnd,\n            geometry,\n            hitDetectionRenderer || renderer,\n            inflateCoordinates,\n          ]);\n        }\n        break;\n      case 'Point':\n        flatCoordinates = geometry.getFlatCoordinates();\n        this.coordinates.push(flatCoordinates[0], flatCoordinates[1]);\n        builderEnd = this.coordinates.length;\n\n        this.instructions.push([\n          CanvasInstruction.CUSTOM,\n          builderBegin,\n          builderEnd,\n          geometry,\n          renderer,\n        ]);\n        this.hitDetectionInstructions.push([\n          CanvasInstruction.CUSTOM,\n          builderBegin,\n          builderEnd,\n          geometry,\n          hitDetectionRenderer || renderer,\n        ]);\n        break;\n      default:\n    }\n    this.endGeometry(feature);\n  }\n\n  /**\n   * @protected\n   * @param {import(\"../../geom/Geometry\").default|import(\"../Feature.js\").default} geometry The geometry.\n   * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n   */\n  beginGeometry(geometry, feature) {\n    this.beginGeometryInstruction1_ = [\n      CanvasInstruction.BEGIN_GEOMETRY,\n      feature,\n      0,\n      geometry,\n    ];\n    this.instructions.push(this.beginGeometryInstruction1_);\n    this.beginGeometryInstruction2_ = [\n      CanvasInstruction.BEGIN_GEOMETRY,\n      feature,\n      0,\n      geometry,\n    ];\n    this.hitDetectionInstructions.push(this.beginGeometryInstruction2_);\n  }\n\n  /**\n   * @return {import(\"../canvas.js\").SerializableInstructions} the serializable instructions.\n   */\n  finish() {\n    return {\n      instructions: this.instructions,\n      hitDetectionInstructions: this.hitDetectionInstructions,\n      coordinates: this.coordinates,\n    };\n  }\n\n  /**\n   * Reverse the hit detection instructions.\n   */\n  reverseHitDetectionInstructions() {\n    const hitDetectionInstructions = this.hitDetectionInstructions;\n    // step 1 - reverse array\n    hitDetectionInstructions.reverse();\n    // step 2 - reverse instructions within geometry blocks\n    let i;\n    const n = hitDetectionInstructions.length;\n    let instruction;\n    let type;\n    let begin = -1;\n    for (i = 0; i < n; ++i) {\n      instruction = hitDetectionInstructions[i];\n      type = /** @type {import(\"./Instruction.js\").default} */ (instruction[0]);\n      if (type == CanvasInstruction.END_GEOMETRY) {\n        begin = i;\n      } else if (type == CanvasInstruction.BEGIN_GEOMETRY) {\n        instruction[2] = i;\n        reverseSubArray(this.hitDetectionInstructions, begin, i);\n        begin = -1;\n      }\n    }\n  }\n\n  /**\n   * @param {import(\"../../style/Fill.js\").default} fillStyle Fill style.\n   * @param {import(\"../../style/Stroke.js\").default} strokeStyle Stroke style.\n   */\n  setFillStrokeStyle(fillStyle, strokeStyle) {\n    const state = this.state;\n    if (fillStyle) {\n      const fillStyleColor = fillStyle.getColor();\n      state.fillStyle = asColorLike(\n        fillStyleColor ? fillStyleColor : defaultFillStyle\n      );\n    } else {\n      state.fillStyle = undefined;\n    }\n    if (strokeStyle) {\n      const strokeStyleColor = strokeStyle.getColor();\n      state.strokeStyle = asColorLike(\n        strokeStyleColor ? strokeStyleColor : defaultStrokeStyle\n      );\n      const strokeStyleLineCap = strokeStyle.getLineCap();\n      state.lineCap =\n        strokeStyleLineCap !== undefined ? strokeStyleLineCap : defaultLineCap;\n      const strokeStyleLineDash = strokeStyle.getLineDash();\n      state.lineDash = strokeStyleLineDash\n        ? strokeStyleLineDash.slice()\n        : defaultLineDash;\n      const strokeStyleLineDashOffset = strokeStyle.getLineDashOffset();\n      state.lineDashOffset = strokeStyleLineDashOffset\n        ? strokeStyleLineDashOffset\n        : defaultLineDashOffset;\n      const strokeStyleLineJoin = strokeStyle.getLineJoin();\n      state.lineJoin =\n        strokeStyleLineJoin !== undefined\n          ? strokeStyleLineJoin\n          : defaultLineJoin;\n      const strokeStyleWidth = strokeStyle.getWidth();\n      state.lineWidth =\n        strokeStyleWidth !== undefined ? strokeStyleWidth : defaultLineWidth;\n      const strokeStyleMiterLimit = strokeStyle.getMiterLimit();\n      state.miterLimit =\n        strokeStyleMiterLimit !== undefined\n          ? strokeStyleMiterLimit\n          : defaultMiterLimit;\n\n      if (state.lineWidth > this.maxLineWidth) {\n        this.maxLineWidth = state.lineWidth;\n        // invalidate the buffered max extent cache\n        this.bufferedMaxExtent_ = null;\n      }\n    } else {\n      state.strokeStyle = undefined;\n      state.lineCap = undefined;\n      state.lineDash = null;\n      state.lineDashOffset = undefined;\n      state.lineJoin = undefined;\n      state.lineWidth = undefined;\n      state.miterLimit = undefined;\n    }\n  }\n\n  /**\n   * @param {import(\"../canvas.js\").FillStrokeState} state State.\n   * @return {Array<*>} Fill instruction.\n   */\n  createFill(state) {\n    const fillStyle = state.fillStyle;\n    /** @type {Array<*>} */\n    const fillInstruction = [CanvasInstruction.SET_FILL_STYLE, fillStyle];\n    if (typeof fillStyle !== 'string') {\n      // Fill is a pattern or gradient - align it!\n      fillInstruction.push(true);\n    }\n    return fillInstruction;\n  }\n\n  /**\n   * @param {import(\"../canvas.js\").FillStrokeState} state State.\n   */\n  applyStroke(state) {\n    this.instructions.push(this.createStroke(state));\n  }\n\n  /**\n   * @param {import(\"../canvas.js\").FillStrokeState} state State.\n   * @return {Array<*>} Stroke instruction.\n   */\n  createStroke(state) {\n    return [\n      CanvasInstruction.SET_STROKE_STYLE,\n      state.strokeStyle,\n      state.lineWidth * this.pixelRatio,\n      state.lineCap,\n      state.lineJoin,\n      state.miterLimit,\n      this.applyPixelRatio(state.lineDash),\n      state.lineDashOffset * this.pixelRatio,\n    ];\n  }\n\n  /**\n   * @param {import(\"../canvas.js\").FillStrokeState} state State.\n   * @param {function(this:CanvasBuilder, import(\"../canvas.js\").FillStrokeState):Array<*>} createFill Create fill.\n   */\n  updateFillStyle(state, createFill) {\n    const fillStyle = state.fillStyle;\n    if (typeof fillStyle !== 'string' || state.currentFillStyle != fillStyle) {\n      if (fillStyle !== undefined) {\n        this.instructions.push(createFill.call(this, state));\n      }\n      state.currentFillStyle = fillStyle;\n    }\n  }\n\n  /**\n   * @param {import(\"../canvas.js\").FillStrokeState} state State.\n   * @param {function(this:CanvasBuilder, import(\"../canvas.js\").FillStrokeState): void} applyStroke Apply stroke.\n   */\n  updateStrokeStyle(state, applyStroke) {\n    const strokeStyle = state.strokeStyle;\n    const lineCap = state.lineCap;\n    const lineDash = state.lineDash;\n    const lineDashOffset = state.lineDashOffset;\n    const lineJoin = state.lineJoin;\n    const lineWidth = state.lineWidth;\n    const miterLimit = state.miterLimit;\n    if (\n      state.currentStrokeStyle != strokeStyle ||\n      state.currentLineCap != lineCap ||\n      (lineDash != state.currentLineDash &&\n        !equals(state.currentLineDash, lineDash)) ||\n      state.currentLineDashOffset != lineDashOffset ||\n      state.currentLineJoin != lineJoin ||\n      state.currentLineWidth != lineWidth ||\n      state.currentMiterLimit != miterLimit\n    ) {\n      if (strokeStyle !== undefined) {\n        applyStroke.call(this, state);\n      }\n      state.currentStrokeStyle = strokeStyle;\n      state.currentLineCap = lineCap;\n      state.currentLineDash = lineDash;\n      state.currentLineDashOffset = lineDashOffset;\n      state.currentLineJoin = lineJoin;\n      state.currentLineWidth = lineWidth;\n      state.currentMiterLimit = miterLimit;\n    }\n  }\n\n  /**\n   * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n   */\n  endGeometry(feature) {\n    this.beginGeometryInstruction1_[2] = this.instructions.length;\n    this.beginGeometryInstruction1_ = null;\n    this.beginGeometryInstruction2_[2] = this.hitDetectionInstructions.length;\n    this.beginGeometryInstruction2_ = null;\n    const endGeometryInstruction = [CanvasInstruction.END_GEOMETRY, feature];\n    this.instructions.push(endGeometryInstruction);\n    this.hitDetectionInstructions.push(endGeometryInstruction);\n  }\n\n  /**\n   * Get the buffered rendering extent.  Rendering will be clipped to the extent\n   * provided to the constructor.  To account for symbolizers that may intersect\n   * this extent, we calculate a buffered extent (e.g. based on stroke width).\n   * @return {import(\"../../extent.js\").Extent} The buffered rendering extent.\n   * @protected\n   */\n  getBufferedMaxExtent() {\n    if (!this.bufferedMaxExtent_) {\n      this.bufferedMaxExtent_ = clone(this.maxExtent);\n      if (this.maxLineWidth > 0) {\n        const width = (this.resolution * (this.maxLineWidth + 1)) / 2;\n        buffer(this.bufferedMaxExtent_, width, this.bufferedMaxExtent_);\n      }\n    }\n    return this.bufferedMaxExtent_;\n  }\n}\n\nexport default CanvasBuilder;\n","/**\n * @module ol/render/canvas/ImageBuilder\n */\nimport CanvasBuilder from './Builder.js';\nimport CanvasInstruction from './Instruction.js';\n\nclass CanvasImageBuilder extends CanvasBuilder {\n  /**\n   * @param {number} tolerance Tolerance.\n   * @param {import(\"../../extent.js\").Extent} maxExtent Maximum extent.\n   * @param {number} resolution Resolution.\n   * @param {number} pixelRatio Pixel ratio.\n   */\n  constructor(tolerance, maxExtent, resolution, pixelRatio) {\n    super(tolerance, maxExtent, resolution, pixelRatio);\n\n    /**\n     * @private\n     * @type {HTMLCanvasElement|HTMLVideoElement|HTMLImageElement}\n     */\n    this.hitDetectionImage_ = null;\n\n    /**\n     * @private\n     * @type {HTMLCanvasElement|HTMLVideoElement|HTMLImageElement}\n     */\n    this.image_ = null;\n\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n    this.imagePixelRatio_ = undefined;\n\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n    this.anchorX_ = undefined;\n\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n    this.anchorY_ = undefined;\n\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n    this.height_ = undefined;\n\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n    this.opacity_ = undefined;\n\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n    this.originX_ = undefined;\n\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n    this.originY_ = undefined;\n\n    /**\n     * @private\n     * @type {boolean|undefined}\n     */\n    this.rotateWithView_ = undefined;\n\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n    this.rotation_ = undefined;\n\n    /**\n     * @private\n     * @type {import(\"../../size.js\").Size|undefined}\n     */\n    this.scale_ = undefined;\n\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n    this.width_ = undefined;\n\n    /**\n     * @private\n     * @type {\"declutter\"|\"obstacle\"|\"none\"|undefined}\n     */\n    this.declutterMode_ = undefined;\n\n    /**\n     * Data shared with a text builder for combined decluttering.\n     * @private\n     * @type {import(\"../canvas.js\").DeclutterImageWithText}\n     */\n    this.declutterImageWithText_ = undefined;\n  }\n\n  /**\n   * @param {import(\"../../geom/Point.js\").default|import(\"../Feature.js\").default} pointGeometry Point geometry.\n   * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n   */\n  drawPoint(pointGeometry, feature) {\n    if (!this.image_) {\n      return;\n    }\n    this.beginGeometry(pointGeometry, feature);\n    const flatCoordinates = pointGeometry.getFlatCoordinates();\n    const stride = pointGeometry.getStride();\n    const myBegin = this.coordinates.length;\n    const myEnd = this.appendFlatPointCoordinates(flatCoordinates, stride);\n    this.instructions.push([\n      CanvasInstruction.DRAW_IMAGE,\n      myBegin,\n      myEnd,\n      this.image_,\n      // Remaining arguments to DRAW_IMAGE are in alphabetical order\n      this.anchorX_ * this.imagePixelRatio_,\n      this.anchorY_ * this.imagePixelRatio_,\n      Math.ceil(this.height_ * this.imagePixelRatio_),\n      this.opacity_,\n      this.originX_ * this.imagePixelRatio_,\n      this.originY_ * this.imagePixelRatio_,\n      this.rotateWithView_,\n      this.rotation_,\n      [\n        (this.scale_[0] * this.pixelRatio) / this.imagePixelRatio_,\n        (this.scale_[1] * this.pixelRatio) / this.imagePixelRatio_,\n      ],\n      Math.ceil(this.width_ * this.imagePixelRatio_),\n      this.declutterMode_,\n      this.declutterImageWithText_,\n    ]);\n    this.hitDetectionInstructions.push([\n      CanvasInstruction.DRAW_IMAGE,\n      myBegin,\n      myEnd,\n      this.hitDetectionImage_,\n      // Remaining arguments to DRAW_IMAGE are in alphabetical order\n      this.anchorX_,\n      this.anchorY_,\n      this.height_,\n      this.opacity_,\n      this.originX_,\n      this.originY_,\n      this.rotateWithView_,\n      this.rotation_,\n      this.scale_,\n      this.width_,\n      this.declutterMode_,\n      this.declutterImageWithText_,\n    ]);\n    this.endGeometry(feature);\n  }\n\n  /**\n   * @param {import(\"../../geom/MultiPoint.js\").default|import(\"../Feature.js\").default} multiPointGeometry MultiPoint geometry.\n   * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n   */\n  drawMultiPoint(multiPointGeometry, feature) {\n    if (!this.image_) {\n      return;\n    }\n    this.beginGeometry(multiPointGeometry, feature);\n    const flatCoordinates = multiPointGeometry.getFlatCoordinates();\n    const stride = multiPointGeometry.getStride();\n    const myBegin = this.coordinates.length;\n    const myEnd = this.appendFlatPointCoordinates(flatCoordinates, stride);\n    this.instructions.push([\n      CanvasInstruction.DRAW_IMAGE,\n      myBegin,\n      myEnd,\n      this.image_,\n      // Remaining arguments to DRAW_IMAGE are in alphabetical order\n      this.anchorX_ * this.imagePixelRatio_,\n      this.anchorY_ * this.imagePixelRatio_,\n      Math.ceil(this.height_ * this.imagePixelRatio_),\n      this.opacity_,\n      this.originX_ * this.imagePixelRatio_,\n      this.originY_ * this.imagePixelRatio_,\n      this.rotateWithView_,\n      this.rotation_,\n      [\n        (this.scale_[0] * this.pixelRatio) / this.imagePixelRatio_,\n        (this.scale_[1] * this.pixelRatio) / this.imagePixelRatio_,\n      ],\n      Math.ceil(this.width_ * this.imagePixelRatio_),\n      this.declutterMode_,\n      this.declutterImageWithText_,\n    ]);\n    this.hitDetectionInstructions.push([\n      CanvasInstruction.DRAW_IMAGE,\n      myBegin,\n      myEnd,\n      this.hitDetectionImage_,\n      // Remaining arguments to DRAW_IMAGE are in alphabetical order\n      this.anchorX_,\n      this.anchorY_,\n      this.height_,\n      this.opacity_,\n      this.originX_,\n      this.originY_,\n      this.rotateWithView_,\n      this.rotation_,\n      this.scale_,\n      this.width_,\n      this.declutterMode_,\n      this.declutterImageWithText_,\n    ]);\n    this.endGeometry(feature);\n  }\n\n  /**\n   * @return {import(\"../canvas.js\").SerializableInstructions} the serializable instructions.\n   */\n  finish() {\n    this.reverseHitDetectionInstructions();\n    // FIXME this doesn't really protect us against further calls to draw*Geometry\n    this.anchorX_ = undefined;\n    this.anchorY_ = undefined;\n    this.hitDetectionImage_ = null;\n    this.image_ = null;\n    this.imagePixelRatio_ = undefined;\n    this.height_ = undefined;\n    this.scale_ = undefined;\n    this.opacity_ = undefined;\n    this.originX_ = undefined;\n    this.originY_ = undefined;\n    this.rotateWithView_ = undefined;\n    this.rotation_ = undefined;\n    this.width_ = undefined;\n    return super.finish();\n  }\n\n  /**\n   * @param {import(\"../../style/Image.js\").default} imageStyle Image style.\n   * @param {Object} [sharedData] Shared data.\n   */\n  setImageStyle(imageStyle, sharedData) {\n    const anchor = imageStyle.getAnchor();\n    const size = imageStyle.getSize();\n    const origin = imageStyle.getOrigin();\n    this.imagePixelRatio_ = imageStyle.getPixelRatio(this.pixelRatio);\n    this.anchorX_ = anchor[0];\n    this.anchorY_ = anchor[1];\n    this.hitDetectionImage_ = imageStyle.getHitDetectionImage();\n    this.image_ = imageStyle.getImage(this.pixelRatio);\n    this.height_ = size[1];\n    this.opacity_ = imageStyle.getOpacity();\n    this.originX_ = origin[0];\n    this.originY_ = origin[1];\n    this.rotateWithView_ = imageStyle.getRotateWithView();\n    this.rotation_ = imageStyle.getRotation();\n    this.scale_ = imageStyle.getScaleArray();\n    this.width_ = size[0];\n    this.declutterMode_ = imageStyle.getDeclutterMode();\n    this.declutterImageWithText_ = sharedData;\n  }\n}\n\nexport default CanvasImageBuilder;\n","/**\n * @module ol/render/canvas/LineStringBuilder\n */\nimport CanvasBuilder from './Builder.js';\nimport CanvasInstruction, {\n  beginPathInstruction,\n  strokeInstruction,\n} from './Instruction.js';\nimport {defaultLineDash, defaultLineDashOffset} from '../canvas.js';\n\nclass CanvasLineStringBuilder extends CanvasBuilder {\n  /**\n   * @param {number} tolerance Tolerance.\n   * @param {import(\"../../extent.js\").Extent} maxExtent Maximum extent.\n   * @param {number} resolution Resolution.\n   * @param {number} pixelRatio Pixel ratio.\n   */\n  constructor(tolerance, maxExtent, resolution, pixelRatio) {\n    super(tolerance, maxExtent, resolution, pixelRatio);\n  }\n\n  /**\n   * @param {Array<number>} flatCoordinates Flat coordinates.\n   * @param {number} offset Offset.\n   * @param {number} end End.\n   * @param {number} stride Stride.\n   * @private\n   * @return {number} end.\n   */\n  drawFlatCoordinates_(flatCoordinates, offset, end, stride) {\n    const myBegin = this.coordinates.length;\n    const myEnd = this.appendFlatLineCoordinates(\n      flatCoordinates,\n      offset,\n      end,\n      stride,\n      false,\n      false\n    );\n    const moveToLineToInstruction = [\n      CanvasInstruction.MOVE_TO_LINE_TO,\n      myBegin,\n      myEnd,\n    ];\n    this.instructions.push(moveToLineToInstruction);\n    this.hitDetectionInstructions.push(moveToLineToInstruction);\n    return end;\n  }\n\n  /**\n   * @param {import(\"../../geom/LineString.js\").default|import(\"../Feature.js\").default} lineStringGeometry Line string geometry.\n   * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n   */\n  drawLineString(lineStringGeometry, feature) {\n    const state = this.state;\n    const strokeStyle = state.strokeStyle;\n    const lineWidth = state.lineWidth;\n    if (strokeStyle === undefined || lineWidth === undefined) {\n      return;\n    }\n    this.updateStrokeStyle(state, this.applyStroke);\n    this.beginGeometry(lineStringGeometry, feature);\n    this.hitDetectionInstructions.push(\n      [\n        CanvasInstruction.SET_STROKE_STYLE,\n        state.strokeStyle,\n        state.lineWidth,\n        state.lineCap,\n        state.lineJoin,\n        state.miterLimit,\n        defaultLineDash,\n        defaultLineDashOffset,\n      ],\n      beginPathInstruction\n    );\n    const flatCoordinates = lineStringGeometry.getFlatCoordinates();\n    const stride = lineStringGeometry.getStride();\n    this.drawFlatCoordinates_(\n      flatCoordinates,\n      0,\n      flatCoordinates.length,\n      stride\n    );\n    this.hitDetectionInstructions.push(strokeInstruction);\n    this.endGeometry(feature);\n  }\n\n  /**\n   * @param {import(\"../../geom/MultiLineString.js\").default|import(\"../Feature.js\").default} multiLineStringGeometry MultiLineString geometry.\n   * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n   */\n  drawMultiLineString(multiLineStringGeometry, feature) {\n    const state = this.state;\n    const strokeStyle = state.strokeStyle;\n    const lineWidth = state.lineWidth;\n    if (strokeStyle === undefined || lineWidth === undefined) {\n      return;\n    }\n    this.updateStrokeStyle(state, this.applyStroke);\n    this.beginGeometry(multiLineStringGeometry, feature);\n    this.hitDetectionInstructions.push(\n      [\n        CanvasInstruction.SET_STROKE_STYLE,\n        state.strokeStyle,\n        state.lineWidth,\n        state.lineCap,\n        state.lineJoin,\n        state.miterLimit,\n        state.lineDash,\n        state.lineDashOffset,\n      ],\n      beginPathInstruction\n    );\n    const ends = multiLineStringGeometry.getEnds();\n    const flatCoordinates = multiLineStringGeometry.getFlatCoordinates();\n    const stride = multiLineStringGeometry.getStride();\n    let offset = 0;\n    for (let i = 0, ii = ends.length; i < ii; ++i) {\n      offset = this.drawFlatCoordinates_(\n        flatCoordinates,\n        offset,\n        /** @type {number} */ (ends[i]),\n        stride\n      );\n    }\n    this.hitDetectionInstructions.push(strokeInstruction);\n    this.endGeometry(feature);\n  }\n\n  /**\n   * @return {import(\"../canvas.js\").SerializableInstructions} the serializable instructions.\n   */\n  finish() {\n    const state = this.state;\n    if (\n      state.lastStroke != undefined &&\n      state.lastStroke != this.coordinates.length\n    ) {\n      this.instructions.push(strokeInstruction);\n    }\n    this.reverseHitDetectionInstructions();\n    this.state = null;\n    return super.finish();\n  }\n\n  /**\n   * @param {import(\"../canvas.js\").FillStrokeState} state State.\n   */\n  applyStroke(state) {\n    if (\n      state.lastStroke != undefined &&\n      state.lastStroke != this.coordinates.length\n    ) {\n      this.instructions.push(strokeInstruction);\n      state.lastStroke = this.coordinates.length;\n    }\n    state.lastStroke = 0;\n    super.applyStroke(state);\n    this.instructions.push(beginPathInstruction);\n  }\n}\n\nexport default CanvasLineStringBuilder;\n","/**\n * @module ol/render/canvas/PolygonBuilder\n */\nimport CanvasBuilder from './Builder.js';\nimport CanvasInstruction, {\n  beginPathInstruction,\n  closePathInstruction,\n  fillInstruction,\n  strokeInstruction,\n} from './Instruction.js';\nimport {defaultFillStyle} from '../canvas.js';\nimport {snap} from '../../geom/flat/simplify.js';\n\nclass CanvasPolygonBuilder extends CanvasBuilder {\n  /**\n   * @param {number} tolerance Tolerance.\n   * @param {import(\"../../extent.js\").Extent} maxExtent Maximum extent.\n   * @param {number} resolution Resolution.\n   * @param {number} pixelRatio Pixel ratio.\n   */\n  constructor(tolerance, maxExtent, resolution, pixelRatio) {\n    super(tolerance, maxExtent, resolution, pixelRatio);\n  }\n\n  /**\n   * @param {Array<number>} flatCoordinates Flat coordinates.\n   * @param {number} offset Offset.\n   * @param {Array<number>} ends Ends.\n   * @param {number} stride Stride.\n   * @private\n   * @return {number} End.\n   */\n  drawFlatCoordinatess_(flatCoordinates, offset, ends, stride) {\n    const state = this.state;\n    const fill = state.fillStyle !== undefined;\n    const stroke = state.strokeStyle !== undefined;\n    const numEnds = ends.length;\n    this.instructions.push(beginPathInstruction);\n    this.hitDetectionInstructions.push(beginPathInstruction);\n    for (let i = 0; i < numEnds; ++i) {\n      const end = ends[i];\n      const myBegin = this.coordinates.length;\n      const myEnd = this.appendFlatLineCoordinates(\n        flatCoordinates,\n        offset,\n        end,\n        stride,\n        true,\n        !stroke\n      );\n      const moveToLineToInstruction = [\n        CanvasInstruction.MOVE_TO_LINE_TO,\n        myBegin,\n        myEnd,\n      ];\n      this.instructions.push(moveToLineToInstruction);\n      this.hitDetectionInstructions.push(moveToLineToInstruction);\n      if (stroke) {\n        // Performance optimization: only call closePath() when we have a stroke.\n        // Otherwise the ring is closed already (see appendFlatLineCoordinates above).\n        this.instructions.push(closePathInstruction);\n        this.hitDetectionInstructions.push(closePathInstruction);\n      }\n      offset = end;\n    }\n    if (fill) {\n      this.instructions.push(fillInstruction);\n      this.hitDetectionInstructions.push(fillInstruction);\n    }\n    if (stroke) {\n      this.instructions.push(strokeInstruction);\n      this.hitDetectionInstructions.push(strokeInstruction);\n    }\n    return offset;\n  }\n\n  /**\n   * @param {import(\"../../geom/Circle.js\").default} circleGeometry Circle geometry.\n   * @param {import(\"../../Feature.js\").default} feature Feature.\n   */\n  drawCircle(circleGeometry, feature) {\n    const state = this.state;\n    const fillStyle = state.fillStyle;\n    const strokeStyle = state.strokeStyle;\n    if (fillStyle === undefined && strokeStyle === undefined) {\n      return;\n    }\n    this.setFillStrokeStyles_();\n    this.beginGeometry(circleGeometry, feature);\n    if (state.fillStyle !== undefined) {\n      this.hitDetectionInstructions.push([\n        CanvasInstruction.SET_FILL_STYLE,\n        defaultFillStyle,\n      ]);\n    }\n    if (state.strokeStyle !== undefined) {\n      this.hitDetectionInstructions.push([\n        CanvasInstruction.SET_STROKE_STYLE,\n        state.strokeStyle,\n        state.lineWidth,\n        state.lineCap,\n        state.lineJoin,\n        state.miterLimit,\n        state.lineDash,\n        state.lineDashOffset,\n      ]);\n    }\n    const flatCoordinates = circleGeometry.getFlatCoordinates();\n    const stride = circleGeometry.getStride();\n    const myBegin = this.coordinates.length;\n    this.appendFlatLineCoordinates(\n      flatCoordinates,\n      0,\n      flatCoordinates.length,\n      stride,\n      false,\n      false\n    );\n    const circleInstruction = [CanvasInstruction.CIRCLE, myBegin];\n    this.instructions.push(beginPathInstruction, circleInstruction);\n    this.hitDetectionInstructions.push(beginPathInstruction, circleInstruction);\n    if (state.fillStyle !== undefined) {\n      this.instructions.push(fillInstruction);\n      this.hitDetectionInstructions.push(fillInstruction);\n    }\n    if (state.strokeStyle !== undefined) {\n      this.instructions.push(strokeInstruction);\n      this.hitDetectionInstructions.push(strokeInstruction);\n    }\n    this.endGeometry(feature);\n  }\n\n  /**\n   * @param {import(\"../../geom/Polygon.js\").default|import(\"../Feature.js\").default} polygonGeometry Polygon geometry.\n   * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n   */\n  drawPolygon(polygonGeometry, feature) {\n    const state = this.state;\n    const fillStyle = state.fillStyle;\n    const strokeStyle = state.strokeStyle;\n    if (fillStyle === undefined && strokeStyle === undefined) {\n      return;\n    }\n    this.setFillStrokeStyles_();\n    this.beginGeometry(polygonGeometry, feature);\n    if (state.fillStyle !== undefined) {\n      this.hitDetectionInstructions.push([\n        CanvasInstruction.SET_FILL_STYLE,\n        defaultFillStyle,\n      ]);\n    }\n    if (state.strokeStyle !== undefined) {\n      this.hitDetectionInstructions.push([\n        CanvasInstruction.SET_STROKE_STYLE,\n        state.strokeStyle,\n        state.lineWidth,\n        state.lineCap,\n        state.lineJoin,\n        state.miterLimit,\n        state.lineDash,\n        state.lineDashOffset,\n      ]);\n    }\n    const ends = polygonGeometry.getEnds();\n    const flatCoordinates = polygonGeometry.getOrientedFlatCoordinates();\n    const stride = polygonGeometry.getStride();\n    this.drawFlatCoordinatess_(\n      flatCoordinates,\n      0,\n      /** @type {Array<number>} */ (ends),\n      stride\n    );\n    this.endGeometry(feature);\n  }\n\n  /**\n   * @param {import(\"../../geom/MultiPolygon.js\").default} multiPolygonGeometry MultiPolygon geometry.\n   * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n   */\n  drawMultiPolygon(multiPolygonGeometry, feature) {\n    const state = this.state;\n    const fillStyle = state.fillStyle;\n    const strokeStyle = state.strokeStyle;\n    if (fillStyle === undefined && strokeStyle === undefined) {\n      return;\n    }\n    this.setFillStrokeStyles_();\n    this.beginGeometry(multiPolygonGeometry, feature);\n    if (state.fillStyle !== undefined) {\n      this.hitDetectionInstructions.push([\n        CanvasInstruction.SET_FILL_STYLE,\n        defaultFillStyle,\n      ]);\n    }\n    if (state.strokeStyle !== undefined) {\n      this.hitDetectionInstructions.push([\n        CanvasInstruction.SET_STROKE_STYLE,\n        state.strokeStyle,\n        state.lineWidth,\n        state.lineCap,\n        state.lineJoin,\n        state.miterLimit,\n        state.lineDash,\n        state.lineDashOffset,\n      ]);\n    }\n    const endss = multiPolygonGeometry.getEndss();\n    const flatCoordinates = multiPolygonGeometry.getOrientedFlatCoordinates();\n    const stride = multiPolygonGeometry.getStride();\n    let offset = 0;\n    for (let i = 0, ii = endss.length; i < ii; ++i) {\n      offset = this.drawFlatCoordinatess_(\n        flatCoordinates,\n        offset,\n        endss[i],\n        stride\n      );\n    }\n    this.endGeometry(feature);\n  }\n\n  /**\n   * @return {import(\"../canvas.js\").SerializableInstructions} the serializable instructions.\n   */\n  finish() {\n    this.reverseHitDetectionInstructions();\n    this.state = null;\n    // We want to preserve topology when drawing polygons.  Polygons are\n    // simplified using quantization and point elimination. However, we might\n    // have received a mix of quantized and non-quantized geometries, so ensure\n    // that all are quantized by quantizing all coordinates in the batch.\n    const tolerance = this.tolerance;\n    if (tolerance !== 0) {\n      const coordinates = this.coordinates;\n      for (let i = 0, ii = coordinates.length; i < ii; ++i) {\n        coordinates[i] = snap(coordinates[i], tolerance);\n      }\n    }\n    return super.finish();\n  }\n\n  /**\n   * @private\n   */\n  setFillStrokeStyles_() {\n    const state = this.state;\n    const fillStyle = state.fillStyle;\n    if (fillStyle !== undefined) {\n      this.updateFillStyle(state, this.createFill);\n    }\n    if (state.strokeStyle !== undefined) {\n      this.updateStrokeStyle(state, this.applyStroke);\n    }\n  }\n}\n\nexport default CanvasPolygonBuilder;\n","/**\n * @module ol/geom/flat/straightchunk\n */\n\n/**\n * @param {number} maxAngle Maximum acceptable angle delta between segments.\n * @param {Array<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @return {Array<number>} Start and end of the first suitable chunk of the\n * given `flatCoordinates`.\n */\nexport function matchingChunk(maxAngle, flatCoordinates, offset, end, stride) {\n  let chunkStart = offset;\n  let chunkEnd = offset;\n  let chunkM = 0;\n  let m = 0;\n  let start = offset;\n  let acos, i, m12, m23, x1, y1, x12, y12, x23, y23;\n  for (i = offset; i < end; i += stride) {\n    const x2 = flatCoordinates[i];\n    const y2 = flatCoordinates[i + 1];\n    if (x1 !== undefined) {\n      x23 = x2 - x1;\n      y23 = y2 - y1;\n      m23 = Math.sqrt(x23 * x23 + y23 * y23);\n      if (x12 !== undefined) {\n        m += m12;\n        acos = Math.acos((x12 * x23 + y12 * y23) / (m12 * m23));\n        if (acos > maxAngle) {\n          if (m > chunkM) {\n            chunkM = m;\n            chunkStart = start;\n            chunkEnd = i;\n          }\n          m = 0;\n          start = i - stride;\n        }\n      }\n      m12 = m23;\n      x12 = x23;\n      y12 = y23;\n    }\n    x1 = x2;\n    y1 = y2;\n  }\n  m += m23;\n  return m > chunkM ? [start, i] : [chunkStart, chunkEnd];\n}\n","/**\n * @module ol/render/canvas/TextBuilder\n */\nimport CanvasBuilder from './Builder.js';\nimport CanvasInstruction from './Instruction.js';\nimport {asColorLike} from '../../colorlike.js';\nimport {\n  defaultFillStyle,\n  defaultFont,\n  defaultLineCap,\n  defaultLineDash,\n  defaultLineDashOffset,\n  defaultLineJoin,\n  defaultLineWidth,\n  defaultMiterLimit,\n  defaultPadding,\n  defaultStrokeStyle,\n  defaultTextAlign,\n  defaultTextBaseline,\n  registerFont,\n} from '../canvas.js';\nimport {getUid} from '../../util.js';\nimport {intersects} from '../../extent.js';\nimport {matchingChunk} from '../../geom/flat/straightchunk.js';\n/**\n * @const\n * @enum {number}\n */\nexport const TEXT_ALIGN = {\n  'left': 0,\n  'end': 0,\n  'center': 0.5,\n  'right': 1,\n  'start': 1,\n  'top': 0,\n  'middle': 0.5,\n  'hanging': 0.2,\n  'alphabetic': 0.8,\n  'ideographic': 0.8,\n  'bottom': 1,\n};\n\nclass CanvasTextBuilder extends CanvasBuilder {\n  /**\n   * @param {number} tolerance Tolerance.\n   * @param {import(\"../../extent.js\").Extent} maxExtent Maximum extent.\n   * @param {number} resolution Resolution.\n   * @param {number} pixelRatio Pixel ratio.\n   */\n  constructor(tolerance, maxExtent, resolution, pixelRatio) {\n    super(tolerance, maxExtent, resolution, pixelRatio);\n\n    /**\n     * @private\n     * @type {Array<HTMLCanvasElement>}\n     */\n    this.labels_ = null;\n\n    /**\n     * @private\n     * @type {string|Array<string>}\n     */\n    this.text_ = '';\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.textOffsetX_ = 0;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.textOffsetY_ = 0;\n\n    /**\n     * @private\n     * @type {boolean|undefined}\n     */\n    this.textRotateWithView_ = undefined;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.textRotation_ = 0;\n\n    /**\n     * @private\n     * @type {?import(\"../canvas.js\").FillState}\n     */\n    this.textFillState_ = null;\n\n    /**\n     * @type {!Object<string, import(\"../canvas.js\").FillState>}\n     */\n    this.fillStates = {};\n\n    /**\n     * @private\n     * @type {?import(\"../canvas.js\").StrokeState}\n     */\n    this.textStrokeState_ = null;\n\n    /**\n     * @type {!Object<string, import(\"../canvas.js\").StrokeState>}\n     */\n    this.strokeStates = {};\n\n    /**\n     * @private\n     * @type {import(\"../canvas.js\").TextState}\n     */\n    this.textState_ = /** @type {import(\"../canvas.js\").TextState} */ ({});\n\n    /**\n     * @type {!Object<string, import(\"../canvas.js\").TextState>}\n     */\n    this.textStates = {};\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.textKey_ = '';\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.fillKey_ = '';\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.strokeKey_ = '';\n\n    /**\n     * Data shared with an image builder for combined decluttering.\n     * @private\n     * @type {import(\"../canvas.js\").DeclutterImageWithText}\n     */\n    this.declutterImageWithText_ = undefined;\n  }\n\n  /**\n   * @return {import(\"../canvas.js\").SerializableInstructions} the serializable instructions.\n   */\n  finish() {\n    const instructions = super.finish();\n    instructions.textStates = this.textStates;\n    instructions.fillStates = this.fillStates;\n    instructions.strokeStates = this.strokeStates;\n    return instructions;\n  }\n\n  /**\n   * @param {import(\"../../geom/SimpleGeometry.js\").default|import(\"../Feature.js\").default} geometry Geometry.\n   * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n   */\n  drawText(geometry, feature) {\n    const fillState = this.textFillState_;\n    const strokeState = this.textStrokeState_;\n    const textState = this.textState_;\n    if (this.text_ === '' || !textState || (!fillState && !strokeState)) {\n      return;\n    }\n\n    const coordinates = this.coordinates;\n    let begin = coordinates.length;\n\n    const geometryType = geometry.getType();\n    let flatCoordinates = null;\n    let stride = geometry.getStride();\n\n    if (\n      textState.placement === 'line' &&\n      (geometryType == 'LineString' ||\n        geometryType == 'MultiLineString' ||\n        geometryType == 'Polygon' ||\n        geometryType == 'MultiPolygon')\n    ) {\n      if (!intersects(this.getBufferedMaxExtent(), geometry.getExtent())) {\n        return;\n      }\n      let ends;\n      flatCoordinates = geometry.getFlatCoordinates();\n      if (geometryType == 'LineString') {\n        ends = [flatCoordinates.length];\n      } else if (geometryType == 'MultiLineString') {\n        ends = /** @type {import(\"../../geom/MultiLineString.js\").default} */ (\n          geometry\n        ).getEnds();\n      } else if (geometryType == 'Polygon') {\n        ends = /** @type {import(\"../../geom/Polygon.js\").default} */ (geometry)\n          .getEnds()\n          .slice(0, 1);\n      } else if (geometryType == 'MultiPolygon') {\n        const endss =\n          /** @type {import(\"../../geom/MultiPolygon.js\").default} */ (\n            geometry\n          ).getEndss();\n        ends = [];\n        for (let i = 0, ii = endss.length; i < ii; ++i) {\n          ends.push(endss[i][0]);\n        }\n      }\n      this.beginGeometry(geometry, feature);\n      const textAlign = textState.textAlign;\n      // No `justify` support for line placement.\n      let flatOffset = 0;\n      let flatEnd;\n      for (let o = 0, oo = ends.length; o < oo; ++o) {\n        if (textAlign == undefined) {\n          const range = matchingChunk(\n            textState.maxAngle,\n            flatCoordinates,\n            flatOffset,\n            ends[o],\n            stride\n          );\n          flatOffset = range[0];\n          flatEnd = range[1];\n        } else {\n          flatEnd = ends[o];\n        }\n        for (let i = flatOffset; i < flatEnd; i += stride) {\n          coordinates.push(flatCoordinates[i], flatCoordinates[i + 1]);\n        }\n        const end = coordinates.length;\n        flatOffset = ends[o];\n        this.drawChars_(begin, end);\n        begin = end;\n      }\n      this.endGeometry(feature);\n    } else {\n      let geometryWidths = textState.overflow ? null : [];\n      switch (geometryType) {\n        case 'Point':\n        case 'MultiPoint':\n          flatCoordinates =\n            /** @type {import(\"../../geom/MultiPoint.js\").default} */ (\n              geometry\n            ).getFlatCoordinates();\n          break;\n        case 'LineString':\n          flatCoordinates =\n            /** @type {import(\"../../geom/LineString.js\").default} */ (\n              geometry\n            ).getFlatMidpoint();\n          break;\n        case 'Circle':\n          flatCoordinates =\n            /** @type {import(\"../../geom/Circle.js\").default} */ (\n              geometry\n            ).getCenter();\n          break;\n        case 'MultiLineString':\n          flatCoordinates =\n            /** @type {import(\"../../geom/MultiLineString.js\").default} */ (\n              geometry\n            ).getFlatMidpoints();\n          stride = 2;\n          break;\n        case 'Polygon':\n          flatCoordinates =\n            /** @type {import(\"../../geom/Polygon.js\").default} */ (\n              geometry\n            ).getFlatInteriorPoint();\n          if (!textState.overflow) {\n            geometryWidths.push(flatCoordinates[2] / this.resolution);\n          }\n          stride = 3;\n          break;\n        case 'MultiPolygon':\n          const interiorPoints =\n            /** @type {import(\"../../geom/MultiPolygon.js\").default} */ (\n              geometry\n            ).getFlatInteriorPoints();\n          flatCoordinates = [];\n          for (let i = 0, ii = interiorPoints.length; i < ii; i += 3) {\n            if (!textState.overflow) {\n              geometryWidths.push(interiorPoints[i + 2] / this.resolution);\n            }\n            flatCoordinates.push(interiorPoints[i], interiorPoints[i + 1]);\n          }\n          if (flatCoordinates.length === 0) {\n            return;\n          }\n          stride = 2;\n          break;\n        default:\n      }\n      const end = this.appendFlatPointCoordinates(flatCoordinates, stride);\n      if (end === begin) {\n        return;\n      }\n      if (\n        geometryWidths &&\n        (end - begin) / 2 !== flatCoordinates.length / stride\n      ) {\n        let beg = begin / 2;\n        geometryWidths = geometryWidths.filter((w, i) => {\n          const keep =\n            coordinates[(beg + i) * 2] === flatCoordinates[i * stride] &&\n            coordinates[(beg + i) * 2 + 1] === flatCoordinates[i * stride + 1];\n          if (!keep) {\n            --beg;\n          }\n          return keep;\n        });\n      }\n\n      this.saveTextStates_();\n\n      if (textState.backgroundFill || textState.backgroundStroke) {\n        this.setFillStrokeStyle(\n          textState.backgroundFill,\n          textState.backgroundStroke\n        );\n        if (textState.backgroundFill) {\n          this.updateFillStyle(this.state, this.createFill);\n          this.hitDetectionInstructions.push(this.createFill(this.state));\n        }\n        if (textState.backgroundStroke) {\n          this.updateStrokeStyle(this.state, this.applyStroke);\n          this.hitDetectionInstructions.push(this.createStroke(this.state));\n        }\n      }\n\n      this.beginGeometry(geometry, feature);\n\n      // adjust padding for negative scale\n      let padding = textState.padding;\n      if (\n        padding != defaultPadding &&\n        (textState.scale[0] < 0 || textState.scale[1] < 0)\n      ) {\n        let p0 = textState.padding[0];\n        let p1 = textState.padding[1];\n        let p2 = textState.padding[2];\n        let p3 = textState.padding[3];\n        if (textState.scale[0] < 0) {\n          p1 = -p1;\n          p3 = -p3;\n        }\n        if (textState.scale[1] < 0) {\n          p0 = -p0;\n          p2 = -p2;\n        }\n        padding = [p0, p1, p2, p3];\n      }\n\n      // The image is unknown at this stage so we pass null; it will be computed at render time.\n      // For clarity, we pass NaN for offsetX, offsetY, width and height, which will be computed at\n      // render time.\n      const pixelRatio = this.pixelRatio;\n      this.instructions.push([\n        CanvasInstruction.DRAW_IMAGE,\n        begin,\n        end,\n        null,\n        NaN,\n        NaN,\n        NaN,\n        1,\n        0,\n        0,\n        this.textRotateWithView_,\n        this.textRotation_,\n        [1, 1],\n        NaN,\n        undefined,\n        this.declutterImageWithText_,\n        padding == defaultPadding\n          ? defaultPadding\n          : padding.map(function (p) {\n              return p * pixelRatio;\n            }),\n        !!textState.backgroundFill,\n        !!textState.backgroundStroke,\n        this.text_,\n        this.textKey_,\n        this.strokeKey_,\n        this.fillKey_,\n        this.textOffsetX_,\n        this.textOffsetY_,\n        geometryWidths,\n      ]);\n      const scale = 1 / pixelRatio;\n      this.hitDetectionInstructions.push([\n        CanvasInstruction.DRAW_IMAGE,\n        begin,\n        end,\n        null,\n        NaN,\n        NaN,\n        NaN,\n        1,\n        0,\n        0,\n        this.textRotateWithView_,\n        this.textRotation_,\n        [scale, scale],\n        NaN,\n        undefined,\n        this.declutterImageWithText_,\n        padding,\n        !!textState.backgroundFill,\n        !!textState.backgroundStroke,\n        this.text_,\n        this.textKey_,\n        this.strokeKey_,\n        this.fillKey_,\n        this.textOffsetX_,\n        this.textOffsetY_,\n        geometryWidths,\n      ]);\n\n      this.endGeometry(feature);\n    }\n  }\n\n  /**\n   * @private\n   */\n  saveTextStates_() {\n    const strokeState = this.textStrokeState_;\n    const textState = this.textState_;\n    const fillState = this.textFillState_;\n\n    const strokeKey = this.strokeKey_;\n    if (strokeState) {\n      if (!(strokeKey in this.strokeStates)) {\n        this.strokeStates[strokeKey] = {\n          strokeStyle: strokeState.strokeStyle,\n          lineCap: strokeState.lineCap,\n          lineDashOffset: strokeState.lineDashOffset,\n          lineWidth: strokeState.lineWidth,\n          lineJoin: strokeState.lineJoin,\n          miterLimit: strokeState.miterLimit,\n          lineDash: strokeState.lineDash,\n        };\n      }\n    }\n    const textKey = this.textKey_;\n    if (!(textKey in this.textStates)) {\n      this.textStates[textKey] = {\n        font: textState.font,\n        textAlign: textState.textAlign || defaultTextAlign,\n        justify: textState.justify,\n        textBaseline: textState.textBaseline || defaultTextBaseline,\n        scale: textState.scale,\n      };\n    }\n    const fillKey = this.fillKey_;\n    if (fillState) {\n      if (!(fillKey in this.fillStates)) {\n        this.fillStates[fillKey] = {\n          fillStyle: fillState.fillStyle,\n        };\n      }\n    }\n  }\n\n  /**\n   * @private\n   * @param {number} begin Begin.\n   * @param {number} end End.\n   */\n  drawChars_(begin, end) {\n    const strokeState = this.textStrokeState_;\n    const textState = this.textState_;\n\n    const strokeKey = this.strokeKey_;\n    const textKey = this.textKey_;\n    const fillKey = this.fillKey_;\n    this.saveTextStates_();\n\n    const pixelRatio = this.pixelRatio;\n    const baseline = TEXT_ALIGN[textState.textBaseline];\n\n    const offsetY = this.textOffsetY_ * pixelRatio;\n    const text = this.text_;\n    const strokeWidth = strokeState\n      ? (strokeState.lineWidth * Math.abs(textState.scale[0])) / 2\n      : 0;\n\n    this.instructions.push([\n      CanvasInstruction.DRAW_CHARS,\n      begin,\n      end,\n      baseline,\n      textState.overflow,\n      fillKey,\n      textState.maxAngle,\n      pixelRatio,\n      offsetY,\n      strokeKey,\n      strokeWidth * pixelRatio,\n      text,\n      textKey,\n      1,\n    ]);\n    this.hitDetectionInstructions.push([\n      CanvasInstruction.DRAW_CHARS,\n      begin,\n      end,\n      baseline,\n      textState.overflow,\n      fillKey,\n      textState.maxAngle,\n      1,\n      offsetY,\n      strokeKey,\n      strokeWidth,\n      text,\n      textKey,\n      1 / pixelRatio,\n    ]);\n  }\n\n  /**\n   * @param {import(\"../../style/Text.js\").default} textStyle Text style.\n   * @param {Object} [sharedData] Shared data.\n   */\n  setTextStyle(textStyle, sharedData) {\n    let textState, fillState, strokeState;\n    if (!textStyle) {\n      this.text_ = '';\n    } else {\n      const textFillStyle = textStyle.getFill();\n      if (!textFillStyle) {\n        fillState = null;\n        this.textFillState_ = fillState;\n      } else {\n        fillState = this.textFillState_;\n        if (!fillState) {\n          fillState = /** @type {import(\"../canvas.js\").FillState} */ ({});\n          this.textFillState_ = fillState;\n        }\n        fillState.fillStyle = asColorLike(\n          textFillStyle.getColor() || defaultFillStyle\n        );\n      }\n\n      const textStrokeStyle = textStyle.getStroke();\n      if (!textStrokeStyle) {\n        strokeState = null;\n        this.textStrokeState_ = strokeState;\n      } else {\n        strokeState = this.textStrokeState_;\n        if (!strokeState) {\n          strokeState = /** @type {import(\"../canvas.js\").StrokeState} */ ({});\n          this.textStrokeState_ = strokeState;\n        }\n        const lineDash = textStrokeStyle.getLineDash();\n        const lineDashOffset = textStrokeStyle.getLineDashOffset();\n        const lineWidth = textStrokeStyle.getWidth();\n        const miterLimit = textStrokeStyle.getMiterLimit();\n        strokeState.lineCap = textStrokeStyle.getLineCap() || defaultLineCap;\n        strokeState.lineDash = lineDash ? lineDash.slice() : defaultLineDash;\n        strokeState.lineDashOffset =\n          lineDashOffset === undefined ? defaultLineDashOffset : lineDashOffset;\n        strokeState.lineJoin = textStrokeStyle.getLineJoin() || defaultLineJoin;\n        strokeState.lineWidth =\n          lineWidth === undefined ? defaultLineWidth : lineWidth;\n        strokeState.miterLimit =\n          miterLimit === undefined ? defaultMiterLimit : miterLimit;\n        strokeState.strokeStyle = asColorLike(\n          textStrokeStyle.getColor() || defaultStrokeStyle\n        );\n      }\n\n      textState = this.textState_;\n      const font = textStyle.getFont() || defaultFont;\n      registerFont(font);\n      const textScale = textStyle.getScaleArray();\n      textState.overflow = textStyle.getOverflow();\n      textState.font = font;\n      textState.maxAngle = textStyle.getMaxAngle();\n      textState.placement = textStyle.getPlacement();\n      textState.textAlign = textStyle.getTextAlign();\n      textState.justify = textStyle.getJustify();\n      textState.textBaseline =\n        textStyle.getTextBaseline() || defaultTextBaseline;\n      textState.backgroundFill = textStyle.getBackgroundFill();\n      textState.backgroundStroke = textStyle.getBackgroundStroke();\n      textState.padding = textStyle.getPadding() || defaultPadding;\n      textState.scale = textScale === undefined ? [1, 1] : textScale;\n\n      const textOffsetX = textStyle.getOffsetX();\n      const textOffsetY = textStyle.getOffsetY();\n      const textRotateWithView = textStyle.getRotateWithView();\n      const textRotation = textStyle.getRotation();\n      this.text_ = textStyle.getText() || '';\n      this.textOffsetX_ = textOffsetX === undefined ? 0 : textOffsetX;\n      this.textOffsetY_ = textOffsetY === undefined ? 0 : textOffsetY;\n      this.textRotateWithView_ =\n        textRotateWithView === undefined ? false : textRotateWithView;\n      this.textRotation_ = textRotation === undefined ? 0 : textRotation;\n\n      this.strokeKey_ = strokeState\n        ? (typeof strokeState.strokeStyle == 'string'\n            ? strokeState.strokeStyle\n            : getUid(strokeState.strokeStyle)) +\n          strokeState.lineCap +\n          strokeState.lineDashOffset +\n          '|' +\n          strokeState.lineWidth +\n          strokeState.lineJoin +\n          strokeState.miterLimit +\n          '[' +\n          strokeState.lineDash.join() +\n          ']'\n        : '';\n      this.textKey_ =\n        textState.font +\n        textState.scale +\n        (textState.textAlign || '?') +\n        (textState.justify || '?') +\n        (textState.textBaseline || '?');\n      this.fillKey_ = fillState\n        ? typeof fillState.fillStyle == 'string'\n          ? fillState.fillStyle\n          : '|' + getUid(fillState.fillStyle)\n        : '';\n    }\n    this.declutterImageWithText_ = sharedData;\n  }\n}\n\nexport default CanvasTextBuilder;\n","/**\n * @module ol/render/canvas/BuilderGroup\n */\n\nimport Builder from './Builder.js';\nimport ImageBuilder from './ImageBuilder.js';\nimport LineStringBuilder from './LineStringBuilder.js';\nimport PolygonBuilder from './PolygonBuilder.js';\nimport TextBuilder from './TextBuilder.js';\n\n/**\n * @type {Object<import(\"../canvas.js\").BuilderType, typeof Builder>}\n */\nconst BATCH_CONSTRUCTORS = {\n  'Circle': PolygonBuilder,\n  'Default': Builder,\n  'Image': ImageBuilder,\n  'LineString': LineStringBuilder,\n  'Polygon': PolygonBuilder,\n  'Text': TextBuilder,\n};\n\nclass BuilderGroup {\n  /**\n   * @param {number} tolerance Tolerance.\n   * @param {import(\"../../extent.js\").Extent} maxExtent Max extent.\n   * @param {number} resolution Resolution.\n   * @param {number} pixelRatio Pixel ratio.\n   */\n  constructor(tolerance, maxExtent, resolution, pixelRatio) {\n    /**\n     * @private\n     * @type {number}\n     */\n    this.tolerance_ = tolerance;\n\n    /**\n     * @private\n     * @type {import(\"../../extent.js\").Extent}\n     */\n    this.maxExtent_ = maxExtent;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.pixelRatio_ = pixelRatio;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.resolution_ = resolution;\n\n    /**\n     * @private\n     * @type {!Object<string, !Object<import(\"../canvas.js\").BuilderType, Builder>>}\n     */\n    this.buildersByZIndex_ = {};\n  }\n\n  /**\n   * @return {!Object<string, !Object<import(\"../canvas.js\").BuilderType, import(\"./Builder.js\").SerializableInstructions>>} The serializable instructions\n   */\n  finish() {\n    const builderInstructions = {};\n    for (const zKey in this.buildersByZIndex_) {\n      builderInstructions[zKey] = builderInstructions[zKey] || {};\n      const builders = this.buildersByZIndex_[zKey];\n      for (const builderKey in builders) {\n        const builderInstruction = builders[builderKey].finish();\n        builderInstructions[zKey][builderKey] = builderInstruction;\n      }\n    }\n    return builderInstructions;\n  }\n\n  /**\n   * @param {number|undefined} zIndex Z index.\n   * @param {import(\"../canvas.js\").BuilderType} builderType Replay type.\n   * @return {import(\"../VectorContext.js\").default} Replay.\n   */\n  getBuilder(zIndex, builderType) {\n    const zIndexKey = zIndex !== undefined ? zIndex.toString() : '0';\n    let replays = this.buildersByZIndex_[zIndexKey];\n    if (replays === undefined) {\n      replays = {};\n      this.buildersByZIndex_[zIndexKey] = replays;\n    }\n    let replay = replays[builderType];\n    if (replay === undefined) {\n      const Constructor = BATCH_CONSTRUCTORS[builderType];\n      replay = new Constructor(\n        this.tolerance_,\n        this.maxExtent_,\n        this.resolution_,\n        this.pixelRatio_\n      );\n      replays[builderType] = replay;\n    }\n    return replay;\n  }\n}\n\nexport default BuilderGroup;\n","/**\n * @module ol/geom/flat/textpath\n */\nimport {lerp} from '../../math.js';\nimport {rotate} from './transform.js';\n\n/**\n * @param {Array<number>} flatCoordinates Path to put text on.\n * @param {number} offset Start offset of the `flatCoordinates`.\n * @param {number} end End offset of the `flatCoordinates`.\n * @param {number} stride Stride.\n * @param {string} text Text to place on the path.\n * @param {number} startM m along the path where the text starts.\n * @param {number} maxAngle Max angle between adjacent chars in radians.\n * @param {number} scale The product of the text scale and the device pixel ratio.\n * @param {function(string, string, Object<string, number>):number} measureAndCacheTextWidth Measure and cache text width.\n * @param {string} font The font.\n * @param {Object<string, number>} cache A cache of measured widths.\n * @param {number} rotation Rotation to apply to the flatCoordinates to determine whether text needs to be reversed.\n * @return {Array<Array<*>>|null} The result array (or null if `maxAngle` was\n * exceeded). Entries of the array are x, y, anchorX, angle, chunk.\n */\nexport function drawTextOnPath(\n  flatCoordinates,\n  offset,\n  end,\n  stride,\n  text,\n  startM,\n  maxAngle,\n  scale,\n  measureAndCacheTextWidth,\n  font,\n  cache,\n  rotation\n) {\n  let x2 = flatCoordinates[offset];\n  let y2 = flatCoordinates[offset + 1];\n  let x1 = 0;\n  let y1 = 0;\n  let segmentLength = 0;\n  let segmentM = 0;\n\n  function advance() {\n    x1 = x2;\n    y1 = y2;\n    offset += stride;\n    x2 = flatCoordinates[offset];\n    y2 = flatCoordinates[offset + 1];\n    segmentM += segmentLength;\n    segmentLength = Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));\n  }\n  do {\n    advance();\n  } while (offset < end - stride && segmentM + segmentLength < startM);\n\n  let interpolate =\n    segmentLength === 0 ? 0 : (startM - segmentM) / segmentLength;\n  const beginX = lerp(x1, x2, interpolate);\n  const beginY = lerp(y1, y2, interpolate);\n\n  const startOffset = offset - stride;\n  const startLength = segmentM;\n  const endM = startM + scale * measureAndCacheTextWidth(font, text, cache);\n  while (offset < end - stride && segmentM + segmentLength < endM) {\n    advance();\n  }\n  interpolate = segmentLength === 0 ? 0 : (endM - segmentM) / segmentLength;\n  const endX = lerp(x1, x2, interpolate);\n  const endY = lerp(y1, y2, interpolate);\n\n  // Keep text upright\n  let reverse;\n  if (rotation) {\n    const flat = [beginX, beginY, endX, endY];\n    rotate(flat, 0, 4, 2, rotation, flat, flat);\n    reverse = flat[0] > flat[2];\n  } else {\n    reverse = beginX > endX;\n  }\n\n  const PI = Math.PI;\n  const result = [];\n  const singleSegment = startOffset + stride === offset;\n\n  offset = startOffset;\n  segmentLength = 0;\n  segmentM = startLength;\n  x2 = flatCoordinates[offset];\n  y2 = flatCoordinates[offset + 1];\n\n  let previousAngle;\n  // All on the same segment\n  if (singleSegment) {\n    advance();\n\n    previousAngle = Math.atan2(y2 - y1, x2 - x1);\n    if (reverse) {\n      previousAngle += previousAngle > 0 ? -PI : PI;\n    }\n    const x = (endX + beginX) / 2;\n    const y = (endY + beginY) / 2;\n    result[0] = [x, y, (endM - startM) / 2, previousAngle, text];\n    return result;\n  }\n\n  // rendering across line segments\n  text = text.replace(/\\n/g, ' '); // ensure rendering in single-line as all calculations below don't handle multi-lines\n\n  for (let i = 0, ii = text.length; i < ii; ) {\n    advance();\n    let angle = Math.atan2(y2 - y1, x2 - x1);\n    if (reverse) {\n      angle += angle > 0 ? -PI : PI;\n    }\n    if (previousAngle !== undefined) {\n      let delta = angle - previousAngle;\n      delta += delta > PI ? -2 * PI : delta < -PI ? 2 * PI : 0;\n      if (Math.abs(delta) > maxAngle) {\n        return null;\n      }\n    }\n    previousAngle = angle;\n\n    const iStart = i;\n    let charLength = 0;\n    for (; i < ii; ++i) {\n      const index = reverse ? ii - i - 1 : i;\n      const len = scale * measureAndCacheTextWidth(font, text[index], cache);\n      if (\n        offset + stride < end &&\n        segmentM + segmentLength < startM + charLength + len / 2\n      ) {\n        break;\n      }\n      charLength += len;\n    }\n    if (i === iStart) {\n      continue;\n    }\n    const chars = reverse\n      ? text.substring(ii - iStart, ii - i)\n      : text.substring(iStart, i);\n    interpolate =\n      segmentLength === 0\n        ? 0\n        : (startM + charLength / 2 - segmentM) / segmentLength;\n    const x = lerp(x1, x2, interpolate);\n    const y = lerp(y1, y2, interpolate);\n    result.push([x, y, charLength / 2, angle, chars]);\n    startM += charLength;\n  }\n  return result;\n}\n","/**\n * @module ol/render/canvas/Executor\n */\nimport CanvasInstruction from './Instruction.js';\nimport {TEXT_ALIGN} from './TextBuilder.js';\nimport {\n  apply as applyTransform,\n  compose as composeTransform,\n  create as createTransform,\n  setFromArray as transformSetFromArray,\n} from '../../transform.js';\nimport {createEmpty, createOrUpdate, intersects} from '../../extent.js';\nimport {\n  defaultPadding,\n  defaultTextAlign,\n  defaultTextBaseline,\n  drawImageOrLabel,\n  getTextDimensions,\n  measureAndCacheTextWidth,\n} from '../canvas.js';\nimport {drawTextOnPath} from '../../geom/flat/textpath.js';\nimport {equals} from '../../array.js';\nimport {lineStringLength} from '../../geom/flat/length.js';\nimport {transform2D} from '../../geom/flat/transform.js';\n\n/**\n * @typedef {Object} BBox\n * @property {number} minX Minimal x.\n * @property {number} minY Minimal y.\n * @property {number} maxX Maximal x.\n * @property {number} maxY Maximal y\n * @property {*} value Value.\n */\n\n/**\n * @typedef {Object} ImageOrLabelDimensions\n * @property {number} drawImageX DrawImageX.\n * @property {number} drawImageY DrawImageY.\n * @property {number} drawImageW DrawImageW.\n * @property {number} drawImageH DrawImageH.\n * @property {number} originX OriginX.\n * @property {number} originY OriginY.\n * @property {Array<number>} scale Scale.\n * @property {BBox} declutterBox DeclutterBox.\n * @property {import(\"../../transform.js\").Transform} canvasTransform CanvasTransform.\n */\n\n/**\n * @typedef {{0: CanvasRenderingContext2D, 1: number, 2: import(\"../canvas.js\").Label|HTMLImageElement|HTMLCanvasElement|HTMLVideoElement, 3: ImageOrLabelDimensions, 4: number, 5: Array<*>, 6: Array<*>}} ReplayImageOrLabelArgs\n */\n\n/**\n * @template T\n * @typedef {function(import(\"../../Feature.js\").FeatureLike, import(\"../../geom/SimpleGeometry.js\").default): T} FeatureCallback\n */\n\n/**\n * @type {import(\"../../extent.js\").Extent}\n */\nconst tmpExtent = createEmpty();\n\n/** @type {import(\"../../coordinate.js\").Coordinate} */\nconst p1 = [];\n/** @type {import(\"../../coordinate.js\").Coordinate} */\nconst p2 = [];\n/** @type {import(\"../../coordinate.js\").Coordinate} */\nconst p3 = [];\n/** @type {import(\"../../coordinate.js\").Coordinate} */\nconst p4 = [];\n\n/**\n * @param {ReplayImageOrLabelArgs} replayImageOrLabelArgs Arguments to replayImageOrLabel\n * @return {BBox} Declutter bbox.\n */\nfunction getDeclutterBox(replayImageOrLabelArgs) {\n  return replayImageOrLabelArgs[3].declutterBox;\n}\n\nconst rtlRegEx = new RegExp(\n  /* eslint-disable prettier/prettier */\n  '[' +\n    String.fromCharCode(0x00591) + '-' + String.fromCharCode(0x008ff) +\n    String.fromCharCode(0x0fb1d) + '-' + String.fromCharCode(0x0fdff) +\n    String.fromCharCode(0x0fe70) + '-' + String.fromCharCode(0x0fefc) +\n    String.fromCharCode(0x10800) + '-' + String.fromCharCode(0x10fff) +\n    String.fromCharCode(0x1e800) + '-' + String.fromCharCode(0x1efff) +\n  ']'\n  /* eslint-enable prettier/prettier */\n);\n\n/**\n * @param {string} text Text.\n * @param {CanvasTextAlign} align Alignment.\n * @return {number} Text alignment.\n */\nfunction horizontalTextAlign(text, align) {\n  if ((align === 'start' || align === 'end') && !rtlRegEx.test(text)) {\n    align = align === 'start' ? 'left' : 'right';\n  }\n  return TEXT_ALIGN[align];\n}\n\n/**\n * @param {Array<string>} acc Accumulator.\n * @param {string} line Line of text.\n * @param {number} i Index\n * @return {Array<string>} Accumulator.\n */\nfunction createTextChunks(acc, line, i) {\n  if (i > 0) {\n    acc.push('\\n', '');\n  }\n  acc.push(line, '');\n  return acc;\n}\n\nclass Executor {\n  /**\n   * @param {number} resolution Resolution.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {boolean} overlaps The replay can have overlapping geometries.\n   * @param {import(\"../canvas.js\").SerializableInstructions} instructions The serializable instructions\n   */\n  constructor(resolution, pixelRatio, overlaps, instructions) {\n    /**\n     * @protected\n     * @type {boolean}\n     */\n    this.overlaps = overlaps;\n\n    /**\n     * @protected\n     * @type {number}\n     */\n    this.pixelRatio = pixelRatio;\n\n    /**\n     * @protected\n     * @const\n     * @type {number}\n     */\n    this.resolution = resolution;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.alignFill_;\n\n    /**\n     * @protected\n     * @type {Array<*>}\n     */\n    this.instructions = instructions.instructions;\n\n    /**\n     * @protected\n     * @type {Array<number>}\n     */\n    this.coordinates = instructions.coordinates;\n\n    /**\n     * @private\n     * @type {!Object<number,import(\"../../coordinate.js\").Coordinate|Array<import(\"../../coordinate.js\").Coordinate>|Array<Array<import(\"../../coordinate.js\").Coordinate>>>}\n     */\n    this.coordinateCache_ = {};\n\n    /**\n     * @private\n     * @type {!import(\"../../transform.js\").Transform}\n     */\n    this.renderedTransform_ = createTransform();\n\n    /**\n     * @protected\n     * @type {Array<*>}\n     */\n    this.hitDetectionInstructions = instructions.hitDetectionInstructions;\n\n    /**\n     * @private\n     * @type {Array<number>}\n     */\n    this.pixelCoordinates_ = null;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.viewRotation_ = 0;\n\n    /**\n     * @type {!Object<string, import(\"../canvas.js\").FillState>}\n     */\n    this.fillStates = instructions.fillStates || {};\n\n    /**\n     * @type {!Object<string, import(\"../canvas.js\").StrokeState>}\n     */\n    this.strokeStates = instructions.strokeStates || {};\n\n    /**\n     * @type {!Object<string, import(\"../canvas.js\").TextState>}\n     */\n    this.textStates = instructions.textStates || {};\n\n    /**\n     * @private\n     * @type {Object<string, Object<string, number>>}\n     */\n    this.widths_ = {};\n\n    /**\n     * @private\n     * @type {Object<string, import(\"../canvas.js\").Label>}\n     */\n    this.labels_ = {};\n  }\n\n  /**\n   * @param {string|Array<string>} text Text.\n   * @param {string} textKey Text style key.\n   * @param {string} fillKey Fill style key.\n   * @param {string} strokeKey Stroke style key.\n   * @return {import(\"../canvas.js\").Label} Label.\n   */\n  createLabel(text, textKey, fillKey, strokeKey) {\n    const key = text + textKey + fillKey + strokeKey;\n    if (this.labels_[key]) {\n      return this.labels_[key];\n    }\n    const strokeState = strokeKey ? this.strokeStates[strokeKey] : null;\n    const fillState = fillKey ? this.fillStates[fillKey] : null;\n    const textState = this.textStates[textKey];\n    const pixelRatio = this.pixelRatio;\n    const scale = [\n      textState.scale[0] * pixelRatio,\n      textState.scale[1] * pixelRatio,\n    ];\n    const textIsArray = Array.isArray(text);\n    const align = textState.justify\n      ? TEXT_ALIGN[textState.justify]\n      : horizontalTextAlign(\n          Array.isArray(text) ? text[0] : text,\n          textState.textAlign || defaultTextAlign\n        );\n    const strokeWidth =\n      strokeKey && strokeState.lineWidth ? strokeState.lineWidth : 0;\n\n    const chunks = textIsArray\n      ? text\n      : text.split('\\n').reduce(createTextChunks, []);\n\n    const {width, height, widths, heights, lineWidths} = getTextDimensions(\n      textState,\n      chunks\n    );\n    const renderWidth = width + strokeWidth;\n    const contextInstructions = [];\n    // make canvas 2 pixels wider to account for italic text width measurement errors\n    const w = (renderWidth + 2) * scale[0];\n    const h = (height + strokeWidth) * scale[1];\n    /** @type {import(\"../canvas.js\").Label} */\n    const label = {\n      width: w < 0 ? Math.floor(w) : Math.ceil(w),\n      height: h < 0 ? Math.floor(h) : Math.ceil(h),\n      contextInstructions: contextInstructions,\n    };\n    if (scale[0] != 1 || scale[1] != 1) {\n      contextInstructions.push('scale', scale);\n    }\n    if (strokeKey) {\n      contextInstructions.push('strokeStyle', strokeState.strokeStyle);\n      contextInstructions.push('lineWidth', strokeWidth);\n      contextInstructions.push('lineCap', strokeState.lineCap);\n      contextInstructions.push('lineJoin', strokeState.lineJoin);\n      contextInstructions.push('miterLimit', strokeState.miterLimit);\n      contextInstructions.push('setLineDash', [strokeState.lineDash]);\n      contextInstructions.push('lineDashOffset', strokeState.lineDashOffset);\n    }\n    if (fillKey) {\n      contextInstructions.push('fillStyle', fillState.fillStyle);\n    }\n    contextInstructions.push('textBaseline', 'middle');\n    contextInstructions.push('textAlign', 'center');\n    const leftRight = 0.5 - align;\n    let x = align * renderWidth + leftRight * strokeWidth;\n    const strokeInstructions = [];\n    const fillInstructions = [];\n    let lineHeight = 0;\n    let lineOffset = 0;\n    let widthHeightIndex = 0;\n    let lineWidthIndex = 0;\n    let previousFont;\n    for (let i = 0, ii = chunks.length; i < ii; i += 2) {\n      const text = chunks[i];\n      if (text === '\\n') {\n        lineOffset += lineHeight;\n        lineHeight = 0;\n        x = align * renderWidth + leftRight * strokeWidth;\n        ++lineWidthIndex;\n        continue;\n      }\n      const font = chunks[i + 1] || textState.font;\n      if (font !== previousFont) {\n        if (strokeKey) {\n          strokeInstructions.push('font', font);\n        }\n        if (fillKey) {\n          fillInstructions.push('font', font);\n        }\n        previousFont = font;\n      }\n      lineHeight = Math.max(lineHeight, heights[widthHeightIndex]);\n      const fillStrokeArgs = [\n        text,\n        x +\n          leftRight * widths[widthHeightIndex] +\n          align * (widths[widthHeightIndex] - lineWidths[lineWidthIndex]),\n        0.5 * (strokeWidth + lineHeight) + lineOffset,\n      ];\n      x += widths[widthHeightIndex];\n      if (strokeKey) {\n        strokeInstructions.push('strokeText', fillStrokeArgs);\n      }\n      if (fillKey) {\n        fillInstructions.push('fillText', fillStrokeArgs);\n      }\n      ++widthHeightIndex;\n    }\n    Array.prototype.push.apply(contextInstructions, strokeInstructions);\n    Array.prototype.push.apply(contextInstructions, fillInstructions);\n    this.labels_[key] = label;\n    return label;\n  }\n\n  /**\n   * @param {CanvasRenderingContext2D} context Context.\n   * @param {import(\"../../coordinate.js\").Coordinate} p1 1st point of the background box.\n   * @param {import(\"../../coordinate.js\").Coordinate} p2 2nd point of the background box.\n   * @param {import(\"../../coordinate.js\").Coordinate} p3 3rd point of the background box.\n   * @param {import(\"../../coordinate.js\").Coordinate} p4 4th point of the background box.\n   * @param {Array<*>} fillInstruction Fill instruction.\n   * @param {Array<*>} strokeInstruction Stroke instruction.\n   */\n  replayTextBackground_(\n    context,\n    p1,\n    p2,\n    p3,\n    p4,\n    fillInstruction,\n    strokeInstruction\n  ) {\n    context.beginPath();\n    context.moveTo.apply(context, p1);\n    context.lineTo.apply(context, p2);\n    context.lineTo.apply(context, p3);\n    context.lineTo.apply(context, p4);\n    context.lineTo.apply(context, p1);\n    if (fillInstruction) {\n      this.alignFill_ = /** @type {boolean} */ (fillInstruction[2]);\n      this.fill_(context);\n    }\n    if (strokeInstruction) {\n      this.setStrokeStyle_(\n        context,\n        /** @type {Array<*>} */ (strokeInstruction)\n      );\n      context.stroke();\n    }\n  }\n\n  /**\n   * @private\n   * @param {number} sheetWidth Width of the sprite sheet.\n   * @param {number} sheetHeight Height of the sprite sheet.\n   * @param {number} centerX X.\n   * @param {number} centerY Y.\n   * @param {number} width Width.\n   * @param {number} height Height.\n   * @param {number} anchorX Anchor X.\n   * @param {number} anchorY Anchor Y.\n   * @param {number} originX Origin X.\n   * @param {number} originY Origin Y.\n   * @param {number} rotation Rotation.\n   * @param {import(\"../../size.js\").Size} scale Scale.\n   * @param {boolean} snapToPixel Snap to pixel.\n   * @param {Array<number>} padding Padding.\n   * @param {boolean} fillStroke Background fill or stroke.\n   * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n   * @return {ImageOrLabelDimensions} Dimensions for positioning and decluttering the image or label.\n   */\n  calculateImageOrLabelDimensions_(\n    sheetWidth,\n    sheetHeight,\n    centerX,\n    centerY,\n    width,\n    height,\n    anchorX,\n    anchorY,\n    originX,\n    originY,\n    rotation,\n    scale,\n    snapToPixel,\n    padding,\n    fillStroke,\n    feature\n  ) {\n    anchorX *= scale[0];\n    anchorY *= scale[1];\n    let x = centerX - anchorX;\n    let y = centerY - anchorY;\n\n    const w = width + originX > sheetWidth ? sheetWidth - originX : width;\n    const h = height + originY > sheetHeight ? sheetHeight - originY : height;\n    const boxW = padding[3] + w * scale[0] + padding[1];\n    const boxH = padding[0] + h * scale[1] + padding[2];\n    const boxX = x - padding[3];\n    const boxY = y - padding[0];\n\n    if (fillStroke || rotation !== 0) {\n      p1[0] = boxX;\n      p4[0] = boxX;\n      p1[1] = boxY;\n      p2[1] = boxY;\n      p2[0] = boxX + boxW;\n      p3[0] = p2[0];\n      p3[1] = boxY + boxH;\n      p4[1] = p3[1];\n    }\n\n    let transform;\n    if (rotation !== 0) {\n      transform = composeTransform(\n        createTransform(),\n        centerX,\n        centerY,\n        1,\n        1,\n        rotation,\n        -centerX,\n        -centerY\n      );\n\n      applyTransform(transform, p1);\n      applyTransform(transform, p2);\n      applyTransform(transform, p3);\n      applyTransform(transform, p4);\n      createOrUpdate(\n        Math.min(p1[0], p2[0], p3[0], p4[0]),\n        Math.min(p1[1], p2[1], p3[1], p4[1]),\n        Math.max(p1[0], p2[0], p3[0], p4[0]),\n        Math.max(p1[1], p2[1], p3[1], p4[1]),\n        tmpExtent\n      );\n    } else {\n      createOrUpdate(\n        Math.min(boxX, boxX + boxW),\n        Math.min(boxY, boxY + boxH),\n        Math.max(boxX, boxX + boxW),\n        Math.max(boxY, boxY + boxH),\n        tmpExtent\n      );\n    }\n    if (snapToPixel) {\n      x = Math.round(x);\n      y = Math.round(y);\n    }\n    return {\n      drawImageX: x,\n      drawImageY: y,\n      drawImageW: w,\n      drawImageH: h,\n      originX: originX,\n      originY: originY,\n      declutterBox: {\n        minX: tmpExtent[0],\n        minY: tmpExtent[1],\n        maxX: tmpExtent[2],\n        maxY: tmpExtent[3],\n        value: feature,\n      },\n      canvasTransform: transform,\n      scale: scale,\n    };\n  }\n\n  /**\n   * @private\n   * @param {CanvasRenderingContext2D} context Context.\n   * @param {number} contextScale Scale of the context.\n   * @param {import(\"../canvas.js\").Label|HTMLImageElement|HTMLCanvasElement|HTMLVideoElement} imageOrLabel Image.\n   * @param {ImageOrLabelDimensions} dimensions Dimensions.\n   * @param {number} opacity Opacity.\n   * @param {Array<*>} fillInstruction Fill instruction.\n   * @param {Array<*>} strokeInstruction Stroke instruction.\n   * @return {boolean} The image or label was rendered.\n   */\n  replayImageOrLabel_(\n    context,\n    contextScale,\n    imageOrLabel,\n    dimensions,\n    opacity,\n    fillInstruction,\n    strokeInstruction\n  ) {\n    const fillStroke = !!(fillInstruction || strokeInstruction);\n\n    const box = dimensions.declutterBox;\n    const canvas = context.canvas;\n    const strokePadding = strokeInstruction\n      ? (strokeInstruction[2] * dimensions.scale[0]) / 2\n      : 0;\n    const intersects =\n      box.minX - strokePadding <= canvas.width / contextScale &&\n      box.maxX + strokePadding >= 0 &&\n      box.minY - strokePadding <= canvas.height / contextScale &&\n      box.maxY + strokePadding >= 0;\n\n    if (intersects) {\n      if (fillStroke) {\n        this.replayTextBackground_(\n          context,\n          p1,\n          p2,\n          p3,\n          p4,\n          /** @type {Array<*>} */ (fillInstruction),\n          /** @type {Array<*>} */ (strokeInstruction)\n        );\n      }\n      drawImageOrLabel(\n        context,\n        dimensions.canvasTransform,\n        opacity,\n        imageOrLabel,\n        dimensions.originX,\n        dimensions.originY,\n        dimensions.drawImageW,\n        dimensions.drawImageH,\n        dimensions.drawImageX,\n        dimensions.drawImageY,\n        dimensions.scale\n      );\n    }\n    return true;\n  }\n\n  /**\n   * @private\n   * @param {CanvasRenderingContext2D} context Context.\n   */\n  fill_(context) {\n    if (this.alignFill_) {\n      const origin = applyTransform(this.renderedTransform_, [0, 0]);\n      const repeatSize = 512 * this.pixelRatio;\n      context.save();\n      context.translate(origin[0] % repeatSize, origin[1] % repeatSize);\n      context.rotate(this.viewRotation_);\n    }\n    context.fill();\n    if (this.alignFill_) {\n      context.restore();\n    }\n  }\n\n  /**\n   * @private\n   * @param {CanvasRenderingContext2D} context Context.\n   * @param {Array<*>} instruction Instruction.\n   */\n  setStrokeStyle_(context, instruction) {\n    context['strokeStyle'] =\n      /** @type {import(\"../../colorlike.js\").ColorLike} */ (instruction[1]);\n    context.lineWidth = /** @type {number} */ (instruction[2]);\n    context.lineCap = /** @type {CanvasLineCap} */ (instruction[3]);\n    context.lineJoin = /** @type {CanvasLineJoin} */ (instruction[4]);\n    context.miterLimit = /** @type {number} */ (instruction[5]);\n    context.lineDashOffset = /** @type {number} */ (instruction[7]);\n    context.setLineDash(/** @type {Array<number>} */ (instruction[6]));\n  }\n\n  /**\n   * @private\n   * @param {string|Array<string>} text The text to draw.\n   * @param {string} textKey The key of the text state.\n   * @param {string} strokeKey The key for the stroke state.\n   * @param {string} fillKey The key for the fill state.\n   * @return {{label: import(\"../canvas.js\").Label, anchorX: number, anchorY: number}} The text image and its anchor.\n   */\n  drawLabelWithPointPlacement_(text, textKey, strokeKey, fillKey) {\n    const textState = this.textStates[textKey];\n\n    const label = this.createLabel(text, textKey, fillKey, strokeKey);\n\n    const strokeState = this.strokeStates[strokeKey];\n    const pixelRatio = this.pixelRatio;\n    const align = horizontalTextAlign(\n      Array.isArray(text) ? text[0] : text,\n      textState.textAlign || defaultTextAlign\n    );\n    const baseline = TEXT_ALIGN[textState.textBaseline || defaultTextBaseline];\n    const strokeWidth =\n      strokeState && strokeState.lineWidth ? strokeState.lineWidth : 0;\n\n    // Remove the 2 pixels we added in createLabel() for the anchor\n    const width = label.width / pixelRatio - 2 * textState.scale[0];\n    const anchorX = align * width + 2 * (0.5 - align) * strokeWidth;\n    const anchorY =\n      (baseline * label.height) / pixelRatio +\n      2 * (0.5 - baseline) * strokeWidth;\n\n    return {\n      label: label,\n      anchorX: anchorX,\n      anchorY: anchorY,\n    };\n  }\n\n  /**\n   * @private\n   * @param {CanvasRenderingContext2D} context Context.\n   * @param {number} contextScale Scale of the context.\n   * @param {import(\"../../transform.js\").Transform} transform Transform.\n   * @param {Array<*>} instructions Instructions array.\n   * @param {boolean} snapToPixel Snap point symbols and text to integer pixels.\n   * @param {FeatureCallback<T>} [featureCallback] Feature callback.\n   * @param {import(\"../../extent.js\").Extent} [hitExtent] Only check\n   *     features that intersect this extent.\n   * @param {import(\"rbush\").default} [declutterTree] Declutter tree.\n   * @return {T|undefined} Callback result.\n   * @template T\n   */\n  execute_(\n    context,\n    contextScale,\n    transform,\n    instructions,\n    snapToPixel,\n    featureCallback,\n    hitExtent,\n    declutterTree\n  ) {\n    /** @type {Array<number>} */\n    let pixelCoordinates;\n    if (this.pixelCoordinates_ && equals(transform, this.renderedTransform_)) {\n      pixelCoordinates = this.pixelCoordinates_;\n    } else {\n      if (!this.pixelCoordinates_) {\n        this.pixelCoordinates_ = [];\n      }\n      pixelCoordinates = transform2D(\n        this.coordinates,\n        0,\n        this.coordinates.length,\n        2,\n        transform,\n        this.pixelCoordinates_\n      );\n      transformSetFromArray(this.renderedTransform_, transform);\n    }\n    let i = 0; // instruction index\n    const ii = instructions.length; // end of instructions\n    let d = 0; // data index\n    let dd; // end of per-instruction data\n    let anchorX,\n      anchorY,\n      prevX,\n      prevY,\n      roundX,\n      roundY,\n      image,\n      text,\n      textKey,\n      strokeKey,\n      fillKey;\n    let pendingFill = 0;\n    let pendingStroke = 0;\n    let lastFillInstruction = null;\n    let lastStrokeInstruction = null;\n    const coordinateCache = this.coordinateCache_;\n    const viewRotation = this.viewRotation_;\n    const viewRotationFromTransform =\n      Math.round(Math.atan2(-transform[1], transform[0]) * 1e12) / 1e12;\n\n    const state = /** @type {import(\"../../render.js\").State} */ ({\n      context: context,\n      pixelRatio: this.pixelRatio,\n      resolution: this.resolution,\n      rotation: viewRotation,\n    });\n\n    // When the batch size gets too big, performance decreases. 200 is a good\n    // balance between batch size and number of fill/stroke instructions.\n    const batchSize =\n      this.instructions != instructions || this.overlaps ? 0 : 200;\n    let /** @type {import(\"../../Feature.js\").FeatureLike} */ feature;\n    let x, y, currentGeometry;\n    while (i < ii) {\n      const instruction = instructions[i];\n      const type = /** @type {import(\"./Instruction.js\").default} */ (\n        instruction[0]\n      );\n      switch (type) {\n        case CanvasInstruction.BEGIN_GEOMETRY:\n          feature = /** @type {import(\"../../Feature.js\").FeatureLike} */ (\n            instruction[1]\n          );\n          currentGeometry = instruction[3];\n          if (!feature.getGeometry()) {\n            i = /** @type {number} */ (instruction[2]);\n          } else if (\n            hitExtent !== undefined &&\n            !intersects(hitExtent, currentGeometry.getExtent())\n          ) {\n            i = /** @type {number} */ (instruction[2]) + 1;\n          } else {\n            ++i;\n          }\n          break;\n        case CanvasInstruction.BEGIN_PATH:\n          if (pendingFill > batchSize) {\n            this.fill_(context);\n            pendingFill = 0;\n          }\n          if (pendingStroke > batchSize) {\n            context.stroke();\n            pendingStroke = 0;\n          }\n          if (!pendingFill && !pendingStroke) {\n            context.beginPath();\n            prevX = NaN;\n            prevY = NaN;\n          }\n          ++i;\n          break;\n        case CanvasInstruction.CIRCLE:\n          d = /** @type {number} */ (instruction[1]);\n          const x1 = pixelCoordinates[d];\n          const y1 = pixelCoordinates[d + 1];\n          const x2 = pixelCoordinates[d + 2];\n          const y2 = pixelCoordinates[d + 3];\n          const dx = x2 - x1;\n          const dy = y2 - y1;\n          const r = Math.sqrt(dx * dx + dy * dy);\n          context.moveTo(x1 + r, y1);\n          context.arc(x1, y1, r, 0, 2 * Math.PI, true);\n          ++i;\n          break;\n        case CanvasInstruction.CLOSE_PATH:\n          context.closePath();\n          ++i;\n          break;\n        case CanvasInstruction.CUSTOM:\n          d = /** @type {number} */ (instruction[1]);\n          dd = instruction[2];\n          const geometry =\n            /** @type {import(\"../../geom/SimpleGeometry.js\").default} */ (\n              instruction[3]\n            );\n          const renderer = instruction[4];\n          const fn = instruction.length == 6 ? instruction[5] : undefined;\n          state.geometry = geometry;\n          state.feature = feature;\n          if (!(i in coordinateCache)) {\n            coordinateCache[i] = [];\n          }\n          const coords = coordinateCache[i];\n          if (fn) {\n            fn(pixelCoordinates, d, dd, 2, coords);\n          } else {\n            coords[0] = pixelCoordinates[d];\n            coords[1] = pixelCoordinates[d + 1];\n            coords.length = 2;\n          }\n          renderer(coords, state);\n          ++i;\n          break;\n        case CanvasInstruction.DRAW_IMAGE:\n          d = /** @type {number} */ (instruction[1]);\n          dd = /** @type {number} */ (instruction[2]);\n          image =\n            /** @type {HTMLCanvasElement|HTMLVideoElement|HTMLImageElement} */ (\n              instruction[3]\n            );\n\n          // Remaining arguments in DRAW_IMAGE are in alphabetical order\n          anchorX = /** @type {number} */ (instruction[4]);\n          anchorY = /** @type {number} */ (instruction[5]);\n          let height = /** @type {number} */ (instruction[6]);\n          const opacity = /** @type {number} */ (instruction[7]);\n          const originX = /** @type {number} */ (instruction[8]);\n          const originY = /** @type {number} */ (instruction[9]);\n          const rotateWithView = /** @type {boolean} */ (instruction[10]);\n          let rotation = /** @type {number} */ (instruction[11]);\n          const scale = /** @type {import(\"../../size.js\").Size} */ (\n            instruction[12]\n          );\n          let width = /** @type {number} */ (instruction[13]);\n          const declutterMode =\n            /** @type {\"declutter\"|\"obstacle\"|\"none\"|undefined} */ (\n              instruction[14]\n            );\n          const declutterImageWithText =\n            /** @type {import(\"../canvas.js\").DeclutterImageWithText} */ (\n              instruction[15]\n            );\n\n          if (!image && instruction.length >= 20) {\n            // create label images\n            text = /** @type {string} */ (instruction[19]);\n            textKey = /** @type {string} */ (instruction[20]);\n            strokeKey = /** @type {string} */ (instruction[21]);\n            fillKey = /** @type {string} */ (instruction[22]);\n            const labelWithAnchor = this.drawLabelWithPointPlacement_(\n              text,\n              textKey,\n              strokeKey,\n              fillKey\n            );\n            image = labelWithAnchor.label;\n            instruction[3] = image;\n            const textOffsetX = /** @type {number} */ (instruction[23]);\n            anchorX = (labelWithAnchor.anchorX - textOffsetX) * this.pixelRatio;\n            instruction[4] = anchorX;\n            const textOffsetY = /** @type {number} */ (instruction[24]);\n            anchorY = (labelWithAnchor.anchorY - textOffsetY) * this.pixelRatio;\n            instruction[5] = anchorY;\n            height = image.height;\n            instruction[6] = height;\n            width = image.width;\n            instruction[13] = width;\n          }\n\n          let geometryWidths;\n          if (instruction.length > 25) {\n            geometryWidths = /** @type {number} */ (instruction[25]);\n          }\n\n          let padding, backgroundFill, backgroundStroke;\n          if (instruction.length > 17) {\n            padding = /** @type {Array<number>} */ (instruction[16]);\n            backgroundFill = /** @type {boolean} */ (instruction[17]);\n            backgroundStroke = /** @type {boolean} */ (instruction[18]);\n          } else {\n            padding = defaultPadding;\n            backgroundFill = false;\n            backgroundStroke = false;\n          }\n\n          if (rotateWithView && viewRotationFromTransform) {\n            // Canvas is expected to be rotated to reverse view rotation.\n            rotation += viewRotation;\n          } else if (!rotateWithView && !viewRotationFromTransform) {\n            // Canvas is not rotated, images need to be rotated back to be north-up.\n            rotation -= viewRotation;\n          }\n          let widthIndex = 0;\n          for (; d < dd; d += 2) {\n            if (\n              geometryWidths &&\n              geometryWidths[widthIndex++] < width / this.pixelRatio\n            ) {\n              continue;\n            }\n            const dimensions = this.calculateImageOrLabelDimensions_(\n              image.width,\n              image.height,\n              pixelCoordinates[d],\n              pixelCoordinates[d + 1],\n              width,\n              height,\n              anchorX,\n              anchorY,\n              originX,\n              originY,\n              rotation,\n              scale,\n              snapToPixel,\n              padding,\n              backgroundFill || backgroundStroke,\n              feature\n            );\n            /** @type {ReplayImageOrLabelArgs} */\n            const args = [\n              context,\n              contextScale,\n              image,\n              dimensions,\n              opacity,\n              backgroundFill\n                ? /** @type {Array<*>} */ (lastFillInstruction)\n                : null,\n              backgroundStroke\n                ? /** @type {Array<*>} */ (lastStrokeInstruction)\n                : null,\n            ];\n            if (declutterTree) {\n              if (declutterMode === 'none') {\n                // not rendered in declutter group\n                continue;\n              } else if (declutterMode === 'obstacle') {\n                // will always be drawn, thus no collision detection, but insert as obstacle\n                declutterTree.insert(dimensions.declutterBox);\n                continue;\n              } else {\n                let imageArgs;\n                let imageDeclutterBox;\n                if (declutterImageWithText) {\n                  const index = dd - d;\n                  if (!declutterImageWithText[index]) {\n                    // We now have the image for an image+text combination.\n                    declutterImageWithText[index] = args;\n                    // Don't render anything for now, wait for the text.\n                    continue;\n                  }\n                  imageArgs = declutterImageWithText[index];\n                  delete declutterImageWithText[index];\n                  imageDeclutterBox = getDeclutterBox(imageArgs);\n                  if (declutterTree.collides(imageDeclutterBox)) {\n                    continue;\n                  }\n                }\n                if (declutterTree.collides(dimensions.declutterBox)) {\n                  continue;\n                }\n                if (imageArgs) {\n                  // We now have image and text for an image+text combination.\n                  declutterTree.insert(imageDeclutterBox);\n                  // Render the image before we render the text.\n                  this.replayImageOrLabel_.apply(this, imageArgs);\n                }\n                declutterTree.insert(dimensions.declutterBox);\n              }\n            }\n            this.replayImageOrLabel_.apply(this, args);\n          }\n          ++i;\n          break;\n        case CanvasInstruction.DRAW_CHARS:\n          const begin = /** @type {number} */ (instruction[1]);\n          const end = /** @type {number} */ (instruction[2]);\n          const baseline = /** @type {number} */ (instruction[3]);\n          const overflow = /** @type {number} */ (instruction[4]);\n          fillKey = /** @type {string} */ (instruction[5]);\n          const maxAngle = /** @type {number} */ (instruction[6]);\n          const measurePixelRatio = /** @type {number} */ (instruction[7]);\n          const offsetY = /** @type {number} */ (instruction[8]);\n          strokeKey = /** @type {string} */ (instruction[9]);\n          const strokeWidth = /** @type {number} */ (instruction[10]);\n          text = /** @type {string} */ (instruction[11]);\n          textKey = /** @type {string} */ (instruction[12]);\n          const pixelRatioScale = [\n            /** @type {number} */ (instruction[13]),\n            /** @type {number} */ (instruction[13]),\n          ];\n\n          const textState = this.textStates[textKey];\n          const font = textState.font;\n          const textScale = [\n            textState.scale[0] * measurePixelRatio,\n            textState.scale[1] * measurePixelRatio,\n          ];\n\n          let cachedWidths;\n          if (font in this.widths_) {\n            cachedWidths = this.widths_[font];\n          } else {\n            cachedWidths = {};\n            this.widths_[font] = cachedWidths;\n          }\n\n          const pathLength = lineStringLength(pixelCoordinates, begin, end, 2);\n          const textLength =\n            Math.abs(textScale[0]) *\n            measureAndCacheTextWidth(font, text, cachedWidths);\n          if (overflow || textLength <= pathLength) {\n            const textAlign = this.textStates[textKey].textAlign;\n            const startM = (pathLength - textLength) * TEXT_ALIGN[textAlign];\n            const parts = drawTextOnPath(\n              pixelCoordinates,\n              begin,\n              end,\n              2,\n              text,\n              startM,\n              maxAngle,\n              Math.abs(textScale[0]),\n              measureAndCacheTextWidth,\n              font,\n              cachedWidths,\n              viewRotationFromTransform ? 0 : this.viewRotation_\n            );\n            drawChars: if (parts) {\n              /** @type {Array<ReplayImageOrLabelArgs>} */\n              const replayImageOrLabelArgs = [];\n              let c, cc, chars, label, part;\n              if (strokeKey) {\n                for (c = 0, cc = parts.length; c < cc; ++c) {\n                  part = parts[c]; // x, y, anchorX, rotation, chunk\n                  chars = /** @type {string} */ (part[4]);\n                  label = this.createLabel(chars, textKey, '', strokeKey);\n                  anchorX =\n                    /** @type {number} */ (part[2]) +\n                    (textScale[0] < 0 ? -strokeWidth : strokeWidth);\n                  anchorY =\n                    baseline * label.height +\n                    ((0.5 - baseline) * 2 * strokeWidth * textScale[1]) /\n                      textScale[0] -\n                    offsetY;\n                  const dimensions = this.calculateImageOrLabelDimensions_(\n                    label.width,\n                    label.height,\n                    part[0],\n                    part[1],\n                    label.width,\n                    label.height,\n                    anchorX,\n                    anchorY,\n                    0,\n                    0,\n                    part[3],\n                    pixelRatioScale,\n                    false,\n                    defaultPadding,\n                    false,\n                    feature\n                  );\n                  if (\n                    declutterTree &&\n                    declutterTree.collides(dimensions.declutterBox)\n                  ) {\n                    break drawChars;\n                  }\n                  replayImageOrLabelArgs.push([\n                    context,\n                    contextScale,\n                    label,\n                    dimensions,\n                    1,\n                    null,\n                    null,\n                  ]);\n                }\n              }\n              if (fillKey) {\n                for (c = 0, cc = parts.length; c < cc; ++c) {\n                  part = parts[c]; // x, y, anchorX, rotation, chunk\n                  chars = /** @type {string} */ (part[4]);\n                  label = this.createLabel(chars, textKey, fillKey, '');\n                  anchorX = /** @type {number} */ (part[2]);\n                  anchorY = baseline * label.height - offsetY;\n                  const dimensions = this.calculateImageOrLabelDimensions_(\n                    label.width,\n                    label.height,\n                    part[0],\n                    part[1],\n                    label.width,\n                    label.height,\n                    anchorX,\n                    anchorY,\n                    0,\n                    0,\n                    part[3],\n                    pixelRatioScale,\n                    false,\n                    defaultPadding,\n                    false,\n                    feature\n                  );\n                  if (\n                    declutterTree &&\n                    declutterTree.collides(dimensions.declutterBox)\n                  ) {\n                    break drawChars;\n                  }\n                  replayImageOrLabelArgs.push([\n                    context,\n                    contextScale,\n                    label,\n                    dimensions,\n                    1,\n                    null,\n                    null,\n                  ]);\n                }\n              }\n              if (declutterTree) {\n                declutterTree.load(replayImageOrLabelArgs.map(getDeclutterBox));\n              }\n              for (let i = 0, ii = replayImageOrLabelArgs.length; i < ii; ++i) {\n                this.replayImageOrLabel_.apply(this, replayImageOrLabelArgs[i]);\n              }\n            }\n          }\n          ++i;\n          break;\n        case CanvasInstruction.END_GEOMETRY:\n          if (featureCallback !== undefined) {\n            feature = /** @type {import(\"../../Feature.js\").FeatureLike} */ (\n              instruction[1]\n            );\n            const result = featureCallback(feature, currentGeometry);\n            if (result) {\n              return result;\n            }\n          }\n          ++i;\n          break;\n        case CanvasInstruction.FILL:\n          if (batchSize) {\n            pendingFill++;\n          } else {\n            this.fill_(context);\n          }\n          ++i;\n          break;\n        case CanvasInstruction.MOVE_TO_LINE_TO:\n          d = /** @type {number} */ (instruction[1]);\n          dd = /** @type {number} */ (instruction[2]);\n          x = pixelCoordinates[d];\n          y = pixelCoordinates[d + 1];\n          roundX = (x + 0.5) | 0;\n          roundY = (y + 0.5) | 0;\n          if (roundX !== prevX || roundY !== prevY) {\n            context.moveTo(x, y);\n            prevX = roundX;\n            prevY = roundY;\n          }\n          for (d += 2; d < dd; d += 2) {\n            x = pixelCoordinates[d];\n            y = pixelCoordinates[d + 1];\n            roundX = (x + 0.5) | 0;\n            roundY = (y + 0.5) | 0;\n            if (d == dd - 2 || roundX !== prevX || roundY !== prevY) {\n              context.lineTo(x, y);\n              prevX = roundX;\n              prevY = roundY;\n            }\n          }\n          ++i;\n          break;\n        case CanvasInstruction.SET_FILL_STYLE:\n          lastFillInstruction = instruction;\n          this.alignFill_ = instruction[2];\n\n          if (pendingFill) {\n            this.fill_(context);\n            pendingFill = 0;\n            if (pendingStroke) {\n              context.stroke();\n              pendingStroke = 0;\n            }\n          }\n\n          context.fillStyle =\n            /** @type {import(\"../../colorlike.js\").ColorLike} */ (\n              instruction[1]\n            );\n          ++i;\n          break;\n        case CanvasInstruction.SET_STROKE_STYLE:\n          lastStrokeInstruction = instruction;\n          if (pendingStroke) {\n            context.stroke();\n            pendingStroke = 0;\n          }\n          this.setStrokeStyle_(context, /** @type {Array<*>} */ (instruction));\n          ++i;\n          break;\n        case CanvasInstruction.STROKE:\n          if (batchSize) {\n            pendingStroke++;\n          } else {\n            context.stroke();\n          }\n          ++i;\n          break;\n        default: // consume the instruction anyway, to avoid an infinite loop\n          ++i;\n          break;\n      }\n    }\n    if (pendingFill) {\n      this.fill_(context);\n    }\n    if (pendingStroke) {\n      context.stroke();\n    }\n    return undefined;\n  }\n\n  /**\n   * @param {CanvasRenderingContext2D} context Context.\n   * @param {number} contextScale Scale of the context.\n   * @param {import(\"../../transform.js\").Transform} transform Transform.\n   * @param {number} viewRotation View rotation.\n   * @param {boolean} snapToPixel Snap point symbols and text to integer pixels.\n   * @param {import(\"rbush\").default} [declutterTree] Declutter tree.\n   */\n  execute(\n    context,\n    contextScale,\n    transform,\n    viewRotation,\n    snapToPixel,\n    declutterTree\n  ) {\n    this.viewRotation_ = viewRotation;\n    this.execute_(\n      context,\n      contextScale,\n      transform,\n      this.instructions,\n      snapToPixel,\n      undefined,\n      undefined,\n      declutterTree\n    );\n  }\n\n  /**\n   * @param {CanvasRenderingContext2D} context Context.\n   * @param {import(\"../../transform.js\").Transform} transform Transform.\n   * @param {number} viewRotation View rotation.\n   * @param {FeatureCallback<T>} [featureCallback] Feature callback.\n   * @param {import(\"../../extent.js\").Extent} [hitExtent] Only check\n   *     features that intersect this extent.\n   * @return {T|undefined} Callback result.\n   * @template T\n   */\n  executeHitDetection(\n    context,\n    transform,\n    viewRotation,\n    featureCallback,\n    hitExtent\n  ) {\n    this.viewRotation_ = viewRotation;\n    return this.execute_(\n      context,\n      1,\n      transform,\n      this.hitDetectionInstructions,\n      true,\n      featureCallback,\n      hitExtent\n    );\n  }\n}\n\nexport default Executor;\n","/**\n * @module ol/render/canvas/ExecutorGroup\n */\n\nimport Executor from './Executor.js';\nimport {ascending} from '../../array.js';\nimport {buffer, createEmpty, extendCoordinate} from '../../extent.js';\nimport {\n  compose as composeTransform,\n  create as createTransform,\n} from '../../transform.js';\nimport {createCanvasContext2D} from '../../dom.js';\nimport {isEmpty} from '../../obj.js';\nimport {transform2D} from '../../geom/flat/transform.js';\n\n/**\n * @const\n * @type {Array<import(\"../canvas.js\").BuilderType>}\n */\nconst ORDER = ['Polygon', 'Circle', 'LineString', 'Image', 'Text', 'Default'];\n\nclass ExecutorGroup {\n  /**\n   * @param {import(\"../../extent.js\").Extent} maxExtent Max extent for clipping. When a\n   * `maxExtent` was set on the Builder for this executor group, the same `maxExtent`\n   * should be set here, unless the target context does not exceed that extent (which\n   * can be the case when rendering to tiles).\n   * @param {number} resolution Resolution.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {boolean} overlaps The executor group can have overlapping geometries.\n   * @param {!Object<string, !Object<import(\"../canvas.js\").BuilderType, import(\"../canvas.js\").SerializableInstructions>>} allInstructions\n   * The serializable instructions.\n   * @param {number} [renderBuffer] Optional rendering buffer.\n   */\n  constructor(\n    maxExtent,\n    resolution,\n    pixelRatio,\n    overlaps,\n    allInstructions,\n    renderBuffer\n  ) {\n    /**\n     * @private\n     * @type {import(\"../../extent.js\").Extent}\n     */\n    this.maxExtent_ = maxExtent;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.overlaps_ = overlaps;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.pixelRatio_ = pixelRatio;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.resolution_ = resolution;\n\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n    this.renderBuffer_ = renderBuffer;\n\n    /**\n     * @private\n     * @type {!Object<string, !Object<import(\"../canvas.js\").BuilderType, import(\"./Executor\").default>>}\n     */\n    this.executorsByZIndex_ = {};\n\n    /**\n     * @private\n     * @type {CanvasRenderingContext2D}\n     */\n    this.hitDetectionContext_ = null;\n\n    /**\n     * @private\n     * @type {import(\"../../transform.js\").Transform}\n     */\n    this.hitDetectionTransform_ = createTransform();\n\n    this.createExecutors_(allInstructions);\n  }\n\n  /**\n   * @param {CanvasRenderingContext2D} context Context.\n   * @param {import(\"../../transform.js\").Transform} transform Transform.\n   */\n  clip(context, transform) {\n    const flatClipCoords = this.getClipCoords(transform);\n    context.beginPath();\n    context.moveTo(flatClipCoords[0], flatClipCoords[1]);\n    context.lineTo(flatClipCoords[2], flatClipCoords[3]);\n    context.lineTo(flatClipCoords[4], flatClipCoords[5]);\n    context.lineTo(flatClipCoords[6], flatClipCoords[7]);\n    context.clip();\n  }\n\n  /**\n   * Create executors and populate them using the provided instructions.\n   * @private\n   * @param {!Object<string, !Object<import(\"../canvas.js\").BuilderType, import(\"../canvas.js\").SerializableInstructions>>} allInstructions The serializable instructions\n   */\n  createExecutors_(allInstructions) {\n    for (const zIndex in allInstructions) {\n      let executors = this.executorsByZIndex_[zIndex];\n      if (executors === undefined) {\n        executors = {};\n        this.executorsByZIndex_[zIndex] = executors;\n      }\n      const instructionByZindex = allInstructions[zIndex];\n      for (const builderType in instructionByZindex) {\n        const instructions = instructionByZindex[builderType];\n        executors[builderType] = new Executor(\n          this.resolution_,\n          this.pixelRatio_,\n          this.overlaps_,\n          instructions\n        );\n      }\n    }\n  }\n\n  /**\n   * @param {Array<import(\"../canvas.js\").BuilderType>} executors Executors.\n   * @return {boolean} Has executors of the provided types.\n   */\n  hasExecutors(executors) {\n    for (const zIndex in this.executorsByZIndex_) {\n      const candidates = this.executorsByZIndex_[zIndex];\n      for (let i = 0, ii = executors.length; i < ii; ++i) {\n        if (executors[i] in candidates) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  /**\n   * @param {import(\"../../coordinate.js\").Coordinate} coordinate Coordinate.\n   * @param {number} resolution Resolution.\n   * @param {number} rotation Rotation.\n   * @param {number} hitTolerance Hit tolerance in pixels.\n   * @param {function(import(\"../../Feature.js\").FeatureLike, import(\"../../geom/SimpleGeometry.js\").default, number): T} callback Feature callback.\n   * @param {Array<import(\"../../Feature.js\").FeatureLike>} declutteredFeatures Decluttered features.\n   * @return {T|undefined} Callback result.\n   * @template T\n   */\n  forEachFeatureAtCoordinate(\n    coordinate,\n    resolution,\n    rotation,\n    hitTolerance,\n    callback,\n    declutteredFeatures\n  ) {\n    hitTolerance = Math.round(hitTolerance);\n    const contextSize = hitTolerance * 2 + 1;\n    const transform = composeTransform(\n      this.hitDetectionTransform_,\n      hitTolerance + 0.5,\n      hitTolerance + 0.5,\n      1 / resolution,\n      -1 / resolution,\n      -rotation,\n      -coordinate[0],\n      -coordinate[1]\n    );\n\n    const newContext = !this.hitDetectionContext_;\n    if (newContext) {\n      this.hitDetectionContext_ = createCanvasContext2D(\n        contextSize,\n        contextSize,\n        undefined,\n        {willReadFrequently: true}\n      );\n    }\n    const context = this.hitDetectionContext_;\n\n    if (\n      context.canvas.width !== contextSize ||\n      context.canvas.height !== contextSize\n    ) {\n      context.canvas.width = contextSize;\n      context.canvas.height = contextSize;\n    } else if (!newContext) {\n      context.clearRect(0, 0, contextSize, contextSize);\n    }\n\n    /**\n     * @type {import(\"../../extent.js\").Extent}\n     */\n    let hitExtent;\n    if (this.renderBuffer_ !== undefined) {\n      hitExtent = createEmpty();\n      extendCoordinate(hitExtent, coordinate);\n      buffer(\n        hitExtent,\n        resolution * (this.renderBuffer_ + hitTolerance),\n        hitExtent\n      );\n    }\n\n    const indexes = getPixelIndexArray(hitTolerance);\n\n    let builderType;\n\n    /**\n     * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n     * @param {import(\"../../geom/SimpleGeometry.js\").default} geometry Geometry.\n     * @return {T|undefined} Callback result.\n     */\n    function featureCallback(feature, geometry) {\n      const imageData = context.getImageData(\n        0,\n        0,\n        contextSize,\n        contextSize\n      ).data;\n      for (let i = 0, ii = indexes.length; i < ii; i++) {\n        if (imageData[indexes[i]] > 0) {\n          if (\n            !declutteredFeatures ||\n            (builderType !== 'Image' && builderType !== 'Text') ||\n            declutteredFeatures.includes(feature)\n          ) {\n            const idx = (indexes[i] - 3) / 4;\n            const x = hitTolerance - (idx % contextSize);\n            const y = hitTolerance - ((idx / contextSize) | 0);\n            const result = callback(feature, geometry, x * x + y * y);\n            if (result) {\n              return result;\n            }\n          }\n          context.clearRect(0, 0, contextSize, contextSize);\n          break;\n        }\n      }\n      return undefined;\n    }\n\n    /** @type {Array<number>} */\n    const zs = Object.keys(this.executorsByZIndex_).map(Number);\n    zs.sort(ascending);\n\n    let i, j, executors, executor, result;\n    for (i = zs.length - 1; i >= 0; --i) {\n      const zIndexKey = zs[i].toString();\n      executors = this.executorsByZIndex_[zIndexKey];\n      for (j = ORDER.length - 1; j >= 0; --j) {\n        builderType = ORDER[j];\n        executor = executors[builderType];\n        if (executor !== undefined) {\n          result = executor.executeHitDetection(\n            context,\n            transform,\n            rotation,\n            featureCallback,\n            hitExtent\n          );\n          if (result) {\n            return result;\n          }\n        }\n      }\n    }\n    return undefined;\n  }\n\n  /**\n   * @param {import(\"../../transform.js\").Transform} transform Transform.\n   * @return {Array<number>|null} Clip coordinates.\n   */\n  getClipCoords(transform) {\n    const maxExtent = this.maxExtent_;\n    if (!maxExtent) {\n      return null;\n    }\n    const minX = maxExtent[0];\n    const minY = maxExtent[1];\n    const maxX = maxExtent[2];\n    const maxY = maxExtent[3];\n    const flatClipCoords = [minX, minY, minX, maxY, maxX, maxY, maxX, minY];\n    transform2D(flatClipCoords, 0, 8, 2, transform, flatClipCoords);\n    return flatClipCoords;\n  }\n\n  /**\n   * @return {boolean} Is empty.\n   */\n  isEmpty() {\n    return isEmpty(this.executorsByZIndex_);\n  }\n\n  /**\n   * @param {CanvasRenderingContext2D} context Context.\n   * @param {number} contextScale Scale of the context.\n   * @param {import(\"../../transform.js\").Transform} transform Transform.\n   * @param {number} viewRotation View rotation.\n   * @param {boolean} snapToPixel Snap point symbols and test to integer pixel.\n   * @param {Array<import(\"../canvas.js\").BuilderType>} [builderTypes] Ordered replay types to replay.\n   *     Default is {@link module:ol/render/replay~ORDER}\n   * @param {import(\"rbush\").default} [declutterTree] Declutter tree.\n   */\n  execute(\n    context,\n    contextScale,\n    transform,\n    viewRotation,\n    snapToPixel,\n    builderTypes,\n    declutterTree\n  ) {\n    /** @type {Array<number>} */\n    const zs = Object.keys(this.executorsByZIndex_).map(Number);\n    zs.sort(ascending);\n\n    // setup clipping so that the parts of over-simplified geometries are not\n    // visible outside the current extent when panning\n    if (this.maxExtent_) {\n      context.save();\n      this.clip(context, transform);\n    }\n\n    builderTypes = builderTypes ? builderTypes : ORDER;\n    let i, ii, j, jj, replays, replay;\n    if (declutterTree) {\n      zs.reverse();\n    }\n    for (i = 0, ii = zs.length; i < ii; ++i) {\n      const zIndexKey = zs[i].toString();\n      replays = this.executorsByZIndex_[zIndexKey];\n      for (j = 0, jj = builderTypes.length; j < jj; ++j) {\n        const builderType = builderTypes[j];\n        replay = replays[builderType];\n        if (replay !== undefined) {\n          replay.execute(\n            context,\n            contextScale,\n            transform,\n            viewRotation,\n            snapToPixel,\n            declutterTree\n          );\n        }\n      }\n    }\n\n    if (this.maxExtent_) {\n      context.restore();\n    }\n  }\n}\n\n/**\n * This cache is used to store arrays of indexes for calculated pixel circles\n * to increase performance.\n * It is a static property to allow each Replaygroup to access it.\n * @type {Object<number, Array<number>>}\n */\nconst circlePixelIndexArrayCache = {};\n\n/**\n * This methods creates an array with indexes of all pixels within a circle,\n * ordered by how close they are to the center.\n * A cache is used to increase performance.\n * @param {number} radius Radius.\n * @return {Array<number>} An array with indexes within a circle.\n */\nexport function getPixelIndexArray(radius) {\n  if (circlePixelIndexArrayCache[radius] !== undefined) {\n    return circlePixelIndexArrayCache[radius];\n  }\n\n  const size = radius * 2 + 1;\n  const maxDistanceSq = radius * radius;\n  const distances = new Array(maxDistanceSq + 1);\n  for (let i = 0; i <= radius; ++i) {\n    for (let j = 0; j <= radius; ++j) {\n      const distanceSq = i * i + j * j;\n      if (distanceSq > maxDistanceSq) {\n        break;\n      }\n      let distance = distances[distanceSq];\n      if (!distance) {\n        distance = [];\n        distances[distanceSq] = distance;\n      }\n      distance.push(((radius + i) * size + (radius + j)) * 4 + 3);\n      if (i > 0) {\n        distance.push(((radius - i) * size + (radius + j)) * 4 + 3);\n      }\n      if (j > 0) {\n        distance.push(((radius + i) * size + (radius - j)) * 4 + 3);\n        if (i > 0) {\n          distance.push(((radius - i) * size + (radius - j)) * 4 + 3);\n        }\n      }\n    }\n  }\n\n  const pixelIndex = [];\n  for (let i = 0, ii = distances.length; i < ii; ++i) {\n    if (distances[i]) {\n      pixelIndex.push(...distances[i]);\n    }\n  }\n\n  circlePixelIndexArrayCache[radius] = pixelIndex;\n  return pixelIndex;\n}\n\nexport default ExecutorGroup;\n","/**\n * @module ol/render/canvas/Immediate\n */\n// FIXME test, especially polygons with holes and multipolygons\n// FIXME need to handle large thick features (where pixel size matters)\n// FIXME add offset and end to ol/geom/flat/transform~transform2D?\n\nimport VectorContext from '../VectorContext.js';\nimport {asColorLike} from '../../colorlike.js';\nimport {\n  compose as composeTransform,\n  create as createTransform,\n} from '../../transform.js';\nimport {\n  defaultFillStyle,\n  defaultFont,\n  defaultLineCap,\n  defaultLineDash,\n  defaultLineDashOffset,\n  defaultLineJoin,\n  defaultLineWidth,\n  defaultMiterLimit,\n  defaultStrokeStyle,\n  defaultTextAlign,\n  defaultTextBaseline,\n} from '../canvas.js';\nimport {equals} from '../../array.js';\nimport {intersects} from '../../extent.js';\nimport {toFixed} from '../../math.js';\nimport {transform2D} from '../../geom/flat/transform.js';\nimport {transformGeom2D} from '../../geom/SimpleGeometry.js';\n\n/**\n * @classdesc\n * A concrete subclass of {@link module:ol/render/VectorContext~VectorContext} that implements\n * direct rendering of features and geometries to an HTML5 Canvas context.\n * Instances of this class are created internally by the library and\n * provided to application code as vectorContext member of the\n * {@link module:ol/render/Event~RenderEvent} object associated with postcompose, precompose and\n * render events emitted by layers and maps.\n */\nclass CanvasImmediateRenderer extends VectorContext {\n  /**\n   * @param {CanvasRenderingContext2D} context Context.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../../extent.js\").Extent} extent Extent.\n   * @param {import(\"../../transform.js\").Transform} transform Transform.\n   * @param {number} viewRotation View rotation.\n   * @param {number} [squaredTolerance] Optional squared tolerance for simplification.\n   * @param {import(\"../../proj.js\").TransformFunction} [userTransform] Transform from user to view projection.\n   */\n  constructor(\n    context,\n    pixelRatio,\n    extent,\n    transform,\n    viewRotation,\n    squaredTolerance,\n    userTransform\n  ) {\n    super();\n\n    /**\n     * @private\n     * @type {CanvasRenderingContext2D}\n     */\n    this.context_ = context;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.pixelRatio_ = pixelRatio;\n\n    /**\n     * @private\n     * @type {import(\"../../extent.js\").Extent}\n     */\n    this.extent_ = extent;\n\n    /**\n     * @private\n     * @type {import(\"../../transform.js\").Transform}\n     */\n    this.transform_ = transform;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.transformRotation_ = transform\n      ? toFixed(Math.atan2(transform[1], transform[0]), 10)\n      : 0;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.viewRotation_ = viewRotation;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.squaredTolerance_ = squaredTolerance;\n\n    /**\n     * @private\n     * @type {import(\"../../proj.js\").TransformFunction}\n     */\n    this.userTransform_ = userTransform;\n\n    /**\n     * @private\n     * @type {?import(\"../canvas.js\").FillState}\n     */\n    this.contextFillState_ = null;\n\n    /**\n     * @private\n     * @type {?import(\"../canvas.js\").StrokeState}\n     */\n    this.contextStrokeState_ = null;\n\n    /**\n     * @private\n     * @type {?import(\"../canvas.js\").TextState}\n     */\n    this.contextTextState_ = null;\n\n    /**\n     * @private\n     * @type {?import(\"../canvas.js\").FillState}\n     */\n    this.fillState_ = null;\n\n    /**\n     * @private\n     * @type {?import(\"../canvas.js\").StrokeState}\n     */\n    this.strokeState_ = null;\n\n    /**\n     * @private\n     * @type {HTMLCanvasElement|HTMLVideoElement|HTMLImageElement}\n     */\n    this.image_ = null;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.imageAnchorX_ = 0;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.imageAnchorY_ = 0;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.imageHeight_ = 0;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.imageOpacity_ = 0;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.imageOriginX_ = 0;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.imageOriginY_ = 0;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.imageRotateWithView_ = false;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.imageRotation_ = 0;\n\n    /**\n     * @private\n     * @type {import(\"../../size.js\").Size}\n     */\n    this.imageScale_ = [0, 0];\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.imageWidth_ = 0;\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.text_ = '';\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.textOffsetX_ = 0;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.textOffsetY_ = 0;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.textRotateWithView_ = false;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.textRotation_ = 0;\n\n    /**\n     * @private\n     * @type {import(\"../../size.js\").Size}\n     */\n    this.textScale_ = [0, 0];\n\n    /**\n     * @private\n     * @type {?import(\"../canvas.js\").FillState}\n     */\n    this.textFillState_ = null;\n\n    /**\n     * @private\n     * @type {?import(\"../canvas.js\").StrokeState}\n     */\n    this.textStrokeState_ = null;\n\n    /**\n     * @private\n     * @type {?import(\"../canvas.js\").TextState}\n     */\n    this.textState_ = null;\n\n    /**\n     * @private\n     * @type {Array<number>}\n     */\n    this.pixelCoordinates_ = [];\n\n    /**\n     * @private\n     * @type {import(\"../../transform.js\").Transform}\n     */\n    this.tmpLocalTransform_ = createTransform();\n  }\n\n  /**\n   * @param {Array<number>} flatCoordinates Flat coordinates.\n   * @param {number} offset Offset.\n   * @param {number} end End.\n   * @param {number} stride Stride.\n   * @private\n   */\n  drawImages_(flatCoordinates, offset, end, stride) {\n    if (!this.image_) {\n      return;\n    }\n    const pixelCoordinates = transform2D(\n      flatCoordinates,\n      offset,\n      end,\n      stride,\n      this.transform_,\n      this.pixelCoordinates_\n    );\n    const context = this.context_;\n    const localTransform = this.tmpLocalTransform_;\n    const alpha = context.globalAlpha;\n    if (this.imageOpacity_ != 1) {\n      context.globalAlpha = alpha * this.imageOpacity_;\n    }\n    let rotation = this.imageRotation_;\n    if (this.transformRotation_ === 0) {\n      rotation -= this.viewRotation_;\n    }\n    if (this.imageRotateWithView_) {\n      rotation += this.viewRotation_;\n    }\n    for (let i = 0, ii = pixelCoordinates.length; i < ii; i += 2) {\n      const x = pixelCoordinates[i] - this.imageAnchorX_;\n      const y = pixelCoordinates[i + 1] - this.imageAnchorY_;\n      if (\n        rotation !== 0 ||\n        this.imageScale_[0] != 1 ||\n        this.imageScale_[1] != 1\n      ) {\n        const centerX = x + this.imageAnchorX_;\n        const centerY = y + this.imageAnchorY_;\n        composeTransform(\n          localTransform,\n          centerX,\n          centerY,\n          1,\n          1,\n          rotation,\n          -centerX,\n          -centerY\n        );\n        context.setTransform.apply(context, localTransform);\n        context.translate(centerX, centerY);\n        context.scale(this.imageScale_[0], this.imageScale_[1]);\n        context.drawImage(\n          this.image_,\n          this.imageOriginX_,\n          this.imageOriginY_,\n          this.imageWidth_,\n          this.imageHeight_,\n          -this.imageAnchorX_,\n          -this.imageAnchorY_,\n          this.imageWidth_,\n          this.imageHeight_\n        );\n        context.setTransform(1, 0, 0, 1, 0, 0);\n      } else {\n        context.drawImage(\n          this.image_,\n          this.imageOriginX_,\n          this.imageOriginY_,\n          this.imageWidth_,\n          this.imageHeight_,\n          x,\n          y,\n          this.imageWidth_,\n          this.imageHeight_\n        );\n      }\n    }\n    if (this.imageOpacity_ != 1) {\n      context.globalAlpha = alpha;\n    }\n  }\n\n  /**\n   * @param {Array<number>} flatCoordinates Flat coordinates.\n   * @param {number} offset Offset.\n   * @param {number} end End.\n   * @param {number} stride Stride.\n   * @private\n   */\n  drawText_(flatCoordinates, offset, end, stride) {\n    if (!this.textState_ || this.text_ === '') {\n      return;\n    }\n    if (this.textFillState_) {\n      this.setContextFillState_(this.textFillState_);\n    }\n    if (this.textStrokeState_) {\n      this.setContextStrokeState_(this.textStrokeState_);\n    }\n    this.setContextTextState_(this.textState_);\n    const pixelCoordinates = transform2D(\n      flatCoordinates,\n      offset,\n      end,\n      stride,\n      this.transform_,\n      this.pixelCoordinates_\n    );\n    const context = this.context_;\n    let rotation = this.textRotation_;\n    if (this.transformRotation_ === 0) {\n      rotation -= this.viewRotation_;\n    }\n    if (this.textRotateWithView_) {\n      rotation += this.viewRotation_;\n    }\n    for (; offset < end; offset += stride) {\n      const x = pixelCoordinates[offset] + this.textOffsetX_;\n      const y = pixelCoordinates[offset + 1] + this.textOffsetY_;\n      if (\n        rotation !== 0 ||\n        this.textScale_[0] != 1 ||\n        this.textScale_[1] != 1\n      ) {\n        context.translate(x - this.textOffsetX_, y - this.textOffsetY_);\n        context.rotate(rotation);\n        context.translate(this.textOffsetX_, this.textOffsetY_);\n        context.scale(this.textScale_[0], this.textScale_[1]);\n        if (this.textStrokeState_) {\n          context.strokeText(this.text_, 0, 0);\n        }\n        if (this.textFillState_) {\n          context.fillText(this.text_, 0, 0);\n        }\n        context.setTransform(1, 0, 0, 1, 0, 0);\n      } else {\n        if (this.textStrokeState_) {\n          context.strokeText(this.text_, x, y);\n        }\n        if (this.textFillState_) {\n          context.fillText(this.text_, x, y);\n        }\n      }\n    }\n  }\n\n  /**\n   * @param {Array<number>} flatCoordinates Flat coordinates.\n   * @param {number} offset Offset.\n   * @param {number} end End.\n   * @param {number} stride Stride.\n   * @param {boolean} close Close.\n   * @private\n   * @return {number} end End.\n   */\n  moveToLineTo_(flatCoordinates, offset, end, stride, close) {\n    const context = this.context_;\n    const pixelCoordinates = transform2D(\n      flatCoordinates,\n      offset,\n      end,\n      stride,\n      this.transform_,\n      this.pixelCoordinates_\n    );\n    context.moveTo(pixelCoordinates[0], pixelCoordinates[1]);\n    let length = pixelCoordinates.length;\n    if (close) {\n      length -= 2;\n    }\n    for (let i = 2; i < length; i += 2) {\n      context.lineTo(pixelCoordinates[i], pixelCoordinates[i + 1]);\n    }\n    if (close) {\n      context.closePath();\n    }\n    return end;\n  }\n\n  /**\n   * @param {Array<number>} flatCoordinates Flat coordinates.\n   * @param {number} offset Offset.\n   * @param {Array<number>} ends Ends.\n   * @param {number} stride Stride.\n   * @private\n   * @return {number} End.\n   */\n  drawRings_(flatCoordinates, offset, ends, stride) {\n    for (let i = 0, ii = ends.length; i < ii; ++i) {\n      offset = this.moveToLineTo_(\n        flatCoordinates,\n        offset,\n        ends[i],\n        stride,\n        true\n      );\n    }\n    return offset;\n  }\n\n  /**\n   * Render a circle geometry into the canvas.  Rendering is immediate and uses\n   * the current fill and stroke styles.\n   *\n   * @param {import(\"../../geom/Circle.js\").default} geometry Circle geometry.\n   * @api\n   */\n  drawCircle(geometry) {\n    if (!intersects(this.extent_, geometry.getExtent())) {\n      return;\n    }\n    if (this.fillState_ || this.strokeState_) {\n      if (this.fillState_) {\n        this.setContextFillState_(this.fillState_);\n      }\n      if (this.strokeState_) {\n        this.setContextStrokeState_(this.strokeState_);\n      }\n      const pixelCoordinates = transformGeom2D(\n        geometry,\n        this.transform_,\n        this.pixelCoordinates_\n      );\n      const dx = pixelCoordinates[2] - pixelCoordinates[0];\n      const dy = pixelCoordinates[3] - pixelCoordinates[1];\n      const radius = Math.sqrt(dx * dx + dy * dy);\n      const context = this.context_;\n      context.beginPath();\n      context.arc(\n        pixelCoordinates[0],\n        pixelCoordinates[1],\n        radius,\n        0,\n        2 * Math.PI\n      );\n      if (this.fillState_) {\n        context.fill();\n      }\n      if (this.strokeState_) {\n        context.stroke();\n      }\n    }\n    if (this.text_ !== '') {\n      this.drawText_(geometry.getCenter(), 0, 2, 2);\n    }\n  }\n\n  /**\n   * Set the rendering style.  Note that since this is an immediate rendering API,\n   * any `zIndex` on the provided style will be ignored.\n   *\n   * @param {import(\"../../style/Style.js\").default} style The rendering style.\n   * @api\n   */\n  setStyle(style) {\n    this.setFillStrokeStyle(style.getFill(), style.getStroke());\n    this.setImageStyle(style.getImage());\n    this.setTextStyle(style.getText());\n  }\n\n  /**\n   * @param {import(\"../../transform.js\").Transform} transform Transform.\n   */\n  setTransform(transform) {\n    this.transform_ = transform;\n  }\n\n  /**\n   * Render a geometry into the canvas.  Call\n   * {@link module:ol/render/canvas/Immediate~CanvasImmediateRenderer#setStyle renderer.setStyle()} first to set the rendering style.\n   *\n   * @param {import(\"../../geom/Geometry.js\").default|import(\"../Feature.js\").default} geometry The geometry to render.\n   * @api\n   */\n  drawGeometry(geometry) {\n    const type = geometry.getType();\n    switch (type) {\n      case 'Point':\n        this.drawPoint(\n          /** @type {import(\"../../geom/Point.js\").default} */ (geometry)\n        );\n        break;\n      case 'LineString':\n        this.drawLineString(\n          /** @type {import(\"../../geom/LineString.js\").default} */ (geometry)\n        );\n        break;\n      case 'Polygon':\n        this.drawPolygon(\n          /** @type {import(\"../../geom/Polygon.js\").default} */ (geometry)\n        );\n        break;\n      case 'MultiPoint':\n        this.drawMultiPoint(\n          /** @type {import(\"../../geom/MultiPoint.js\").default} */ (geometry)\n        );\n        break;\n      case 'MultiLineString':\n        this.drawMultiLineString(\n          /** @type {import(\"../../geom/MultiLineString.js\").default} */ (\n            geometry\n          )\n        );\n        break;\n      case 'MultiPolygon':\n        this.drawMultiPolygon(\n          /** @type {import(\"../../geom/MultiPolygon.js\").default} */ (geometry)\n        );\n        break;\n      case 'GeometryCollection':\n        this.drawGeometryCollection(\n          /** @type {import(\"../../geom/GeometryCollection.js\").default} */ (\n            geometry\n          )\n        );\n        break;\n      case 'Circle':\n        this.drawCircle(\n          /** @type {import(\"../../geom/Circle.js\").default} */ (geometry)\n        );\n        break;\n      default:\n    }\n  }\n\n  /**\n   * Render a feature into the canvas.  Note that any `zIndex` on the provided\n   * style will be ignored - features are rendered immediately in the order that\n   * this method is called.  If you need `zIndex` support, you should be using an\n   * {@link module:ol/layer/Vector~VectorLayer} instead.\n   *\n   * @param {import(\"../../Feature.js\").default} feature Feature.\n   * @param {import(\"../../style/Style.js\").default} style Style.\n   * @api\n   */\n  drawFeature(feature, style) {\n    const geometry = style.getGeometryFunction()(feature);\n    if (!geometry || !intersects(this.extent_, geometry.getExtent())) {\n      return;\n    }\n    this.setStyle(style);\n    this.drawGeometry(geometry);\n  }\n\n  /**\n   * Render a GeometryCollection to the canvas.  Rendering is immediate and\n   * uses the current styles appropriate for each geometry in the collection.\n   *\n   * @param {import(\"../../geom/GeometryCollection.js\").default} geometry Geometry collection.\n   */\n  drawGeometryCollection(geometry) {\n    const geometries = geometry.getGeometriesArray();\n    for (let i = 0, ii = geometries.length; i < ii; ++i) {\n      this.drawGeometry(geometries[i]);\n    }\n  }\n\n  /**\n   * Render a Point geometry into the canvas.  Rendering is immediate and uses\n   * the current style.\n   *\n   * @param {import(\"../../geom/Point.js\").default|import(\"../Feature.js\").default} geometry Point geometry.\n   */\n  drawPoint(geometry) {\n    if (this.squaredTolerance_) {\n      geometry = /** @type {import(\"../../geom/Point.js\").default} */ (\n        geometry.simplifyTransformed(\n          this.squaredTolerance_,\n          this.userTransform_\n        )\n      );\n    }\n    const flatCoordinates = geometry.getFlatCoordinates();\n    const stride = geometry.getStride();\n    if (this.image_) {\n      this.drawImages_(flatCoordinates, 0, flatCoordinates.length, stride);\n    }\n    if (this.text_ !== '') {\n      this.drawText_(flatCoordinates, 0, flatCoordinates.length, stride);\n    }\n  }\n\n  /**\n   * Render a MultiPoint geometry  into the canvas.  Rendering is immediate and\n   * uses the current style.\n   *\n   * @param {import(\"../../geom/MultiPoint.js\").default|import(\"../Feature.js\").default} geometry MultiPoint geometry.\n   */\n  drawMultiPoint(geometry) {\n    if (this.squaredTolerance_) {\n      geometry = /** @type {import(\"../../geom/MultiPoint.js\").default} */ (\n        geometry.simplifyTransformed(\n          this.squaredTolerance_,\n          this.userTransform_\n        )\n      );\n    }\n    const flatCoordinates = geometry.getFlatCoordinates();\n    const stride = geometry.getStride();\n    if (this.image_) {\n      this.drawImages_(flatCoordinates, 0, flatCoordinates.length, stride);\n    }\n    if (this.text_ !== '') {\n      this.drawText_(flatCoordinates, 0, flatCoordinates.length, stride);\n    }\n  }\n\n  /**\n   * Render a LineString into the canvas.  Rendering is immediate and uses\n   * the current style.\n   *\n   * @param {import(\"../../geom/LineString.js\").default|import(\"../Feature.js\").default} geometry LineString geometry.\n   */\n  drawLineString(geometry) {\n    if (this.squaredTolerance_) {\n      geometry = /** @type {import(\"../../geom/LineString.js\").default} */ (\n        geometry.simplifyTransformed(\n          this.squaredTolerance_,\n          this.userTransform_\n        )\n      );\n    }\n    if (!intersects(this.extent_, geometry.getExtent())) {\n      return;\n    }\n    if (this.strokeState_) {\n      this.setContextStrokeState_(this.strokeState_);\n      const context = this.context_;\n      const flatCoordinates = geometry.getFlatCoordinates();\n      context.beginPath();\n      this.moveToLineTo_(\n        flatCoordinates,\n        0,\n        flatCoordinates.length,\n        geometry.getStride(),\n        false\n      );\n      context.stroke();\n    }\n    if (this.text_ !== '') {\n      const flatMidpoint = geometry.getFlatMidpoint();\n      this.drawText_(flatMidpoint, 0, 2, 2);\n    }\n  }\n\n  /**\n   * Render a MultiLineString geometry into the canvas.  Rendering is immediate\n   * and uses the current style.\n   *\n   * @param {import(\"../../geom/MultiLineString.js\").default|import(\"../Feature.js\").default} geometry MultiLineString geometry.\n   */\n  drawMultiLineString(geometry) {\n    if (this.squaredTolerance_) {\n      geometry =\n        /** @type {import(\"../../geom/MultiLineString.js\").default} */ (\n          geometry.simplifyTransformed(\n            this.squaredTolerance_,\n            this.userTransform_\n          )\n        );\n    }\n    const geometryExtent = geometry.getExtent();\n    if (!intersects(this.extent_, geometryExtent)) {\n      return;\n    }\n    if (this.strokeState_) {\n      this.setContextStrokeState_(this.strokeState_);\n      const context = this.context_;\n      const flatCoordinates = geometry.getFlatCoordinates();\n      let offset = 0;\n      const ends = /** @type {Array<number>} */ (geometry.getEnds());\n      const stride = geometry.getStride();\n      context.beginPath();\n      for (let i = 0, ii = ends.length; i < ii; ++i) {\n        offset = this.moveToLineTo_(\n          flatCoordinates,\n          offset,\n          ends[i],\n          stride,\n          false\n        );\n      }\n      context.stroke();\n    }\n    if (this.text_ !== '') {\n      const flatMidpoints = geometry.getFlatMidpoints();\n      this.drawText_(flatMidpoints, 0, flatMidpoints.length, 2);\n    }\n  }\n\n  /**\n   * Render a Polygon geometry into the canvas.  Rendering is immediate and uses\n   * the current style.\n   *\n   * @param {import(\"../../geom/Polygon.js\").default|import(\"../Feature.js\").default} geometry Polygon geometry.\n   */\n  drawPolygon(geometry) {\n    if (this.squaredTolerance_) {\n      geometry = /** @type {import(\"../../geom/Polygon.js\").default} */ (\n        geometry.simplifyTransformed(\n          this.squaredTolerance_,\n          this.userTransform_\n        )\n      );\n    }\n    if (!intersects(this.extent_, geometry.getExtent())) {\n      return;\n    }\n    if (this.strokeState_ || this.fillState_) {\n      if (this.fillState_) {\n        this.setContextFillState_(this.fillState_);\n      }\n      if (this.strokeState_) {\n        this.setContextStrokeState_(this.strokeState_);\n      }\n      const context = this.context_;\n      context.beginPath();\n      this.drawRings_(\n        geometry.getOrientedFlatCoordinates(),\n        0,\n        /** @type {Array<number>} */ (geometry.getEnds()),\n        geometry.getStride()\n      );\n      if (this.fillState_) {\n        context.fill();\n      }\n      if (this.strokeState_) {\n        context.stroke();\n      }\n    }\n    if (this.text_ !== '') {\n      const flatInteriorPoint = geometry.getFlatInteriorPoint();\n      this.drawText_(flatInteriorPoint, 0, 2, 2);\n    }\n  }\n\n  /**\n   * Render MultiPolygon geometry into the canvas.  Rendering is immediate and\n   * uses the current style.\n   * @param {import(\"../../geom/MultiPolygon.js\").default} geometry MultiPolygon geometry.\n   */\n  drawMultiPolygon(geometry) {\n    if (this.squaredTolerance_) {\n      geometry = /** @type {import(\"../../geom/MultiPolygon.js\").default} */ (\n        geometry.simplifyTransformed(\n          this.squaredTolerance_,\n          this.userTransform_\n        )\n      );\n    }\n    if (!intersects(this.extent_, geometry.getExtent())) {\n      return;\n    }\n    if (this.strokeState_ || this.fillState_) {\n      if (this.fillState_) {\n        this.setContextFillState_(this.fillState_);\n      }\n      if (this.strokeState_) {\n        this.setContextStrokeState_(this.strokeState_);\n      }\n      const context = this.context_;\n      const flatCoordinates = geometry.getOrientedFlatCoordinates();\n      let offset = 0;\n      const endss = geometry.getEndss();\n      const stride = geometry.getStride();\n      context.beginPath();\n      for (let i = 0, ii = endss.length; i < ii; ++i) {\n        const ends = endss[i];\n        offset = this.drawRings_(flatCoordinates, offset, ends, stride);\n      }\n      if (this.fillState_) {\n        context.fill();\n      }\n      if (this.strokeState_) {\n        context.stroke();\n      }\n    }\n    if (this.text_ !== '') {\n      const flatInteriorPoints = geometry.getFlatInteriorPoints();\n      this.drawText_(flatInteriorPoints, 0, flatInteriorPoints.length, 2);\n    }\n  }\n\n  /**\n   * @param {import(\"../canvas.js\").FillState} fillState Fill state.\n   * @private\n   */\n  setContextFillState_(fillState) {\n    const context = this.context_;\n    const contextFillState = this.contextFillState_;\n    if (!contextFillState) {\n      context.fillStyle = fillState.fillStyle;\n      this.contextFillState_ = {\n        fillStyle: fillState.fillStyle,\n      };\n    } else {\n      if (contextFillState.fillStyle != fillState.fillStyle) {\n        contextFillState.fillStyle = fillState.fillStyle;\n        context.fillStyle = fillState.fillStyle;\n      }\n    }\n  }\n\n  /**\n   * @param {import(\"../canvas.js\").StrokeState} strokeState Stroke state.\n   * @private\n   */\n  setContextStrokeState_(strokeState) {\n    const context = this.context_;\n    const contextStrokeState = this.contextStrokeState_;\n    if (!contextStrokeState) {\n      context.lineCap = strokeState.lineCap;\n      context.setLineDash(strokeState.lineDash);\n      context.lineDashOffset = strokeState.lineDashOffset;\n      context.lineJoin = strokeState.lineJoin;\n      context.lineWidth = strokeState.lineWidth;\n      context.miterLimit = strokeState.miterLimit;\n      context.strokeStyle = strokeState.strokeStyle;\n      this.contextStrokeState_ = {\n        lineCap: strokeState.lineCap,\n        lineDash: strokeState.lineDash,\n        lineDashOffset: strokeState.lineDashOffset,\n        lineJoin: strokeState.lineJoin,\n        lineWidth: strokeState.lineWidth,\n        miterLimit: strokeState.miterLimit,\n        strokeStyle: strokeState.strokeStyle,\n      };\n    } else {\n      if (contextStrokeState.lineCap != strokeState.lineCap) {\n        contextStrokeState.lineCap = strokeState.lineCap;\n        context.lineCap = strokeState.lineCap;\n      }\n      if (!equals(contextStrokeState.lineDash, strokeState.lineDash)) {\n        context.setLineDash(\n          (contextStrokeState.lineDash = strokeState.lineDash)\n        );\n      }\n      if (contextStrokeState.lineDashOffset != strokeState.lineDashOffset) {\n        contextStrokeState.lineDashOffset = strokeState.lineDashOffset;\n        context.lineDashOffset = strokeState.lineDashOffset;\n      }\n      if (contextStrokeState.lineJoin != strokeState.lineJoin) {\n        contextStrokeState.lineJoin = strokeState.lineJoin;\n        context.lineJoin = strokeState.lineJoin;\n      }\n      if (contextStrokeState.lineWidth != strokeState.lineWidth) {\n        contextStrokeState.lineWidth = strokeState.lineWidth;\n        context.lineWidth = strokeState.lineWidth;\n      }\n      if (contextStrokeState.miterLimit != strokeState.miterLimit) {\n        contextStrokeState.miterLimit = strokeState.miterLimit;\n        context.miterLimit = strokeState.miterLimit;\n      }\n      if (contextStrokeState.strokeStyle != strokeState.strokeStyle) {\n        contextStrokeState.strokeStyle = strokeState.strokeStyle;\n        context.strokeStyle = strokeState.strokeStyle;\n      }\n    }\n  }\n\n  /**\n   * @param {import(\"../canvas.js\").TextState} textState Text state.\n   * @private\n   */\n  setContextTextState_(textState) {\n    const context = this.context_;\n    const contextTextState = this.contextTextState_;\n    const textAlign = textState.textAlign\n      ? textState.textAlign\n      : defaultTextAlign;\n    if (!contextTextState) {\n      context.font = textState.font;\n      context.textAlign = textAlign;\n      context.textBaseline = textState.textBaseline;\n      this.contextTextState_ = {\n        font: textState.font,\n        textAlign: textAlign,\n        textBaseline: textState.textBaseline,\n      };\n    } else {\n      if (contextTextState.font != textState.font) {\n        contextTextState.font = textState.font;\n        context.font = textState.font;\n      }\n      if (contextTextState.textAlign != textAlign) {\n        contextTextState.textAlign = textAlign;\n        context.textAlign = textAlign;\n      }\n      if (contextTextState.textBaseline != textState.textBaseline) {\n        contextTextState.textBaseline = textState.textBaseline;\n        context.textBaseline = textState.textBaseline;\n      }\n    }\n  }\n\n  /**\n   * Set the fill and stroke style for subsequent draw operations.  To clear\n   * either fill or stroke styles, pass null for the appropriate parameter.\n   *\n   * @param {import(\"../../style/Fill.js\").default} fillStyle Fill style.\n   * @param {import(\"../../style/Stroke.js\").default} strokeStyle Stroke style.\n   */\n  setFillStrokeStyle(fillStyle, strokeStyle) {\n    if (!fillStyle) {\n      this.fillState_ = null;\n    } else {\n      const fillStyleColor = fillStyle.getColor();\n      this.fillState_ = {\n        fillStyle: asColorLike(\n          fillStyleColor ? fillStyleColor : defaultFillStyle\n        ),\n      };\n    }\n    if (!strokeStyle) {\n      this.strokeState_ = null;\n    } else {\n      const strokeStyleColor = strokeStyle.getColor();\n      const strokeStyleLineCap = strokeStyle.getLineCap();\n      const strokeStyleLineDash = strokeStyle.getLineDash();\n      const strokeStyleLineDashOffset = strokeStyle.getLineDashOffset();\n      const strokeStyleLineJoin = strokeStyle.getLineJoin();\n      const strokeStyleWidth = strokeStyle.getWidth();\n      const strokeStyleMiterLimit = strokeStyle.getMiterLimit();\n      const lineDash = strokeStyleLineDash\n        ? strokeStyleLineDash\n        : defaultLineDash;\n      this.strokeState_ = {\n        lineCap:\n          strokeStyleLineCap !== undefined\n            ? strokeStyleLineCap\n            : defaultLineCap,\n        lineDash:\n          this.pixelRatio_ === 1\n            ? lineDash\n            : lineDash.map((n) => n * this.pixelRatio_),\n        lineDashOffset:\n          (strokeStyleLineDashOffset\n            ? strokeStyleLineDashOffset\n            : defaultLineDashOffset) * this.pixelRatio_,\n        lineJoin:\n          strokeStyleLineJoin !== undefined\n            ? strokeStyleLineJoin\n            : defaultLineJoin,\n        lineWidth:\n          (strokeStyleWidth !== undefined\n            ? strokeStyleWidth\n            : defaultLineWidth) * this.pixelRatio_,\n        miterLimit:\n          strokeStyleMiterLimit !== undefined\n            ? strokeStyleMiterLimit\n            : defaultMiterLimit,\n        strokeStyle: asColorLike(\n          strokeStyleColor ? strokeStyleColor : defaultStrokeStyle\n        ),\n      };\n    }\n  }\n\n  /**\n   * Set the image style for subsequent draw operations.  Pass null to remove\n   * the image style.\n   *\n   * @param {import(\"../../style/Image.js\").default} imageStyle Image style.\n   */\n  setImageStyle(imageStyle) {\n    let imageSize;\n    if (!imageStyle || !(imageSize = imageStyle.getSize())) {\n      this.image_ = null;\n      return;\n    }\n    const imagePixelRatio = imageStyle.getPixelRatio(this.pixelRatio_);\n    const imageAnchor = imageStyle.getAnchor();\n    const imageOrigin = imageStyle.getOrigin();\n    this.image_ = imageStyle.getImage(this.pixelRatio_);\n    this.imageAnchorX_ = imageAnchor[0] * imagePixelRatio;\n    this.imageAnchorY_ = imageAnchor[1] * imagePixelRatio;\n    this.imageHeight_ = imageSize[1] * imagePixelRatio;\n    this.imageOpacity_ = imageStyle.getOpacity();\n    this.imageOriginX_ = imageOrigin[0];\n    this.imageOriginY_ = imageOrigin[1];\n    this.imageRotateWithView_ = imageStyle.getRotateWithView();\n    this.imageRotation_ = imageStyle.getRotation();\n    const imageScale = imageStyle.getScaleArray();\n    this.imageScale_ = [\n      (imageScale[0] * this.pixelRatio_) / imagePixelRatio,\n      (imageScale[1] * this.pixelRatio_) / imagePixelRatio,\n    ];\n    this.imageWidth_ = imageSize[0] * imagePixelRatio;\n  }\n\n  /**\n   * Set the text style for subsequent draw operations.  Pass null to\n   * remove the text style.\n   *\n   * @param {import(\"../../style/Text.js\").default} textStyle Text style.\n   */\n  setTextStyle(textStyle) {\n    if (!textStyle) {\n      this.text_ = '';\n    } else {\n      const textFillStyle = textStyle.getFill();\n      if (!textFillStyle) {\n        this.textFillState_ = null;\n      } else {\n        const textFillStyleColor = textFillStyle.getColor();\n        this.textFillState_ = {\n          fillStyle: asColorLike(\n            textFillStyleColor ? textFillStyleColor : defaultFillStyle\n          ),\n        };\n      }\n      const textStrokeStyle = textStyle.getStroke();\n      if (!textStrokeStyle) {\n        this.textStrokeState_ = null;\n      } else {\n        const textStrokeStyleColor = textStrokeStyle.getColor();\n        const textStrokeStyleLineCap = textStrokeStyle.getLineCap();\n        const textStrokeStyleLineDash = textStrokeStyle.getLineDash();\n        const textStrokeStyleLineDashOffset =\n          textStrokeStyle.getLineDashOffset();\n        const textStrokeStyleLineJoin = textStrokeStyle.getLineJoin();\n        const textStrokeStyleWidth = textStrokeStyle.getWidth();\n        const textStrokeStyleMiterLimit = textStrokeStyle.getMiterLimit();\n        this.textStrokeState_ = {\n          lineCap:\n            textStrokeStyleLineCap !== undefined\n              ? textStrokeStyleLineCap\n              : defaultLineCap,\n          lineDash: textStrokeStyleLineDash\n            ? textStrokeStyleLineDash\n            : defaultLineDash,\n          lineDashOffset: textStrokeStyleLineDashOffset\n            ? textStrokeStyleLineDashOffset\n            : defaultLineDashOffset,\n          lineJoin:\n            textStrokeStyleLineJoin !== undefined\n              ? textStrokeStyleLineJoin\n              : defaultLineJoin,\n          lineWidth:\n            textStrokeStyleWidth !== undefined\n              ? textStrokeStyleWidth\n              : defaultLineWidth,\n          miterLimit:\n            textStrokeStyleMiterLimit !== undefined\n              ? textStrokeStyleMiterLimit\n              : defaultMiterLimit,\n          strokeStyle: asColorLike(\n            textStrokeStyleColor ? textStrokeStyleColor : defaultStrokeStyle\n          ),\n        };\n      }\n      const textFont = textStyle.getFont();\n      const textOffsetX = textStyle.getOffsetX();\n      const textOffsetY = textStyle.getOffsetY();\n      const textRotateWithView = textStyle.getRotateWithView();\n      const textRotation = textStyle.getRotation();\n      const textScale = textStyle.getScaleArray();\n      const textText = textStyle.getText();\n      const textTextAlign = textStyle.getTextAlign();\n      const textTextBaseline = textStyle.getTextBaseline();\n      this.textState_ = {\n        font: textFont !== undefined ? textFont : defaultFont,\n        textAlign:\n          textTextAlign !== undefined ? textTextAlign : defaultTextAlign,\n        textBaseline:\n          textTextBaseline !== undefined\n            ? textTextBaseline\n            : defaultTextBaseline,\n      };\n      this.text_ =\n        textText !== undefined\n          ? Array.isArray(textText)\n            ? textText.reduce((acc, t, i) => (acc += i % 2 ? ' ' : t), '')\n            : textText\n          : '';\n      this.textOffsetX_ =\n        textOffsetX !== undefined ? this.pixelRatio_ * textOffsetX : 0;\n      this.textOffsetY_ =\n        textOffsetY !== undefined ? this.pixelRatio_ * textOffsetY : 0;\n      this.textRotateWithView_ =\n        textRotateWithView !== undefined ? textRotateWithView : false;\n      this.textRotation_ = textRotation !== undefined ? textRotation : 0;\n      this.textScale_ = [\n        this.pixelRatio_ * textScale[0],\n        this.pixelRatio_ * textScale[1],\n      ];\n    }\n  }\n}\n\nexport default CanvasImmediateRenderer;\n","/**\n * @module ol/render/canvas/hitdetect\n */\n\nimport CanvasImmediateRenderer from './Immediate.js';\nimport {Icon} from '../../style.js';\nimport {ascending} from '../../array.js';\nimport {clamp} from '../../math.js';\nimport {createCanvasContext2D} from '../../dom.js';\nimport {intersects} from '../../extent.js';\n\nexport const HIT_DETECT_RESOLUTION = 0.5;\n\n/**\n * @param {import(\"../../size.js\").Size} size Canvas size in css pixels.\n * @param {Array<import(\"../../transform.js\").Transform>} transforms Transforms\n * for rendering features to all worlds of the viewport, from coordinates to css\n * pixels.\n * @param {Array<import(\"../../Feature.js\").FeatureLike>} features\n * Features to consider for hit detection.\n * @param {import(\"../../style/Style.js\").StyleFunction|undefined} styleFunction\n * Layer style function.\n * @param {import(\"../../extent.js\").Extent} extent Extent.\n * @param {number} resolution Resolution.\n * @param {number} rotation Rotation.\n * @return {ImageData} Hit detection image data.\n */\nexport function createHitDetectionImageData(\n  size,\n  transforms,\n  features,\n  styleFunction,\n  extent,\n  resolution,\n  rotation\n) {\n  const width = size[0] * HIT_DETECT_RESOLUTION;\n  const height = size[1] * HIT_DETECT_RESOLUTION;\n  const context = createCanvasContext2D(width, height);\n  context.imageSmoothingEnabled = false;\n  const canvas = context.canvas;\n  const renderer = new CanvasImmediateRenderer(\n    context,\n    HIT_DETECT_RESOLUTION,\n    extent,\n    null,\n    rotation\n  );\n  const featureCount = features.length;\n  // Stretch hit detection index to use the whole available color range\n  const indexFactor = Math.floor((256 * 256 * 256 - 1) / featureCount);\n  const featuresByZIndex = {};\n  for (let i = 1; i <= featureCount; ++i) {\n    const feature = features[i - 1];\n    const featureStyleFunction = feature.getStyleFunction() || styleFunction;\n    if (!styleFunction) {\n      continue;\n    }\n    let styles = featureStyleFunction(feature, resolution);\n    if (!styles) {\n      continue;\n    }\n    if (!Array.isArray(styles)) {\n      styles = [styles];\n    }\n    const index = i * indexFactor;\n    const color = index.toString(16).padStart(7, '#00000');\n    for (let j = 0, jj = styles.length; j < jj; ++j) {\n      const originalStyle = styles[j];\n      const geometry = originalStyle.getGeometryFunction()(feature);\n      if (!geometry || !intersects(extent, geometry.getExtent())) {\n        continue;\n      }\n      const style = originalStyle.clone();\n      const fill = style.getFill();\n      if (fill) {\n        fill.setColor(color);\n      }\n      const stroke = style.getStroke();\n      if (stroke) {\n        stroke.setColor(color);\n        stroke.setLineDash(null);\n      }\n      style.setText(undefined);\n      const image = originalStyle.getImage();\n      if (image && image.getOpacity() !== 0) {\n        const imgSize = image.getImageSize();\n        if (!imgSize) {\n          continue;\n        }\n\n        const imgContext = createCanvasContext2D(\n          imgSize[0],\n          imgSize[1],\n          undefined,\n          {alpha: false}\n        );\n        const img = imgContext.canvas;\n        imgContext.fillStyle = color;\n        imgContext.fillRect(0, 0, img.width, img.height);\n        style.setImage(\n          new Icon({\n            img: img,\n            imgSize: imgSize,\n            anchor: image.getAnchor(),\n            anchorXUnits: 'pixels',\n            anchorYUnits: 'pixels',\n            offset: image.getOrigin(),\n            opacity: 1,\n            size: image.getSize(),\n            scale: image.getScale(),\n            rotation: image.getRotation(),\n            rotateWithView: image.getRotateWithView(),\n          })\n        );\n      }\n      const zIndex = style.getZIndex() || 0;\n      let byGeometryType = featuresByZIndex[zIndex];\n      if (!byGeometryType) {\n        byGeometryType = {};\n        featuresByZIndex[zIndex] = byGeometryType;\n        byGeometryType['Polygon'] = [];\n        byGeometryType['Circle'] = [];\n        byGeometryType['LineString'] = [];\n        byGeometryType['Point'] = [];\n      }\n      const type = geometry.getType();\n      if (type === 'GeometryCollection') {\n        const geometries =\n          /** @type {import(\"../../geom/GeometryCollection.js\").default} */ (\n            geometry\n          ).getGeometriesArrayRecursive();\n        for (let i = 0, ii = geometries.length; i < ii; ++i) {\n          const geometry = geometries[i];\n          byGeometryType[geometry.getType().replace('Multi', '')].push(\n            geometry,\n            style\n          );\n        }\n      } else {\n        byGeometryType[type.replace('Multi', '')].push(geometry, style);\n      }\n    }\n  }\n\n  const zIndexKeys = Object.keys(featuresByZIndex).map(Number).sort(ascending);\n  for (let i = 0, ii = zIndexKeys.length; i < ii; ++i) {\n    const byGeometryType = featuresByZIndex[zIndexKeys[i]];\n    for (const type in byGeometryType) {\n      const geomAndStyle = byGeometryType[type];\n      for (let j = 0, jj = geomAndStyle.length; j < jj; j += 2) {\n        renderer.setStyle(geomAndStyle[j + 1]);\n        for (let k = 0, kk = transforms.length; k < kk; ++k) {\n          renderer.setTransform(transforms[k]);\n          renderer.drawGeometry(geomAndStyle[j]);\n        }\n      }\n    }\n  }\n  return context.getImageData(0, 0, canvas.width, canvas.height);\n}\n\n/**\n * @param {import(\"../../pixel\").Pixel} pixel Pixel coordinate on the hit\n * detection canvas in css pixels.\n * @param {Array<F>} features Features. Has to\n * match the `features` array that was passed to `createHitDetectionImageData()`.\n * @param {ImageData} imageData Hit detection image data generated by\n * `createHitDetectionImageData()`.\n * @return {Array<F>} Features.\n * @template {import(\"../../Feature.js\").FeatureLike} F\n */\nexport function hitDetect(pixel, features, imageData) {\n  const resultFeatures = [];\n  if (imageData) {\n    const x = Math.floor(Math.round(pixel[0]) * HIT_DETECT_RESOLUTION);\n    const y = Math.floor(Math.round(pixel[1]) * HIT_DETECT_RESOLUTION);\n    // The pixel coordinate is clamped down to the hit-detect canvas' size to account\n    // for browsers returning coordinates slightly larger than the actual canvas size\n    // due to a non-integer pixel ratio.\n    const index =\n      (clamp(x, 0, imageData.width - 1) +\n        clamp(y, 0, imageData.height - 1) * imageData.width) *\n      4;\n    const r = imageData.data[index];\n    const g = imageData.data[index + 1];\n    const b = imageData.data[index + 2];\n    const i = b + 256 * (g + 256 * r);\n    const indexFactor = Math.floor((256 * 256 * 256 - 1) / features.length);\n    if (i && i % indexFactor === 0) {\n      resultFeatures.push(features[i / indexFactor - 1]);\n    }\n  }\n  // @ts-ignore Features are copied from `features` to `resultFeatures` so the type should be the same\n  return resultFeatures;\n}\n","/**\n * @module ol/renderer/vector\n */\nimport ImageState from '../ImageState.js';\nimport {getUid} from '../util.js';\n\n/**\n * Feature callback. The callback will be called with three arguments. The first\n * argument is one {@link module:ol/Feature~Feature feature} or {@link module:ol/render/Feature~RenderFeature render feature}\n * at the pixel, the second is the {@link module:ol/layer/Layer~Layer layer} of the feature and will be null for\n * unmanaged layers. The third is the {@link module:ol/geom/SimpleGeometry~SimpleGeometry} of the feature. For features\n * with a GeometryCollection geometry, it will be the first detected geometry from the collection.\n * @template T\n * @typedef {function(import(\"../Feature.js\").FeatureLike, import(\"../layer/Layer.js\").default<import(\"../source/Source\").default>, import(\"../geom/SimpleGeometry.js\").default): T} FeatureCallback\n */\n\n/**\n * Tolerance for geometry simplification in device pixels.\n * @type {number}\n */\nconst SIMPLIFY_TOLERANCE = 0.5;\n\n/**\n * @const\n * @type {Object<import(\"../geom/Geometry.js\").Type,\n *                function(import(\"../render/canvas/BuilderGroup.js\").default, import(\"../geom/Geometry.js\").default,\n *                         import(\"../style/Style.js\").default, Object): void>}\n */\nconst GEOMETRY_RENDERERS = {\n  'Point': renderPointGeometry,\n  'LineString': renderLineStringGeometry,\n  'Polygon': renderPolygonGeometry,\n  'MultiPoint': renderMultiPointGeometry,\n  'MultiLineString': renderMultiLineStringGeometry,\n  'MultiPolygon': renderMultiPolygonGeometry,\n  'GeometryCollection': renderGeometryCollectionGeometry,\n  'Circle': renderCircleGeometry,\n};\n\n/**\n * @param {import(\"../Feature.js\").FeatureLike} feature1 Feature 1.\n * @param {import(\"../Feature.js\").FeatureLike} feature2 Feature 2.\n * @return {number} Order.\n */\nexport function defaultOrder(feature1, feature2) {\n  return parseInt(getUid(feature1), 10) - parseInt(getUid(feature2), 10);\n}\n\n/**\n * @param {number} resolution Resolution.\n * @param {number} pixelRatio Pixel ratio.\n * @return {number} Squared pixel tolerance.\n */\nexport function getSquaredTolerance(resolution, pixelRatio) {\n  const tolerance = getTolerance(resolution, pixelRatio);\n  return tolerance * tolerance;\n}\n\n/**\n * @param {number} resolution Resolution.\n * @param {number} pixelRatio Pixel ratio.\n * @return {number} Pixel tolerance.\n */\nexport function getTolerance(resolution, pixelRatio) {\n  return (SIMPLIFY_TOLERANCE * resolution) / pixelRatio;\n}\n\n/**\n * @param {import(\"../render/canvas/BuilderGroup.js\").default} builderGroup Builder group.\n * @param {import(\"../geom/Circle.js\").default} geometry Geometry.\n * @param {import(\"../style/Style.js\").default} style Style.\n * @param {import(\"../Feature.js\").default} feature Feature.\n * @param {import(\"../render/canvas/BuilderGroup.js\").default} [declutterBuilderGroup] Builder for decluttering.\n */\nfunction renderCircleGeometry(\n  builderGroup,\n  geometry,\n  style,\n  feature,\n  declutterBuilderGroup\n) {\n  const fillStyle = style.getFill();\n  const strokeStyle = style.getStroke();\n  if (fillStyle || strokeStyle) {\n    const circleReplay = builderGroup.getBuilder(style.getZIndex(), 'Circle');\n    circleReplay.setFillStrokeStyle(fillStyle, strokeStyle);\n    circleReplay.drawCircle(geometry, feature);\n  }\n  const textStyle = style.getText();\n  if (textStyle && textStyle.getText()) {\n    const textReplay = (declutterBuilderGroup || builderGroup).getBuilder(\n      style.getZIndex(),\n      'Text'\n    );\n    textReplay.setTextStyle(textStyle);\n    textReplay.drawText(geometry, feature);\n  }\n}\n\n/**\n * @param {import(\"../render/canvas/BuilderGroup.js\").default} replayGroup Replay group.\n * @param {import(\"../Feature.js\").FeatureLike} feature Feature.\n * @param {import(\"../style/Style.js\").default} style Style.\n * @param {number} squaredTolerance Squared tolerance.\n * @param {function(import(\"../events/Event.js\").default): void} listener Listener function.\n * @param {import(\"../proj.js\").TransformFunction} [transform] Transform from user to view projection.\n * @param {import(\"../render/canvas/BuilderGroup.js\").default} [declutterBuilderGroup] Builder for decluttering.\n * @return {boolean} `true` if style is loading.\n */\nexport function renderFeature(\n  replayGroup,\n  feature,\n  style,\n  squaredTolerance,\n  listener,\n  transform,\n  declutterBuilderGroup\n) {\n  let loading = false;\n  const imageStyle = style.getImage();\n  if (imageStyle) {\n    const imageState = imageStyle.getImageState();\n    if (imageState == ImageState.LOADED || imageState == ImageState.ERROR) {\n      imageStyle.unlistenImageChange(listener);\n    } else {\n      if (imageState == ImageState.IDLE) {\n        imageStyle.load();\n      }\n      imageStyle.listenImageChange(listener);\n      loading = true;\n    }\n  }\n  renderFeatureInternal(\n    replayGroup,\n    feature,\n    style,\n    squaredTolerance,\n    transform,\n    declutterBuilderGroup\n  );\n\n  return loading;\n}\n\n/**\n * @param {import(\"../render/canvas/BuilderGroup.js\").default} replayGroup Replay group.\n * @param {import(\"../Feature.js\").FeatureLike} feature Feature.\n * @param {import(\"../style/Style.js\").default} style Style.\n * @param {number} squaredTolerance Squared tolerance.\n * @param {import(\"../proj.js\").TransformFunction} [transform] Optional transform function.\n * @param {import(\"../render/canvas/BuilderGroup.js\").default} [declutterBuilderGroup] Builder for decluttering.\n */\nfunction renderFeatureInternal(\n  replayGroup,\n  feature,\n  style,\n  squaredTolerance,\n  transform,\n  declutterBuilderGroup\n) {\n  const geometry = style.getGeometryFunction()(feature);\n  if (!geometry) {\n    return;\n  }\n  const simplifiedGeometry = geometry.simplifyTransformed(\n    squaredTolerance,\n    transform\n  );\n  const renderer = style.getRenderer();\n  if (renderer) {\n    renderGeometry(replayGroup, simplifiedGeometry, style, feature);\n  } else {\n    const geometryRenderer = GEOMETRY_RENDERERS[simplifiedGeometry.getType()];\n    geometryRenderer(\n      replayGroup,\n      simplifiedGeometry,\n      style,\n      feature,\n      declutterBuilderGroup\n    );\n  }\n}\n\n/**\n * @param {import(\"../render/canvas/BuilderGroup.js\").default} replayGroup Replay group.\n * @param {import(\"../geom/Geometry.js\").default|import(\"../render/Feature.js\").default} geometry Geometry.\n * @param {import(\"../style/Style.js\").default} style Style.\n * @param {import(\"../Feature.js\").FeatureLike} feature Feature.\n */\nfunction renderGeometry(replayGroup, geometry, style, feature) {\n  if (geometry.getType() == 'GeometryCollection') {\n    const geometries =\n      /** @type {import(\"../geom/GeometryCollection.js\").default} */ (\n        geometry\n      ).getGeometries();\n    for (let i = 0, ii = geometries.length; i < ii; ++i) {\n      renderGeometry(replayGroup, geometries[i], style, feature);\n    }\n    return;\n  }\n  const replay = replayGroup.getBuilder(style.getZIndex(), 'Default');\n  replay.drawCustom(\n    /** @type {import(\"../geom/SimpleGeometry.js\").default} */ (geometry),\n    feature,\n    style.getRenderer(),\n    style.getHitDetectionRenderer()\n  );\n}\n\n/**\n * @param {import(\"../render/canvas/BuilderGroup.js\").default} replayGroup Replay group.\n * @param {import(\"../geom/GeometryCollection.js\").default} geometry Geometry.\n * @param {import(\"../style/Style.js\").default} style Style.\n * @param {import(\"../Feature.js\").default} feature Feature.\n * @param {import(\"../render/canvas/BuilderGroup.js\").default} [declutterBuilderGroup] Builder for decluttering.\n */\nfunction renderGeometryCollectionGeometry(\n  replayGroup,\n  geometry,\n  style,\n  feature,\n  declutterBuilderGroup\n) {\n  const geometries = geometry.getGeometriesArray();\n  let i, ii;\n  for (i = 0, ii = geometries.length; i < ii; ++i) {\n    const geometryRenderer = GEOMETRY_RENDERERS[geometries[i].getType()];\n    geometryRenderer(\n      replayGroup,\n      geometries[i],\n      style,\n      feature,\n      declutterBuilderGroup\n    );\n  }\n}\n\n/**\n * @param {import(\"../render/canvas/BuilderGroup.js\").default} builderGroup Replay group.\n * @param {import(\"../geom/LineString.js\").default|import(\"../render/Feature.js\").default} geometry Geometry.\n * @param {import(\"../style/Style.js\").default} style Style.\n * @param {import(\"../Feature.js\").FeatureLike} feature Feature.\n * @param {import(\"../render/canvas/BuilderGroup.js\").default} [declutterBuilderGroup] Builder for decluttering.\n */\nfunction renderLineStringGeometry(\n  builderGroup,\n  geometry,\n  style,\n  feature,\n  declutterBuilderGroup\n) {\n  const strokeStyle = style.getStroke();\n  if (strokeStyle) {\n    const lineStringReplay = builderGroup.getBuilder(\n      style.getZIndex(),\n      'LineString'\n    );\n    lineStringReplay.setFillStrokeStyle(null, strokeStyle);\n    lineStringReplay.drawLineString(geometry, feature);\n  }\n  const textStyle = style.getText();\n  if (textStyle && textStyle.getText()) {\n    const textReplay = (declutterBuilderGroup || builderGroup).getBuilder(\n      style.getZIndex(),\n      'Text'\n    );\n    textReplay.setTextStyle(textStyle);\n    textReplay.drawText(geometry, feature);\n  }\n}\n\n/**\n * @param {import(\"../render/canvas/BuilderGroup.js\").default} builderGroup Replay group.\n * @param {import(\"../geom/MultiLineString.js\").default|import(\"../render/Feature.js\").default} geometry Geometry.\n * @param {import(\"../style/Style.js\").default} style Style.\n * @param {import(\"../Feature.js\").FeatureLike} feature Feature.\n * @param {import(\"../render/canvas/BuilderGroup.js\").default} [declutterBuilderGroup] Builder for decluttering.\n */\nfunction renderMultiLineStringGeometry(\n  builderGroup,\n  geometry,\n  style,\n  feature,\n  declutterBuilderGroup\n) {\n  const strokeStyle = style.getStroke();\n  if (strokeStyle) {\n    const lineStringReplay = builderGroup.getBuilder(\n      style.getZIndex(),\n      'LineString'\n    );\n    lineStringReplay.setFillStrokeStyle(null, strokeStyle);\n    lineStringReplay.drawMultiLineString(geometry, feature);\n  }\n  const textStyle = style.getText();\n  if (textStyle && textStyle.getText()) {\n    const textReplay = (declutterBuilderGroup || builderGroup).getBuilder(\n      style.getZIndex(),\n      'Text'\n    );\n    textReplay.setTextStyle(textStyle);\n    textReplay.drawText(geometry, feature);\n  }\n}\n\n/**\n * @param {import(\"../render/canvas/BuilderGroup.js\").default} builderGroup Replay group.\n * @param {import(\"../geom/MultiPolygon.js\").default} geometry Geometry.\n * @param {import(\"../style/Style.js\").default} style Style.\n * @param {import(\"../Feature.js\").default} feature Feature.\n * @param {import(\"../render/canvas/BuilderGroup.js\").default} [declutterBuilderGroup] Builder for decluttering.\n */\nfunction renderMultiPolygonGeometry(\n  builderGroup,\n  geometry,\n  style,\n  feature,\n  declutterBuilderGroup\n) {\n  const fillStyle = style.getFill();\n  const strokeStyle = style.getStroke();\n  if (strokeStyle || fillStyle) {\n    const polygonReplay = builderGroup.getBuilder(style.getZIndex(), 'Polygon');\n    polygonReplay.setFillStrokeStyle(fillStyle, strokeStyle);\n    polygonReplay.drawMultiPolygon(geometry, feature);\n  }\n  const textStyle = style.getText();\n  if (textStyle && textStyle.getText()) {\n    const textReplay = (declutterBuilderGroup || builderGroup).getBuilder(\n      style.getZIndex(),\n      'Text'\n    );\n    textReplay.setTextStyle(textStyle);\n    textReplay.drawText(geometry, feature);\n  }\n}\n\n/**\n * @param {import(\"../render/canvas/BuilderGroup.js\").default} builderGroup Replay group.\n * @param {import(\"../geom/Point.js\").default|import(\"../render/Feature.js\").default} geometry Geometry.\n * @param {import(\"../style/Style.js\").default} style Style.\n * @param {import(\"../Feature.js\").FeatureLike} feature Feature.\n * @param {import(\"../render/canvas/BuilderGroup.js\").default} [declutterBuilderGroup] Builder for decluttering.\n */\nfunction renderPointGeometry(\n  builderGroup,\n  geometry,\n  style,\n  feature,\n  declutterBuilderGroup\n) {\n  const imageStyle = style.getImage();\n  const textStyle = style.getText();\n  /** @type {import(\"../render/canvas.js\").DeclutterImageWithText} */\n  let declutterImageWithText;\n  if (imageStyle) {\n    if (imageStyle.getImageState() != ImageState.LOADED) {\n      return;\n    }\n    let imageBuilderGroup = builderGroup;\n    if (declutterBuilderGroup) {\n      const declutterMode = imageStyle.getDeclutterMode();\n      if (declutterMode !== 'none') {\n        imageBuilderGroup = declutterBuilderGroup;\n        if (declutterMode === 'obstacle') {\n          // draw in non-declutter group:\n          const imageReplay = builderGroup.getBuilder(\n            style.getZIndex(),\n            'Image'\n          );\n          imageReplay.setImageStyle(imageStyle, declutterImageWithText);\n          imageReplay.drawPoint(geometry, feature);\n        } else if (textStyle && textStyle.getText()) {\n          declutterImageWithText = {};\n        }\n      }\n    }\n    const imageReplay = imageBuilderGroup.getBuilder(\n      style.getZIndex(),\n      'Image'\n    );\n    imageReplay.setImageStyle(imageStyle, declutterImageWithText);\n    imageReplay.drawPoint(geometry, feature);\n  }\n  if (textStyle && textStyle.getText()) {\n    let textBuilderGroup = builderGroup;\n    if (declutterBuilderGroup) {\n      textBuilderGroup = declutterBuilderGroup;\n    }\n    const textReplay = textBuilderGroup.getBuilder(style.getZIndex(), 'Text');\n    textReplay.setTextStyle(textStyle, declutterImageWithText);\n    textReplay.drawText(geometry, feature);\n  }\n}\n\n/**\n * @param {import(\"../render/canvas/BuilderGroup.js\").default} builderGroup Replay group.\n * @param {import(\"../geom/MultiPoint.js\").default|import(\"../render/Feature.js\").default} geometry Geometry.\n * @param {import(\"../style/Style.js\").default} style Style.\n * @param {import(\"../Feature.js\").FeatureLike} feature Feature.\n * @param {import(\"../render/canvas/BuilderGroup.js\").default} [declutterBuilderGroup] Builder for decluttering.\n */\nfunction renderMultiPointGeometry(\n  builderGroup,\n  geometry,\n  style,\n  feature,\n  declutterBuilderGroup\n) {\n  const imageStyle = style.getImage();\n  const textStyle = style.getText();\n  /** @type {import(\"../render/canvas.js\").DeclutterImageWithText} */\n  let declutterImageWithText;\n  if (imageStyle) {\n    if (imageStyle.getImageState() != ImageState.LOADED) {\n      return;\n    }\n    let imageBuilderGroup = builderGroup;\n    if (declutterBuilderGroup) {\n      const declutterMode = imageStyle.getDeclutterMode();\n      if (declutterMode !== 'none') {\n        imageBuilderGroup = declutterBuilderGroup;\n        if (declutterMode === 'obstacle') {\n          // draw in non-declutter group:\n          const imageReplay = builderGroup.getBuilder(\n            style.getZIndex(),\n            'Image'\n          );\n          imageReplay.setImageStyle(imageStyle, declutterImageWithText);\n          imageReplay.drawMultiPoint(geometry, feature);\n        } else if (textStyle && textStyle.getText()) {\n          declutterImageWithText = {};\n        }\n      }\n    }\n    const imageReplay = imageBuilderGroup.getBuilder(\n      style.getZIndex(),\n      'Image'\n    );\n    imageReplay.setImageStyle(imageStyle, declutterImageWithText);\n    imageReplay.drawMultiPoint(geometry, feature);\n  }\n  if (textStyle && textStyle.getText()) {\n    let textBuilderGroup = builderGroup;\n    if (declutterBuilderGroup) {\n      textBuilderGroup = declutterBuilderGroup;\n    }\n    const textReplay = textBuilderGroup.getBuilder(style.getZIndex(), 'Text');\n    textReplay.setTextStyle(textStyle, declutterImageWithText);\n    textReplay.drawText(geometry, feature);\n  }\n}\n\n/**\n * @param {import(\"../render/canvas/BuilderGroup.js\").default} builderGroup Replay group.\n * @param {import(\"../geom/Polygon.js\").default|import(\"../render/Feature.js\").default} geometry Geometry.\n * @param {import(\"../style/Style.js\").default} style Style.\n * @param {import(\"../Feature.js\").FeatureLike} feature Feature.\n * @param {import(\"../render/canvas/BuilderGroup.js\").default} [declutterBuilderGroup] Builder for decluttering.\n */\nfunction renderPolygonGeometry(\n  builderGroup,\n  geometry,\n  style,\n  feature,\n  declutterBuilderGroup\n) {\n  const fillStyle = style.getFill();\n  const strokeStyle = style.getStroke();\n  if (fillStyle || strokeStyle) {\n    const polygonReplay = builderGroup.getBuilder(style.getZIndex(), 'Polygon');\n    polygonReplay.setFillStrokeStyle(fillStyle, strokeStyle);\n    polygonReplay.drawPolygon(geometry, feature);\n  }\n  const textStyle = style.getText();\n  if (textStyle && textStyle.getText()) {\n    const textReplay = (declutterBuilderGroup || builderGroup).getBuilder(\n      style.getZIndex(),\n      'Text'\n    );\n    textReplay.setTextStyle(textStyle);\n    textReplay.drawText(geometry, feature);\n  }\n}\n","/**\n * @module ol/renderer/canvas/VectorLayer\n */\nimport CanvasBuilderGroup from '../../render/canvas/BuilderGroup.js';\nimport CanvasLayerRenderer, {canvasPool} from './Layer.js';\nimport ExecutorGroup from '../../render/canvas/ExecutorGroup.js';\nimport ViewHint from '../../ViewHint.js';\nimport {\n  HIT_DETECT_RESOLUTION,\n  createHitDetectionImageData,\n  hitDetect,\n} from '../../render/canvas/hitdetect.js';\nimport {\n  apply,\n  makeInverse,\n  makeScale,\n  toString as transformToString,\n} from '../../transform.js';\nimport {\n  buffer,\n  containsExtent,\n  createEmpty,\n  getWidth,\n  intersects as intersectsExtent,\n  wrapX as wrapExtentX,\n} from '../../extent.js';\nimport {createCanvasContext2D, releaseCanvas} from '../../dom.js';\nimport {\n  defaultOrder as defaultRenderOrder,\n  getTolerance as getRenderTolerance,\n  getSquaredTolerance as getSquaredRenderTolerance,\n  renderFeature,\n} from '../vector.js';\nimport {equals} from '../../array.js';\nimport {\n  fromUserExtent,\n  getTransformFromProjections,\n  getUserProjection,\n  toUserExtent,\n  toUserResolution,\n} from '../../proj.js';\nimport {getUid} from '../../util.js';\nimport {wrapX as wrapCoordinateX} from '../../coordinate.js';\n\n/**\n * @classdesc\n * Canvas renderer for vector layers.\n * @api\n */\nclass CanvasVectorLayerRenderer extends CanvasLayerRenderer {\n  /**\n   * @param {import(\"../../layer/BaseVector.js\").default} vectorLayer Vector layer.\n   */\n  constructor(vectorLayer) {\n    super(vectorLayer);\n\n    /** @private */\n    this.boundHandleStyleImageChange_ = this.handleStyleImageChange_.bind(this);\n\n    /**\n     * @type {boolean}\n     */\n    this.animatingOrInteracting_;\n\n    /**\n     * @type {ImageData|null}\n     */\n    this.hitDetectionImageData_ = null;\n\n    /**\n     * @type {Array<import(\"../../Feature.js\").default>}\n     */\n    this.renderedFeatures_ = null;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.renderedRevision_ = -1;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.renderedResolution_ = NaN;\n\n    /**\n     * @private\n     * @type {import(\"../../extent.js\").Extent}\n     */\n    this.renderedExtent_ = createEmpty();\n\n    /**\n     * @private\n     * @type {import(\"../../extent.js\").Extent}\n     */\n    this.wrappedRenderedExtent_ = createEmpty();\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.renderedRotation_;\n\n    /**\n     * @private\n     * @type {import(\"../../coordinate\").Coordinate}\n     */\n    this.renderedCenter_ = null;\n\n    /**\n     * @private\n     * @type {import(\"../../proj/Projection\").default}\n     */\n    this.renderedProjection_ = null;\n\n    /**\n     * @private\n     * @type {function(import(\"../../Feature.js\").default, import(\"../../Feature.js\").default): number|null}\n     */\n    this.renderedRenderOrder_ = null;\n\n    /**\n     * @private\n     * @type {import(\"../../render/canvas/ExecutorGroup\").default}\n     */\n    this.replayGroup_ = null;\n\n    /**\n     * A new replay group had to be created by `prepareFrame()`\n     * @type {boolean}\n     */\n    this.replayGroupChanged = true;\n\n    /**\n     * @type {import(\"../../render/canvas/ExecutorGroup\").default}\n     */\n    this.declutterExecutorGroup = null;\n\n    /**\n     * Clipping to be performed by `renderFrame()`\n     * @type {boolean}\n     */\n    this.clipping = true;\n\n    /**\n     * @private\n     * @type {CanvasRenderingContext2D}\n     */\n    this.compositionContext_ = null;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.opacity_ = 1;\n  }\n\n  /**\n   * @param {ExecutorGroup} executorGroup Executor group.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @param {import(\"rbush\").default} [declutterTree] Declutter tree.\n   */\n  renderWorlds(executorGroup, frameState, declutterTree) {\n    const extent = frameState.extent;\n    const viewState = frameState.viewState;\n    const center = viewState.center;\n    const resolution = viewState.resolution;\n    const projection = viewState.projection;\n    const rotation = viewState.rotation;\n    const projectionExtent = projection.getExtent();\n    const vectorSource = this.getLayer().getSource();\n    const pixelRatio = frameState.pixelRatio;\n    const viewHints = frameState.viewHints;\n    const snapToPixel = !(\n      viewHints[ViewHint.ANIMATING] || viewHints[ViewHint.INTERACTING]\n    );\n    const context = this.compositionContext_;\n    const width = Math.round(frameState.size[0] * pixelRatio);\n    const height = Math.round(frameState.size[1] * pixelRatio);\n\n    const multiWorld = vectorSource.getWrapX() && projection.canWrapX();\n    const worldWidth = multiWorld ? getWidth(projectionExtent) : null;\n    const endWorld = multiWorld\n      ? Math.ceil((extent[2] - projectionExtent[2]) / worldWidth) + 1\n      : 1;\n    let world = multiWorld\n      ? Math.floor((extent[0] - projectionExtent[0]) / worldWidth)\n      : 0;\n    do {\n      const transform = this.getRenderTransform(\n        center,\n        resolution,\n        rotation,\n        pixelRatio,\n        width,\n        height,\n        world * worldWidth\n      );\n      executorGroup.execute(\n        context,\n        1,\n        transform,\n        rotation,\n        snapToPixel,\n        undefined,\n        declutterTree\n      );\n    } while (++world < endWorld);\n  }\n\n  setupCompositionContext_() {\n    if (this.opacity_ !== 1) {\n      const compositionContext = createCanvasContext2D(\n        this.context.canvas.width,\n        this.context.canvas.height,\n        canvasPool\n      );\n      this.compositionContext_ = compositionContext;\n    } else {\n      this.compositionContext_ = this.context;\n    }\n  }\n\n  releaseCompositionContext_() {\n    if (this.opacity_ !== 1) {\n      const alpha = this.context.globalAlpha;\n      this.context.globalAlpha = this.opacity_;\n      this.context.drawImage(this.compositionContext_.canvas, 0, 0);\n      this.context.globalAlpha = alpha;\n      releaseCanvas(this.compositionContext_);\n      canvasPool.push(this.compositionContext_.canvas);\n      this.compositionContext_ = null;\n    }\n  }\n\n  /**\n   * Render declutter items for this layer\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   */\n  renderDeclutter(frameState) {\n    if (this.declutterExecutorGroup) {\n      this.setupCompositionContext_();\n      this.renderWorlds(\n        this.declutterExecutorGroup,\n        frameState,\n        frameState.declutterTree\n      );\n      this.releaseCompositionContext_();\n    }\n  }\n\n  /**\n   * Render the layer.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @param {HTMLElement} target Target that may be used to render content to.\n   * @return {HTMLElement} The rendered element.\n   */\n  renderFrame(frameState, target) {\n    const pixelRatio = frameState.pixelRatio;\n    const layerState = frameState.layerStatesArray[frameState.layerIndex];\n\n    // set forward and inverse pixel transforms\n    makeScale(this.pixelTransform, 1 / pixelRatio, 1 / pixelRatio);\n    makeInverse(this.inversePixelTransform, this.pixelTransform);\n\n    const canvasTransform = transformToString(this.pixelTransform);\n\n    this.useContainer(target, canvasTransform, this.getBackground(frameState));\n    const context = this.context;\n    const canvas = context.canvas;\n\n    const replayGroup = this.replayGroup_;\n    const declutterExecutorGroup = this.declutterExecutorGroup;\n    if (\n      (!replayGroup || replayGroup.isEmpty()) &&\n      (!declutterExecutorGroup || declutterExecutorGroup.isEmpty())\n    ) {\n      return null;\n    }\n\n    // resize and clear\n    const width = Math.round(frameState.size[0] * pixelRatio);\n    const height = Math.round(frameState.size[1] * pixelRatio);\n    if (canvas.width != width || canvas.height != height) {\n      canvas.width = width;\n      canvas.height = height;\n      if (canvas.style.transform !== canvasTransform) {\n        canvas.style.transform = canvasTransform;\n      }\n    } else if (!this.containerReused) {\n      context.clearRect(0, 0, width, height);\n    }\n\n    this.preRender(context, frameState);\n\n    const viewState = frameState.viewState;\n    const projection = viewState.projection;\n\n    this.opacity_ = layerState.opacity;\n    this.setupCompositionContext_();\n\n    // clipped rendering if layer extent is set\n    let clipped = false;\n    let render = true;\n    if (layerState.extent && this.clipping) {\n      const layerExtent = fromUserExtent(layerState.extent, projection);\n      render = intersectsExtent(layerExtent, frameState.extent);\n      clipped = render && !containsExtent(layerExtent, frameState.extent);\n      if (clipped) {\n        this.clipUnrotated(this.compositionContext_, frameState, layerExtent);\n      }\n    }\n\n    if (render) {\n      this.renderWorlds(replayGroup, frameState);\n    }\n\n    if (clipped) {\n      this.compositionContext_.restore();\n    }\n\n    this.releaseCompositionContext_();\n\n    this.postRender(context, frameState);\n\n    if (this.renderedRotation_ !== viewState.rotation) {\n      this.renderedRotation_ = viewState.rotation;\n      this.hitDetectionImageData_ = null;\n    }\n    return this.container;\n  }\n\n  /**\n   * Asynchronous layer level hit detection.\n   * @param {import(\"../../pixel.js\").Pixel} pixel Pixel.\n   * @return {Promise<Array<import(\"../../Feature\").default>>} Promise\n   * that resolves with an array of features.\n   */\n  getFeatures(pixel) {\n    return new Promise((resolve) => {\n      if (!this.hitDetectionImageData_ && !this.animatingOrInteracting_) {\n        const size = [this.context.canvas.width, this.context.canvas.height];\n        apply(this.pixelTransform, size);\n        const center = this.renderedCenter_;\n        const resolution = this.renderedResolution_;\n        const rotation = this.renderedRotation_;\n        const projection = this.renderedProjection_;\n        const extent = this.wrappedRenderedExtent_;\n        const layer = this.getLayer();\n        const transforms = [];\n        const width = size[0] * HIT_DETECT_RESOLUTION;\n        const height = size[1] * HIT_DETECT_RESOLUTION;\n        transforms.push(\n          this.getRenderTransform(\n            center,\n            resolution,\n            rotation,\n            HIT_DETECT_RESOLUTION,\n            width,\n            height,\n            0\n          ).slice()\n        );\n        const source = layer.getSource();\n        const projectionExtent = projection.getExtent();\n        if (\n          source.getWrapX() &&\n          projection.canWrapX() &&\n          !containsExtent(projectionExtent, extent)\n        ) {\n          let startX = extent[0];\n          const worldWidth = getWidth(projectionExtent);\n          let world = 0;\n          let offsetX;\n          while (startX < projectionExtent[0]) {\n            --world;\n            offsetX = worldWidth * world;\n            transforms.push(\n              this.getRenderTransform(\n                center,\n                resolution,\n                rotation,\n                HIT_DETECT_RESOLUTION,\n                width,\n                height,\n                offsetX\n              ).slice()\n            );\n            startX += worldWidth;\n          }\n          world = 0;\n          startX = extent[2];\n          while (startX > projectionExtent[2]) {\n            ++world;\n            offsetX = worldWidth * world;\n            transforms.push(\n              this.getRenderTransform(\n                center,\n                resolution,\n                rotation,\n                HIT_DETECT_RESOLUTION,\n                width,\n                height,\n                offsetX\n              ).slice()\n            );\n            startX -= worldWidth;\n          }\n        }\n\n        this.hitDetectionImageData_ = createHitDetectionImageData(\n          size,\n          transforms,\n          this.renderedFeatures_,\n          layer.getStyleFunction(),\n          extent,\n          resolution,\n          rotation\n        );\n      }\n      resolve(\n        hitDetect(pixel, this.renderedFeatures_, this.hitDetectionImageData_)\n      );\n    });\n  }\n\n  /**\n   * @param {import(\"../../coordinate.js\").Coordinate} coordinate Coordinate.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @param {number} hitTolerance Hit tolerance in pixels.\n   * @param {import(\"../vector.js\").FeatureCallback<T>} callback Feature callback.\n   * @param {Array<import(\"../Map.js\").HitMatch<T>>} matches The hit detected matches with tolerance.\n   * @return {T|undefined} Callback result.\n   * @template T\n   */\n  forEachFeatureAtCoordinate(\n    coordinate,\n    frameState,\n    hitTolerance,\n    callback,\n    matches\n  ) {\n    if (!this.replayGroup_) {\n      return undefined;\n    }\n    const resolution = frameState.viewState.resolution;\n    const rotation = frameState.viewState.rotation;\n    const layer = this.getLayer();\n\n    /** @type {!Object<string, import(\"../Map.js\").HitMatch<T>|true>} */\n    const features = {};\n\n    /**\n     * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n     * @param {import(\"../../geom/SimpleGeometry.js\").default} geometry Geometry.\n     * @param {number} distanceSq The squared distance to the click position\n     * @return {T|undefined} Callback result.\n     */\n    const featureCallback = function (feature, geometry, distanceSq) {\n      const key = getUid(feature);\n      const match = features[key];\n      if (!match) {\n        if (distanceSq === 0) {\n          features[key] = true;\n          return callback(feature, layer, geometry);\n        }\n        matches.push(\n          (features[key] = {\n            feature: feature,\n            layer: layer,\n            geometry: geometry,\n            distanceSq: distanceSq,\n            callback: callback,\n          })\n        );\n      } else if (match !== true && distanceSq < match.distanceSq) {\n        if (distanceSq === 0) {\n          features[key] = true;\n          matches.splice(matches.lastIndexOf(match), 1);\n          return callback(feature, layer, geometry);\n        }\n        match.geometry = geometry;\n        match.distanceSq = distanceSq;\n      }\n      return undefined;\n    };\n\n    let result;\n    const executorGroups = [this.replayGroup_];\n    if (this.declutterExecutorGroup) {\n      executorGroups.push(this.declutterExecutorGroup);\n    }\n    executorGroups.some((executorGroup) => {\n      return (result = executorGroup.forEachFeatureAtCoordinate(\n        coordinate,\n        resolution,\n        rotation,\n        hitTolerance,\n        featureCallback,\n        executorGroup === this.declutterExecutorGroup &&\n          frameState.declutterTree\n          ? frameState.declutterTree.all().map((item) => item.value)\n          : null\n      ));\n    });\n\n    return result;\n  }\n\n  /**\n   * Perform action necessary to get the layer rendered after new fonts have loaded\n   */\n  handleFontsChanged() {\n    const layer = this.getLayer();\n    if (layer.getVisible() && this.replayGroup_) {\n      layer.changed();\n    }\n  }\n\n  /**\n   * Handle changes in image style state.\n   * @param {import(\"../../events/Event.js\").default} event Image style change event.\n   * @private\n   */\n  handleStyleImageChange_(event) {\n    this.renderIfReadyAndVisible();\n  }\n\n  /**\n   * Determine whether render should be called.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @return {boolean} Layer is ready to be rendered.\n   */\n  prepareFrame(frameState) {\n    const vectorLayer = this.getLayer();\n    const vectorSource = vectorLayer.getSource();\n    if (!vectorSource) {\n      return false;\n    }\n\n    const animating = frameState.viewHints[ViewHint.ANIMATING];\n    const interacting = frameState.viewHints[ViewHint.INTERACTING];\n    const updateWhileAnimating = vectorLayer.getUpdateWhileAnimating();\n    const updateWhileInteracting = vectorLayer.getUpdateWhileInteracting();\n\n    if (\n      (this.ready && !updateWhileAnimating && animating) ||\n      (!updateWhileInteracting && interacting)\n    ) {\n      this.animatingOrInteracting_ = true;\n      return true;\n    }\n    this.animatingOrInteracting_ = false;\n\n    const frameStateExtent = frameState.extent;\n    const viewState = frameState.viewState;\n    const projection = viewState.projection;\n    const resolution = viewState.resolution;\n    const pixelRatio = frameState.pixelRatio;\n    const vectorLayerRevision = vectorLayer.getRevision();\n    const vectorLayerRenderBuffer = vectorLayer.getRenderBuffer();\n    let vectorLayerRenderOrder = vectorLayer.getRenderOrder();\n\n    if (vectorLayerRenderOrder === undefined) {\n      vectorLayerRenderOrder = defaultRenderOrder;\n    }\n\n    const center = viewState.center.slice();\n    const extent = buffer(\n      frameStateExtent,\n      vectorLayerRenderBuffer * resolution\n    );\n    const renderedExtent = extent.slice();\n    const loadExtents = [extent.slice()];\n    const projectionExtent = projection.getExtent();\n\n    if (\n      vectorSource.getWrapX() &&\n      projection.canWrapX() &&\n      !containsExtent(projectionExtent, frameState.extent)\n    ) {\n      // For the replay group, we need an extent that intersects the real world\n      // (-180° to +180°). To support geometries in a coordinate range from -540°\n      // to +540°, we add at least 1 world width on each side of the projection\n      // extent. If the viewport is wider than the world, we need to add half of\n      // the viewport width to make sure we cover the whole viewport.\n      const worldWidth = getWidth(projectionExtent);\n      const gutter = Math.max(getWidth(extent) / 2, worldWidth);\n      extent[0] = projectionExtent[0] - gutter;\n      extent[2] = projectionExtent[2] + gutter;\n      wrapCoordinateX(center, projection);\n      const loadExtent = wrapExtentX(loadExtents[0], projection);\n      // If the extent crosses the date line, we load data for both edges of the worlds\n      if (\n        loadExtent[0] < projectionExtent[0] &&\n        loadExtent[2] < projectionExtent[2]\n      ) {\n        loadExtents.push([\n          loadExtent[0] + worldWidth,\n          loadExtent[1],\n          loadExtent[2] + worldWidth,\n          loadExtent[3],\n        ]);\n      } else if (\n        loadExtent[0] > projectionExtent[0] &&\n        loadExtent[2] > projectionExtent[2]\n      ) {\n        loadExtents.push([\n          loadExtent[0] - worldWidth,\n          loadExtent[1],\n          loadExtent[2] - worldWidth,\n          loadExtent[3],\n        ]);\n      }\n    }\n\n    if (\n      this.ready &&\n      this.renderedResolution_ == resolution &&\n      this.renderedRevision_ == vectorLayerRevision &&\n      this.renderedRenderOrder_ == vectorLayerRenderOrder &&\n      containsExtent(this.wrappedRenderedExtent_, extent)\n    ) {\n      if (!equals(this.renderedExtent_, renderedExtent)) {\n        this.hitDetectionImageData_ = null;\n        this.renderedExtent_ = renderedExtent;\n      }\n      this.renderedCenter_ = center;\n      this.replayGroupChanged = false;\n      return true;\n    }\n\n    this.replayGroup_ = null;\n\n    const replayGroup = new CanvasBuilderGroup(\n      getRenderTolerance(resolution, pixelRatio),\n      extent,\n      resolution,\n      pixelRatio\n    );\n\n    let declutterBuilderGroup;\n    if (this.getLayer().getDeclutter()) {\n      declutterBuilderGroup = new CanvasBuilderGroup(\n        getRenderTolerance(resolution, pixelRatio),\n        extent,\n        resolution,\n        pixelRatio\n      );\n    }\n\n    const userProjection = getUserProjection();\n    let userTransform;\n    if (userProjection) {\n      for (let i = 0, ii = loadExtents.length; i < ii; ++i) {\n        const extent = loadExtents[i];\n        const userExtent = toUserExtent(extent, projection);\n        vectorSource.loadFeatures(\n          userExtent,\n          toUserResolution(resolution, projection),\n          userProjection\n        );\n      }\n      userTransform = getTransformFromProjections(userProjection, projection);\n    } else {\n      for (let i = 0, ii = loadExtents.length; i < ii; ++i) {\n        vectorSource.loadFeatures(loadExtents[i], resolution, projection);\n      }\n    }\n\n    const squaredTolerance = getSquaredRenderTolerance(resolution, pixelRatio);\n    let ready = true;\n    const render =\n      /**\n       * @param {import(\"../../Feature.js\").default} feature Feature.\n       */\n      (feature) => {\n        let styles;\n        const styleFunction =\n          feature.getStyleFunction() || vectorLayer.getStyleFunction();\n        if (styleFunction) {\n          styles = styleFunction(feature, resolution);\n        }\n        if (styles) {\n          const dirty = this.renderFeature(\n            feature,\n            squaredTolerance,\n            styles,\n            replayGroup,\n            userTransform,\n            declutterBuilderGroup\n          );\n          ready = ready && !dirty;\n        }\n      };\n\n    const userExtent = toUserExtent(extent, projection);\n    /** @type {Array<import(\"../../Feature.js\").default>} */\n    const features = vectorSource.getFeaturesInExtent(userExtent);\n    if (vectorLayerRenderOrder) {\n      features.sort(vectorLayerRenderOrder);\n    }\n    for (let i = 0, ii = features.length; i < ii; ++i) {\n      render(features[i]);\n    }\n    this.renderedFeatures_ = features;\n    this.ready = ready;\n\n    const replayGroupInstructions = replayGroup.finish();\n    const executorGroup = new ExecutorGroup(\n      extent,\n      resolution,\n      pixelRatio,\n      vectorSource.getOverlaps(),\n      replayGroupInstructions,\n      vectorLayer.getRenderBuffer()\n    );\n\n    if (declutterBuilderGroup) {\n      this.declutterExecutorGroup = new ExecutorGroup(\n        extent,\n        resolution,\n        pixelRatio,\n        vectorSource.getOverlaps(),\n        declutterBuilderGroup.finish(),\n        vectorLayer.getRenderBuffer()\n      );\n    }\n\n    this.renderedResolution_ = resolution;\n    this.renderedRevision_ = vectorLayerRevision;\n    this.renderedRenderOrder_ = vectorLayerRenderOrder;\n    this.renderedExtent_ = renderedExtent;\n    this.wrappedRenderedExtent_ = extent;\n    this.renderedCenter_ = center;\n    this.renderedProjection_ = projection;\n    this.replayGroup_ = executorGroup;\n    this.hitDetectionImageData_ = null;\n\n    this.replayGroupChanged = true;\n    return true;\n  }\n\n  /**\n   * @param {import(\"../../Feature.js\").default} feature Feature.\n   * @param {number} squaredTolerance Squared render tolerance.\n   * @param {import(\"../../style/Style.js\").default|Array<import(\"../../style/Style.js\").default>} styles The style or array of styles.\n   * @param {import(\"../../render/canvas/BuilderGroup.js\").default} builderGroup Builder group.\n   * @param {import(\"../../proj.js\").TransformFunction} [transform] Transform from user to view projection.\n   * @param {import(\"../../render/canvas/BuilderGroup.js\").default} [declutterBuilderGroup] Builder for decluttering.\n   * @return {boolean} `true` if an image is loading.\n   */\n  renderFeature(\n    feature,\n    squaredTolerance,\n    styles,\n    builderGroup,\n    transform,\n    declutterBuilderGroup\n  ) {\n    if (!styles) {\n      return false;\n    }\n    let loading = false;\n    if (Array.isArray(styles)) {\n      for (let i = 0, ii = styles.length; i < ii; ++i) {\n        loading =\n          renderFeature(\n            builderGroup,\n            feature,\n            styles[i],\n            squaredTolerance,\n            this.boundHandleStyleImageChange_,\n            transform,\n            declutterBuilderGroup\n          ) || loading;\n      }\n    } else {\n      loading = renderFeature(\n        builderGroup,\n        feature,\n        styles,\n        squaredTolerance,\n        this.boundHandleStyleImageChange_,\n        transform,\n        declutterBuilderGroup\n      );\n    }\n    return loading;\n  }\n}\n\nexport default CanvasVectorLayerRenderer;\n","/**\n * @module ol/layer/Vector\n */\nimport BaseVectorLayer from './BaseVector.js';\nimport CanvasVectorLayerRenderer from '../renderer/canvas/VectorLayer.js';\n\n/**\n * @classdesc\n * Vector data is rendered client-side, as vectors. This layer type provides most accurate rendering\n * even during animations. Points and labels stay upright on rotated views. For very large\n * amounts of vector data, performance may suffer during pan and zoom animations. In this case,\n * try {@link module:ol/layer/VectorImage~VectorImageLayer}.\n *\n * Note that any property set in the options is set as a {@link module:ol/Object~BaseObject}\n * property on the layer object; for example, setting `title: 'My Title'` in the\n * options means that `title` is observable, and has get/set accessors.\n *\n * @template {import(\"../source/Vector.js\").default} VectorSourceType\n * @extends {BaseVectorLayer<VectorSourceType, CanvasVectorLayerRenderer>}\n * @api\n */\nclass VectorLayer extends BaseVectorLayer {\n  /**\n   * @param {import(\"./BaseVector.js\").Options<VectorSourceType>} [options] Options.\n   */\n  constructor(options) {\n    super(options);\n  }\n\n  createRenderer() {\n    return new CanvasVectorLayerRenderer(this);\n  }\n}\n\nexport default VectorLayer;\n","/**\n * @module ol/structs/RBush\n */\nimport RBush_ from 'rbush';\nimport {createOrUpdate, equals} from '../extent.js';\nimport {getUid} from '../util.js';\nimport {isEmpty} from '../obj.js';\n\n/**\n * @typedef {Object} Entry\n * @property {number} minX MinX.\n * @property {number} minY MinY.\n * @property {number} maxX MaxX.\n * @property {number} maxY MaxY.\n * @property {Object} [value] Value.\n */\n\n/**\n * @classdesc\n * Wrapper around the RBush by Vladimir Agafonkin.\n * See https://github.com/mourner/rbush.\n *\n * @template T\n */\nclass RBush {\n  /**\n   * @param {number} [maxEntries] Max entries.\n   */\n  constructor(maxEntries) {\n    /**\n     * @private\n     */\n    this.rbush_ = new RBush_(maxEntries);\n\n    /**\n     * A mapping between the objects added to this rbush wrapper\n     * and the objects that are actually added to the internal rbush.\n     * @private\n     * @type {Object<string, Entry>}\n     */\n    this.items_ = {};\n  }\n\n  /**\n   * Insert a value into the RBush.\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {T} value Value.\n   */\n  insert(extent, value) {\n    /** @type {Entry} */\n    const item = {\n      minX: extent[0],\n      minY: extent[1],\n      maxX: extent[2],\n      maxY: extent[3],\n      value: value,\n    };\n\n    this.rbush_.insert(item);\n    this.items_[getUid(value)] = item;\n  }\n\n  /**\n   * Bulk-insert values into the RBush.\n   * @param {Array<import(\"../extent.js\").Extent>} extents Extents.\n   * @param {Array<T>} values Values.\n   */\n  load(extents, values) {\n    const items = new Array(values.length);\n    for (let i = 0, l = values.length; i < l; i++) {\n      const extent = extents[i];\n      const value = values[i];\n\n      /** @type {Entry} */\n      const item = {\n        minX: extent[0],\n        minY: extent[1],\n        maxX: extent[2],\n        maxY: extent[3],\n        value: value,\n      };\n      items[i] = item;\n      this.items_[getUid(value)] = item;\n    }\n    this.rbush_.load(items);\n  }\n\n  /**\n   * Remove a value from the RBush.\n   * @param {T} value Value.\n   * @return {boolean} Removed.\n   */\n  remove(value) {\n    const uid = getUid(value);\n\n    // get the object in which the value was wrapped when adding to the\n    // internal rbush. then use that object to do the removal.\n    const item = this.items_[uid];\n    delete this.items_[uid];\n    return this.rbush_.remove(item) !== null;\n  }\n\n  /**\n   * Update the extent of a value in the RBush.\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {T} value Value.\n   */\n  update(extent, value) {\n    const item = this.items_[getUid(value)];\n    const bbox = [item.minX, item.minY, item.maxX, item.maxY];\n    if (!equals(bbox, extent)) {\n      this.remove(value);\n      this.insert(extent, value);\n    }\n  }\n\n  /**\n   * Return all values in the RBush.\n   * @return {Array<T>} All.\n   */\n  getAll() {\n    const items = this.rbush_.all();\n    return items.map(function (item) {\n      return item.value;\n    });\n  }\n\n  /**\n   * Return all values in the given extent.\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @return {Array<T>} All in extent.\n   */\n  getInExtent(extent) {\n    /** @type {Entry} */\n    const bbox = {\n      minX: extent[0],\n      minY: extent[1],\n      maxX: extent[2],\n      maxY: extent[3],\n    };\n    const items = this.rbush_.search(bbox);\n    return items.map(function (item) {\n      return item.value;\n    });\n  }\n\n  /**\n   * Calls a callback function with each value in the tree.\n   * If the callback returns a truthy value, this value is returned without\n   * checking the rest of the tree.\n   * @param {function(T): *} callback Callback.\n   * @return {*} Callback return value.\n   */\n  forEach(callback) {\n    return this.forEach_(this.getAll(), callback);\n  }\n\n  /**\n   * Calls a callback function with each value in the provided extent.\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {function(T): *} callback Callback.\n   * @return {*} Callback return value.\n   */\n  forEachInExtent(extent, callback) {\n    return this.forEach_(this.getInExtent(extent), callback);\n  }\n\n  /**\n   * @param {Array<T>} values Values.\n   * @param {function(T): *} callback Callback.\n   * @private\n   * @return {*} Callback return value.\n   */\n  forEach_(values, callback) {\n    let result;\n    for (let i = 0, l = values.length; i < l; i++) {\n      result = callback(values[i]);\n      if (result) {\n        return result;\n      }\n    }\n    return result;\n  }\n\n  /**\n   * @return {boolean} Is empty.\n   */\n  isEmpty() {\n    return isEmpty(this.items_);\n  }\n\n  /**\n   * Remove all values from the RBush.\n   */\n  clear() {\n    this.rbush_.clear();\n    this.items_ = {};\n  }\n\n  /**\n   * @param {import(\"../extent.js\").Extent} [extent] Extent.\n   * @return {import(\"../extent.js\").Extent} Extent.\n   */\n  getExtent(extent) {\n    const data = this.rbush_.toJSON();\n    return createOrUpdate(data.minX, data.minY, data.maxX, data.maxY, extent);\n  }\n\n  /**\n   * @param {RBush} rbush R-Tree.\n   */\n  concat(rbush) {\n    this.rbush_.load(rbush.rbush_.all());\n    for (const i in rbush.items_) {\n      this.items_[i] = rbush.items_[i];\n    }\n  }\n}\n\nexport default RBush;\n","/**\n * @module ol/source/VectorEventType\n */\n\n/**\n * @enum {string}\n */\nexport default {\n  /**\n   * Triggered when a feature is added to the source.\n   * @event module:ol/source/Vector.VectorSourceEvent#addfeature\n   * @api\n   */\n  ADDFEATURE: 'addfeature',\n\n  /**\n   * Triggered when a feature is updated.\n   * @event module:ol/source/Vector.VectorSourceEvent#changefeature\n   * @api\n   */\n  CHANGEFEATURE: 'changefeature',\n\n  /**\n   * Triggered when the clear method is called on the source.\n   * @event module:ol/source/Vector.VectorSourceEvent#clear\n   * @api\n   */\n  CLEAR: 'clear',\n\n  /**\n   * Triggered when a feature is removed from the source.\n   * See {@link module:ol/source/Vector~VectorSource#clear source.clear()} for exceptions.\n   * @event module:ol/source/Vector.VectorSourceEvent#removefeature\n   * @api\n   */\n  REMOVEFEATURE: 'removefeature',\n\n  /**\n   * Triggered when features starts loading.\n   * @event module:ol/source/Vector.VectorSourceEvent#featuresloadstart\n   * @api\n   */\n  FEATURESLOADSTART: 'featuresloadstart',\n\n  /**\n   * Triggered when features finishes loading.\n   * @event module:ol/source/Vector.VectorSourceEvent#featuresloadend\n   * @api\n   */\n  FEATURESLOADEND: 'featuresloadend',\n\n  /**\n   * Triggered if feature loading results in an error.\n   * @event module:ol/source/Vector.VectorSourceEvent#featuresloaderror\n   * @api\n   */\n  FEATURESLOADERROR: 'featuresloaderror',\n};\n\n/**\n * @typedef {'addfeature'|'changefeature'|'clear'|'removefeature'|'featuresloadstart'|'featuresloadend'|'featuresloaderror'} VectorSourceEventTypes\n */\n","/**\n * @module ol/loadingstrategy\n */\n\nimport {fromUserExtent, fromUserResolution, toUserExtent} from './proj.js';\n\n/**\n * Strategy function for loading all features with a single request.\n * @param {import(\"./extent.js\").Extent} extent Extent.\n * @param {number} resolution Resolution.\n * @return {Array<import(\"./extent.js\").Extent>} Extents.\n * @api\n */\nexport function all(extent, resolution) {\n  return [[-Infinity, -Infinity, Infinity, Infinity]];\n}\n\n/**\n * Strategy function for loading features based on the view's extent and\n * resolution.\n * @param {import(\"./extent.js\").Extent} extent Extent.\n * @param {number} resolution Resolution.\n * @return {Array<import(\"./extent.js\").Extent>} Extents.\n * @api\n */\nexport function bbox(extent, resolution) {\n  return [extent];\n}\n\n/**\n * Creates a strategy function for loading features based on a tile grid.\n * @param {import(\"./tilegrid/TileGrid.js\").default} tileGrid Tile grid.\n * @return {function(import(\"./extent.js\").Extent, number, import(\"./proj.js\").Projection): Array<import(\"./extent.js\").Extent>} Loading strategy.\n * @api\n */\nexport function tile(tileGrid) {\n  return (\n    /**\n     * @param {import(\"./extent.js\").Extent} extent Extent.\n     * @param {number} resolution Resolution.\n     * @param {import(\"./proj.js\").Projection} projection Projection.\n     * @return {Array<import(\"./extent.js\").Extent>} Extents.\n     */\n    function (extent, resolution, projection) {\n      const z = tileGrid.getZForResolution(\n        fromUserResolution(resolution, projection)\n      );\n      const tileRange = tileGrid.getTileRangeForExtentAndZ(\n        fromUserExtent(extent, projection),\n        z\n      );\n      /** @type {Array<import(\"./extent.js\").Extent>} */\n      const extents = [];\n      /** @type {import(\"./tilecoord.js\").TileCoord} */\n      const tileCoord = [z, 0, 0];\n      for (\n        tileCoord[1] = tileRange.minX;\n        tileCoord[1] <= tileRange.maxX;\n        ++tileCoord[1]\n      ) {\n        for (\n          tileCoord[2] = tileRange.minY;\n          tileCoord[2] <= tileRange.maxY;\n          ++tileCoord[2]\n        ) {\n          extents.push(\n            toUserExtent(tileGrid.getTileCoordExtent(tileCoord), projection)\n          );\n        }\n      }\n      return extents;\n    }\n  );\n}\n","/**\n * @module ol/featureloader\n */\nimport {VOID} from './functions.js';\n\n/**\n *\n * @type {boolean}\n * @private\n */\nlet withCredentials = false;\n\n/**\n * {@link module:ol/source/Vector~VectorSource} sources use a function of this type to\n * load features.\n *\n * This function takes up to 5 arguments. These are an {@link module:ol/extent~Extent} representing\n * the area to be loaded, a `{number}` representing the resolution (map units per pixel), an\n * {@link module:ol/proj/Projection~Projection} for the projection, an optional success callback that should get\n * the loaded features passed as an argument and an optional failure callback with no arguments. If\n * the callbacks are not used, the corresponding vector source will not fire `'featuresloadend'` and\n * `'featuresloaderror'` events. `this` within the function is bound to the\n * {@link module:ol/source/Vector~VectorSource} it's called from.\n *\n * The function is responsible for loading the features and adding them to the\n * source.\n * @typedef {function(this:(import(\"./source/Vector\").default|import(\"./VectorTile.js\").default),\n *           import(\"./extent.js\").Extent,\n *           number,\n *           import(\"./proj/Projection.js\").default,\n *           function(Array<import(\"./Feature.js\").default>): void=,\n *           function(): void=): void} FeatureLoader\n * @api\n */\n\n/**\n * {@link module:ol/source/Vector~VectorSource} sources use a function of this type to\n * get the url to load features from.\n *\n * This function takes an {@link module:ol/extent~Extent} representing the area\n * to be loaded, a `{number}` representing the resolution (map units per pixel)\n * and an {@link module:ol/proj/Projection~Projection} for the projection  as\n * arguments and returns a `{string}` representing the URL.\n * @typedef {function(import(\"./extent.js\").Extent, number, import(\"./proj/Projection.js\").default): string} FeatureUrlFunction\n * @api\n */\n\n/**\n * @param {string|FeatureUrlFunction} url Feature URL service.\n * @param {import(\"./format/Feature.js\").default} format Feature format.\n * @param {import(\"./extent.js\").Extent} extent Extent.\n * @param {number} resolution Resolution.\n * @param {import(\"./proj/Projection.js\").default} projection Projection.\n * @param {function(Array<import(\"./Feature.js\").default>, import(\"./proj/Projection.js\").default): void} success Success\n *      Function called with the loaded features and optionally with the data projection.\n * @param {function(): void} failure Failure\n *      Function called when loading failed.\n */\nexport function loadFeaturesXhr(\n  url,\n  format,\n  extent,\n  resolution,\n  projection,\n  success,\n  failure\n) {\n  const xhr = new XMLHttpRequest();\n  xhr.open(\n    'GET',\n    typeof url === 'function' ? url(extent, resolution, projection) : url,\n    true\n  );\n  if (format.getType() == 'arraybuffer') {\n    xhr.responseType = 'arraybuffer';\n  }\n  xhr.withCredentials = withCredentials;\n  /**\n   * @param {Event} event Event.\n   * @private\n   */\n  xhr.onload = function (event) {\n    // status will be 0 for file:// urls\n    if (!xhr.status || (xhr.status >= 200 && xhr.status < 300)) {\n      const type = format.getType();\n      /** @type {Document|Node|Object|string|undefined} */\n      let source;\n      if (type == 'json' || type == 'text') {\n        source = xhr.responseText;\n      } else if (type == 'xml') {\n        source = xhr.responseXML;\n        if (!source) {\n          source = new DOMParser().parseFromString(\n            xhr.responseText,\n            'application/xml'\n          );\n        }\n      } else if (type == 'arraybuffer') {\n        source = /** @type {ArrayBuffer} */ (xhr.response);\n      }\n      if (source) {\n        success(\n          /** @type {Array<import(\"./Feature.js\").default>} */\n          (\n            format.readFeatures(source, {\n              extent: extent,\n              featureProjection: projection,\n            })\n          ),\n          format.readProjection(source)\n        );\n      } else {\n        failure();\n      }\n    } else {\n      failure();\n    }\n  };\n  /**\n   * @private\n   */\n  xhr.onerror = failure;\n  xhr.send();\n}\n\n/**\n * Create an XHR feature loader for a `url` and `format`. The feature loader\n * loads features (with XHR), parses the features, and adds them to the\n * vector source.\n * @param {string|FeatureUrlFunction} url Feature URL service.\n * @param {import(\"./format/Feature.js\").default} format Feature format.\n * @return {FeatureLoader} The feature loader.\n * @api\n */\nexport function xhr(url, format) {\n  /**\n   * @param {import(\"./extent.js\").Extent} extent Extent.\n   * @param {number} resolution Resolution.\n   * @param {import(\"./proj/Projection.js\").default} projection Projection.\n   * @param {function(Array<import(\"./Feature.js\").default>): void} [success] Success\n   *      Function called when loading succeeded.\n   * @param {function(): void} [failure] Failure\n   *      Function called when loading failed.\n   */\n  return function (extent, resolution, projection, success, failure) {\n    const source = /** @type {import(\"./source/Vector\").default} */ (this);\n    loadFeaturesXhr(\n      url,\n      format,\n      extent,\n      resolution,\n      projection,\n      /**\n       * @param {Array<import(\"./Feature.js\").default>} features The loaded features.\n       * @param {import(\"./proj/Projection.js\").default} dataProjection Data\n       * projection.\n       */\n      function (features, dataProjection) {\n        source.addFeatures(features);\n        if (success !== undefined) {\n          success(features);\n        }\n      },\n      /* FIXME handle error */ failure ? failure : VOID\n    );\n  };\n}\n\n/**\n * Setter for the withCredentials configuration for the XHR.\n *\n * @param {boolean} xhrWithCredentials The value of withCredentials to set.\n * Compare https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/\n * @api\n */\nexport function setWithCredentials(xhrWithCredentials) {\n  withCredentials = xhrWithCredentials;\n}\n","/**\n * @module ol/source/Vector\n */\n\nimport Collection from '../Collection.js';\nimport CollectionEventType from '../CollectionEventType.js';\nimport Event from '../events/Event.js';\nimport EventType from '../events/EventType.js';\nimport ObjectEventType from '../ObjectEventType.js';\nimport RBush from '../structs/RBush.js';\nimport Source from './Source.js';\nimport VectorEventType from './VectorEventType.js';\nimport {TRUE, VOID} from '../functions.js';\nimport {all as allStrategy} from '../loadingstrategy.js';\nimport {assert} from '../asserts.js';\nimport {containsExtent, equals, wrapAndSliceX} from '../extent.js';\nimport {extend} from '../array.js';\nimport {getUid} from '../util.js';\nimport {isEmpty} from '../obj.js';\nimport {listen, unlistenByKey} from '../events.js';\nimport {xhr} from '../featureloader.js';\n\n/**\n * A function that takes an {@link module:ol/extent~Extent} and a resolution as arguments, and\n * returns an array of {@link module:ol/extent~Extent} with the extents to load. Usually this\n * is one of the standard {@link module:ol/loadingstrategy} strategies.\n *\n * @typedef {function(import(\"../extent.js\").Extent, number, import(\"../proj/Projection.js\").default): Array<import(\"../extent.js\").Extent>} LoadingStrategy\n * @api\n */\n\n/**\n * @classdesc\n * Events emitted by {@link module:ol/source/Vector~VectorSource} instances are instances of this\n * type.\n * @template {import(\"../geom/Geometry.js\").default} [Geometry=import(\"../geom/Geometry.js\").default]\n */\nexport class VectorSourceEvent extends Event {\n  /**\n   * @param {string} type Type.\n   * @param {import(\"../Feature.js\").default<Geometry>} [feature] Feature.\n   * @param {Array<import(\"../Feature.js\").default<Geometry>>} [features] Features.\n   */\n  constructor(type, feature, features) {\n    super(type);\n\n    /**\n     * The added or removed feature for the `ADDFEATURE` and `REMOVEFEATURE` events, `undefined` otherwise.\n     * @type {import(\"../Feature.js\").default<Geometry>|undefined}\n     * @api\n     */\n    this.feature = feature;\n\n    /**\n     * The loaded features for the `FEATURESLOADED` event, `undefined` otherwise.\n     * @type {Array<import(\"../Feature.js\").default<Geometry>>|undefined}\n     * @api\n     */\n    this.features = features;\n  }\n}\n\n/***\n * @template Return\n * @typedef {import(\"../Observable\").OnSignature<import(\"../Observable\").EventTypes, import(\"../events/Event.js\").default, Return> &\n *   import(\"../Observable\").OnSignature<import(\"../ObjectEventType\").Types, import(\"../Object\").ObjectEvent, Return> &\n *   import(\"../Observable\").OnSignature<import(\"./VectorEventType\").VectorSourceEventTypes, VectorSourceEvent, Return> &\n *   import(\"../Observable\").CombinedOnSignature<import(\"../Observable\").EventTypes|import(\"../ObjectEventType\").Types|\n *     import(\"./VectorEventType\").VectorSourceEventTypes, Return>} VectorSourceOnSignature\n */\n\n/**\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {Array<import(\"../Feature.js\").default<Geometry>>|Collection<import(\"../Feature.js\").default<Geometry>>} [features]\n * Features. If provided as {@link module:ol/Collection~Collection}, the features in the source\n * and the collection will stay in sync.\n * @property {import(\"../format/Feature.js\").default} [format] The feature format used by the XHR\n * feature loader when `url` is set. Required if `url` is set, otherwise ignored.\n * @property {import(\"../featureloader.js\").FeatureLoader} [loader]\n * The loader function used to load features, from a remote source for example.\n * If this is not set and `url` is set, the source will create and use an XHR\n * feature loader. The `'featuresloadend'` and `'featuresloaderror'` events\n * will only fire if the `success` and `failure` callbacks are used.\n *\n * Example:\n *\n * ```js\n * import Vector from 'ol/source/Vector.js';\n * import GeoJSON from 'ol/format/GeoJSON.js';\n * import {bbox} from 'ol/loadingstrategy.js';\n *\n * const vectorSource = new Vector({\n *   format: new GeoJSON(),\n *   loader: function(extent, resolution, projection, success, failure) {\n *      const proj = projection.getCode();\n *      const url = 'https://ahocevar.com/geoserver/wfs?service=WFS&' +\n *          'version=1.1.0&request=GetFeature&typename=osm:water_areas&' +\n *          'outputFormat=application/json&srsname=' + proj + '&' +\n *          'bbox=' + extent.join(',') + ',' + proj;\n *      const xhr = new XMLHttpRequest();\n *      xhr.open('GET', url);\n *      const onError = function() {\n *        vectorSource.removeLoadedExtent(extent);\n *        failure();\n *      }\n *      xhr.onerror = onError;\n *      xhr.onload = function() {\n *        if (xhr.status == 200) {\n *          const features = vectorSource.getFormat().readFeatures(xhr.responseText);\n *          vectorSource.addFeatures(features);\n *          success(features);\n *        } else {\n *          onError();\n *        }\n *      }\n *      xhr.send();\n *    },\n *    strategy: bbox,\n *  });\n * ```\n * @property {boolean} [overlaps=true] This source may have overlapping geometries.\n * Setting this to `false` (e.g. for sources with polygons that represent administrative\n * boundaries or TopoJSON sources) allows the renderer to optimise fill and\n * stroke operations.\n * @property {LoadingStrategy} [strategy] The loading strategy to use.\n * By default an {@link module:ol/loadingstrategy.all}\n * strategy is used, a one-off strategy which loads all features at once.\n * @property {string|import(\"../featureloader.js\").FeatureUrlFunction} [url]\n * Setting this option instructs the source to load features using an XHR loader\n * (see {@link module:ol/featureloader.xhr}). Use a `string` and an\n * {@link module:ol/loadingstrategy.all} for a one-off download of all features from\n * the given URL. Use a {@link module:ol/featureloader~FeatureUrlFunction} to generate the url with\n * other loading strategies.\n * Requires `format` to be set as well.\n * When default XHR feature loader is provided, the features will\n * be transformed from the data projection to the view projection\n * during parsing. If your remote data source does not advertise its projection\n * properly, this transformation will be incorrect. For some formats, the\n * default projection (usually EPSG:4326) can be overridden by setting the\n * dataProjection constructor option on the format.\n * Note that if a source contains non-feature data, such as a GeoJSON geometry\n * or a KML NetworkLink, these will be ignored. Use a custom loader to load these.\n * @property {boolean} [useSpatialIndex=true]\n * By default, an RTree is used as spatial index. When features are removed and\n * added frequently, and the total number of features is low, setting this to\n * `false` may improve performance.\n *\n * Note that\n * {@link module:ol/source/Vector~VectorSource#getFeaturesInExtent},\n * {@link module:ol/source/Vector~VectorSource#getClosestFeatureToCoordinate} and\n * {@link module:ol/source/Vector~VectorSource#getExtent} cannot be used when `useSpatialIndex` is\n * set to `false`, and {@link module:ol/source/Vector~VectorSource#forEachFeatureInExtent} will loop\n * through all features.\n *\n * When set to `false`, the features will be maintained in an\n * {@link module:ol/Collection~Collection}, which can be retrieved through\n * {@link module:ol/source/Vector~VectorSource#getFeaturesCollection}.\n * @property {boolean} [wrapX=true] Wrap the world horizontally. For vector editing across the\n * -180° and 180° meridians to work properly, this should be set to `false`. The\n * resulting geometry coordinates will then exceed the world bounds.\n * @template {import(\"../geom/Geometry.js\").default} [Geometry=import(\"../geom/Geometry.js\").default]\n */\n\n/**\n * @classdesc\n * Provides a source of features for vector layers. Vector features provided\n * by this source are suitable for editing. See {@link module:ol/source/VectorTile~VectorTile} for\n * vector data that is optimized for rendering.\n *\n * @fires VectorSourceEvent\n * @api\n * @template {import(\"../geom/Geometry.js\").default} [Geometry=import(\"../geom/Geometry.js\").default]\n */\nclass VectorSource extends Source {\n  /**\n   * @param {Options<Geometry>} [options] Vector source options.\n   */\n  constructor(options) {\n    options = options || {};\n\n    super({\n      attributions: options.attributions,\n      interpolate: true,\n      projection: undefined,\n      state: 'ready',\n      wrapX: options.wrapX !== undefined ? options.wrapX : true,\n    });\n\n    /***\n     * @type {VectorSourceOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.on;\n\n    /***\n     * @type {VectorSourceOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.once;\n\n    /***\n     * @type {VectorSourceOnSignature<void>}\n     */\n    this.un;\n\n    /**\n     * @private\n     * @type {import(\"../featureloader.js\").FeatureLoader}\n     */\n    this.loader_ = VOID;\n\n    /**\n     * @private\n     * @type {import(\"../format/Feature.js\").default|undefined}\n     */\n    this.format_ = options.format;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.overlaps_ = options.overlaps === undefined ? true : options.overlaps;\n\n    /**\n     * @private\n     * @type {string|import(\"../featureloader.js\").FeatureUrlFunction|undefined}\n     */\n    this.url_ = options.url;\n\n    if (options.loader !== undefined) {\n      this.loader_ = options.loader;\n    } else if (this.url_ !== undefined) {\n      assert(this.format_, 7); // `format` must be set when `url` is set\n      // create a XHR feature loader for \"url\" and \"format\"\n      this.loader_ = xhr(\n        this.url_,\n        /** @type {import(\"../format/Feature.js\").default} */ (this.format_)\n      );\n    }\n\n    /**\n     * @private\n     * @type {LoadingStrategy}\n     */\n    this.strategy_ =\n      options.strategy !== undefined ? options.strategy : allStrategy;\n\n    const useSpatialIndex =\n      options.useSpatialIndex !== undefined ? options.useSpatialIndex : true;\n\n    /**\n     * @private\n     * @type {RBush<import(\"../Feature.js\").default<Geometry>>}\n     */\n    this.featuresRtree_ = useSpatialIndex ? new RBush() : null;\n\n    /**\n     * @private\n     * @type {RBush<{extent: import(\"../extent.js\").Extent}>}\n     */\n    this.loadedExtentsRtree_ = new RBush();\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.loadingExtentsCount_ = 0;\n\n    /**\n     * @private\n     * @type {!Object<string, import(\"../Feature.js\").default<Geometry>>}\n     */\n    this.nullGeometryFeatures_ = {};\n\n    /**\n     * A lookup of features by id (the return from feature.getId()).\n     * @private\n     * @type {!Object<string, import(\"../Feature.js\").default<Geometry>>}\n     */\n    this.idIndex_ = {};\n\n    /**\n     * A lookup of features by uid (using getUid(feature)).\n     * @private\n     * @type {!Object<string, import(\"../Feature.js\").default<Geometry>>}\n     */\n    this.uidIndex_ = {};\n\n    /**\n     * @private\n     * @type {Object<string, Array<import(\"../events.js\").EventsKey>>}\n     */\n    this.featureChangeKeys_ = {};\n\n    /**\n     * @private\n     * @type {Collection<import(\"../Feature.js\").default<Geometry>>|null}\n     */\n    this.featuresCollection_ = null;\n\n    /** @type {Collection<import(\"../Feature.js\").default<Geometry>>} */\n    let collection;\n    /** @type {Array<import(\"../Feature.js\").default<Geometry>>} */\n    let features;\n    if (Array.isArray(options.features)) {\n      features = options.features;\n    } else if (options.features) {\n      collection = options.features;\n      features = collection.getArray();\n    }\n    if (!useSpatialIndex && collection === undefined) {\n      collection = new Collection(features);\n    }\n    if (features !== undefined) {\n      this.addFeaturesInternal(features);\n    }\n    if (collection !== undefined) {\n      this.bindFeaturesCollection_(collection);\n    }\n  }\n\n  /**\n   * Add a single feature to the source.  If you want to add a batch of features\n   * at once, call {@link module:ol/source/Vector~VectorSource#addFeatures #addFeatures()}\n   * instead. A feature will not be added to the source if feature with\n   * the same id is already there. The reason for this behavior is to avoid\n   * feature duplication when using bbox or tile loading strategies.\n   * Note: this also applies if an {@link module:ol/Collection~Collection} is used for features,\n   * meaning that if a feature with a duplicate id is added in the collection, it will\n   * be removed from it right away.\n   * @param {import(\"../Feature.js\").default<Geometry>} feature Feature to add.\n   * @api\n   */\n  addFeature(feature) {\n    this.addFeatureInternal(feature);\n    this.changed();\n  }\n\n  /**\n   * Add a feature without firing a `change` event.\n   * @param {import(\"../Feature.js\").default<Geometry>} feature Feature.\n   * @protected\n   */\n  addFeatureInternal(feature) {\n    const featureKey = getUid(feature);\n\n    if (!this.addToIndex_(featureKey, feature)) {\n      if (this.featuresCollection_) {\n        this.featuresCollection_.remove(feature);\n      }\n      return;\n    }\n\n    this.setupChangeEvents_(featureKey, feature);\n\n    const geometry = feature.getGeometry();\n    if (geometry) {\n      const extent = geometry.getExtent();\n      if (this.featuresRtree_) {\n        this.featuresRtree_.insert(extent, feature);\n      }\n    } else {\n      this.nullGeometryFeatures_[featureKey] = feature;\n    }\n\n    this.dispatchEvent(\n      new VectorSourceEvent(VectorEventType.ADDFEATURE, feature)\n    );\n  }\n\n  /**\n   * @param {string} featureKey Unique identifier for the feature.\n   * @param {import(\"../Feature.js\").default<Geometry>} feature The feature.\n   * @private\n   */\n  setupChangeEvents_(featureKey, feature) {\n    this.featureChangeKeys_[featureKey] = [\n      listen(feature, EventType.CHANGE, this.handleFeatureChange_, this),\n      listen(\n        feature,\n        ObjectEventType.PROPERTYCHANGE,\n        this.handleFeatureChange_,\n        this\n      ),\n    ];\n  }\n\n  /**\n   * @param {string} featureKey Unique identifier for the feature.\n   * @param {import(\"../Feature.js\").default<Geometry>} feature The feature.\n   * @return {boolean} The feature is \"valid\", in the sense that it is also a\n   *     candidate for insertion into the Rtree.\n   * @private\n   */\n  addToIndex_(featureKey, feature) {\n    let valid = true;\n    const id = feature.getId();\n    if (id !== undefined) {\n      if (!(id.toString() in this.idIndex_)) {\n        this.idIndex_[id.toString()] = feature;\n      } else {\n        valid = false;\n      }\n    }\n    if (valid) {\n      assert(!(featureKey in this.uidIndex_), 30); // The passed `feature` was already added to the source\n      this.uidIndex_[featureKey] = feature;\n    }\n    return valid;\n  }\n\n  /**\n   * Add a batch of features to the source.\n   * @param {Array<import(\"../Feature.js\").default<Geometry>>} features Features to add.\n   * @api\n   */\n  addFeatures(features) {\n    this.addFeaturesInternal(features);\n    this.changed();\n  }\n\n  /**\n   * Add features without firing a `change` event.\n   * @param {Array<import(\"../Feature.js\").default<Geometry>>} features Features.\n   * @protected\n   */\n  addFeaturesInternal(features) {\n    const extents = [];\n    const newFeatures = [];\n    const geometryFeatures = [];\n\n    for (let i = 0, length = features.length; i < length; i++) {\n      const feature = features[i];\n      const featureKey = getUid(feature);\n      if (this.addToIndex_(featureKey, feature)) {\n        newFeatures.push(feature);\n      }\n    }\n\n    for (let i = 0, length = newFeatures.length; i < length; i++) {\n      const feature = newFeatures[i];\n      const featureKey = getUid(feature);\n      this.setupChangeEvents_(featureKey, feature);\n\n      const geometry = feature.getGeometry();\n      if (geometry) {\n        const extent = geometry.getExtent();\n        extents.push(extent);\n        geometryFeatures.push(feature);\n      } else {\n        this.nullGeometryFeatures_[featureKey] = feature;\n      }\n    }\n    if (this.featuresRtree_) {\n      this.featuresRtree_.load(extents, geometryFeatures);\n    }\n\n    if (this.hasListener(VectorEventType.ADDFEATURE)) {\n      for (let i = 0, length = newFeatures.length; i < length; i++) {\n        this.dispatchEvent(\n          new VectorSourceEvent(VectorEventType.ADDFEATURE, newFeatures[i])\n        );\n      }\n    }\n  }\n\n  /**\n   * @param {!Collection<import(\"../Feature.js\").default<Geometry>>} collection Collection.\n   * @private\n   */\n  bindFeaturesCollection_(collection) {\n    let modifyingCollection = false;\n    this.addEventListener(\n      VectorEventType.ADDFEATURE,\n      /**\n       * @param {VectorSourceEvent<Geometry>} evt The vector source event\n       */\n      function (evt) {\n        if (!modifyingCollection) {\n          modifyingCollection = true;\n          collection.push(evt.feature);\n          modifyingCollection = false;\n        }\n      }\n    );\n    this.addEventListener(\n      VectorEventType.REMOVEFEATURE,\n      /**\n       * @param {VectorSourceEvent<Geometry>} evt The vector source event\n       */\n      function (evt) {\n        if (!modifyingCollection) {\n          modifyingCollection = true;\n          collection.remove(evt.feature);\n          modifyingCollection = false;\n        }\n      }\n    );\n    collection.addEventListener(\n      CollectionEventType.ADD,\n      /**\n       * @param {import(\"../Collection.js\").CollectionEvent<import(\"../Feature.js\").default<Geometry>>} evt The collection event\n       */\n      (evt) => {\n        if (!modifyingCollection) {\n          modifyingCollection = true;\n          this.addFeature(evt.element);\n          modifyingCollection = false;\n        }\n      }\n    );\n    collection.addEventListener(\n      CollectionEventType.REMOVE,\n      /**\n       * @param {import(\"../Collection.js\").CollectionEvent<import(\"../Feature.js\").default<Geometry>>} evt The collection event\n       */\n      (evt) => {\n        if (!modifyingCollection) {\n          modifyingCollection = true;\n          this.removeFeature(evt.element);\n          modifyingCollection = false;\n        }\n      }\n    );\n    this.featuresCollection_ = collection;\n  }\n\n  /**\n   * Remove all features from the source.\n   * @param {boolean} [fast] Skip dispatching of {@link module:ol/source/Vector.VectorSourceEvent#event:removefeature} events.\n   * @api\n   */\n  clear(fast) {\n    if (fast) {\n      for (const featureId in this.featureChangeKeys_) {\n        const keys = this.featureChangeKeys_[featureId];\n        keys.forEach(unlistenByKey);\n      }\n      if (!this.featuresCollection_) {\n        this.featureChangeKeys_ = {};\n        this.idIndex_ = {};\n        this.uidIndex_ = {};\n      }\n    } else {\n      if (this.featuresRtree_) {\n        const removeAndIgnoreReturn = (feature) => {\n          this.removeFeatureInternal(feature);\n        };\n        this.featuresRtree_.forEach(removeAndIgnoreReturn);\n        for (const id in this.nullGeometryFeatures_) {\n          this.removeFeatureInternal(this.nullGeometryFeatures_[id]);\n        }\n      }\n    }\n    if (this.featuresCollection_) {\n      this.featuresCollection_.clear();\n    }\n\n    if (this.featuresRtree_) {\n      this.featuresRtree_.clear();\n    }\n    this.nullGeometryFeatures_ = {};\n\n    const clearEvent = new VectorSourceEvent(VectorEventType.CLEAR);\n    this.dispatchEvent(clearEvent);\n    this.changed();\n  }\n\n  /**\n   * Iterate through all features on the source, calling the provided callback\n   * with each one.  If the callback returns any \"truthy\" value, iteration will\n   * stop and the function will return the same value.\n   * Note: this function only iterate through the feature that have a defined geometry.\n   *\n   * @param {function(import(\"../Feature.js\").default<Geometry>): T} callback Called with each feature\n   *     on the source.  Return a truthy value to stop iteration.\n   * @return {T|undefined} The return value from the last call to the callback.\n   * @template T\n   * @api\n   */\n  forEachFeature(callback) {\n    if (this.featuresRtree_) {\n      return this.featuresRtree_.forEach(callback);\n    } else if (this.featuresCollection_) {\n      this.featuresCollection_.forEach(callback);\n    }\n  }\n\n  /**\n   * Iterate through all features whose geometries contain the provided\n   * coordinate, calling the callback with each feature.  If the callback returns\n   * a \"truthy\" value, iteration will stop and the function will return the same\n   * value.\n   *\n   * @param {import(\"../coordinate.js\").Coordinate} coordinate Coordinate.\n   * @param {function(import(\"../Feature.js\").default<Geometry>): T} callback Called with each feature\n   *     whose goemetry contains the provided coordinate.\n   * @return {T|undefined} The return value from the last call to the callback.\n   * @template T\n   */\n  forEachFeatureAtCoordinateDirect(coordinate, callback) {\n    const extent = [coordinate[0], coordinate[1], coordinate[0], coordinate[1]];\n    return this.forEachFeatureInExtent(extent, function (feature) {\n      const geometry = feature.getGeometry();\n      if (geometry.intersectsCoordinate(coordinate)) {\n        return callback(feature);\n      }\n      return undefined;\n    });\n  }\n\n  /**\n   * Iterate through all features whose bounding box intersects the provided\n   * extent (note that the feature's geometry may not intersect the extent),\n   * calling the callback with each feature.  If the callback returns a \"truthy\"\n   * value, iteration will stop and the function will return the same value.\n   *\n   * If you are interested in features whose geometry intersects an extent, call\n   * the {@link module:ol/source/Vector~VectorSource#forEachFeatureIntersectingExtent #forEachFeatureIntersectingExtent()} method instead.\n   *\n   * When `useSpatialIndex` is set to false, this method will loop through all\n   * features, equivalent to {@link module:ol/source/Vector~VectorSource#forEachFeature #forEachFeature()}.\n   *\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {function(import(\"../Feature.js\").default<Geometry>): T} callback Called with each feature\n   *     whose bounding box intersects the provided extent.\n   * @return {T|undefined} The return value from the last call to the callback.\n   * @template T\n   * @api\n   */\n  forEachFeatureInExtent(extent, callback) {\n    if (this.featuresRtree_) {\n      return this.featuresRtree_.forEachInExtent(extent, callback);\n    } else if (this.featuresCollection_) {\n      this.featuresCollection_.forEach(callback);\n    }\n  }\n\n  /**\n   * Iterate through all features whose geometry intersects the provided extent,\n   * calling the callback with each feature.  If the callback returns a \"truthy\"\n   * value, iteration will stop and the function will return the same value.\n   *\n   * If you only want to test for bounding box intersection, call the\n   * {@link module:ol/source/Vector~VectorSource#forEachFeatureInExtent #forEachFeatureInExtent()} method instead.\n   *\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {function(import(\"../Feature.js\").default<Geometry>): T} callback Called with each feature\n   *     whose geometry intersects the provided extent.\n   * @return {T|undefined} The return value from the last call to the callback.\n   * @template T\n   * @api\n   */\n  forEachFeatureIntersectingExtent(extent, callback) {\n    return this.forEachFeatureInExtent(\n      extent,\n      /**\n       * @param {import(\"../Feature.js\").default<Geometry>} feature Feature.\n       * @return {T|undefined} The return value from the last call to the callback.\n       */\n      function (feature) {\n        const geometry = feature.getGeometry();\n        if (geometry.intersectsExtent(extent)) {\n          const result = callback(feature);\n          if (result) {\n            return result;\n          }\n        }\n      }\n    );\n  }\n\n  /**\n   * Get the features collection associated with this source. Will be `null`\n   * unless the source was configured with `useSpatialIndex` set to `false`, or\n   * with an {@link module:ol/Collection~Collection} as `features`.\n   * @return {Collection<import(\"../Feature.js\").default<Geometry>>|null} The collection of features.\n   * @api\n   */\n  getFeaturesCollection() {\n    return this.featuresCollection_;\n  }\n\n  /**\n   * Get a snapshot of the features currently on the source in random order. The returned array\n   * is a copy, the features are references to the features in the source.\n   * @return {Array<import(\"../Feature.js\").default<Geometry>>} Features.\n   * @api\n   */\n  getFeatures() {\n    let features;\n    if (this.featuresCollection_) {\n      features = this.featuresCollection_.getArray().slice(0);\n    } else if (this.featuresRtree_) {\n      features = this.featuresRtree_.getAll();\n      if (!isEmpty(this.nullGeometryFeatures_)) {\n        extend(features, Object.values(this.nullGeometryFeatures_));\n      }\n    }\n    return /** @type {Array<import(\"../Feature.js\").default<Geometry>>} */ (\n      features\n    );\n  }\n\n  /**\n   * Get all features whose geometry intersects the provided coordinate.\n   * @param {import(\"../coordinate.js\").Coordinate} coordinate Coordinate.\n   * @return {Array<import(\"../Feature.js\").default<Geometry>>} Features.\n   * @api\n   */\n  getFeaturesAtCoordinate(coordinate) {\n    const features = [];\n    this.forEachFeatureAtCoordinateDirect(coordinate, function (feature) {\n      features.push(feature);\n    });\n    return features;\n  }\n\n  /**\n   * Get all features whose bounding box intersects the provided extent.  Note that this returns an array of\n   * all features intersecting the given extent in random order (so it may include\n   * features whose geometries do not intersect the extent).\n   *\n   * When `useSpatialIndex` is set to false, this method will return all\n   * features.\n   *\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {import(\"../proj/Projection.js\").default} [projection] Include features\n   * where `extent` exceeds the x-axis bounds of `projection` and wraps around the world.\n   * @return {Array<import(\"../Feature.js\").default<Geometry>>} Features.\n   * @api\n   */\n  getFeaturesInExtent(extent, projection) {\n    if (this.featuresRtree_) {\n      const multiWorld = projection && projection.canWrapX() && this.getWrapX();\n\n      if (!multiWorld) {\n        return this.featuresRtree_.getInExtent(extent);\n      }\n\n      const extents = wrapAndSliceX(extent, projection);\n\n      return [].concat(\n        ...extents.map((anExtent) => this.featuresRtree_.getInExtent(anExtent))\n      );\n    } else if (this.featuresCollection_) {\n      return this.featuresCollection_.getArray().slice(0);\n    }\n    return [];\n  }\n\n  /**\n   * Get the closest feature to the provided coordinate.\n   *\n   * This method is not available when the source is configured with\n   * `useSpatialIndex` set to `false`.\n   * @param {import(\"../coordinate.js\").Coordinate} coordinate Coordinate.\n   * @param {function(import(\"../Feature.js\").default<Geometry>):boolean} [filter] Feature filter function.\n   *     The filter function will receive one argument, the {@link module:ol/Feature~Feature feature}\n   *     and it should return a boolean value. By default, no filtering is made.\n   * @return {import(\"../Feature.js\").default<Geometry>} Closest feature.\n   * @api\n   */\n  getClosestFeatureToCoordinate(coordinate, filter) {\n    // Find the closest feature using branch and bound.  We start searching an\n    // infinite extent, and find the distance from the first feature found.  This\n    // becomes the closest feature.  We then compute a smaller extent which any\n    // closer feature must intersect.  We continue searching with this smaller\n    // extent, trying to find a closer feature.  Every time we find a closer\n    // feature, we update the extent being searched so that any even closer\n    // feature must intersect it.  We continue until we run out of features.\n    const x = coordinate[0];\n    const y = coordinate[1];\n    let closestFeature = null;\n    const closestPoint = [NaN, NaN];\n    let minSquaredDistance = Infinity;\n    const extent = [-Infinity, -Infinity, Infinity, Infinity];\n    filter = filter ? filter : TRUE;\n    this.featuresRtree_.forEachInExtent(\n      extent,\n      /**\n       * @param {import(\"../Feature.js\").default<Geometry>} feature Feature.\n       */\n      function (feature) {\n        if (filter(feature)) {\n          const geometry = feature.getGeometry();\n          const previousMinSquaredDistance = minSquaredDistance;\n          minSquaredDistance = geometry.closestPointXY(\n            x,\n            y,\n            closestPoint,\n            minSquaredDistance\n          );\n          if (minSquaredDistance < previousMinSquaredDistance) {\n            closestFeature = feature;\n            // This is sneaky.  Reduce the extent that it is currently being\n            // searched while the R-Tree traversal using this same extent object\n            // is still in progress.  This is safe because the new extent is\n            // strictly contained by the old extent.\n            const minDistance = Math.sqrt(minSquaredDistance);\n            extent[0] = x - minDistance;\n            extent[1] = y - minDistance;\n            extent[2] = x + minDistance;\n            extent[3] = y + minDistance;\n          }\n        }\n      }\n    );\n    return closestFeature;\n  }\n\n  /**\n   * Get the extent of the features currently in the source.\n   *\n   * This method is not available when the source is configured with\n   * `useSpatialIndex` set to `false`.\n   * @param {import(\"../extent.js\").Extent} [extent] Destination extent. If provided, no new extent\n   *     will be created. Instead, that extent's coordinates will be overwritten.\n   * @return {import(\"../extent.js\").Extent} Extent.\n   * @api\n   */\n  getExtent(extent) {\n    return this.featuresRtree_.getExtent(extent);\n  }\n\n  /**\n   * Get a feature by its identifier (the value returned by feature.getId()).\n   * Note that the index treats string and numeric identifiers as the same.  So\n   * `source.getFeatureById(2)` will return a feature with id `'2'` or `2`.\n   *\n   * @param {string|number} id Feature identifier.\n   * @return {import(\"../Feature.js\").default<Geometry>|null} The feature (or `null` if not found).\n   * @api\n   */\n  getFeatureById(id) {\n    const feature = this.idIndex_[id.toString()];\n    return feature !== undefined ? feature : null;\n  }\n\n  /**\n   * Get a feature by its internal unique identifier (using `getUid`).\n   *\n   * @param {string} uid Feature identifier.\n   * @return {import(\"../Feature.js\").default<Geometry>|null} The feature (or `null` if not found).\n   */\n  getFeatureByUid(uid) {\n    const feature = this.uidIndex_[uid];\n    return feature !== undefined ? feature : null;\n  }\n\n  /**\n   * Get the format associated with this source.\n   *\n   * @return {import(\"../format/Feature.js\").default|undefined} The feature format.\n   * @api\n   */\n  getFormat() {\n    return this.format_;\n  }\n\n  /**\n   * @return {boolean} The source can have overlapping geometries.\n   */\n  getOverlaps() {\n    return this.overlaps_;\n  }\n\n  /**\n   * Get the url associated with this source.\n   *\n   * @return {string|import(\"../featureloader.js\").FeatureUrlFunction|undefined} The url.\n   * @api\n   */\n  getUrl() {\n    return this.url_;\n  }\n\n  /**\n   * @param {Event} event Event.\n   * @private\n   */\n  handleFeatureChange_(event) {\n    const feature = /** @type {import(\"../Feature.js\").default<Geometry>} */ (\n      event.target\n    );\n    const featureKey = getUid(feature);\n    const geometry = feature.getGeometry();\n    if (!geometry) {\n      if (!(featureKey in this.nullGeometryFeatures_)) {\n        if (this.featuresRtree_) {\n          this.featuresRtree_.remove(feature);\n        }\n        this.nullGeometryFeatures_[featureKey] = feature;\n      }\n    } else {\n      const extent = geometry.getExtent();\n      if (featureKey in this.nullGeometryFeatures_) {\n        delete this.nullGeometryFeatures_[featureKey];\n        if (this.featuresRtree_) {\n          this.featuresRtree_.insert(extent, feature);\n        }\n      } else {\n        if (this.featuresRtree_) {\n          this.featuresRtree_.update(extent, feature);\n        }\n      }\n    }\n    const id = feature.getId();\n    if (id !== undefined) {\n      const sid = id.toString();\n      if (this.idIndex_[sid] !== feature) {\n        this.removeFromIdIndex_(feature);\n        this.idIndex_[sid] = feature;\n      }\n    } else {\n      this.removeFromIdIndex_(feature);\n      this.uidIndex_[featureKey] = feature;\n    }\n    this.changed();\n    this.dispatchEvent(\n      new VectorSourceEvent(VectorEventType.CHANGEFEATURE, feature)\n    );\n  }\n\n  /**\n   * Returns true if the feature is contained within the source.\n   * @param {import(\"../Feature.js\").default<Geometry>} feature Feature.\n   * @return {boolean} Has feature.\n   * @api\n   */\n  hasFeature(feature) {\n    const id = feature.getId();\n    if (id !== undefined) {\n      return id in this.idIndex_;\n    }\n    return getUid(feature) in this.uidIndex_;\n  }\n\n  /**\n   * @return {boolean} Is empty.\n   */\n  isEmpty() {\n    if (this.featuresRtree_) {\n      return (\n        this.featuresRtree_.isEmpty() && isEmpty(this.nullGeometryFeatures_)\n      );\n    }\n    if (this.featuresCollection_) {\n      return this.featuresCollection_.getLength() === 0;\n    }\n    return true;\n  }\n\n  /**\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {number} resolution Resolution.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   */\n  loadFeatures(extent, resolution, projection) {\n    const loadedExtentsRtree = this.loadedExtentsRtree_;\n    const extentsToLoad = this.strategy_(extent, resolution, projection);\n    for (let i = 0, ii = extentsToLoad.length; i < ii; ++i) {\n      const extentToLoad = extentsToLoad[i];\n      const alreadyLoaded = loadedExtentsRtree.forEachInExtent(\n        extentToLoad,\n        /**\n         * @param {{extent: import(\"../extent.js\").Extent}} object Object.\n         * @return {boolean} Contains.\n         */\n        function (object) {\n          return containsExtent(object.extent, extentToLoad);\n        }\n      );\n      if (!alreadyLoaded) {\n        ++this.loadingExtentsCount_;\n        this.dispatchEvent(\n          new VectorSourceEvent(VectorEventType.FEATURESLOADSTART)\n        );\n        this.loader_.call(\n          this,\n          extentToLoad,\n          resolution,\n          projection,\n          (features) => {\n            --this.loadingExtentsCount_;\n            this.dispatchEvent(\n              new VectorSourceEvent(\n                VectorEventType.FEATURESLOADEND,\n                undefined,\n                features\n              )\n            );\n          },\n          () => {\n            --this.loadingExtentsCount_;\n            this.dispatchEvent(\n              new VectorSourceEvent(VectorEventType.FEATURESLOADERROR)\n            );\n          }\n        );\n        loadedExtentsRtree.insert(extentToLoad, {extent: extentToLoad.slice()});\n      }\n    }\n    this.loading =\n      this.loader_.length < 4 ? false : this.loadingExtentsCount_ > 0;\n  }\n\n  refresh() {\n    this.clear(true);\n    this.loadedExtentsRtree_.clear();\n    super.refresh();\n  }\n\n  /**\n   * Remove an extent from the list of loaded extents.\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @api\n   */\n  removeLoadedExtent(extent) {\n    const loadedExtentsRtree = this.loadedExtentsRtree_;\n    let obj;\n    loadedExtentsRtree.forEachInExtent(extent, function (object) {\n      if (equals(object.extent, extent)) {\n        obj = object;\n        return true;\n      }\n    });\n    if (obj) {\n      loadedExtentsRtree.remove(obj);\n    }\n  }\n\n  /**\n   * Remove a single feature from the source.  If you want to remove all features\n   * at once, use the {@link module:ol/source/Vector~VectorSource#clear #clear()} method\n   * instead.\n   * @param {import(\"../Feature.js\").default<Geometry>} feature Feature to remove.\n   * @api\n   */\n  removeFeature(feature) {\n    if (!feature) {\n      return;\n    }\n    const featureKey = getUid(feature);\n    if (featureKey in this.nullGeometryFeatures_) {\n      delete this.nullGeometryFeatures_[featureKey];\n    } else {\n      if (this.featuresRtree_) {\n        this.featuresRtree_.remove(feature);\n      }\n    }\n    const result = this.removeFeatureInternal(feature);\n    if (result) {\n      this.changed();\n    }\n  }\n\n  /**\n   * Remove feature without firing a `change` event.\n   * @param {import(\"../Feature.js\").default<Geometry>} feature Feature.\n   * @return {import(\"../Feature.js\").default<Geometry>|undefined} The removed feature\n   *     (or undefined if the feature was not found).\n   * @protected\n   */\n  removeFeatureInternal(feature) {\n    const featureKey = getUid(feature);\n    const featureChangeKeys = this.featureChangeKeys_[featureKey];\n    if (!featureChangeKeys) {\n      return;\n    }\n    featureChangeKeys.forEach(unlistenByKey);\n    delete this.featureChangeKeys_[featureKey];\n    const id = feature.getId();\n    if (id !== undefined) {\n      delete this.idIndex_[id.toString()];\n    }\n    delete this.uidIndex_[featureKey];\n    this.dispatchEvent(\n      new VectorSourceEvent(VectorEventType.REMOVEFEATURE, feature)\n    );\n    return feature;\n  }\n\n  /**\n   * Remove a feature from the id index.  Called internally when the feature id\n   * may have changed.\n   * @param {import(\"../Feature.js\").default<Geometry>} feature The feature.\n   * @return {boolean} Removed the feature from the index.\n   * @private\n   */\n  removeFromIdIndex_(feature) {\n    let removed = false;\n    for (const id in this.idIndex_) {\n      if (this.idIndex_[id] === feature) {\n        delete this.idIndex_[id];\n        removed = true;\n        break;\n      }\n    }\n    return removed;\n  }\n\n  /**\n   * Set the new loader of the source. The next render cycle will use the\n   * new loader.\n   * @param {import(\"../featureloader.js\").FeatureLoader} loader The loader to set.\n   * @api\n   */\n  setLoader(loader) {\n    this.loader_ = loader;\n  }\n\n  /**\n   * Points the source to a new url. The next render cycle will use the new url.\n   * @param {string|import(\"../featureloader.js\").FeatureUrlFunction} url Url.\n   * @api\n   */\n  setUrl(url) {\n    assert(this.format_, 7); // `format` must be set when `url` is set\n    this.url_ = url;\n    this.setLoader(xhr(url, this.format_));\n  }\n}\n\nexport default VectorSource;\n","/**\n * @module ol/render\n */\nimport CanvasImmediateRenderer from './render/canvas/Immediate.js';\nimport {DEVICE_PIXEL_RATIO} from './has.js';\nimport {\n  apply as applyTransform,\n  create as createTransform,\n  multiply as multiplyTransform,\n  scale as scaleTransform,\n} from './transform.js';\nimport {getSquaredTolerance} from './renderer/vector.js';\nimport {getTransformFromProjections, getUserProjection} from './proj.js';\n\n/**\n * @typedef {Object} State\n * @property {CanvasRenderingContext2D} context Canvas context that the layer is being rendered to.\n * @property {import(\"./Feature.js\").FeatureLike} feature Feature.\n * @property {import(\"./geom/SimpleGeometry.js\").default} geometry Geometry.\n * @property {number} pixelRatio Pixel ratio used by the layer renderer.\n * @property {number} resolution Resolution that the render batch was created and optimized for.\n * This is not the view's resolution that is being rendered.\n * @property {number} rotation Rotation of the rendered layer in radians.\n */\n\n/**\n * A function to be used when sorting features before rendering.\n * It takes two instances of {@link module:ol/Feature~Feature} or\n * {@link module:ol/render/Feature~RenderFeature} and returns a `{number}`.\n *\n * @typedef {function(import(\"./Feature.js\").FeatureLike, import(\"./Feature.js\").FeatureLike):number} OrderFunction\n */\n\n/**\n * @typedef {Object} ToContextOptions\n * @property {import(\"./size.js\").Size} [size] Desired size of the canvas in css\n * pixels. When provided, both canvas and css size will be set according to the\n * `pixelRatio`. If not provided, the current canvas and css sizes will not be\n * altered.\n * @property {number} [pixelRatio=window.devicePixelRatio] Pixel ratio (canvas\n * pixel to css pixel ratio) for the canvas.\n */\n\n/**\n * Binds a Canvas Immediate API to a canvas context, to allow drawing geometries\n * to the context's canvas.\n *\n * The units for geometry coordinates are css pixels relative to the top left\n * corner of the canvas element.\n * ```js\n * import {toContext} from 'ol/render.js';\n * import Fill from 'ol/style/Fill.js';\n * import Polygon from 'ol/geom/Polygon.js';\n *\n * const canvas = document.createElement('canvas');\n * const render = toContext(\n *     canvas.getContext('2d'),\n *     {size: [100, 100]}\n * );\n * render.setFillStrokeStyle(new Fill({ color: blue }));\n * render.drawPolygon(\n *     new Polygon([[[0, 0], [100, 100], [100, 0], [0, 0]]])\n * );\n * ```\n *\n * @param {CanvasRenderingContext2D} context Canvas context.\n * @param {ToContextOptions} [options] Options.\n * @return {CanvasImmediateRenderer} Canvas Immediate.\n * @api\n */\nexport function toContext(context, options) {\n  const canvas = context.canvas;\n  options = options ? options : {};\n  const pixelRatio = options.pixelRatio || DEVICE_PIXEL_RATIO;\n  const size = options.size;\n  if (size) {\n    canvas.width = size[0] * pixelRatio;\n    canvas.height = size[1] * pixelRatio;\n    canvas.style.width = size[0] + 'px';\n    canvas.style.height = size[1] + 'px';\n  }\n  const extent = [0, 0, canvas.width, canvas.height];\n  const transform = scaleTransform(createTransform(), pixelRatio, pixelRatio);\n  return new CanvasImmediateRenderer(context, pixelRatio, extent, transform, 0);\n}\n\n/**\n * Gets a vector context for drawing to the event's canvas.\n * @param {import(\"./render/Event.js\").default} event Render event.\n * @return {CanvasImmediateRenderer} Vector context.\n * @api\n */\nexport function getVectorContext(event) {\n  if (!(event.context instanceof CanvasRenderingContext2D)) {\n    throw new Error('Only works for render events from Canvas 2D layers');\n  }\n\n  // canvas may be at a different pixel ratio than frameState.pixelRatio\n  const a = event.inversePixelTransform[0];\n  const b = event.inversePixelTransform[1];\n  const canvasPixelRatio = Math.sqrt(a * a + b * b);\n  const frameState = event.frameState;\n  const transform = multiplyTransform(\n    event.inversePixelTransform.slice(),\n    frameState.coordinateToPixelTransform\n  );\n  const squaredTolerance = getSquaredTolerance(\n    frameState.viewState.resolution,\n    canvasPixelRatio\n  );\n  let userTransform;\n  const userProjection = getUserProjection();\n  if (userProjection) {\n    userTransform = getTransformFromProjections(\n      userProjection,\n      frameState.viewState.projection\n    );\n  }\n\n  return new CanvasImmediateRenderer(\n    event.context,\n    canvasPixelRatio,\n    frameState.extent,\n    transform,\n    frameState.viewState.rotation,\n    squaredTolerance,\n    userTransform\n  );\n}\n\n/**\n * Gets the pixel of the event's canvas context from the map viewport's CSS pixel.\n * @param {import(\"./render/Event.js\").default} event Render event.\n * @param {import(\"./pixel.js\").Pixel} pixel CSS pixel relative to the top-left\n * corner of the map viewport.\n * @return {import(\"./pixel.js\").Pixel} Pixel on the event's canvas context.\n * @api\n */\nexport function getRenderPixel(event, pixel) {\n  return applyTransform(event.inversePixelTransform, pixel.slice(0));\n}\n","/**\n * @module ol/Overlay\n */\nimport BaseObject from './Object.js';\nimport MapEventType from './MapEventType.js';\nimport {CLASS_SELECTABLE} from './css.js';\nimport {containsExtent} from './extent.js';\nimport {listen, unlistenByKey} from './events.js';\nimport {outerHeight, outerWidth, removeChildren, removeNode} from './dom.js';\n\n/**\n * @typedef {'bottom-left' | 'bottom-center' | 'bottom-right' | 'center-left' | 'center-center' | 'center-right' | 'top-left' | 'top-center' | 'top-right'} Positioning\n * The overlay position: `'bottom-left'`, `'bottom-center'`,  `'bottom-right'`,\n * `'center-left'`, `'center-center'`, `'center-right'`, `'top-left'`,\n * `'top-center'`, or `'top-right'`.\n */\n\n/**\n * @typedef {Object} Options\n * @property {number|string} [id] Set the overlay id. The overlay id can be used\n * with the {@link module:ol/Map~Map#getOverlayById} method.\n * @property {HTMLElement} [element] The overlay element.\n * @property {Array<number>} [offset=[0, 0]] Offsets in pixels used when positioning\n * the overlay. The first element in the\n * array is the horizontal offset. A positive value shifts the overlay right.\n * The second element in the array is the vertical offset. A positive value\n * shifts the overlay down.\n * @property {import(\"./coordinate.js\").Coordinate} [position] The overlay position\n * in map projection.\n * @property {Positioning} [positioning='top-left'] Defines how\n * the overlay is actually positioned with respect to its `position` property.\n * Possible values are `'bottom-left'`, `'bottom-center'`, `'bottom-right'`,\n * `'center-left'`, `'center-center'`, `'center-right'`, `'top-left'`,\n * `'top-center'`, and `'top-right'`.\n * @property {boolean} [stopEvent=true] Whether event propagation to the map\n * viewport should be stopped. If `true` the overlay is placed in the same\n * container as that of the controls (CSS class name\n * `ol-overlaycontainer-stopevent`); if `false` it is placed in the container\n * with CSS class name specified by the `className` property.\n * @property {boolean} [insertFirst=true] Whether the overlay is inserted first\n * in the overlay container, or appended. If the overlay is placed in the same\n * container as that of the controls (see the `stopEvent` option) you will\n * probably set `insertFirst` to `true` so the overlay is displayed below the\n * controls.\n * @property {PanIntoViewOptions|boolean} [autoPan=false] Pan the map when calling\n * `setPosition`, so that the overlay is entirely visible in the current viewport.\n * @property {string} [className='ol-overlay-container ol-selectable'] CSS class\n * name.\n */\n\n/**\n * @typedef {Object} PanOptions\n * @property {number} [duration=1000] The duration of the animation in\n * milliseconds.\n * @property {function(number):number} [easing] The easing function to use. Can\n * be one from {@link module:ol/easing} or a custom function.\n * Default is {@link module:ol/easing.inAndOut}.\n */\n\n/**\n * @typedef {Object} PanIntoViewOptions\n * @property {PanOptions} [animation={}] The animation parameters for the pan\n * @property {number} [margin=20] The margin (in pixels) between the\n * overlay and the borders of the map when panning into view.\n */\n\n/**\n * @enum {string}\n * @protected\n */\nconst Property = {\n  ELEMENT: 'element',\n  MAP: 'map',\n  OFFSET: 'offset',\n  POSITION: 'position',\n  POSITIONING: 'positioning',\n};\n\n/**\n * @typedef {import(\"./ObjectEventType\").Types|'change:element'|'change:map'|'change:offset'|'change:position'|\n *   'change:positioning'} OverlayObjectEventTypes\n */\n\n/***\n * @template Return\n * @typedef {import(\"./Observable\").OnSignature<import(\"./Observable\").EventTypes, import(\"./events/Event.js\").default, Return> &\n *   import(\"./Observable\").OnSignature<OverlayObjectEventTypes, import(\"./Object\").ObjectEvent, Return> &\n *   import(\"./Observable\").CombinedOnSignature<import(\"./Observable\").EventTypes|OverlayObjectEventTypes, Return>} OverlayOnSignature\n */\n\n/**\n * @classdesc\n * An element to be displayed over the map and attached to a single map\n * location.  Like {@link module:ol/control/Control~Control}, Overlays are\n * visible widgets. Unlike Controls, they are not in a fixed position on the\n * screen, but are tied to a geographical coordinate, so panning the map will\n * move an Overlay but not a Control.\n *\n * Example:\n *\n *     import Overlay from 'ol/Overlay.js';\n *\n *     // ...\n *     const popup = new Overlay({\n *       element: document.getElementById('popup'),\n *     });\n *     popup.setPosition(coordinate);\n *     map.addOverlay(popup);\n *\n * @api\n */\nclass Overlay extends BaseObject {\n  /**\n   * @param {Options} options Overlay options.\n   */\n  constructor(options) {\n    super();\n\n    /***\n     * @type {OverlayOnSignature<import(\"./events\").EventsKey>}\n     */\n    this.on;\n\n    /***\n     * @type {OverlayOnSignature<import(\"./events\").EventsKey>}\n     */\n    this.once;\n\n    /***\n     * @type {OverlayOnSignature<void>}\n     */\n    this.un;\n\n    /**\n     * @protected\n     * @type {Options}\n     */\n    this.options = options;\n\n    /**\n     * @protected\n     * @type {number|string|undefined}\n     */\n    this.id = options.id;\n\n    /**\n     * @protected\n     * @type {boolean}\n     */\n    this.insertFirst =\n      options.insertFirst !== undefined ? options.insertFirst : true;\n\n    /**\n     * @protected\n     * @type {boolean}\n     */\n    this.stopEvent = options.stopEvent !== undefined ? options.stopEvent : true;\n\n    /**\n     * @protected\n     * @type {HTMLElement}\n     */\n    this.element = document.createElement('div');\n    this.element.className =\n      options.className !== undefined\n        ? options.className\n        : 'ol-overlay-container ' + CLASS_SELECTABLE;\n    this.element.style.position = 'absolute';\n    this.element.style.pointerEvents = 'auto';\n\n    /**\n     * @protected\n     * @type {PanIntoViewOptions|undefined}\n     */\n    this.autoPan = options.autoPan === true ? {} : options.autoPan || undefined;\n\n    /**\n     * @protected\n     * @type {{transform_: string,\n     *         visible: boolean}}\n     */\n    this.rendered = {\n      transform_: '',\n      visible: true,\n    };\n\n    /**\n     * @protected\n     * @type {?import(\"./events.js\").EventsKey}\n     */\n    this.mapPostrenderListenerKey = null;\n\n    this.addChangeListener(Property.ELEMENT, this.handleElementChanged);\n    this.addChangeListener(Property.MAP, this.handleMapChanged);\n    this.addChangeListener(Property.OFFSET, this.handleOffsetChanged);\n    this.addChangeListener(Property.POSITION, this.handlePositionChanged);\n    this.addChangeListener(Property.POSITIONING, this.handlePositioningChanged);\n\n    if (options.element !== undefined) {\n      this.setElement(options.element);\n    }\n\n    this.setOffset(options.offset !== undefined ? options.offset : [0, 0]);\n\n    this.setPositioning(options.positioning || 'top-left');\n\n    if (options.position !== undefined) {\n      this.setPosition(options.position);\n    }\n  }\n\n  /**\n   * Get the DOM element of this overlay.\n   * @return {HTMLElement|undefined} The Element containing the overlay.\n   * @observable\n   * @api\n   */\n  getElement() {\n    return /** @type {HTMLElement|undefined} */ (this.get(Property.ELEMENT));\n  }\n\n  /**\n   * Get the overlay identifier which is set on constructor.\n   * @return {number|string|undefined} Id.\n   * @api\n   */\n  getId() {\n    return this.id;\n  }\n\n  /**\n   * Get the map associated with this overlay.\n   * @return {import(\"./Map.js\").default|null} The map that the\n   * overlay is part of.\n   * @observable\n   * @api\n   */\n  getMap() {\n    return /** @type {import(\"./Map.js\").default|null} */ (\n      this.get(Property.MAP) || null\n    );\n  }\n\n  /**\n   * Get the offset of this overlay.\n   * @return {Array<number>} The offset.\n   * @observable\n   * @api\n   */\n  getOffset() {\n    return /** @type {Array<number>} */ (this.get(Property.OFFSET));\n  }\n\n  /**\n   * Get the current position of this overlay.\n   * @return {import(\"./coordinate.js\").Coordinate|undefined} The spatial point that the overlay is\n   *     anchored at.\n   * @observable\n   * @api\n   */\n  getPosition() {\n    return /** @type {import(\"./coordinate.js\").Coordinate|undefined} */ (\n      this.get(Property.POSITION)\n    );\n  }\n\n  /**\n   * Get the current positioning of this overlay.\n   * @return {Positioning} How the overlay is positioned\n   *     relative to its point on the map.\n   * @observable\n   * @api\n   */\n  getPositioning() {\n    return /** @type {Positioning} */ (this.get(Property.POSITIONING));\n  }\n\n  /**\n   * @protected\n   */\n  handleElementChanged() {\n    removeChildren(this.element);\n    const element = this.getElement();\n    if (element) {\n      this.element.appendChild(element);\n    }\n  }\n\n  /**\n   * @protected\n   */\n  handleMapChanged() {\n    if (this.mapPostrenderListenerKey) {\n      removeNode(this.element);\n      unlistenByKey(this.mapPostrenderListenerKey);\n      this.mapPostrenderListenerKey = null;\n    }\n    const map = this.getMap();\n    if (map) {\n      this.mapPostrenderListenerKey = listen(\n        map,\n        MapEventType.POSTRENDER,\n        this.render,\n        this\n      );\n      this.updatePixelPosition();\n      const container = this.stopEvent\n        ? map.getOverlayContainerStopEvent()\n        : map.getOverlayContainer();\n      if (this.insertFirst) {\n        container.insertBefore(this.element, container.childNodes[0] || null);\n      } else {\n        container.appendChild(this.element);\n      }\n      this.performAutoPan();\n    }\n  }\n\n  /**\n   * @protected\n   */\n  render() {\n    this.updatePixelPosition();\n  }\n\n  /**\n   * @protected\n   */\n  handleOffsetChanged() {\n    this.updatePixelPosition();\n  }\n\n  /**\n   * @protected\n   */\n  handlePositionChanged() {\n    this.updatePixelPosition();\n    this.performAutoPan();\n  }\n\n  /**\n   * @protected\n   */\n  handlePositioningChanged() {\n    this.updatePixelPosition();\n  }\n\n  /**\n   * Set the DOM element to be associated with this overlay.\n   * @param {HTMLElement|undefined} element The Element containing the overlay.\n   * @observable\n   * @api\n   */\n  setElement(element) {\n    this.set(Property.ELEMENT, element);\n  }\n\n  /**\n   * Set the map to be associated with this overlay.\n   * @param {import(\"./Map.js\").default|null} map The map that the\n   * overlay is part of. Pass `null` to just remove the overlay from the current map.\n   * @observable\n   * @api\n   */\n  setMap(map) {\n    this.set(Property.MAP, map);\n  }\n\n  /**\n   * Set the offset for this overlay.\n   * @param {Array<number>} offset Offset.\n   * @observable\n   * @api\n   */\n  setOffset(offset) {\n    this.set(Property.OFFSET, offset);\n  }\n\n  /**\n   * Set the position for this overlay. If the position is `undefined` the\n   * overlay is hidden.\n   * @param {import(\"./coordinate.js\").Coordinate|undefined} position The spatial point that the overlay\n   *     is anchored at.\n   * @observable\n   * @api\n   */\n  setPosition(position) {\n    this.set(Property.POSITION, position);\n  }\n\n  /**\n   * Pan the map so that the overlay is entirely visible in the current viewport\n   * (if necessary) using the configured autoPan parameters\n   * @protected\n   */\n  performAutoPan() {\n    if (this.autoPan) {\n      this.panIntoView(this.autoPan);\n    }\n  }\n\n  /**\n   * Pan the map so that the overlay is entirely visible in the current viewport\n   * (if necessary).\n   * @param {PanIntoViewOptions} [panIntoViewOptions] Options for the pan action\n   * @api\n   */\n  panIntoView(panIntoViewOptions) {\n    const map = this.getMap();\n\n    if (!map || !map.getTargetElement() || !this.get(Property.POSITION)) {\n      return;\n    }\n\n    const mapRect = this.getRect(map.getTargetElement(), map.getSize());\n    const element = this.getElement();\n    const overlayRect = this.getRect(element, [\n      outerWidth(element),\n      outerHeight(element),\n    ]);\n\n    panIntoViewOptions = panIntoViewOptions || {};\n\n    const myMargin =\n      panIntoViewOptions.margin === undefined ? 20 : panIntoViewOptions.margin;\n    if (!containsExtent(mapRect, overlayRect)) {\n      // the overlay is not completely inside the viewport, so pan the map\n      const offsetLeft = overlayRect[0] - mapRect[0];\n      const offsetRight = mapRect[2] - overlayRect[2];\n      const offsetTop = overlayRect[1] - mapRect[1];\n      const offsetBottom = mapRect[3] - overlayRect[3];\n\n      const delta = [0, 0];\n      if (offsetLeft < 0) {\n        // move map to the left\n        delta[0] = offsetLeft - myMargin;\n      } else if (offsetRight < 0) {\n        // move map to the right\n        delta[0] = Math.abs(offsetRight) + myMargin;\n      }\n      if (offsetTop < 0) {\n        // move map up\n        delta[1] = offsetTop - myMargin;\n      } else if (offsetBottom < 0) {\n        // move map down\n        delta[1] = Math.abs(offsetBottom) + myMargin;\n      }\n\n      if (delta[0] !== 0 || delta[1] !== 0) {\n        const center = /** @type {import(\"./coordinate.js\").Coordinate} */ (\n          map.getView().getCenterInternal()\n        );\n        const centerPx = map.getPixelFromCoordinateInternal(center);\n        if (!centerPx) {\n          return;\n        }\n        const newCenterPx = [centerPx[0] + delta[0], centerPx[1] + delta[1]];\n\n        const panOptions = panIntoViewOptions.animation || {};\n        map.getView().animateInternal({\n          center: map.getCoordinateFromPixelInternal(newCenterPx),\n          duration: panOptions.duration,\n          easing: panOptions.easing,\n        });\n      }\n    }\n  }\n\n  /**\n   * Get the extent of an element relative to the document\n   * @param {HTMLElement} element The element.\n   * @param {import(\"./size.js\").Size} size The size of the element.\n   * @return {import(\"./extent.js\").Extent} The extent.\n   * @protected\n   */\n  getRect(element, size) {\n    const box = element.getBoundingClientRect();\n    const offsetX = box.left + window.pageXOffset;\n    const offsetY = box.top + window.pageYOffset;\n    return [offsetX, offsetY, offsetX + size[0], offsetY + size[1]];\n  }\n\n  /**\n   * Set the positioning for this overlay.\n   * @param {Positioning} positioning how the overlay is\n   *     positioned relative to its point on the map.\n   * @observable\n   * @api\n   */\n  setPositioning(positioning) {\n    this.set(Property.POSITIONING, positioning);\n  }\n\n  /**\n   * Modify the visibility of the element.\n   * @param {boolean} visible Element visibility.\n   * @protected\n   */\n  setVisible(visible) {\n    if (this.rendered.visible !== visible) {\n      this.element.style.display = visible ? '' : 'none';\n      this.rendered.visible = visible;\n    }\n  }\n\n  /**\n   * Update pixel position.\n   * @protected\n   */\n  updatePixelPosition() {\n    const map = this.getMap();\n    const position = this.getPosition();\n    if (!map || !map.isRendered() || !position) {\n      this.setVisible(false);\n      return;\n    }\n\n    const pixel = map.getPixelFromCoordinate(position);\n    const mapSize = map.getSize();\n    this.updateRenderedPosition(pixel, mapSize);\n  }\n\n  /**\n   * @param {import(\"./pixel.js\").Pixel} pixel The pixel location.\n   * @param {import(\"./size.js\").Size|undefined} mapSize The map size.\n   * @protected\n   */\n  updateRenderedPosition(pixel, mapSize) {\n    const style = this.element.style;\n    const offset = this.getOffset();\n\n    const positioning = this.getPositioning();\n\n    this.setVisible(true);\n\n    const x = Math.round(pixel[0] + offset[0]) + 'px';\n    const y = Math.round(pixel[1] + offset[1]) + 'px';\n    let posX = '0%';\n    let posY = '0%';\n    if (\n      positioning == 'bottom-right' ||\n      positioning == 'center-right' ||\n      positioning == 'top-right'\n    ) {\n      posX = '-100%';\n    } else if (\n      positioning == 'bottom-center' ||\n      positioning == 'center-center' ||\n      positioning == 'top-center'\n    ) {\n      posX = '-50%';\n    }\n    if (\n      positioning == 'bottom-left' ||\n      positioning == 'bottom-center' ||\n      positioning == 'bottom-right'\n    ) {\n      posY = '-100%';\n    } else if (\n      positioning == 'center-left' ||\n      positioning == 'center-center' ||\n      positioning == 'center-right'\n    ) {\n      posY = '-50%';\n    }\n    const transform = `translate(${posX}, ${posY}) translate(${x}, ${y})`;\n    if (this.rendered.transform_ != transform) {\n      this.rendered.transform_ = transform;\n      style.transform = transform;\n    }\n  }\n\n  /**\n   * returns the options this Overlay has been created with\n   * @return {Options} overlay options\n   */\n  getOptions() {\n    return this.options;\n  }\n}\n\nexport default Overlay;\n","/**\n * @module ol/VectorRenderTile\n */\nimport Tile from './Tile.js';\nimport {createCanvasContext2D, releaseCanvas} from './dom.js';\nimport {getUid} from './util.js';\n\n/**\n * @typedef {Object} ReplayState\n * @property {boolean} dirty Dirty.\n * @property {null|import(\"./render.js\").OrderFunction} renderedRenderOrder RenderedRenderOrder.\n * @property {number} renderedTileRevision RenderedTileRevision.\n * @property {number} renderedResolution RenderedResolution.\n * @property {number} renderedRevision RenderedRevision.\n * @property {number} renderedTileResolution RenderedTileResolution.\n * @property {number} renderedTileZ RenderedTileZ.\n */\n\n/**\n * @type {Array<HTMLCanvasElement>}\n */\nconst canvasPool = [];\n\nclass VectorRenderTile extends Tile {\n  /**\n   * @param {import(\"./tilecoord.js\").TileCoord} tileCoord Tile coordinate.\n   * @param {import(\"./TileState.js\").default} state State.\n   * @param {import(\"./tilecoord.js\").TileCoord} urlTileCoord Wrapped tile coordinate for source urls.\n   * @param {function(VectorRenderTile):Array<import(\"./VectorTile\").default>} getSourceTiles Function\n   * to get source tiles for this tile.\n   */\n  constructor(tileCoord, state, urlTileCoord, getSourceTiles) {\n    super(tileCoord, state, {transition: 0});\n\n    /**\n     * @private\n     * @type {!Object<string, CanvasRenderingContext2D>}\n     */\n    this.context_ = {};\n\n    /**\n     * Executor groups by layer uid. Entries are read/written by the renderer.\n     * @type {Object<string, Array<import(\"./render/canvas/ExecutorGroup.js\").default>>}\n     */\n    this.executorGroups = {};\n\n    /**\n     * Executor groups for decluttering, by layer uid. Entries are read/written by the renderer.\n     * @type {Object<string, Array<import(\"./render/canvas/ExecutorGroup.js\").default>>}\n     */\n    this.declutterExecutorGroups = {};\n\n    /**\n     * Number of loading source tiles. Read/written by the source.\n     * @type {number}\n     */\n    this.loadingSourceTiles = 0;\n\n    /**\n     * @type {Object<number, ImageData>}\n     */\n    this.hitDetectionImageData = {};\n\n    /**\n     * @private\n     * @type {!Object<string, ReplayState>}\n     */\n    this.replayState_ = {};\n\n    /**\n     * @type {Array<import(\"./VectorTile.js\").default>}\n     */\n    this.sourceTiles = [];\n\n    /**\n     * @type {Object<string, boolean>}\n     */\n    this.errorTileKeys = {};\n\n    /**\n     * @type {number}\n     */\n    this.wantedResolution;\n\n    /**\n     * @type {!function():Array<import(\"./VectorTile.js\").default>}\n     */\n    this.getSourceTiles = getSourceTiles.bind(undefined, this);\n\n    /**\n     * @type {import(\"./tilecoord.js\").TileCoord}\n     */\n    this.wrappedTileCoord = urlTileCoord;\n  }\n\n  /**\n   * @param {import(\"./layer/Layer.js\").default} layer Layer.\n   * @return {CanvasRenderingContext2D} The rendering context.\n   */\n  getContext(layer) {\n    const key = getUid(layer);\n    if (!(key in this.context_)) {\n      this.context_[key] = createCanvasContext2D(1, 1, canvasPool);\n    }\n    return this.context_[key];\n  }\n\n  /**\n   * @param {import(\"./layer/Layer.js\").default} layer Layer.\n   * @return {boolean} Tile has a rendering context for the given layer.\n   */\n  hasContext(layer) {\n    return getUid(layer) in this.context_;\n  }\n\n  /**\n   * Get the Canvas for this tile.\n   * @param {import(\"./layer/Layer.js\").default} layer Layer.\n   * @return {HTMLCanvasElement} Canvas.\n   */\n  getImage(layer) {\n    return this.hasContext(layer) ? this.getContext(layer).canvas : null;\n  }\n\n  /**\n   * @param {import(\"./layer/Layer.js\").default} layer Layer.\n   * @return {ReplayState} The replay state.\n   */\n  getReplayState(layer) {\n    const key = getUid(layer);\n    if (!(key in this.replayState_)) {\n      this.replayState_[key] = {\n        dirty: false,\n        renderedRenderOrder: null,\n        renderedResolution: NaN,\n        renderedRevision: -1,\n        renderedTileResolution: NaN,\n        renderedTileRevision: -1,\n        renderedTileZ: -1,\n      };\n    }\n    return this.replayState_[key];\n  }\n\n  /**\n   * Load the tile.\n   */\n  load() {\n    this.getSourceTiles();\n  }\n\n  /**\n   * Remove from the cache due to expiry\n   */\n  release() {\n    for (const key in this.context_) {\n      const context = this.context_[key];\n      releaseCanvas(context);\n      canvasPool.push(context.canvas);\n      delete this.context_[key];\n    }\n    super.release();\n  }\n}\n\nexport default VectorRenderTile;\n","/**\n * @module ol/VectorTile\n */\nimport Tile from './Tile.js';\nimport TileState from './TileState.js';\n\nclass VectorTile extends Tile {\n  /**\n   * @param {import(\"./tilecoord.js\").TileCoord} tileCoord Tile coordinate.\n   * @param {import(\"./TileState.js\").default} state State.\n   * @param {string} src Data source url.\n   * @param {import(\"./format/Feature.js\").default} format Feature format.\n   * @param {import(\"./Tile.js\").LoadFunction} tileLoadFunction Tile load function.\n   * @param {import(\"./Tile.js\").Options} [options] Tile options.\n   */\n  constructor(tileCoord, state, src, format, tileLoadFunction, options) {\n    super(tileCoord, state, options);\n\n    /**\n     * Extent of this tile; set by the source.\n     * @type {import(\"./extent.js\").Extent}\n     */\n    this.extent = null;\n\n    /**\n     * @private\n     * @type {import(\"./format/Feature.js\").default}\n     */\n    this.format_ = format;\n\n    /**\n     * @private\n     * @type {Array<import(\"./Feature.js\").default>}\n     */\n    this.features_ = null;\n\n    /**\n     * @private\n     * @type {import(\"./featureloader.js\").FeatureLoader}\n     */\n    this.loader_;\n\n    /**\n     * Feature projection of this tile; set by the source.\n     * @type {import(\"./proj/Projection.js\").default}\n     */\n    this.projection = null;\n\n    /**\n     * Resolution of this tile; set by the source.\n     * @type {number}\n     */\n    this.resolution;\n\n    /**\n     * @private\n     * @type {import(\"./Tile.js\").LoadFunction}\n     */\n    this.tileLoadFunction_ = tileLoadFunction;\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.url_ = src;\n\n    this.key = src;\n  }\n\n  /**\n   * Get the feature format assigned for reading this tile's features.\n   * @return {import(\"./format/Feature.js\").default} Feature format.\n   * @api\n   */\n  getFormat() {\n    return this.format_;\n  }\n\n  /**\n   * Get the features for this tile. Geometries will be in the view projection.\n   * @return {Array<import(\"./Feature.js\").FeatureLike>} Features.\n   * @api\n   */\n  getFeatures() {\n    return this.features_;\n  }\n\n  /**\n   * Load not yet loaded URI.\n   */\n  load() {\n    if (this.state == TileState.IDLE) {\n      this.setState(TileState.LOADING);\n      this.tileLoadFunction_(this, this.url_);\n      if (this.loader_) {\n        this.loader_(this.extent, this.resolution, this.projection);\n      }\n    }\n  }\n\n  /**\n   * Handler for successful tile load.\n   * @param {Array<import(\"./Feature.js\").default>} features The loaded features.\n   * @param {import(\"./proj/Projection.js\").default} dataProjection Data projection.\n   */\n  onLoad(features, dataProjection) {\n    this.setFeatures(features);\n  }\n\n  /**\n   * Handler for tile load errors.\n   */\n  onError() {\n    this.setState(TileState.ERROR);\n  }\n\n  /**\n   * Function for use in an {@link module:ol/source/VectorTile~VectorTile}'s `tileLoadFunction`.\n   * Sets the features for the tile.\n   * @param {Array<import(\"./Feature.js\").default>} features Features.\n   * @api\n   */\n  setFeatures(features) {\n    this.features_ = features;\n    this.setState(TileState.LOADED);\n  }\n\n  /**\n   * Set the feature loader for reading this tile's features.\n   * @param {import(\"./featureloader.js\").FeatureLoader} loader Feature loader.\n   * @api\n   */\n  setLoader(loader) {\n    this.loader_ = loader;\n  }\n}\n\nexport default VectorTile;\n","/**\n * @module ol/source/Cluster\n */\n\nimport EventType from '../events/EventType.js';\nimport Feature from '../Feature.js';\nimport Point from '../geom/Point.js';\nimport VectorSource from './Vector.js';\nimport {add as addCoordinate, scale as scaleCoordinate} from '../coordinate.js';\nimport {assert} from '../asserts.js';\nimport {\n  buffer,\n  createEmpty,\n  createOrUpdateFromCoordinate,\n  getCenter,\n} from '../extent.js';\nimport {getUid} from '../util.js';\n\n/**\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {number} [distance=20] Distance in pixels within which features will\n * be clustered together.\n * @property {number} [minDistance=0] Minimum distance in pixels between clusters.\n * Will be capped at the configured distance.\n * By default no minimum distance is guaranteed. This config can be used to avoid\n * overlapping icons. As a tradoff, the cluster feature's position will no longer be\n * the center of all its features.\n * @property {function(Feature):Point} [geometryFunction]\n * Function that takes an {@link module:ol/Feature~Feature} as argument and returns an\n * {@link module:ol/geom/Point~Point} as cluster calculation point for the feature. When a\n * feature should not be considered for clustering, the function should return\n * `null`. The default, which works when the underlying source contains point\n * features only, is\n * ```js\n * function(feature) {\n *   return feature.getGeometry();\n * }\n * ```\n * See {@link module:ol/geom/Polygon~Polygon#getInteriorPoint} for a way to get a cluster\n * calculation point for polygons.\n * @property {function(Point, Array<Feature>):Feature} [createCluster]\n * Function that takes the cluster's center {@link module:ol/geom/Point~Point} and an array\n * of {@link module:ol/Feature~Feature} included in this cluster. Must return a\n * {@link module:ol/Feature~Feature} that will be used to render. Default implementation is:\n * ```js\n * function(point, features) {\n *   return new Feature({\n *     geometry: point,\n *     features: features\n *   });\n * }\n * ```\n * @property {VectorSource} [source=null] Source.\n * @property {boolean} [wrapX=true] Whether to wrap the world horizontally.\n */\n\n/**\n * @classdesc\n * Layer source to cluster vector data. Works out of the box with point\n * geometries. For other geometry types, or if not all geometries should be\n * considered for clustering, a custom `geometryFunction` can be defined.\n *\n * If the instance is disposed without also disposing the underlying\n * source `setSource(null)` has to be called to remove the listener reference\n * from the wrapped source.\n * @api\n */\nclass Cluster extends VectorSource {\n  /**\n   * @param {Options} options Cluster options.\n   */\n  constructor(options) {\n    super({\n      attributions: options.attributions,\n      wrapX: options.wrapX,\n    });\n\n    /**\n     * @type {number|undefined}\n     * @protected\n     */\n    this.resolution = undefined;\n\n    /**\n     * @type {number}\n     * @protected\n     */\n    this.distance = options.distance !== undefined ? options.distance : 20;\n\n    /**\n     * @type {number}\n     * @protected\n     */\n    this.minDistance = options.minDistance || 0;\n\n    /**\n     * @type {number}\n     * @protected\n     */\n    this.interpolationRatio = 0;\n\n    /**\n     * @type {Array<Feature>}\n     * @protected\n     */\n    this.features = [];\n\n    /**\n     * @param {Feature} feature Feature.\n     * @return {Point} Cluster calculation point.\n     * @protected\n     */\n    this.geometryFunction =\n      options.geometryFunction ||\n      function (feature) {\n        const geometry = /** @type {Point} */ (feature.getGeometry());\n        assert(geometry.getType() == 'Point', 10); // The default `geometryFunction` can only handle `Point` geometries\n        return geometry;\n      };\n\n    /**\n     * @type {function(Point, Array<Feature>):Feature}\n     * @private\n     */\n    this.createCustomCluster_ = options.createCluster;\n\n    /**\n     * @type {VectorSource|null}\n     * @protected\n     */\n    this.source = null;\n\n    /**\n     * @private\n     */\n    this.boundRefresh_ = this.refresh.bind(this);\n\n    this.updateDistance(this.distance, this.minDistance);\n    this.setSource(options.source || null);\n  }\n\n  /**\n   * Remove all features from the source.\n   * @param {boolean} [fast] Skip dispatching of {@link module:ol/source/VectorEventType~VectorEventType#removefeature} events.\n   * @api\n   */\n  clear(fast) {\n    this.features.length = 0;\n    super.clear(fast);\n  }\n\n  /**\n   * Get the distance in pixels between clusters.\n   * @return {number} Distance.\n   * @api\n   */\n  getDistance() {\n    return this.distance;\n  }\n\n  /**\n   * Get a reference to the wrapped source.\n   * @return {VectorSource|null} Source.\n   * @api\n   */\n  getSource() {\n    return this.source;\n  }\n\n  /**\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {number} resolution Resolution.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   */\n  loadFeatures(extent, resolution, projection) {\n    this.source.loadFeatures(extent, resolution, projection);\n    if (resolution !== this.resolution) {\n      this.resolution = resolution;\n      this.refresh();\n    }\n  }\n\n  /**\n   * Set the distance within which features will be clusterd together.\n   * @param {number} distance The distance in pixels.\n   * @api\n   */\n  setDistance(distance) {\n    this.updateDistance(distance, this.minDistance);\n  }\n\n  /**\n   * Set the minimum distance between clusters. Will be capped at the\n   * configured distance.\n   * @param {number} minDistance The minimum distance in pixels.\n   * @api\n   */\n  setMinDistance(minDistance) {\n    this.updateDistance(this.distance, minDistance);\n  }\n\n  /**\n   * The configured minimum distance between clusters.\n   * @return {number} The minimum distance in pixels.\n   * @api\n   */\n  getMinDistance() {\n    return this.minDistance;\n  }\n\n  /**\n   * Replace the wrapped source.\n   * @param {VectorSource|null} source The new source for this instance.\n   * @api\n   */\n  setSource(source) {\n    if (this.source) {\n      this.source.removeEventListener(EventType.CHANGE, this.boundRefresh_);\n    }\n    this.source = source;\n    if (source) {\n      source.addEventListener(EventType.CHANGE, this.boundRefresh_);\n    }\n    this.refresh();\n  }\n\n  /**\n   * Handle the source changing.\n   */\n  refresh() {\n    this.clear();\n    this.cluster();\n    this.addFeatures(this.features);\n  }\n\n  /**\n   * Update the distances and refresh the source if necessary.\n   * @param {number} distance The new distance.\n   * @param {number} minDistance The new minimum distance.\n   */\n  updateDistance(distance, minDistance) {\n    const ratio =\n      distance === 0 ? 0 : Math.min(minDistance, distance) / distance;\n    const changed =\n      distance !== this.distance || this.interpolationRatio !== ratio;\n    this.distance = distance;\n    this.minDistance = minDistance;\n    this.interpolationRatio = ratio;\n    if (changed) {\n      this.refresh();\n    }\n  }\n\n  /**\n   * @protected\n   */\n  cluster() {\n    if (this.resolution === undefined || !this.source) {\n      return;\n    }\n    const extent = createEmpty();\n    const mapDistance = this.distance * this.resolution;\n    const features = this.source.getFeatures();\n\n    /** @type {Object<string, true>} */\n    const clustered = {};\n\n    for (let i = 0, ii = features.length; i < ii; i++) {\n      const feature = features[i];\n      if (!(getUid(feature) in clustered)) {\n        const geometry = this.geometryFunction(feature);\n        if (geometry) {\n          const coordinates = geometry.getCoordinates();\n          createOrUpdateFromCoordinate(coordinates, extent);\n          buffer(extent, mapDistance, extent);\n\n          const neighbors = this.source\n            .getFeaturesInExtent(extent)\n            .filter(function (neighbor) {\n              const uid = getUid(neighbor);\n              if (uid in clustered) {\n                return false;\n              }\n              clustered[uid] = true;\n              return true;\n            });\n          this.features.push(this.createCluster(neighbors, extent));\n        }\n      }\n    }\n  }\n\n  /**\n   * @param {Array<Feature>} features Features\n   * @param {import(\"../extent.js\").Extent} extent The searched extent for these features.\n   * @return {Feature} The cluster feature.\n   * @protected\n   */\n  createCluster(features, extent) {\n    const centroid = [0, 0];\n    for (let i = features.length - 1; i >= 0; --i) {\n      const geometry = this.geometryFunction(features[i]);\n      if (geometry) {\n        addCoordinate(centroid, geometry.getCoordinates());\n      } else {\n        features.splice(i, 1);\n      }\n    }\n    scaleCoordinate(centroid, 1 / features.length);\n    const searchCenter = getCenter(extent);\n    const ratio = this.interpolationRatio;\n    const geometry = new Point([\n      centroid[0] * (1 - ratio) + searchCenter[0] * ratio,\n      centroid[1] * (1 - ratio) + searchCenter[1] * ratio,\n    ]);\n    if (this.createCustomCluster_) {\n      return this.createCustomCluster_(geometry, features);\n    }\n    return new Feature({\n      geometry,\n      features,\n    });\n  }\n}\n\nexport default Cluster;\n","/**\n * @module ol/source/ImageWMS\n */\n\nimport EventType from '../events/EventType.js';\nimport ImageSource, {defaultImageLoadFunction} from './Image.js';\nimport ImageWrapper from '../Image.js';\nimport {DEFAULT_VERSION} from './wms.js';\nimport {appendParams} from '../uri.js';\nimport {assert} from '../asserts.js';\nimport {calculateSourceResolution} from '../reproj.js';\nimport {ceil, floor, round} from '../math.js';\nimport {compareVersions} from '../string.js';\nimport {\n  containsExtent,\n  getCenter,\n  getForViewAndSize,\n  getHeight,\n  getWidth,\n} from '../extent.js';\nimport {get as getProjection, transform} from '../proj.js';\n\n/**\n * Number of decimal digits to consider in integer values when rounding.\n * @type {number}\n */\nconst DECIMALS = 4;\n\n/**\n * @const\n * @type {import(\"../size.js\").Size}\n */\nconst GETFEATUREINFO_IMAGE_SIZE = [101, 101];\n\n/**\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you want to access pixel data with the Canvas renderer.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image for more detail.\n * @property {boolean} [hidpi=true] Use the `ol/Map#pixelRatio` value when requesting\n * the image from the remote server.\n * @property {import(\"./wms.js\").ServerType} [serverType] The type of\n * the remote WMS server: `mapserver`, `geoserver`, `carmentaserver`, or `qgis`.\n * Only needed if `hidpi` is `true`.\n * @property {import(\"../Image.js\").LoadFunction} [imageLoadFunction] Optional function to load an image given a URL.\n * @property {boolean} [interpolate=true] Use interpolated values when resampling.  By default,\n * linear interpolation is used when resampling.  Set to false to use the nearest neighbor instead.\n * @property {Object<string,*>} [params] WMS request parameters.\n * At least a `LAYERS` param is required. `STYLES` is\n * `''` by default. `VERSION` is `1.3.0` by default. `WIDTH`, `HEIGHT`, `BBOX`\n * and `CRS` (`SRS` for WMS version < 1.3.0) will be set dynamically.\n * @property {import(\"../proj.js\").ProjectionLike} [projection] Projection. Default is the view projection.\n * @property {number} [ratio=1.5] Ratio. `1` means image requests are the size of the map viewport, `2` means\n * twice the width and height of the map viewport, and so on. Must be `1` or\n * higher.\n * @property {Array<number>} [resolutions] Resolutions.\n * If specified, requests will be made for these resolutions only.\n * @property {string} [url] WMS service URL.\n */\n\n/**\n * @classdesc\n * Source for WMS servers providing single, untiled images.\n *\n * @fires module:ol/source/Image.ImageSourceEvent\n * @api\n */\nclass ImageWMS extends ImageSource {\n  /**\n   * @param {Options} [options] ImageWMS options.\n   */\n  constructor(options) {\n    options = options ? options : {};\n\n    super({\n      attributions: options.attributions,\n      interpolate: options.interpolate,\n      projection: options.projection,\n      resolutions: options.resolutions,\n    });\n\n    /**\n     * @private\n     * @type {?string}\n     */\n    this.crossOrigin_ =\n      options.crossOrigin !== undefined ? options.crossOrigin : null;\n\n    /**\n     * @private\n     * @type {string|undefined}\n     */\n    this.url_ = options.url;\n\n    /**\n     * @private\n     * @type {import(\"../Image.js\").LoadFunction}\n     */\n    this.imageLoadFunction_ =\n      options.imageLoadFunction !== undefined\n        ? options.imageLoadFunction\n        : defaultImageLoadFunction;\n\n    /**\n     * @private\n     * @type {!Object}\n     */\n    this.params_ = Object.assign({}, options.params);\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.v13_ = true;\n    this.updateV13_();\n\n    /**\n     * @private\n     * @type {import(\"./wms.js\").ServerType}\n     */\n    this.serverType_ = options.serverType;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.hidpi_ = options.hidpi !== undefined ? options.hidpi : true;\n\n    /**\n     * @private\n     * @type {import(\"../Image.js\").default}\n     */\n    this.image_ = null;\n\n    /**\n     * @private\n     * @type {import(\"../size.js\").Size}\n     */\n    this.imageSize_ = [0, 0];\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.renderedRevision_ = 0;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.ratio_ = options.ratio !== undefined ? options.ratio : 1.5;\n  }\n\n  /**\n   * Return the GetFeatureInfo URL for the passed coordinate, resolution, and\n   * projection. Return `undefined` if the GetFeatureInfo URL cannot be\n   * constructed.\n   * @param {import(\"../coordinate.js\").Coordinate} coordinate Coordinate.\n   * @param {number} resolution Resolution.\n   * @param {import(\"../proj.js\").ProjectionLike} projection Projection.\n   * @param {!Object} params GetFeatureInfo params. `INFO_FORMAT` at least should\n   *     be provided. If `QUERY_LAYERS` is not provided then the layers specified\n   *     in the `LAYERS` parameter will be used. `VERSION` should not be\n   *     specified here.\n   * @return {string|undefined} GetFeatureInfo URL.\n   * @api\n   */\n  getFeatureInfoUrl(coordinate, resolution, projection, params) {\n    if (this.url_ === undefined) {\n      return undefined;\n    }\n    const projectionObj = getProjection(projection);\n    const sourceProjectionObj = this.getProjection();\n\n    if (sourceProjectionObj && sourceProjectionObj !== projectionObj) {\n      resolution = calculateSourceResolution(\n        sourceProjectionObj,\n        projectionObj,\n        coordinate,\n        resolution\n      );\n      coordinate = transform(coordinate, projectionObj, sourceProjectionObj);\n    }\n\n    const extent = getForViewAndSize(\n      coordinate,\n      resolution,\n      0,\n      GETFEATUREINFO_IMAGE_SIZE\n    );\n\n    const baseParams = {\n      'SERVICE': 'WMS',\n      'VERSION': DEFAULT_VERSION,\n      'REQUEST': 'GetFeatureInfo',\n      'FORMAT': 'image/png',\n      'TRANSPARENT': true,\n      'QUERY_LAYERS': this.params_['LAYERS'],\n    };\n    Object.assign(baseParams, this.params_, params);\n\n    const x = floor((coordinate[0] - extent[0]) / resolution, DECIMALS);\n    const y = floor((extent[3] - coordinate[1]) / resolution, DECIMALS);\n    baseParams[this.v13_ ? 'I' : 'X'] = x;\n    baseParams[this.v13_ ? 'J' : 'Y'] = y;\n\n    return this.getRequestUrl_(\n      extent,\n      GETFEATUREINFO_IMAGE_SIZE,\n      1,\n      sourceProjectionObj || projectionObj,\n      baseParams\n    );\n  }\n\n  /**\n   * Return the GetLegendGraphic URL, optionally optimized for the passed\n   * resolution and possibly including any passed specific parameters. Returns\n   * `undefined` if the GetLegendGraphic URL cannot be constructed.\n   *\n   * @param {number} [resolution] Resolution. If set to undefined, `SCALE`\n   *     will not be calculated and included in URL.\n   * @param {Object} [params] GetLegendGraphic params. If `LAYER` is set, the\n   *     request is generated for this wms layer, else it will try to use the\n   *     configured wms layer. Default `FORMAT` is `image/png`.\n   *     `VERSION` should not be specified here.\n   * @return {string|undefined} GetLegendGraphic URL.\n   * @api\n   */\n  getLegendUrl(resolution, params) {\n    if (this.url_ === undefined) {\n      return undefined;\n    }\n\n    const baseParams = {\n      'SERVICE': 'WMS',\n      'VERSION': DEFAULT_VERSION,\n      'REQUEST': 'GetLegendGraphic',\n      'FORMAT': 'image/png',\n    };\n\n    if (params === undefined || params['LAYER'] === undefined) {\n      const layers = this.params_.LAYERS;\n      const isSingleLayer = !Array.isArray(layers) || layers.length === 1;\n      if (!isSingleLayer) {\n        return undefined;\n      }\n      baseParams['LAYER'] = layers;\n    }\n\n    if (resolution !== undefined) {\n      const mpu = this.getProjection()\n        ? this.getProjection().getMetersPerUnit()\n        : 1;\n      const pixelSize = 0.00028;\n      baseParams['SCALE'] = (resolution * mpu) / pixelSize;\n    }\n\n    Object.assign(baseParams, params);\n\n    return appendParams(/** @type {string} */ (this.url_), baseParams);\n  }\n\n  /**\n   * Get the user-provided params, i.e. those passed to the constructor through\n   * the \"params\" option, and possibly updated using the updateParams method.\n   * @return {Object} Params.\n   * @api\n   */\n  getParams() {\n    return this.params_;\n  }\n\n  /**\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {number} resolution Resolution.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {import(\"../Image.js\").default} Single image.\n   */\n  getImageInternal(extent, resolution, pixelRatio, projection) {\n    if (this.url_ === undefined) {\n      return null;\n    }\n\n    resolution = this.findNearestResolution(resolution);\n\n    if (pixelRatio != 1 && (!this.hidpi_ || this.serverType_ === undefined)) {\n      pixelRatio = 1;\n    }\n\n    const imageResolution = resolution / pixelRatio;\n\n    const center = getCenter(extent);\n    const viewWidth = ceil(getWidth(extent) / imageResolution, DECIMALS);\n    const viewHeight = ceil(getHeight(extent) / imageResolution, DECIMALS);\n    const viewExtent = getForViewAndSize(center, imageResolution, 0, [\n      viewWidth,\n      viewHeight,\n    ]);\n    const requestWidth = ceil(\n      (this.ratio_ * getWidth(extent)) / imageResolution,\n      DECIMALS\n    );\n    const requestHeight = ceil(\n      (this.ratio_ * getHeight(extent)) / imageResolution,\n      DECIMALS\n    );\n    const requestExtent = getForViewAndSize(center, imageResolution, 0, [\n      requestWidth,\n      requestHeight,\n    ]);\n\n    const image = this.image_;\n    if (\n      image &&\n      this.renderedRevision_ == this.getRevision() &&\n      image.getResolution() == resolution &&\n      image.getPixelRatio() == pixelRatio &&\n      containsExtent(image.getExtent(), viewExtent)\n    ) {\n      return image;\n    }\n\n    const params = {\n      'SERVICE': 'WMS',\n      'VERSION': DEFAULT_VERSION,\n      'REQUEST': 'GetMap',\n      'FORMAT': 'image/png',\n      'TRANSPARENT': true,\n    };\n    Object.assign(params, this.params_);\n\n    this.imageSize_[0] = round(\n      getWidth(requestExtent) / imageResolution,\n      DECIMALS\n    );\n    this.imageSize_[1] = round(\n      getHeight(requestExtent) / imageResolution,\n      DECIMALS\n    );\n\n    const url = this.getRequestUrl_(\n      requestExtent,\n      this.imageSize_,\n      pixelRatio,\n      projection,\n      params\n    );\n\n    this.image_ = new ImageWrapper(\n      requestExtent,\n      resolution,\n      pixelRatio,\n      url,\n      this.crossOrigin_,\n      this.imageLoadFunction_\n    );\n\n    this.renderedRevision_ = this.getRevision();\n\n    this.image_.addEventListener(\n      EventType.CHANGE,\n      this.handleImageChange.bind(this)\n    );\n\n    return this.image_;\n  }\n\n  /**\n   * Return the image load function of the source.\n   * @return {import(\"../Image.js\").LoadFunction} The image load function.\n   * @api\n   */\n  getImageLoadFunction() {\n    return this.imageLoadFunction_;\n  }\n\n  /**\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {import(\"../size.js\").Size} size Size.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @param {Object} params Params.\n   * @return {string} Request URL.\n   * @private\n   */\n  getRequestUrl_(extent, size, pixelRatio, projection, params) {\n    assert(this.url_ !== undefined, 9); // `url` must be configured or set using `#setUrl()`\n\n    params[this.v13_ ? 'CRS' : 'SRS'] = projection.getCode();\n\n    if (!('STYLES' in this.params_)) {\n      params['STYLES'] = '';\n    }\n\n    if (pixelRatio != 1) {\n      switch (this.serverType_) {\n        case 'geoserver':\n          const dpi = (90 * pixelRatio + 0.5) | 0;\n          if ('FORMAT_OPTIONS' in params) {\n            params['FORMAT_OPTIONS'] += ';dpi:' + dpi;\n          } else {\n            params['FORMAT_OPTIONS'] = 'dpi:' + dpi;\n          }\n          break;\n        case 'mapserver':\n          params['MAP_RESOLUTION'] = 90 * pixelRatio;\n          break;\n        case 'carmentaserver':\n        case 'qgis':\n          params['DPI'] = 90 * pixelRatio;\n          break;\n        default: // Unknown `serverType` configured\n          assert(false, 8);\n          break;\n      }\n    }\n\n    params['WIDTH'] = size[0];\n    params['HEIGHT'] = size[1];\n\n    const axisOrientation = projection.getAxisOrientation();\n    let bbox;\n    if (this.v13_ && axisOrientation.substr(0, 2) == 'ne') {\n      bbox = [extent[1], extent[0], extent[3], extent[2]];\n    } else {\n      bbox = extent;\n    }\n    params['BBOX'] = bbox.join(',');\n\n    return appendParams(/** @type {string} */ (this.url_), params);\n  }\n\n  /**\n   * Return the URL used for this WMS source.\n   * @return {string|undefined} URL.\n   * @api\n   */\n  getUrl() {\n    return this.url_;\n  }\n\n  /**\n   * Set the image load function of the source.\n   * @param {import(\"../Image.js\").LoadFunction} imageLoadFunction Image load function.\n   * @api\n   */\n  setImageLoadFunction(imageLoadFunction) {\n    this.image_ = null;\n    this.imageLoadFunction_ = imageLoadFunction;\n    this.changed();\n  }\n\n  /**\n   * Set the URL to use for requests.\n   * @param {string|undefined} url URL.\n   * @api\n   */\n  setUrl(url) {\n    if (url != this.url_) {\n      this.url_ = url;\n      this.image_ = null;\n      this.changed();\n    }\n  }\n\n  /**\n   * Update the user-provided params.\n   * @param {Object} params Params.\n   * @api\n   */\n  updateParams(params) {\n    Object.assign(this.params_, params);\n    this.updateV13_();\n    this.image_ = null;\n    this.changed();\n  }\n\n  /**\n   * @private\n   */\n  updateV13_() {\n    const version = this.params_['VERSION'] || DEFAULT_VERSION;\n    this.v13_ = compareVersions(version, '1.3') >= 0;\n  }\n}\n\nexport default ImageWMS;\n","/**\n * @module ol/source/VectorTile\n */\n\nimport EventType from '../events/EventType.js';\nimport Tile from '../VectorTile.js';\nimport TileCache from '../TileCache.js';\nimport TileGrid from '../tilegrid/TileGrid.js';\nimport TileState from '../TileState.js';\nimport UrlTile from './UrlTile.js';\nimport VectorRenderTile from '../VectorRenderTile.js';\nimport {DEFAULT_MAX_ZOOM} from '../tilegrid/common.js';\nimport {\n  buffer as bufferExtent,\n  getIntersection,\n  intersects,\n} from '../extent.js';\nimport {createXYZ, extentFromProjection} from '../tilegrid.js';\nimport {fromKey, getCacheKeyForTileKey, getKeyZXY} from '../tilecoord.js';\nimport {isEmpty} from '../obj.js';\nimport {loadFeaturesXhr} from '../featureloader.js';\nimport {toSize} from '../size.js';\n\n/**\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {boolean} [attributionsCollapsible=true] Attributions are collapsible.\n * @property {number} [cacheSize] Initial tile cache size. Will auto-grow to hold at least twice the number of tiles in the viewport.\n * @property {import(\"../extent.js\").Extent} [extent] Extent.\n * @property {import(\"../format/Feature.js\").default} [format] Feature format for tiles. Used and required by the default.\n * @property {boolean} [overlaps=true] This source may have overlapping geometries. Setting this\n * to `false` (e.g. for sources with polygons that represent administrative\n * boundaries or TopoJSON sources) allows the renderer to optimise fill and\n * stroke operations.\n * @property {import(\"../proj.js\").ProjectionLike} [projection='EPSG:3857'] Projection of the tile grid.\n * @property {import(\"./Source.js\").State} [state] Source state.\n * @property {typeof import(\"../VectorTile.js\").default} [tileClass] Class used to instantiate image tiles.\n * Default is {@link module:ol/VectorTile~VectorTile}.\n * @property {number} [maxZoom=22] Optional max zoom level. Not used if `tileGrid` is provided.\n * @property {number} [minZoom] Optional min zoom level. Not used if `tileGrid` is provided.\n * @property {number|import(\"../size.js\").Size} [tileSize=512] Optional tile size. Not used if `tileGrid` is provided.\n * @property {number} [maxResolution] Optional tile grid resolution at level zero. Not used if `tileGrid` is provided.\n * @property {import(\"../tilegrid/TileGrid.js\").default} [tileGrid] Tile grid.\n * @property {import(\"../Tile.js\").LoadFunction} [tileLoadFunction]\n * Optional function to load a tile given a URL. Could look like this for pbf tiles:\n * ```js\n * function(tile, url) {\n *   tile.setLoader(function(extent, resolution, projection) {\n *     fetch(url).then(function(response) {\n *       response.arrayBuffer().then(function(data) {\n *         const format = tile.getFormat() // ol/format/MVT configured as source format\n *         const features = format.readFeatures(data, {\n *           extent: extent,\n *           featureProjection: projection\n *         });\n *         tile.setFeatures(features);\n *       });\n *     });\n *   });\n * }\n * ```\n * If you do not need extent, resolution and projection to get the features for a tile (e.g.\n * for GeoJSON tiles), your `tileLoadFunction` does not need a `setLoader()` call. Only make sure\n * to call `setFeatures()` on the tile:\n * ```js\n * const format = new GeoJSON({featureProjection: map.getView().getProjection()});\n * async function tileLoadFunction(tile, url) {\n *   const response = await fetch(url);\n *   const data = await response.json();\n *   tile.setFeatures(format.readFeatures(data));\n * }\n * ```\n * @property {import(\"../Tile.js\").UrlFunction} [tileUrlFunction] Optional function to get tile URL given a tile coordinate and the projection.\n * @property {string} [url] URL template. Must include `{x}`, `{y}` or `{-y}`, and `{z}` placeholders.\n * A `{?-?}` template pattern, for example `subdomain{a-f}.domain.com`, may be\n * used instead of defining each one separately in the `urls` option.\n * @property {number} [transition] A duration for tile opacity\n * transitions in milliseconds. A duration of 0 disables the opacity transition.\n * @property {Array<string>} [urls] An array of URL templates.\n * @property {boolean} [wrapX=true] Whether to wrap the world horizontally.\n * When set to `false`, only one world\n * will be rendered. When set to `true`, tiles will be wrapped horizontally to\n * render multiple worlds.\n * @property {number|import(\"../array.js\").NearestDirectionFunction} [zDirection=1]\n * Choose whether to use tiles with a higher or lower zoom level when between integer\n * zoom levels. See {@link module:ol/tilegrid/TileGrid~TileGrid#getZForResolution}.\n */\n\n/**\n * @classdesc\n * Class for layer sources providing vector data divided into a tile grid, to be\n * used with {@link module:ol/layer/VectorTile~VectorTileLayer}. Although this source receives tiles\n * with vector features from the server, it is not meant for feature editing.\n * Features are optimized for rendering, their geometries are clipped at or near\n * tile boundaries and simplified for a view resolution. See\n * {@link module:ol/source/Vector~VectorSource} for vector sources that are suitable for feature\n * editing.\n *\n * @fires import(\"./Tile.js\").TileSourceEvent\n * @api\n */\nclass VectorTile extends UrlTile {\n  /**\n   * @param {!Options} options Vector tile options.\n   */\n  constructor(options) {\n    const projection = options.projection || 'EPSG:3857';\n\n    const extent = options.extent || extentFromProjection(projection);\n\n    const tileGrid =\n      options.tileGrid ||\n      createXYZ({\n        extent: extent,\n        maxResolution: options.maxResolution,\n        maxZoom: options.maxZoom !== undefined ? options.maxZoom : 22,\n        minZoom: options.minZoom,\n        tileSize: options.tileSize || 512,\n      });\n\n    super({\n      attributions: options.attributions,\n      attributionsCollapsible: options.attributionsCollapsible,\n      cacheSize: options.cacheSize,\n      interpolate: true,\n      opaque: false,\n      projection: projection,\n      state: options.state,\n      tileGrid: tileGrid,\n      tileLoadFunction: options.tileLoadFunction\n        ? options.tileLoadFunction\n        : defaultLoadFunction,\n      tileUrlFunction: options.tileUrlFunction,\n      url: options.url,\n      urls: options.urls,\n      wrapX: options.wrapX === undefined ? true : options.wrapX,\n      transition: options.transition,\n      zDirection: options.zDirection === undefined ? 1 : options.zDirection,\n    });\n\n    /**\n     * @private\n     * @type {import(\"../format/Feature.js\").default|null}\n     */\n    this.format_ = options.format ? options.format : null;\n\n    /**\n     * @private\n     * @type {TileCache}\n     */\n    this.sourceTileCache = new TileCache(this.tileCache.highWaterMark);\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.overlaps_ = options.overlaps == undefined ? true : options.overlaps;\n\n    /**\n     * @protected\n     * @type {typeof import(\"../VectorTile.js\").default}\n     */\n    this.tileClass = options.tileClass ? options.tileClass : Tile;\n\n    /**\n     * @private\n     * @type {Object<string, import(\"../tilegrid/TileGrid.js\").default>}\n     */\n    this.tileGrids_ = {};\n  }\n\n  /**\n   * Get features whose bounding box intersects the provided extent. Only features for cached\n   * tiles for the last rendered zoom level are available in the source. So this method is only\n   * suitable for requesting tiles for extents that are currently rendered.\n   *\n   * Features are returned in random tile order and as they are included in the tiles. This means\n   * they can be clipped, duplicated across tiles, and simplified to the render resolution.\n   *\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @return {Array<import(\"../Feature.js\").FeatureLike>} Features.\n   * @api\n   */\n  getFeaturesInExtent(extent) {\n    const features = [];\n    const tileCache = this.tileCache;\n    if (tileCache.getCount() === 0) {\n      return features;\n    }\n    const z = fromKey(tileCache.peekFirstKey())[0];\n    const tileGrid = this.tileGrid;\n    tileCache.forEach(function (tile) {\n      if (tile.tileCoord[0] !== z || tile.getState() !== TileState.LOADED) {\n        return;\n      }\n      const sourceTiles = tile.getSourceTiles();\n      for (let i = 0, ii = sourceTiles.length; i < ii; ++i) {\n        const sourceTile = sourceTiles[i];\n        const tileCoord = sourceTile.tileCoord;\n        if (intersects(extent, tileGrid.getTileCoordExtent(tileCoord))) {\n          const tileFeatures = sourceTile.getFeatures();\n          if (tileFeatures) {\n            for (let j = 0, jj = tileFeatures.length; j < jj; ++j) {\n              const candidate = tileFeatures[j];\n              const geometry = candidate.getGeometry();\n              if (intersects(extent, geometry.getExtent())) {\n                features.push(candidate);\n              }\n            }\n          }\n        }\n      }\n    });\n    return features;\n  }\n\n  /**\n   * @return {boolean} The source can have overlapping geometries.\n   */\n  getOverlaps() {\n    return this.overlaps_;\n  }\n\n  /**\n   * clear {@link module:ol/TileCache~TileCache} and delete all source tiles\n   * @api\n   */\n  clear() {\n    this.tileCache.clear();\n    this.sourceTileCache.clear();\n  }\n\n  /**\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @param {!Object<string, boolean>} usedTiles Used tiles.\n   */\n  expireCache(projection, usedTiles) {\n    const tileCache = this.getTileCacheForProjection(projection);\n    const usedSourceTiles = Object.keys(usedTiles).reduce((acc, key) => {\n      const cacheKey = getCacheKeyForTileKey(key);\n      const tile = tileCache.peek(cacheKey);\n      if (tile) {\n        const sourceTiles = tile.sourceTiles;\n        for (let i = 0, ii = sourceTiles.length; i < ii; ++i) {\n          acc[sourceTiles[i].getKey()] = true;\n        }\n      }\n      return acc;\n    }, {});\n    super.expireCache(projection, usedTiles);\n    this.sourceTileCache.expireCache(usedSourceTiles);\n  }\n\n  /**\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection\").default} projection Projection.\n   * @param {VectorRenderTile} tile Vector image tile.\n   * @return {Array<import(\"../VectorTile\").default>} Tile keys.\n   */\n  getSourceTiles(pixelRatio, projection, tile) {\n    if (tile.getState() === TileState.IDLE) {\n      tile.setState(TileState.LOADING);\n      const urlTileCoord = tile.wrappedTileCoord;\n      const tileGrid = this.getTileGridForProjection(projection);\n      const extent = tileGrid.getTileCoordExtent(urlTileCoord);\n      const z = urlTileCoord[0];\n      const resolution = tileGrid.getResolution(z);\n      // make extent 1 pixel smaller so we don't load tiles for < 0.5 pixel render space\n      bufferExtent(extent, -resolution, extent);\n      const sourceTileGrid = this.tileGrid;\n      const sourceExtent = sourceTileGrid.getExtent();\n      if (sourceExtent) {\n        getIntersection(extent, sourceExtent, extent);\n      }\n      const sourceZ = sourceTileGrid.getZForResolution(\n        resolution,\n        this.zDirection\n      );\n\n      sourceTileGrid.forEachTileCoord(extent, sourceZ, (sourceTileCoord) => {\n        const tileUrl = this.tileUrlFunction(\n          sourceTileCoord,\n          pixelRatio,\n          projection\n        );\n        const sourceTile = this.sourceTileCache.containsKey(tileUrl)\n          ? this.sourceTileCache.get(tileUrl)\n          : new this.tileClass(\n              sourceTileCoord,\n              tileUrl ? TileState.IDLE : TileState.EMPTY,\n              tileUrl,\n              this.format_,\n              this.tileLoadFunction\n            );\n        tile.sourceTiles.push(sourceTile);\n        const sourceTileState = sourceTile.getState();\n        if (sourceTileState < TileState.LOADED) {\n          const listenChange = (event) => {\n            this.handleTileChange(event);\n            const state = sourceTile.getState();\n            if (state === TileState.LOADED || state === TileState.ERROR) {\n              const sourceTileKey = sourceTile.getKey();\n              if (sourceTileKey in tile.errorTileKeys) {\n                if (sourceTile.getState() === TileState.LOADED) {\n                  delete tile.errorTileKeys[sourceTileKey];\n                }\n              } else {\n                tile.loadingSourceTiles--;\n              }\n              if (state === TileState.ERROR) {\n                tile.errorTileKeys[sourceTileKey] = true;\n              } else {\n                sourceTile.removeEventListener(EventType.CHANGE, listenChange);\n              }\n              if (tile.loadingSourceTiles === 0) {\n                tile.setState(\n                  isEmpty(tile.errorTileKeys)\n                    ? TileState.LOADED\n                    : TileState.ERROR\n                );\n              }\n            }\n          };\n          sourceTile.addEventListener(EventType.CHANGE, listenChange);\n          tile.loadingSourceTiles++;\n        }\n        if (sourceTileState === TileState.IDLE) {\n          sourceTile.extent =\n            sourceTileGrid.getTileCoordExtent(sourceTileCoord);\n          sourceTile.projection = projection;\n          sourceTile.resolution = sourceTileGrid.getResolution(\n            sourceTileCoord[0]\n          );\n          this.sourceTileCache.set(tileUrl, sourceTile);\n          sourceTile.load();\n        }\n      });\n      if (!tile.loadingSourceTiles) {\n        tile.setState(\n          tile.sourceTiles.some(\n            (sourceTile) => sourceTile.getState() === TileState.ERROR\n          )\n            ? TileState.ERROR\n            : TileState.LOADED\n        );\n      }\n    }\n\n    return tile.sourceTiles;\n  }\n\n  /**\n   * @param {number} z Tile coordinate z.\n   * @param {number} x Tile coordinate x.\n   * @param {number} y Tile coordinate y.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {!VectorRenderTile} Tile.\n   */\n  getTile(z, x, y, pixelRatio, projection) {\n    const coordKey = getKeyZXY(z, x, y);\n    const key = this.getKey();\n    let tile;\n    if (this.tileCache.containsKey(coordKey)) {\n      tile = this.tileCache.get(coordKey);\n      if (tile.key === key) {\n        return tile;\n      }\n    }\n    const tileCoord = [z, x, y];\n    let urlTileCoord = this.getTileCoordForTileUrlFunction(\n      tileCoord,\n      projection\n    );\n    const sourceExtent = this.getTileGrid().getExtent();\n    const tileGrid = this.getTileGridForProjection(projection);\n    if (urlTileCoord && sourceExtent) {\n      const tileExtent = tileGrid.getTileCoordExtent(urlTileCoord);\n      // make extent 1 pixel smaller so we don't load tiles for < 0.5 pixel render space\n      bufferExtent(tileExtent, -tileGrid.getResolution(z), tileExtent);\n      if (!intersects(sourceExtent, tileExtent)) {\n        urlTileCoord = null;\n      }\n    }\n    let empty = true;\n    if (urlTileCoord !== null) {\n      const sourceTileGrid = this.tileGrid;\n      const resolution = tileGrid.getResolution(z);\n      const sourceZ = sourceTileGrid.getZForResolution(resolution, 1);\n      // make extent 1 pixel smaller so we don't load tiles for < 0.5 pixel render space\n      const extent = tileGrid.getTileCoordExtent(urlTileCoord);\n      bufferExtent(extent, -resolution, extent);\n      sourceTileGrid.forEachTileCoord(extent, sourceZ, (sourceTileCoord) => {\n        empty =\n          empty &&\n          !this.tileUrlFunction(sourceTileCoord, pixelRatio, projection);\n      });\n    }\n    const newTile = new VectorRenderTile(\n      tileCoord,\n      empty ? TileState.EMPTY : TileState.IDLE,\n      urlTileCoord,\n      this.getSourceTiles.bind(this, pixelRatio, projection)\n    );\n\n    newTile.key = key;\n    if (tile) {\n      newTile.interimTile = tile;\n      newTile.refreshInterimChain();\n      this.tileCache.replace(coordKey, newTile);\n    } else {\n      this.tileCache.set(coordKey, newTile);\n    }\n    return newTile;\n  }\n\n  /**\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {!import(\"../tilegrid/TileGrid.js\").default} Tile grid.\n   */\n  getTileGridForProjection(projection) {\n    const code = projection.getCode();\n    let tileGrid = this.tileGrids_[code];\n    if (!tileGrid) {\n      // A tile grid that matches the tile size of the source tile grid is more\n      // likely to have 1:1 relationships between source tiles and rendered tiles.\n      const sourceTileGrid = this.tileGrid;\n      const resolutions = sourceTileGrid.getResolutions().slice();\n      const origins = resolutions.map(function (resolution, z) {\n        return sourceTileGrid.getOrigin(z);\n      });\n      const tileSizes = resolutions.map(function (resolution, z) {\n        return sourceTileGrid.getTileSize(z);\n      });\n      const length = DEFAULT_MAX_ZOOM + 1;\n      for (let z = resolutions.length; z < length; ++z) {\n        resolutions.push(resolutions[z - 1] / 2);\n        origins.push(origins[z - 1]);\n        tileSizes.push(tileSizes[z - 1]);\n      }\n      tileGrid = new TileGrid({\n        extent: sourceTileGrid.getExtent(),\n        origins: origins,\n        resolutions: resolutions,\n        tileSizes: tileSizes,\n      });\n      this.tileGrids_[code] = tileGrid;\n    }\n    return tileGrid;\n  }\n\n  /**\n   * Get the tile pixel ratio for this source.\n   * @param {number} pixelRatio Pixel ratio.\n   * @return {number} Tile pixel ratio.\n   */\n  getTilePixelRatio(pixelRatio) {\n    return pixelRatio;\n  }\n\n  /**\n   * @param {number} z Z.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @return {import(\"../size.js\").Size} Tile size.\n   */\n  getTilePixelSize(z, pixelRatio, projection) {\n    const tileGrid = this.getTileGridForProjection(projection);\n    const tileSize = toSize(tileGrid.getTileSize(z), this.tmpSize);\n    return [\n      Math.round(tileSize[0] * pixelRatio),\n      Math.round(tileSize[1] * pixelRatio),\n    ];\n  }\n\n  /**\n   * Increases the cache size if needed\n   * @param {number} tileCount Minimum number of tiles needed.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   */\n  updateCacheSize(tileCount, projection) {\n    super.updateCacheSize(tileCount * 2, projection);\n    this.sourceTileCache.highWaterMark =\n      this.getTileCacheForProjection(projection).highWaterMark;\n  }\n}\n\nexport default VectorTile;\n\n/**\n * Sets the loader for a tile.\n * @param {import(\"../VectorTile.js\").default} tile Vector tile.\n * @param {string} url URL.\n */\nexport function defaultLoadFunction(tile, url) {\n  tile.setLoader(\n    /**\n     * @param {import(\"../extent.js\").Extent} extent Extent.\n     * @param {number} resolution Resolution.\n     * @param {import(\"../proj/Projection.js\").default} projection Projection.\n     */\n    function (extent, resolution, projection) {\n      loadFeaturesXhr(\n        url,\n        tile.getFormat(),\n        extent,\n        resolution,\n        projection,\n        tile.onLoad.bind(tile),\n        tile.onError.bind(tile)\n      );\n    }\n  );\n}\n","/**\n * @module ol/tilegrid/WMTS\n */\n\nimport TileGrid from './TileGrid.js';\nimport {get as getProjection} from '../proj.js';\n\n/**\n * @typedef {Object} Options\n * @property {import(\"../extent.js\").Extent} [extent] Extent for the tile grid. No tiles\n * outside this extent will be requested by {@link module:ol/source/Tile~TileSource} sources.\n * When no `origin` or `origins` are configured, the `origin` will be set to the\n * top-left corner of the extent.\n * @property {import(\"../coordinate.js\").Coordinate} [origin] The tile grid origin, i.e.\n * where the `x` and `y` axes meet (`[z, 0, 0]`). Tile coordinates increase left\n * to right and downwards. If not specified, `extent` or `origins` must be provided.\n * @property {Array<import(\"../coordinate.js\").Coordinate>} [origins] Tile grid origins,\n * i.e. where the `x` and `y` axes meet (`[z, 0, 0]`), for each zoom level. If\n * given, the array length should match the length of the `resolutions` array, i.e.\n * each resolution can have a different origin. Tile coordinates increase left to\n * right and downwards. If not specified, `extent` or `origin` must be provided.\n * @property {!Array<number>} resolutions Resolutions. The array index of each\n * resolution needs to match the zoom level. This means that even if a `minZoom`\n * is configured, the resolutions array will have a length of `maxZoom + 1`\n * @property {!Array<string>} matrixIds matrix IDs. The length of this array needs\n * to match the length of the `resolutions` array.\n * @property {Array<import(\"../size.js\").Size>} [sizes] Number of tile rows and columns\n * of the grid for each zoom level. The values here are the `TileMatrixWidth` and\n * `TileMatrixHeight` advertised in the GetCapabilities response of the WMTS, and\n * define each zoom level's extent together with the `origin` or `origins`.\n * A grid `extent` can be configured in addition, and will further limit the extent for\n * which tile requests are made by sources. If the bottom-left corner of\n * an extent is used as `origin` or `origins`, then the `y` value must be\n * negative because OpenLayers tile coordinates use the top left as the origin.\n * @property {number|import(\"../size.js\").Size} [tileSize] Tile size.\n * @property {Array<number|import(\"../size.js\").Size>} [tileSizes] Tile sizes. The length of\n * this array needs to match the length of the `resolutions` array.\n */\n\n/**\n * @classdesc\n * Set the grid pattern for sources accessing WMTS tiled-image servers.\n * @api\n */\nclass WMTSTileGrid extends TileGrid {\n  /**\n   * @param {Options} options WMTS options.\n   */\n  constructor(options) {\n    super({\n      extent: options.extent,\n      origin: options.origin,\n      origins: options.origins,\n      resolutions: options.resolutions,\n      tileSize: options.tileSize,\n      tileSizes: options.tileSizes,\n      sizes: options.sizes,\n    });\n\n    /**\n     * @private\n     * @type {!Array<string>}\n     */\n    this.matrixIds_ = options.matrixIds;\n  }\n\n  /**\n   * @param {number} z Z.\n   * @return {string} MatrixId..\n   */\n  getMatrixId(z) {\n    return this.matrixIds_[z];\n  }\n\n  /**\n   * Get the list of matrix identifiers.\n   * @return {Array<string>} MatrixIds.\n   * @api\n   */\n  getMatrixIds() {\n    return this.matrixIds_;\n  }\n}\n\nexport default WMTSTileGrid;\n\n/**\n * Create a tile grid from a WMTS capabilities matrix set and an\n * optional TileMatrixSetLimits.\n * @param {Object} matrixSet An object representing a matrixSet in the\n *     capabilities document.\n * @param {import(\"../extent.js\").Extent} [extent] An optional extent to restrict the tile\n *     ranges the server provides.\n * @param {Array<Object>} [matrixLimits] An optional object representing\n *     the available matrices for tileGrid.\n * @return {WMTSTileGrid} WMTS tileGrid instance.\n * @api\n */\nexport function createFromCapabilitiesMatrixSet(\n  matrixSet,\n  extent,\n  matrixLimits\n) {\n  /** @type {!Array<number>} */\n  const resolutions = [];\n  /** @type {!Array<string>} */\n  const matrixIds = [];\n  /** @type {!Array<import(\"../coordinate.js\").Coordinate>} */\n  const origins = [];\n  /** @type {!Array<number|import(\"../size.js\").Size>} */\n  const tileSizes = [];\n  /** @type {!Array<import(\"../size.js\").Size>} */\n  const sizes = [];\n\n  matrixLimits = matrixLimits !== undefined ? matrixLimits : [];\n\n  const supportedCRSPropName = 'SupportedCRS';\n  const matrixIdsPropName = 'TileMatrix';\n  const identifierPropName = 'Identifier';\n  const scaleDenominatorPropName = 'ScaleDenominator';\n  const topLeftCornerPropName = 'TopLeftCorner';\n  const tileWidthPropName = 'TileWidth';\n  const tileHeightPropName = 'TileHeight';\n\n  const code = matrixSet[supportedCRSPropName];\n  const projection = getProjection(code);\n  const metersPerUnit = projection.getMetersPerUnit();\n  // swap origin x and y coordinates if axis orientation is lat/long\n  const switchOriginXY = projection.getAxisOrientation().substr(0, 2) == 'ne';\n\n  matrixSet[matrixIdsPropName].sort(function (a, b) {\n    return b[scaleDenominatorPropName] - a[scaleDenominatorPropName];\n  });\n\n  matrixSet[matrixIdsPropName].forEach(function (elt) {\n    let matrixAvailable;\n    // use of matrixLimits to filter TileMatrices from GetCapabilities\n    // TileMatrixSet from unavailable matrix levels.\n    if (matrixLimits.length > 0) {\n      matrixAvailable = matrixLimits.find(function (elt_ml) {\n        if (elt[identifierPropName] == elt_ml[matrixIdsPropName]) {\n          return true;\n        }\n        // Fallback for tileMatrix identifiers that don't get prefixed\n        // by their tileMatrixSet identifiers.\n        if (!elt[identifierPropName].includes(':')) {\n          return (\n            matrixSet[identifierPropName] + ':' + elt[identifierPropName] ===\n            elt_ml[matrixIdsPropName]\n          );\n        }\n        return false;\n      });\n    } else {\n      matrixAvailable = true;\n    }\n\n    if (matrixAvailable) {\n      matrixIds.push(elt[identifierPropName]);\n      const resolution =\n        (elt[scaleDenominatorPropName] * 0.28e-3) / metersPerUnit;\n      const tileWidth = elt[tileWidthPropName];\n      const tileHeight = elt[tileHeightPropName];\n      if (switchOriginXY) {\n        origins.push([\n          elt[topLeftCornerPropName][1],\n          elt[topLeftCornerPropName][0],\n        ]);\n      } else {\n        origins.push(elt[topLeftCornerPropName]);\n      }\n      resolutions.push(resolution);\n      tileSizes.push(\n        tileWidth == tileHeight ? tileWidth : [tileWidth, tileHeight]\n      );\n      sizes.push([elt['MatrixWidth'], elt['MatrixHeight']]);\n    }\n  });\n\n  return new WMTSTileGrid({\n    extent: extent,\n    origins: origins,\n    resolutions: resolutions,\n    matrixIds: matrixIds,\n    tileSizes: tileSizes,\n    sizes: sizes,\n  });\n}\n","/**\n * @module ol/source/WMTS\n */\n\nimport TileImage from './TileImage.js';\nimport {appendParams} from '../uri.js';\nimport {containsExtent} from '../extent.js';\nimport {createFromCapabilitiesMatrixSet} from '../tilegrid/WMTS.js';\nimport {createFromTileUrlFunctions, expandUrl} from '../tileurlfunction.js';\nimport {equivalent, get as getProjection, transformExtent} from '../proj.js';\n\n/**\n * Request encoding. One of 'KVP', 'REST'.\n * @typedef {'KVP' | 'REST'} RequestEncoding\n */\n\n/**\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {boolean} [attributionsCollapsible=true] Attributions are collapsible.\n * @property {number} [cacheSize] Initial tile cache size. Will auto-grow to hold at least the number of tiles in the viewport.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you want to access pixel data with the Canvas renderer.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image for more detail.\n * @property {boolean} [interpolate=true] Use interpolated values when resampling.  By default,\n * linear interpolation is used when resampling.  Set to false to use the nearest neighbor instead.\n * @property {import(\"../tilegrid/WMTS.js\").default} tileGrid Tile grid.\n * @property {import(\"../proj.js\").ProjectionLike} [projection] Projection. Default is the view projection.\n * @property {number} [reprojectionErrorThreshold=0.5] Maximum allowed reprojection error (in pixels).\n * Higher values can increase reprojection performance, but decrease precision.\n * @property {RequestEncoding} [requestEncoding='KVP'] Request encoding.\n * @property {string} layer Layer name as advertised in the WMTS capabilities.\n * @property {string} style Style name as advertised in the WMTS capabilities.\n * @property {typeof import(\"../ImageTile.js\").default} [tileClass]  Class used to instantiate image tiles. Default is {@link module:ol/ImageTile~ImageTile}.\n * @property {number} [tilePixelRatio=1] The pixel ratio used by the tile service.\n * For example, if the tile service advertizes 256px by 256px tiles but actually sends 512px\n * by 512px images (for retina/hidpi devices) then `tilePixelRatio`\n * should be set to `2`.\n * @property {string} [format='image/jpeg'] Image format. Only used when `requestEncoding` is `'KVP'`.\n * @property {string} [version='1.0.0'] WMTS version.\n * @property {string} matrixSet Matrix set.\n * @property {!Object} [dimensions] Additional \"dimensions\" for tile requests.\n * This is an object with properties named like the advertised WMTS dimensions.\n * @property {string} [url]  A URL for the service.\n * For the RESTful request encoding, this is a URL\n * template.  For KVP encoding, it is normal URL. A `{?-?}` template pattern,\n * for example `subdomain{a-f}.domain.com`, may be used instead of defining\n * each one separately in the `urls` option.\n * @property {import(\"../Tile.js\").LoadFunction} [tileLoadFunction] Optional function to load a tile given a URL. The default is\n * ```js\n * function(imageTile, src) {\n *   imageTile.getImage().src = src;\n * };\n * ```\n * @property {Array<string>} [urls] An array of URLs.\n * Requests will be distributed among the URLs in this array.\n * @property {boolean} [wrapX=false] Whether to wrap the world horizontally.\n * @property {number} [transition] Duration of the opacity transition for rendering.\n * To disable the opacity transition, pass `transition: 0`.\n * @property {number|import(\"../array.js\").NearestDirectionFunction} [zDirection=0]\n * Choose whether to use tiles with a higher or lower zoom level when between integer\n * zoom levels. See {@link module:ol/tilegrid/TileGrid~TileGrid#getZForResolution}.\n */\n\n/**\n * @classdesc\n * Layer source for tile data from WMTS servers.\n * @api\n */\nclass WMTS extends TileImage {\n  /**\n   * @param {Options} options WMTS options.\n   */\n  constructor(options) {\n    // TODO: add support for TileMatrixLimits\n\n    const requestEncoding =\n      options.requestEncoding !== undefined ? options.requestEncoding : 'KVP';\n\n    // FIXME: should we create a default tileGrid?\n    // we could issue a getCapabilities xhr to retrieve missing configuration\n    const tileGrid = options.tileGrid;\n\n    let urls = options.urls;\n    if (urls === undefined && options.url !== undefined) {\n      urls = expandUrl(options.url);\n    }\n\n    super({\n      attributions: options.attributions,\n      attributionsCollapsible: options.attributionsCollapsible,\n      cacheSize: options.cacheSize,\n      crossOrigin: options.crossOrigin,\n      interpolate: options.interpolate,\n      projection: options.projection,\n      reprojectionErrorThreshold: options.reprojectionErrorThreshold,\n      tileClass: options.tileClass,\n      tileGrid: tileGrid,\n      tileLoadFunction: options.tileLoadFunction,\n      tilePixelRatio: options.tilePixelRatio,\n      urls: urls,\n      wrapX: options.wrapX !== undefined ? options.wrapX : false,\n      transition: options.transition,\n      zDirection: options.zDirection,\n    });\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.version_ = options.version !== undefined ? options.version : '1.0.0';\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.format_ = options.format !== undefined ? options.format : 'image/jpeg';\n\n    /**\n     * @private\n     * @type {!Object}\n     */\n    this.dimensions_ =\n      options.dimensions !== undefined ? options.dimensions : {};\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.layer_ = options.layer;\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.matrixSet_ = options.matrixSet;\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.style_ = options.style;\n\n    // FIXME: should we guess this requestEncoding from options.url(s)\n    //        structure? that would mean KVP only if a template is not provided.\n\n    /**\n     * @private\n     * @type {RequestEncoding}\n     */\n    this.requestEncoding_ = requestEncoding;\n\n    this.setKey(this.getKeyForDimensions_());\n\n    if (urls && urls.length > 0) {\n      this.tileUrlFunction = createFromTileUrlFunctions(\n        urls.map(this.createFromWMTSTemplate.bind(this))\n      );\n    }\n  }\n\n  /**\n   * Set the URLs to use for requests.\n   * URLs may contain OGC conform URL Template Variables: {TileMatrix}, {TileRow}, {TileCol}.\n   * @param {Array<string>} urls URLs.\n   */\n  setUrls(urls) {\n    this.urls = urls;\n    const key = urls.join('\\n');\n    this.setTileUrlFunction(\n      createFromTileUrlFunctions(\n        urls.map(this.createFromWMTSTemplate.bind(this))\n      ),\n      key\n    );\n  }\n\n  /**\n   * Get the dimensions, i.e. those passed to the constructor through the\n   * \"dimensions\" option, and possibly updated using the updateDimensions\n   * method.\n   * @return {!Object} Dimensions.\n   * @api\n   */\n  getDimensions() {\n    return this.dimensions_;\n  }\n\n  /**\n   * Return the image format of the WMTS source.\n   * @return {string} Format.\n   * @api\n   */\n  getFormat() {\n    return this.format_;\n  }\n\n  /**\n   * Return the layer of the WMTS source.\n   * @return {string} Layer.\n   * @api\n   */\n  getLayer() {\n    return this.layer_;\n  }\n\n  /**\n   * Return the matrix set of the WMTS source.\n   * @return {string} MatrixSet.\n   * @api\n   */\n  getMatrixSet() {\n    return this.matrixSet_;\n  }\n\n  /**\n   * Return the request encoding, either \"KVP\" or \"REST\".\n   * @return {RequestEncoding} Request encoding.\n   * @api\n   */\n  getRequestEncoding() {\n    return this.requestEncoding_;\n  }\n\n  /**\n   * Return the style of the WMTS source.\n   * @return {string} Style.\n   * @api\n   */\n  getStyle() {\n    return this.style_;\n  }\n\n  /**\n   * Return the version of the WMTS source.\n   * @return {string} Version.\n   * @api\n   */\n  getVersion() {\n    return this.version_;\n  }\n\n  /**\n   * @private\n   * @return {string} The key for the current dimensions.\n   */\n  getKeyForDimensions_() {\n    const res = this.urls ? this.urls.slice(0) : [];\n    for (const key in this.dimensions_) {\n      res.push(key + '-' + this.dimensions_[key]);\n    }\n    return res.join('/');\n  }\n\n  /**\n   * Update the dimensions.\n   * @param {Object} dimensions Dimensions.\n   * @api\n   */\n  updateDimensions(dimensions) {\n    Object.assign(this.dimensions_, dimensions);\n    this.setKey(this.getKeyForDimensions_());\n  }\n\n  /**\n   * @param {string} template Template.\n   * @return {import(\"../Tile.js\").UrlFunction} Tile URL function.\n   */\n  createFromWMTSTemplate(template) {\n    const requestEncoding = this.requestEncoding_;\n\n    // context property names are lower case to allow for a case insensitive\n    // replacement as some services use different naming conventions\n    const context = {\n      'layer': this.layer_,\n      'style': this.style_,\n      'tilematrixset': this.matrixSet_,\n    };\n\n    if (requestEncoding == 'KVP') {\n      Object.assign(context, {\n        'Service': 'WMTS',\n        'Request': 'GetTile',\n        'Version': this.version_,\n        'Format': this.format_,\n      });\n    }\n\n    // TODO: we may want to create our own appendParams function so that params\n    // order conforms to wmts spec guidance, and so that we can avoid to escape\n    // special template params\n\n    template =\n      requestEncoding == 'KVP'\n        ? appendParams(template, context)\n        : template.replace(/\\{(\\w+?)\\}/g, function (m, p) {\n            return p.toLowerCase() in context ? context[p.toLowerCase()] : m;\n          });\n\n    const tileGrid = /** @type {import(\"../tilegrid/WMTS.js\").default} */ (\n      this.tileGrid\n    );\n    const dimensions = this.dimensions_;\n\n    return (\n      /**\n       * @param {import(\"../tilecoord.js\").TileCoord} tileCoord Tile coordinate.\n       * @param {number} pixelRatio Pixel ratio.\n       * @param {import(\"../proj/Projection.js\").default} projection Projection.\n       * @return {string|undefined} Tile URL.\n       */\n      function (tileCoord, pixelRatio, projection) {\n        if (!tileCoord) {\n          return undefined;\n        }\n        const localContext = {\n          'TileMatrix': tileGrid.getMatrixId(tileCoord[0]),\n          'TileCol': tileCoord[1],\n          'TileRow': tileCoord[2],\n        };\n        Object.assign(localContext, dimensions);\n        let url = template;\n        if (requestEncoding == 'KVP') {\n          url = appendParams(url, localContext);\n        } else {\n          url = url.replace(/\\{(\\w+?)\\}/g, function (m, p) {\n            return localContext[p];\n          });\n        }\n        return url;\n      }\n    );\n  }\n}\n\nexport default WMTS;\n\n/**\n * Generate source options from a capabilities object.\n * @param {Object} wmtsCap An object representing the capabilities document.\n * @param {!Object} config Configuration properties for the layer.  Defaults for\n *                  the layer will apply if not provided.\n *\n * Required config properties:\n *  - layer - {string} The layer identifier.\n *\n * Optional config properties:\n *  - matrixSet - {string} The matrix set identifier, required if there is\n *       more than one matrix set in the layer capabilities.\n *  - projection - {string} The desired CRS when no matrixSet is specified.\n *       eg: \"EPSG:3857\". If the desired projection is not available,\n *       an error is thrown.\n *  - requestEncoding - {string} url encoding format for the layer. Default is\n *       the first tile url format found in the GetCapabilities response.\n *  - style - {string} The name of the style\n *  - format - {string} Image format for the layer. Default is the first\n *       format returned in the GetCapabilities response.\n *  - crossOrigin - {string|null|undefined} Cross origin. Default is `undefined`.\n * @return {Options|null} WMTS source options object or `null` if the layer was not found.\n * @api\n */\nexport function optionsFromCapabilities(wmtsCap, config) {\n  const layers = wmtsCap['Contents']['Layer'];\n  const l = layers.find(function (elt) {\n    return elt['Identifier'] == config['layer'];\n  });\n  if (!l) {\n    return null;\n  }\n  const tileMatrixSets = wmtsCap['Contents']['TileMatrixSet'];\n  let idx;\n  if (l['TileMatrixSetLink'].length > 1) {\n    if ('projection' in config) {\n      idx = l['TileMatrixSetLink'].findIndex(function (elt) {\n        const tileMatrixSet = tileMatrixSets.find(function (el) {\n          return el['Identifier'] == elt['TileMatrixSet'];\n        });\n        const supportedCRS = tileMatrixSet['SupportedCRS'];\n        const proj1 = getProjection(supportedCRS);\n        const proj2 = getProjection(config['projection']);\n        if (proj1 && proj2) {\n          return equivalent(proj1, proj2);\n        }\n        return supportedCRS == config['projection'];\n      });\n    } else {\n      idx = l['TileMatrixSetLink'].findIndex(function (elt) {\n        return elt['TileMatrixSet'] == config['matrixSet'];\n      });\n    }\n  } else {\n    idx = 0;\n  }\n  if (idx < 0) {\n    idx = 0;\n  }\n  const matrixSet =\n    /** @type {string} */\n    (l['TileMatrixSetLink'][idx]['TileMatrixSet']);\n  const matrixLimits =\n    /** @type {Array<Object>} */\n    (l['TileMatrixSetLink'][idx]['TileMatrixSetLimits']);\n\n  let format = /** @type {string} */ (l['Format'][0]);\n  if ('format' in config) {\n    format = config['format'];\n  }\n  idx = l['Style'].findIndex(function (elt) {\n    if ('style' in config) {\n      return elt['Title'] == config['style'];\n    }\n    return elt['isDefault'];\n  });\n  if (idx < 0) {\n    idx = 0;\n  }\n  const style = /** @type {string} */ (l['Style'][idx]['Identifier']);\n\n  const dimensions = {};\n  if ('Dimension' in l) {\n    l['Dimension'].forEach(function (elt, index, array) {\n      const key = elt['Identifier'];\n      let value = elt['Default'];\n      if (value === undefined) {\n        value = elt['Value'][0];\n      }\n      dimensions[key] = value;\n    });\n  }\n\n  const matrixSets = wmtsCap['Contents']['TileMatrixSet'];\n  const matrixSetObj = matrixSets.find(function (elt) {\n    return elt['Identifier'] == matrixSet;\n  });\n\n  let projection;\n  const code = matrixSetObj['SupportedCRS'];\n  if (code) {\n    projection = getProjection(code);\n  }\n  if ('projection' in config) {\n    const projConfig = getProjection(config['projection']);\n    if (projConfig) {\n      if (!projection || equivalent(projConfig, projection)) {\n        projection = projConfig;\n      }\n    }\n  }\n\n  let wrapX = false;\n  const switchXY = projection.getAxisOrientation().substr(0, 2) == 'ne';\n\n  let matrix = matrixSetObj.TileMatrix[0];\n\n  // create default matrixLimit\n  let selectedMatrixLimit = {\n    MinTileCol: 0,\n    MinTileRow: 0,\n    // subtract one to end up at tile top left\n    MaxTileCol: matrix.MatrixWidth - 1,\n    MaxTileRow: matrix.MatrixHeight - 1,\n  };\n\n  //in case of matrix limits, use matrix limits to calculate extent\n  if (matrixLimits) {\n    selectedMatrixLimit = matrixLimits[matrixLimits.length - 1];\n    const m = matrixSetObj.TileMatrix.find(\n      (tileMatrixValue) =>\n        tileMatrixValue.Identifier === selectedMatrixLimit.TileMatrix ||\n        matrixSetObj.Identifier + ':' + tileMatrixValue.Identifier ===\n          selectedMatrixLimit.TileMatrix\n    );\n    if (m) {\n      matrix = m;\n    }\n  }\n\n  const resolution =\n    (matrix.ScaleDenominator * 0.00028) / projection.getMetersPerUnit(); // WMTS 1.0.0: standardized rendering pixel size\n  const origin = switchXY\n    ? [matrix.TopLeftCorner[1], matrix.TopLeftCorner[0]]\n    : matrix.TopLeftCorner;\n  const tileSpanX = matrix.TileWidth * resolution;\n  const tileSpanY = matrix.TileHeight * resolution;\n  let matrixSetExtent = matrixSetObj['BoundingBox'];\n  if (matrixSetExtent && switchXY) {\n    matrixSetExtent = [\n      matrixSetExtent[1],\n      matrixSetExtent[0],\n      matrixSetExtent[3],\n      matrixSetExtent[2],\n    ];\n  }\n  let extent = [\n    origin[0] + tileSpanX * selectedMatrixLimit.MinTileCol,\n    // add one to get proper bottom/right coordinate\n    origin[1] - tileSpanY * (1 + selectedMatrixLimit.MaxTileRow),\n    origin[0] + tileSpanX * (1 + selectedMatrixLimit.MaxTileCol),\n    origin[1] - tileSpanY * selectedMatrixLimit.MinTileRow,\n  ];\n\n  if (\n    matrixSetExtent !== undefined &&\n    !containsExtent(matrixSetExtent, extent)\n  ) {\n    const wgs84BoundingBox = l['WGS84BoundingBox'];\n    const wgs84ProjectionExtent = getProjection('EPSG:4326').getExtent();\n    extent = matrixSetExtent;\n    if (wgs84BoundingBox) {\n      wrapX =\n        wgs84BoundingBox[0] === wgs84ProjectionExtent[0] &&\n        wgs84BoundingBox[2] === wgs84ProjectionExtent[2];\n    } else {\n      const wgs84MatrixSetExtent = transformExtent(\n        matrixSetExtent,\n        matrixSetObj['SupportedCRS'],\n        'EPSG:4326'\n      );\n      // Ignore slight deviation from the correct x limits\n      wrapX =\n        wgs84MatrixSetExtent[0] - 1e-10 <= wgs84ProjectionExtent[0] &&\n        wgs84MatrixSetExtent[2] + 1e-10 >= wgs84ProjectionExtent[2];\n    }\n  }\n\n  const tileGrid = createFromCapabilitiesMatrixSet(\n    matrixSetObj,\n    extent,\n    matrixLimits\n  );\n\n  /** @type {!Array<string>} */\n  const urls = [];\n  let requestEncoding = config['requestEncoding'];\n  requestEncoding = requestEncoding !== undefined ? requestEncoding : '';\n\n  if (\n    'OperationsMetadata' in wmtsCap &&\n    'GetTile' in wmtsCap['OperationsMetadata']\n  ) {\n    const gets = wmtsCap['OperationsMetadata']['GetTile']['DCP']['HTTP']['Get'];\n\n    for (let i = 0, ii = gets.length; i < ii; ++i) {\n      if (gets[i]['Constraint']) {\n        const constraint = gets[i]['Constraint'].find(function (element) {\n          return element['name'] == 'GetEncoding';\n        });\n        const encodings = constraint['AllowedValues']['Value'];\n\n        if (requestEncoding === '') {\n          // requestEncoding not provided, use the first encoding from the list\n          requestEncoding = encodings[0];\n        }\n        if (requestEncoding === 'KVP') {\n          if (encodings.includes('KVP')) {\n            urls.push(/** @type {string} */ (gets[i]['href']));\n          }\n        } else {\n          break;\n        }\n      } else if (gets[i]['href']) {\n        requestEncoding = 'KVP';\n        urls.push(/** @type {string} */ (gets[i]['href']));\n      }\n    }\n  }\n  if (urls.length === 0) {\n    requestEncoding = 'REST';\n    l['ResourceURL'].forEach(function (element) {\n      if (element['resourceType'] === 'tile') {\n        format = element['format'];\n        urls.push(/** @type {string} */ (element['template']));\n      }\n    });\n  }\n\n  return {\n    urls: urls,\n    layer: config['layer'],\n    matrixSet: matrixSet,\n    format: format,\n    projection: projection,\n    requestEncoding: requestEncoding,\n    tileGrid: tileGrid,\n    style: style,\n    dimensions: dimensions,\n    wrapX: wrapX,\n    crossOrigin: config['crossOrigin'],\n  };\n}\n","/**\n * @module ol/format/Feature\n */\nimport {abstract} from '../util.js';\nimport {\n  equivalent as equivalentProjection,\n  get as getProjection,\n  transformExtent,\n} from '../proj.js';\n\n/**\n * @typedef {Object} ReadOptions\n * @property {import(\"../proj.js\").ProjectionLike} [dataProjection] Projection of the data we are reading.\n * If not provided, the projection will be derived from the data (where possible) or\n * the `dataProjection` of the format is assigned (where set). If the projection\n * can not be derived from the data and if no `dataProjection` is set for a format,\n * the features will not be reprojected.\n * @property {import(\"../extent.js\").Extent} [extent] Tile extent in map units of the tile being read.\n * This is only required when reading data with tile pixels as geometry units. When configured,\n * a `dataProjection` with `TILE_PIXELS` as `units` and the tile's pixel extent as `extent` needs to be\n * provided.\n * @property {import(\"../proj.js\").ProjectionLike} [featureProjection] Projection of the feature geometries\n * created by the format reader. If not provided, features will be returned in the\n * `dataProjection`.\n */\n\n/**\n * @typedef {Object} WriteOptions\n * @property {import(\"../proj.js\").ProjectionLike} [dataProjection] Projection of the data we are writing.\n * If not provided, the `dataProjection` of the format is assigned (where set).\n * If no `dataProjection` is set for a format, the features will be returned\n * in the `featureProjection`.\n * @property {import(\"../proj.js\").ProjectionLike} [featureProjection] Projection of the feature geometries\n * that will be serialized by the format writer. If not provided, geometries are assumed\n * to be in the `dataProjection` if that is set; in other words, they are not transformed.\n * @property {boolean} [rightHanded] When writing geometries, follow the right-hand\n * rule for linear ring orientation.  This means that polygons will have counter-clockwise\n * exterior rings and clockwise interior rings.  By default, coordinates are serialized\n * as they are provided at construction.  If `true`, the right-hand rule will\n * be applied.  If `false`, the left-hand rule will be applied (clockwise for\n * exterior and counter-clockwise for interior rings).  Note that not all\n * formats support this.  The GeoJSON format does use this property when writing\n * geometries.\n * @property {number} [decimals] Maximum number of decimal places for coordinates.\n * Coordinates are stored internally as floats, but floating-point arithmetic can create\n * coordinates with a large number of decimal places, not generally wanted on output.\n * Set a number here to round coordinates. Can also be used to ensure that\n * coordinates read in can be written back out with the same number of decimals.\n * Default is no rounding.\n */\n\n/**\n * @typedef {'arraybuffer' | 'json' | 'text' | 'xml'} Type\n */\n\n/**\n * @classdesc\n * Abstract base class; normally only used for creating subclasses and not\n * instantiated in apps.\n * Base class for feature formats.\n * {@link module:ol/format/Feature~FeatureFormat} subclasses provide the ability to decode and encode\n * {@link module:ol/Feature~Feature} objects from a variety of commonly used geospatial\n * file formats.  See the documentation for each format for more details.\n *\n * @abstract\n * @api\n */\nclass FeatureFormat {\n  constructor() {\n    /**\n     * @protected\n     * @type {import(\"../proj/Projection.js\").default|undefined}\n     */\n    this.dataProjection = undefined;\n\n    /**\n     * @protected\n     * @type {import(\"../proj/Projection.js\").default|undefined}\n     */\n    this.defaultFeatureProjection = undefined;\n\n    /**\n     * A list media types supported by the format in descending order of preference.\n     * @type {Array<string>}\n     */\n    this.supportedMediaTypes = null;\n  }\n\n  /**\n   * Adds the data projection to the read options.\n   * @param {Document|Element|Object|string} source Source.\n   * @param {ReadOptions} [options] Options.\n   * @return {ReadOptions|undefined} Options.\n   * @protected\n   */\n  getReadOptions(source, options) {\n    if (options) {\n      let dataProjection = options.dataProjection\n        ? getProjection(options.dataProjection)\n        : this.readProjection(source);\n      if (\n        options.extent &&\n        dataProjection &&\n        dataProjection.getUnits() === 'tile-pixels'\n      ) {\n        dataProjection = getProjection(dataProjection);\n        dataProjection.setWorldExtent(options.extent);\n      }\n      options = {\n        dataProjection: dataProjection,\n        featureProjection: options.featureProjection,\n      };\n    }\n    return this.adaptOptions(options);\n  }\n\n  /**\n   * Sets the `dataProjection` on the options, if no `dataProjection`\n   * is set.\n   * @param {WriteOptions|ReadOptions|undefined} options\n   *     Options.\n   * @protected\n   * @return {WriteOptions|ReadOptions|undefined}\n   *     Updated options.\n   */\n  adaptOptions(options) {\n    return Object.assign(\n      {\n        dataProjection: this.dataProjection,\n        featureProjection: this.defaultFeatureProjection,\n      },\n      options\n    );\n  }\n\n  /**\n   * @abstract\n   * @return {Type} The format type.\n   */\n  getType() {\n    return abstract();\n  }\n\n  /**\n   * Read a single feature from a source.\n   *\n   * @abstract\n   * @param {Document|Element|Object|string} source Source.\n   * @param {ReadOptions} [options] Read options.\n   * @return {import(\"../Feature.js\").FeatureLike} Feature.\n   */\n  readFeature(source, options) {\n    return abstract();\n  }\n\n  /**\n   * Read all features from a source.\n   *\n   * @abstract\n   * @param {Document|Element|ArrayBuffer|Object|string} source Source.\n   * @param {ReadOptions} [options] Read options.\n   * @return {Array<import(\"../Feature.js\").FeatureLike>} Features.\n   */\n  readFeatures(source, options) {\n    return abstract();\n  }\n\n  /**\n   * Read a single geometry from a source.\n   *\n   * @abstract\n   * @param {Document|Element|Object|string} source Source.\n   * @param {ReadOptions} [options] Read options.\n   * @return {import(\"../geom/Geometry.js\").default} Geometry.\n   */\n  readGeometry(source, options) {\n    return abstract();\n  }\n\n  /**\n   * Read the projection from a source.\n   *\n   * @abstract\n   * @param {Document|Element|Object|string} source Source.\n   * @return {import(\"../proj/Projection.js\").default|undefined} Projection.\n   */\n  readProjection(source) {\n    return abstract();\n  }\n\n  /**\n   * Encode a feature in this format.\n   *\n   * @abstract\n   * @param {import(\"../Feature.js\").default} feature Feature.\n   * @param {WriteOptions} [options] Write options.\n   * @return {string|ArrayBuffer} Result.\n   */\n  writeFeature(feature, options) {\n    return abstract();\n  }\n\n  /**\n   * Encode an array of features in this format.\n   *\n   * @abstract\n   * @param {Array<import(\"../Feature.js\").default>} features Features.\n   * @param {WriteOptions} [options] Write options.\n   * @return {string|ArrayBuffer} Result.\n   */\n  writeFeatures(features, options) {\n    return abstract();\n  }\n\n  /**\n   * Write a single geometry in this format.\n   *\n   * @abstract\n   * @param {import(\"../geom/Geometry.js\").default} geometry Geometry.\n   * @param {WriteOptions} [options] Write options.\n   * @return {string|ArrayBuffer} Result.\n   */\n  writeGeometry(geometry, options) {\n    return abstract();\n  }\n}\n\nexport default FeatureFormat;\n\n/**\n * @param {import(\"../geom/Geometry.js\").default} geometry Geometry.\n * @param {boolean} write Set to true for writing, false for reading.\n * @param {WriteOptions|ReadOptions} [options] Options.\n * @return {import(\"../geom/Geometry.js\").default} Transformed geometry.\n */\nexport function transformGeometryWithOptions(geometry, write, options) {\n  const featureProjection = options\n    ? getProjection(options.featureProjection)\n    : null;\n  const dataProjection = options ? getProjection(options.dataProjection) : null;\n\n  let transformed;\n  if (\n    featureProjection &&\n    dataProjection &&\n    !equivalentProjection(featureProjection, dataProjection)\n  ) {\n    transformed = (write ? geometry.clone() : geometry).transform(\n      write ? featureProjection : dataProjection,\n      write ? dataProjection : featureProjection\n    );\n  } else {\n    transformed = geometry;\n  }\n  if (\n    write &&\n    options &&\n    /** @type {WriteOptions} */ (options).decimals !== undefined\n  ) {\n    const power = Math.pow(10, /** @type {WriteOptions} */ (options).decimals);\n    // if decimals option on write, round each coordinate appropriately\n    /**\n     * @param {Array<number>} coordinates Coordinates.\n     * @return {Array<number>} Transformed coordinates.\n     */\n    const transform = function (coordinates) {\n      for (let i = 0, ii = coordinates.length; i < ii; ++i) {\n        coordinates[i] = Math.round(coordinates[i] * power) / power;\n      }\n      return coordinates;\n    };\n    if (transformed === geometry) {\n      transformed = geometry.clone();\n    }\n    transformed.applyTransform(transform);\n  }\n  return transformed;\n}\n\n/**\n * @param {import(\"../extent.js\").Extent} extent Extent.\n * @param {ReadOptions} [options] Read options.\n * @return {import(\"../extent.js\").Extent} Transformed extent.\n */\nexport function transformExtentWithOptions(extent, options) {\n  const featureProjection = options\n    ? getProjection(options.featureProjection)\n    : null;\n  const dataProjection = options ? getProjection(options.dataProjection) : null;\n\n  if (\n    featureProjection &&\n    dataProjection &&\n    !equivalentProjection(featureProjection, dataProjection)\n  ) {\n    return transformExtent(extent, dataProjection, featureProjection);\n  }\n  return extent;\n}\n","/**\n * @module ol/geom/MultiLineString\n */\nimport LineString from './LineString.js';\nimport SimpleGeometry from './SimpleGeometry.js';\nimport {arrayMaxSquaredDelta, assignClosestArrayPoint} from './flat/closest.js';\nimport {closestSquaredDistanceXY} from '../extent.js';\nimport {deflateCoordinatesArray} from './flat/deflate.js';\nimport {douglasPeuckerArray} from './flat/simplify.js';\nimport {extend} from '../array.js';\nimport {inflateCoordinatesArray} from './flat/inflate.js';\nimport {\n  interpolatePoint,\n  lineStringsCoordinateAtM,\n} from './flat/interpolate.js';\nimport {intersectsLineStringArray} from './flat/intersectsextent.js';\n\n/**\n * @classdesc\n * Multi-linestring geometry.\n *\n * @api\n */\nclass MultiLineString extends SimpleGeometry {\n  /**\n   * @param {Array<Array<import(\"../coordinate.js\").Coordinate>|LineString>|Array<number>} coordinates\n   *     Coordinates or LineString geometries. (For internal use, flat coordinates in\n   *     combination with `layout` and `ends` are also accepted.)\n   * @param {import(\"./Geometry.js\").GeometryLayout} [layout] Layout.\n   * @param {Array<number>} [ends] Flat coordinate ends for internal use.\n   */\n  constructor(coordinates, layout, ends) {\n    super();\n\n    /**\n     * @type {Array<number>}\n     * @private\n     */\n    this.ends_ = [];\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.maxDelta_ = -1;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.maxDeltaRevision_ = -1;\n\n    if (Array.isArray(coordinates[0])) {\n      this.setCoordinates(\n        /** @type {Array<Array<import(\"../coordinate.js\").Coordinate>>} */ (\n          coordinates\n        ),\n        layout\n      );\n    } else if (layout !== undefined && ends) {\n      this.setFlatCoordinates(\n        layout,\n        /** @type {Array<number>} */ (coordinates)\n      );\n      this.ends_ = ends;\n    } else {\n      let layout = this.getLayout();\n      const lineStrings = /** @type {Array<LineString>} */ (coordinates);\n      const flatCoordinates = [];\n      const ends = [];\n      for (let i = 0, ii = lineStrings.length; i < ii; ++i) {\n        const lineString = lineStrings[i];\n        if (i === 0) {\n          layout = lineString.getLayout();\n        }\n        extend(flatCoordinates, lineString.getFlatCoordinates());\n        ends.push(flatCoordinates.length);\n      }\n      this.setFlatCoordinates(layout, flatCoordinates);\n      this.ends_ = ends;\n    }\n  }\n\n  /**\n   * Append the passed linestring to the multilinestring.\n   * @param {LineString} lineString LineString.\n   * @api\n   */\n  appendLineString(lineString) {\n    if (!this.flatCoordinates) {\n      this.flatCoordinates = lineString.getFlatCoordinates().slice();\n    } else {\n      extend(this.flatCoordinates, lineString.getFlatCoordinates().slice());\n    }\n    this.ends_.push(this.flatCoordinates.length);\n    this.changed();\n  }\n\n  /**\n   * Make a complete copy of the geometry.\n   * @return {!MultiLineString} Clone.\n   * @api\n   */\n  clone() {\n    const multiLineString = new MultiLineString(\n      this.flatCoordinates.slice(),\n      this.layout,\n      this.ends_.slice()\n    );\n    multiLineString.applyProperties(this);\n    return multiLineString;\n  }\n\n  /**\n   * @param {number} x X.\n   * @param {number} y Y.\n   * @param {import(\"../coordinate.js\").Coordinate} closestPoint Closest point.\n   * @param {number} minSquaredDistance Minimum squared distance.\n   * @return {number} Minimum squared distance.\n   */\n  closestPointXY(x, y, closestPoint, minSquaredDistance) {\n    if (minSquaredDistance < closestSquaredDistanceXY(this.getExtent(), x, y)) {\n      return minSquaredDistance;\n    }\n    if (this.maxDeltaRevision_ != this.getRevision()) {\n      this.maxDelta_ = Math.sqrt(\n        arrayMaxSquaredDelta(\n          this.flatCoordinates,\n          0,\n          this.ends_,\n          this.stride,\n          0\n        )\n      );\n      this.maxDeltaRevision_ = this.getRevision();\n    }\n    return assignClosestArrayPoint(\n      this.flatCoordinates,\n      0,\n      this.ends_,\n      this.stride,\n      this.maxDelta_,\n      false,\n      x,\n      y,\n      closestPoint,\n      minSquaredDistance\n    );\n  }\n\n  /**\n   * Returns the coordinate at `m` using linear interpolation, or `null` if no\n   * such coordinate exists.\n   *\n   * `extrapolate` controls extrapolation beyond the range of Ms in the\n   * MultiLineString. If `extrapolate` is `true` then Ms less than the first\n   * M will return the first coordinate and Ms greater than the last M will\n   * return the last coordinate.\n   *\n   * `interpolate` controls interpolation between consecutive LineStrings\n   * within the MultiLineString. If `interpolate` is `true` the coordinates\n   * will be linearly interpolated between the last coordinate of one LineString\n   * and the first coordinate of the next LineString.  If `interpolate` is\n   * `false` then the function will return `null` for Ms falling between\n   * LineStrings.\n   *\n   * @param {number} m M.\n   * @param {boolean} [extrapolate] Extrapolate. Default is `false`.\n   * @param {boolean} [interpolate] Interpolate. Default is `false`.\n   * @return {import(\"../coordinate.js\").Coordinate|null} Coordinate.\n   * @api\n   */\n  getCoordinateAtM(m, extrapolate, interpolate) {\n    if (\n      (this.layout != 'XYM' && this.layout != 'XYZM') ||\n      this.flatCoordinates.length === 0\n    ) {\n      return null;\n    }\n    extrapolate = extrapolate !== undefined ? extrapolate : false;\n    interpolate = interpolate !== undefined ? interpolate : false;\n    return lineStringsCoordinateAtM(\n      this.flatCoordinates,\n      0,\n      this.ends_,\n      this.stride,\n      m,\n      extrapolate,\n      interpolate\n    );\n  }\n\n  /**\n   * Return the coordinates of the multilinestring.\n   * @return {Array<Array<import(\"../coordinate.js\").Coordinate>>} Coordinates.\n   * @api\n   */\n  getCoordinates() {\n    return inflateCoordinatesArray(\n      this.flatCoordinates,\n      0,\n      this.ends_,\n      this.stride\n    );\n  }\n\n  /**\n   * @return {Array<number>} Ends.\n   */\n  getEnds() {\n    return this.ends_;\n  }\n\n  /**\n   * Return the linestring at the specified index.\n   * @param {number} index Index.\n   * @return {LineString} LineString.\n   * @api\n   */\n  getLineString(index) {\n    if (index < 0 || this.ends_.length <= index) {\n      return null;\n    }\n    return new LineString(\n      this.flatCoordinates.slice(\n        index === 0 ? 0 : this.ends_[index - 1],\n        this.ends_[index]\n      ),\n      this.layout\n    );\n  }\n\n  /**\n   * Return the linestrings of this multilinestring.\n   * @return {Array<LineString>} LineStrings.\n   * @api\n   */\n  getLineStrings() {\n    const flatCoordinates = this.flatCoordinates;\n    const ends = this.ends_;\n    const layout = this.layout;\n    /** @type {Array<LineString>} */\n    const lineStrings = [];\n    let offset = 0;\n    for (let i = 0, ii = ends.length; i < ii; ++i) {\n      const end = ends[i];\n      const lineString = new LineString(\n        flatCoordinates.slice(offset, end),\n        layout\n      );\n      lineStrings.push(lineString);\n      offset = end;\n    }\n    return lineStrings;\n  }\n\n  /**\n   * @return {Array<number>} Flat midpoints.\n   */\n  getFlatMidpoints() {\n    const midpoints = [];\n    const flatCoordinates = this.flatCoordinates;\n    let offset = 0;\n    const ends = this.ends_;\n    const stride = this.stride;\n    for (let i = 0, ii = ends.length; i < ii; ++i) {\n      const end = ends[i];\n      const midpoint = interpolatePoint(\n        flatCoordinates,\n        offset,\n        end,\n        stride,\n        0.5\n      );\n      extend(midpoints, midpoint);\n      offset = end;\n    }\n    return midpoints;\n  }\n\n  /**\n   * @param {number} squaredTolerance Squared tolerance.\n   * @return {MultiLineString} Simplified MultiLineString.\n   * @protected\n   */\n  getSimplifiedGeometryInternal(squaredTolerance) {\n    const simplifiedFlatCoordinates = [];\n    const simplifiedEnds = [];\n    simplifiedFlatCoordinates.length = douglasPeuckerArray(\n      this.flatCoordinates,\n      0,\n      this.ends_,\n      this.stride,\n      squaredTolerance,\n      simplifiedFlatCoordinates,\n      0,\n      simplifiedEnds\n    );\n    return new MultiLineString(simplifiedFlatCoordinates, 'XY', simplifiedEnds);\n  }\n\n  /**\n   * Get the type of this geometry.\n   * @return {import(\"./Geometry.js\").Type} Geometry type.\n   * @api\n   */\n  getType() {\n    return 'MultiLineString';\n  }\n\n  /**\n   * Test if the geometry and the passed extent intersect.\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @return {boolean} `true` if the geometry and the extent intersect.\n   * @api\n   */\n  intersectsExtent(extent) {\n    return intersectsLineStringArray(\n      this.flatCoordinates,\n      0,\n      this.ends_,\n      this.stride,\n      extent\n    );\n  }\n\n  /**\n   * Set the coordinates of the multilinestring.\n   * @param {!Array<Array<import(\"../coordinate.js\").Coordinate>>} coordinates Coordinates.\n   * @param {import(\"./Geometry.js\").GeometryLayout} [layout] Layout.\n   * @api\n   */\n  setCoordinates(coordinates, layout) {\n    this.setLayout(layout, coordinates, 2);\n    if (!this.flatCoordinates) {\n      this.flatCoordinates = [];\n    }\n    const ends = deflateCoordinatesArray(\n      this.flatCoordinates,\n      0,\n      coordinates,\n      this.stride,\n      this.ends_\n    );\n    this.flatCoordinates.length = ends.length === 0 ? 0 : ends[ends.length - 1];\n    this.changed();\n  }\n}\n\nexport default MultiLineString;\n","/**\n * @module ol/geom/MultiPoint\n */\nimport Point from './Point.js';\nimport SimpleGeometry from './SimpleGeometry.js';\nimport {closestSquaredDistanceXY, containsXY} from '../extent.js';\nimport {deflateCoordinates} from './flat/deflate.js';\nimport {extend} from '../array.js';\nimport {inflateCoordinates} from './flat/inflate.js';\nimport {squaredDistance as squaredDx} from '../math.js';\n\n/**\n * @classdesc\n * Multi-point geometry.\n *\n * @api\n */\nclass MultiPoint extends SimpleGeometry {\n  /**\n   * @param {Array<import(\"../coordinate.js\").Coordinate>|Array<number>} coordinates Coordinates.\n   *     For internal use, flat coordinates in combination with `layout` are also accepted.\n   * @param {import(\"./Geometry.js\").GeometryLayout} [layout] Layout.\n   */\n  constructor(coordinates, layout) {\n    super();\n    if (layout && !Array.isArray(coordinates[0])) {\n      this.setFlatCoordinates(\n        layout,\n        /** @type {Array<number>} */ (coordinates)\n      );\n    } else {\n      this.setCoordinates(\n        /** @type {Array<import(\"../coordinate.js\").Coordinate>} */ (\n          coordinates\n        ),\n        layout\n      );\n    }\n  }\n\n  /**\n   * Append the passed point to this multipoint.\n   * @param {Point} point Point.\n   * @api\n   */\n  appendPoint(point) {\n    if (!this.flatCoordinates) {\n      this.flatCoordinates = point.getFlatCoordinates().slice();\n    } else {\n      extend(this.flatCoordinates, point.getFlatCoordinates());\n    }\n    this.changed();\n  }\n\n  /**\n   * Make a complete copy of the geometry.\n   * @return {!MultiPoint} Clone.\n   * @api\n   */\n  clone() {\n    const multiPoint = new MultiPoint(\n      this.flatCoordinates.slice(),\n      this.layout\n    );\n    multiPoint.applyProperties(this);\n    return multiPoint;\n  }\n\n  /**\n   * @param {number} x X.\n   * @param {number} y Y.\n   * @param {import(\"../coordinate.js\").Coordinate} closestPoint Closest point.\n   * @param {number} minSquaredDistance Minimum squared distance.\n   * @return {number} Minimum squared distance.\n   */\n  closestPointXY(x, y, closestPoint, minSquaredDistance) {\n    if (minSquaredDistance < closestSquaredDistanceXY(this.getExtent(), x, y)) {\n      return minSquaredDistance;\n    }\n    const flatCoordinates = this.flatCoordinates;\n    const stride = this.stride;\n    for (let i = 0, ii = flatCoordinates.length; i < ii; i += stride) {\n      const squaredDistance = squaredDx(\n        x,\n        y,\n        flatCoordinates[i],\n        flatCoordinates[i + 1]\n      );\n      if (squaredDistance < minSquaredDistance) {\n        minSquaredDistance = squaredDistance;\n        for (let j = 0; j < stride; ++j) {\n          closestPoint[j] = flatCoordinates[i + j];\n        }\n        closestPoint.length = stride;\n      }\n    }\n    return minSquaredDistance;\n  }\n\n  /**\n   * Return the coordinates of the multipoint.\n   * @return {Array<import(\"../coordinate.js\").Coordinate>} Coordinates.\n   * @api\n   */\n  getCoordinates() {\n    return inflateCoordinates(\n      this.flatCoordinates,\n      0,\n      this.flatCoordinates.length,\n      this.stride\n    );\n  }\n\n  /**\n   * Return the point at the specified index.\n   * @param {number} index Index.\n   * @return {Point} Point.\n   * @api\n   */\n  getPoint(index) {\n    const n = !this.flatCoordinates\n      ? 0\n      : this.flatCoordinates.length / this.stride;\n    if (index < 0 || n <= index) {\n      return null;\n    }\n    return new Point(\n      this.flatCoordinates.slice(\n        index * this.stride,\n        (index + 1) * this.stride\n      ),\n      this.layout\n    );\n  }\n\n  /**\n   * Return the points of this multipoint.\n   * @return {Array<Point>} Points.\n   * @api\n   */\n  getPoints() {\n    const flatCoordinates = this.flatCoordinates;\n    const layout = this.layout;\n    const stride = this.stride;\n    /** @type {Array<Point>} */\n    const points = [];\n    for (let i = 0, ii = flatCoordinates.length; i < ii; i += stride) {\n      const point = new Point(flatCoordinates.slice(i, i + stride), layout);\n      points.push(point);\n    }\n    return points;\n  }\n\n  /**\n   * Get the type of this geometry.\n   * @return {import(\"./Geometry.js\").Type} Geometry type.\n   * @api\n   */\n  getType() {\n    return 'MultiPoint';\n  }\n\n  /**\n   * Test if the geometry and the passed extent intersect.\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @return {boolean} `true` if the geometry and the extent intersect.\n   * @api\n   */\n  intersectsExtent(extent) {\n    const flatCoordinates = this.flatCoordinates;\n    const stride = this.stride;\n    for (let i = 0, ii = flatCoordinates.length; i < ii; i += stride) {\n      const x = flatCoordinates[i];\n      const y = flatCoordinates[i + 1];\n      if (containsXY(extent, x, y)) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Set the coordinates of the multipoint.\n   * @param {!Array<import(\"../coordinate.js\").Coordinate>} coordinates Coordinates.\n   * @param {import(\"./Geometry.js\").GeometryLayout} [layout] Layout.\n   * @api\n   */\n  setCoordinates(coordinates, layout) {\n    this.setLayout(layout, coordinates, 1);\n    if (!this.flatCoordinates) {\n      this.flatCoordinates = [];\n    }\n    this.flatCoordinates.length = deflateCoordinates(\n      this.flatCoordinates,\n      0,\n      coordinates,\n      this.stride\n    );\n    this.changed();\n  }\n}\n\nexport default MultiPoint;\n","/**\n * @module ol/geom/flat/center\n */\nimport {createEmpty, createOrUpdateFromFlatCoordinates} from '../../extent.js';\n\n/**\n * @param {Array<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {Array<Array<number>>} endss Endss.\n * @param {number} stride Stride.\n * @return {Array<number>} Flat centers.\n */\nexport function linearRingss(flatCoordinates, offset, endss, stride) {\n  const flatCenters = [];\n  let extent = createEmpty();\n  for (let i = 0, ii = endss.length; i < ii; ++i) {\n    const ends = endss[i];\n    extent = createOrUpdateFromFlatCoordinates(\n      flatCoordinates,\n      offset,\n      ends[0],\n      stride\n    );\n    flatCenters.push((extent[0] + extent[2]) / 2, (extent[1] + extent[3]) / 2);\n    offset = ends[ends.length - 1];\n  }\n  return flatCenters;\n}\n","/**\n * @module ol/geom/MultiPolygon\n */\nimport MultiPoint from './MultiPoint.js';\nimport Polygon from './Polygon.js';\nimport SimpleGeometry from './SimpleGeometry.js';\nimport {\n  assignClosestMultiArrayPoint,\n  multiArrayMaxSquaredDelta,\n} from './flat/closest.js';\nimport {closestSquaredDistanceXY} from '../extent.js';\nimport {deflateMultiCoordinatesArray} from './flat/deflate.js';\nimport {extend} from '../array.js';\nimport {getInteriorPointsOfMultiArray} from './flat/interiorpoint.js';\nimport {inflateMultiCoordinatesArray} from './flat/inflate.js';\nimport {intersectsLinearRingMultiArray} from './flat/intersectsextent.js';\nimport {\n  linearRingssAreOriented,\n  orientLinearRingsArray,\n} from './flat/orient.js';\nimport {linearRingss as linearRingssArea} from './flat/area.js';\nimport {linearRingss as linearRingssCenter} from './flat/center.js';\nimport {linearRingssContainsXY} from './flat/contains.js';\nimport {quantizeMultiArray} from './flat/simplify.js';\n\n/**\n * @classdesc\n * Multi-polygon geometry.\n *\n * @api\n */\nclass MultiPolygon extends SimpleGeometry {\n  /**\n   * @param {Array<Array<Array<import(\"../coordinate.js\").Coordinate>>|Polygon>|Array<number>} coordinates Coordinates.\n   *     For internal use, flat coordinates in combination with `layout` and `endss` are also accepted.\n   * @param {import(\"./Geometry.js\").GeometryLayout} [layout] Layout.\n   * @param {Array<Array<number>>} [endss] Array of ends for internal use with flat coordinates.\n   */\n  constructor(coordinates, layout, endss) {\n    super();\n\n    /**\n     * @type {Array<Array<number>>}\n     * @private\n     */\n    this.endss_ = [];\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.flatInteriorPointsRevision_ = -1;\n\n    /**\n     * @private\n     * @type {Array<number>}\n     */\n    this.flatInteriorPoints_ = null;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.maxDelta_ = -1;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.maxDeltaRevision_ = -1;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.orientedRevision_ = -1;\n\n    /**\n     * @private\n     * @type {Array<number>}\n     */\n    this.orientedFlatCoordinates_ = null;\n\n    if (!endss && !Array.isArray(coordinates[0])) {\n      let thisLayout = this.getLayout();\n      const polygons = /** @type {Array<Polygon>} */ (coordinates);\n      const flatCoordinates = [];\n      const thisEndss = [];\n      for (let i = 0, ii = polygons.length; i < ii; ++i) {\n        const polygon = polygons[i];\n        if (i === 0) {\n          thisLayout = polygon.getLayout();\n        }\n        const offset = flatCoordinates.length;\n        const ends = polygon.getEnds();\n        for (let j = 0, jj = ends.length; j < jj; ++j) {\n          ends[j] += offset;\n        }\n        extend(flatCoordinates, polygon.getFlatCoordinates());\n        thisEndss.push(ends);\n      }\n      layout = thisLayout;\n      coordinates = flatCoordinates;\n      endss = thisEndss;\n    }\n    if (layout !== undefined && endss) {\n      this.setFlatCoordinates(\n        layout,\n        /** @type {Array<number>} */ (coordinates)\n      );\n      this.endss_ = endss;\n    } else {\n      this.setCoordinates(\n        /** @type {Array<Array<Array<import(\"../coordinate.js\").Coordinate>>>} */ (\n          coordinates\n        ),\n        layout\n      );\n    }\n  }\n\n  /**\n   * Append the passed polygon to this multipolygon.\n   * @param {Polygon} polygon Polygon.\n   * @api\n   */\n  appendPolygon(polygon) {\n    /** @type {Array<number>} */\n    let ends;\n    if (!this.flatCoordinates) {\n      this.flatCoordinates = polygon.getFlatCoordinates().slice();\n      ends = polygon.getEnds().slice();\n      this.endss_.push();\n    } else {\n      const offset = this.flatCoordinates.length;\n      extend(this.flatCoordinates, polygon.getFlatCoordinates());\n      ends = polygon.getEnds().slice();\n      for (let i = 0, ii = ends.length; i < ii; ++i) {\n        ends[i] += offset;\n      }\n    }\n    this.endss_.push(ends);\n    this.changed();\n  }\n\n  /**\n   * Make a complete copy of the geometry.\n   * @return {!MultiPolygon} Clone.\n   * @api\n   */\n  clone() {\n    const len = this.endss_.length;\n    const newEndss = new Array(len);\n    for (let i = 0; i < len; ++i) {\n      newEndss[i] = this.endss_[i].slice();\n    }\n\n    const multiPolygon = new MultiPolygon(\n      this.flatCoordinates.slice(),\n      this.layout,\n      newEndss\n    );\n    multiPolygon.applyProperties(this);\n\n    return multiPolygon;\n  }\n\n  /**\n   * @param {number} x X.\n   * @param {number} y Y.\n   * @param {import(\"../coordinate.js\").Coordinate} closestPoint Closest point.\n   * @param {number} minSquaredDistance Minimum squared distance.\n   * @return {number} Minimum squared distance.\n   */\n  closestPointXY(x, y, closestPoint, minSquaredDistance) {\n    if (minSquaredDistance < closestSquaredDistanceXY(this.getExtent(), x, y)) {\n      return minSquaredDistance;\n    }\n    if (this.maxDeltaRevision_ != this.getRevision()) {\n      this.maxDelta_ = Math.sqrt(\n        multiArrayMaxSquaredDelta(\n          this.flatCoordinates,\n          0,\n          this.endss_,\n          this.stride,\n          0\n        )\n      );\n      this.maxDeltaRevision_ = this.getRevision();\n    }\n    return assignClosestMultiArrayPoint(\n      this.getOrientedFlatCoordinates(),\n      0,\n      this.endss_,\n      this.stride,\n      this.maxDelta_,\n      true,\n      x,\n      y,\n      closestPoint,\n      minSquaredDistance\n    );\n  }\n\n  /**\n   * @param {number} x X.\n   * @param {number} y Y.\n   * @return {boolean} Contains (x, y).\n   */\n  containsXY(x, y) {\n    return linearRingssContainsXY(\n      this.getOrientedFlatCoordinates(),\n      0,\n      this.endss_,\n      this.stride,\n      x,\n      y\n    );\n  }\n\n  /**\n   * Return the area of the multipolygon on projected plane.\n   * @return {number} Area (on projected plane).\n   * @api\n   */\n  getArea() {\n    return linearRingssArea(\n      this.getOrientedFlatCoordinates(),\n      0,\n      this.endss_,\n      this.stride\n    );\n  }\n\n  /**\n   * Get the coordinate array for this geometry.  This array has the structure\n   * of a GeoJSON coordinate array for multi-polygons.\n   *\n   * @param {boolean} [right] Orient coordinates according to the right-hand\n   *     rule (counter-clockwise for exterior and clockwise for interior rings).\n   *     If `false`, coordinates will be oriented according to the left-hand rule\n   *     (clockwise for exterior and counter-clockwise for interior rings).\n   *     By default, coordinate orientation will depend on how the geometry was\n   *     constructed.\n   * @return {Array<Array<Array<import(\"../coordinate.js\").Coordinate>>>} Coordinates.\n   * @api\n   */\n  getCoordinates(right) {\n    let flatCoordinates;\n    if (right !== undefined) {\n      flatCoordinates = this.getOrientedFlatCoordinates().slice();\n      orientLinearRingsArray(\n        flatCoordinates,\n        0,\n        this.endss_,\n        this.stride,\n        right\n      );\n    } else {\n      flatCoordinates = this.flatCoordinates;\n    }\n\n    return inflateMultiCoordinatesArray(\n      flatCoordinates,\n      0,\n      this.endss_,\n      this.stride\n    );\n  }\n\n  /**\n   * @return {Array<Array<number>>} Endss.\n   */\n  getEndss() {\n    return this.endss_;\n  }\n\n  /**\n   * @return {Array<number>} Flat interior points.\n   */\n  getFlatInteriorPoints() {\n    if (this.flatInteriorPointsRevision_ != this.getRevision()) {\n      const flatCenters = linearRingssCenter(\n        this.flatCoordinates,\n        0,\n        this.endss_,\n        this.stride\n      );\n      this.flatInteriorPoints_ = getInteriorPointsOfMultiArray(\n        this.getOrientedFlatCoordinates(),\n        0,\n        this.endss_,\n        this.stride,\n        flatCenters\n      );\n      this.flatInteriorPointsRevision_ = this.getRevision();\n    }\n    return this.flatInteriorPoints_;\n  }\n\n  /**\n   * Return the interior points as {@link module:ol/geom/MultiPoint~MultiPoint multipoint}.\n   * @return {MultiPoint} Interior points as XYM coordinates, where M is\n   * the length of the horizontal intersection that the point belongs to.\n   * @api\n   */\n  getInteriorPoints() {\n    return new MultiPoint(this.getFlatInteriorPoints().slice(), 'XYM');\n  }\n\n  /**\n   * @return {Array<number>} Oriented flat coordinates.\n   */\n  getOrientedFlatCoordinates() {\n    if (this.orientedRevision_ != this.getRevision()) {\n      const flatCoordinates = this.flatCoordinates;\n      if (\n        linearRingssAreOriented(flatCoordinates, 0, this.endss_, this.stride)\n      ) {\n        this.orientedFlatCoordinates_ = flatCoordinates;\n      } else {\n        this.orientedFlatCoordinates_ = flatCoordinates.slice();\n        this.orientedFlatCoordinates_.length = orientLinearRingsArray(\n          this.orientedFlatCoordinates_,\n          0,\n          this.endss_,\n          this.stride\n        );\n      }\n      this.orientedRevision_ = this.getRevision();\n    }\n    return this.orientedFlatCoordinates_;\n  }\n\n  /**\n   * @param {number} squaredTolerance Squared tolerance.\n   * @return {MultiPolygon} Simplified MultiPolygon.\n   * @protected\n   */\n  getSimplifiedGeometryInternal(squaredTolerance) {\n    const simplifiedFlatCoordinates = [];\n    const simplifiedEndss = [];\n    simplifiedFlatCoordinates.length = quantizeMultiArray(\n      this.flatCoordinates,\n      0,\n      this.endss_,\n      this.stride,\n      Math.sqrt(squaredTolerance),\n      simplifiedFlatCoordinates,\n      0,\n      simplifiedEndss\n    );\n    return new MultiPolygon(simplifiedFlatCoordinates, 'XY', simplifiedEndss);\n  }\n\n  /**\n   * Return the polygon at the specified index.\n   * @param {number} index Index.\n   * @return {Polygon} Polygon.\n   * @api\n   */\n  getPolygon(index) {\n    if (index < 0 || this.endss_.length <= index) {\n      return null;\n    }\n    let offset;\n    if (index === 0) {\n      offset = 0;\n    } else {\n      const prevEnds = this.endss_[index - 1];\n      offset = prevEnds[prevEnds.length - 1];\n    }\n    const ends = this.endss_[index].slice();\n    const end = ends[ends.length - 1];\n    if (offset !== 0) {\n      for (let i = 0, ii = ends.length; i < ii; ++i) {\n        ends[i] -= offset;\n      }\n    }\n    return new Polygon(\n      this.flatCoordinates.slice(offset, end),\n      this.layout,\n      ends\n    );\n  }\n\n  /**\n   * Return the polygons of this multipolygon.\n   * @return {Array<Polygon>} Polygons.\n   * @api\n   */\n  getPolygons() {\n    const layout = this.layout;\n    const flatCoordinates = this.flatCoordinates;\n    const endss = this.endss_;\n    const polygons = [];\n    let offset = 0;\n    for (let i = 0, ii = endss.length; i < ii; ++i) {\n      const ends = endss[i].slice();\n      const end = ends[ends.length - 1];\n      if (offset !== 0) {\n        for (let j = 0, jj = ends.length; j < jj; ++j) {\n          ends[j] -= offset;\n        }\n      }\n      const polygon = new Polygon(\n        flatCoordinates.slice(offset, end),\n        layout,\n        ends\n      );\n      polygons.push(polygon);\n      offset = end;\n    }\n    return polygons;\n  }\n\n  /**\n   * Get the type of this geometry.\n   * @return {import(\"./Geometry.js\").Type} Geometry type.\n   * @api\n   */\n  getType() {\n    return 'MultiPolygon';\n  }\n\n  /**\n   * Test if the geometry and the passed extent intersect.\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @return {boolean} `true` if the geometry and the extent intersect.\n   * @api\n   */\n  intersectsExtent(extent) {\n    return intersectsLinearRingMultiArray(\n      this.getOrientedFlatCoordinates(),\n      0,\n      this.endss_,\n      this.stride,\n      extent\n    );\n  }\n\n  /**\n   * Set the coordinates of the multipolygon.\n   * @param {!Array<Array<Array<import(\"../coordinate.js\").Coordinate>>>} coordinates Coordinates.\n   * @param {import(\"./Geometry.js\").GeometryLayout} [layout] Layout.\n   * @api\n   */\n  setCoordinates(coordinates, layout) {\n    this.setLayout(layout, coordinates, 3);\n    if (!this.flatCoordinates) {\n      this.flatCoordinates = [];\n    }\n    const endss = deflateMultiCoordinatesArray(\n      this.flatCoordinates,\n      0,\n      coordinates,\n      this.stride,\n      this.endss_\n    );\n    if (endss.length === 0) {\n      this.flatCoordinates.length = 0;\n    } else {\n      const lastEnds = endss[endss.length - 1];\n      this.flatCoordinates.length =\n        lastEnds.length === 0 ? 0 : lastEnds[lastEnds.length - 1];\n    }\n    this.changed();\n  }\n}\n\nexport default MultiPolygon;\n","/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */\nexports.read = function (buffer, offset, isLE, mLen, nBytes) {\n  var e, m\n  var eLen = (nBytes * 8) - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var nBits = -7\n  var i = isLE ? (nBytes - 1) : 0\n  var d = isLE ? -1 : 1\n  var s = buffer[offset + i]\n\n  i += d\n\n  e = s & ((1 << (-nBits)) - 1)\n  s >>= (-nBits)\n  nBits += eLen\n  for (; nBits > 0; e = (e * 256) + buffer[offset + i], i += d, nBits -= 8) {}\n\n  m = e & ((1 << (-nBits)) - 1)\n  e >>= (-nBits)\n  nBits += mLen\n  for (; nBits > 0; m = (m * 256) + buffer[offset + i], i += d, nBits -= 8) {}\n\n  if (e === 0) {\n    e = 1 - eBias\n  } else if (e === eMax) {\n    return m ? NaN : ((s ? -1 : 1) * Infinity)\n  } else {\n    m = m + Math.pow(2, mLen)\n    e = e - eBias\n  }\n  return (s ? -1 : 1) * m * Math.pow(2, e - mLen)\n}\n\nexports.write = function (buffer, value, offset, isLE, mLen, nBytes) {\n  var e, m, c\n  var eLen = (nBytes * 8) - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var rt = (mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0)\n  var i = isLE ? 0 : (nBytes - 1)\n  var d = isLE ? 1 : -1\n  var s = value < 0 || (value === 0 && 1 / value < 0) ? 1 : 0\n\n  value = Math.abs(value)\n\n  if (isNaN(value) || value === Infinity) {\n    m = isNaN(value) ? 1 : 0\n    e = eMax\n  } else {\n    e = Math.floor(Math.log(value) / Math.LN2)\n    if (value * (c = Math.pow(2, -e)) < 1) {\n      e--\n      c *= 2\n    }\n    if (e + eBias >= 1) {\n      value += rt / c\n    } else {\n      value += rt * Math.pow(2, 1 - eBias)\n    }\n    if (value * c >= 2) {\n      e++\n      c /= 2\n    }\n\n    if (e + eBias >= eMax) {\n      m = 0\n      e = eMax\n    } else if (e + eBias >= 1) {\n      m = ((value * c) - 1) * Math.pow(2, mLen)\n      e = e + eBias\n    } else {\n      m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen)\n      e = 0\n    }\n  }\n\n  for (; mLen >= 8; buffer[offset + i] = m & 0xff, i += d, m /= 256, mLen -= 8) {}\n\n  e = (e << mLen) | m\n  eLen += mLen\n  for (; eLen > 0; buffer[offset + i] = e & 0xff, i += d, e /= 256, eLen -= 8) {}\n\n  buffer[offset + i - d] |= s * 128\n}\n","'use strict';\n\nmodule.exports = Pbf;\n\nvar ieee754 = require('ieee754');\n\nfunction Pbf(buf) {\n    this.buf = ArrayBuffer.isView && ArrayBuffer.isView(buf) ? buf : new Uint8Array(buf || 0);\n    this.pos = 0;\n    this.type = 0;\n    this.length = this.buf.length;\n}\n\nPbf.Varint  = 0; // varint: int32, int64, uint32, uint64, sint32, sint64, bool, enum\nPbf.Fixed64 = 1; // 64-bit: double, fixed64, sfixed64\nPbf.Bytes   = 2; // length-delimited: string, bytes, embedded messages, packed repeated fields\nPbf.Fixed32 = 5; // 32-bit: float, fixed32, sfixed32\n\nvar SHIFT_LEFT_32 = (1 << 16) * (1 << 16),\n    SHIFT_RIGHT_32 = 1 / SHIFT_LEFT_32;\n\n// Threshold chosen based on both benchmarking and knowledge about browser string\n// data structures (which currently switch structure types at 12 bytes or more)\nvar TEXT_DECODER_MIN_LENGTH = 12;\nvar utf8TextDecoder = typeof TextDecoder === 'undefined' ? null : new TextDecoder('utf8');\n\nPbf.prototype = {\n\n    destroy: function() {\n        this.buf = null;\n    },\n\n    // === READING =================================================================\n\n    readFields: function(readField, result, end) {\n        end = end || this.length;\n\n        while (this.pos < end) {\n            var val = this.readVarint(),\n                tag = val >> 3,\n                startPos = this.pos;\n\n            this.type = val & 0x7;\n            readField(tag, result, this);\n\n            if (this.pos === startPos) this.skip(val);\n        }\n        return result;\n    },\n\n    readMessage: function(readField, result) {\n        return this.readFields(readField, result, this.readVarint() + this.pos);\n    },\n\n    readFixed32: function() {\n        var val = readUInt32(this.buf, this.pos);\n        this.pos += 4;\n        return val;\n    },\n\n    readSFixed32: function() {\n        var val = readInt32(this.buf, this.pos);\n        this.pos += 4;\n        return val;\n    },\n\n    // 64-bit int handling is based on github.com/dpw/node-buffer-more-ints (MIT-licensed)\n\n    readFixed64: function() {\n        var val = readUInt32(this.buf, this.pos) + readUInt32(this.buf, this.pos + 4) * SHIFT_LEFT_32;\n        this.pos += 8;\n        return val;\n    },\n\n    readSFixed64: function() {\n        var val = readUInt32(this.buf, this.pos) + readInt32(this.buf, this.pos + 4) * SHIFT_LEFT_32;\n        this.pos += 8;\n        return val;\n    },\n\n    readFloat: function() {\n        var val = ieee754.read(this.buf, this.pos, true, 23, 4);\n        this.pos += 4;\n        return val;\n    },\n\n    readDouble: function() {\n        var val = ieee754.read(this.buf, this.pos, true, 52, 8);\n        this.pos += 8;\n        return val;\n    },\n\n    readVarint: function(isSigned) {\n        var buf = this.buf,\n            val, b;\n\n        b = buf[this.pos++]; val  =  b & 0x7f;        if (b < 0x80) return val;\n        b = buf[this.pos++]; val |= (b & 0x7f) << 7;  if (b < 0x80) return val;\n        b = buf[this.pos++]; val |= (b & 0x7f) << 14; if (b < 0x80) return val;\n        b = buf[this.pos++]; val |= (b & 0x7f) << 21; if (b < 0x80) return val;\n        b = buf[this.pos];   val |= (b & 0x0f) << 28;\n\n        return readVarintRemainder(val, isSigned, this);\n    },\n\n    readVarint64: function() { // for compatibility with v2.0.1\n        return this.readVarint(true);\n    },\n\n    readSVarint: function() {\n        var num = this.readVarint();\n        return num % 2 === 1 ? (num + 1) / -2 : num / 2; // zigzag encoding\n    },\n\n    readBoolean: function() {\n        return Boolean(this.readVarint());\n    },\n\n    readString: function() {\n        var end = this.readVarint() + this.pos;\n        var pos = this.pos;\n        this.pos = end;\n\n        if (end - pos >= TEXT_DECODER_MIN_LENGTH && utf8TextDecoder) {\n            // longer strings are fast with the built-in browser TextDecoder API\n            return readUtf8TextDecoder(this.buf, pos, end);\n        }\n        // short strings are fast with our custom implementation\n        return readUtf8(this.buf, pos, end);\n    },\n\n    readBytes: function() {\n        var end = this.readVarint() + this.pos,\n            buffer = this.buf.subarray(this.pos, end);\n        this.pos = end;\n        return buffer;\n    },\n\n    // verbose for performance reasons; doesn't affect gzipped size\n\n    readPackedVarint: function(arr, isSigned) {\n        if (this.type !== Pbf.Bytes) return arr.push(this.readVarint(isSigned));\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readVarint(isSigned));\n        return arr;\n    },\n    readPackedSVarint: function(arr) {\n        if (this.type !== Pbf.Bytes) return arr.push(this.readSVarint());\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readSVarint());\n        return arr;\n    },\n    readPackedBoolean: function(arr) {\n        if (this.type !== Pbf.Bytes) return arr.push(this.readBoolean());\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readBoolean());\n        return arr;\n    },\n    readPackedFloat: function(arr) {\n        if (this.type !== Pbf.Bytes) return arr.push(this.readFloat());\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readFloat());\n        return arr;\n    },\n    readPackedDouble: function(arr) {\n        if (this.type !== Pbf.Bytes) return arr.push(this.readDouble());\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readDouble());\n        return arr;\n    },\n    readPackedFixed32: function(arr) {\n        if (this.type !== Pbf.Bytes) return arr.push(this.readFixed32());\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readFixed32());\n        return arr;\n    },\n    readPackedSFixed32: function(arr) {\n        if (this.type !== Pbf.Bytes) return arr.push(this.readSFixed32());\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readSFixed32());\n        return arr;\n    },\n    readPackedFixed64: function(arr) {\n        if (this.type !== Pbf.Bytes) return arr.push(this.readFixed64());\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readFixed64());\n        return arr;\n    },\n    readPackedSFixed64: function(arr) {\n        if (this.type !== Pbf.Bytes) return arr.push(this.readSFixed64());\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readSFixed64());\n        return arr;\n    },\n\n    skip: function(val) {\n        var type = val & 0x7;\n        if (type === Pbf.Varint) while (this.buf[this.pos++] > 0x7f) {}\n        else if (type === Pbf.Bytes) this.pos = this.readVarint() + this.pos;\n        else if (type === Pbf.Fixed32) this.pos += 4;\n        else if (type === Pbf.Fixed64) this.pos += 8;\n        else throw new Error('Unimplemented type: ' + type);\n    },\n\n    // === WRITING =================================================================\n\n    writeTag: function(tag, type) {\n        this.writeVarint((tag << 3) | type);\n    },\n\n    realloc: function(min) {\n        var length = this.length || 16;\n\n        while (length < this.pos + min) length *= 2;\n\n        if (length !== this.length) {\n            var buf = new Uint8Array(length);\n            buf.set(this.buf);\n            this.buf = buf;\n            this.length = length;\n        }\n    },\n\n    finish: function() {\n        this.length = this.pos;\n        this.pos = 0;\n        return this.buf.subarray(0, this.length);\n    },\n\n    writeFixed32: function(val) {\n        this.realloc(4);\n        writeInt32(this.buf, val, this.pos);\n        this.pos += 4;\n    },\n\n    writeSFixed32: function(val) {\n        this.realloc(4);\n        writeInt32(this.buf, val, this.pos);\n        this.pos += 4;\n    },\n\n    writeFixed64: function(val) {\n        this.realloc(8);\n        writeInt32(this.buf, val & -1, this.pos);\n        writeInt32(this.buf, Math.floor(val * SHIFT_RIGHT_32), this.pos + 4);\n        this.pos += 8;\n    },\n\n    writeSFixed64: function(val) {\n        this.realloc(8);\n        writeInt32(this.buf, val & -1, this.pos);\n        writeInt32(this.buf, Math.floor(val * SHIFT_RIGHT_32), this.pos + 4);\n        this.pos += 8;\n    },\n\n    writeVarint: function(val) {\n        val = +val || 0;\n\n        if (val > 0xfffffff || val < 0) {\n            writeBigVarint(val, this);\n            return;\n        }\n\n        this.realloc(4);\n\n        this.buf[this.pos++] =           val & 0x7f  | (val > 0x7f ? 0x80 : 0); if (val <= 0x7f) return;\n        this.buf[this.pos++] = ((val >>>= 7) & 0x7f) | (val > 0x7f ? 0x80 : 0); if (val <= 0x7f) return;\n        this.buf[this.pos++] = ((val >>>= 7) & 0x7f) | (val > 0x7f ? 0x80 : 0); if (val <= 0x7f) return;\n        this.buf[this.pos++] =   (val >>> 7) & 0x7f;\n    },\n\n    writeSVarint: function(val) {\n        this.writeVarint(val < 0 ? -val * 2 - 1 : val * 2);\n    },\n\n    writeBoolean: function(val) {\n        this.writeVarint(Boolean(val));\n    },\n\n    writeString: function(str) {\n        str = String(str);\n        this.realloc(str.length * 4);\n\n        this.pos++; // reserve 1 byte for short string length\n\n        var startPos = this.pos;\n        // write the string directly to the buffer and see how much was written\n        this.pos = writeUtf8(this.buf, str, this.pos);\n        var len = this.pos - startPos;\n\n        if (len >= 0x80) makeRoomForExtraLength(startPos, len, this);\n\n        // finally, write the message length in the reserved place and restore the position\n        this.pos = startPos - 1;\n        this.writeVarint(len);\n        this.pos += len;\n    },\n\n    writeFloat: function(val) {\n        this.realloc(4);\n        ieee754.write(this.buf, val, this.pos, true, 23, 4);\n        this.pos += 4;\n    },\n\n    writeDouble: function(val) {\n        this.realloc(8);\n        ieee754.write(this.buf, val, this.pos, true, 52, 8);\n        this.pos += 8;\n    },\n\n    writeBytes: function(buffer) {\n        var len = buffer.length;\n        this.writeVarint(len);\n        this.realloc(len);\n        for (var i = 0; i < len; i++) this.buf[this.pos++] = buffer[i];\n    },\n\n    writeRawMessage: function(fn, obj) {\n        this.pos++; // reserve 1 byte for short message length\n\n        // write the message directly to the buffer and see how much was written\n        var startPos = this.pos;\n        fn(obj, this);\n        var len = this.pos - startPos;\n\n        if (len >= 0x80) makeRoomForExtraLength(startPos, len, this);\n\n        // finally, write the message length in the reserved place and restore the position\n        this.pos = startPos - 1;\n        this.writeVarint(len);\n        this.pos += len;\n    },\n\n    writeMessage: function(tag, fn, obj) {\n        this.writeTag(tag, Pbf.Bytes);\n        this.writeRawMessage(fn, obj);\n    },\n\n    writePackedVarint:   function(tag, arr) { if (arr.length) this.writeMessage(tag, writePackedVarint, arr);   },\n    writePackedSVarint:  function(tag, arr) { if (arr.length) this.writeMessage(tag, writePackedSVarint, arr);  },\n    writePackedBoolean:  function(tag, arr) { if (arr.length) this.writeMessage(tag, writePackedBoolean, arr);  },\n    writePackedFloat:    function(tag, arr) { if (arr.length) this.writeMessage(tag, writePackedFloat, arr);    },\n    writePackedDouble:   function(tag, arr) { if (arr.length) this.writeMessage(tag, writePackedDouble, arr);   },\n    writePackedFixed32:  function(tag, arr) { if (arr.length) this.writeMessage(tag, writePackedFixed32, arr);  },\n    writePackedSFixed32: function(tag, arr) { if (arr.length) this.writeMessage(tag, writePackedSFixed32, arr); },\n    writePackedFixed64:  function(tag, arr) { if (arr.length) this.writeMessage(tag, writePackedFixed64, arr);  },\n    writePackedSFixed64: function(tag, arr) { if (arr.length) this.writeMessage(tag, writePackedSFixed64, arr); },\n\n    writeBytesField: function(tag, buffer) {\n        this.writeTag(tag, Pbf.Bytes);\n        this.writeBytes(buffer);\n    },\n    writeFixed32Field: function(tag, val) {\n        this.writeTag(tag, Pbf.Fixed32);\n        this.writeFixed32(val);\n    },\n    writeSFixed32Field: function(tag, val) {\n        this.writeTag(tag, Pbf.Fixed32);\n        this.writeSFixed32(val);\n    },\n    writeFixed64Field: function(tag, val) {\n        this.writeTag(tag, Pbf.Fixed64);\n        this.writeFixed64(val);\n    },\n    writeSFixed64Field: function(tag, val) {\n        this.writeTag(tag, Pbf.Fixed64);\n        this.writeSFixed64(val);\n    },\n    writeVarintField: function(tag, val) {\n        this.writeTag(tag, Pbf.Varint);\n        this.writeVarint(val);\n    },\n    writeSVarintField: function(tag, val) {\n        this.writeTag(tag, Pbf.Varint);\n        this.writeSVarint(val);\n    },\n    writeStringField: function(tag, str) {\n        this.writeTag(tag, Pbf.Bytes);\n        this.writeString(str);\n    },\n    writeFloatField: function(tag, val) {\n        this.writeTag(tag, Pbf.Fixed32);\n        this.writeFloat(val);\n    },\n    writeDoubleField: function(tag, val) {\n        this.writeTag(tag, Pbf.Fixed64);\n        this.writeDouble(val);\n    },\n    writeBooleanField: function(tag, val) {\n        this.writeVarintField(tag, Boolean(val));\n    }\n};\n\nfunction readVarintRemainder(l, s, p) {\n    var buf = p.buf,\n        h, b;\n\n    b = buf[p.pos++]; h  = (b & 0x70) >> 4;  if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x7f) << 3;  if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x7f) << 10; if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x7f) << 17; if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x7f) << 24; if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x01) << 31; if (b < 0x80) return toNum(l, h, s);\n\n    throw new Error('Expected varint not more than 10 bytes');\n}\n\nfunction readPackedEnd(pbf) {\n    return pbf.type === Pbf.Bytes ?\n        pbf.readVarint() + pbf.pos : pbf.pos + 1;\n}\n\nfunction toNum(low, high, isSigned) {\n    if (isSigned) {\n        return high * 0x100000000 + (low >>> 0);\n    }\n\n    return ((high >>> 0) * 0x100000000) + (low >>> 0);\n}\n\nfunction writeBigVarint(val, pbf) {\n    var low, high;\n\n    if (val >= 0) {\n        low  = (val % 0x100000000) | 0;\n        high = (val / 0x100000000) | 0;\n    } else {\n        low  = ~(-val % 0x100000000);\n        high = ~(-val / 0x100000000);\n\n        if (low ^ 0xffffffff) {\n            low = (low + 1) | 0;\n        } else {\n            low = 0;\n            high = (high + 1) | 0;\n        }\n    }\n\n    if (val >= 0x10000000000000000 || val < -0x10000000000000000) {\n        throw new Error('Given varint doesn\\'t fit into 10 bytes');\n    }\n\n    pbf.realloc(10);\n\n    writeBigVarintLow(low, high, pbf);\n    writeBigVarintHigh(high, pbf);\n}\n\nfunction writeBigVarintLow(low, high, pbf) {\n    pbf.buf[pbf.pos++] = low & 0x7f | 0x80; low >>>= 7;\n    pbf.buf[pbf.pos++] = low & 0x7f | 0x80; low >>>= 7;\n    pbf.buf[pbf.pos++] = low & 0x7f | 0x80; low >>>= 7;\n    pbf.buf[pbf.pos++] = low & 0x7f | 0x80; low >>>= 7;\n    pbf.buf[pbf.pos]   = low & 0x7f;\n}\n\nfunction writeBigVarintHigh(high, pbf) {\n    var lsb = (high & 0x07) << 4;\n\n    pbf.buf[pbf.pos++] |= lsb         | ((high >>>= 3) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f | ((high >>>= 7) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f | ((high >>>= 7) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f | ((high >>>= 7) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f | ((high >>>= 7) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f;\n}\n\nfunction makeRoomForExtraLength(startPos, len, pbf) {\n    var extraLen =\n        len <= 0x3fff ? 1 :\n        len <= 0x1fffff ? 2 :\n        len <= 0xfffffff ? 3 : Math.floor(Math.log(len) / (Math.LN2 * 7));\n\n    // if 1 byte isn't enough for encoding message length, shift the data to the right\n    pbf.realloc(extraLen);\n    for (var i = pbf.pos - 1; i >= startPos; i--) pbf.buf[i + extraLen] = pbf.buf[i];\n}\n\nfunction writePackedVarint(arr, pbf)   { for (var i = 0; i < arr.length; i++) pbf.writeVarint(arr[i]);   }\nfunction writePackedSVarint(arr, pbf)  { for (var i = 0; i < arr.length; i++) pbf.writeSVarint(arr[i]);  }\nfunction writePackedFloat(arr, pbf)    { for (var i = 0; i < arr.length; i++) pbf.writeFloat(arr[i]);    }\nfunction writePackedDouble(arr, pbf)   { for (var i = 0; i < arr.length; i++) pbf.writeDouble(arr[i]);   }\nfunction writePackedBoolean(arr, pbf)  { for (var i = 0; i < arr.length; i++) pbf.writeBoolean(arr[i]);  }\nfunction writePackedFixed32(arr, pbf)  { for (var i = 0; i < arr.length; i++) pbf.writeFixed32(arr[i]);  }\nfunction writePackedSFixed32(arr, pbf) { for (var i = 0; i < arr.length; i++) pbf.writeSFixed32(arr[i]); }\nfunction writePackedFixed64(arr, pbf)  { for (var i = 0; i < arr.length; i++) pbf.writeFixed64(arr[i]);  }\nfunction writePackedSFixed64(arr, pbf) { for (var i = 0; i < arr.length; i++) pbf.writeSFixed64(arr[i]); }\n\n// Buffer code below from https://github.com/feross/buffer, MIT-licensed\n\nfunction readUInt32(buf, pos) {\n    return ((buf[pos]) |\n        (buf[pos + 1] << 8) |\n        (buf[pos + 2] << 16)) +\n        (buf[pos + 3] * 0x1000000);\n}\n\nfunction writeInt32(buf, val, pos) {\n    buf[pos] = val;\n    buf[pos + 1] = (val >>> 8);\n    buf[pos + 2] = (val >>> 16);\n    buf[pos + 3] = (val >>> 24);\n}\n\nfunction readInt32(buf, pos) {\n    return ((buf[pos]) |\n        (buf[pos + 1] << 8) |\n        (buf[pos + 2] << 16)) +\n        (buf[pos + 3] << 24);\n}\n\nfunction readUtf8(buf, pos, end) {\n    var str = '';\n    var i = pos;\n\n    while (i < end) {\n        var b0 = buf[i];\n        var c = null; // codepoint\n        var bytesPerSequence =\n            b0 > 0xEF ? 4 :\n            b0 > 0xDF ? 3 :\n            b0 > 0xBF ? 2 : 1;\n\n        if (i + bytesPerSequence > end) break;\n\n        var b1, b2, b3;\n\n        if (bytesPerSequence === 1) {\n            if (b0 < 0x80) {\n                c = b0;\n            }\n        } else if (bytesPerSequence === 2) {\n            b1 = buf[i + 1];\n            if ((b1 & 0xC0) === 0x80) {\n                c = (b0 & 0x1F) << 0x6 | (b1 & 0x3F);\n                if (c <= 0x7F) {\n                    c = null;\n                }\n            }\n        } else if (bytesPerSequence === 3) {\n            b1 = buf[i + 1];\n            b2 = buf[i + 2];\n            if ((b1 & 0xC0) === 0x80 && (b2 & 0xC0) === 0x80) {\n                c = (b0 & 0xF) << 0xC | (b1 & 0x3F) << 0x6 | (b2 & 0x3F);\n                if (c <= 0x7FF || (c >= 0xD800 && c <= 0xDFFF)) {\n                    c = null;\n                }\n            }\n        } else if (bytesPerSequence === 4) {\n            b1 = buf[i + 1];\n            b2 = buf[i + 2];\n            b3 = buf[i + 3];\n            if ((b1 & 0xC0) === 0x80 && (b2 & 0xC0) === 0x80 && (b3 & 0xC0) === 0x80) {\n                c = (b0 & 0xF) << 0x12 | (b1 & 0x3F) << 0xC | (b2 & 0x3F) << 0x6 | (b3 & 0x3F);\n                if (c <= 0xFFFF || c >= 0x110000) {\n                    c = null;\n                }\n            }\n        }\n\n        if (c === null) {\n            c = 0xFFFD;\n            bytesPerSequence = 1;\n\n        } else if (c > 0xFFFF) {\n            c -= 0x10000;\n            str += String.fromCharCode(c >>> 10 & 0x3FF | 0xD800);\n            c = 0xDC00 | c & 0x3FF;\n        }\n\n        str += String.fromCharCode(c);\n        i += bytesPerSequence;\n    }\n\n    return str;\n}\n\nfunction readUtf8TextDecoder(buf, pos, end) {\n    return utf8TextDecoder.decode(buf.subarray(pos, end));\n}\n\nfunction writeUtf8(buf, str, pos) {\n    for (var i = 0, c, lead; i < str.length; i++) {\n        c = str.charCodeAt(i); // code point\n\n        if (c > 0xD7FF && c < 0xE000) {\n            if (lead) {\n                if (c < 0xDC00) {\n                    buf[pos++] = 0xEF;\n                    buf[pos++] = 0xBF;\n                    buf[pos++] = 0xBD;\n                    lead = c;\n                    continue;\n                } else {\n                    c = lead - 0xD800 << 10 | c - 0xDC00 | 0x10000;\n                    lead = null;\n                }\n            } else {\n                if (c > 0xDBFF || (i + 1 === str.length)) {\n                    buf[pos++] = 0xEF;\n                    buf[pos++] = 0xBF;\n                    buf[pos++] = 0xBD;\n                } else {\n                    lead = c;\n                }\n                continue;\n            }\n        } else if (lead) {\n            buf[pos++] = 0xEF;\n            buf[pos++] = 0xBF;\n            buf[pos++] = 0xBD;\n            lead = null;\n        }\n\n        if (c < 0x80) {\n            buf[pos++] = c;\n        } else {\n            if (c < 0x800) {\n                buf[pos++] = c >> 0x6 | 0xC0;\n            } else {\n                if (c < 0x10000) {\n                    buf[pos++] = c >> 0xC | 0xE0;\n                } else {\n                    buf[pos++] = c >> 0x12 | 0xF0;\n                    buf[pos++] = c >> 0xC & 0x3F | 0x80;\n                }\n                buf[pos++] = c >> 0x6 & 0x3F | 0x80;\n            }\n            buf[pos++] = c & 0x3F | 0x80;\n        }\n    }\n    return pos;\n}\n","/**\n * @module ol/geom/GeometryCollection\n */\nimport EventType from '../events/EventType.js';\nimport Geometry from './Geometry.js';\nimport {\n  closestSquaredDistanceXY,\n  createOrUpdateEmpty,\n  extend,\n  getCenter,\n} from '../extent.js';\nimport {listen, unlistenByKey} from '../events.js';\n\n/**\n * @classdesc\n * An array of {@link module:ol/geom/Geometry~Geometry} objects.\n *\n * @api\n */\nclass GeometryCollection extends Geometry {\n  /**\n   * @param {Array<Geometry>} [geometries] Geometries.\n   */\n  constructor(geometries) {\n    super();\n\n    /**\n     * @private\n     * @type {Array<Geometry>}\n     */\n    this.geometries_ = geometries ? geometries : null;\n\n    /**\n     * @type {Array<import(\"../events.js\").EventsKey>}\n     */\n    this.changeEventsKeys_ = [];\n\n    this.listenGeometriesChange_();\n  }\n\n  /**\n   * @private\n   */\n  unlistenGeometriesChange_() {\n    this.changeEventsKeys_.forEach(unlistenByKey);\n    this.changeEventsKeys_.length = 0;\n  }\n\n  /**\n   * @private\n   */\n  listenGeometriesChange_() {\n    if (!this.geometries_) {\n      return;\n    }\n    for (let i = 0, ii = this.geometries_.length; i < ii; ++i) {\n      this.changeEventsKeys_.push(\n        listen(this.geometries_[i], EventType.CHANGE, this.changed, this)\n      );\n    }\n  }\n\n  /**\n   * Make a complete copy of the geometry.\n   * @return {!GeometryCollection} Clone.\n   * @api\n   */\n  clone() {\n    const geometryCollection = new GeometryCollection(null);\n    geometryCollection.setGeometries(this.geometries_);\n    geometryCollection.applyProperties(this);\n    return geometryCollection;\n  }\n\n  /**\n   * @param {number} x X.\n   * @param {number} y Y.\n   * @param {import(\"../coordinate.js\").Coordinate} closestPoint Closest point.\n   * @param {number} minSquaredDistance Minimum squared distance.\n   * @return {number} Minimum squared distance.\n   */\n  closestPointXY(x, y, closestPoint, minSquaredDistance) {\n    if (minSquaredDistance < closestSquaredDistanceXY(this.getExtent(), x, y)) {\n      return minSquaredDistance;\n    }\n    const geometries = this.geometries_;\n    for (let i = 0, ii = geometries.length; i < ii; ++i) {\n      minSquaredDistance = geometries[i].closestPointXY(\n        x,\n        y,\n        closestPoint,\n        minSquaredDistance\n      );\n    }\n    return minSquaredDistance;\n  }\n\n  /**\n   * @param {number} x X.\n   * @param {number} y Y.\n   * @return {boolean} Contains (x, y).\n   */\n  containsXY(x, y) {\n    const geometries = this.geometries_;\n    for (let i = 0, ii = geometries.length; i < ii; ++i) {\n      if (geometries[i].containsXY(x, y)) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @protected\n   * @return {import(\"../extent.js\").Extent} extent Extent.\n   */\n  computeExtent(extent) {\n    createOrUpdateEmpty(extent);\n    const geometries = this.geometries_;\n    for (let i = 0, ii = geometries.length; i < ii; ++i) {\n      extend(extent, geometries[i].getExtent());\n    }\n    return extent;\n  }\n\n  /**\n   * Return the geometries that make up this geometry collection.\n   * @return {Array<Geometry>} Geometries.\n   * @api\n   */\n  getGeometries() {\n    return cloneGeometries(this.geometries_);\n  }\n\n  /**\n   * @return {Array<Geometry>} Geometries.\n   */\n  getGeometriesArray() {\n    return this.geometries_;\n  }\n\n  /**\n   * @return {Array<Geometry>} Geometries.\n   */\n  getGeometriesArrayRecursive() {\n    /** @type {Array<Geometry>} */\n    let geometriesArray = [];\n    const geometries = this.geometries_;\n    for (let i = 0, ii = geometries.length; i < ii; ++i) {\n      if (geometries[i].getType() === this.getType()) {\n        geometriesArray = geometriesArray.concat(\n          /** @type {GeometryCollection} */ (\n            geometries[i]\n          ).getGeometriesArrayRecursive()\n        );\n      } else {\n        geometriesArray.push(geometries[i]);\n      }\n    }\n    return geometriesArray;\n  }\n\n  /**\n   * Create a simplified version of this geometry using the Douglas Peucker algorithm.\n   * @param {number} squaredTolerance Squared tolerance.\n   * @return {GeometryCollection} Simplified GeometryCollection.\n   */\n  getSimplifiedGeometry(squaredTolerance) {\n    if (this.simplifiedGeometryRevision !== this.getRevision()) {\n      this.simplifiedGeometryMaxMinSquaredTolerance = 0;\n      this.simplifiedGeometryRevision = this.getRevision();\n    }\n    if (\n      squaredTolerance < 0 ||\n      (this.simplifiedGeometryMaxMinSquaredTolerance !== 0 &&\n        squaredTolerance < this.simplifiedGeometryMaxMinSquaredTolerance)\n    ) {\n      return this;\n    }\n\n    const simplifiedGeometries = [];\n    const geometries = this.geometries_;\n    let simplified = false;\n    for (let i = 0, ii = geometries.length; i < ii; ++i) {\n      const geometry = geometries[i];\n      const simplifiedGeometry =\n        geometry.getSimplifiedGeometry(squaredTolerance);\n      simplifiedGeometries.push(simplifiedGeometry);\n      if (simplifiedGeometry !== geometry) {\n        simplified = true;\n      }\n    }\n    if (simplified) {\n      const simplifiedGeometryCollection = new GeometryCollection(null);\n      simplifiedGeometryCollection.setGeometriesArray(simplifiedGeometries);\n      return simplifiedGeometryCollection;\n    }\n    this.simplifiedGeometryMaxMinSquaredTolerance = squaredTolerance;\n    return this;\n  }\n\n  /**\n   * Get the type of this geometry.\n   * @return {import(\"./Geometry.js\").Type} Geometry type.\n   * @api\n   */\n  getType() {\n    return 'GeometryCollection';\n  }\n\n  /**\n   * Test if the geometry and the passed extent intersect.\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @return {boolean} `true` if the geometry and the extent intersect.\n   * @api\n   */\n  intersectsExtent(extent) {\n    const geometries = this.geometries_;\n    for (let i = 0, ii = geometries.length; i < ii; ++i) {\n      if (geometries[i].intersectsExtent(extent)) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * @return {boolean} Is empty.\n   */\n  isEmpty() {\n    return this.geometries_.length === 0;\n  }\n\n  /**\n   * Rotate the geometry around a given coordinate. This modifies the geometry\n   * coordinates in place.\n   * @param {number} angle Rotation angle in radians.\n   * @param {import(\"../coordinate.js\").Coordinate} anchor The rotation center.\n   * @api\n   */\n  rotate(angle, anchor) {\n    const geometries = this.geometries_;\n    for (let i = 0, ii = geometries.length; i < ii; ++i) {\n      geometries[i].rotate(angle, anchor);\n    }\n    this.changed();\n  }\n\n  /**\n   * Scale the geometry (with an optional origin).  This modifies the geometry\n   * coordinates in place.\n   * @abstract\n   * @param {number} sx The scaling factor in the x-direction.\n   * @param {number} [sy] The scaling factor in the y-direction (defaults to sx).\n   * @param {import(\"../coordinate.js\").Coordinate} [anchor] The scale origin (defaults to the center\n   *     of the geometry extent).\n   * @api\n   */\n  scale(sx, sy, anchor) {\n    if (!anchor) {\n      anchor = getCenter(this.getExtent());\n    }\n    const geometries = this.geometries_;\n    for (let i = 0, ii = geometries.length; i < ii; ++i) {\n      geometries[i].scale(sx, sy, anchor);\n    }\n    this.changed();\n  }\n\n  /**\n   * Set the geometries that make up this geometry collection.\n   * @param {Array<Geometry>} geometries Geometries.\n   * @api\n   */\n  setGeometries(geometries) {\n    this.setGeometriesArray(cloneGeometries(geometries));\n  }\n\n  /**\n   * @param {Array<Geometry>} geometries Geometries.\n   */\n  setGeometriesArray(geometries) {\n    this.unlistenGeometriesChange_();\n    this.geometries_ = geometries;\n    this.listenGeometriesChange_();\n    this.changed();\n  }\n\n  /**\n   * Apply a transform function to the coordinates of the geometry.\n   * The geometry is modified in place.\n   * If you do not want the geometry modified in place, first `clone()` it and\n   * then use this function on the clone.\n   * @param {import(\"../proj.js\").TransformFunction} transformFn Transform function.\n   * Called with a flat array of geometry coordinates.\n   * @api\n   */\n  applyTransform(transformFn) {\n    const geometries = this.geometries_;\n    for (let i = 0, ii = geometries.length; i < ii; ++i) {\n      geometries[i].applyTransform(transformFn);\n    }\n    this.changed();\n  }\n\n  /**\n   * Translate the geometry.  This modifies the geometry coordinates in place.  If\n   * instead you want a new geometry, first `clone()` this geometry.\n   * @param {number} deltaX Delta X.\n   * @param {number} deltaY Delta Y.\n   * @api\n   */\n  translate(deltaX, deltaY) {\n    const geometries = this.geometries_;\n    for (let i = 0, ii = geometries.length; i < ii; ++i) {\n      geometries[i].translate(deltaX, deltaY);\n    }\n    this.changed();\n  }\n\n  /**\n   * Clean up.\n   */\n  disposeInternal() {\n    this.unlistenGeometriesChange_();\n    super.disposeInternal();\n  }\n}\n\n/**\n * @param {Array<Geometry>} geometries Geometries.\n * @return {Array<Geometry>} Cloned geometries.\n */\nfunction cloneGeometries(geometries) {\n  const clonedGeometries = [];\n  for (let i = 0, ii = geometries.length; i < ii; ++i) {\n    clonedGeometries.push(geometries[i].clone());\n  }\n  return clonedGeometries;\n}\n\nexport default GeometryCollection;\n","/**\n * @module ol/render/Feature\n */\nimport Feature from '../Feature.js';\nimport {\n  LineString,\n  MultiLineString,\n  MultiPoint,\n  MultiPolygon,\n  Point,\n  Polygon,\n} from '../geom.js';\nimport {\n  compose as composeTransform,\n  create as createTransform,\n} from '../transform.js';\nimport {\n  createOrUpdateFromCoordinate,\n  createOrUpdateFromFlatCoordinates,\n  getCenter,\n  getHeight,\n} from '../extent.js';\nimport {extend} from '../array.js';\nimport {\n  getInteriorPointOfArray,\n  getInteriorPointsOfMultiArray,\n} from '../geom/flat/interiorpoint.js';\nimport {get as getProjection} from '../proj.js';\nimport {inflateEnds} from '../geom/flat/orient.js';\nimport {interpolatePoint} from '../geom/flat/interpolate.js';\nimport {linearRingss as linearRingssCenter} from '../geom/flat/center.js';\nimport {transform2D} from '../geom/flat/transform.js';\n\n/**\n * @type {import(\"../transform.js\").Transform}\n */\nconst tmpTransform = createTransform();\n\n/**\n * Lightweight, read-only, {@link module:ol/Feature~Feature} and {@link module:ol/geom/Geometry~Geometry} like\n * structure, optimized for vector tile rendering and styling. Geometry access\n * through the API is limited to getting the type and extent of the geometry.\n */\nclass RenderFeature {\n  /**\n   * @param {import(\"../geom/Geometry.js\").Type} type Geometry type.\n   * @param {Array<number>} flatCoordinates Flat coordinates. These always need\n   *     to be right-handed for polygons.\n   * @param {Array<number>|Array<Array<number>>} ends Ends or Endss.\n   * @param {Object<string, *>} properties Properties.\n   * @param {number|string|undefined} id Feature id.\n   */\n  constructor(type, flatCoordinates, ends, properties, id) {\n    /**\n     * @type {import(\"../style/Style.js\").StyleFunction|undefined}\n     */\n    this.styleFunction;\n\n    /**\n     * @private\n     * @type {import(\"../extent.js\").Extent|undefined}\n     */\n    this.extent_;\n\n    /**\n     * @private\n     * @type {number|string|undefined}\n     */\n    this.id_ = id;\n\n    /**\n     * @private\n     * @type {import(\"../geom/Geometry.js\").Type}\n     */\n    this.type_ = type;\n\n    /**\n     * @private\n     * @type {Array<number>}\n     */\n    this.flatCoordinates_ = flatCoordinates;\n\n    /**\n     * @private\n     * @type {Array<number>}\n     */\n    this.flatInteriorPoints_ = null;\n\n    /**\n     * @private\n     * @type {Array<number>}\n     */\n    this.flatMidpoints_ = null;\n\n    /**\n     * @private\n     * @type {Array<number>|Array<Array<number>>}\n     */\n    this.ends_ = ends;\n\n    /**\n     * @private\n     * @type {Object<string, *>}\n     */\n    this.properties_ = properties;\n  }\n\n  /**\n   * Get a feature property by its key.\n   * @param {string} key Key\n   * @return {*} Value for the requested key.\n   * @api\n   */\n  get(key) {\n    return this.properties_[key];\n  }\n\n  /**\n   * Get the extent of this feature's geometry.\n   * @return {import(\"../extent.js\").Extent} Extent.\n   * @api\n   */\n  getExtent() {\n    if (!this.extent_) {\n      this.extent_ =\n        this.type_ === 'Point'\n          ? createOrUpdateFromCoordinate(this.flatCoordinates_)\n          : createOrUpdateFromFlatCoordinates(\n              this.flatCoordinates_,\n              0,\n              this.flatCoordinates_.length,\n              2\n            );\n    }\n    return this.extent_;\n  }\n\n  /**\n   * @return {Array<number>} Flat interior points.\n   */\n  getFlatInteriorPoint() {\n    if (!this.flatInteriorPoints_) {\n      const flatCenter = getCenter(this.getExtent());\n      this.flatInteriorPoints_ = getInteriorPointOfArray(\n        this.flatCoordinates_,\n        0,\n        /** @type {Array<number>} */ (this.ends_),\n        2,\n        flatCenter,\n        0\n      );\n    }\n    return this.flatInteriorPoints_;\n  }\n\n  /**\n   * @return {Array<number>} Flat interior points.\n   */\n  getFlatInteriorPoints() {\n    if (!this.flatInteriorPoints_) {\n      const flatCenters = linearRingssCenter(\n        this.flatCoordinates_,\n        0,\n        /** @type {Array<Array<number>>} */ (this.ends_),\n        2\n      );\n      this.flatInteriorPoints_ = getInteriorPointsOfMultiArray(\n        this.flatCoordinates_,\n        0,\n        /** @type {Array<Array<number>>} */ (this.ends_),\n        2,\n        flatCenters\n      );\n    }\n    return this.flatInteriorPoints_;\n  }\n\n  /**\n   * @return {Array<number>} Flat midpoint.\n   */\n  getFlatMidpoint() {\n    if (!this.flatMidpoints_) {\n      this.flatMidpoints_ = interpolatePoint(\n        this.flatCoordinates_,\n        0,\n        this.flatCoordinates_.length,\n        2,\n        0.5\n      );\n    }\n    return this.flatMidpoints_;\n  }\n\n  /**\n   * @return {Array<number>} Flat midpoints.\n   */\n  getFlatMidpoints() {\n    if (!this.flatMidpoints_) {\n      this.flatMidpoints_ = [];\n      const flatCoordinates = this.flatCoordinates_;\n      let offset = 0;\n      const ends = /** @type {Array<number>} */ (this.ends_);\n      for (let i = 0, ii = ends.length; i < ii; ++i) {\n        const end = ends[i];\n        const midpoint = interpolatePoint(flatCoordinates, offset, end, 2, 0.5);\n        extend(this.flatMidpoints_, midpoint);\n        offset = end;\n      }\n    }\n    return this.flatMidpoints_;\n  }\n\n  /**\n   * Get the feature identifier.  This is a stable identifier for the feature and\n   * is set when reading data from a remote source.\n   * @return {number|string|undefined} Id.\n   * @api\n   */\n  getId() {\n    return this.id_;\n  }\n\n  /**\n   * @return {Array<number>} Flat coordinates.\n   */\n  getOrientedFlatCoordinates() {\n    return this.flatCoordinates_;\n  }\n\n  /**\n   * For API compatibility with {@link module:ol/Feature~Feature}, this method is useful when\n   * determining the geometry type in style function (see {@link #getType}).\n   * @return {RenderFeature} Feature.\n   * @api\n   */\n  getGeometry() {\n    return this;\n  }\n\n  /**\n   * @param {number} squaredTolerance Squared tolerance.\n   * @return {RenderFeature} Simplified geometry.\n   */\n  getSimplifiedGeometry(squaredTolerance) {\n    return this;\n  }\n\n  /**\n   * Get a transformed and simplified version of the geometry.\n   * @abstract\n   * @param {number} squaredTolerance Squared tolerance.\n   * @param {import(\"../proj.js\").TransformFunction} [transform] Optional transform function.\n   * @return {RenderFeature} Simplified geometry.\n   */\n  simplifyTransformed(squaredTolerance, transform) {\n    return this;\n  }\n\n  /**\n   * Get the feature properties.\n   * @return {Object<string, *>} Feature properties.\n   * @api\n   */\n  getProperties() {\n    return this.properties_;\n  }\n\n  /**\n   * @return {number} Stride.\n   */\n  getStride() {\n    return 2;\n  }\n\n  /**\n   * @return {import('../style/Style.js').StyleFunction|undefined} Style\n   */\n  getStyleFunction() {\n    return this.styleFunction;\n  }\n\n  /**\n   * Get the type of this feature's geometry.\n   * @return {import(\"../geom/Geometry.js\").Type} Geometry type.\n   * @api\n   */\n  getType() {\n    return this.type_;\n  }\n\n  /**\n   * Transform geometry coordinates from tile pixel space to projected.\n   *\n   * @param {import(\"../proj.js\").ProjectionLike} projection The data projection\n   */\n  transform(projection) {\n    projection = getProjection(projection);\n    const pixelExtent = projection.getExtent();\n    const projectedExtent = projection.getWorldExtent();\n    if (pixelExtent && projectedExtent) {\n      const scale = getHeight(projectedExtent) / getHeight(pixelExtent);\n      composeTransform(\n        tmpTransform,\n        projectedExtent[0],\n        projectedExtent[3],\n        scale,\n        -scale,\n        0,\n        0,\n        0\n      );\n      transform2D(\n        this.flatCoordinates_,\n        0,\n        this.flatCoordinates_.length,\n        2,\n        tmpTransform,\n        this.flatCoordinates_\n      );\n    }\n  }\n  /**\n   * @return {Array<number>|Array<Array<number>>} Ends or endss.\n   */\n  getEnds() {\n    return this.ends_;\n  }\n}\n\nRenderFeature.prototype.getEndss = RenderFeature.prototype.getEnds;\n\n/**\n * @return {Array<number>} Flat coordinates.\n */\nRenderFeature.prototype.getFlatCoordinates =\n  RenderFeature.prototype.getOrientedFlatCoordinates;\n\n/**\n * Create a geometry from an `ol/render/Feature`\n * @param {RenderFeature} renderFeature\n * Render Feature\n * @return {Point|MultiPoint|LineString|MultiLineString|Polygon|MultiPolygon}\n * New geometry instance.\n * @api\n */\nexport function toGeometry(renderFeature) {\n  const geometryType = renderFeature.getType();\n  switch (geometryType) {\n    case 'Point':\n      return new Point(renderFeature.getFlatCoordinates());\n    case 'MultiPoint':\n      return new MultiPoint(renderFeature.getFlatCoordinates(), 'XY');\n    case 'LineString':\n      return new LineString(renderFeature.getFlatCoordinates(), 'XY');\n    case 'MultiLineString':\n      return new MultiLineString(\n        renderFeature.getFlatCoordinates(),\n        'XY',\n        /** @type {Array<number>} */ (renderFeature.getEnds())\n      );\n    case 'Polygon':\n      const flatCoordinates = renderFeature.getFlatCoordinates();\n      const ends = /** @type {Array<number>} */ (renderFeature.getEnds());\n      const endss = inflateEnds(flatCoordinates, ends);\n      return endss.length > 1\n        ? new MultiPolygon(flatCoordinates, 'XY', endss)\n        : new Polygon(flatCoordinates, 'XY', ends);\n    default:\n      throw new Error('Invalid geometry type:' + geometryType);\n  }\n}\n\n/**\n * Create an `ol/Feature` from an `ol/render/Feature`\n * @param {RenderFeature} renderFeature RenderFeature\n * @param {string} [geometryName='geometry'] Geometry name to use\n * when creating the Feature.\n * @return {Feature} Newly constructed `ol/Feature` with properties,\n * geometry, and id copied over.\n * @api\n */\nexport function toFeature(renderFeature, geometryName) {\n  const id = renderFeature.getId();\n  const geometry = toGeometry(renderFeature);\n  const properties = renderFeature.getProperties();\n  const feature = new Feature();\n  if (geometryName !== undefined) {\n    feature.setGeometryName(geometryName);\n  }\n  feature.setGeometry(geometry);\n  if (id !== undefined) {\n    feature.setId(id);\n  }\n  feature.setProperties(properties, true);\n  return feature;\n}\n\nexport default RenderFeature;\n","/**\n * @module ol/format/MVT\n */\n//FIXME Implement projection handling\n\nimport FeatureFormat, {transformGeometryWithOptions} from './Feature.js';\nimport LineString from '../geom/LineString.js';\nimport MultiLineString from '../geom/MultiLineString.js';\nimport MultiPoint from '../geom/MultiPoint.js';\nimport MultiPolygon from '../geom/MultiPolygon.js';\nimport PBF from 'pbf';\nimport Point from '../geom/Point.js';\nimport Polygon from '../geom/Polygon.js';\nimport Projection from '../proj/Projection.js';\nimport RenderFeature from '../render/Feature.js';\nimport {assert} from '../asserts.js';\nimport {get} from '../proj.js';\nimport {inflateEnds} from '../geom/flat/orient.js';\n\n/**\n * @typedef {Object} Options\n * @property {import(\"../Feature.js\").FeatureClass} [featureClass] Class for features returned by\n * {@link module:ol/format/MVT~MVT#readFeatures}. Set to {@link module:ol/Feature~Feature} to get full editing and geometry\n * support at the cost of decreased rendering performance. The default is\n * {@link module:ol/render/Feature~RenderFeature}, which is optimized for rendering and hit detection.\n * @property {string} [geometryName='geometry'] Geometry name to use when creating features.\n * @property {string} [layerName='layer'] Name of the feature attribute that holds the layer name.\n * @property {Array<string>} [layers] Layers to read features from. If not provided, features will be read from all\n * @property {string} [idProperty] Optional property that will be assigned as the feature id and removed from the properties.\n * layers.\n */\n\n/**\n * @classdesc\n * Feature format for reading data in the Mapbox MVT format.\n *\n * @param {Options} [options] Options.\n * @api\n */\nclass MVT extends FeatureFormat {\n  /**\n   * @param {Options} [options] Options.\n   */\n  constructor(options) {\n    super();\n\n    options = options ? options : {};\n\n    /**\n     * @type {Projection}\n     */\n    this.dataProjection = new Projection({\n      code: '',\n      units: 'tile-pixels',\n    });\n\n    /**\n     * @private\n     * @type {import(\"../Feature.js\").FeatureClass}\n     */\n    this.featureClass_ = options.featureClass\n      ? options.featureClass\n      : RenderFeature;\n\n    /**\n     * @private\n     * @type {string|undefined}\n     */\n    this.geometryName_ = options.geometryName;\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.layerName_ = options.layerName ? options.layerName : 'layer';\n\n    /**\n     * @private\n     * @type {Array<string>|null}\n     */\n    this.layers_ = options.layers ? options.layers : null;\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.idProperty_ = options.idProperty;\n\n    this.supportedMediaTypes = [\n      'application/vnd.mapbox-vector-tile',\n      'application/x-protobuf',\n    ];\n  }\n\n  /**\n   * Read the raw geometry from the pbf offset stored in a raw feature's geometry\n   * property.\n   * @param {PBF} pbf PBF.\n   * @param {Object} feature Raw feature.\n   * @param {Array<number>} flatCoordinates Array to store flat coordinates in.\n   * @param {Array<number>} ends Array to store ends in.\n   * @private\n   */\n  readRawGeometry_(pbf, feature, flatCoordinates, ends) {\n    pbf.pos = feature.geometry;\n\n    const end = pbf.readVarint() + pbf.pos;\n    let cmd = 1;\n    let length = 0;\n    let x = 0;\n    let y = 0;\n    let coordsLen = 0;\n    let currentEnd = 0;\n\n    while (pbf.pos < end) {\n      if (!length) {\n        const cmdLen = pbf.readVarint();\n        cmd = cmdLen & 0x7;\n        length = cmdLen >> 3;\n      }\n\n      length--;\n\n      if (cmd === 1 || cmd === 2) {\n        x += pbf.readSVarint();\n        y += pbf.readSVarint();\n\n        if (cmd === 1) {\n          // moveTo\n          if (coordsLen > currentEnd) {\n            ends.push(coordsLen);\n            currentEnd = coordsLen;\n          }\n        }\n\n        flatCoordinates.push(x, y);\n        coordsLen += 2;\n      } else if (cmd === 7) {\n        if (coordsLen > currentEnd) {\n          // close polygon\n          flatCoordinates.push(\n            flatCoordinates[currentEnd],\n            flatCoordinates[currentEnd + 1]\n          );\n          coordsLen += 2;\n        }\n      } else {\n        assert(false, 59); // Invalid command found in the PBF\n      }\n    }\n\n    if (coordsLen > currentEnd) {\n      ends.push(coordsLen);\n      currentEnd = coordsLen;\n    }\n  }\n\n  /**\n   * @private\n   * @param {PBF} pbf PBF\n   * @param {Object} rawFeature Raw Mapbox feature.\n   * @param {import(\"./Feature.js\").ReadOptions} options Read options.\n   * @return {import(\"../Feature.js\").FeatureLike|null} Feature.\n   */\n  createFeature_(pbf, rawFeature, options) {\n    const type = rawFeature.type;\n    if (type === 0) {\n      return null;\n    }\n\n    let feature;\n    const values = rawFeature.properties;\n\n    let id;\n    if (!this.idProperty_) {\n      id = rawFeature.id;\n    } else {\n      id = values[this.idProperty_];\n      delete values[this.idProperty_];\n    }\n\n    values[this.layerName_] = rawFeature.layer.name;\n\n    const flatCoordinates = /** @type {Array<number>} */ ([]);\n    const ends = /** @type {Array<number>} */ ([]);\n    this.readRawGeometry_(pbf, rawFeature, flatCoordinates, ends);\n\n    const geometryType = getGeometryType(type, ends.length);\n\n    if (this.featureClass_ === RenderFeature) {\n      feature = new this.featureClass_(\n        geometryType,\n        flatCoordinates,\n        ends,\n        values,\n        id\n      );\n      feature.transform(options.dataProjection);\n    } else {\n      let geom;\n      if (geometryType == 'Polygon') {\n        const endss = inflateEnds(flatCoordinates, ends);\n        geom =\n          endss.length > 1\n            ? new MultiPolygon(flatCoordinates, 'XY', endss)\n            : new Polygon(flatCoordinates, 'XY', ends);\n      } else {\n        geom =\n          geometryType === 'Point'\n            ? new Point(flatCoordinates, 'XY')\n            : geometryType === 'LineString'\n            ? new LineString(flatCoordinates, 'XY')\n            : geometryType === 'MultiPoint'\n            ? new MultiPoint(flatCoordinates, 'XY')\n            : geometryType === 'MultiLineString'\n            ? new MultiLineString(flatCoordinates, 'XY', ends)\n            : null;\n      }\n      const ctor = /** @type {typeof import(\"../Feature.js\").default} */ (\n        this.featureClass_\n      );\n      feature = new ctor();\n      if (this.geometryName_) {\n        feature.setGeometryName(this.geometryName_);\n      }\n      const geometry = transformGeometryWithOptions(geom, false, options);\n      feature.setGeometry(geometry);\n      if (id !== undefined) {\n        feature.setId(id);\n      }\n      feature.setProperties(values, true);\n    }\n\n    return feature;\n  }\n\n  /**\n   * @return {import(\"./Feature.js\").Type} Format.\n   */\n  getType() {\n    return 'arraybuffer';\n  }\n\n  /**\n   * Read all features.\n   *\n   * @param {ArrayBuffer} source Source.\n   * @param {import(\"./Feature.js\").ReadOptions} [options] Read options.\n   * @return {Array<import(\"../Feature.js\").FeatureLike>} Features.\n   * @api\n   */\n  readFeatures(source, options) {\n    const layers = this.layers_;\n    options = this.adaptOptions(options);\n    const dataProjection = get(options.dataProjection);\n    dataProjection.setWorldExtent(options.extent);\n    options.dataProjection = dataProjection;\n\n    const pbf = new PBF(/** @type {ArrayBuffer} */ (source));\n    const pbfLayers = pbf.readFields(layersPBFReader, {});\n    const features = [];\n    for (const name in pbfLayers) {\n      if (layers && !layers.includes(name)) {\n        continue;\n      }\n      const pbfLayer = pbfLayers[name];\n\n      const extent = pbfLayer ? [0, 0, pbfLayer.extent, pbfLayer.extent] : null;\n      dataProjection.setExtent(extent);\n\n      for (let i = 0, ii = pbfLayer.length; i < ii; ++i) {\n        const rawFeature = readRawFeature(pbf, pbfLayer, i);\n        const feature = this.createFeature_(pbf, rawFeature, options);\n        if (feature !== null) {\n          features.push(feature);\n        }\n      }\n    }\n\n    return features;\n  }\n\n  /**\n   * Read the projection from the source.\n   *\n   * @param {Document|Element|Object|string} source Source.\n   * @return {import(\"../proj/Projection.js\").default} Projection.\n   * @api\n   */\n  readProjection(source) {\n    return this.dataProjection;\n  }\n\n  /**\n   * Sets the layers that features will be read from.\n   * @param {Array<string>} layers Layers.\n   * @api\n   */\n  setLayers(layers) {\n    this.layers_ = layers;\n  }\n}\n\n/**\n * Reader callback for parsing layers.\n * @param {number} tag The tag.\n * @param {Object} layers The layers object.\n * @param {PBF} pbf The PBF.\n */\nfunction layersPBFReader(tag, layers, pbf) {\n  if (tag === 3) {\n    const layer = {\n      keys: [],\n      values: [],\n      features: [],\n    };\n    const end = pbf.readVarint() + pbf.pos;\n    pbf.readFields(layerPBFReader, layer, end);\n    layer.length = layer.features.length;\n    if (layer.length) {\n      layers[layer.name] = layer;\n    }\n  }\n}\n\n/**\n * Reader callback for parsing layer.\n * @param {number} tag The tag.\n * @param {Object} layer The layer object.\n * @param {PBF} pbf The PBF.\n */\nfunction layerPBFReader(tag, layer, pbf) {\n  if (tag === 15) {\n    layer.version = pbf.readVarint();\n  } else if (tag === 1) {\n    layer.name = pbf.readString();\n  } else if (tag === 5) {\n    layer.extent = pbf.readVarint();\n  } else if (tag === 2) {\n    layer.features.push(pbf.pos);\n  } else if (tag === 3) {\n    layer.keys.push(pbf.readString());\n  } else if (tag === 4) {\n    let value = null;\n    const end = pbf.readVarint() + pbf.pos;\n    while (pbf.pos < end) {\n      tag = pbf.readVarint() >> 3;\n      value =\n        tag === 1\n          ? pbf.readString()\n          : tag === 2\n          ? pbf.readFloat()\n          : tag === 3\n          ? pbf.readDouble()\n          : tag === 4\n          ? pbf.readVarint64()\n          : tag === 5\n          ? pbf.readVarint()\n          : tag === 6\n          ? pbf.readSVarint()\n          : tag === 7\n          ? pbf.readBoolean()\n          : null;\n    }\n    layer.values.push(value);\n  }\n}\n\n/**\n * Reader callback for parsing feature.\n * @param {number} tag The tag.\n * @param {Object} feature The feature object.\n * @param {PBF} pbf The PBF.\n */\nfunction featurePBFReader(tag, feature, pbf) {\n  if (tag == 1) {\n    feature.id = pbf.readVarint();\n  } else if (tag == 2) {\n    const end = pbf.readVarint() + pbf.pos;\n    while (pbf.pos < end) {\n      const key = feature.layer.keys[pbf.readVarint()];\n      const value = feature.layer.values[pbf.readVarint()];\n      feature.properties[key] = value;\n    }\n  } else if (tag == 3) {\n    feature.type = pbf.readVarint();\n  } else if (tag == 4) {\n    feature.geometry = pbf.pos;\n  }\n}\n\n/**\n * Read a raw feature from the pbf offset stored at index `i` in the raw layer.\n * @param {PBF} pbf PBF.\n * @param {Object} layer Raw layer.\n * @param {number} i Index of the feature in the raw layer's `features` array.\n * @return {Object} Raw feature.\n */\nfunction readRawFeature(pbf, layer, i) {\n  pbf.pos = layer.features[i];\n  const end = pbf.readVarint() + pbf.pos;\n\n  const feature = {\n    layer: layer,\n    type: 0,\n    properties: {},\n  };\n  pbf.readFields(featurePBFReader, feature, end);\n  return feature;\n}\n\n/**\n * @param {number} type The raw feature's geometry type\n * @param {number} numEnds Number of ends of the flat coordinates of the\n * geometry.\n * @return {import(\"../geom/Geometry.js\").Type} The geometry type.\n */\nfunction getGeometryType(type, numEnds) {\n  /** @type {import(\"../geom/Geometry.js\").Type} */\n  let geometryType;\n  if (type === 1) {\n    geometryType = numEnds === 1 ? 'Point' : 'MultiPoint';\n  } else if (type === 2) {\n    geometryType = numEnds === 1 ? 'LineString' : 'MultiLineString';\n  } else if (type === 3) {\n    geometryType = 'Polygon';\n    // MultiPolygon not relevant for rendering - winding order determines\n    // outer rings of polygons.\n  }\n  return geometryType;\n}\n\nexport default MVT;\n","/**\n * @module ol/renderer/canvas/VectorTileLayer\n */\nimport CanvasBuilderGroup from '../../render/canvas/BuilderGroup.js';\nimport CanvasExecutorGroup from '../../render/canvas/ExecutorGroup.js';\nimport CanvasTileLayerRenderer from './TileLayer.js';\nimport TileState from '../../TileState.js';\nimport ViewHint from '../../ViewHint.js';\nimport {\n  HIT_DETECT_RESOLUTION,\n  createHitDetectionImageData,\n  hitDetect,\n} from '../../render/canvas/hitdetect.js';\nimport {\n  apply as applyTransform,\n  create as createTransform,\n  multiply,\n  reset as resetTransform,\n  scale,\n  scale as scaleTransform,\n  translate as translateTransform,\n} from '../../transform.js';\nimport {\n  boundingExtent,\n  buffer,\n  containsExtent,\n  equals,\n  getIntersection,\n  getTopLeft,\n  intersects,\n} from '../../extent.js';\nimport {\n  getSquaredTolerance as getSquaredRenderTolerance,\n  renderFeature,\n} from '../vector.js';\nimport {getUid} from '../../util.js';\nimport {toSize} from '../../size.js';\nimport {wrapX} from '../../coordinate.js';\n\n/**\n * @type {!Object<string, Array<import(\"../../render/canvas.js\").BuilderType>>}\n */\nconst IMAGE_REPLAYS = {\n  'image': ['Polygon', 'Circle', 'LineString', 'Image', 'Text'],\n  'hybrid': ['Polygon', 'LineString'],\n  'vector': [],\n};\n\n/**\n * @type {!Object<string, Array<import(\"../../render/canvas.js\").BuilderType>>}\n */\nconst VECTOR_REPLAYS = {\n  'hybrid': ['Image', 'Text', 'Default'],\n  'vector': ['Polygon', 'Circle', 'LineString', 'Image', 'Text', 'Default'],\n};\n\n/**\n * @classdesc\n * Canvas renderer for vector tile layers.\n * @api\n * @extends {CanvasTileLayerRenderer<import(\"../../layer/VectorTile.js\").default>}\n */\nclass CanvasVectorTileLayerRenderer extends CanvasTileLayerRenderer {\n  /**\n   * @param {import(\"../../layer/VectorTile.js\").default} layer VectorTile layer.\n   */\n  constructor(layer) {\n    super(layer);\n\n    /** @private */\n    this.boundHandleStyleImageChange_ = this.handleStyleImageChange_.bind(this);\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.renderedLayerRevision_;\n\n    /**\n     * @private\n     * @type {import(\"../../transform\").Transform}\n     */\n    this.renderedPixelToCoordinateTransform_ = null;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.renderedRotation_;\n\n    /**\n     * @private\n     * @type {import(\"../../transform.js\").Transform}\n     */\n    this.tmpTransform_ = createTransform();\n  }\n\n  /**\n   * @param {import(\"../../VectorRenderTile.js\").default} tile Tile.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../../proj/Projection\").default} projection Projection.\n   * @return {boolean|undefined} Tile needs to be rendered.\n   */\n  prepareTile(tile, pixelRatio, projection) {\n    let render;\n    const state = tile.getState();\n    if (state === TileState.LOADED || state === TileState.ERROR) {\n      this.updateExecutorGroup_(tile, pixelRatio, projection);\n      if (this.tileImageNeedsRender_(tile)) {\n        render = true;\n      }\n    }\n    return render;\n  }\n\n  /**\n   * @param {number} z Tile coordinate z.\n   * @param {number} x Tile coordinate x.\n   * @param {number} y Tile coordinate y.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @return {!import(\"../../Tile.js\").default} Tile.\n   */\n  getTile(z, x, y, frameState) {\n    const pixelRatio = frameState.pixelRatio;\n    const viewState = frameState.viewState;\n    const resolution = viewState.resolution;\n    const projection = viewState.projection;\n    const layer = this.getLayer();\n    const tile = layer.getSource().getTile(z, x, y, pixelRatio, projection);\n    const viewHints = frameState.viewHints;\n    const hifi = !(\n      viewHints[ViewHint.ANIMATING] || viewHints[ViewHint.INTERACTING]\n    );\n    if (hifi || !tile.wantedResolution) {\n      tile.wantedResolution = resolution;\n    }\n    const render = this.prepareTile(tile, pixelRatio, projection);\n    if (\n      render &&\n      (hifi || Date.now() - frameState.time < 8) &&\n      layer.getRenderMode() !== 'vector'\n    ) {\n      this.renderTileImage_(tile, frameState);\n    }\n    return super.getTile(z, x, y, frameState);\n  }\n\n  /**\n   * @param {import(\"../../VectorRenderTile.js\").default} tile Tile.\n   * @return {boolean} Tile is drawable.\n   */\n  isDrawableTile(tile) {\n    const layer = this.getLayer();\n    return (\n      super.isDrawableTile(tile) &&\n      (layer.getRenderMode() === 'vector'\n        ? getUid(layer) in tile.executorGroups\n        : tile.hasContext(layer))\n    );\n  }\n\n  /**\n   * @inheritDoc\n   */\n  getTileImage(tile) {\n    return tile.getImage(this.getLayer());\n  }\n\n  /**\n   * Determine whether render should be called.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @return {boolean} Layer is ready to be rendered.\n   */\n  prepareFrame(frameState) {\n    const layerRevision = this.getLayer().getRevision();\n    if (this.renderedLayerRevision_ !== layerRevision) {\n      this.renderedLayerRevision_ = layerRevision;\n      this.renderedTiles.length = 0;\n    }\n    return super.prepareFrame(frameState);\n  }\n\n  /**\n   * @param {import(\"../../VectorRenderTile.js\").default} tile Tile.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../../proj/Projection.js\").default} projection Projection.\n   * @private\n   */\n  updateExecutorGroup_(tile, pixelRatio, projection) {\n    const layer = /** @type {import(\"../../layer/VectorTile.js\").default} */ (\n      this.getLayer()\n    );\n    const revision = layer.getRevision();\n    const renderOrder = layer.getRenderOrder() || null;\n\n    const resolution = tile.wantedResolution;\n    const builderState = tile.getReplayState(layer);\n    if (\n      !builderState.dirty &&\n      builderState.renderedResolution === resolution &&\n      builderState.renderedRevision == revision &&\n      builderState.renderedRenderOrder == renderOrder\n    ) {\n      return;\n    }\n\n    const source = layer.getSource();\n    const declutter = layer.getDeclutter();\n    const sourceTileGrid = source.getTileGrid();\n    const tileGrid = source.getTileGridForProjection(projection);\n    const tileExtent = tileGrid.getTileCoordExtent(tile.wrappedTileCoord);\n\n    const sourceTiles = source.getSourceTiles(pixelRatio, projection, tile);\n    const layerUid = getUid(layer);\n    delete tile.hitDetectionImageData[layerUid];\n    tile.executorGroups[layerUid] = [];\n    if (declutter) {\n      tile.declutterExecutorGroups[layerUid] = [];\n    }\n    builderState.dirty = false;\n    for (let t = 0, tt = sourceTiles.length; t < tt; ++t) {\n      const sourceTile = sourceTiles[t];\n      if (sourceTile.getState() != TileState.LOADED) {\n        continue;\n      }\n      const sourceTileCoord = sourceTile.tileCoord;\n      const sourceTileExtent =\n        sourceTileGrid.getTileCoordExtent(sourceTileCoord);\n      const sharedExtent = getIntersection(tileExtent, sourceTileExtent);\n      const builderExtent = buffer(\n        sharedExtent,\n        layer.getRenderBuffer() * resolution,\n        this.tmpExtent\n      );\n      const bufferedExtent = equals(sourceTileExtent, sharedExtent)\n        ? null\n        : builderExtent;\n      const builderGroup = new CanvasBuilderGroup(\n        0,\n        builderExtent,\n        resolution,\n        pixelRatio\n      );\n      const declutterBuilderGroup = declutter\n        ? new CanvasBuilderGroup(0, sharedExtent, resolution, pixelRatio)\n        : undefined;\n      const squaredTolerance = getSquaredRenderTolerance(\n        resolution,\n        pixelRatio\n      );\n\n      /**\n       * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n       * @this {CanvasVectorTileLayerRenderer}\n       */\n      const render = function (feature) {\n        let styles;\n        const styleFunction =\n          feature.getStyleFunction() || layer.getStyleFunction();\n        if (styleFunction) {\n          styles = styleFunction(feature, resolution);\n        }\n        if (styles) {\n          const dirty = this.renderFeature(\n            feature,\n            squaredTolerance,\n            styles,\n            builderGroup,\n            declutterBuilderGroup\n          );\n          builderState.dirty = builderState.dirty || dirty;\n        }\n      };\n\n      const features = sourceTile.getFeatures();\n      if (renderOrder && renderOrder !== builderState.renderedRenderOrder) {\n        features.sort(renderOrder);\n      }\n      for (let i = 0, ii = features.length; i < ii; ++i) {\n        const feature = features[i];\n        if (\n          !bufferedExtent ||\n          intersects(bufferedExtent, feature.getGeometry().getExtent())\n        ) {\n          render.call(this, feature);\n        }\n      }\n      const executorGroupInstructions = builderGroup.finish();\n      // no need to clip when the render tile is covered by a single source tile\n      const replayExtent =\n        layer.getRenderMode() !== 'vector' &&\n        declutter &&\n        sourceTiles.length === 1\n          ? null\n          : sharedExtent;\n      const renderingReplayGroup = new CanvasExecutorGroup(\n        replayExtent,\n        resolution,\n        pixelRatio,\n        source.getOverlaps(),\n        executorGroupInstructions,\n        layer.getRenderBuffer()\n      );\n      tile.executorGroups[layerUid].push(renderingReplayGroup);\n      if (declutterBuilderGroup) {\n        const declutterExecutorGroup = new CanvasExecutorGroup(\n          null,\n          resolution,\n          pixelRatio,\n          source.getOverlaps(),\n          declutterBuilderGroup.finish(),\n          layer.getRenderBuffer()\n        );\n        tile.declutterExecutorGroups[layerUid].push(declutterExecutorGroup);\n      }\n    }\n    builderState.renderedRevision = revision;\n    builderState.renderedRenderOrder = renderOrder;\n    builderState.renderedResolution = resolution;\n  }\n\n  /**\n   * @param {import(\"../../coordinate.js\").Coordinate} coordinate Coordinate.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @param {number} hitTolerance Hit tolerance in pixels.\n   * @param {import(\"../vector.js\").FeatureCallback<T>} callback Feature callback.\n   * @param {Array<import(\"../Map.js\").HitMatch<T>>} matches The hit detected matches with tolerance.\n   * @return {T|undefined} Callback result.\n   * @template T\n   */\n  forEachFeatureAtCoordinate(\n    coordinate,\n    frameState,\n    hitTolerance,\n    callback,\n    matches\n  ) {\n    const resolution = frameState.viewState.resolution;\n    const rotation = frameState.viewState.rotation;\n    hitTolerance = hitTolerance == undefined ? 0 : hitTolerance;\n    const layer = this.getLayer();\n    const source = layer.getSource();\n    const tileGrid = source.getTileGridForProjection(\n      frameState.viewState.projection\n    );\n\n    const hitExtent = boundingExtent([coordinate]);\n    buffer(hitExtent, resolution * hitTolerance, hitExtent);\n\n    /** @type {!Object<string, import(\"../Map.js\").HitMatch<T>|true>} */\n    const features = {};\n\n    /**\n     * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n     * @param {import(\"../../geom/SimpleGeometry.js\").default} geometry Geometry.\n     * @param {number} distanceSq The squared distance to the click position.\n     * @return {T|undefined} Callback result.\n     */\n    const featureCallback = function (feature, geometry, distanceSq) {\n      let key = feature.getId();\n      if (key === undefined) {\n        key = getUid(feature);\n      }\n      const match = features[key];\n      if (!match) {\n        if (distanceSq === 0) {\n          features[key] = true;\n          return callback(feature, layer, geometry);\n        }\n        matches.push(\n          (features[key] = {\n            feature: feature,\n            layer: layer,\n            geometry: geometry,\n            distanceSq: distanceSq,\n            callback: callback,\n          })\n        );\n      } else if (match !== true && distanceSq < match.distanceSq) {\n        if (distanceSq === 0) {\n          features[key] = true;\n          matches.splice(matches.lastIndexOf(match), 1);\n          return callback(feature, layer, geometry);\n        }\n        match.geometry = geometry;\n        match.distanceSq = distanceSq;\n      }\n      return undefined;\n    };\n\n    const renderedTiles =\n      /** @type {Array<import(\"../../VectorRenderTile.js\").default>} */ (\n        this.renderedTiles\n      );\n\n    let found;\n    for (let i = 0, ii = renderedTiles.length; !found && i < ii; ++i) {\n      const tile = renderedTiles[i];\n      const tileExtent = tileGrid.getTileCoordExtent(tile.wrappedTileCoord);\n      if (!intersects(tileExtent, hitExtent)) {\n        continue;\n      }\n\n      const layerUid = getUid(layer);\n      const executorGroups = [tile.executorGroups[layerUid]];\n      const declutterExecutorGroups = tile.declutterExecutorGroups[layerUid];\n      if (declutterExecutorGroups) {\n        executorGroups.push(declutterExecutorGroups);\n      }\n      executorGroups.some((executorGroups) => {\n        const declutteredFeatures =\n          executorGroups === declutterExecutorGroups\n            ? frameState.declutterTree.all().map((item) => item.value)\n            : null;\n        for (let t = 0, tt = executorGroups.length; t < tt; ++t) {\n          const executorGroup = executorGroups[t];\n          found = executorGroup.forEachFeatureAtCoordinate(\n            coordinate,\n            resolution,\n            rotation,\n            hitTolerance,\n            featureCallback,\n            declutteredFeatures\n          );\n          if (found) {\n            return true;\n          }\n        }\n      });\n    }\n    return found;\n  }\n\n  /**\n   * Asynchronous layer level hit detection.\n   * @param {import(\"../../pixel.js\").Pixel} pixel Pixel.\n   * @return {Promise<Array<import(\"../../Feature.js\").FeatureLike>>} Promise that resolves with an array of features.\n   */\n  getFeatures(pixel) {\n    return new Promise((resolve, reject) => {\n      const layer = this.getLayer();\n      const layerUid = getUid(layer);\n      const source = layer.getSource();\n      const projection = this.renderedProjection;\n      const projectionExtent = projection.getExtent();\n      const resolution = this.renderedResolution;\n      const tileGrid = source.getTileGridForProjection(projection);\n      const coordinate = applyTransform(\n        this.renderedPixelToCoordinateTransform_,\n        pixel.slice()\n      );\n      const tileCoord = tileGrid.getTileCoordForCoordAndResolution(\n        coordinate,\n        resolution\n      );\n      /** @type {import(\"../../VectorRenderTile.js\").default|undefined} */\n      let tile;\n      for (let i = 0, ii = this.renderedTiles.length; i < ii; ++i) {\n        if (\n          tileCoord.toString() === this.renderedTiles[i].tileCoord.toString()\n        ) {\n          tile = /** @type {import(\"../../VectorRenderTile.js\").default} */ (\n            this.renderedTiles[i]\n          );\n          if (tile.getState() === TileState.LOADED) {\n            const extent = tileGrid.getTileCoordExtent(tile.tileCoord);\n            if (\n              source.getWrapX() &&\n              projection.canWrapX() &&\n              !containsExtent(projectionExtent, extent)\n            ) {\n              wrapX(coordinate, projection);\n            }\n            break;\n          }\n          tile = undefined;\n        }\n      }\n      if (!tile || tile.loadingSourceTiles > 0) {\n        resolve([]);\n        return;\n      }\n      const extent = tileGrid.getTileCoordExtent(tile.wrappedTileCoord);\n      const corner = getTopLeft(extent);\n      const tilePixel = [\n        (coordinate[0] - corner[0]) / resolution,\n        (corner[1] - coordinate[1]) / resolution,\n      ];\n      /** @type {Array<import(\"../../Feature.js\").FeatureLike>} */\n      const features = tile\n        .getSourceTiles()\n        .reduce(function (accumulator, sourceTile) {\n          return accumulator.concat(sourceTile.getFeatures());\n        }, []);\n      /** @type {ImageData|undefined} */\n      let hitDetectionImageData = tile.hitDetectionImageData[layerUid];\n      if (!hitDetectionImageData) {\n        const tileSize = toSize(\n          tileGrid.getTileSize(\n            tileGrid.getZForResolution(resolution, source.zDirection)\n          )\n        );\n        const rotation = this.renderedRotation_;\n        const transforms = [\n          this.getRenderTransform(\n            tileGrid.getTileCoordCenter(tile.wrappedTileCoord),\n            resolution,\n            0,\n            HIT_DETECT_RESOLUTION,\n            tileSize[0] * HIT_DETECT_RESOLUTION,\n            tileSize[1] * HIT_DETECT_RESOLUTION,\n            0\n          ),\n        ];\n        hitDetectionImageData = createHitDetectionImageData(\n          tileSize,\n          transforms,\n          features,\n          layer.getStyleFunction(),\n          tileGrid.getTileCoordExtent(tile.wrappedTileCoord),\n          tile.getReplayState(layer).renderedResolution,\n          rotation\n        );\n        tile.hitDetectionImageData[layerUid] = hitDetectionImageData;\n      }\n      resolve(hitDetect(tilePixel, features, hitDetectionImageData));\n    });\n  }\n\n  /**\n   * Perform action necessary to get the layer rendered after new fonts have loaded\n   */\n  handleFontsChanged() {\n    const layer = this.getLayer();\n    if (layer.getVisible() && this.renderedLayerRevision_ !== undefined) {\n      layer.changed();\n    }\n  }\n\n  /**\n   * Handle changes in image style state.\n   * @param {import(\"../../events/Event.js\").default} event Image style change event.\n   * @private\n   */\n  handleStyleImageChange_(event) {\n    this.renderIfReadyAndVisible();\n  }\n\n  /**\n   * Render declutter items for this layer\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   */\n  renderDeclutter(frameState) {\n    const context = this.context;\n    const alpha = context.globalAlpha;\n    context.globalAlpha = this.getLayer().getOpacity();\n    const viewHints = frameState.viewHints;\n    const hifi = !(\n      viewHints[ViewHint.ANIMATING] || viewHints[ViewHint.INTERACTING]\n    );\n    const tiles =\n      /** @type {Array<import(\"../../VectorRenderTile.js\").default>} */ (\n        this.renderedTiles\n      );\n    for (let i = 0, ii = tiles.length; i < ii; ++i) {\n      const tile = tiles[i];\n      const declutterExecutorGroups =\n        tile.declutterExecutorGroups[getUid(this.getLayer())];\n      if (declutterExecutorGroups) {\n        for (let j = declutterExecutorGroups.length - 1; j >= 0; --j) {\n          declutterExecutorGroups[j].execute(\n            this.context,\n            1,\n            this.getTileRenderTransform(tile, frameState),\n            frameState.viewState.rotation,\n            hifi,\n            undefined,\n            frameState.declutterTree\n          );\n        }\n      }\n    }\n    context.globalAlpha = alpha;\n  }\n\n  getTileRenderTransform(tile, frameState) {\n    const pixelRatio = frameState.pixelRatio;\n    const viewState = frameState.viewState;\n    const center = viewState.center;\n    const resolution = viewState.resolution;\n    const rotation = viewState.rotation;\n    const size = frameState.size;\n    const width = Math.round(size[0] * pixelRatio);\n    const height = Math.round(size[1] * pixelRatio);\n\n    const source = this.getLayer().getSource();\n    const tileGrid = source.getTileGridForProjection(\n      frameState.viewState.projection\n    );\n    const tileCoord = tile.tileCoord;\n    const tileExtent = tileGrid.getTileCoordExtent(tile.wrappedTileCoord);\n    const worldOffset =\n      tileGrid.getTileCoordExtent(tileCoord, this.tmpExtent)[0] - tileExtent[0];\n    const transform = multiply(\n      scale(this.inversePixelTransform.slice(), 1 / pixelRatio, 1 / pixelRatio),\n      this.getRenderTransform(\n        center,\n        resolution,\n        rotation,\n        pixelRatio,\n        width,\n        height,\n        worldOffset\n      )\n    );\n    return transform;\n  }\n\n  /**\n   * Render the vectors for this layer.\n   * @param {CanvasRenderingContext2D} context Target context.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   */\n  postRender(context, frameState) {\n    const viewHints = frameState.viewHints;\n    const hifi = !(\n      viewHints[ViewHint.ANIMATING] || viewHints[ViewHint.INTERACTING]\n    );\n\n    this.renderedPixelToCoordinateTransform_ =\n      frameState.pixelToCoordinateTransform.slice();\n    this.renderedRotation_ = frameState.viewState.rotation;\n\n    const layer = /** @type {import(\"../../layer/VectorTile.js\").default} */ (\n      this.getLayer()\n    );\n    const renderMode = layer.getRenderMode();\n    const alpha = context.globalAlpha;\n    context.globalAlpha = layer.getOpacity();\n    const replayTypes = VECTOR_REPLAYS[renderMode];\n    const viewState = frameState.viewState;\n    const rotation = viewState.rotation;\n    const tileSource = layer.getSource();\n    const tileGrid = tileSource.getTileGridForProjection(viewState.projection);\n    const z = tileGrid.getZForResolution(\n      viewState.resolution,\n      tileSource.zDirection\n    );\n\n    const tiles = this.renderedTiles;\n    const clips = [];\n    const clipZs = [];\n    let ready = true;\n    for (let i = tiles.length - 1; i >= 0; --i) {\n      const tile = /** @type {import(\"../../VectorRenderTile.js\").default} */ (\n        tiles[i]\n      );\n      ready = ready && !tile.getReplayState(layer).dirty;\n      const executorGroups = tile.executorGroups[getUid(layer)].filter(\n        (group) => group.hasExecutors(replayTypes)\n      );\n      if (executorGroups.length === 0) {\n        continue;\n      }\n      const transform = this.getTileRenderTransform(tile, frameState);\n      const currentZ = tile.tileCoord[0];\n      let contextSaved = false;\n      // Clip mask for regions in this tile that already filled by a higher z tile\n      const currentClip = executorGroups[0].getClipCoords(transform);\n      if (currentClip) {\n        for (let j = 0, jj = clips.length; j < jj; ++j) {\n          if (z !== currentZ && currentZ < clipZs[j]) {\n            const clip = clips[j];\n            if (\n              intersects(\n                [\n                  currentClip[0],\n                  currentClip[3],\n                  currentClip[4],\n                  currentClip[7],\n                ],\n                [clip[0], clip[3], clip[4], clip[7]]\n              )\n            ) {\n              if (!contextSaved) {\n                context.save();\n                contextSaved = true;\n              }\n              context.beginPath();\n              // counter-clockwise (outer ring) for current tile\n              context.moveTo(currentClip[0], currentClip[1]);\n              context.lineTo(currentClip[2], currentClip[3]);\n              context.lineTo(currentClip[4], currentClip[5]);\n              context.lineTo(currentClip[6], currentClip[7]);\n              // clockwise (inner ring) for higher z tile\n              context.moveTo(clip[6], clip[7]);\n              context.lineTo(clip[4], clip[5]);\n              context.lineTo(clip[2], clip[3]);\n              context.lineTo(clip[0], clip[1]);\n              context.clip();\n            }\n          }\n        }\n        clips.push(currentClip);\n        clipZs.push(currentZ);\n      }\n      for (let t = 0, tt = executorGroups.length; t < tt; ++t) {\n        const executorGroup = executorGroups[t];\n        executorGroup.execute(\n          context,\n          1,\n          transform,\n          rotation,\n          hifi,\n          replayTypes\n        );\n      }\n      if (contextSaved) {\n        context.restore();\n      }\n    }\n    context.globalAlpha = alpha;\n    this.ready = ready;\n\n    super.postRender(context, frameState);\n  }\n\n  /**\n   * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n   * @param {number} squaredTolerance Squared tolerance.\n   * @param {import(\"../../style/Style.js\").default|Array<import(\"../../style/Style.js\").default>} styles The style or array of styles.\n   * @param {import(\"../../render/canvas/BuilderGroup.js\").default} builderGroup Replay group.\n   * @param {import(\"../../render/canvas/BuilderGroup.js\").default} [declutterBuilderGroup] Builder group for decluttering.\n   * @return {boolean} `true` if an image is loading.\n   */\n  renderFeature(\n    feature,\n    squaredTolerance,\n    styles,\n    builderGroup,\n    declutterBuilderGroup\n  ) {\n    if (!styles) {\n      return false;\n    }\n    let loading = false;\n    if (Array.isArray(styles)) {\n      for (let i = 0, ii = styles.length; i < ii; ++i) {\n        loading =\n          renderFeature(\n            builderGroup,\n            feature,\n            styles[i],\n            squaredTolerance,\n            this.boundHandleStyleImageChange_,\n            undefined,\n            declutterBuilderGroup\n          ) || loading;\n      }\n    } else {\n      loading = renderFeature(\n        builderGroup,\n        feature,\n        styles,\n        squaredTolerance,\n        this.boundHandleStyleImageChange_,\n        undefined,\n        declutterBuilderGroup\n      );\n    }\n    return loading;\n  }\n\n  /**\n   * @param {import(\"../../VectorRenderTile.js\").default} tile Tile.\n   * @return {boolean} A new tile image was rendered.\n   * @private\n   */\n  tileImageNeedsRender_(tile) {\n    const layer = /** @type {import(\"../../layer/VectorTile.js\").default} */ (\n      this.getLayer()\n    );\n    if (layer.getRenderMode() === 'vector') {\n      return false;\n    }\n    const replayState = tile.getReplayState(layer);\n    const revision = layer.getRevision();\n    const resolution = tile.wantedResolution;\n    return (\n      replayState.renderedTileResolution !== resolution ||\n      replayState.renderedTileRevision !== revision\n    );\n  }\n\n  /**\n   * @param {import(\"../../VectorRenderTile.js\").default} tile Tile.\n   * @param {import(\"../../Map\").FrameState} frameState Frame state.\n   * @private\n   */\n  renderTileImage_(tile, frameState) {\n    const layer = /** @type {import(\"../../layer/VectorTile.js\").default} */ (\n      this.getLayer()\n    );\n    const replayState = tile.getReplayState(layer);\n    const revision = layer.getRevision();\n    const executorGroups = tile.executorGroups[getUid(layer)];\n    replayState.renderedTileRevision = revision;\n\n    const tileCoord = tile.wrappedTileCoord;\n    const z = tileCoord[0];\n    const source = layer.getSource();\n    let pixelRatio = frameState.pixelRatio;\n    const viewState = frameState.viewState;\n    const projection = viewState.projection;\n    const tileGrid = source.getTileGridForProjection(projection);\n    const tileResolution = tileGrid.getResolution(tile.tileCoord[0]);\n    const renderPixelRatio =\n      (frameState.pixelRatio / tile.wantedResolution) * tileResolution;\n    const resolution = tileGrid.getResolution(z);\n    const context = tile.getContext(layer);\n\n    // Increase tile size when overzooming for low pixel ratio, to avoid blurry tiles\n    pixelRatio = Math.round(\n      Math.max(pixelRatio, renderPixelRatio / pixelRatio)\n    );\n    const size = source.getTilePixelSize(z, pixelRatio, projection);\n    context.canvas.width = size[0];\n    context.canvas.height = size[1];\n    const renderScale = pixelRatio / renderPixelRatio;\n    if (renderScale !== 1) {\n      const canvasTransform = resetTransform(this.tmpTransform_);\n      scaleTransform(canvasTransform, renderScale, renderScale);\n      context.setTransform.apply(context, canvasTransform);\n    }\n    const tileExtent = tileGrid.getTileCoordExtent(tileCoord, this.tmpExtent);\n    const pixelScale = renderPixelRatio / resolution;\n    const transform = resetTransform(this.tmpTransform_);\n    scaleTransform(transform, pixelScale, -pixelScale);\n    translateTransform(transform, -tileExtent[0], -tileExtent[3]);\n    for (let i = 0, ii = executorGroups.length; i < ii; ++i) {\n      const executorGroup = executorGroups[i];\n      executorGroup.execute(\n        context,\n        renderScale,\n        transform,\n        0,\n        true,\n        IMAGE_REPLAYS[layer.getRenderMode()]\n      );\n    }\n    replayState.renderedTileResolution = tile.wantedResolution;\n  }\n}\n\nexport default CanvasVectorTileLayerRenderer;\n","/**\n * @module ol/layer/VectorTile\n */\nimport BaseVectorLayer from './BaseVector.js';\nimport CanvasVectorTileLayerRenderer from '../renderer/canvas/VectorTileLayer.js';\nimport TileProperty from './TileProperty.js';\nimport {assert} from '../asserts.js';\n\n/***\n * @template Return\n * @typedef {import(\"../Observable\").OnSignature<import(\"../Observable\").EventTypes, import(\"../events/Event.js\").default, Return> &\n *   import(\"../Observable\").OnSignature<import(\"./Base\").BaseLayerObjectEventTypes|\n *     import(\"./Layer.js\").LayerEventType|'change:preload'|'change:useInterimTilesOnError', import(\"../Object\").ObjectEvent, Return> &\n *   import(\"../Observable\").OnSignature<import(\"../render/EventType\").LayerRenderEventTypes, import(\"../render/Event\").default, Return> &\n *   import(\"../Observable\").CombinedOnSignature<import(\"../Observable\").EventTypes|import(\"./Base\").BaseLayerObjectEventTypes|\n *     import(\"./Layer.js\").LayerEventType|'change:preload'|'change:useInterimTilesOnError'|import(\"../render/EventType\").LayerRenderEventTypes, Return>} VectorTileLayerOnSignature\n */\n\n/**\n * @typedef {'hybrid' | 'vector'} VectorTileRenderType\n */\n\n/**\n * @typedef {Object} Options\n * @property {string} [className='ol-layer'] A CSS class name to set to the layer element.\n * @property {number} [opacity=1] Opacity (0, 1).\n * @property {boolean} [visible=true] Visibility.\n * @property {import(\"../extent.js\").Extent} [extent] The bounding extent for layer rendering.  The layer will not be\n * rendered outside of this extent.\n * @property {number} [zIndex] The z-index for layer rendering.  At rendering time, the layers\n * will be ordered, first by Z-index and then by position. When `undefined`, a `zIndex` of 0 is assumed\n * for layers that are added to the map's `layers` collection, or `Infinity` when the layer's `setMap()`\n * method was used.\n * @property {number} [minResolution] The minimum resolution (inclusive) at which this layer will be\n * visible.\n * @property {number} [maxResolution] The maximum resolution (exclusive) below which this layer will\n * be visible.\n * @property {number} [minZoom] The minimum view zoom level (exclusive) above which this layer will be\n * visible.\n * @property {number} [maxZoom] The maximum view zoom level (inclusive) at which this layer will\n * be visible.\n * @property {import(\"../render.js\").OrderFunction} [renderOrder] Render order. Function to be used when sorting\n * features before rendering. By default features are drawn in the order that they are created. Use\n * `null` to avoid the sort, but get an undefined draw order.\n * @property {number} [renderBuffer=100] The buffer in pixels around the tile extent used by the\n * renderer when getting features from the vector tile for the rendering or hit-detection.\n * Recommended value: Vector tiles are usually generated with a buffer, so this value should match\n * the largest possible buffer of the used tiles. It should be at least the size of the largest\n * point symbol or line width.\n * @property {VectorTileRenderType} [renderMode='hybrid'] Render mode for vector tiles:\n *  * `'hybrid'`: Polygon and line elements are rendered as images, so pixels are scaled during zoom\n *    animations. Point symbols and texts are accurately rendered as vectors and can stay upright on\n *    rotated views.\n *  * `'vector'`: Everything is rendered as vectors. Use this mode for improved performance on vector\n *    tile layers with only a few rendered features (e.g. for highlighting a subset of features of\n *    another layer with the same source).\n * @property {import(\"../source/VectorTile.js\").default} [source] Source.\n * @property {import(\"../Map.js\").default} [map] Sets the layer as overlay on a map. The map will not manage\n * this layer in its layers collection, and the layer will be rendered on top. This is useful for\n * temporary layers. The standard way to add a layer to a map and have it managed by the map is to\n * use [map.addLayer()]{@link import(\"../Map.js\").default#addLayer}.\n * @property {boolean} [declutter=false] Declutter images and text. Decluttering is applied to all\n * image and text styles of all Vector and VectorTile layers that have set this to `true`. The priority\n * is defined by the z-index of the layer, the `zIndex` of the style and the render order of features.\n * Higher z-index means higher priority. Within the same z-index, a feature rendered before another has\n * higher priority.\n *\n * As an optimization decluttered features from layers with the same `className` are rendered above\n * the fill and stroke styles of all of those layers regardless of z-index.  To opt out of this\n * behavior and place declutterd features with their own layer configure the layer with a `className`\n * other than `ol-layer`.\n * @property {import(\"../style/Style.js\").StyleLike|null} [style] Layer style. When set to `null`, only\n * features that have their own style will be rendered. See {@link module:ol/style/Style~Style} for the default style\n * which will be used if this is not set.\n * @property {import(\"./Base.js\").BackgroundColor|false} [background] Background color for the layer. If not specified, no\n * background will be rendered.\n * @property {boolean} [updateWhileAnimating=false] When set to `true`, feature batches will be\n * recreated during animations. This means that no vectors will be shown clipped, but the setting\n * will have a performance impact for large amounts of vector data. When set to `false`, batches\n * will be recreated when no animation is active.\n * @property {boolean} [updateWhileInteracting=false] When set to `true`, feature batches will be\n * recreated during interactions. See also `updateWhileAnimating`.\n * @property {number} [preload=0] Preload. Load low-resolution tiles up to `preload` levels. `0`\n * means no preloading.\n * @property {boolean} [useInterimTilesOnError=true] Use interim tiles on error.\n * @property {Object<string, *>} [properties] Arbitrary observable properties. Can be accessed with `#get()` and `#set()`.\n */\n\n/**\n * @classdesc\n * Layer for vector tile data that is rendered client-side.\n * Note that any property set in the options is set as a {@link module:ol/Object~BaseObject}\n * property on the layer object; for example, setting `title: 'My Title'` in the\n * options means that `title` is observable, and has get/set accessors.\n *\n * @param {Options} [options] Options.\n * @extends {BaseVectorLayer<import(\"../source/VectorTile.js\").default, CanvasVectorTileLayerRenderer>}\n * @api\n */\nclass VectorTileLayer extends BaseVectorLayer {\n  /**\n   * @param {Options} [options] Options.\n   */\n  constructor(options) {\n    options = options ? options : {};\n\n    const baseOptions = /** @type {Object} */ (Object.assign({}, options));\n    delete baseOptions.preload;\n    delete baseOptions.useInterimTilesOnError;\n\n    super(\n      /** @type {import(\"./BaseVector.js\").Options<import(\"../source/VectorTile.js\").default>} */ (\n        baseOptions\n      )\n    );\n\n    /***\n     * @type {VectorTileLayerOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.on;\n\n    /***\n     * @type {VectorTileLayerOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.once;\n\n    /***\n     * @type {VectorTileLayerOnSignature<void>}\n     */\n    this.un;\n\n    const renderMode = options.renderMode || 'hybrid';\n    // `renderMode` must be `'hybrid'` or `'vector'`.\n    assert(renderMode == 'hybrid' || renderMode == 'vector', 28);\n\n    /**\n     * @private\n     * @type {VectorTileRenderType}\n     */\n    this.renderMode_ = renderMode;\n\n    this.setPreload(options.preload ? options.preload : 0);\n    this.setUseInterimTilesOnError(\n      options.useInterimTilesOnError !== undefined\n        ? options.useInterimTilesOnError\n        : true\n    );\n\n    /**\n     * @return {import(\"./Base.js\").BackgroundColor} Background color.\n     * @function\n     * @api\n     */\n    this.getBackground;\n\n    /**\n     * @param {import(\"./Base.js\").BackgroundColor} background Background color.\n     * @function\n     * @api\n     */\n    this.setBackground;\n  }\n\n  createRenderer() {\n    return new CanvasVectorTileLayerRenderer(this);\n  }\n\n  /**\n   * Get the topmost feature that intersects the given pixel on the viewport. Returns a promise\n   * that resolves with an array of features. The array will either contain the topmost feature\n   * when a hit was detected, or it will be empty.\n   *\n   * The hit detection algorithm used for this method is optimized for performance, but is less\n   * accurate than the one used in [map.getFeaturesAtPixel()]{@link import(\"../Map.js\").default#getFeaturesAtPixel}.\n   * Text is not considered, and icons are only represented by their bounding box instead of the exact\n   * image.\n   *\n   * @param {import(\"../pixel.js\").Pixel} pixel Pixel.\n   * @return {Promise<Array<import(\"../Feature\").FeatureLike>>} Promise that resolves with an array of features.\n   * @api\n   */\n  getFeatures(pixel) {\n    return super.getFeatures(pixel);\n  }\n\n  /**\n   * @return {VectorTileRenderType} The render mode.\n   */\n  getRenderMode() {\n    return this.renderMode_;\n  }\n\n  /**\n   * Return the level as number to which we will preload tiles up to.\n   * @return {number} The level to preload tiles up to.\n   * @observable\n   * @api\n   */\n  getPreload() {\n    return /** @type {number} */ (this.get(TileProperty.PRELOAD));\n  }\n\n  /**\n   * Whether we use interim tiles on error.\n   * @return {boolean} Use interim tiles on error.\n   * @observable\n   * @api\n   */\n  getUseInterimTilesOnError() {\n    return /** @type {boolean} */ (\n      this.get(TileProperty.USE_INTERIM_TILES_ON_ERROR)\n    );\n  }\n\n  /**\n   * Set the level as number to which we will preload tiles up to.\n   * @param {number} preload The level to preload tiles up to.\n   * @observable\n   * @api\n   */\n  setPreload(preload) {\n    this.set(TileProperty.PRELOAD, preload);\n  }\n\n  /**\n   * Set whether we use interim tiles on error.\n   * @param {boolean} useInterimTilesOnError Use interim tiles on error.\n   * @observable\n   * @api\n   */\n  setUseInterimTilesOnError(useInterimTilesOnError) {\n    this.set(TileProperty.USE_INTERIM_TILES_ON_ERROR, useInterimTilesOnError);\n  }\n}\n\nexport default VectorTileLayer;\n","/**\n * @module ol/format/JSONFeature\n */\nimport FeatureFormat from './Feature.js';\nimport {abstract} from '../util.js';\n\n/**\n * @classdesc\n * Abstract base class; normally only used for creating subclasses and not\n * instantiated in apps.\n * Base class for JSON feature formats.\n *\n * @abstract\n */\nclass JSONFeature extends FeatureFormat {\n  constructor() {\n    super();\n  }\n\n  /**\n   * @return {import(\"./Feature.js\").Type} Format.\n   */\n  getType() {\n    return 'json';\n  }\n\n  /**\n   * Read a feature.  Only works for a single feature. Use `readFeatures` to\n   * read a feature collection.\n   *\n   * @param {ArrayBuffer|Document|Element|Object|string} source Source.\n   * @param {import(\"./Feature.js\").ReadOptions} [options] Read options.\n   * @return {import(\"../Feature.js\").default} Feature.\n   * @api\n   */\n  readFeature(source, options) {\n    return this.readFeatureFromObject(\n      getObject(source),\n      this.getReadOptions(source, options)\n    );\n  }\n\n  /**\n   * Read all features.  Works with both a single feature and a feature\n   * collection.\n   *\n   * @param {ArrayBuffer|Document|Element|Object|string} source Source.\n   * @param {import(\"./Feature.js\").ReadOptions} [options] Read options.\n   * @return {Array<import(\"../Feature.js\").default>} Features.\n   * @api\n   */\n  readFeatures(source, options) {\n    return this.readFeaturesFromObject(\n      getObject(source),\n      this.getReadOptions(source, options)\n    );\n  }\n\n  /**\n   * @abstract\n   * @param {Object} object Object.\n   * @param {import(\"./Feature.js\").ReadOptions} [options] Read options.\n   * @protected\n   * @return {import(\"../Feature.js\").default} Feature.\n   */\n  readFeatureFromObject(object, options) {\n    return abstract();\n  }\n\n  /**\n   * @abstract\n   * @param {Object} object Object.\n   * @param {import(\"./Feature.js\").ReadOptions} [options] Read options.\n   * @protected\n   * @return {Array<import(\"../Feature.js\").default>} Features.\n   */\n  readFeaturesFromObject(object, options) {\n    return abstract();\n  }\n\n  /**\n   * Read a geometry.\n   *\n   * @param {ArrayBuffer|Document|Element|Object|string} source Source.\n   * @param {import(\"./Feature.js\").ReadOptions} [options] Read options.\n   * @return {import(\"../geom/Geometry.js\").default} Geometry.\n   * @api\n   */\n  readGeometry(source, options) {\n    return this.readGeometryFromObject(\n      getObject(source),\n      this.getReadOptions(source, options)\n    );\n  }\n\n  /**\n   * @abstract\n   * @param {Object} object Object.\n   * @param {import(\"./Feature.js\").ReadOptions} [options] Read options.\n   * @protected\n   * @return {import(\"../geom/Geometry.js\").default} Geometry.\n   */\n  readGeometryFromObject(object, options) {\n    return abstract();\n  }\n\n  /**\n   * Read the projection.\n   *\n   * @param {ArrayBuffer|Document|Element|Object|string} source Source.\n   * @return {import(\"../proj/Projection.js\").default} Projection.\n   * @api\n   */\n  readProjection(source) {\n    return this.readProjectionFromObject(getObject(source));\n  }\n\n  /**\n   * @abstract\n   * @param {Object} object Object.\n   * @protected\n   * @return {import(\"../proj/Projection.js\").default} Projection.\n   */\n  readProjectionFromObject(object) {\n    return abstract();\n  }\n\n  /**\n   * Encode a feature as string.\n   *\n   * @param {import(\"../Feature.js\").default} feature Feature.\n   * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n   * @return {string} Encoded feature.\n   * @api\n   */\n  writeFeature(feature, options) {\n    return JSON.stringify(this.writeFeatureObject(feature, options));\n  }\n\n  /**\n   * @abstract\n   * @param {import(\"../Feature.js\").default} feature Feature.\n   * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n   * @return {Object} Object.\n   */\n  writeFeatureObject(feature, options) {\n    return abstract();\n  }\n\n  /**\n   * Encode an array of features as string.\n   *\n   * @param {Array<import(\"../Feature.js\").default>} features Features.\n   * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n   * @return {string} Encoded features.\n   * @api\n   */\n  writeFeatures(features, options) {\n    return JSON.stringify(this.writeFeaturesObject(features, options));\n  }\n\n  /**\n   * @abstract\n   * @param {Array<import(\"../Feature.js\").default>} features Features.\n   * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n   * @return {Object} Object.\n   */\n  writeFeaturesObject(features, options) {\n    return abstract();\n  }\n\n  /**\n   * Encode a geometry as string.\n   *\n   * @param {import(\"../geom/Geometry.js\").default} geometry Geometry.\n   * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n   * @return {string} Encoded geometry.\n   * @api\n   */\n  writeGeometry(geometry, options) {\n    return JSON.stringify(this.writeGeometryObject(geometry, options));\n  }\n\n  /**\n   * @abstract\n   * @param {import(\"../geom/Geometry.js\").default} geometry Geometry.\n   * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n   * @return {Object} Object.\n   */\n  writeGeometryObject(geometry, options) {\n    return abstract();\n  }\n}\n\n/**\n * @param {Document|Element|Object|string} source Source.\n * @return {Object} Object.\n */\nfunction getObject(source) {\n  if (typeof source === 'string') {\n    const object = JSON.parse(source);\n    return object ? /** @type {Object} */ (object) : null;\n  } else if (source !== null) {\n    return source;\n  }\n  return null;\n}\n\nexport default JSONFeature;\n","/**\n * @module ol/format/GeoJSON\n */\n\nimport Feature from '../Feature.js';\nimport GeometryCollection from '../geom/GeometryCollection.js';\nimport JSONFeature from './JSONFeature.js';\nimport LineString from '../geom/LineString.js';\nimport MultiLineString from '../geom/MultiLineString.js';\nimport MultiPoint from '../geom/MultiPoint.js';\nimport MultiPolygon from '../geom/MultiPolygon.js';\nimport Point from '../geom/Point.js';\nimport Polygon from '../geom/Polygon.js';\nimport {assert} from '../asserts.js';\nimport {get as getProjection} from '../proj.js';\nimport {isEmpty} from '../obj.js';\nimport {transformGeometryWithOptions} from './Feature.js';\n\n/**\n * @typedef {import(\"geojson\").GeoJSON} GeoJSONObject\n * @typedef {import(\"geojson\").Feature} GeoJSONFeature\n * @typedef {import(\"geojson\").FeatureCollection} GeoJSONFeatureCollection\n * @typedef {import(\"geojson\").Geometry} GeoJSONGeometry\n * @typedef {import(\"geojson\").Point} GeoJSONPoint\n * @typedef {import(\"geojson\").LineString} GeoJSONLineString\n * @typedef {import(\"geojson\").Polygon} GeoJSONPolygon\n * @typedef {import(\"geojson\").MultiPoint} GeoJSONMultiPoint\n * @typedef {import(\"geojson\").MultiLineString} GeoJSONMultiLineString\n * @typedef {import(\"geojson\").MultiPolygon} GeoJSONMultiPolygon\n * @typedef {import(\"geojson\").GeometryCollection} GeoJSONGeometryCollection\n */\n\n/**\n * @typedef {Object} Options\n * @property {import(\"../proj.js\").ProjectionLike} [dataProjection='EPSG:4326'] Default data projection.\n * @property {import(\"../proj.js\").ProjectionLike} [featureProjection] Projection for features read or\n * written by the format.  Options passed to read or write methods will take precedence.\n * @property {string} [geometryName] Geometry name to use when creating features.\n * @property {boolean} [extractGeometryName=false] Certain GeoJSON providers include\n * the geometry_name field in the feature GeoJSON. If set to `true` the GeoJSON reader\n * will look for that field to set the geometry name. If both this field is set to `true`\n * and a `geometryName` is provided, the `geometryName` will take precedence.\n */\n\n/**\n * @classdesc\n * Feature format for reading and writing data in the GeoJSON format.\n *\n * @api\n */\nclass GeoJSON extends JSONFeature {\n  /**\n   * @param {Options} [options] Options.\n   */\n  constructor(options) {\n    options = options ? options : {};\n\n    super();\n\n    /**\n     * @type {import(\"../proj/Projection.js\").default}\n     */\n    this.dataProjection = getProjection(\n      options.dataProjection ? options.dataProjection : 'EPSG:4326'\n    );\n\n    if (options.featureProjection) {\n      /**\n       * @type {import(\"../proj/Projection.js\").default}\n       */\n      this.defaultFeatureProjection = getProjection(options.featureProjection);\n    }\n\n    /**\n     * Name of the geometry attribute for features.\n     * @type {string|undefined}\n     * @private\n     */\n    this.geometryName_ = options.geometryName;\n\n    /**\n     * Look for the geometry name in the feature GeoJSON\n     * @type {boolean|undefined}\n     * @private\n     */\n    this.extractGeometryName_ = options.extractGeometryName;\n\n    this.supportedMediaTypes = [\n      'application/geo+json',\n      'application/vnd.geo+json',\n    ];\n  }\n\n  /**\n   * @param {Object} object Object.\n   * @param {import(\"./Feature.js\").ReadOptions} [options] Read options.\n   * @protected\n   * @return {import(\"../Feature.js\").default} Feature.\n   */\n  readFeatureFromObject(object, options) {\n    /**\n     * @type {GeoJSONFeature}\n     */\n    let geoJSONFeature = null;\n    if (object['type'] === 'Feature') {\n      geoJSONFeature = /** @type {GeoJSONFeature} */ (object);\n    } else {\n      geoJSONFeature = {\n        'type': 'Feature',\n        'geometry': /** @type {GeoJSONGeometry} */ (object),\n        'properties': null,\n      };\n    }\n\n    const geometry = readGeometry(geoJSONFeature['geometry'], options);\n    const feature = new Feature();\n    if (this.geometryName_) {\n      feature.setGeometryName(this.geometryName_);\n    } else if (\n      this.extractGeometryName_ &&\n      'geometry_name' in geoJSONFeature !== undefined\n    ) {\n      feature.setGeometryName(geoJSONFeature['geometry_name']);\n    }\n    feature.setGeometry(geometry);\n\n    if ('id' in geoJSONFeature) {\n      feature.setId(geoJSONFeature['id']);\n    }\n\n    if (geoJSONFeature['properties']) {\n      feature.setProperties(geoJSONFeature['properties'], true);\n    }\n    return feature;\n  }\n\n  /**\n   * @param {Object} object Object.\n   * @param {import(\"./Feature.js\").ReadOptions} [options] Read options.\n   * @protected\n   * @return {Array<Feature>} Features.\n   */\n  readFeaturesFromObject(object, options) {\n    const geoJSONObject = /** @type {GeoJSONObject} */ (object);\n    /** @type {Array<import(\"../Feature.js\").default>} */\n    let features = null;\n    if (geoJSONObject['type'] === 'FeatureCollection') {\n      const geoJSONFeatureCollection = /** @type {GeoJSONFeatureCollection} */ (\n        object\n      );\n      features = [];\n      const geoJSONFeatures = geoJSONFeatureCollection['features'];\n      for (let i = 0, ii = geoJSONFeatures.length; i < ii; ++i) {\n        features.push(this.readFeatureFromObject(geoJSONFeatures[i], options));\n      }\n    } else {\n      features = [this.readFeatureFromObject(object, options)];\n    }\n    return features;\n  }\n\n  /**\n   * @param {GeoJSONGeometry} object Object.\n   * @param {import(\"./Feature.js\").ReadOptions} [options] Read options.\n   * @protected\n   * @return {import(\"../geom/Geometry.js\").default} Geometry.\n   */\n  readGeometryFromObject(object, options) {\n    return readGeometry(object, options);\n  }\n\n  /**\n   * @param {Object} object Object.\n   * @protected\n   * @return {import(\"../proj/Projection.js\").default} Projection.\n   */\n  readProjectionFromObject(object) {\n    const crs = object['crs'];\n    let projection;\n    if (crs) {\n      if (crs['type'] == 'name') {\n        projection = getProjection(crs['properties']['name']);\n      } else if (crs['type'] === 'EPSG') {\n        projection = getProjection('EPSG:' + crs['properties']['code']);\n      } else {\n        assert(false, 36); // Unknown SRS type\n      }\n    } else {\n      projection = this.dataProjection;\n    }\n    return /** @type {import(\"../proj/Projection.js\").default} */ (projection);\n  }\n\n  /**\n   * Encode a feature as a GeoJSON Feature object.\n   *\n   * @param {import(\"../Feature.js\").default} feature Feature.\n   * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n   * @return {GeoJSONFeature} Object.\n   * @api\n   */\n  writeFeatureObject(feature, options) {\n    options = this.adaptOptions(options);\n\n    /** @type {GeoJSONFeature} */\n    const object = {\n      'type': 'Feature',\n      geometry: null,\n      properties: null,\n    };\n\n    const id = feature.getId();\n    if (id !== undefined) {\n      object.id = id;\n    }\n\n    if (!feature.hasProperties()) {\n      return object;\n    }\n\n    const properties = feature.getProperties();\n    const geometry = feature.getGeometry();\n    if (geometry) {\n      object.geometry = writeGeometry(geometry, options);\n\n      delete properties[feature.getGeometryName()];\n    }\n\n    if (!isEmpty(properties)) {\n      object.properties = properties;\n    }\n\n    return object;\n  }\n\n  /**\n   * Encode an array of features as a GeoJSON object.\n   *\n   * @param {Array<import(\"../Feature.js\").default>} features Features.\n   * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n   * @return {GeoJSONFeatureCollection} GeoJSON Object.\n   * @api\n   */\n  writeFeaturesObject(features, options) {\n    options = this.adaptOptions(options);\n    const objects = [];\n    for (let i = 0, ii = features.length; i < ii; ++i) {\n      objects.push(this.writeFeatureObject(features[i], options));\n    }\n    return {\n      type: 'FeatureCollection',\n      features: objects,\n    };\n  }\n\n  /**\n   * Encode a geometry as a GeoJSON object.\n   *\n   * @param {import(\"../geom/Geometry.js\").default} geometry Geometry.\n   * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n   * @return {GeoJSONGeometry|GeoJSONGeometryCollection} Object.\n   * @api\n   */\n  writeGeometryObject(geometry, options) {\n    return writeGeometry(geometry, this.adaptOptions(options));\n  }\n}\n\n/**\n * @param {GeoJSONGeometry|GeoJSONGeometryCollection} object Object.\n * @param {import(\"./Feature.js\").ReadOptions} [options] Read options.\n * @return {import(\"../geom/Geometry.js\").default} Geometry.\n */\nfunction readGeometry(object, options) {\n  if (!object) {\n    return null;\n  }\n\n  /**\n   * @type {import(\"../geom/Geometry.js\").default}\n   */\n  let geometry;\n  switch (object['type']) {\n    case 'Point': {\n      geometry = readPointGeometry(/** @type {GeoJSONPoint} */ (object));\n      break;\n    }\n    case 'LineString': {\n      geometry = readLineStringGeometry(\n        /** @type {GeoJSONLineString} */ (object)\n      );\n      break;\n    }\n    case 'Polygon': {\n      geometry = readPolygonGeometry(/** @type {GeoJSONPolygon} */ (object));\n      break;\n    }\n    case 'MultiPoint': {\n      geometry = readMultiPointGeometry(\n        /** @type {GeoJSONMultiPoint} */ (object)\n      );\n      break;\n    }\n    case 'MultiLineString': {\n      geometry = readMultiLineStringGeometry(\n        /** @type {GeoJSONMultiLineString} */ (object)\n      );\n      break;\n    }\n    case 'MultiPolygon': {\n      geometry = readMultiPolygonGeometry(\n        /** @type {GeoJSONMultiPolygon} */ (object)\n      );\n      break;\n    }\n    case 'GeometryCollection': {\n      geometry = readGeometryCollectionGeometry(\n        /** @type {GeoJSONGeometryCollection} */ (object)\n      );\n      break;\n    }\n    default: {\n      throw new Error('Unsupported GeoJSON type: ' + object['type']);\n    }\n  }\n  return transformGeometryWithOptions(geometry, false, options);\n}\n\n/**\n * @param {GeoJSONGeometryCollection} object Object.\n * @param {import(\"./Feature.js\").ReadOptions} [options] Read options.\n * @return {GeometryCollection} Geometry collection.\n */\nfunction readGeometryCollectionGeometry(object, options) {\n  const geometries = object['geometries'].map(\n    /**\n     * @param {GeoJSONGeometry} geometry Geometry.\n     * @return {import(\"../geom/Geometry.js\").default} geometry Geometry.\n     */\n    function (geometry) {\n      return readGeometry(geometry, options);\n    }\n  );\n  return new GeometryCollection(geometries);\n}\n\n/**\n * @param {GeoJSONPoint} object Object.\n * @return {Point} Point.\n */\nfunction readPointGeometry(object) {\n  return new Point(object['coordinates']);\n}\n\n/**\n * @param {GeoJSONLineString} object Object.\n * @return {LineString} LineString.\n */\nfunction readLineStringGeometry(object) {\n  return new LineString(object['coordinates']);\n}\n\n/**\n * @param {GeoJSONMultiLineString} object Object.\n * @return {MultiLineString} MultiLineString.\n */\nfunction readMultiLineStringGeometry(object) {\n  return new MultiLineString(object['coordinates']);\n}\n\n/**\n * @param {GeoJSONMultiPoint} object Object.\n * @return {MultiPoint} MultiPoint.\n */\nfunction readMultiPointGeometry(object) {\n  return new MultiPoint(object['coordinates']);\n}\n\n/**\n * @param {GeoJSONMultiPolygon} object Object.\n * @return {MultiPolygon} MultiPolygon.\n */\nfunction readMultiPolygonGeometry(object) {\n  return new MultiPolygon(object['coordinates']);\n}\n\n/**\n * @param {GeoJSONPolygon} object Object.\n * @return {Polygon} Polygon.\n */\nfunction readPolygonGeometry(object) {\n  return new Polygon(object['coordinates']);\n}\n\n/**\n * @param {import(\"../geom/Geometry.js\").default} geometry Geometry.\n * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n * @return {GeoJSONGeometry} GeoJSON geometry.\n */\nfunction writeGeometry(geometry, options) {\n  geometry = transformGeometryWithOptions(geometry, true, options);\n  const type = geometry.getType();\n\n  /** @type {GeoJSONGeometry} */\n  let geoJSON;\n  switch (type) {\n    case 'Point': {\n      geoJSON = writePointGeometry(/** @type {Point} */ (geometry), options);\n      break;\n    }\n    case 'LineString': {\n      geoJSON = writeLineStringGeometry(\n        /** @type {LineString} */ (geometry),\n        options\n      );\n      break;\n    }\n    case 'Polygon': {\n      geoJSON = writePolygonGeometry(\n        /** @type {Polygon} */ (geometry),\n        options\n      );\n      break;\n    }\n    case 'MultiPoint': {\n      geoJSON = writeMultiPointGeometry(\n        /** @type {MultiPoint} */ (geometry),\n        options\n      );\n      break;\n    }\n    case 'MultiLineString': {\n      geoJSON = writeMultiLineStringGeometry(\n        /** @type {MultiLineString} */ (geometry),\n        options\n      );\n      break;\n    }\n    case 'MultiPolygon': {\n      geoJSON = writeMultiPolygonGeometry(\n        /** @type {MultiPolygon} */ (geometry),\n        options\n      );\n      break;\n    }\n    case 'GeometryCollection': {\n      geoJSON = writeGeometryCollectionGeometry(\n        /** @type {GeometryCollection} */ (geometry),\n        options\n      );\n      break;\n    }\n    case 'Circle': {\n      geoJSON = {\n        type: 'GeometryCollection',\n        geometries: [],\n      };\n      break;\n    }\n    default: {\n      throw new Error('Unsupported geometry type: ' + type);\n    }\n  }\n  return geoJSON;\n}\n\n/**\n * @param {GeometryCollection} geometry Geometry.\n * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n * @return {GeoJSONGeometryCollection} GeoJSON geometry collection.\n */\nfunction writeGeometryCollectionGeometry(geometry, options) {\n  options = Object.assign({}, options);\n  delete options.featureProjection;\n  const geometries = geometry.getGeometriesArray().map(function (geometry) {\n    return writeGeometry(geometry, options);\n  });\n  return {\n    type: 'GeometryCollection',\n    geometries: geometries,\n  };\n}\n\n/**\n * @param {LineString} geometry Geometry.\n * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n * @return {GeoJSONGeometry} GeoJSON geometry.\n */\nfunction writeLineStringGeometry(geometry, options) {\n  return {\n    type: 'LineString',\n    coordinates: geometry.getCoordinates(),\n  };\n}\n\n/**\n * @param {MultiLineString} geometry Geometry.\n * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n * @return {GeoJSONGeometry} GeoJSON geometry.\n */\nfunction writeMultiLineStringGeometry(geometry, options) {\n  return {\n    type: 'MultiLineString',\n    coordinates: geometry.getCoordinates(),\n  };\n}\n\n/**\n * @param {MultiPoint} geometry Geometry.\n * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n * @return {GeoJSONGeometry} GeoJSON geometry.\n */\nfunction writeMultiPointGeometry(geometry, options) {\n  return {\n    type: 'MultiPoint',\n    coordinates: geometry.getCoordinates(),\n  };\n}\n\n/**\n * @param {MultiPolygon} geometry Geometry.\n * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n * @return {GeoJSONGeometry} GeoJSON geometry.\n */\nfunction writeMultiPolygonGeometry(geometry, options) {\n  let right;\n  if (options) {\n    right = options.rightHanded;\n  }\n  return {\n    type: 'MultiPolygon',\n    coordinates: geometry.getCoordinates(right),\n  };\n}\n\n/**\n * @param {Point} geometry Geometry.\n * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n * @return {GeoJSONGeometry} GeoJSON geometry.\n */\nfunction writePointGeometry(geometry, options) {\n  return {\n    type: 'Point',\n    coordinates: geometry.getCoordinates(),\n  };\n}\n\n/**\n * @param {Polygon} geometry Geometry.\n * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n * @return {GeoJSONGeometry} GeoJSON geometry.\n */\nfunction writePolygonGeometry(geometry, options) {\n  let right;\n  if (options) {\n    right = options.rightHanded;\n  }\n  return {\n    type: 'Polygon',\n    coordinates: geometry.getCoordinates(right),\n  };\n}\n\nexport default GeoJSON;\n","export function resolveUrl(url, baseUrl) {\n    // url is absolute already\n    if (url.match(/^[a-z]+:\\/\\//i)) {\n        return url;\n    }\n    // url is absolute already, without protocol\n    if (url.match(/^\\/\\//)) {\n        return window.location.protocol + url;\n    }\n    // dataURI, mailto:, tel:, etc.\n    if (url.match(/^[a-z]+:/i)) {\n        return url;\n    }\n    const doc = document.implementation.createHTMLDocument();\n    const base = doc.createElement('base');\n    const a = doc.createElement('a');\n    doc.head.appendChild(base);\n    doc.body.appendChild(a);\n    if (baseUrl) {\n        base.href = baseUrl;\n    }\n    a.href = url;\n    return a.href;\n}\nexport const uuid = (() => {\n    // generate uuid for className of pseudo elements.\n    // We should not use GUIDs, otherwise pseudo elements sometimes cannot be captured.\n    let counter = 0;\n    // ref: http://stackoverflow.com/a/6248722/2519373\n    const random = () => \n    // eslint-disable-next-line no-bitwise\n    `0000${((Math.random() * 36 ** 4) << 0).toString(36)}`.slice(-4);\n    return () => {\n        counter += 1;\n        return `u${random()}${counter}`;\n    };\n})();\nexport function delay(ms) {\n    return (args) => new Promise((resolve) => {\n        setTimeout(() => resolve(args), ms);\n    });\n}\nexport function toArray(arrayLike) {\n    const arr = [];\n    for (let i = 0, l = arrayLike.length; i < l; i++) {\n        arr.push(arrayLike[i]);\n    }\n    return arr;\n}\nfunction px(node, styleProperty) {\n    const win = node.ownerDocument.defaultView || window;\n    const val = win.getComputedStyle(node).getPropertyValue(styleProperty);\n    return val ? parseFloat(val.replace('px', '')) : 0;\n}\nfunction getNodeWidth(node) {\n    const leftBorder = px(node, 'border-left-width');\n    const rightBorder = px(node, 'border-right-width');\n    return node.clientWidth + leftBorder + rightBorder;\n}\nfunction getNodeHeight(node) {\n    const topBorder = px(node, 'border-top-width');\n    const bottomBorder = px(node, 'border-bottom-width');\n    return node.clientHeight + topBorder + bottomBorder;\n}\nexport function getImageSize(targetNode, options = {}) {\n    const width = options.width || getNodeWidth(targetNode);\n    const height = options.height || getNodeHeight(targetNode);\n    return { width, height };\n}\nexport function getPixelRatio() {\n    let ratio;\n    let FINAL_PROCESS;\n    try {\n        FINAL_PROCESS = process;\n    }\n    catch (e) {\n        // pass\n    }\n    const val = FINAL_PROCESS && FINAL_PROCESS.env\n        ? FINAL_PROCESS.env.devicePixelRatio\n        : null;\n    if (val) {\n        ratio = parseInt(val, 10);\n        if (Number.isNaN(ratio)) {\n            ratio = 1;\n        }\n    }\n    return ratio || window.devicePixelRatio || 1;\n}\n// @see https://developer.mozilla.org/en-US/docs/Web/HTML/Element/canvas#maximum_canvas_size\nconst canvasDimensionLimit = 16384;\nexport function checkCanvasDimensions(canvas) {\n    if (canvas.width > canvasDimensionLimit ||\n        canvas.height > canvasDimensionLimit) {\n        if (canvas.width > canvasDimensionLimit &&\n            canvas.height > canvasDimensionLimit) {\n            if (canvas.width > canvas.height) {\n                canvas.height *= canvasDimensionLimit / canvas.width;\n                canvas.width = canvasDimensionLimit;\n            }\n            else {\n                canvas.width *= canvasDimensionLimit / canvas.height;\n                canvas.height = canvasDimensionLimit;\n            }\n        }\n        else if (canvas.width > canvasDimensionLimit) {\n            canvas.height *= canvasDimensionLimit / canvas.width;\n            canvas.width = canvasDimensionLimit;\n        }\n        else {\n            canvas.width *= canvasDimensionLimit / canvas.height;\n            canvas.height = canvasDimensionLimit;\n        }\n    }\n}\nexport function canvasToBlob(canvas, options = {}) {\n    if (canvas.toBlob) {\n        return new Promise((resolve) => {\n            canvas.toBlob(resolve, options.type ? options.type : 'image/png', options.quality ? options.quality : 1);\n        });\n    }\n    return new Promise((resolve) => {\n        const binaryString = window.atob(canvas\n            .toDataURL(options.type ? options.type : undefined, options.quality ? options.quality : undefined)\n            .split(',')[1]);\n        const len = binaryString.length;\n        const binaryArray = new Uint8Array(len);\n        for (let i = 0; i < len; i += 1) {\n            binaryArray[i] = binaryString.charCodeAt(i);\n        }\n        resolve(new Blob([binaryArray], {\n            type: options.type ? options.type : 'image/png',\n        }));\n    });\n}\nexport function createImage(url) {\n    return new Promise((resolve, reject) => {\n        const img = new Image();\n        img.decode = () => resolve(img);\n        img.onload = () => resolve(img);\n        img.onerror = reject;\n        img.crossOrigin = 'anonymous';\n        img.decoding = 'async';\n        img.src = url;\n    });\n}\nexport async function svgToDataURL(svg) {\n    return Promise.resolve()\n        .then(() => new XMLSerializer().serializeToString(svg))\n        .then(encodeURIComponent)\n        .then((html) => `data:image/svg+xml;charset=utf-8,${html}`);\n}\nexport async function nodeToDataURL(node, width, height) {\n    const xmlns = 'http://www.w3.org/2000/svg';\n    const svg = document.createElementNS(xmlns, 'svg');\n    const foreignObject = document.createElementNS(xmlns, 'foreignObject');\n    svg.setAttribute('width', `${width}`);\n    svg.setAttribute('height', `${height}`);\n    svg.setAttribute('viewBox', `0 0 ${width} ${height}`);\n    foreignObject.setAttribute('width', '100%');\n    foreignObject.setAttribute('height', '100%');\n    foreignObject.setAttribute('x', '0');\n    foreignObject.setAttribute('y', '0');\n    foreignObject.setAttribute('externalResourcesRequired', 'true');\n    svg.appendChild(foreignObject);\n    foreignObject.appendChild(node);\n    return svgToDataURL(svg);\n}\nexport const isInstanceOfElement = (node, instance) => {\n    if (node instanceof instance)\n        return true;\n    const nodePrototype = Object.getPrototypeOf(node);\n    if (nodePrototype === null)\n        return false;\n    return (nodePrototype.constructor.name === instance.name ||\n        isInstanceOfElement(nodePrototype, instance));\n};\n//# sourceMappingURL=util.js.map","import { uuid, toArray } from './util';\nfunction formatCSSText(style) {\n    const content = style.getPropertyValue('content');\n    return `${style.cssText} content: '${content.replace(/'|\"/g, '')}';`;\n}\nfunction formatCSSProperties(style) {\n    return toArray(style)\n        .map((name) => {\n        const value = style.getPropertyValue(name);\n        const priority = style.getPropertyPriority(name);\n        return `${name}: ${value}${priority ? ' !important' : ''};`;\n    })\n        .join(' ');\n}\nfunction getPseudoElementStyle(className, pseudo, style) {\n    const selector = `.${className}:${pseudo}`;\n    const cssText = style.cssText\n        ? formatCSSText(style)\n        : formatCSSProperties(style);\n    return document.createTextNode(`${selector}{${cssText}}`);\n}\nfunction clonePseudoElement(nativeNode, clonedNode, pseudo) {\n    const style = window.getComputedStyle(nativeNode, pseudo);\n    const content = style.getPropertyValue('content');\n    if (content === '' || content === 'none') {\n        return;\n    }\n    const className = uuid();\n    try {\n        clonedNode.className = `${clonedNode.className} ${className}`;\n    }\n    catch (err) {\n        return;\n    }\n    const styleElement = document.createElement('style');\n    styleElement.appendChild(getPseudoElementStyle(className, pseudo, style));\n    clonedNode.appendChild(styleElement);\n}\nexport function clonePseudoElements(nativeNode, clonedNode) {\n    clonePseudoElement(nativeNode, clonedNode, ':before');\n    clonePseudoElement(nativeNode, clonedNode, ':after');\n}\n//# sourceMappingURL=clone-pseudos.js.map","const WOFF = 'application/font-woff';\nconst JPEG = 'image/jpeg';\nconst mimes = {\n    woff: WOFF,\n    woff2: WOFF,\n    ttf: 'application/font-truetype',\n    eot: 'application/vnd.ms-fontobject',\n    png: 'image/png',\n    jpg: JPEG,\n    jpeg: JPEG,\n    gif: 'image/gif',\n    tiff: 'image/tiff',\n    svg: 'image/svg+xml',\n    webp: 'image/webp',\n};\nfunction getExtension(url) {\n    const match = /\\.([^./]*?)$/g.exec(url);\n    return match ? match[1] : '';\n}\nexport function getMimeType(url) {\n    const extension = getExtension(url).toLowerCase();\n    return mimes[extension] || '';\n}\n//# sourceMappingURL=mimes.js.map","function getContentFromDataUrl(dataURL) {\n    return dataURL.split(/,/)[1];\n}\nexport function isDataUrl(url) {\n    return url.search(/^(data:)/) !== -1;\n}\nexport function makeDataUrl(content, mimeType) {\n    return `data:${mimeType};base64,${content}`;\n}\nexport async function fetchAsDataURL(url, init, process) {\n    const res = await fetch(url, init);\n    if (res.status === 404) {\n        throw new Error(`Resource \"${res.url}\" not found`);\n    }\n    const blob = await res.blob();\n    return new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onerror = reject;\n        reader.onloadend = () => {\n            try {\n                resolve(process({ res, result: reader.result }));\n            }\n            catch (error) {\n                reject(error);\n            }\n        };\n        reader.readAsDataURL(blob);\n    });\n}\nconst cache = {};\nfunction getCacheKey(url, contentType, includeQueryParams) {\n    let key = url.replace(/\\?.*/, '');\n    if (includeQueryParams) {\n        key = url;\n    }\n    // font resource\n    if (/ttf|otf|eot|woff2?/i.test(key)) {\n        key = key.replace(/.*\\//, '');\n    }\n    return contentType ? `[${contentType}]${key}` : key;\n}\nexport async function resourceToDataURL(resourceUrl, contentType, options) {\n    const cacheKey = getCacheKey(resourceUrl, contentType, options.includeQueryParams);\n    if (cache[cacheKey] != null) {\n        return cache[cacheKey];\n    }\n    // ref: https://developer.mozilla.org/en/docs/Web/API/XMLHttpRequest/Using_XMLHttpRequest#Bypassing_the_cache\n    if (options.cacheBust) {\n        // eslint-disable-next-line no-param-reassign\n        resourceUrl += (/\\?/.test(resourceUrl) ? '&' : '?') + new Date().getTime();\n    }\n    let dataURL;\n    try {\n        const content = await fetchAsDataURL(resourceUrl, options.fetchRequestInit, ({ res, result }) => {\n            if (!contentType) {\n                // eslint-disable-next-line no-param-reassign\n                contentType = res.headers.get('Content-Type') || '';\n            }\n            return getContentFromDataUrl(result);\n        });\n        dataURL = makeDataUrl(content, contentType);\n    }\n    catch (error) {\n        dataURL = options.imagePlaceholder || '';\n        let msg = `Failed to fetch resource: ${resourceUrl}`;\n        if (error) {\n            msg = typeof error === 'string' ? error : error.message;\n        }\n        if (msg) {\n            console.warn(msg);\n        }\n    }\n    cache[cacheKey] = dataURL;\n    return dataURL;\n}\n//# sourceMappingURL=dataurl.js.map","import { clonePseudoElements } from './clone-pseudos';\nimport { createImage, toArray, isInstanceOfElement } from './util';\nimport { getMimeType } from './mimes';\nimport { resourceToDataURL } from './dataurl';\nasync function cloneCanvasElement(canvas) {\n    const dataURL = canvas.toDataURL();\n    if (dataURL === 'data:,') {\n        return canvas.cloneNode(false);\n    }\n    return createImage(dataURL);\n}\nasync function cloneVideoElement(video, options) {\n    if (video.currentSrc) {\n        const canvas = document.createElement('canvas');\n        const ctx = canvas.getContext('2d');\n        canvas.width = video.clientWidth;\n        canvas.height = video.clientHeight;\n        ctx === null || ctx === void 0 ? void 0 : ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n        const dataURL = canvas.toDataURL();\n        return createImage(dataURL);\n    }\n    const poster = video.poster;\n    const contentType = getMimeType(poster);\n    const dataURL = await resourceToDataURL(poster, contentType, options);\n    return createImage(dataURL);\n}\nasync function cloneIFrameElement(iframe) {\n    var _a;\n    try {\n        if ((_a = iframe === null || iframe === void 0 ? void 0 : iframe.contentDocument) === null || _a === void 0 ? void 0 : _a.body) {\n            return (await cloneNode(iframe.contentDocument.body, {}, true));\n        }\n    }\n    catch (_b) {\n        // Failed to clone iframe\n    }\n    return iframe.cloneNode(false);\n}\nasync function cloneSingleNode(node, options) {\n    if (isInstanceOfElement(node, HTMLCanvasElement)) {\n        return cloneCanvasElement(node);\n    }\n    if (isInstanceOfElement(node, HTMLVideoElement)) {\n        return cloneVideoElement(node, options);\n    }\n    if (isInstanceOfElement(node, HTMLIFrameElement)) {\n        return cloneIFrameElement(node);\n    }\n    return node.cloneNode(false);\n}\nconst isSlotElement = (node) => node.tagName != null && node.tagName.toUpperCase() === 'SLOT';\nasync function cloneChildren(nativeNode, clonedNode, options) {\n    var _a, _b;\n    let children = [];\n    if (isSlotElement(nativeNode) && nativeNode.assignedNodes) {\n        children = toArray(nativeNode.assignedNodes());\n    }\n    else if (isInstanceOfElement(nativeNode, HTMLIFrameElement) &&\n        ((_a = nativeNode.contentDocument) === null || _a === void 0 ? void 0 : _a.body)) {\n        children = toArray(nativeNode.contentDocument.body.childNodes);\n    }\n    else {\n        children = toArray(((_b = nativeNode.shadowRoot) !== null && _b !== void 0 ? _b : nativeNode).childNodes);\n    }\n    if (children.length === 0 ||\n        isInstanceOfElement(nativeNode, HTMLVideoElement)) {\n        return clonedNode;\n    }\n    await children.reduce((deferred, child) => deferred\n        .then(() => cloneNode(child, options))\n        .then((clonedChild) => {\n        if (clonedChild) {\n            clonedNode.appendChild(clonedChild);\n        }\n    }), Promise.resolve());\n    return clonedNode;\n}\nfunction cloneCSSStyle(nativeNode, clonedNode) {\n    const targetStyle = clonedNode.style;\n    if (!targetStyle) {\n        return;\n    }\n    const sourceStyle = window.getComputedStyle(nativeNode);\n    if (sourceStyle.cssText) {\n        targetStyle.cssText = sourceStyle.cssText;\n        targetStyle.transformOrigin = sourceStyle.transformOrigin;\n    }\n    else {\n        toArray(sourceStyle).forEach((name) => {\n            let value = sourceStyle.getPropertyValue(name);\n            if (name === 'font-size' && value.endsWith('px')) {\n                const reducedFont = Math.floor(parseFloat(value.substring(0, value.length - 2))) - 0.1;\n                value = `${reducedFont}px`;\n            }\n            if (isInstanceOfElement(nativeNode, HTMLIFrameElement) &&\n                name === 'display' &&\n                value === 'inline') {\n                value = 'block';\n            }\n            if (name === 'd' && clonedNode.getAttribute('d')) {\n                value = `path(${clonedNode.getAttribute('d')})`;\n            }\n            targetStyle.setProperty(name, value, sourceStyle.getPropertyPriority(name));\n        });\n    }\n}\nfunction cloneInputValue(nativeNode, clonedNode) {\n    if (isInstanceOfElement(nativeNode, HTMLTextAreaElement)) {\n        clonedNode.innerHTML = nativeNode.value;\n    }\n    if (isInstanceOfElement(nativeNode, HTMLInputElement)) {\n        clonedNode.setAttribute('value', nativeNode.value);\n    }\n}\nfunction cloneSelectValue(nativeNode, clonedNode) {\n    if (isInstanceOfElement(nativeNode, HTMLSelectElement)) {\n        const clonedSelect = clonedNode;\n        const selectedOption = Array.from(clonedSelect.children).find((child) => nativeNode.value === child.getAttribute('value'));\n        if (selectedOption) {\n            selectedOption.setAttribute('selected', '');\n        }\n    }\n}\nfunction decorate(nativeNode, clonedNode) {\n    if (isInstanceOfElement(clonedNode, Element)) {\n        cloneCSSStyle(nativeNode, clonedNode);\n        clonePseudoElements(nativeNode, clonedNode);\n        cloneInputValue(nativeNode, clonedNode);\n        cloneSelectValue(nativeNode, clonedNode);\n    }\n    return clonedNode;\n}\nasync function ensureSVGSymbols(clone, options) {\n    const uses = clone.querySelectorAll ? clone.querySelectorAll('use') : [];\n    if (uses.length === 0) {\n        return clone;\n    }\n    const processedDefs = {};\n    for (let i = 0; i < uses.length; i++) {\n        const use = uses[i];\n        const id = use.getAttribute('xlink:href');\n        if (id) {\n            const exist = clone.querySelector(id);\n            const definition = document.querySelector(id);\n            if (!exist && definition && !processedDefs[id]) {\n                // eslint-disable-next-line no-await-in-loop\n                processedDefs[id] = (await cloneNode(definition, options, true));\n            }\n        }\n    }\n    const nodes = Object.values(processedDefs);\n    if (nodes.length) {\n        const ns = 'http://www.w3.org/1999/xhtml';\n        const svg = document.createElementNS(ns, 'svg');\n        svg.setAttribute('xmlns', ns);\n        svg.style.position = 'absolute';\n        svg.style.width = '0';\n        svg.style.height = '0';\n        svg.style.overflow = 'hidden';\n        svg.style.display = 'none';\n        const defs = document.createElementNS(ns, 'defs');\n        svg.appendChild(defs);\n        for (let i = 0; i < nodes.length; i++) {\n            defs.appendChild(nodes[i]);\n        }\n        clone.appendChild(svg);\n    }\n    return clone;\n}\nexport async function cloneNode(node, options, isRoot) {\n    if (!isRoot && options.filter && !options.filter(node)) {\n        return null;\n    }\n    return Promise.resolve(node)\n        .then((clonedNode) => cloneSingleNode(clonedNode, options))\n        .then((clonedNode) => cloneChildren(node, clonedNode, options))\n        .then((clonedNode) => decorate(node, clonedNode))\n        .then((clonedNode) => ensureSVGSymbols(clonedNode, options));\n}\n//# sourceMappingURL=clone-node.js.map","import { resolveUrl } from './util';\nimport { getMimeType } from './mimes';\nimport { isDataUrl, makeDataUrl, resourceToDataURL } from './dataurl';\nconst URL_REGEX = /url\\((['\"]?)([^'\"]+?)\\1\\)/g;\nconst URL_WITH_FORMAT_REGEX = /url\\([^)]+\\)\\s*format\\(([\"']?)([^\"']+)\\1\\)/g;\nconst FONT_SRC_REGEX = /src:\\s*(?:url\\([^)]+\\)\\s*format\\([^)]+\\)[,;]\\s*)+/g;\nfunction toRegex(url) {\n    // eslint-disable-next-line no-useless-escape\n    const escaped = url.replace(/([.*+?^${}()|\\[\\]\\/\\\\])/g, '\\\\$1');\n    return new RegExp(`(url\\\\(['\"]?)(${escaped})(['\"]?\\\\))`, 'g');\n}\nexport function parseURLs(cssText) {\n    const urls = [];\n    cssText.replace(URL_REGEX, (raw, quotation, url) => {\n        urls.push(url);\n        return raw;\n    });\n    return urls.filter((url) => !isDataUrl(url));\n}\nexport async function embed(cssText, resourceURL, baseURL, options, getContentFromUrl) {\n    try {\n        const resolvedURL = baseURL ? resolveUrl(resourceURL, baseURL) : resourceURL;\n        const contentType = getMimeType(resourceURL);\n        let dataURL;\n        if (getContentFromUrl) {\n            const content = await getContentFromUrl(resolvedURL);\n            dataURL = makeDataUrl(content, contentType);\n        }\n        else {\n            dataURL = await resourceToDataURL(resolvedURL, contentType, options);\n        }\n        return cssText.replace(toRegex(resourceURL), `$1${dataURL}$3`);\n    }\n    catch (error) {\n        // pass\n    }\n    return cssText;\n}\nfunction filterPreferredFontFormat(str, { preferredFontFormat }) {\n    return !preferredFontFormat\n        ? str\n        : str.replace(FONT_SRC_REGEX, (match) => {\n            // eslint-disable-next-line no-constant-condition\n            while (true) {\n                const [src, , format] = URL_WITH_FORMAT_REGEX.exec(match) || [];\n                if (!format) {\n                    return '';\n                }\n                if (format === preferredFontFormat) {\n                    return `src: ${src};`;\n                }\n            }\n        });\n}\nexport function shouldEmbed(url) {\n    return url.search(URL_REGEX) !== -1;\n}\nexport async function embedResources(cssText, baseUrl, options) {\n    if (!shouldEmbed(cssText)) {\n        return cssText;\n    }\n    const filteredCSSText = filterPreferredFontFormat(cssText, options);\n    const urls = parseURLs(filteredCSSText);\n    return urls.reduce((deferred, url) => deferred.then((css) => embed(css, url, baseUrl, options)), Promise.resolve(filteredCSSText));\n}\n//# sourceMappingURL=embed-resources.js.map","import { embedResources } from './embed-resources';\nimport { toArray, isInstanceOfElement } from './util';\nimport { isDataUrl, resourceToDataURL } from './dataurl';\nimport { getMimeType } from './mimes';\nasync function embedProp(propName, node, options) {\n    var _a;\n    const propValue = (_a = node.style) === null || _a === void 0 ? void 0 : _a.getPropertyValue(propName);\n    if (propValue) {\n        const cssString = await embedResources(propValue, null, options);\n        node.style.setProperty(propName, cssString, node.style.getPropertyPriority(propName));\n        return true;\n    }\n    return false;\n}\nasync function embedBackground(clonedNode, options) {\n    if (!(await embedProp('background', clonedNode, options))) {\n        await embedProp('background-image', clonedNode, options);\n    }\n    if (!(await embedProp('mask', clonedNode, options))) {\n        await embedProp('mask-image', clonedNode, options);\n    }\n}\nasync function embedImageNode(clonedNode, options) {\n    const isImageElement = isInstanceOfElement(clonedNode, HTMLImageElement);\n    if (!(isImageElement && !isDataUrl(clonedNode.src)) &&\n        !(isInstanceOfElement(clonedNode, SVGImageElement) &&\n            !isDataUrl(clonedNode.href.baseVal))) {\n        return;\n    }\n    const url = isImageElement ? clonedNode.src : clonedNode.href.baseVal;\n    const dataURL = await resourceToDataURL(url, getMimeType(url), options);\n    await new Promise((resolve, reject) => {\n        clonedNode.onload = resolve;\n        clonedNode.onerror = reject;\n        const image = clonedNode;\n        if (image.decode) {\n            image.decode = resolve;\n        }\n        if (image.loading === 'lazy') {\n            image.loading = 'eager';\n        }\n        if (isImageElement) {\n            clonedNode.srcset = '';\n            clonedNode.src = dataURL;\n        }\n        else {\n            clonedNode.href.baseVal = dataURL;\n        }\n    });\n}\nasync function embedChildren(clonedNode, options) {\n    const children = toArray(clonedNode.childNodes);\n    const deferreds = children.map((child) => embedImages(child, options));\n    await Promise.all(deferreds).then(() => clonedNode);\n}\nexport async function embedImages(clonedNode, options) {\n    if (isInstanceOfElement(clonedNode, Element)) {\n        await embedBackground(clonedNode, options);\n        await embedImageNode(clonedNode, options);\n        await embedChildren(clonedNode, options);\n    }\n}\n//# sourceMappingURL=embed-images.js.map","export function applyStyle(node, options) {\n    const { style } = node;\n    if (options.backgroundColor) {\n        style.backgroundColor = options.backgroundColor;\n    }\n    if (options.width) {\n        style.width = `${options.width}px`;\n    }\n    if (options.height) {\n        style.height = `${options.height}px`;\n    }\n    const manual = options.style;\n    if (manual != null) {\n        Object.keys(manual).forEach((key) => {\n            style[key] = manual[key];\n        });\n    }\n    return node;\n}\n//# sourceMappingURL=apply-style.js.map","import { toArray } from './util';\nimport { fetchAsDataURL } from './dataurl';\nimport { shouldEmbed, embedResources } from './embed-resources';\nconst cssFetchCache = {};\nasync function fetchCSS(url) {\n    let cache = cssFetchCache[url];\n    if (cache != null) {\n        return cache;\n    }\n    const res = await fetch(url);\n    const cssText = await res.text();\n    cache = { url, cssText };\n    cssFetchCache[url] = cache;\n    return cache;\n}\nasync function embedFonts(data, options) {\n    let cssText = data.cssText;\n    const regexUrl = /url\\([\"']?([^\"')]+)[\"']?\\)/g;\n    const fontLocs = cssText.match(/url\\([^)]+\\)/g) || [];\n    const loadFonts = fontLocs.map(async (loc) => {\n        let url = loc.replace(regexUrl, '$1');\n        if (!url.startsWith('https://')) {\n            url = new URL(url, data.url).href;\n        }\n        return fetchAsDataURL(url, options.fetchRequestInit, ({ result }) => {\n            cssText = cssText.replace(loc, `url(${result})`);\n            return [loc, result];\n        });\n    });\n    return Promise.all(loadFonts).then(() => cssText);\n}\nfunction parseCSS(source) {\n    if (source == null) {\n        return [];\n    }\n    const result = [];\n    const commentsRegex = /(\\/\\*[\\s\\S]*?\\*\\/)/gi;\n    // strip out comments\n    let cssText = source.replace(commentsRegex, '');\n    // eslint-disable-next-line prefer-regex-literals\n    const keyframesRegex = new RegExp('((@.*?keyframes [\\\\s\\\\S]*?){([\\\\s\\\\S]*?}\\\\s*?)})', 'gi');\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n        const matches = keyframesRegex.exec(cssText);\n        if (matches === null) {\n            break;\n        }\n        result.push(matches[0]);\n    }\n    cssText = cssText.replace(keyframesRegex, '');\n    const importRegex = /@import[\\s\\S]*?url\\([^)]*\\)[\\s\\S]*?;/gi;\n    // to match css & media queries together\n    const combinedCSSRegex = '((\\\\s*?(?:\\\\/\\\\*[\\\\s\\\\S]*?\\\\*\\\\/)?\\\\s*?@media[\\\\s\\\\S]' +\n        '*?){([\\\\s\\\\S]*?)}\\\\s*?})|(([\\\\s\\\\S]*?){([\\\\s\\\\S]*?)})';\n    // unified regex\n    const unifiedRegex = new RegExp(combinedCSSRegex, 'gi');\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n        let matches = importRegex.exec(cssText);\n        if (matches === null) {\n            matches = unifiedRegex.exec(cssText);\n            if (matches === null) {\n                break;\n            }\n            else {\n                importRegex.lastIndex = unifiedRegex.lastIndex;\n            }\n        }\n        else {\n            unifiedRegex.lastIndex = importRegex.lastIndex;\n        }\n        result.push(matches[0]);\n    }\n    return result;\n}\nasync function getCSSRules(styleSheets, options) {\n    const ret = [];\n    const deferreds = [];\n    // First loop inlines imports\n    styleSheets.forEach((sheet) => {\n        if ('cssRules' in sheet) {\n            try {\n                toArray(sheet.cssRules || []).forEach((item, index) => {\n                    if (item.type === CSSRule.IMPORT_RULE) {\n                        let importIndex = index + 1;\n                        const url = item.href;\n                        const deferred = fetchCSS(url)\n                            .then((metadata) => embedFonts(metadata, options))\n                            .then((cssText) => parseCSS(cssText).forEach((rule) => {\n                            try {\n                                sheet.insertRule(rule, rule.startsWith('@import')\n                                    ? (importIndex += 1)\n                                    : sheet.cssRules.length);\n                            }\n                            catch (error) {\n                                console.error('Error inserting rule from remote css', {\n                                    rule,\n                                    error,\n                                });\n                            }\n                        }))\n                            .catch((e) => {\n                            console.error('Error loading remote css', e.toString());\n                        });\n                        deferreds.push(deferred);\n                    }\n                });\n            }\n            catch (e) {\n                const inline = styleSheets.find((a) => a.href == null) || document.styleSheets[0];\n                if (sheet.href != null) {\n                    deferreds.push(fetchCSS(sheet.href)\n                        .then((metadata) => embedFonts(metadata, options))\n                        .then((cssText) => parseCSS(cssText).forEach((rule) => {\n                        inline.insertRule(rule, sheet.cssRules.length);\n                    }))\n                        .catch((err) => {\n                        console.error('Error loading remote stylesheet', err);\n                    }));\n                }\n                console.error('Error inlining remote css file', e);\n            }\n        }\n    });\n    return Promise.all(deferreds).then(() => {\n        // Second loop parses rules\n        styleSheets.forEach((sheet) => {\n            if ('cssRules' in sheet) {\n                try {\n                    toArray(sheet.cssRules || []).forEach((item) => {\n                        ret.push(item);\n                    });\n                }\n                catch (e) {\n                    console.error(`Error while reading CSS rules from ${sheet.href}`, e);\n                }\n            }\n        });\n        return ret;\n    });\n}\nfunction getWebFontRules(cssRules) {\n    return cssRules\n        .filter((rule) => rule.type === CSSRule.FONT_FACE_RULE)\n        .filter((rule) => shouldEmbed(rule.style.getPropertyValue('src')));\n}\nasync function parseWebFontRules(node, options) {\n    if (node.ownerDocument == null) {\n        throw new Error('Provided element is not within a Document');\n    }\n    const styleSheets = toArray(node.ownerDocument.styleSheets);\n    const cssRules = await getCSSRules(styleSheets, options);\n    return getWebFontRules(cssRules);\n}\nexport async function getWebFontCSS(node, options) {\n    const rules = await parseWebFontRules(node, options);\n    const cssTexts = await Promise.all(rules.map((rule) => {\n        const baseUrl = rule.parentStyleSheet ? rule.parentStyleSheet.href : null;\n        return embedResources(rule.cssText, baseUrl, options);\n    }));\n    return cssTexts.join('\\n');\n}\nexport async function embedWebFonts(clonedNode, options) {\n    const cssText = options.fontEmbedCSS != null\n        ? options.fontEmbedCSS\n        : options.skipFonts\n            ? null\n            : await getWebFontCSS(clonedNode, options);\n    if (cssText) {\n        const styleNode = document.createElement('style');\n        const sytleContent = document.createTextNode(cssText);\n        styleNode.appendChild(sytleContent);\n        if (clonedNode.firstChild) {\n            clonedNode.insertBefore(styleNode, clonedNode.firstChild);\n        }\n        else {\n            clonedNode.appendChild(styleNode);\n        }\n    }\n}\n//# sourceMappingURL=embed-webfonts.js.map","import { cloneNode } from './clone-node';\nimport { embedImages } from './embed-images';\nimport { applyStyle } from './apply-style';\nimport { embedWebFonts, getWebFontCSS } from './embed-webfonts';\nimport { getImageSize, getPixelRatio, createImage, canvasToBlob, nodeToDataURL, checkCanvasDimensions, } from './util';\nexport async function toSvg(node, options = {}) {\n    const { width, height } = getImageSize(node, options);\n    const clonedNode = (await cloneNode(node, options, true));\n    await embedWebFonts(clonedNode, options);\n    await embedImages(clonedNode, options);\n    applyStyle(clonedNode, options);\n    const datauri = await nodeToDataURL(clonedNode, width, height);\n    return datauri;\n}\nexport async function toCanvas(node, options = {}) {\n    const { width, height } = getImageSize(node, options);\n    const svg = await toSvg(node, options);\n    const img = await createImage(svg);\n    const canvas = document.createElement('canvas');\n    const context = canvas.getContext('2d');\n    const ratio = options.pixelRatio || getPixelRatio();\n    const canvasWidth = options.canvasWidth || width;\n    const canvasHeight = options.canvasHeight || height;\n    canvas.width = canvasWidth * ratio;\n    canvas.height = canvasHeight * ratio;\n    if (!options.skipAutoScale) {\n        checkCanvasDimensions(canvas);\n    }\n    canvas.style.width = `${canvasWidth}`;\n    canvas.style.height = `${canvasHeight}`;\n    if (options.backgroundColor) {\n        context.fillStyle = options.backgroundColor;\n        context.fillRect(0, 0, canvas.width, canvas.height);\n    }\n    context.drawImage(img, 0, 0, canvas.width, canvas.height);\n    return canvas;\n}\nexport async function toPixelData(node, options = {}) {\n    const { width, height } = getImageSize(node, options);\n    const canvas = await toCanvas(node, options);\n    const ctx = canvas.getContext('2d');\n    return ctx.getImageData(0, 0, width, height).data;\n}\nexport async function toPng(node, options = {}) {\n    const canvas = await toCanvas(node, options);\n    return canvas.toDataURL();\n}\nexport async function toJpeg(node, options = {}) {\n    const canvas = await toCanvas(node, options);\n    return canvas.toDataURL('image/jpeg', options.quality || 1);\n}\nexport async function toBlob(node, options = {}) {\n    const canvas = await toCanvas(node, options);\n    const blob = await canvasToBlob(canvas);\n    return blob;\n}\nexport async function getFontEmbedCSS(node, options = {}) {\n    return getWebFontCSS(node, options);\n}\n//# sourceMappingURL=index.js.map","export default \"__VITE_ASSET__a1b2bb5c__\"","<script>\r\nimport { onMounted, reactive, nextTick } from 'vue'\r\n\r\nimport { Map, View, Feature } from 'ol'\r\nimport 'ol/ol.css'\r\nimport { OSM } from 'ol/source.js'\r\nimport { Tile, Tile as TileLayer, Image as ImageLayer, Vector, Vector as VectorLayer } from 'ol/layer.js'\r\n\r\nimport VectorSource from 'ol/source/Vector.js'\r\nimport { Icon, Fill, Stroke, Style } from 'ol/style.js'\r\nimport { Circle, Polygon, Point } from 'ol/geom.js'\r\nimport { toPng } from \"html-to-image\";\r\nimport currentPositionImg from '@/assets/img/icon/currentPosition.svg';\r\n\r\nexport default {\r\n    props: {\r\n        coordinate: {\r\n            type: Object,\r\n            default: {}\r\n        },\r\n    },\r\n    setup(props, { emit }) {\r\n        let map\r\n        const state = reactive({\r\n            imgSrc: 'dddd'\r\n        })\r\n        onMounted(async () => {\r\n            map = new Map({\r\n                target: 'imgMap',\r\n                layers: [\r\n                    new TileLayer({\r\n                        preload: Infinity,\r\n                        crossOrigin: \"Anonymous\",\r\n                        source: new OSM(),\r\n                    }),\r\n                    new Vector({\r\n                        source: new VectorSource({\r\n                            features: [\r\n                                new Feature({\r\n                                    geometry: new Point(props.coordinate),\r\n                                    population: 4000,\r\n                                    rainfall: 500,\r\n                                })\r\n                            ]\r\n                        }),\r\n                        style: new Style({\r\n                            image: new Icon({\r\n                                anchor: [0.5, 100],\r\n                                anchorXUnits: 'fraction',\r\n                                anchorYUnits: 'pixels',\r\n                                src: currentPositionImg,\r\n                            }),\r\n                        })\r\n                    })\r\n                ],\r\n                view: new View({\r\n                    projection: 'EPSG:4326',\r\n                    center: props.coordinate,\r\n                    zoom: 14,\r\n                }),\r\n            })\r\n            map.once('loadend', function () {\r\n                toPng(map.getTargetElement()).then(function (dataURL) {\r\n                    if(document.getElementById('imgMap') !== null ) {\r\n                        document.getElementById('imgMap').remove()\r\n                        state.imgSrc = dataURL\r\n                    }\r\n                })\r\n            })\r\n        })\r\n        return {\r\n            props,\r\n            state,\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<template>\r\n    <div class=\"position-relative\" style=\"overflow: hidden;\">\r\n        <div id=\"imgMap\" class=\"position-absolute\" style=\"width: 600px; height: 600px;\"></div>\r\n        <div :style=\"{\r\n            'background': `url('${state.imgSrc}')`,\r\n            'background-size': 'cover'\r\n        }\"\r\n        style=\"width: 100%; height: 200px;\">\r\n\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<style lang=\"sass\" scoped>\r\n#imgMap\r\n    top: 0\r\n    left: 0\r\n</style>","export default \"__VITE_ASSET__204bf141__\"","<script>\r\nimport { useSlots, onBeforeMount, onMounted, onUpdated, onBeforeUnmount, ref, reactive, computed, watch, nextTick, defineAsyncComponent, useCssModule, inject } from 'vue'\r\nimport $ from 'jquery'\r\nimport { useRouter } from 'vue-router'\r\n\r\nexport default {\r\n    props: {\r\n        popup: {\r\n            type: Object,\r\n            default: {}\r\n        },\r\n        closeAreaData: {\r\n            Type: Function,\r\n            default: () => { }\r\n        },\r\n        maxHeight: {\r\n            Type: Number,\r\n            default: 0\r\n        },\r\n        coordinate: {\r\n            type: Object,\r\n            default: {}\r\n        },\r\n    },\r\n    setup(props, { emit }) {\r\n        const router = useRouter()\r\n        const state = reactive({\r\n            type: 0,\r\n            media: 'photo',\r\n            scrollY: false,\r\n            tribeData: {},\r\n            showAreaDataWindow: false,\r\n            oldPopupId: \"\"\r\n        })\r\n\r\n        async function getTribeData(tribeId) {\r\n            const result = await $.ajax({\r\n                url: `https://api.edtest.site/tribe?tribeCode=${tribeId}`,\r\n                method: \"GET\"\r\n            }).done(res => {\r\n                return res\r\n            }).fail(FailMethod => {\r\n                state.type = 0\r\n                props.closeAreaData()\r\n                return false\r\n            })\r\n            return result\r\n        }\r\n\r\n        async function getDisasterData(id) {\r\n            const result = await $.ajax({\r\n                url: `https://api.edtest.site/historicalDiseaster?id=${id}`,\r\n                method: \"GET\"\r\n            }).done(res => {\r\n                return res\r\n            }).fail(FailMethod => {\r\n                state.type = 0\r\n                props.closeAreaData()\r\n                return false\r\n            })\r\n            return result\r\n        }\r\n\r\n        async function getRainfallStation(stationName) {\r\n            const result = await $.ajax({\r\n                url: `https://api.edtest.site/rainData?stationName=${stationName}`,\r\n                method: \"GET\"\r\n            }).done(res => {\r\n                return res\r\n            }).fail(FailMethod => {\r\n                state.type = 0\r\n                props.closeAreaData()\r\n                return false\r\n            })\r\n            return result\r\n        }\r\n        async function getHarvestDrill(projNo) {\r\n            const result = await $.ajax({\r\n                url: `https://api.edtest.site/harvestDrill?projNo=${projNo}`,\r\n                method: \"GET\"\r\n            }).done(res => {\r\n                return res\r\n            }).fail(FailMethod => {\r\n                state.type = 0\r\n                props.closeAreaData()\r\n                return false\r\n            })\r\n            return result\r\n        }\r\n\r\n        function getPotentialDebrisFlowTorrent(data) {\r\n            return {\r\n                basic: data.get('Basin'),\r\n                full: data.get('Full'),\r\n                risk: data.get('Risk'),\r\n                note01: data.get('Note01'),\r\n                note02: data.get('Note02'),\r\n                stra_1: data.get('Stra_1'),\r\n                stra_2: data.get('Stra_2'),\r\n                link: `https://246.swcb.gov.tw/Content/Debris/${data.get('Debrisno')}.jpg`\r\n            }\r\n\r\n        }\r\n\r\n        function getRockfall(data) {\r\n            return {\r\n                activity: data.get('ACTIVITY'),\r\n                slideKind: data.get('SLIDE_KIND'),\r\n                slideType: data.get('SLOPE_TYPE'),\r\n                slideAng: data.get('SLUMP_ANG'),\r\n                identifier: data.get('IDENTIFIER')\r\n            }\r\n\r\n        }\r\n\r\n        async function initialize(popup) {\r\n            if (popup == null) {\r\n                state.type = 0\r\n                this.props?.closeAreaData()\r\n                return\r\n            }\r\n\r\n            if (popup.popupData == \"新竹縣原住民部落範圍\") {\r\n                getTribeData(popup.popupId).then((result) => {\r\n                    state.type = 1\r\n                    state.tribeData = result\r\n                }).then(() => {\r\n                    state.showAreaDataWindow = true\r\n                })\r\n                return\r\n            }\r\n            if (popup.popupData == \"近年歷史災害82處部落點位\") {\r\n                getDisasterData(`近年歷史災害82處部落點位.${popup.popupId}`).then((result) => {\r\n                    state.type = 2\r\n                    state.tribeData = result.data\r\n                }).then(() => {\r\n                    state.showAreaDataWindow = true\r\n                })\r\n                return\r\n            }\r\n            if (popup.popupData == \"雨量站\") {\r\n                getRainfallStation(popup.popupId).then((result) => {\r\n                    state.type = 3\r\n                    if (result.data !== null) {\r\n                        state.tribeData = result.data\r\n                    }\r\n                }).then(() => {\r\n                    state.showAreaDataWindow = true\r\n                })\r\n                return\r\n            }\r\n            if (popup.popupData == \"工程鑽探\") {\r\n                console.log('搜尋工程鑽探')\r\n                console.log(popup.coordinate)\r\n                getHarvestDrill(popup.popupId).then((result) => {\r\n                    state.type = 4\r\n                    if (result.data !== null) {\r\n                        state.harvestDrill = result.data\r\n                        state.coordinate = popup.coordinate\r\n                    }\r\n                }).then(() => {\r\n                    state.showAreaDataWindow = true\r\n                })\r\n                return\r\n            }\r\n            if (popup.popupData == \"土石流潛勢溪流\") {\r\n                state.type = 5\r\n                state.potentialDebrisFlowTorrent = getPotentialDebrisFlowTorrent(props.popup.temp)\r\n                state.showAreaDataWindow = true\r\n                return\r\n            }\r\n\r\n            if (popup.popupData == \"落石分布\") {\r\n                state.type = 6\r\n                state.rockfall = getRockfall(popup.temp)\r\n                state.showAreaDataWindow = true\r\n                return\r\n            }\r\n        }\r\n\r\n\r\n        onMounted(() => {\r\n            initialize(props.popup)\r\n            state.oldPopupId = props.popup.popupId\r\n        })\r\n        onUpdated(() => {\r\n            if (state.oldPopupId === props.popup.popupId) return;\r\n            initialize(props.popup)\r\n            state.oldPopupId = props.popup.popupId\r\n        })\r\n\r\n        return {\r\n            router,\r\n            props,\r\n            state,\r\n        }\r\n    }\r\n}\r\n\r\n</script>\r\n\r\n<template>\r\n    <div class=\"bg-white rounded py-2\" style=\"overflow-y: auto;\" v-if=\"state.showAreaDataWindow\" :style=\"{\r\n        'max-height': props.maxHeight + 'px',\r\n    }\">\r\n        <div v-if=\"state.type === 1\">\r\n            <div class=\"row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold\">\r\n                <p>詳細資訊</p>\r\n                <!-- TODO: 關閉事件 -->\r\n                <div class=\"position-absolute col-auto end-0 cursor-pointer\" style=\"top: 10px;\"\r\n                    @click=\"props.closeAreaData\">\r\n                    <svg width=\"32\" height=\"32\" viewBox=\"0 0 24 24\">\r\n                        <path fill=\"currentColor\"\r\n                            d=\"M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10zm0-11.414L9.172 7.757L7.757 9.172L10.586 12l-2.829 2.828l1.415 1.415L12 13.414l2.828 2.829l1.415-1.415L13.414 12l2.829-2.828l-1.415-1.415L12 10.586z\" />\r\n                    </svg>\r\n                </div>\r\n            </div>\r\n            <areaImg :coordinate=\"props.popup.coordinate\" :type=\"state.type\" />\r\n            <div class=\"row mx-0 align-items-center p-2 position-relative\">\r\n                <div class=\"d-flex flex-nowrap align-items-center justify-content-between my-2\">\r\n                    <span>{{ state.tribeData?.basicInformation?.tribeName }} </span>\r\n                    <div class=\"p-2 bg-steel w-auto text-white d-inline-block rounded-2 cursor-pointer\" @click=\"() => {\r\n                        router.push({\r\n                            name: 'detail',\r\n                            params: {\r\n                                id: props.popup.popupId\r\n                            },\r\n                        })\r\n                    }\">更多資訊</div>\r\n                </div>\r\n                <p>描述: {{ state.tribeData?.basicInformation?.description }}</p>\r\n\r\n                <p>{{ state.tribeData?.basicInformation?.area }}</p>\r\n                <a href=\"#\">\r\n                    <img src=\"@/assets/img/icon/vector.svg\" alt=\"\">\r\n                    {{ state.tribeData?.basicInformation?.coordinates?.WGS84?.lat }}\r\n                    ,\r\n                    {{ state.tribeData?.basicInformation?.coordinates?.WGS84?.lng }}\r\n                </a>\r\n            </div>\r\n            <div>\r\n                <div class=\"border-bottom row flex-nowrap p-2 my-3 cursor-pointer mx-0\">\r\n                    <div class=\"col-6 cursor-pointer\" @click=\"state.media = 'photo'\">相片</div>\r\n                    <div class=\"col-6 cursor-pointer\" @click=\"state.media = 'video'\">影片</div>\r\n                </div>\r\n                <div class=\"py-2 px-4\" v-if=\"state.media === 'photo'\">\r\n                    <div class=\"d-flex flex-wrap justify-content-between\">\r\n                        <div class=\"w-50 mb-4\" v-for=\"item in state?.tribeData?.culturalLandscape\">\r\n                            <p class=\"mb-0\">{{ item.name }}</p>\r\n                            <img :src=\"item.image\" alt=\"\" class=\"w-100\">\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class=\"py-2 px-4\" v-if=\"state.media === 'video'\">\r\n                    <div>尚無影片</div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div v-if=\"state.type === 2\">\r\n            <div class=\"row mx-0 align-items-center px-2 py-4 position-relative\">\r\n                <div class=\"row mx-0 mb-2\" v-if=\"state.tribeData.event\">\r\n                    <div class=\"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center\">事件:\r\n                    </div>\r\n                    <div class=\"col-8 py-1 px-2 bg-grey-light text-start\">{{ state.tribeData.event }}</div>\r\n                </div>\r\n                <div class=\"row mx-0 mb-2\" v-if=\"state.tribeData.date\">\r\n                    <div class=\"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center\">發生時間:\r\n                    </div>\r\n                    <div class=\"col-8 py-1 px-2 bg-grey-light text-start\">{{ state.tribeData.date }}</div>\r\n                </div>\r\n                <div class=\"row mx-0 mb-2\" v-if=\"state.tribeData.township\">\r\n                    <div class=\"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center\">鄉鎮:\r\n                    </div>\r\n                    <div class=\"col-8 py-1 px-2 bg-grey-light text-start\">{{ state.tribeData.township }}</div>\r\n                </div>\r\n                <div class=\"row mx-0 mb-2\" v-if=\"state.tribeData.village\">\r\n                    <div class=\"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center\">地方:\r\n                    </div>\r\n                    <div class=\"col-8 py-1 px-2 bg-grey-light text-start\">{{ state.tribeData.village }}</div>\r\n                </div>\r\n                <div class=\"row mx-0 mb-2\" v-if=\"state.tribeData.place\">\r\n                    <div class=\"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center\">村落:\r\n                    </div>\r\n                    <div class=\"col-8 py-1 px-2 bg-grey-light text-start\">{{ state.tribeData.place }}</div>\r\n                </div>\r\n                <div class=\"row mx-0 mb-2\" v-if=\"state.tribeData.category\">\r\n                    <div class=\"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center\">災害種類:\r\n                    </div>\r\n                    <div class=\"col-8 py-1 px-2 bg-grey-light text-start\">{{ state.tribeData.category }}</div>\r\n                </div>\r\n                <div class=\"row mx-0 mb-2\" v-if=\"state.tribeData.description\">\r\n                    <div class=\"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center\">描述:\r\n                    </div>\r\n                    <div class=\"col-8 py-1 px-2 bg-grey-light text-start\">{{ state.tribeData.description }}</div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div v-if=\"state.type === 3\">\r\n            <div class=\"p-2 p-sm-3\">\r\n                <p class=\"text-start px-0 fw-bold\">雨量站</p>\r\n                <hr>\r\n                <div class=\"p-0 p-sm-2\">\r\n                    <p>觀測時間: {{ state.tribeData?.viewDatetime }}</p>\r\n                    <p>單位:mm </p>\r\n                    <table class=\"rainfall border-bottom border-grey w-100\">\r\n                        <thead>\r\n                            <tr class=\"text-center\">\r\n                                <td class=\"bg-blueDeep text-white border border-white p-2\">10分鐘</td>\r\n                                <td class=\"bg-blueDeep text-white border border-white p-2\">時雨量</td>\r\n                                <td class=\"bg-blueDeep text-white border border-white p-2\">3小時</td>\r\n                                <td class=\"bg-blueDeep text-white border border-white p-2\">6小時</td>\r\n                                <td class=\"bg-blueDeep text-white border border-white p-2\">12小時</td>\r\n                                <td class=\"bg-blueDeep text-white border border-white p-2\">24小時</td>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                            <tr class=\"text-center\">\r\n                                <td class=\"p-2\">{{ state.tribeData?.min_10 }}</td>\r\n                                <td class=\"p-2\">{{ state.tribeData?.hour_1 }}</td>\r\n                                <td class=\"p-2\">{{ state.tribeData?.hour_3 }}</td>\r\n                                <td class=\"p-2\">{{ state.tribeData?.hour_6 }}</td>\r\n                                <td class=\"p-2\">{{ state.tribeData?.hour_12 }}</td>\r\n                                <td class=\"p-2\">{{ state.tribeData?.hour_24 }}</td>\r\n                            </tr>\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div v-if=\"state.type === 4\">\r\n            <div class=\"row mx-0 align-items-center px-2 py-4 position-relative\">\r\n                <div class=\"row mx-0 mb-2\" v-if=\"state.harvestDrill.projNo\">\r\n                    <div class=\"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center\">計畫編號:\r\n                    </div>\r\n                    <div class=\"col-8 py-1 px-2 bg-grey-light text-start\">{{ state.harvestDrill.projNo }}</div>\r\n                </div>\r\n                <div class=\"row mx-0 mb-2\" v-if=\"state.harvestDrill.projName\">\r\n                    <div class=\"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center\">計畫名稱:\r\n                    </div>\r\n                    <div class=\"col-8 py-1 px-2 bg-grey-light text-start\">{{ state.harvestDrill.projName }}</div>\r\n                </div>\r\n                <div class=\"row mx-0 mb-2\" v-if=\"state.harvestDrill.exename\">\r\n                    <div class=\"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center\">執行單位:\r\n                    </div>\r\n                    <div class=\"col-8 py-1 px-2 bg-grey-light text-start\">{{ state.harvestDrill.exename }}</div>\r\n                </div>\r\n                <div class=\"row mx-0 mb-2\" v-if=\"state.harvestDrill.orgname\">\r\n                    <div class=\"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center\">委託單位:\r\n                    </div>\r\n                    <div class=\"col-8 py-1 px-2 bg-grey-light text-start\">{{ state.harvestDrill.orgname }}</div>\r\n                </div>\r\n                <div class=\"row mx-0 mb-2\" v-if=\"state.harvestDrill.drillHoleCount\">\r\n                    <div class=\"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center\">孔:\r\n                    </div>\r\n                    <div class=\"col-8 py-1 px-2 bg-grey-light text-start\">{{ state.harvestDrill.drillHoleCount }}</div>\r\n                </div>\r\n                <div class=\"row mx-0 mb-2\">\r\n                    <div class=\"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center\">連結:\r\n                    </div>\r\n                    <a :href=\"'https://geotech.gsmma.gov.tw/imoeagis/Home/Map?' + 'lng=' + state.coordinate[0] + '&lat=' + state.coordinate[1]\"\r\n                        class=\"col-8 py-1 px-2 bg-grey-light text-start\">\r\n                        網址鏈接\r\n                    </a>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div v-if=\"state.type === 5\">\r\n            <div class=\"row mx-0 align-items-center px-2 py-4 position-relative\">\r\n                <div class=\"row mx-0 mb-2\" v-if=\"state.potentialDebrisFlowTorrent.basic\">\r\n                    <div class=\"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center\">主流:\r\n                    </div>\r\n                    <div class=\"col-8 py-1 px-2 bg-grey-light text-start\">{{ state.potentialDebrisFlowTorrent.basic }}</div>\r\n                </div>\r\n                <div class=\"row mx-0 mb-2\" v-if=\"state.potentialDebrisFlowTorrent.full\">\r\n                    <div class=\"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center\">位置:\r\n                    </div>\r\n                    <div class=\"col-8 py-1 px-2 bg-grey-light text-start\">{{ state.potentialDebrisFlowTorrent.full }}</div>\r\n                </div>\r\n                <div class=\"row mx-0 mb-2\" v-if=\"state.potentialDebrisFlowTorrent.risk\">\r\n                    <div class=\"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center\">風險程度:\r\n                    </div>\r\n                    <div class=\"col-8 py-1 px-2 bg-grey-light text-start\">{{ state.potentialDebrisFlowTorrent.risk }}</div>\r\n                </div>\r\n                <div class=\"row mx-0 mb-2\" v-if=\"state.potentialDebrisFlowTorrent.note01\">\r\n                    <div class=\"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center\">筆記1:\r\n                    </div>\r\n                    <div class=\"col-8 py-1 px-2 bg-grey-light text-start\">{{ state.potentialDebrisFlowTorrent.note01 }}\r\n                    </div>\r\n                </div>\r\n                <div class=\"row mx-0 mb-2\" v-if=\"state.potentialDebrisFlowTorrent.note02\">\r\n                    <div class=\"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center\">筆記2:\r\n                    </div>\r\n                    <div class=\"col-8 py-1 px-2 bg-grey-light text-start\">{{ state.potentialDebrisFlowTorrent.note02 }}\r\n                    </div>\r\n                </div>\r\n\r\n                <div class=\"row mx-0 mb-2\" v-if=\"state.potentialDebrisFlowTorrent.link\">\r\n                    <div class=\"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center\">連結:\r\n                    </div>\r\n                    <a :href=\"state.potentialDebrisFlowTorrent.link\" class=\"col-8 py-1 px-2 bg-grey-light text-start\">\r\n                        網址鏈接\r\n                    </a>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div v-if=\"state.type === 6\">\r\n            <div class=\"row mx-0 align-items-center px-2 py-4 position-relative\">\r\n                <div class=\"row mx-0 mb-2\" v-if=\"state.rockfall.activity\">\r\n                    <div class=\"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center\">活動:\r\n                    </div>\r\n                    <div class=\"col-8 py-1 px-2 bg-grey-light text-start\">{{ state.rockfall.activity }}</div>\r\n                </div>\r\n                <div class=\"row mx-0 mb-2\" v-if=\"state.rockfall.slideKind\">\r\n                    <div class=\"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center\">種類:\r\n                    </div>\r\n                    <div class=\"col-8 py-1 px-2 bg-grey-light text-start\">{{ state.rockfall.slideKind }}</div>\r\n                </div>\r\n                <div class=\"row mx-0 mb-2\" v-if=\"state.rockfall.slideType\">\r\n                    <div class=\"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center\">類型:\r\n                    </div>\r\n                    <div class=\"col-8 py-1 px-2 bg-grey-light text-start\">{{ state.rockfall.slideType }}</div>\r\n                </div>\r\n                <div class=\"row mx-0 mb-2\" v-if=\"state.rockfall.slideAng\">\r\n                    <div class=\"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center\">坡度:\r\n                    </div>\r\n                    <div class=\"col-8 py-1 px-2 bg-grey-light text-start\">{{ state.rockfall.slideAng }}</div>\r\n                </div>\r\n                <div class=\"row mx-0 mb-2\" v-if=\"state.rockfall.identifier\">\r\n                    <div class=\"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center\">記錄者:\r\n                    </div>\r\n                    <div class=\"col-8 py-1 px-2 bg-grey-light text-start\">{{ state.rockfall.identifier }}</div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<style lang=\"sass\" scoped>\r\n@import '@/assets/styles/all.module.scss'\r\n@media (max-width:600px)\r\n    .rainfall\r\n        td\r\n            font-size: 12px\r\n</style>\r\n","export default \"__VITE_ASSET__a5f6138f__\"","export default \"__VITE_ASSET__4fd4ec4f__\"","export default \"__VITE_ASSET__2736ec62__\"","export default \"__VITE_ASSET__f256a0d2__\"","export default \"__VITE_ASSET__39236d8e__\"","export default \"__VITE_ASSET__797f4095__\"","<script>\r\nimport { useSlots, onBeforeMount, onMounted, onBeforeUnmount, ref, reactive, computed, watch, nextTick, defineAsyncComponent, useCssModule, inject } from 'vue'\r\nimport $ from 'jquery'\r\n\r\nexport default {\r\n    props: {\r\n        currentLayers: {\r\n            type: Array,\r\n            default: []\r\n        },\r\n        mapCount: {\r\n            type: Number,\r\n            default: 1\r\n        },\r\n        dimensionMapStatus: {\r\n            type: Boolean,\r\n            default: false\r\n        },\r\n        openConditionWrap: {\r\n            type: Function,\r\n            default: () => {}\r\n        },\r\n        openLayerSelect: {\r\n            type: Function,\r\n            default: () => {}\r\n        },\r\n        onLayerControl: {\r\n            type: Function,\r\n            default: () => {}\r\n        },\r\n        onChangeMapCount: {\r\n            type: Function,\r\n            default: ()=>{}\r\n        },\r\n    },\r\n    setup(props, { emit }) {\r\n        const state = reactive({\r\n            toolSwitch: {\r\n                threeDimensionalBtn: false,\r\n                layerConditionBtn: false,\r\n                splitWindowBtn: false,\r\n            },\r\n            targetNum: 1,\r\n        })\r\n\r\n        function toolSwitch(target, value) {\r\n            // 其他全部關掉\r\n            Object.keys(state.toolSwitch).forEach(node => {\r\n                if (node === target) {\r\n                    if(state.toolSwitch[target]) {\r\n                        state.toolSwitch[target] = false\r\n                    } else {\r\n                        state.toolSwitch[target] = true\r\n                    }\r\n                } else {\r\n                    state.toolSwitch[node] = false\r\n                }\r\n            })\r\n        }\r\n        function onLayerControl(action, value) {\r\n            if (action === 'changeMapCount') {\r\n                state.toolSwitch['splitWindowBtn'] = false\r\n            }\r\n            props.onLayerControl({ action, value })\r\n        }\r\n\r\n        function conditionWrap() {\r\n            emit('conditionWrap')\r\n        }\r\n\r\n        // TODO: 手機板打開燈箱點擊燈箱外關閉\r\n\r\n        return {\r\n            props,\r\n            state,\r\n            toolSwitch,\r\n            onLayerControl,\r\n            conditionWrap,\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<template>\r\n    <div class=\"w-100\">\r\n        <!-- <div class=\"position-fixed top-0 w-100 px-3 mt-3 d-flex justify-content-between justify-content-sm-end flex-wrap\"> -->\r\n            <!-- <img src=\"@/assets/logo.svg\" class=\"w-50 w-lg-100\"> -->\r\n            <!-- <mapSourceOption class=\"mapSourceOption d-none d-sm-block\"\r\n                :baseMapList=\"state.temp.baseMapList\"\r\n                :onChangeBaseMaps=\"({ action, value }) => {\r\n                    layerControl({ action, value })\r\n                }\" /> -->\r\n        <!-- </div> -->\r\n\r\n        <ul class=\"list-unstyled d-flex align-items-center justify-content-around h-100 flex-nowrap w-100 bg-white mb-0\">\r\n            <li>\r\n                <div>\r\n                    <div class=\"navbarBtn\" v-if=\"props.dimensionMapStatus\"\r\n                    @click.prevent=\"toolSwitch('threeDimensionalBtn'), onLayerControl('changeDimensionMap', '3D')\">\r\n                        <img src=\"@/assets/img/icon/2D-m.svg\">\r\n                    </div>\r\n                    <div class=\"navbarBtn\" v-else\r\n                    @click.prevent=\"toolSwitch('threeDimensionalBtn'), onLayerControl('changeDimensionMap', '2D')\">\r\n                        <img src=\"@/assets/img/icon/3D-m.svg\">\r\n                    </div>\r\n                </div>\r\n            </li>\r\n            <li>\r\n                <div class=\"navbarBtn\" @click=\"props.openConditionWrap()\">\r\n                    <img src=\"@/assets/img/icon/vector-m.svg\">\r\n                </div>\r\n            </li>\r\n            <li>\r\n                <div class=\"navbarBtn\" @click=\"props.openLayerSelect()\">\r\n                    <img src=\"@/assets/img/icon/selectVector-m.svg\">\r\n                </div>\r\n            </li>\r\n            <li>\r\n                <div class=\"text-white\">\r\n                    <div class=\"navbarBtn\" v-if=\"props.mapCount === 1\" @click.prevent=\"props.onChangeMapCount(2)\">\r\n                        <img src=\"@/assets/img/icon/singleWindow-m.svg\">\r\n                    </div>\r\n                    <div class=\"navbarBtn\" v-if=\"props.mapCount === 2\" @click.prevent=\"props.onChangeMapCount(1)\">\r\n                        <img src=\"@/assets/img/icon/doubleWindow-m.svg\">\r\n                    </div>\r\n                </div>\r\n            </li>\r\n        </ul>\r\n    </div>\r\n</template>\r\n\r\n<style lang=\"sass\">\r\nul\r\n    li\r\n        .navbarBtn\r\n            width: 60px\r\n            height: 60px\r\n            img\r\n                width: 100%\r\n                height: 100%\r\n        &:nth-Child(1) .navbarBtn, &:nth-Child(4) .navbarBtn\r\n            width: 50px\r\n            height: 50px\r\n</style>","export default \"__VITE_ASSET__77deec8d__\"","export default \"__VITE_ASSET__c678c661__\"","export default \"__VITE_ASSET__3744c808__\"","export default \"__VITE_ASSET__52eecc49__\"","export default \"__VITE_ASSET__083761bd__\"","<script>\r\nimport { useSlots, onBeforeMount, onMounted, onBeforeUnmount, ref, reactive, computed, watch, nextTick, defineAsyncComponent, useCssModule, inject } from 'vue'\r\nimport $ from 'jquery'\r\nimport { Layer } from 'ol/layer'\r\n\r\nexport default {\r\n    props: {\r\n        onClose: {\r\n            type: Function,\r\n            default: ()=>{}\r\n        },\r\n        onDeleteLayer: {\r\n            type: Function,\r\n            default: ()=>{}\r\n        },\r\n        onLockLayer: {\r\n            type: Function,\r\n            default: ()=>{}\r\n        },\r\n        currentLayers: {\r\n            type: Array,\r\n            default: []\r\n        },\r\n        selectLock: {\r\n            type: Boolean,\r\n            default: false\r\n        },\r\n        onLayerControl: {\r\n            type: Function,\r\n            default: ()=>{}\r\n        }\r\n    },\r\n    setup(props, { emit }) {\r\n        const state = reactive({})\r\n        function updateOpacity(e){\r\n            props.onLayerControl({\r\n                action: 'setOpacity',\r\n                value: {\r\n                    key: e.target.getAttribute('nodeindex'),\r\n                    value: e.target.value,\r\n                }\r\n            })\r\n            const opacity = parseFloat(Number(e.target.value))\r\n            document.getElementById(`opacityControl${ e.target.getAttribute('nodeindex') }`).innerText = opacity.toFixed(2)\r\n        }\r\n\r\n        return {\r\n            props,\r\n            state,\r\n            updateOpacity\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<template>\r\n    <div class=\"layerSelect bg-white\">\r\n        <div class=\"row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold\">\r\n            <p class=\"mb-0 fs-5\">已選擇的圖層</p>\r\n            <a href=\"#\" class=\"closeBtn bg-dark text-decoration-none rounded-circle position-absolute d-flex align-items-center justify-content-center\" @click.prevent=\"props.onClose\"></a>\r\n        </div>\r\n        <hr class=\"my-0\">\r\n        <div class=\"py-3 px-4 content\" style=\"overflow-y: scroll;max-height: 40vh;\">\r\n            <div class=\"allControl d-flex align-items-center justify-content-end mb-0\">\r\n                <a href=\"\" class=\"d-flex align-items-center text-decoration-none me-3\"\r\n                :class=\"{'lockUp': props.selectLock, 'unlock': !props.selectLock}\"\r\n                @click.prevent=\"()=>{\r\n                    props.onLockLayer()\r\n                }\">\r\n                    <img src=\"../assets/img/icon/lockOpen.svg\" alt=\"\">\r\n                    鎖定圖層\r\n                </a>\r\n                <a href=\"\" class=\"d-flex align-items-center text-decoration-none\"\r\n                :class=\"{'disabled':props.currentLayers.length <= 1}\"\r\n                @click.prevent=\"()=>{\r\n                    if (props.currentLayers.length > 0) {\r\n                        props.onDeleteLayer({\r\n                            action: 'selectLayerMode',\r\n                            value: {\r\n                                layerName: 'all'\r\n                            }\r\n                        })\r\n                    }\r\n                }\">\r\n                    <img src=\"../assets/img/icon/deleteLayer.svg\" alt=\"\">\r\n                    全部取消\r\n                </a>\r\n            </div>\r\n            <ul class=\"list-unstyled d-flex flex-wrap flex-column-reverse\">\r\n                <li v-for=\"(node, nodeIndex) in props.currentLayers\">\r\n                    <div class=\"d-flex justify-content-between align-items-center border-bottom py-2 flex-wrap\" v-if=\"node.id\">\r\n                        <div>\r\n                            {{ node?.label }}\r\n                        </div>\r\n                        <div class=\"tool\">\r\n                            <a href=\"\"\r\n                            @click.prevent=\"props.onLayerControl({\r\n                                action: 'changeOrder',\r\n                                value: {\r\n                                    movement:'up',\r\n                                    id: node.id,\r\n                                    key: nodeIndex\r\n                                },\r\n                            })\">\r\n                                <img src=\"../assets/img/icon/arrow_up.svg\" alt=\"\">\r\n                            </a>\r\n                            <a href=\"\"\r\n                            @click.prevent=\"props.onLayerControl({\r\n                                action: 'changeOrder',\r\n                                value: {\r\n                                    movement: 'down',\r\n                                    id: node.id,\r\n                                    key: nodeIndex\r\n                                }\r\n                            })\">\r\n                                <img src=\"../assets/img/icon/arrow_down.svg\" alt=\"\">\r\n                            </a>\r\n                            <a href=\"\"\r\n                            :class=\"{\r\n                                'Invisible': !node?.visible\r\n                            }\"\r\n                            @click.prevent=\"()=>{\r\n                                props.onLayerControl({\r\n                                    action: 'changeLayerVisible',\r\n                                    value: {\r\n                                        key: nodeIndex,\r\n                                    }\r\n                                })\r\n                            }\">\r\n                                <img src=\"../assets/img/icon/eyes.svg\" alt=\"\">\r\n                            </a>\r\n                            <a href=\"\"\r\n                            @click.prevent=\"props.onDeleteLayer({\r\n                                action: 'selectLayerMode',\r\n                                value: {\r\n                                    id: node?.id,\r\n                                }\r\n                            })\">\r\n                                <img src=\"../assets/img/icon/deleteLayer.svg\" alt=\"\">\r\n                            </a>\r\n                        </div>\r\n                        <label class=\"w-100 mt-2 d-flex align-items-center\">\r\n                            <input id=\"opacity-input\" class=\"w-75 me-2\" type=\"range\" min=\"0\" max=\"1\" step=\"0.01\" value=\"1\" :nodeIndex=\"nodeIndex\" @input=\"updateOpacity\" />\r\n                            <span :id=\"`opacityControl${ nodeIndex }`\">1</span>\r\n                        </label>\r\n                    </div>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<style lang=\"sass\" scoped>\r\n@import '@/assets/styles/all.module.scss'\r\n.layerSelect\r\n    border-radius: 10px\r\n.closeBtn\r\n    right:10px\r\n    width: 20px\r\n    height: 20px\r\n    padding: 0\r\n    &::after\r\n        content: ''\r\n        background: #fff\r\n        height: 2px\r\n        width: 60%\r\n        display: block\r\n.content\r\n    .title\r\n        cursor: pointer\r\n        svg\r\n            transform: rotateZ(0)\r\n        .openTitle\r\n            transform: rotateZ(90deg)\r\n    svg, img\r\n        width: 28px\r\n        height: 28px\r\n.tool\r\n    a\r\n        padding: 5px 0\r\n    .visible\r\n        color: red\r\n    .Invisible\r\n        color: blue\r\n        position: relative\r\n        &::after\r\n            content: ''\r\n            position: absolute\r\n            top: 55%\r\n            left: 20%\r\n            width: 60%\r\n            height: 2px\r\n            background: $grey\r\n            transform-origin: 50% 50%\r\n            transform: rotateZ(45deg)\r\n            display: block\r\n.allControl\r\n    a\r\n        color: $grey\r\n    .lockUp\r\n        color: #247BA0\r\n    .unlock\r\n        color: $grey\r\n\r\n@media (max-width: 600px)\r\n    .layerSelect\r\n        border-radius: 0\r\n</style>\r\n","<script>\r\nimport { useSlots, onBeforeMount, onMounted, onBeforeUnmount, ref, reactive, computed, watch, nextTick, defineAsyncComponent, useCssModule, inject } from 'vue'\r\nimport $ from 'jquery'\r\nimport router from '@/router/index.js'\r\nimport { useStore } from 'vuex'\r\n\r\nexport default {\r\n    props: {\r\n        text: {\r\n            type: String,\r\n            default: '測試'\r\n        },\r\n        styles: {\r\n            type: String,\r\n            default: ''\r\n        },\r\n        status: {\r\n            type: Boolean,\r\n            default: true\r\n        }\r\n    },\r\n    setup(props, { emit }) {\r\n        const store = useStore()\r\n        const route = router\r\n\r\n        // 透過ref綁定此元件，元件再以position的方式黏貼在父層上，在抓取此元件寬高做出白邊線效果\r\n        const overLayCom = ref(null)\r\n\r\n        const state = reactive({\r\n            overLayerHeight: computed(()=>{\r\n                return overLayCom?.value?.offsetHeight + 10\r\n            }),\r\n            overLayerWidth: computed(()=>{\r\n                return overLayCom?.value?.offsetWidth + 10\r\n            }),\r\n            accordionListRef: null,\r\n            accordionListRefHeight: computed(()=>{\r\n                return state.accordionListRef?.offsetHeight\r\n            }),\r\n            accordionListRefWidth: computed(()=>{\r\n                return state.accordionListRef?.offsetWidth\r\n            })\r\n        })\r\n\r\n        onMounted(()=>{\r\n            $('.initOverLay').parent().addClass('position-relative')\r\n        })\r\n        return {\r\n            state,\r\n            props,\r\n            store,\r\n            route,\r\n            overLayCom,\r\n        }\r\n    }\r\n}\r\n</script>\r\n<template>\r\n    <div class=\"initOverLay\"\r\n    v-if=\"store.state.isInit\"\r\n    @click=\"store.dispatch('updateLayerStatus', false)\"\r\n    :style=\"{\r\n        height: state.overLayerHeight + 'px',\r\n        width: state.overLayerWidth + 'px',\r\n    }\"\r\n    :ref=\"(e) => {\r\n        state.accordionListRef = e\r\n    }\">\r\n        <div class=\"tipText text-white fw-bold fs-3\"\r\n        :style=\"props.styles\"\r\n        >{{ props.text }}</div>\r\n    </div>\r\n</template>\r\n<style lang=\"sass\">\r\n.initOverLay\r\n    position: absolute\r\n    top: -5px\r\n    left: -5px\r\n    width: calc(100% + 10px)\r\n    height: calc(100% + 10px)\r\n    border: 3px solid #fff\r\n    z-index: 99999\r\n.tipText\r\n    position: absolute\r\n    top: 100%\r\n    width: 300px\r\n</style>","// import $ from 'jquery'\r\nimport { Map, View, Feature } from 'ol' // 引入容器绑定模塊和視圖模塊\r\nimport VectorSource from 'ol/source/Vector.js'\r\nimport { Tile, Tile as TileLayer, Image as ImageLayer, Vector, Vector as VectorLayer } from 'ol/layer.js'\r\nimport TileWMS from 'ol/source/TileWMS.js'\r\nimport { bbox, tile } from 'ol/loadingstrategy.js'\r\nimport GeoJSON from 'ol/format/GeoJSON.js'\r\nimport { Circle, Polygon, Point } from 'ol/geom.js'\r\nimport { Icon, Fill, Stroke, Style } from 'ol/style.js'\r\nimport ImageWMS from 'ol/source/ImageWMS.js'\r\nimport Static from 'ol/source/ImageStatic.js'\r\n\r\nimport TilegridWMTS from 'ol/tilegrid/WMTS'\r\n\r\nimport { createXYZ } from 'ol/tilegrid.js'\r\nimport WMTS from 'ol/source/WMTS'\r\nimport { get as getProjection } from 'ol/proj'\r\nimport { getTopLeft, getWidth } from 'ol/extent.js'\r\n\r\nimport 'ol/ol.css' // ol提供的css样式\r\n\r\nimport proj4 from 'proj4'\r\nimport { register } from 'ol/proj/proj4.js'\r\nproj4.defs(\r\n    'EPSG:3826',\r\n    '+proj=tmerc +lat_0=0 +lon_0=121 +k=0.9999 +x_0=250000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +type=crs'\r\n)\r\nregister(proj4)\r\n\r\nexport default {\r\n    getLayer: (layer, nestedSubNodeIndex, id) => {\r\n        let result, layerSource\r\n        const layerType = layer.layer_type\r\n        const figureType = layer.figure_type\r\n        const tileTitle = layer.single_tiles ? '' : `- ${layer.tiles_list[nestedSubNodeIndex]?.title}`\r\n        const request = []\r\n        if (layerType === 'WMS'){\r\n            const url = layer.single_tiles ? layer.tiles_url : layer.tiles_list[nestedSubNodeIndex].tile_url\r\n            switch (figureType){\r\n                case 'Point':\r\n                    if (url){\r\n                        const api = new URL(url)\r\n                        // 取得網址部分\r\n                        const origin = api.origin\r\n                        const pathname = api.pathname\r\n\r\n                        // 取得query參數\r\n                        const searchParams = api.searchParams\r\n                        const searchParamsObject = {}\r\n                        for (const [key, value] of searchParams.entries()){\r\n                            searchParamsObject[key] = value\r\n                        }\r\n                        request[0] = origin + pathname\r\n                        request[1] = searchParamsObject\r\n                    }\r\n                    layerSource = new TileWMS({\r\n                        maxzoom: 18,\r\n                        minzoom: 3,\r\n                        url: request[0],\r\n                        params: request[1],\r\n                        serverType: 'mapserver',\r\n                        crossOrigin: 'anonymous',\r\n                    })\r\n                    break\r\n                case 'Surface':\r\n                    if (url){\r\n                        const api = new URL(url)\r\n                        // 取得網址部分\r\n                        const origin = api.origin\r\n                        const pathname = api.pathname\r\n\r\n                        // 取得query參數\r\n                        const searchParams = api.searchParams\r\n                        const searchParamsObject = {}\r\n                        for (const [key, value] of searchParams.entries()){\r\n                            searchParamsObject[key] = value\r\n                        }\r\n                        request[0] = origin + pathname\r\n                        request[1] = searchParamsObject\r\n                    }\r\n                    layerSource = new TileWMS({\r\n                        maxzoom: 18,\r\n                        minzoom: 3,\r\n                        url: request[0],\r\n                        params: request[1],\r\n                        serverType: 'mapserver'\r\n                    })\r\n                    break\r\n                case 'Line':\r\n                    // 活動斷層\r\n                    if (url){\r\n                        const api = new URL(url)\r\n                        // 取得網址部分\r\n                        const origin = api.origin\r\n                        const pathname = api.pathname\r\n\r\n                        // 取得query參數\r\n                        const searchParams = api.searchParams\r\n                        const searchParamsObject = {}\r\n                        for (const [key, value] of searchParams.entries()){\r\n                            searchParamsObject[key] = value\r\n                        }\r\n                        request[0] = origin + pathname\r\n                        request[1] = searchParamsObject\r\n                    }\r\n                    layerSource = new TileWMS({\r\n                        maxzoom: 18,\r\n                        minzoom: 3,\r\n                        url: request[0],\r\n                        params: request[1],\r\n                        serverType: 'mapserver'\r\n                    })\r\n                    break\r\n                default:\r\n                    console.log('error-otherWMSLayer:', figureType)\r\n            }\r\n            result = new TileLayer({\r\n                id,\r\n                label: `${layer.title}${tileTitle}`,\r\n                // minZoom: 4,\r\n                // maxZoom: 18,\r\n                source: new TileWMS({\r\n                    name: layer.title,\r\n                    url: layerSource.getUrls()[0],\r\n                    params: layerSource.getParams(),\r\n                    serverType: 'geoserver',\r\n                    crossOrigin: 'anonymous',\r\n                    projection: layerSource.getParams()?.SRS,\r\n                }),\r\n                style: 'default',\r\n                maxZoom: 20,\r\n            })\r\n        }\r\n\r\n        if (layerType === 'WMTS'){\r\n            switch (figureType){\r\n                case 'Surface':\r\n                    // FIX: 匯出會變成gif\r\n                    const projection = 'EPSG:3857'\r\n                    const projectionExtent = [-20037508.342789244, -20037508.342789244, 20037508.342789244, 20037508.342789244]\r\n                    const matrixIds = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]\r\n                    const resolutions = [156543.03392804097, 78271.51696402048, 39135.75848201024, 19567.87924100512, 9783.93962050256, 4891.96981025128, 2445.98490512564, 1222.99245256282, 611.49622628141, 305.748113140705, 152.8740565703525, 76.43702828517625, 38.21851414258813, 19.109257071294063, 9.554628535647032, 4.777314267823516, 2.388657133911758, 1.194328566955879, 0.5971642834779395, 0.29858214173896974, 0.14929107086948487]\r\n                    layerSource = new WMTS({\r\n                        url: layer.tiles_url,\r\n                        layer: layer.name,\r\n                        requestEncoding: 'REST',\r\n                        matrixSet: 'GoogleMapsCompatible',\r\n                        format: 'image/png',\r\n                        transparente: true,\r\n                        projection,\r\n                        tileGrid: new TilegridWMTS({\r\n                            origin: getTopLeft(projectionExtent),\r\n                            matrixIds,\r\n                            resolutions\r\n                        }),\r\n                        style: 'default',\r\n                        maxZoom: 20,\r\n                    })\r\n\r\n                    result = new TileLayer({\r\n                        name: layer.name,\r\n                        id,\r\n                        label: `${layer.title}${tileTitle}`,\r\n                        title: layer.title,\r\n                        type: 'overlay',\r\n                        opacity: 1.0,\r\n                        visible: true,\r\n                        source: layerSource\r\n                    })\r\n                    break\r\n                default:\r\n                    console.log('error-otherWMSLayer:', figureType)\r\n            }\r\n        }\r\n\r\n        // only 部落圖層點擊用layer\r\n        if (layerType === 'WFS'){\r\n            const vectorSource = new VectorSource({\r\n                format: new GeoJSON(),\r\n                url: layer.tiles_url,\r\n                strategy: bbox\r\n            })\r\n            // TODO: 加入82災害樣式\r\n            const defaultStyles = new Vector().getStyleFunction()()\r\n            const hasSelectColor = {}\r\n            const layerStyle = (layer.title === '新竹縣原住民部落範圍')\r\n                ? function(feature){\r\n                    const featureGroupName = feature.values_['部落名稱']\r\n                    function getRandomUniqueColor(){\r\n                        const usedColors = new Set()\r\n                        const characters = '0123456789ABCDEF'\r\n                        let color\r\n                        do {\r\n                            color = '#'\r\n                            for (let i = 0; i < 6; i++){\r\n                                color += characters[Math.floor(Math.random() * 16)]\r\n                            }\r\n                        } while (usedColors.has(color))\r\n\r\n                        usedColors.add(color)\r\n                        hasSelectColor[featureGroupName] = color\r\n                        return color\r\n                    }\r\n\r\n                    const style = new Style({\r\n                        fill: new Fill({\r\n                            color: hasSelectColor[featureGroupName] === undefined ? getRandomUniqueColor() : hasSelectColor[featureGroupName]\r\n                        }),\r\n                    })\r\n                    return style\r\n                }\r\n                : defaultStyles\r\n            result = new VectorLayer({\r\n                id,\r\n                label: `${layer.title}${tileTitle}`,\r\n                source: vectorSource,\r\n                style: layerStyle,\r\n            })\r\n        }\r\n        if (layerType === 'GeoJson'){\r\n            const url = layer.single_tiles ? layer.tiles_url : layer.tiles_list[nestedSubNodeIndex].tile_url\r\n            switch (figureType){\r\n                case 'Line':\r\n                    if (url){\r\n                        const api = new URL(url)\r\n                        const { origin, pathname, searchParams } = api\r\n                        const searchParamsObject = {}\r\n                        for (const [key, value] of searchParams.entries()){\r\n                            searchParamsObject[key] = value\r\n                        }\r\n                        request[0] = origin + pathname\r\n                        request[1] = searchParamsObject\r\n                    }\r\n                    layerSource = new VectorSource({\r\n                        url: layer.tiles_url,\r\n                        format: new GeoJSON({\r\n                            geometryName: layer.title\r\n                        }),\r\n                    })\r\n                    break\r\n                case 'Point':\r\n                    // TODO: icon優化\r\n                    if (url){\r\n                        const api = new URL(url)\r\n                        const { origin, pathname, searchParams } = api\r\n                        const searchParamsObject = {}\r\n                        for (const [key, value] of searchParams.entries()){\r\n                            searchParamsObject[key] = value\r\n                        }\r\n                        request[0] = origin + pathname\r\n                        request[1] = searchParamsObject\r\n                    }\r\n                    layerSource = new VectorSource({\r\n                        url: layer.tiles_url,\r\n                        format: new GeoJSON({\r\n                            geometryName: layer.title\r\n                        }),\r\n                    })\r\n                    break\r\n                default:\r\n                    console.log('error-otherWMSLayer:', figureType)\r\n            }\r\n            result = new VectorLayer({\r\n                id,\r\n                label: `${layer.title}${tileTitle}`,\r\n                source: layerSource\r\n            })\r\n        }\r\n        if (layerType === 'Image'){\r\n            switch (figureType){\r\n                case 'Surface':\r\n                    const imageLayer = new Static({\r\n                        url: layer.tiles_image_urls[0],\r\n                        projection: 'EPSG:4326',\r\n                        imageExtent: layer.image_options.image_extent,\r\n                        interpolate: true,\r\n                    })\r\n\r\n                    result = new ImageLayer({\r\n                        id,\r\n                        label: `${layer.title}${tileTitle}`,\r\n                        source: imageLayer,\r\n                        ext: {\r\n                            currentLayerKey: 0,\r\n                            tilesImageUrls: layer.tiles_image_urls,\r\n                            imageExtent: layer.image_options.image_extent,\r\n                        }\r\n                    })\r\n                    break\r\n                default:\r\n                    console.log('error-otherWMSLayer:', figureType)\r\n            }\r\n        }\r\n        return result\r\n    },\r\n    getLayerIndex: (id) => {\r\n        let nodeIndex; let subNodeIndex; let nestedSubNodeIndex\r\n        if (!(id)){ return { nodeIndex, subNodeIndex, nestedSubNodeIndex, id } }\r\n        id.split('_').forEach((element, key) => {\r\n            switch (key){\r\n                case 0:\r\n                    nodeIndex = Number(element.split('node')[1])\r\n                    break\r\n                case 1:\r\n                    subNodeIndex = Number(element.split('subNode')[1])\r\n                    break\r\n                case 2:\r\n                    nestedSubNodeIndex = element.split('nestedSubNode')[1] !== 'undefined' ? Number(element.split('nestedSubNode')[1]) : 'undefined'\r\n                    break\r\n            }\r\n        })\r\n        return { nodeIndex, subNodeIndex, nestedSubNodeIndex, id }\r\n    },\r\n    resetLayerId: (id, keyName, newVal) => {\r\n        // FIXME: 使用上面getLayerIndex 做拆解\r\n        const result = {}\r\n        id.split('_').forEach(item => {\r\n            const [key, value] = item.split('ode')\r\n            result[key + 'ode'] = value\r\n        })\r\n\r\n        result[keyName] = newVal\r\n\r\n        let newStr = ''\r\n        Object.entries(result).forEach((node, key) => {\r\n            newStr += `${node[0]}${node[1]}`\r\n            if (key + 1 !== Object.entries(result).length){ newStr += '_' }\r\n        })\r\n        return newStr\r\n    },\r\n}\r\n","import { Tile, Tile as TileLayer, Vector as VectorLayer } from 'ol/layer.js'\r\nimport XYZ from 'ol/source/XYZ' // 引入XYZ地圖格式\r\nimport OSM from 'ol/source/OSM.js'\r\n\r\nlet baseMapDataList = []\r\n\r\nexport default {\r\n    getBaseMapData: (value) => { // 可能傳入底圖的key值\r\n        let layer\r\n        if (Number.isInteger(value)){\r\n            layer = baseMapDataList[value]\r\n        } else {\r\n            layer = value.layer\r\n        }\r\n\r\n        const newTileLayer = new Tile({\r\n            preload: Infinity,\r\n            name: layer.name,\r\n            label: layer.label,\r\n            type: layer.mapType,\r\n            baseId: layer.baseId,\r\n            source: new XYZ({\r\n                url: layer.url\r\n            }),\r\n            crossOrigin: 'anonymous',\r\n        })\r\n        return newTileLayer\r\n    },\r\n    setBaseMapData: (result) => {\r\n        baseMapDataList = result\r\n    },\r\n    getCurrentBase: () => {\r\n        return baseMapDataList.filter(node => node.onCurrent)\r\n    },\r\n    showBaseMapData: () => {\r\n        console.log(baseMapDataList)\r\n    }\r\n}\r\n\r\nexport function getBaseMapAll(){\r\n    return baseMapDataList\r\n}\r\n","<script>\r\nimport { useSlots, onBeforeMount, onMounted, onBeforeUnmount, ref, reactive, computed, watch, nextTick, defineAsyncComponent, useCssModule, inject } from 'vue'\r\nimport $ from 'jquery'\r\n\r\nimport mapLayerList from '@/config/mapLayerList'\r\nimport baseMapList from '@/config/baseMapList'\r\nimport VectorImageLayer from 'ol/layer/VectorImage.js'\r\nimport TileState from 'ol/TileState.js'\r\nimport { useRouter } from 'vue-router'\r\n\r\n\r\nimport 'ol-ext/dist/ol-ext.css'\r\n\r\nexport default {\r\n    props: {\r\n        onClose: {\r\n            type: Function,\r\n            default: () => { }\r\n        },\r\n        mapLayers: {\r\n            type: Array,\r\n            default: []\r\n        },\r\n        currentLayers: {\r\n            type: Array,\r\n            default: []\r\n        },\r\n        showSelectLayerValue: {\r\n            type: Function,\r\n            default: () => { }\r\n        },\r\n        tribeQuery: {\r\n            type: Object,\r\n            default: {}\r\n        },\r\n        moveToMap: {\r\n            type: Function,\r\n            default: () => { }\r\n        }\r\n    },\r\n    setup(props, { emit }) {\r\n        const mapList = mapLayerList\r\n        const router = useRouter()\r\n        const state = reactive({\r\n            DropDown: null,\r\n            TilesListValue: 0,\r\n            conditionYear: '',\r\n            conditionTown: '',\r\n            selectLayerOption: []\r\n        })\r\n\r\n        function onLayerControl(action, value) {\r\n            emit('onLayerControl', { action, value })\r\n        }\r\n        function openLayerList(value) {\r\n            if (state.DropDown !== value) {\r\n                state.DropDown = value\r\n            } else {\r\n                state.DropDown = null\r\n            }\r\n        }\r\n        function LayerCheckBoxChange(e, item) {\r\n            let defaultChecked = item.elementSource === 'input' ? e.target.checked : true\r\n            onLayerControl('layerMode', {\r\n                checked: defaultChecked,\r\n                nodeIndex: item.nodeIndex,\r\n                subNodeIndex: item.subNodeIndex,\r\n                nestedSubNodeIndex: String(item.nestedSubNodeIndex) ? item.nestedSubNodeIndex : undefined,\r\n                // 判斷是否有子層即是勾選的還是下拉\r\n                id: (item.single_tiles || !(e.target.selectedOptions)) ? item.id : e.target.selectedOptions[0].id\r\n            })\r\n        }\r\n\r\n        async function getTribes() {\r\n            const result = await $.ajax(`https://api.edtest.site/tribes?${'years=' + state.conditionYear}&${'township=' + state.conditionTown}`, 'GET')\r\n            state.selectLayerOption = result\r\n        }\r\n\r\n        function tribeYear(event) {\r\n            state.conditionYear = event.target.value\r\n            getTribes()\r\n        }\r\n\r\n        function tribeTown(event) {\r\n            state.conditionTown = event.target.value\r\n            getTribes()\r\n        }\r\n\r\n        function moveMap(params) {\r\n            let selectValue = state.selectLayerOption.find(node => node.tribeCode == params.target.value)\r\n            props.moveToMap(selectValue.coordinates)\r\n        }\r\n\r\n        watch(() => state.TilesListValue, (newVal, oldVal) => {\r\n            props.showSelectLayerValue(newVal)\r\n        })\r\n\r\n        return {\r\n            props,\r\n            state,\r\n            router,\r\n            mapList,\r\n            onLayerControl,\r\n            openLayerList,\r\n            LayerCheckBoxChange,\r\n            tribeYear,\r\n            tribeTown,\r\n            moveMap\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<template>\r\n    <div class=\"condition bg-white\">\r\n        <div class=\"row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold border-bottom\">\r\n            <p class=\"mb-0 fs-5\">圖層選項</p>\r\n            <a href=\"#\"\r\n                class=\"closeBtn bg-dark text-decoration-none rounded-circle position-absolute d-flex align-items-center justify-content-center\"\r\n                @click.prevent=\"props.onClose\"></a>\r\n        </div>\r\n        <div class=\"py-3 px-4 content\" style=\"max-height: 40vh;overflow-y: scroll;\">\r\n            <div class=\"mb-2 landBoundary\">\r\n                <div v-for=\"(node, nodeIndex) in props.mapLayers\" class=\"mb-2\">\r\n                    <div class=\"title d-flex align-items-center fw-bold text-black order-1 mb-1 text-decoration-none\"\r\n                        @click=\"openLayerList(nodeIndex)\">\r\n                        <div :class=\"node.groupClass\"></div>\r\n                        <div>{{ node.label }}</div>\r\n                        <svg viewBox=\"0 0 24 24\" :class=\"{ 'openTitle': state.DropDown == nodeIndex }\">\r\n                            <path fill=\"currentColor\" d=\"M8 5v14l11-7z\" />\r\n                        </svg>\r\n                    </div>\r\n                    <div class=\"ms-3 my-2\" v-for=\"(subNode, subNodeIndex) in node.layers\"\r\n                        v-if=\"state.DropDown == nodeIndex\">\r\n                        <div v-if=\"subNode.single_tiles && subNode.info_box == null\" class=\"d-flex flex-wrap\">\r\n                            <input type=\"checkbox\" class=\"me-2\" :id=\"subNode.id\"\r\n                                :checked=\"props.currentLayers.some(node => node.id === subNode.id)\" @change=\"(e) => {\r\n                                    LayerCheckBoxChange(e, {\r\n                                        nodeIndex: nodeIndex,\r\n                                        subNode: subNode,\r\n                                        subNodeIndex: subNodeIndex,\r\n                                        nestedSubNodeIndex: '',\r\n                                        single_tiles: subNode.single_tiles,\r\n                                        elementSource: 'input',\r\n                                        id: subNode.id\r\n                                    })\r\n                                }\">\r\n                            <label :for=\"subNode.id\">\r\n                                <span class=\"me-2\">\r\n                                    {{ subNode.title }}\r\n                                </span>\r\n                                <img alt=\"\" :src=\"subNode.icon\" v-if=\"subNode.icon\">\r\n                            </label>\r\n                            <div v-if=\"subNode.title === '新竹縣原住民部落範圍'\" class=\"w-100\">\r\n                                <select class=\"me-2\" placeholder=\"請選擇年度\" v-if=\"props.tribeQuery['years'] !== undefined\"\r\n                                    @change=\"tribeYear\">\r\n                                    <option :value=\"item\" v-for=\"(item, key) in props.tribeQuery['years']\">\r\n                                        {{ item }}\r\n                                    </option>\r\n                                </select>\r\n                                <select class=\"me-2\" placeholder=\"請選擇鄉鎮\" v-if=\"props.tribeQuery['township'] !== undefined\"\r\n                                    @change=\"tribeTown\">\r\n                                    <option :value=\"item\" v-for=\"(item, key) in props.tribeQuery['township']\">\r\n                                        {{ item }}\r\n                                    </option>\r\n                                </select>\r\n                                <select class=\"me-2\" v-if=\"state.selectLayerOption.length !== 0\" @change=\"moveMap\">\r\n                                    <option :value=\"item.tribeCode\" v-for=\"(item, key) in state.selectLayerOption\">\r\n                                        {{ item.tribeName }}\r\n                                    </option>\r\n                                </select>\r\n                            </div>\r\n                        </div>\r\n                        <div v-else>\r\n                            <div class=\"my-2\">\r\n                                <input type=\"checkbox\" :checked=\"props.currentLayers.some(node => {\r\n                                    let subNodeIds = mapList.getLayerIndex(node.id)\r\n                                    return subNodeIds.nodeIndex == nodeIndex && subNodeIds.subNodeIndex == subNodeIndex\r\n                                })\" @change=\"(e) => {\r\n                                    LayerCheckBoxChange(e, {\r\n                                        nodeIndex: nodeIndex,\r\n                                        subNode: subNode,\r\n                                        subNodeIndex: subNodeIndex,\r\n                                        nestedSubNodeIndex: '',\r\n                                        single_tiles: true,\r\n                                        elementSource: 'input',\r\n                                        id: subNode.id\r\n                                    })\r\n                                }\">\r\n                                {{ subNode.title }}\r\n                                <select name=\"\" id=\"\" class=\"mx-2\" v-model=\"state.TilesListValue\"\r\n                                    v-if=\"subNode.tiles_list != null\" @change=\"(e) => {\r\n                                        LayerCheckBoxChange(e, {\r\n                                            nodeIndex: nodeIndex,\r\n                                            subNode: subNode,\r\n                                            subNodeIndex: subNodeIndex,\r\n                                            nestedSubNodeIndex: state.TilesListValue,\r\n                                            single_tiles: subNode.single_tiles,\r\n                                            elementSource: 'select',\r\n                                            id: subNode.id,\r\n                                        })\r\n                                    }\">\r\n                                    <option :value=\"key\" :id=\"item.id\" v-for=\"(item, key) in subNode.tiles_list\"\r\n                                        v-bind:key=\"key\">{{ item.title }}</option>\r\n                                </select>\r\n\r\n                            </div>\r\n                            <div class=\"d-flex flex-wrap px-2 pt-1\" style=\"background: #f4f4f4;\">\r\n                                <span class=\"me-2 d-flex flex-wrap align-items-center mb-1\"\r\n                                    v-for=\"(iconSrc) in subNode.info_box.items_group\" v-bind:key=\"iconSrc\">\r\n                                    <img :src=\"iconSrc.icon\" alt=\"\" class=\"me-1\" v-if=\"iconSrc.icon\">\r\n                                    <span class=\"fw-bold\">{{ iconSrc.text }}</span>\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <!-- TODO 修改樣式 -->\r\n                        <div class=\"d-flex flex-wrap px-2 pt-1\" style=\"background: #f4f4f4;\" v-if=\"subNode.legend\">\r\n                            <a class=\"me-1\" :href=\"subNode.legend\" target=\"_blank\" style=\"text-decoration: none; color: #a87777;\">圖例連結</a>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<style lang=\"sass\" scoped>\r\n.condition\r\n    border-radius: 10px\r\n.closeBtn\r\n    right:10px\r\n    width: 20px\r\n    height: 20px\r\n    padding: 0\r\n    &::after\r\n        content: ''\r\n        background: #fff\r\n        height: 2px\r\n        width: 60%\r\n        display: block\r\n.content\r\n    overflow-y: scroll\r\n    background: #fff\r\n    .landBoundary\r\n        max-height: 500px\r\n    .title\r\n        cursor: pointer\r\n        svg\r\n            transform: rotateZ(0)\r\n        .openTitle\r\n            transform: rotateZ(90deg)\r\n    svg\r\n        width: 20px\r\n        height: 20px\r\n    img\r\n        width: 16px\r\n        height: 16px\r\n    .wrap\r\n        display: none\r\n@media (max-width: 600px)\r\n    .condition\r\n        border-radius: 0\r\n\r\n</style>","export default \"__VITE_ASSET__1efb1f50__\"","export default \"__VITE_ASSET__e9e17f9c__\"","export default \"__VITE_ASSET__9216d299__\"","export default \"__VITE_ASSET__f20fa25d__\"","export default \"__VITE_ASSET__62f11e0f__\"","<script>\r\nimport { useSlots, onBeforeMount, onMounted, onBeforeUnmount, ref, reactive, computed, watch, nextTick, defineAsyncComponent, useCssModule, inject } from 'vue'\r\nimport $ from 'jquery'\r\n\r\nexport default {\r\n    props: {\r\n        currentLayers: {\r\n            type: Array,\r\n            default: []\r\n        },\r\n        mapCount: {\r\n            type: Number,\r\n            default: 1\r\n        },\r\n        dimensionMapStatus: {\r\n            type: Boolean,\r\n            default: false\r\n        },\r\n        onChangeMapCount: {\r\n            type: Function,\r\n            default: ()=>{}\r\n        },\r\n        onChangeTarget: {\r\n            type: Function,\r\n            default: ()=>{}\r\n        }\r\n    },\r\n    setup(props, { emit }) {\r\n        const state = reactive({\r\n            toolSwitch: {\r\n                threeDimensionalBtn: false,\r\n                layerConditionBtn: false,\r\n                splitWindowBtn: false,\r\n            },\r\n            targetNum: 1,\r\n        })\r\n\r\n        function toolSwitch(target, value) {\r\n            // 其他全部關掉\r\n            Object.keys(state.toolSwitch).forEach(node => {\r\n                if (node === target) {\r\n                    if(state.toolSwitch[target]) {\r\n                        state.toolSwitch[target] = false\r\n                    } else {\r\n                        state.toolSwitch[target] = true\r\n                    }\r\n                } else {\r\n                    state.toolSwitch[node] = false\r\n                }\r\n            })\r\n        }\r\n        function onLayerControl(action, value) {\r\n            emit('onLayerControl', { action, value })\r\n        }\r\n\r\n        function conditionWrap() {\r\n            emit('conditionWrap')\r\n        }\r\n\r\n        return {\r\n            props,\r\n            state,\r\n            toolSwitch,\r\n            onLayerControl,\r\n            conditionWrap,\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<template>\r\n    <div>\r\n        <ul class=\"list-unstyled d-inline-flex align-items-center flex-nowrap w-full\">\r\n            <OverLayer :text=\"'圖層操控工具'\" />\r\n            <li class=\"me-4 position-relative\">\r\n                <div class=\"MapFeatureBtn text-white\">\r\n                    <a href=\"\" v-if=\"props.dimensionMapStatus\"\r\n                    @click.prevent=\"toolSwitch('threeDimensionalBtn'), onLayerControl('changeDimensionMap', '3D')\">\r\n                        <img src=\"@/assets/img/icon/2D.svg\">\r\n                    </a>\r\n                    <a href=\"\" v-else\r\n                    @click.prevent=\"toolSwitch('threeDimensionalBtn'), onLayerControl('changeDimensionMap', '2D')\">\r\n                        <img src=\"@/assets/img/icon/3D.svg\">\r\n                    </a>\r\n                </div>\r\n            </li>\r\n            <li class=\"me-4 position-relative\">\r\n                <a href=\"\" class=\"MapFeatureBtn text-white\"\r\n                    @click.prevent=\"toolSwitch('layerConditionBtn'), conditionWrap()\">\r\n                    <img src=\"@/assets/img/icon/baseLayer.svg\" alt=\"\">\r\n                </a>\r\n            </li>\r\n            <li class=\"position-relative\">\r\n                <a href=\"\" class=\"MapFeatureBtn text-white\" @click.prevent=\"toolSwitch('splitWindowBtn')\">\r\n                    <img src=\"@/assets/img/icon/singleWindow.svg\" alt=\"\" v-if=\"props.mapCount === 1\">\r\n                    <img src=\"@/assets/img/icon/doubleWindows.svg\" alt=\"\" v-if=\"props.mapCount === 2\">\r\n                </a>\r\n                <ul class=\"list-unstyled position-absolute start-0 top-100 p-0\" v-if=\"state.toolSwitch.splitWindowBtn\">\r\n                    <li class=\"mt-2\">\r\n                        <a href=\"\" class=\"text-white MapFeatureBtn\" @click.prevent=\"props.onChangeMapCount(1)\">\r\n                            <img src=\"@/assets/img/icon/singleWindow.svg\" alt=\"\">\r\n                        </a>\r\n                    </li>\r\n                    <li class=\"mt-2\">\r\n                        <a href=\"\" class=\"text-white MapFeatureBtn\" @click.prevent=\"props.onChangeMapCount(2)\">\r\n                            <img src=\"@/assets/img/icon/doubleWindows.svg\" alt=\"\">\r\n                        </a>\r\n                    </li>\r\n                </ul>\r\n            </li>\r\n        </ul>\r\n\r\n        <div class=\"switchControl d-flex position-fixed rounded-pill p-2\" id=\"switchControl\"\r\n        style=\"z-index: 99;\">\r\n            <OverLayer :text=\"'左右視窗切換工具'\" />\r\n            <div class=\"fs-3 text-white rounded-pill\" :class=\"{ 'active': state.targetNum === 1 }\" @click=\"() => {\r\n                state.targetNum = 1\r\n                props.onChangeTarget(1)\r\n            }\">左</div>\r\n            <div class=\"fs-3 text-white rounded-pill\" :class=\"{ 'active': state.targetNum === 2 }\" @click=\"() => {\r\n                state.targetNum = 2\r\n                props.onChangeTarget(2)\r\n            }\">右</div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<style lang=\"sass\" scoped>\r\n.MapFeatureBtn\r\n    display: block\r\n    border-radius: 10px\r\n    width: 68px\r\n    height: 68px\r\n    box-sizing: border-box\r\n    img\r\n        width: 100%\r\n        height: 100%\r\n        &:hover\r\n            filter: brightness(0.9)\r\n    svg\r\n        font-size: 24px\r\n        width: 100%\r\n        height: 100%\r\n\r\n.switchControl\r\n    top: 10px\r\n    left: 50%\r\n    background: rgba(30, 30, 30, 0.9)\r\n    box-sizing: border-box\r\n    transform: translateX(-50%)\r\n    div\r\n        padding:5px 28px\r\n        cursor: pointer\r\n        box-sizing: border-box\r\n    .active\r\n        background: #247BA0\r\n@media (max-width: 1300px)\r\n    .switchControl\r\n        top: 10px\r\n        left: unset\r\n        right: 10px\r\n        transform: unset\r\n</style>","<script>\r\nimport { useSlots, onBeforeMount, onMounted, onBeforeUnmount, ref, reactive, computed, watch, nextTick, defineAsyncComponent, useCssModule, inject, getCurrentInstance } from 'vue'\r\nimport $ from 'jquery'\r\n\r\nexport default {\r\n    props: {\r\n        baseMapList: {\r\n            type: Array,\r\n            default: []\r\n        },\r\n        onChangeBaseMaps: {\r\n            type: Function,\r\n            default: ()=>{}\r\n        },\r\n    },\r\n    setup(props, { emit }) {\r\n        const state = reactive({\r\n            selectMap: 0,\r\n            mapSourceList: []\r\n        })\r\n\r\n        return {\r\n            state,\r\n            props,\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<template>\r\n    <div>\r\n        <OverLayer :text=\"'底圖切換工具'\" />\r\n        <select name=\"\" id=\"\" class=\"w-100 fs-6 fs-sm-5\" v-model=\"state.selectMap\"\r\n        @change=\"(e) => {\r\n            let value = props.baseMapList.find(node=> node.baseId === state.selectMap)\r\n            props.onChangeBaseMaps({ action: 'baseMap', value })\r\n        }\">\r\n            <option class=\"w-100\" v-for=\"(node, nodeIndex) in props.baseMapList\" :key=\"nodeIndex\" :value=\"node.baseId\">{{ node.label }}</option>\r\n        </select>\r\n    </div>\r\n</template>\r\n\r\n<style lang=\"sass\" scoped>\r\nselect\r\n    border: 0\r\n    box-shadow: 0px 4px 4px #999\r\n    border-radius: 5px\r\n    padding: 8px 20px\r\n    option\r\n        padding: 8px 20px\r\n@media (max-width: 600px)\r\nselect\r\n    padding: 8px 4px\r\n    option\r\n        padding: 0\r\n</style>\r\n","export default \"__VITE_ASSET__a8c0f6d0__\"","export default \"__VITE_ASSET__630fe15b__\"","export default \"__VITE_ASSET__7e8d4017__\"","export default \"__VITE_ASSET__0ebcb08a__\"","export default \"__VITE_ASSET__185ae262__\"","<script>\r\nimport { useSlots, onBeforeMount, onMounted, onBeforeUnmount, ref, reactive, computed, watch, nextTick, defineAsyncComponent, useCssModule, inject } from 'vue'\r\nexport default {\r\n    props: {\r\n        id:{\r\n            Type: String,\r\n            default: 0\r\n        },\r\n        map:{},\r\n        onChangeTarget: {\r\n            type: Function,\r\n            default: () => {}\r\n        },\r\n    },\r\n    setup(props, { emit }){\r\n\r\n        const state = reactive({\r\n            targetNum: 1,\r\n        })\r\n\r\n        function onMapControl(action) {\r\n            emit('onMapControl', {action})\r\n        }\r\n\r\n        return {\r\n            props,\r\n            state,\r\n            onMapControl,\r\n        }\r\n    }\r\n}\r\n\r\n</script>\r\n\r\n<template>\r\n    <div class=\"d-flex flex-nowrap flex-column\">\r\n        <OverLayer :text=\"'地圖操控工具'\" />\r\n        <div class=\"switchControl d-block  d-sm-none rounded-4 p-2 mb-2\" id=\"switchControl\" style=\"z-index: 99;\">\r\n            <div class=\"text-white text-center rounded\"\r\n            :class=\"{ 'active': state.targetNum === 1 }\"\r\n                @click=\"() => {\r\n                    state.targetNum = 1\r\n                    props.onChangeTarget(1)\r\n                }\">上</div>\r\n                <div class=\"text-white text-center rounded\"\r\n                :class=\"{ 'active': state.targetNum === 2 }\"\r\n                @click=\"() => {\r\n                    state.targetNum = 2\r\n                    props.onChangeTarget(2)\r\n                }\">下</div>\r\n            </div>\r\n\r\n        <a href=\"#\" class=\"d-none d-sm-block order-1 mb-0\" @click.prevent=\"onMapControl('In')\">\r\n            <img src=\"@/assets/img/icon/zoomIn.svg\" alt=\"zoomIn\">\r\n        </a>\r\n        <a href=\"#\" class=\"d-none d-sm-block order-1 mb-2\" @click.prevent=\"onMapControl('Out')\">\r\n            <img src=\"@/assets/img/icon/zoomOut.svg\" alt=\"zoomOut\">\r\n        </a>\r\n        <a href=\"#\" class=\"order-1 mb-2\" @click.prevent=\"onMapControl('toNorth')\">\r\n            <img src=\"@/assets/img/icon/compass.svg\" alt=\"compass\">\r\n        </a>\r\n        <a href=\"#\" class=\"order-1 mb-2\" @click.prevent=\"onMapControl('moveTo')\">\r\n            <img src=\"@/assets/img/icon/location.svg\" alt=\"location\">\r\n        </a>\r\n        <a href=\"#\" class=\"order-1\" @click.prevent=\"onMapControl('fullScreen')\">\r\n            <img src=\"@/assets/img/icon/zoom.svg\" alt=\"zoom\">\r\n        </a>\r\n    </div>\r\n</template>\r\n\r\n<style lang=\"sass\" scoped>\r\n.switchControl\r\n    background: rgba(30, 30, 30, 0.9)\r\n    box-sizing: border-box\r\n    div\r\n        padding:5px\r\n        cursor: pointer\r\n        box-sizing: border-box\r\n    .active\r\n        background: #247BA0\r\n</style>\r\n\r\n","/**\n * @module ol/interaction/Select\n */\nimport Collection from '../Collection.js';\nimport CollectionEventType from '../CollectionEventType.js';\nimport Event from '../events/Event.js';\nimport Feature from '../Feature.js';\nimport Interaction from './Interaction.js';\nimport VectorLayer from '../layer/Vector.js';\nimport {TRUE} from '../functions.js';\nimport {clear} from '../obj.js';\nimport {createEditingStyle} from '../style/Style.js';\nimport {extend} from '../array.js';\nimport {getUid} from '../util.js';\nimport {never, shiftKeyOnly, singleClick} from '../events/condition.js';\n\n/**\n * @enum {string}\n */\nconst SelectEventType = {\n  /**\n   * Triggered when feature(s) has been (de)selected.\n   * @event SelectEvent#select\n   * @api\n   */\n  SELECT: 'select',\n};\n\n/**\n * A function that takes an {@link module:ol/Feature~Feature} and returns `true` if the feature may be\n * selected or `false` otherwise.\n * @typedef {function(import(\"../Feature.js\").default, import(\"../layer/Layer.js\").default<import(\"../source/Source\").default>):boolean} FilterFunction\n */\n\n/**\n * @typedef {Object} Options\n * @property {import(\"../events/condition.js\").Condition} [addCondition] A function\n * that takes an {@link module:ol/MapBrowserEvent~MapBrowserEvent} and returns a\n * boolean to indicate whether that event should be handled.\n * By default, this is {@link module:ol/events/condition.never}. Use this if you\n * want to use different events for add and remove instead of `toggle`.\n * @property {import(\"../events/condition.js\").Condition} [condition] A function that\n * takes an {@link module:ol/MapBrowserEvent~MapBrowserEvent} and returns a\n * boolean to indicate whether that event should be handled. This is the event\n * for the selected features as a whole. By default, this is\n * {@link module:ol/events/condition.singleClick}. Clicking on a feature selects that\n * feature and removes any that were in the selection. Clicking outside any\n * feature removes all from the selection.\n * See `toggle`, `add`, `remove` options for adding/removing extra features to/\n * from the selection.\n * @property {Array<import(\"../layer/Layer.js\").default>|function(import(\"../layer/Layer.js\").default<import(\"../source/Source\").default>): boolean} [layers]\n * A list of layers from which features should be selected. Alternatively, a\n * filter function can be provided. The function will be called for each layer\n * in the map and should return `true` for layers that you want to be\n * selectable. If the option is absent, all visible layers will be considered\n * selectable.\n * @property {import(\"../style/Style.js\").StyleLike|null} [style]\n * Style for the selected features. By default the default edit style is used\n * (see {@link module:ol/style/Style~Style}). Set to `null` if this interaction should not apply\n * any style changes for selected features.\n * If set to a falsey value, the selected feature's style will not change.\n * @property {import(\"../events/condition.js\").Condition} [removeCondition] A function\n * that takes an {@link module:ol/MapBrowserEvent~MapBrowserEvent} and returns a\n * boolean to indicate whether that event should be handled.\n * By default, this is {@link module:ol/events/condition.never}. Use this if you\n * want to use different events for add and remove instead of `toggle`.\n * @property {import(\"../events/condition.js\").Condition} [toggleCondition] A function\n * that takes an {@link module:ol/MapBrowserEvent~MapBrowserEvent} and returns a\n * boolean to indicate whether that event should be handled. This is in addition\n * to the `condition` event. By default,\n * {@link module:ol/events/condition.shiftKeyOnly}, i.e. pressing `shift` as\n * well as the `condition` event, adds that feature to the current selection if\n * it is not currently selected, and removes it if it is. See `add` and `remove`\n * if you want to use different events instead of a toggle.\n * @property {boolean} [multi=false] A boolean that determines if the default\n * behaviour should select only single features or all (overlapping) features at\n * the clicked map position. The default of `false` means single select.\n * @property {Collection<Feature>} [features]\n * Collection where the interaction will place selected features. Optional. If\n * not set the interaction will create a collection. In any case the collection\n * used by the interaction is returned by\n * {@link module:ol/interaction/Select~Select#getFeatures}.\n * @property {FilterFunction} [filter] A function\n * that takes an {@link module:ol/Feature~Feature} and an\n * {@link module:ol/layer/Layer~Layer} and returns `true` if the feature may be\n * selected or `false` otherwise.\n * @property {number} [hitTolerance=0] Hit-detection tolerance. Pixels inside\n * the radius around the given position will be checked for features.\n */\n\n/**\n * @classdesc\n * Events emitted by {@link module:ol/interaction/Select~Select} instances are instances of\n * this type.\n */\nexport class SelectEvent extends Event {\n  /**\n   * @param {SelectEventType} type The event type.\n   * @param {Array<import(\"../Feature.js\").default>} selected Selected features.\n   * @param {Array<import(\"../Feature.js\").default>} deselected Deselected features.\n   * @param {import(\"../MapBrowserEvent.js\").default} mapBrowserEvent Associated\n   *     {@link module:ol/MapBrowserEvent~MapBrowserEvent}.\n   */\n  constructor(type, selected, deselected, mapBrowserEvent) {\n    super(type);\n\n    /**\n     * Selected features array.\n     * @type {Array<import(\"../Feature.js\").default>}\n     * @api\n     */\n    this.selected = selected;\n\n    /**\n     * Deselected features array.\n     * @type {Array<import(\"../Feature.js\").default>}\n     * @api\n     */\n    this.deselected = deselected;\n\n    /**\n     * Associated {@link module:ol/MapBrowserEvent~MapBrowserEvent}.\n     * @type {import(\"../MapBrowserEvent.js\").default}\n     * @api\n     */\n    this.mapBrowserEvent = mapBrowserEvent;\n  }\n}\n\n/**\n * Original feature styles to reset to when features are no longer selected.\n * @type {Object<number, import(\"../style/Style.js\").default|Array<import(\"../style/Style.js\").default>|import(\"../style/Style.js\").StyleFunction>}\n */\nconst originalFeatureStyles = {};\n\n/***\n * @template Return\n * @typedef {import(\"../Observable\").OnSignature<import(\"../Observable\").EventTypes, import(\"../events/Event.js\").default, Return> &\n *   import(\"../Observable\").OnSignature<import(\"../ObjectEventType\").Types|\n *     'change:active', import(\"../Object\").ObjectEvent, Return> &\n *   import(\"../Observable\").OnSignature<'select', SelectEvent, Return> &\n *   import(\"../Observable\").CombinedOnSignature<import(\"../Observable\").EventTypes|import(\"../ObjectEventType\").Types|\n *     'change:active'|'select', Return>} SelectOnSignature\n */\n\n/**\n * @classdesc\n * Interaction for selecting vector features. By default, selected features are\n * styled differently, so this interaction can be used for visual highlighting,\n * as well as selecting features for other actions, such as modification or\n * output. There are three ways of controlling which features are selected:\n * using the browser event as defined by the `condition` and optionally the\n * `toggle`, `add`/`remove`, and `multi` options; a `layers` filter; and a\n * further feature filter using the `filter` option.\n *\n * @fires SelectEvent\n * @api\n */\nclass Select extends Interaction {\n  /**\n   * @param {Options} [options] Options.\n   */\n  constructor(options) {\n    super();\n\n    /***\n     * @type {SelectOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.on;\n\n    /***\n     * @type {SelectOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.once;\n\n    /***\n     * @type {SelectOnSignature<void>}\n     */\n    this.un;\n\n    options = options ? options : {};\n\n    /**\n     * @private\n     */\n    this.boundAddFeature_ = this.addFeature_.bind(this);\n\n    /**\n     * @private\n     */\n    this.boundRemoveFeature_ = this.removeFeature_.bind(this);\n\n    /**\n     * @private\n     * @type {import(\"../events/condition.js\").Condition}\n     */\n    this.condition_ = options.condition ? options.condition : singleClick;\n\n    /**\n     * @private\n     * @type {import(\"../events/condition.js\").Condition}\n     */\n    this.addCondition_ = options.addCondition ? options.addCondition : never;\n\n    /**\n     * @private\n     * @type {import(\"../events/condition.js\").Condition}\n     */\n    this.removeCondition_ = options.removeCondition\n      ? options.removeCondition\n      : never;\n\n    /**\n     * @private\n     * @type {import(\"../events/condition.js\").Condition}\n     */\n    this.toggleCondition_ = options.toggleCondition\n      ? options.toggleCondition\n      : shiftKeyOnly;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.multi_ = options.multi ? options.multi : false;\n\n    /**\n     * @private\n     * @type {FilterFunction}\n     */\n    this.filter_ = options.filter ? options.filter : TRUE;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.hitTolerance_ = options.hitTolerance ? options.hitTolerance : 0;\n\n    /**\n     * @private\n     * @type {import(\"../style/Style.js\").default|Array<import(\"../style/Style.js\").default>|import(\"../style/Style.js\").StyleFunction|null}\n     */\n    this.style_ =\n      options.style !== undefined ? options.style : getDefaultStyleFunction();\n\n    /**\n     * @private\n     * @type {Collection<Feature>}\n     */\n    this.features_ = options.features || new Collection();\n\n    /** @type {function(import(\"../layer/Layer.js\").default<import(\"../source/Source\").default>): boolean} */\n    let layerFilter;\n    if (options.layers) {\n      if (typeof options.layers === 'function') {\n        layerFilter = options.layers;\n      } else {\n        const layers = options.layers;\n        layerFilter = function (layer) {\n          return layers.includes(layer);\n        };\n      }\n    } else {\n      layerFilter = TRUE;\n    }\n\n    /**\n     * @private\n     * @type {function(import(\"../layer/Layer.js\").default<import(\"../source/Source\").default>): boolean}\n     */\n    this.layerFilter_ = layerFilter;\n\n    /**\n     * An association between selected feature (key)\n     * and layer (value)\n     * @private\n     * @type {Object<string, import(\"../layer/Layer.js\").default>}\n     */\n    this.featureLayerAssociation_ = {};\n  }\n\n  /**\n   * @param {import(\"../Feature.js\").default} feature Feature.\n   * @param {import(\"../layer/Layer.js\").default} layer Layer.\n   * @private\n   */\n  addFeatureLayerAssociation_(feature, layer) {\n    this.featureLayerAssociation_[getUid(feature)] = layer;\n  }\n\n  /**\n   * Get the selected features.\n   * @return {Collection<Feature>} Features collection.\n   * @api\n   */\n  getFeatures() {\n    return this.features_;\n  }\n\n  /**\n   * Returns the Hit-detection tolerance.\n   * @return {number} Hit tolerance in pixels.\n   * @api\n   */\n  getHitTolerance() {\n    return this.hitTolerance_;\n  }\n\n  /**\n   * Returns the associated {@link module:ol/layer/Vector~VectorLayer vector layer} of\n   * a selected feature.\n   * @param {import(\"../Feature.js\").default} feature Feature\n   * @return {import('../layer/Vector.js').default} Layer.\n   * @api\n   */\n  getLayer(feature) {\n    return /** @type {import('../layer/Vector.js').default} */ (\n      this.featureLayerAssociation_[getUid(feature)]\n    );\n  }\n\n  /**\n   * Hit-detection tolerance. Pixels inside the radius around the given position\n   * will be checked for features.\n   * @param {number} hitTolerance Hit tolerance in pixels.\n   * @api\n   */\n  setHitTolerance(hitTolerance) {\n    this.hitTolerance_ = hitTolerance;\n  }\n\n  /**\n   * Remove the interaction from its current map, if any,  and attach it to a new\n   * map, if any. Pass `null` to just remove the interaction from the current map.\n   * @param {import(\"../Map.js\").default|null} map Map.\n   * @api\n   */\n  setMap(map) {\n    const currentMap = this.getMap();\n    if (currentMap && this.style_) {\n      this.features_.forEach(this.restorePreviousStyle_.bind(this));\n    }\n    super.setMap(map);\n    if (map) {\n      this.features_.addEventListener(\n        CollectionEventType.ADD,\n        this.boundAddFeature_\n      );\n      this.features_.addEventListener(\n        CollectionEventType.REMOVE,\n        this.boundRemoveFeature_\n      );\n\n      if (this.style_) {\n        this.features_.forEach(this.applySelectedStyle_.bind(this));\n      }\n    } else {\n      this.features_.removeEventListener(\n        CollectionEventType.ADD,\n        this.boundAddFeature_\n      );\n      this.features_.removeEventListener(\n        CollectionEventType.REMOVE,\n        this.boundRemoveFeature_\n      );\n    }\n  }\n\n  /**\n   * @param {import(\"../Collection.js\").CollectionEvent<Feature>} evt Event.\n   * @private\n   */\n  addFeature_(evt) {\n    const feature = evt.element;\n    if (this.style_) {\n      this.applySelectedStyle_(feature);\n    }\n    if (!this.getLayer(feature)) {\n      const layer = /** @type {VectorLayer} */ (\n        this.getMap()\n          .getAllLayers()\n          .find(function (layer) {\n            if (\n              layer instanceof VectorLayer &&\n              layer.getSource() &&\n              layer.getSource().hasFeature(feature)\n            ) {\n              return layer;\n            }\n          })\n      );\n      if (layer) {\n        this.addFeatureLayerAssociation_(feature, layer);\n      }\n    }\n  }\n\n  /**\n   * @param {import(\"../Collection.js\").CollectionEvent<Feature>} evt Event.\n   * @private\n   */\n  removeFeature_(evt) {\n    if (this.style_) {\n      this.restorePreviousStyle_(evt.element);\n    }\n  }\n\n  /**\n   * @return {import(\"../style/Style.js\").StyleLike|null} Select style.\n   */\n  getStyle() {\n    return this.style_;\n  }\n\n  /**\n   * @param {Feature} feature Feature\n   * @private\n   */\n  applySelectedStyle_(feature) {\n    const key = getUid(feature);\n    if (!(key in originalFeatureStyles)) {\n      originalFeatureStyles[key] = feature.getStyle();\n    }\n    feature.setStyle(this.style_);\n  }\n\n  /**\n   * @param {Feature} feature Feature\n   * @private\n   */\n  restorePreviousStyle_(feature) {\n    const interactions = this.getMap().getInteractions().getArray();\n    for (let i = interactions.length - 1; i >= 0; --i) {\n      const interaction = interactions[i];\n      if (\n        interaction !== this &&\n        interaction instanceof Select &&\n        interaction.getStyle() &&\n        interaction.getFeatures().getArray().lastIndexOf(feature) !== -1\n      ) {\n        feature.setStyle(interaction.getStyle());\n        return;\n      }\n    }\n\n    const key = getUid(feature);\n    feature.setStyle(originalFeatureStyles[key]);\n    delete originalFeatureStyles[key];\n  }\n\n  /**\n   * @param {Feature} feature Feature.\n   * @private\n   */\n  removeFeatureLayerAssociation_(feature) {\n    delete this.featureLayerAssociation_[getUid(feature)];\n  }\n\n  /**\n   * Handles the {@link module:ol/MapBrowserEvent~MapBrowserEvent map browser event} and may change the\n   * selected state of features.\n   * @param {import(\"../MapBrowserEvent.js\").default} mapBrowserEvent Map browser event.\n   * @return {boolean} `false` to stop event propagation.\n   */\n  handleEvent(mapBrowserEvent) {\n    if (!this.condition_(mapBrowserEvent)) {\n      return true;\n    }\n    const add = this.addCondition_(mapBrowserEvent);\n    const remove = this.removeCondition_(mapBrowserEvent);\n    const toggle = this.toggleCondition_(mapBrowserEvent);\n    const set = !add && !remove && !toggle;\n    const map = mapBrowserEvent.map;\n    const features = this.getFeatures();\n\n    /**\n     * @type {Array<Feature>}\n     */\n    const deselected = [];\n\n    /**\n     * @type {Array<Feature>}\n     */\n    const selected = [];\n\n    if (set) {\n      // Replace the currently selected feature(s) with the feature(s) at the\n      // pixel, or clear the selected feature(s) if there is no feature at\n      // the pixel.\n      clear(this.featureLayerAssociation_);\n      map.forEachFeatureAtPixel(\n        mapBrowserEvent.pixel,\n        /**\n         * @param {import(\"../Feature.js\").FeatureLike} feature Feature.\n         * @param {import(\"../layer/Layer.js\").default} layer Layer.\n         * @return {boolean|undefined} Continue to iterate over the features.\n         */\n        (feature, layer) => {\n          if (!(feature instanceof Feature) || !this.filter_(feature, layer)) {\n            return;\n          }\n          this.addFeatureLayerAssociation_(feature, layer);\n          selected.push(feature);\n          return !this.multi_;\n        },\n        {\n          layerFilter: this.layerFilter_,\n          hitTolerance: this.hitTolerance_,\n        }\n      );\n      for (let i = features.getLength() - 1; i >= 0; --i) {\n        const feature = features.item(i);\n        const index = selected.indexOf(feature);\n        if (index > -1) {\n          // feature is already selected\n          selected.splice(index, 1);\n        } else {\n          features.remove(feature);\n          deselected.push(feature);\n        }\n      }\n      if (selected.length !== 0) {\n        features.extend(selected);\n      }\n    } else {\n      // Modify the currently selected feature(s).\n      map.forEachFeatureAtPixel(\n        mapBrowserEvent.pixel,\n        /**\n         * @param {import(\"../Feature.js\").FeatureLike} feature Feature.\n         * @param {import(\"../layer/Layer.js\").default} layer Layer.\n         * @return {boolean|undefined} Continue to iterate over the features.\n         */\n        (feature, layer) => {\n          if (!(feature instanceof Feature) || !this.filter_(feature, layer)) {\n            return;\n          }\n          if ((add || toggle) && !features.getArray().includes(feature)) {\n            this.addFeatureLayerAssociation_(feature, layer);\n            selected.push(feature);\n          } else if (\n            (remove || toggle) &&\n            features.getArray().includes(feature)\n          ) {\n            deselected.push(feature);\n            this.removeFeatureLayerAssociation_(feature);\n          }\n          return !this.multi_;\n        },\n        {\n          layerFilter: this.layerFilter_,\n          hitTolerance: this.hitTolerance_,\n        }\n      );\n      for (let j = deselected.length - 1; j >= 0; --j) {\n        features.remove(deselected[j]);\n      }\n      features.extend(selected);\n    }\n    if (selected.length > 0 || deselected.length > 0) {\n      this.dispatchEvent(\n        new SelectEvent(\n          SelectEventType.SELECT,\n          selected,\n          deselected,\n          mapBrowserEvent\n        )\n      );\n    }\n    return true;\n  }\n}\n\n/**\n * @return {import(\"../style/Style.js\").StyleFunction} Styles.\n */\nfunction getDefaultStyleFunction() {\n  const styles = createEditingStyle();\n  extend(styles['Polygon'], styles['LineString']);\n  extend(styles['GeometryCollection'], styles['LineString']);\n\n  return function (feature) {\n    if (!feature.getGeometry()) {\n      return null;\n    }\n    return styles[feature.getGeometry().getType()];\n  };\n}\n\nexport default Select;\n","/**\n * @module ol/control/ScaleLine\n */\nimport Control from './Control.js';\nimport {CLASS_UNSELECTABLE} from '../css.js';\nimport {METERS_PER_UNIT, getPointResolution} from '../proj.js';\nimport {assert} from '../asserts.js';\n\n/**\n * @type {string}\n */\nconst UNITS_PROP = 'units';\n\n/**\n * @typedef {'degrees' | 'imperial' | 'nautical' | 'metric' | 'us'} Units\n * Units for the scale line.\n */\n\n/**\n * @const\n * @type {Array<number>}\n */\nconst LEADING_DIGITS = [1, 2, 5];\n\n/**\n * @const\n * @type {number}\n */\nconst DEFAULT_DPI = 25.4 / 0.28;\n\n/***\n * @template Return\n * @typedef {import(\"../Observable\").OnSignature<import(\"../Observable\").EventTypes, import(\"../events/Event.js\").default, Return> &\n *   import(\"../Observable\").OnSignature<import(\"../ObjectEventType\").Types|\n *     'change:units', import(\"../Object\").ObjectEvent, Return> &\n *   import(\"../Observable\").CombinedOnSignature<import(\"../Observable\").EventTypes|import(\"../ObjectEventType\").Types\n *     |'change:units', Return>} ScaleLineOnSignature\n */\n\n/**\n * @typedef {Object} Options\n * @property {string} [className] CSS class name. The default is `ol-scale-bar` when configured with\n * `bar: true`. Otherwise the default is `ol-scale-line`.\n * @property {number} [minWidth=64] Minimum width in pixels at the OGC default dpi. The width will be\n * adjusted to match the dpi used.\n * @property {number} [maxWidth] Maximum width in pixels at the OGC default dpi. The width will be\n * adjusted to match the dpi used.\n * @property {function(import(\"../MapEvent.js\").default):void} [render] Function called when the control\n * should be re-rendered. This is called in a `requestAnimationFrame` callback.\n * @property {HTMLElement|string} [target] Specify a target if you want the control\n * to be rendered outside of the map's viewport.\n * @property {Units} [units='metric'] Units.\n * @property {boolean} [bar=false] Render scalebars instead of a line.\n * @property {number} [steps=4] Number of steps the scalebar should use. Use even numbers\n * for best results. Only applies when `bar` is `true`.\n * @property {boolean} [text=false] Render the text scale above of the scalebar. Only applies\n * when `bar` is `true`.\n * @property {number|undefined} [dpi=undefined] dpi of output device such as printer. Only applies\n * when `bar` is `true`. If undefined the OGC default screen pixel size of 0.28mm will be assumed.\n */\n\n/**\n * @classdesc\n * A control displaying rough y-axis distances, calculated for the center of the\n * viewport. For conformal projections (e.g. EPSG:3857, the default view\n * projection in OpenLayers), the scale is valid for all directions.\n * No scale line will be shown when the y-axis distance of a pixel at the\n * viewport center cannot be calculated in the view projection.\n * By default the scale line will show in the bottom left portion of the map,\n * but this can be changed by using the css selector `.ol-scale-line`.\n * When specifying `bar` as `true`, a scalebar will be rendered instead\n * of a scaleline.\n *\n * @api\n */\nclass ScaleLine extends Control {\n  /**\n   * @param {Options} [options] Scale line options.\n   */\n  constructor(options) {\n    options = options ? options : {};\n\n    const element = document.createElement('div');\n    element.style.pointerEvents = 'none';\n\n    super({\n      element: element,\n      render: options.render,\n      target: options.target,\n    });\n\n    /***\n     * @type {ScaleLineOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.on;\n\n    /***\n     * @type {ScaleLineOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.once;\n\n    /***\n     * @type {ScaleLineOnSignature<void>}\n     */\n    this.un;\n\n    const className =\n      options.className !== undefined\n        ? options.className\n        : options.bar\n        ? 'ol-scale-bar'\n        : 'ol-scale-line';\n\n    /**\n     * @private\n     * @type {HTMLElement}\n     */\n    this.innerElement_ = document.createElement('div');\n    this.innerElement_.className = className + '-inner';\n\n    this.element.className = className + ' ' + CLASS_UNSELECTABLE;\n    this.element.appendChild(this.innerElement_);\n\n    /**\n     * @private\n     * @type {?import(\"../View.js\").State}\n     */\n    this.viewState_ = null;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.minWidth_ = options.minWidth !== undefined ? options.minWidth : 64;\n\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n    this.maxWidth_ = options.maxWidth;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.renderedVisible_ = false;\n\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n    this.renderedWidth_ = undefined;\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.renderedHTML_ = '';\n\n    this.addChangeListener(UNITS_PROP, this.handleUnitsChanged_);\n\n    this.setUnits(options.units || 'metric');\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.scaleBar_ = options.bar || false;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.scaleBarSteps_ = options.steps || 4;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.scaleBarText_ = options.text || false;\n\n    /**\n     * @private\n     * @type {number|undefined}\n     */\n    this.dpi_ = options.dpi || undefined;\n  }\n\n  /**\n   * Return the units to use in the scale line.\n   * @return {Units} The units\n   * to use in the scale line.\n   * @observable\n   * @api\n   */\n  getUnits() {\n    return this.get(UNITS_PROP);\n  }\n\n  /**\n   * @private\n   */\n  handleUnitsChanged_() {\n    this.updateElement_();\n  }\n\n  /**\n   * Set the units to use in the scale line.\n   * @param {Units} units The units to use in the scale line.\n   * @observable\n   * @api\n   */\n  setUnits(units) {\n    this.set(UNITS_PROP, units);\n  }\n\n  /**\n   * Specify the dpi of output device such as printer.\n   * @param {number|undefined} dpi The dpi of output device.\n   * @api\n   */\n  setDpi(dpi) {\n    this.dpi_ = dpi;\n  }\n\n  /**\n   * @private\n   */\n  updateElement_() {\n    const viewState = this.viewState_;\n\n    if (!viewState) {\n      if (this.renderedVisible_) {\n        this.element.style.display = 'none';\n        this.renderedVisible_ = false;\n      }\n      return;\n    }\n\n    const center = viewState.center;\n    const projection = viewState.projection;\n    const units = this.getUnits();\n    const pointResolutionUnits = units == 'degrees' ? 'degrees' : 'm';\n    let pointResolution = getPointResolution(\n      projection,\n      viewState.resolution,\n      center,\n      pointResolutionUnits\n    );\n\n    const minWidth =\n      (this.minWidth_ * (this.dpi_ || DEFAULT_DPI)) / DEFAULT_DPI;\n\n    const maxWidth =\n      this.maxWidth_ !== undefined\n        ? (this.maxWidth_ * (this.dpi_ || DEFAULT_DPI)) / DEFAULT_DPI\n        : undefined;\n\n    let nominalCount = minWidth * pointResolution;\n    let suffix = '';\n    if (units == 'degrees') {\n      const metersPerDegree = METERS_PER_UNIT.degrees;\n      nominalCount *= metersPerDegree;\n      if (nominalCount < metersPerDegree / 60) {\n        suffix = '\\u2033'; // seconds\n        pointResolution *= 3600;\n      } else if (nominalCount < metersPerDegree) {\n        suffix = '\\u2032'; // minutes\n        pointResolution *= 60;\n      } else {\n        suffix = '\\u00b0'; // degrees\n      }\n    } else if (units == 'imperial') {\n      if (nominalCount < 0.9144) {\n        suffix = 'in';\n        pointResolution /= 0.0254;\n      } else if (nominalCount < 1609.344) {\n        suffix = 'ft';\n        pointResolution /= 0.3048;\n      } else {\n        suffix = 'mi';\n        pointResolution /= 1609.344;\n      }\n    } else if (units == 'nautical') {\n      pointResolution /= 1852;\n      suffix = 'NM';\n    } else if (units == 'metric') {\n      if (nominalCount < 0.001) {\n        suffix = 'μm';\n        pointResolution *= 1000000;\n      } else if (nominalCount < 1) {\n        suffix = 'mm';\n        pointResolution *= 1000;\n      } else if (nominalCount < 1000) {\n        suffix = 'm';\n      } else {\n        suffix = 'km';\n        pointResolution /= 1000;\n      }\n    } else if (units == 'us') {\n      if (nominalCount < 0.9144) {\n        suffix = 'in';\n        pointResolution *= 39.37;\n      } else if (nominalCount < 1609.344) {\n        suffix = 'ft';\n        pointResolution /= 0.30480061;\n      } else {\n        suffix = 'mi';\n        pointResolution /= 1609.3472;\n      }\n    } else {\n      assert(false, 33); // Invalid units\n    }\n\n    let i = 3 * Math.floor(Math.log(minWidth * pointResolution) / Math.log(10));\n    let count, width, decimalCount;\n    let previousCount, previousWidth, previousDecimalCount;\n    while (true) {\n      decimalCount = Math.floor(i / 3);\n      const decimal = Math.pow(10, decimalCount);\n      count = LEADING_DIGITS[((i % 3) + 3) % 3] * decimal;\n      width = Math.round(count / pointResolution);\n      if (isNaN(width)) {\n        this.element.style.display = 'none';\n        this.renderedVisible_ = false;\n        return;\n      }\n      if (maxWidth !== undefined && width >= maxWidth) {\n        count = previousCount;\n        width = previousWidth;\n        decimalCount = previousDecimalCount;\n        break;\n      } else if (width >= minWidth) {\n        break;\n      }\n      previousCount = count;\n      previousWidth = width;\n      previousDecimalCount = decimalCount;\n      ++i;\n    }\n    const html = this.scaleBar_\n      ? this.createScaleBar(width, count, suffix)\n      : count.toFixed(decimalCount < 0 ? -decimalCount : 0) + ' ' + suffix;\n\n    if (this.renderedHTML_ != html) {\n      this.innerElement_.innerHTML = html;\n      this.renderedHTML_ = html;\n    }\n\n    if (this.renderedWidth_ != width) {\n      this.innerElement_.style.width = width + 'px';\n      this.renderedWidth_ = width;\n    }\n\n    if (!this.renderedVisible_) {\n      this.element.style.display = '';\n      this.renderedVisible_ = true;\n    }\n  }\n\n  /**\n   * @private\n   * @param {number} width The current width of the scalebar.\n   * @param {number} scale The current scale.\n   * @param {string} suffix The suffix to append to the scale text.\n   * @return {string} The stringified HTML of the scalebar.\n   */\n  createScaleBar(width, scale, suffix) {\n    const resolutionScale = this.getScaleForResolution();\n    const mapScale =\n      resolutionScale < 1\n        ? Math.round(1 / resolutionScale).toLocaleString() + ' : 1'\n        : '1 : ' + Math.round(resolutionScale).toLocaleString();\n    const steps = this.scaleBarSteps_;\n    const stepWidth = width / steps;\n    const scaleSteps = [this.createMarker('absolute')];\n    for (let i = 0; i < steps; ++i) {\n      const cls =\n        i % 2 === 0 ? 'ol-scale-singlebar-odd' : 'ol-scale-singlebar-even';\n      scaleSteps.push(\n        '<div>' +\n          '<div ' +\n          `class=\"ol-scale-singlebar ${cls}\" ` +\n          `style=\"width: ${stepWidth}px;\"` +\n          '>' +\n          '</div>' +\n          this.createMarker('relative') +\n          // render text every second step, except when only 2 steps\n          (i % 2 === 0 || steps === 2\n            ? this.createStepText(i, width, false, scale, suffix)\n            : '') +\n          '</div>'\n      );\n    }\n    // render text at the end\n    scaleSteps.push(this.createStepText(steps, width, true, scale, suffix));\n\n    const scaleBarText = this.scaleBarText_\n      ? `<div class=\"ol-scale-text\" style=\"width: ${width}px;\">` +\n        mapScale +\n        '</div>'\n      : '';\n    return scaleBarText + scaleSteps.join('');\n  }\n\n  /**\n   * Creates a marker at given position\n   * @param {'absolute'|'relative'} position The position, absolute or relative\n   * @return {string} The stringified div containing the marker\n   */\n  createMarker(position) {\n    const top = position === 'absolute' ? 3 : -10;\n    return (\n      '<div ' +\n      'class=\"ol-scale-step-marker\" ' +\n      `style=\"position: ${position}; top: ${top}px;\"` +\n      '></div>'\n    );\n  }\n\n  /**\n   * Creates the label for a marker marker at given position\n   * @param {number} i The iterator\n   * @param {number} width The width the scalebar will currently use\n   * @param {boolean} isLast Flag indicating if we add the last step text\n   * @param {number} scale The current scale for the whole scalebar\n   * @param {string} suffix The suffix for the scale\n   * @return {string} The stringified div containing the step text\n   */\n  createStepText(i, width, isLast, scale, suffix) {\n    const length =\n      i === 0 ? 0 : Math.round((scale / this.scaleBarSteps_) * i * 100) / 100;\n    const lengthString = length + (i === 0 ? '' : ' ' + suffix);\n    const margin = i === 0 ? -3 : (width / this.scaleBarSteps_) * -1;\n    const minWidth = i === 0 ? 0 : (width / this.scaleBarSteps_) * 2;\n    return (\n      '<div ' +\n      'class=\"ol-scale-step-text\" ' +\n      'style=\"' +\n      `margin-left: ${margin}px;` +\n      `text-align: ${i === 0 ? 'left' : 'center'};` +\n      `min-width: ${minWidth}px;` +\n      `left: ${isLast ? width + 'px' : 'unset'};` +\n      '\">' +\n      lengthString +\n      '</div>'\n    );\n  }\n\n  /**\n   * Returns the appropriate scale for the given resolution and units.\n   * @return {number} The appropriate scale.\n   */\n  getScaleForResolution() {\n    const resolution = getPointResolution(\n      this.viewState_.projection,\n      this.viewState_.resolution,\n      this.viewState_.center,\n      'm'\n    );\n    const dpi = this.dpi_ || DEFAULT_DPI;\n    const inchesPerMeter = 1000 / 25.4;\n    return resolution * inchesPerMeter * dpi;\n  }\n\n  /**\n   * Update the scale line element.\n   * @param {import(\"../MapEvent.js\").default} mapEvent Map event.\n   * @override\n   */\n  render(mapEvent) {\n    const frameState = mapEvent.frameState;\n    if (!frameState) {\n      this.viewState_ = null;\n    } else {\n      this.viewState_ = frameState.viewState;\n    }\n    this.updateElement_();\n  }\n}\n\nexport default ScaleLine;\n","/**\n * @module olcs.util\n */\nconst exports = {};\n\n\n/**\n * Cast to object.\n * @param {Object} param\n * @return {Object}\n */\nexports.obj = function(param) {\n  return param;\n};\n\n\n/**\n * @type {boolean|undefined}\n * @private\n */\nexports.supportsImageRenderingPixelatedResult_ = undefined;\n\n\n/**\n * @type {string|undefined}\n * @private\n */\nexports.imageRenderingValueResult_ = undefined;\n\n\n/**\n * @return {boolean}\n */\nexports.supportsImageRenderingPixelated = function() {\n  if (exports.supportsImageRenderingPixelatedResult_ === undefined) {\n    const canvas = document.createElement('canvas');\n    canvas.setAttribute('style', 'image-rendering: -moz-crisp-edges; image-rendering: pixelated;');\n    // canvas.style.imageRendering will be undefined, null or an\n    // empty string on unsupported browsers.\n    const tmp = canvas.style['imageRendering']; // non standard\n    exports.supportsImageRenderingPixelatedResult_ = !!tmp;\n    if (exports.supportsImageRenderingPixelatedResult_) {\n      exports.imageRenderingValueResult_ = tmp;\n    }\n  }\n  return exports.supportsImageRenderingPixelatedResult_;\n};\n\n\n/**\n * @return {string}\n */\nexports.imageRenderingValue = function() {\n  exports.supportsImageRenderingPixelated();\n  return exports.imageRenderingValueResult_ || '';\n};\n\n/**\n * Return the projection of the source that Cesium should use.\n *\n * @param {ol.source.Source} source Source.\n * @returns {ol.proj.Projection} The projection of the source.\n */\nexports.getSourceProjection = function(source) {\n  return /** @type {ol.proj.Projection} */ (source.get('olcs.projection'))\n    || source.getProjection();\n};\n\n/**\n * @param {ol.Observable} observable\n * @param {string} type\n * @param {Function} listener\n * @return {!ol.events.EventsKey}\n */\nexport function olcsListen(observable, type, listener) {\n  // See https://github.com/openlayers/openlayers/pull/8481\n  // ol.events.listen is internal so we use `on` instead.\n  // And since `on` as a convoluted API (can return an EventsKey or an array of them)\n  // we use a cast here.\n  return /** @type {!ol.events.EventsKey} */ (observable.on(type, listener));\n}\n\n/**\n * Counter for getUid.\n * @type {number}\n */\nlet uidCounter_ = 0;\n\n/**\n * Gets a unique ID for an object. This mutates the object so that further calls\n * with the same object as a parameter returns the same value. Unique IDs are generated\n * as a strictly increasing sequence. Adapted from goog.getUid.\n *\n * @param {Object} obj The object to get the unique ID for.\n * @return {number} The unique ID for the object.\n */\nexport function getUid(obj) {\n  return obj.olcs_uid || (obj.olcs_uid = ++uidCounter_);\n}\n\n/**\n * Sort the passed array such that the relative order of equal elements is preverved.\n * See https://en.wikipedia.org/wiki/Sorting_algorithm#Stability for details.\n * @param {Array<*>} arr The array to sort (modifies original).\n * @param {!function(*, *): number} compareFnc Comparison function.\n */\nexport function stableSort(arr, compareFnc) {\n  const length = arr.length;\n  const tmp = Array(arr.length);\n  for (let i = 0; i < length; i++) {\n    tmp[i] = {index: i, value: arr[i]};\n  }\n  tmp.sort((a, b) => compareFnc(a.value, b.value) || a.index - b.index);\n  for (let i = 0; i < arr.length; i++) {\n    arr[i] = tmp[i].value;\n  }\n}\n\n/**\n * @param {Node} node The node to remove.\n * @returns {Node} The node that was removed or null.\n */\nexport function removeNode(node) {\n  return node && node.parentNode ? node.parentNode.removeChild(node) : null;\n}\n\n/**\n * @param {Node} node The node to remove the children from.\n */\nexport function removeChildren(node) {\n  while (node.lastChild) {\n    node.removeChild(node.lastChild);\n  }\n}\n\n/**\n * @param {Cesium.Scene} scene The scene.\n */\nexport function isGroundPolylinePrimitiveSupported(scene) {\n  const obj = Cesium.GroundPolylinePrimitive;\n  return obj && obj.isSupported(scene);\n}\n\nexport default exports;\n","/**\n * @module olcs.core.OLImageryProvider\n */\nimport olcsUtil from '../util.js';\nimport {Tile as TileSource} from 'ol/source.js';\nimport {attributionsFunctionToCredits} from '../core.js';\n\n\nconst olUseNewCoordinates = (function() {\n  const tileSource = new TileSource({\n    projection: 'EPSG:3857',\n    wrapX: true\n  });\n  const tileCoord = tileSource.getTileCoordForTileUrlFunction([6, -31, 22]);\n  return tileCoord && tileCoord[1] === 33 && tileCoord[2] === 22;\n  // See b/test/spec/ol/source/tile.test.js\n  // of e9a30c5cb7e3721d9370025fbe5472c322847b35 in OpenLayers repository\n})();\n\n\nclass OLImageryProvider /* should not extend Cesium.ImageryProvider */ {\n  /**\n   * Special class derived from Cesium.ImageryProvider\n   * that is connected to the given ol.source.TileImage.\n   * @param {!ol.Map} olMap\n   * @param {!ol.source.TileImage} source\n   * @param {ol.proj.Projection=} opt_fallbackProj Projection to assume if the\n   *                                               projection of the source is not defined.\n   * @constructor\n   * @extends {Cesium.ImageryProvider}\n   */\n  constructor(olMap, source, opt_fallbackProj) {\n    // Do not extend or call super constructor from\n    // Cesium.ImageryProvider since this particular function is a\n    // 'non instanciable interface' which throws on instanciation.\n\n    /**\n     * @type {!ol.source.TileImage}\n     * @private\n     */\n    this.source_ = source;\n\n    /**\n     * @type {?ol.proj.Projection}\n     * @private\n     */\n    this.projection_ = null;\n\n    /**\n     * @type {?ol.proj.Projection}\n     * @private\n     */\n    this.fallbackProj_ = opt_fallbackProj || null;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.ready_ = false;\n\n    /**\n     * @type {?Cesium.TilingScheme}\n     * @private\n     */\n    this.tilingScheme_ = null;\n\n    /**\n     * @type {?Cesium.Rectangle}\n     * @private\n     */\n    this.rectangle_ = null;\n\n    /**\n     * @type {!ol.Map}\n     * @private\n     */\n    this.map_ = olMap;\n\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.shouldRequestNextLevel = false;\n\n    const proxy = this.source_.get('olcs.proxy');\n    if (proxy) {\n      if (typeof proxy === 'function') {\n        this.proxy_ = {\n          'getURL': proxy\n        };\n      } else if (typeof proxy === 'string') {\n        this.proxy_ = new Cesium.DefaultProxy(proxy);\n      }\n    }\n\n    this.errorEvent_ = new Cesium.Event();\n\n    this.emptyCanvas_ = document.createElement('canvas');\n    this.emptyCanvas_.width = 1;\n    this.emptyCanvas_.height = 1;\n\n    this.source_.on('change', (e) => {\n      this.handleSourceChanged_();\n    });\n    this.handleSourceChanged_();\n  }\n\n  /**\n   * Checks if the underlying source is ready and cached required data.\n   * @private\n   */\n  handleSourceChanged_(frameState) {\n    if (!this.ready_ && this.source_.getState() == 'ready') {\n      this.projection_ = olcsUtil.getSourceProjection(this.source_) || this.fallbackProj_;\n      const options = {numberOfLevelZeroTilesX: 1, numberOfLevelZeroTilesY: 1};\n\n      if (this.source_.tileGrid !== null) {\n        // Get the number of tiles at level 0 if it is defined\n        this.source_.tileGrid.forEachTileCoord(this.projection_.getExtent(), 0, ([zoom, xIndex, yIndex]) => {\n          options.numberOfLevelZeroTilesX = xIndex + 1;\n          options.numberOfLevelZeroTilesY = yIndex + 1;\n        });\n      }\n\n      if (this.projection_.getCode() === 'EPSG:4326') {\n        // Cesium zoom level 0 is OpenLayers zoom level 1 for layer in EPSG:4326 with a single tile on level 0\n        this.shouldRequestNextLevel = options.numberOfLevelZeroTilesX === 1 && options.numberOfLevelZeroTilesY === 1;\n        this.tilingScheme_ = new Cesium.GeographicTilingScheme(options);\n      } else if (this.projection_.getCode() === 'EPSG:3857') {\n        this.shouldRequestNextLevel = false;\n        this.tilingScheme_ = new Cesium.WebMercatorTilingScheme(options);\n      } else {\n        return;\n      }\n      this.rectangle_ = this.tilingScheme_.rectangle;\n\n      this.ready_ = true;\n    }\n  }\n\n  /**\n   * Generates the proper attributions for a given position and zoom\n   * level.\n   * @export\n   * @override\n   */\n  getTileCredits(x, y, level) {\n    const attributionsFunction = this.source_.getAttributions();\n    if (!attributionsFunction) {\n      return [];\n    }\n    const extent = this.map_.getView().calculateExtent(this.map_.getSize());\n    const center = this.map_.getView().getCenter();\n    const zoom = this.shouldRequestNextLevel ? level + 1 : level;\n    return attributionsFunctionToCredits(attributionsFunction, zoom, center, extent);\n  }\n\n  /**\n   * @export\n   * @override\n   */\n  requestImage(x, y, level) {\n    const tileUrlFunction = this.source_.getTileUrlFunction();\n    if (tileUrlFunction && this.projection_) {\n\n      const z_ = this.shouldRequestNextLevel ? level + 1 : level;\n\n      let y_ = y;\n      if (!olUseNewCoordinates) {\n        // OpenLayers version 3 to 5 tile coordinates increase from bottom to top\n        y_ = -y - 1;\n      }\n      let url = tileUrlFunction.call(this.source_, [z_, x, y_], 1, this.projection_);\n      if (this.proxy_) {\n        url = this.proxy_.getURL(url);\n      }\n      return url ? Cesium.ImageryProvider.loadImage(this, url) : this.emptyCanvas_;\n    } else {\n      // return empty canvas to stop Cesium from retrying later\n      return this.emptyCanvas_;\n    }\n  }\n}\n\n// definitions of getters that are required to be present\n// in the Cesium.ImageryProvider instance:\nObject.defineProperties(OLImageryProvider.prototype, {\n  'ready': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.ready_;}\n  },\n\n  'rectangle': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.rectangle_;}\n  },\n\n  'tileWidth': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {\n          const tg = this.source_.getTileGrid();\n          return tg ? (Array.isArray(tg.getTileSize(0)) ? tg.getTileSize(0)[0] : tg.getTileSize(0)) : 256;\n        }\n  },\n\n  'tileHeight': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {\n          const tg = this.source_.getTileGrid();\n          return tg ? (Array.isArray(tg.getTileSize(0)) ? tg.getTileSize(0)[1] : tg.getTileSize(0)) : 256;\n        }\n  },\n\n  'maximumLevel': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {\n          const tg = this.source_.getTileGrid();\n          return tg ? tg.getMaxZoom() : 18;\n        }\n  },\n\n  'minimumLevel': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {\n          // WARNING: Do not use the minimum level (at least until the extent is\n          // properly set). Cesium assumes the minimumLevel to contain only\n          // a few tiles and tries to load them all at once -- this can\n          // freeze and/or crash the browser !\n          return 0;\n          //var tg = this.source_.getTileGrid();\n          //return tg ? tg.getMinZoom() : 0;\n        }\n  },\n\n  'tilingScheme': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.tilingScheme_;}\n  },\n\n  'tileDiscardPolicy': {\n    'get': function() {return undefined;}\n  },\n\n  'errorEvent': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.errorEvent_;}\n  },\n\n  'proxy': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.proxy_;}\n  },\n\n  'hasAlphaChannel': {\n    'get': function() {return true;}\n  },\n\n  'pickFeatures': {\n    'get': function() {return undefined;}\n  }\n});\n\n\nexport default OLImageryProvider;\n","import MVT from 'ol/format/MVT.js';\nimport Style from 'ol/style/Style.js';\nimport Stroke from 'ol/style/Stroke.js';\nimport {toContext} from 'ol/render.js';\nimport {get as getProjection} from 'ol/proj.js';\nimport {VERSION as OL_VERSION} from 'ol/util.js';\nimport LRUCache from 'ol/structs/LRUCache.js';\nimport {getForProjection as getTilegridForProjection} from 'ol/tilegrid.js';\nimport {createFromTemplates as createTileUrlFunctions} from 'ol/tileurlfunction.js';\n\n\nconst format = new MVT();\nconst styles = [new Style({\n  stroke: new Stroke({\n    color: 'blue',\n    width: 2\n  })\n})];\n\n\nexport default class MVTImageryProvider {\n  constructor(options) {\n    this.urls = options.urls;\n    this.ready = true;\n    this.readyPromise = Promise.resolve(true);\n    this.tileWidth = 256;\n    this.tileHeight = 256;\n    this.maximumLevel = options.maximumLevel || 20;\n    this.minimumLevel = options.minimumLevel || 0;\n    this.tilingScheme = new Cesium.WebMercatorTilingScheme;\n    this.rectangle = options.rectangle || this.tilingScheme.rectangle;\n    this.errorEvent = new Cesium.Event();\n    this.credit = options.credit;\n    this.hasAlphaChannel = true;\n    this.styleFunction_ = options.styleFunction || (() => styles);\n    this.projection_ = getProjection('EPSG:3857');\n    this.emptyCanvas_ = document.createElement('canvas');\n    this.emptyCanvas_.width = 1;\n    this.emptyCanvas_.height = 1;\n    this.tileRectangle_ = new Cesium.Rectangle();\n    const cacheSize = options.cacheSize !== undefined ? options.cacheSize : 50;\n    this.tileCache = new LRUCache(cacheSize);\n    this.featureCache = options.featureCache || new LRUCache(cacheSize);\n    // to avoid too frequent cache grooming we allow x2 capacity\n\n    const tileGrid = getTilegridForProjection(this.projection_);\n    this.tileFunction_ = createTileUrlFunctions(this.urls, tileGrid);\n  }\n\n  getTileCredits() {\n    return [];\n  }\n\n  pickFeatures() {\n  }\n\n\n  getTileFeatures(z, x, y) {\n    const cacheKey = this.getCacheKey_(z, x, y);\n    let promise;\n    if (this.featureCache.containsKey(cacheKey)) {\n      promise = this.featureCache.get(cacheKey);\n    }\n    if (!promise) {\n      const url = this.getUrl_(z, x, y);\n      promise = fetch(url)\n          .then(r => (r.ok ? r : Promise.reject(r)))\n          .then(r => r.arrayBuffer())\n          .then(buffer => this.readFeaturesFromBuffer(buffer));\n      this.featureCache.set(cacheKey, promise);\n      if (this.featureCache.getCount() > 2 * this.featureCache.highWaterMark) {\n        while (this.featureCache.canExpireCache()) {\n          this.featureCache.pop();\n        }\n      }\n    }\n    return promise;\n  }\n\n  readFeaturesFromBuffer(buffer) {\n    let options;\n    if (OL_VERSION <= '6.4.4') {\n      // See https://github.com/openlayers/openlayers/pull/11540\n      options = {\n        extent: [0, 0, 4096, 4096],\n        dataProjection: format.dataProjection,\n        featureProjection: format.dataProjection\n      };\n    }\n    const features = format.readFeatures(buffer, options);\n    const scaleFactor = this.tileWidth / 4096;\n    features.forEach((f) => {\n      const flatCoordinates = f.getFlatCoordinates();\n      let flip = false;\n      for (let i = 0; i < flatCoordinates.length; ++i) {\n        flatCoordinates[i] *= scaleFactor;\n        if (flip) {\n          // FIXME: why do we need this now?\n          flatCoordinates[i] = this.tileWidth - flatCoordinates[i];\n        }\n        if (OL_VERSION <= '6.4.4') {\n          flip = !flip;\n        }\n      }\n    });\n\n    return features;\n  }\n\n  getUrl_(z, x, y) {\n    const url = this.tileFunction_([z, x, y]);\n    return url;\n  }\n\n  getCacheKey_(z, x, y) {\n    return `${z}_${x}_${y}`;\n  }\n\n  requestImage(x, y, z, request) {\n    if (z < this.minimumLevel) {\n      return this.emptyCanvas_;\n    }\n\n    try {\n      const cacheKey = this.getCacheKey_(z, x, y);\n      let promise;\n      if (this.tileCache.containsKey(cacheKey)) {\n        promise = this.tileCache.get(cacheKey);\n      }\n      if (!promise) {\n        promise = this.getTileFeatures(z, x, y)\n            .then((features) => {\n            // FIXME: here we suppose the 2D projection is in meters\n              this.tilingScheme.tileXYToNativeRectangle(x, y, z, this.tileRectangle_);\n              const resolution = (this.tileRectangle_.east - this.tileRectangle_.west) / this.tileWidth;\n              return this.rasterizeFeatures(features, this.styleFunction_, resolution);\n            });\n        this.tileCache.set(cacheKey, promise);\n        if (this.tileCache.getCount() > 2 * this.tileCache.highWaterMark) {\n          while (this.tileCache.canExpireCache()) {\n            this.tileCache.pop();\n          }\n        }\n      }\n      return promise;\n    } catch (e) {\n      console.trace(e);\n      this.raiseEvent('could not render pbf to tile', e);\n    }\n  }\n\n  rasterizeFeatures(features, styleFunction, resolution) {\n    const canvas = document.createElement('canvas');\n    const vectorContext = toContext(canvas.getContext('2d'), {size: [this.tileWidth, this.tileHeight]});\n    features.forEach((f) => {\n      const styles = styleFunction(f, resolution);\n      if (styles) {\n        styles.forEach((style) => {\n          vectorContext.setStyle(style);\n          vectorContext.drawGeometry(f);\n        });\n      }\n    });\n    return canvas;\n  }\n}\n","/**\n * @module olcs.core\n */\nimport {linear as linearEasing} from 'ol/easing.js';\nimport olLayerTile from 'ol/layer/Tile.js';\nimport olLayerImage from 'ol/layer/Image.js';\nimport {get as getProjection, transformExtent} from 'ol/proj.js';\nimport olSourceImageStatic from 'ol/source/ImageStatic.js';\nimport olSourceImageWMS from 'ol/source/ImageWMS.js';\nimport olSourceTileImage from 'ol/source/TileImage.js';\nimport olSourceTileWMS from 'ol/source/TileWMS.js';\nimport olSourceVectorTile from 'ol/source/VectorTile.js';\nimport {defaultImageLoadFunction} from 'ol/source/Image.js';\nimport olcsCoreOLImageryProvider from './core/OLImageryProvider.js';\nimport olcsUtil from './util.js';\nimport MVTImageryProvider from './MVTImageryProvider.js';\nimport VectorTileLayer from 'ol/layer/VectorTile.js';\nimport {getCenter as getExtentCenter} from 'ol/extent';\n\nconst exports = {};\n\n\n/**\n * @typedef {Object} CesiumUrlDefinition\n * @property {string} url\n * @property {string} subdomains\n */\n\n\n/**\n * Options for rotate around axis core function.\n * @typedef {Object} RotateAroundAxisOption\n * @property {number} [duration]\n * @property {function(number): number} [easing]\n * @property {function(): void} [callback]\n */\n\n\n\n/**\n * @typedef {Object} LayerWithParents\n * @property {import('ol/layer/Base.js').default} layer\n * @property {Array<import('ol/layer/Group.js').default>} parents\n */\n\n\n/**\n * Compute the pixel width and height of a point in meters using the\n * camera frustum.\n * @param {!Cesium.Scene} scene\n * @param {!Cesium.Cartesian3} target\n * @return {!Cesium.Cartesian2} the pixel size\n * @api\n */\nexports.computePixelSizeAtCoordinate = function(scene, target) {\n  const camera = scene.camera;\n  const canvas = scene.canvas;\n  const frustum = camera.frustum;\n  const distance = Cesium.Cartesian3.magnitude(Cesium.Cartesian3.subtract(\n      camera.position, target, new Cesium.Cartesian3()));\n  return frustum.getPixelDimensions(canvas.clientWidth, canvas.clientHeight,\n      distance, scene.pixelRatio, new Cesium.Cartesian2());\n};\n\n\n/**\n * Compute bounding box around a target point.\n * @param {!Cesium.Scene} scene\n * @param {!Cesium.Cartesian3} target\n * @param {number} amount Half the side of the box, in pixels.\n * @return {Array<Cesium.Cartographic>} bottom left and top right\n * coordinates of the box\n */\nexports.computeBoundingBoxAtTarget = function(scene, target, amount) {\n  const pixelSize = exports.computePixelSizeAtCoordinate(scene, target);\n  const transform = Cesium.Transforms.eastNorthUpToFixedFrame(target);\n\n  const bottomLeft = Cesium.Matrix4.multiplyByPoint(\n      transform,\n      new Cesium.Cartesian3(-pixelSize.x * amount, -pixelSize.y * amount, 0),\n      new Cesium.Cartesian3());\n\n  const topRight = Cesium.Matrix4.multiplyByPoint(\n      transform,\n      new Cesium.Cartesian3(pixelSize.x * amount, pixelSize.y * amount, 0),\n      new Cesium.Cartesian3());\n\n  return Cesium.Ellipsoid.WGS84.cartesianArrayToCartographicArray(\n      [bottomLeft, topRight]);\n};\n\n\n/**\n *\n * @param {!ol.geom.Geometry} geometry\n * @param {number} height\n * @api\n */\nexports.applyHeightOffsetToGeometry = function(geometry, height) {\n  geometry.applyTransform((input, output, stride) => {\n    console.assert(input === output);\n    if (stride !== undefined && stride >= 3) {\n      for (let i = 0; i < output.length; i += stride) {\n        output[i + 2] = output[i + 2] + height;\n      }\n    }\n    return output;\n  });\n};\n\n\n/**\n * @param {ol.Coordinate} coordinates\n * @param {number=} rotation\n * @param {!Cesium.Cartesian3=} translation\n * @param {!Cesium.Cartesian3=} scale\n * @return {!Cesium.Matrix4}\n * @api\n */\nexports.createMatrixAtCoordinates = function(coordinates, rotation = 0, translation = Cesium.Cartesian3.ZERO, scale = new Cesium.Cartesian3(1, 1, 1)) {\n  const position = exports.ol4326CoordinateToCesiumCartesian(coordinates);\n  const rawMatrix = Cesium.Transforms.eastNorthUpToFixedFrame(position);\n  const quaternion = Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Z, -rotation);\n  const rotationMatrix = Cesium.Matrix4.fromTranslationQuaternionRotationScale(translation, quaternion, scale);\n  return Cesium.Matrix4.multiply(rawMatrix, rotationMatrix, new Cesium.Matrix4());\n};\n\n\n/**\n * @param {!Cesium.Camera} camera\n * @param {number} angle\n * @param {!Cesium.Cartesian3} axis\n * @param {!Cesium.Matrix4} transform\n * @param {RotateAroundAxisOption=} opt_options\n * @api\n */\nexports.rotateAroundAxis = function(camera, angle, axis, transform,\n    opt_options) {\n  const clamp = Cesium.Math.clamp;\n  const defaultValue = Cesium.defaultValue;\n\n  const options = opt_options || {};\n  const duration = defaultValue(options.duration, 500); // ms\n  const easing = defaultValue(options.easing, linearEasing);\n  const callback = options.callback;\n\n  let lastProgress = 0;\n  const oldTransform = new Cesium.Matrix4();\n\n  const start = Date.now();\n  const step = function() {\n    const timestamp = Date.now();\n    const timeDifference = timestamp - start;\n    const progress = easing(clamp(timeDifference / duration, 0, 1));\n    console.assert(progress >= lastProgress);\n\n    camera.transform.clone(oldTransform);\n    const stepAngle = (progress - lastProgress) * angle;\n    lastProgress = progress;\n    camera.lookAtTransform(transform);\n    camera.rotate(axis, stepAngle);\n    camera.lookAtTransform(oldTransform);\n\n    if (progress < 1) {\n      window.requestAnimationFrame(step);\n    } else {\n      if (callback) {\n        callback();\n      }\n    }\n  };\n  window.requestAnimationFrame(step);\n};\n\n\n/**\n * @param {!Cesium.Scene} scene\n * @param {number} heading\n * @param {!Cesium.Cartesian3} bottomCenter\n * @param {RotateAroundAxisOption=} opt_options\n * @api\n */\nexports.setHeadingUsingBottomCenter = function(scene, heading,\n    bottomCenter, opt_options) {\n  const camera = scene.camera;\n  // Compute the camera position to zenith quaternion\n  const angleToZenith = exports.computeAngleToZenith(scene, bottomCenter);\n  const axis = camera.right;\n  const quaternion = Cesium.Quaternion.fromAxisAngle(axis, angleToZenith);\n  const rotation = Cesium.Matrix3.fromQuaternion(quaternion);\n\n  // Get the zenith point from the rotation of the position vector\n  const vector = new Cesium.Cartesian3();\n  Cesium.Cartesian3.subtract(camera.position, bottomCenter, vector);\n  const zenith = new Cesium.Cartesian3();\n  Cesium.Matrix3.multiplyByVector(rotation, vector, zenith);\n  Cesium.Cartesian3.add(zenith, bottomCenter, zenith);\n\n  // Actually rotate around the zenith normal\n  const transform = Cesium.Matrix4.fromTranslation(zenith);\n  const rotateAroundAxis = exports.rotateAroundAxis;\n  rotateAroundAxis(camera, heading, zenith, transform, opt_options);\n};\n\n\n/**\n * Get the 3D position of the given pixel of the canvas.\n * @param {!Cesium.Scene} scene\n * @param {!Cesium.Cartesian2} pixel\n * @return {!Cesium.Cartesian3|undefined}\n * @api\n */\nexports.pickOnTerrainOrEllipsoid = function(scene, pixel) {\n  const ray = scene.camera.getPickRay(pixel);\n  const target = scene.globe.pick(ray, scene);\n  return target || scene.camera.pickEllipsoid(pixel);\n};\n\n\n/**\n * Get the 3D position of the point at the bottom-center of the screen.\n * @param {!Cesium.Scene} scene\n * @return {!Cesium.Cartesian3|undefined}\n * @api\n */\nexports.pickBottomPoint = function(scene) {\n  const canvas = scene.canvas;\n  const bottom = new Cesium.Cartesian2(\n      canvas.clientWidth / 2, canvas.clientHeight);\n  return exports.pickOnTerrainOrEllipsoid(scene, bottom);\n};\n\n\n/**\n * Get the 3D position of the point at the center of the screen.\n * @param {!Cesium.Scene} scene\n * @return {!Cesium.Cartesian3|undefined}\n * @api\n */\nexports.pickCenterPoint = function(scene) {\n  const canvas = scene.canvas;\n  const center = new Cesium.Cartesian2(\n      canvas.clientWidth / 2,\n      canvas.clientHeight / 2);\n  return exports.pickOnTerrainOrEllipsoid(scene, center);\n};\n\n\n/**\n * Compute the signed tilt angle on globe, between the opposite of the\n * camera direction and the target normal. Return undefined if there is no\n * intersection of the camera direction with the globe.\n * @param {!Cesium.Scene} scene\n * @return {number|undefined}\n * @api\n */\nexports.computeSignedTiltAngleOnGlobe = function(scene) {\n  const camera = scene.camera;\n  const ray = new Cesium.Ray(camera.position, camera.direction);\n  let target = scene.globe.pick(ray, scene);\n\n  if (!target) {\n    // no tiles in the area were loaded?\n    const ellipsoid = Cesium.Ellipsoid.WGS84;\n    const obj = Cesium.IntersectionTests.rayEllipsoid(ray, ellipsoid);\n    if (obj) {\n      target = Cesium.Ray.getPoint(ray, obj.start);\n    }\n  }\n\n  if (!target) {\n    return undefined;\n  }\n\n  const normal = new Cesium.Cartesian3();\n  Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(target, normal);\n\n  const angleBetween = exports.signedAngleBetween;\n  const angle = angleBetween(camera.direction, normal, camera.right) - Math.PI;\n  return Cesium.Math.convertLongitudeRange(angle);\n};\n\n\n/**\n * Compute the ray from the camera to the bottom-center of the screen.\n * @param {!Cesium.Scene} scene\n * @return {!Cesium.Ray}\n */\nexports.bottomFovRay = function(scene) {\n  const camera = scene.camera;\n  const fovy2 = camera.frustum.fovy / 2;\n  const direction = camera.direction;\n  const rotation = Cesium.Quaternion.fromAxisAngle(camera.right, fovy2);\n  const matrix = Cesium.Matrix3.fromQuaternion(rotation);\n  const vector = new Cesium.Cartesian3();\n  Cesium.Matrix3.multiplyByVector(matrix, direction, vector);\n  return new Cesium.Ray(camera.position, vector);\n};\n\n\n/**\n * Compute the angle between two Cartesian3.\n * @param {!Cesium.Cartesian3} first\n * @param {!Cesium.Cartesian3} second\n * @param {!Cesium.Cartesian3} normal Normal to test orientation against.\n * @return {number}\n */\nexports.signedAngleBetween = function(first, second, normal) {\n  // We are using the dot for the angle.\n  // Then the cross and the dot for the sign.\n  const a = new Cesium.Cartesian3();\n  const b = new Cesium.Cartesian3();\n  const c = new Cesium.Cartesian3();\n  Cesium.Cartesian3.normalize(first, a);\n  Cesium.Cartesian3.normalize(second, b);\n  Cesium.Cartesian3.cross(a, b, c);\n\n  const cosine = Cesium.Cartesian3.dot(a, b);\n  const sine = Cesium.Cartesian3.magnitude(c);\n\n  // Sign of the vector product and the orientation normal\n  const sign = Cesium.Cartesian3.dot(normal, c);\n  const angle = Math.atan2(sine, cosine);\n  return sign >= 0 ? angle : -angle;\n};\n\n\n/**\n * Compute the rotation angle around a given point, needed to reach the\n * zenith position.\n * At a zenith position, the camera direction is going througth the earth\n * center and the frustrum bottom ray is going through the chosen pivot\n * point.\n * The bottom-center of the screen is a good candidate for the pivot point.\n * @param {!Cesium.Scene} scene\n * @param {!Cesium.Cartesian3} pivot Point around which the camera rotates.\n * @return {number}\n * @api\n */\nexports.computeAngleToZenith = function(scene, pivot) {\n  // This angle is the sum of the angles 'fy' and 'a', which are defined\n  // using the pivot point and its surface normal.\n  //        Zenith |    camera\n  //           \\   |   /\n  //            \\fy|  /\n  //             \\ |a/\n  //              \\|/pivot\n  const camera = scene.camera;\n  const fy = camera.frustum.fovy / 2;\n  const ray = exports.bottomFovRay(scene);\n  const direction = Cesium.Cartesian3.clone(ray.direction);\n  Cesium.Cartesian3.negate(direction, direction);\n\n  const normal = new Cesium.Cartesian3();\n  Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(pivot, normal);\n\n  const left = new Cesium.Cartesian3();\n  Cesium.Cartesian3.negate(camera.right, left);\n\n  const a = exports.signedAngleBetween(normal, direction, left);\n  return a + fy;\n};\n\n\n/**\n * Convert an OpenLayers extent to a Cesium rectangle.\n * @param {ol.Extent} extent Extent.\n * @param {ol.ProjectionLike} projection Extent projection.\n * @return {Cesium.Rectangle} The corresponding Cesium rectangle.\n * @api\n */\nexports.extentToRectangle = function(extent, projection) {\n  if (extent && projection) {\n    const ext = transformExtent(extent, projection, 'EPSG:4326');\n    return Cesium.Rectangle.fromDegrees(ext[0], ext[1], ext[2], ext[3]);\n  } else {\n    return null;\n  }\n};\n\n\n/**\n * @param {!ol.Map} olMap\n * @param {!ol.source.Source} source\n * @param {!ol.View} viewProj\n * @param {!ol.layer.Base} olLayer\n * @return {!Cesium.ImageryProvider}\n */\nexports.sourceToImageryProvider = function(olMap, source, viewProj, olLayer) {\n  const skip = source.get('olcs_skip');\n  if (skip) {\n    return null;\n  }\n  let provider = null;\n  // Convert ImageWMS to TileWMS\n  if (source instanceof olSourceImageWMS && source.getUrl() &&\n    source.getImageLoadFunction() === defaultImageLoadFunction) {\n    const sourceProps = {\n      'olcs.proxy': source.get('olcs.proxy'),\n      'olcs.extent': source.get('olcs.extent'),\n      'olcs.projection': source.get('olcs.projection'),\n      'olcs.imagesource': source\n    };\n    source = new olSourceTileWMS({\n      url: source.getUrl(),\n      attributions: source.getAttributions(),\n      projection: source.getProjection(),\n      params: source.getParams()\n    });\n    source.setProperties(sourceProps);\n  }\n\n  if (source instanceof olSourceTileImage) {\n    let projection = olcsUtil.getSourceProjection(source);\n\n    if (!projection) {\n      // if not explicit, assume the same projection as view\n      projection = viewProj;\n    }\n\n    if (exports.isCesiumProjection(projection)) {\n      provider = new olcsCoreOLImageryProvider(olMap, source, viewProj);\n    }\n    // Projection not supported by Cesium\n    else {\n      return null;\n    }\n  } else if (source instanceof olSourceImageStatic) {\n    let projection = olcsUtil.getSourceProjection(source);\n    if (!projection) {\n      projection = viewProj;\n    }\n    if (exports.isCesiumProjection(projection)) {\n      provider = new Cesium.SingleTileImageryProvider({\n        url: source.getUrl(),\n        rectangle: new Cesium.Rectangle.fromDegrees(\n            source.getImageExtent()[0],\n            source.getImageExtent()[1],\n            source.getImageExtent()[2],\n            source.getImageExtent()[3]\n        )\n      });\n    }\n    // Projection not supported by Cesium\n    else {\n      return null;\n    }\n  } else if (source instanceof olSourceVectorTile) {\n    let projection = olcsUtil.getSourceProjection(source);\n\n    if (!projection) {\n      projection = viewProj;\n    }\n    if (skip === false) {\n      // MVT is experimental, it should be whitelisted to be synchronized\n      const fromCode = projection.getCode().split(':')[1];\n      const urls = source.urls.map(u => u.replace(fromCode, '3857'));\n      const extent = olLayer.getExtent();\n      const rectangle = exports.extentToRectangle(extent, projection);\n      const minimumLevel = source.get('olcs_minimumLevel');\n      const attributionsFunction = source.getAttributions();\n      const styleFunction = olLayer.getStyleFunction();\n      let credit;\n      if (extent && attributionsFunction) {\n        const center = getExtentCenter(extent);\n        credit = attributionsFunctionToCredits(attributionsFunction, 0, center, extent)[0];\n      }\n\n      provider = new MVTImageryProvider({\n        credit,\n        rectangle,\n        minimumLevel,\n        styleFunction,\n        urls\n      });\n      return provider;\n    }\n    return null; // FIXME: it is disabled by default right now\n  } else {\n    // sources other than TileImage|ImageStatic are currently not supported\n    return null;\n  }\n  return provider;\n};\n\n/**\n * Creates Cesium.ImageryLayer best corresponding to the given ol.layer.Layer.\n * Only supports raster layers and static images\n * @param {!ol.Map} olMap\n * @param {!ol.layer.Base} olLayer\n * @param {!ol.proj.Projection} viewProj Projection of the view.\n * @return {?Cesium.ImageryLayer} null if not possible (or supported)\n * @api\n */\nexports.tileLayerToImageryLayer = function(olMap, olLayer, viewProj) {\n\n  if (!(olLayer instanceof olLayerTile) && !(olLayer instanceof olLayerImage) &&\n    !(olLayer instanceof VectorTileLayer)) {\n    return null;\n  }\n\n  const source = olLayer.getSource();\n  if (!source) {\n    return null;\n  }\n  let provider = source.get('olcs_provider');\n  if (!provider) {\n    provider = this.sourceToImageryProvider(olMap, source, viewProj, olLayer);\n  }\n  if (!provider) {\n    return null;\n  }\n\n  const layerOptions = {};\n\n  const forcedExtent = /** @type {ol.Extent} */ (olLayer.get('olcs.extent'));\n  const ext = forcedExtent || olLayer.getExtent();\n  if (ext) {\n    layerOptions.rectangle = exports.extentToRectangle(ext, viewProj);\n  }\n\n  const cesiumLayer = new Cesium.ImageryLayer(provider, layerOptions);\n  return cesiumLayer;\n};\n\n\n/**\n * Synchronizes the layer rendering properties (opacity, visible)\n * to the given Cesium ImageryLayer.\n * @param {olcsx.LayerWithParents} olLayerWithParents\n * @param {!Cesium.ImageryLayer} csLayer\n * @api\n */\nexports.updateCesiumLayerProperties = function(olLayerWithParents, csLayer) {\n  let opacity = 1;\n  let visible = true;\n  [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayer) => {\n    const layerOpacity = olLayer.getOpacity();\n    if (layerOpacity !== undefined) {\n      opacity *= layerOpacity;\n    }\n    const layerVisible = olLayer.getVisible();\n    if (layerVisible !== undefined) {\n      visible &= layerVisible;\n    }\n  });\n  csLayer.alpha = opacity;\n  csLayer.show = visible;\n};\n\n\n/**\n * Convert a 2D or 3D OpenLayers coordinate to Cesium.\n * @param {ol.Coordinate} coordinate Ol3 coordinate.\n * @return {!Cesium.Cartesian3} Cesium cartesian coordinate\n * @api\n */\nexports.ol4326CoordinateToCesiumCartesian = function(coordinate) {\n  const coo = coordinate;\n  return coo.length > 2 ?\n    Cesium.Cartesian3.fromDegrees(coo[0], coo[1], coo[2]) :\n    Cesium.Cartesian3.fromDegrees(coo[0], coo[1]);\n};\n\n\n/**\n * Convert an array of 2D or 3D OpenLayers coordinates to Cesium.\n * @param {Array.<!ol.Coordinate>} coordinates Ol3 coordinates.\n * @return {!Array.<Cesium.Cartesian3>} Cesium cartesian coordinates\n * @api\n */\nexports.ol4326CoordinateArrayToCsCartesians = function(coordinates) {\n  console.assert(coordinates !== null);\n  const toCartesian = exports.ol4326CoordinateToCesiumCartesian;\n  const cartesians = [];\n  for (let i = 0; i < coordinates.length; ++i) {\n    cartesians.push(toCartesian(coordinates[i]));\n  }\n  return cartesians;\n};\n\n\n/**\n * Reproject an OpenLayers geometry to EPSG:4326 if needed.\n * The geometry will be cloned only when original projection is not EPSG:4326\n * and the properties will be shallow copied.\n * @param {!T} geometry\n * @param {!ol.ProjectionLike} projection\n * @return {!T}\n * @template T\n * @api\n */\nexports.olGeometryCloneTo4326 = function(geometry, projection) {\n  console.assert(projection);\n\n  const proj4326 = getProjection('EPSG:4326');\n  const proj = getProjection(projection);\n  if (proj.getCode() !== proj4326.getCode()) {\n    const properties = geometry.getProperties();\n    geometry = geometry.clone();\n    geometry.transform(proj, proj4326);\n    geometry.setProperties(properties);\n  }\n  return geometry;\n};\n\n\n/**\n * Convert an OpenLayers color to Cesium.\n * @param {ol.Color|CanvasGradient|CanvasPattern|string} olColor\n * @return {!Cesium.Color}\n * @api\n */\nexports.convertColorToCesium = function(olColor) {\n  olColor = olColor || 'black';\n  if (Array.isArray(olColor)) {\n    return new Cesium.Color(\n        Cesium.Color.byteToFloat(olColor[0]),\n        Cesium.Color.byteToFloat(olColor[1]),\n        Cesium.Color.byteToFloat(olColor[2]),\n        olColor[3]\n    );\n  } else if (typeof olColor == 'string') {\n    return Cesium.Color.fromCssColorString(olColor);\n  } else if (olColor instanceof CanvasPattern || olColor instanceof CanvasGradient) {\n    // Render the CanvasPattern/CanvasGradient into a canvas that will be sent to Cesium as material\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d');\n    canvas.width = canvas.height = 256;\n    ctx.fillStyle = olColor;\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n    return new Cesium.ImageMaterialProperty({\n      image: canvas\n    });\n  }\n  console.assert(false, 'impossible');\n};\n\n\n/**\n * Convert an OpenLayers url to Cesium.\n * @param {string} url\n * @return {!CesiumUrlDefinition}\n * @api\n */\nexports.convertUrlToCesium = function(url) {\n  let subdomains = '';\n  const re = /\\{(\\d|[a-z])-(\\d|[a-z])\\}/;\n  const match = re.exec(url);\n  if (match) {\n    url = url.replace(re, '{s}');\n    const startCharCode = match[1].charCodeAt(0);\n    const stopCharCode = match[2].charCodeAt(0);\n    let charCode;\n    for (charCode = startCharCode; charCode <= stopCharCode; ++charCode) {\n      subdomains += String.fromCharCode(charCode);\n    }\n  }\n  return {\n    url,\n    subdomains\n  };\n};\n\n\n/**\n * Animate the return to a top-down view from the zenith.\n * The camera is rotated to orient to the North.\n * @param {!ol.Map} map\n * @param {!Cesium.Scene} scene\n * @return {Promise<undefined>}\n * @api\n */\nexports.resetToNorthZenith = function(map, scene) {\n  return new Promise((resolve, reject) => {\n    const camera = scene.camera;\n    const pivot = exports.pickBottomPoint(scene);\n    if (!pivot) {\n      reject('Could not get bottom pivot');\n      return;\n    }\n\n    const currentHeading = map.getView().getRotation();\n    if (currentHeading === undefined) {\n      reject('The view is not initialized');\n      return;\n    }\n    const angle = exports.computeAngleToZenith(scene, pivot);\n\n    // Point to North\n    exports.setHeadingUsingBottomCenter(scene, currentHeading, pivot);\n\n    // Go to zenith\n    const transform = Cesium.Matrix4.fromTranslation(pivot);\n    const axis = camera.right;\n    const options = {\n      callback: () => {\n        const view = map.getView();\n        exports.normalizeView(view);\n        resolve();\n      }\n    };\n    exports.rotateAroundAxis(camera, -angle, axis, transform, options);\n  });\n};\n\n\n/**\n * @param {!Cesium.Scene} scene\n * @param {number} angle in radian\n * @return {Promise<undefined>}\n * @api\n */\nexports.rotateAroundBottomCenter = function(scene, angle) {\n  return new Promise((resolve, reject) => {\n    const camera = scene.camera;\n    const pivot = exports.pickBottomPoint(scene);\n    if (!pivot) {\n      reject('could not get bottom pivot');\n      return;\n    }\n\n    const options = {callback: resolve};\n    const transform = Cesium.Matrix4.fromTranslation(pivot);\n    const axis = camera.right;\n    const rotateAroundAxis = exports.rotateAroundAxis;\n    rotateAroundAxis(camera, -angle, axis, transform, options);\n  });\n};\n\n\n/**\n * Set the OpenLayers view to a specific rotation and\n * the nearest resolution.\n * @param {ol.View} view\n * @param {number=} angle\n * @api\n */\nexports.normalizeView = function(view, angle = 0) {\n  const resolution = view.getResolution();\n  view.setRotation(angle);\n  if (view.constrainResolution) {\n    view.setResolution(view.constrainResolution(resolution));\n  } else {\n    view.setResolution(view.getConstrainedResolution(resolution));\n  }\n};\n\n/**\n * Check if the given projection is managed by Cesium (WGS84 or Mercator Spheric)\n *\n * @param {ol.proj.Projection} projection Projection to check.\n * @returns {boolean} Whether it's managed by Cesium.\n */\nexports.isCesiumProjection = function(projection) {\n  const is3857 = projection.getCode() === 'EPSG:3857';\n  const is4326 = projection.getCode() === 'EPSG:4326';\n  return is3857 || is4326;\n};\n\n\nexport function attributionsFunctionToCredits(attributionsFunction, zoom, center, extent) {\n  const frameState = {\n    viewState: {zoom, center},\n    extent,\n  };\n\n  if (!attributionsFunction) {\n    return [];\n  }\n  let attributions = attributionsFunction(frameState);\n  if (!Array.isArray(attributions)) {\n    attributions = [attributions];\n  }\n\n  return attributions.map(html => new Cesium.Credit(html, true));\n}\n\nexport default exports;\n\n\n/**\n * calculate the distance between camera and centerpoint based on the resolution and latitude value\n * @param {number} resolution Number of map units per pixel.\n * @param {number} latitude Latitude in radians.\n * @param {import('cesium').Scene} scene.\n * @param {import('ol/proj/Projection').default} projection View projection.\n * @return {number} The calculated distance.\n * @api\n */\nexport function calcDistanceForResolution(resolution, latitude, scene, projection) {\n  const canvas = scene.canvas;\n  const camera = scene.camera;\n  const fovy = camera.frustum.fovy; // vertical field of view\n  console.assert(!isNaN(fovy));\n  const metersPerUnit = projection.getMetersPerUnit();\n\n  // number of \"map units\" visible in 2D (vertically)\n  const visibleMapUnits = resolution * canvas.clientHeight;\n\n  // The metersPerUnit does not take latitude into account, but it should\n  // be lower with increasing latitude -- we have to compensate.\n  // In 3D it is not possible to maintain the resolution at more than one point,\n  // so it only makes sense to use the latitude of the \"target\" point.\n  const relativeCircumference = Math.cos(Math.abs(latitude));\n\n  // how many meters should be visible in 3D\n  const visibleMeters = visibleMapUnits * metersPerUnit * relativeCircumference;\n\n  // distance required to view the calculated length in meters\n  //\n  //  fovy/2\n  //    |\\\n  //  x | \\\n  //    |--\\\n  // visibleMeters/2\n  const requiredDistance = (visibleMeters / 2) / Math.tan(fovy / 2);\n\n  // NOTE: This calculation is not absolutely precise, because metersPerUnit\n  // is a great simplification. It does not take ellipsoid/terrain into account.\n\n  return requiredDistance;\n}\n\n/**\n * calculate the resolution based on a distance(camera to position) and latitude value\n * @param {number} distance\n * @param {number} latitude\n * @param {import('cesium').Scene} scene.\n * @param {import('ol/proj/Projection').default} projection View projection.\n * @return {number} The calculated resolution.\n * @api\n */\nexport function calcResolutionForDistance(distance, latitude, scene, projection) {\n  // See the reverse calculation (calcDistanceForResolution) for details\n  const canvas = scene.canvas;\n  const camera = scene.camera;\n  const fovy = camera.frustum.fovy; // vertical field of view\n  console.assert(!isNaN(fovy));\n  const metersPerUnit = projection.getMetersPerUnit();\n\n  const visibleMeters = 2 * distance * Math.tan(fovy / 2);\n  const relativeCircumference = Math.cos(Math.abs(latitude));\n  const visibleMapUnits = visibleMeters / metersPerUnit / relativeCircumference;\n  const resolution = visibleMapUnits / canvas.clientHeight;\n\n  return resolution;\n}\n","/**\n * @module olcs.AutoRenderLoop\n */\n\nclass AutoRenderLoop {\n  /**\n   * @constructor\n   * @param {olcs.OLCesium} ol3d\n   */\n  constructor(ol3d) {\n    this.ol3d = ol3d;\n    this.scene_ = ol3d.getCesiumScene();\n    this.canvas_ = this.scene_.canvas;\n    this._boundNotifyRepaintRequired = this.notifyRepaintRequired.bind(this);\n\n    this.repaintEventNames_ = [\n      'mousemove', 'mousedown', 'mouseup',\n      'touchstart', 'touchend', 'touchmove',\n      'pointerdown', 'pointerup', 'pointermove',\n      'wheel'\n    ];\n\n    this.enable();\n  }\n\n  /**\n   * Enable.\n   */\n  enable() {\n    this.scene_.requestRenderMode = true;\n    this.scene_.maximumRenderTimeChange = 1000;\n    for (const repaintKey of this.repaintEventNames_) {\n      this.canvas_.addEventListener(repaintKey, this._boundNotifyRepaintRequired, false);\n    }\n\n    window.addEventListener('resize', this._boundNotifyRepaintRequired, false);\n\n    // Listen for changes on the layer group\n    this.ol3d.getOlMap().getLayerGroup().on('change', this._boundNotifyRepaintRequired);\n  }\n\n  /**\n   * Disable.\n   */\n  disable() {\n    for (const repaintKey of this.repaintEventNames_) {\n      this.canvas_.removeEventListener(repaintKey, this._boundNotifyRepaintRequired, false);\n    }\n\n    window.removeEventListener('resize', this._boundNotifyRepaintRequired, false);\n\n    this.ol3d.getOlMap().getLayerGroup().un('change', this._boundNotifyRepaintRequired);\n    this.scene_.requestRenderMode = false;\n  }\n\n  /**\n   * Restart render loop.\n   * Force a restart of the render loop.\n   * @api\n   */\n  restartRenderLoop() {\n    this.notifyRepaintRequired();\n  }\n\n  notifyRepaintRequired() {\n    this.scene_.requestRender();\n  }\n}\n\n\nexport default AutoRenderLoop;\n","/**\n * Converts radians to to degrees.\n *\n * @param {number} angleInRadians Angle in radians.\n * @return {number} Angle in degrees.\n */\nexport function toDegrees(angleInRadians) {\n  return angleInRadians * 180 / Math.PI;\n}\n\n\n/**\n * Converts degrees to radians.\n *\n * @param {number} angleInDegrees Angle in degrees.\n * @return {number} Angle in radians.\n */\nexport function toRadians(angleInDegrees) {\n  return angleInDegrees * Math.PI / 180;\n}\n","/**\n * @module olcs.Camera\n */\n\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\nimport {toRadians, toDegrees} from './math.js';\nimport {getTransform} from 'ol/proj.js';\nimport olcsCore, {calcDistanceForResolution, calcResolutionForDistance} from './core.js';\n\nclass Camera {\n  /**\n   * This object takes care of additional 3d-specific properties of the view and\n   * ensures proper synchronization with the underlying raw Cesium.Camera object.\n   * @param {!Cesium.Scene} scene\n   * @param {!ol.Map} map\n   * @api\n   */\n  constructor(scene, map) {\n    /**\n     * @type {!Cesium.Scene}\n     * @private\n     */\n    this.scene_ = scene;\n\n    /**\n     * @type {!Cesium.Camera}\n     * @private\n     */\n    this.cam_ = scene.camera;\n\n    /**\n     * @type {!ol.Map}\n     * @private\n     */\n    this.map_ = map;\n\n    /**\n     * @type {?ol.View}\n     * @private\n     */\n    this.view_ = null;\n\n    /**\n     * @type {?ol.EventsKey}\n     * @private\n     */\n    this.viewListenKey_ = null;\n\n    /**\n     * @type {!ol.TransformFunction}\n     * @private\n     */\n    this.toLonLat_ = Camera.identityProjection;\n\n    /**\n     * @type {!ol.TransformFunction}\n     * @private\n     */\n    this.fromLonLat_ = Camera.identityProjection;\n\n    /**\n     * 0 -- topdown, PI/2 -- the horizon\n     * @type {number}\n     * @private\n     */\n    this.tilt_ = 0;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.distance_ = 0;\n\n    /**\n     * @type {?Cesium.Matrix4}\n     * @private\n     */\n    this.lastCameraViewMatrix_ = null;\n\n    /**\n     * This is used to discard change events on view caused by updateView method.\n     * @type {boolean}\n     * @private\n     */\n    this.viewUpdateInProgress_ = false;\n\n    this.map_.on('change:view', (e) => {\n      this.setView_(this.map_.getView());\n    });\n    this.setView_(this.map_.getView());\n  }\n\n  /**\n   * @param {Array.<number>} input Input coordinate array.\n   * @param {Array.<number>=} opt_output Output array of coordinate values.\n   * @param {number=} opt_dimension Dimension.\n   * @return {Array.<number>} Input coordinate array (same array as input).\n   */\n  static identityProjection(input, opt_output, opt_dimension) {\n    const dim = opt_dimension || input.length;\n    if (opt_output) {\n      for (let i = 0; i < dim; ++i) {\n        opt_output[i] = input[i];\n      }\n    }\n    return input;\n  }\n\n  /**\n   * @param {?ol.View} view New view to use.\n   * @private\n   */\n  setView_(view) {\n    if (this.view_) {\n      olObservableUnByKey(this.viewListenKey_);\n      this.viewListenKey_ = null;\n    }\n\n    this.view_ = view;\n    if (view) {\n      const toLonLat = getTransform(view.getProjection(), 'EPSG:4326');\n      const fromLonLat = getTransform('EPSG:4326', view.getProjection());\n      console.assert(toLonLat && fromLonLat);\n\n      this.toLonLat_ = toLonLat;\n      this.fromLonLat_ = fromLonLat;\n\n      this.viewListenKey_ = view.on('propertychange', e => this.handleViewEvent_(e));\n\n      this.readFromView();\n    } else {\n      this.toLonLat_ = Camera.identityProjection;\n      this.fromLonLat_ = Camera.identityProjection;\n    }\n  }\n\n  /**\n   * @param {?} e\n   * @private\n   */\n  handleViewEvent_(e) {\n    if (!this.viewUpdateInProgress_) {\n      this.readFromView();\n    }\n  }\n\n  /**\n   * @param {number} heading In radians.\n   * @api\n   */\n  setHeading(heading) {\n    if (!this.view_) {\n      return;\n    }\n\n    this.view_.setRotation(heading);\n  }\n\n  /**\n   * @return {number|undefined} Heading in radians.\n   * @api\n   */\n  getHeading() {\n    if (!this.view_) {\n      return undefined;\n    }\n    const rotation = this.view_.getRotation();\n    return rotation || 0;\n  }\n\n  /**\n   * @param {number} tilt In radians.\n   * @api\n   */\n  setTilt(tilt) {\n    this.tilt_ = tilt;\n    this.updateCamera_();\n  }\n\n  /**\n   * @return {number} Tilt in radians.\n   * @api\n   */\n  getTilt() {\n    return this.tilt_;\n  }\n\n  /**\n   * @param {number} distance In meters.\n   * @api\n   */\n  setDistance(distance) {\n    this.distance_ = distance;\n    this.updateCamera_();\n    this.updateView();\n  }\n\n  /**\n   * @return {number} Distance in meters.\n   * @api\n   */\n  getDistance() {\n    return this.distance_;\n  }\n\n  /**\n   * Shortcut for ol.View.setCenter().\n   * @param {!ol.Coordinate} center Same projection as the ol.View.\n   * @api\n   */\n  setCenter(center) {\n    if (!this.view_) {\n      return;\n    }\n    this.view_.setCenter(center);\n  }\n\n  /**\n   * Shortcut for ol.View.getCenter().\n   * @return {ol.Coordinate|undefined} Same projection as the ol.View.\n   * @api\n   */\n  getCenter() {\n    if (!this.view_) {\n      return undefined;\n    }\n    return this.view_.getCenter();\n  }\n\n  /**\n   * Sets the position of the camera.\n   * @param {!ol.Coordinate} position Same projection as the ol.View.\n   * @api\n   */\n  setPosition(position) {\n    if (!this.toLonLat_) {\n      return;\n    }\n    const ll = this.toLonLat_(position);\n    console.assert(ll);\n\n    const carto = new Cesium.Cartographic(\n        toRadians(ll[0]),\n        toRadians(ll[1]),\n        this.getAltitude());\n\n    this.cam_.setView({\n      destination: Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto)\n    });\n    this.updateView();\n  }\n\n  /**\n   * Calculates position under the camera.\n   * @return {!ol.Coordinate|undefined} Same projection as the ol.View.\n   * @api\n   */\n  getPosition() {\n    if (!this.fromLonLat_) {\n      return undefined;\n    }\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position);\n\n    const pos = this.fromLonLat_([\n      toDegrees(carto.longitude),\n      toDegrees(carto.latitude)\n    ]);\n    console.assert(pos);\n    return pos;\n  }\n\n  /**\n   * @param {number} altitude In meters.\n   * @api\n   */\n  setAltitude(altitude) {\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(\n        this.cam_.position);\n    carto.height = altitude;\n    this.cam_.position = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n\n    this.updateView();\n  }\n\n  /**\n   * @return {number} Altitude in meters.\n   * @api\n   */\n  getAltitude() {\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(\n        this.cam_.position);\n\n    return carto.height;\n  }\n\n  /**\n   * Updates the state of the underlying Cesium.Camera\n   * according to the current values of the properties.\n   * @private\n   */\n  updateCamera_() {\n    if (!this.view_ || !this.toLonLat_) {\n      return;\n    }\n    const center = this.view_.getCenter();\n    if (!center) {\n      return;\n    }\n    const ll = this.toLonLat_(center);\n    console.assert(ll);\n\n    const carto = new Cesium.Cartographic(toRadians(ll[0]),\n        toRadians(ll[1]));\n    if (this.scene_.globe) {\n      const height = this.scene_.globe.getHeight(carto);\n      carto.height = height || 0;\n    }\n\n    const destination = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n\n    /** @type {Cesium.optionsOrientation} */\n    const orientation = {\n      pitch: this.tilt_ - Cesium.Math.PI_OVER_TWO,\n      heading: -this.view_.getRotation(),\n      roll: undefined\n    };\n    this.cam_.setView({\n      destination,\n      orientation\n    });\n\n    this.cam_.moveBackward(this.distance_);\n\n    this.checkCameraChange(true);\n  }\n\n  /**\n   * Calculates the values of the properties from the current ol.View state.\n   * @api\n   */\n  readFromView() {\n    if (!this.view_ || !this.toLonLat_) {\n      return;\n    }\n    const center = this.view_.getCenter();\n    if (center === undefined || center === null) {\n      return;\n    }\n    const ll = this.toLonLat_(center);\n    console.assert(ll);\n\n    const resolution = this.view_.getResolution();\n    this.distance_ = this.calcDistanceForResolution(\n        resolution || 0, toRadians(ll[1]));\n\n    this.updateCamera_();\n  }\n\n  /**\n   * Calculates the values of the properties from the current Cesium.Camera state.\n   * Modifies the center, resolution and rotation properties of the view.\n   * @api\n   */\n  updateView() {\n    if (!this.view_ || !this.fromLonLat_) {\n      return;\n    }\n    this.viewUpdateInProgress_ = true;\n\n    // target & distance\n    const ellipsoid = Cesium.Ellipsoid.WGS84;\n    const scene = this.scene_;\n    const target = olcsCore.pickCenterPoint(scene);\n\n    let bestTarget = target;\n    if (!bestTarget) {\n      //TODO: how to handle this properly ?\n      const globe = scene.globe;\n      const carto = this.cam_.positionCartographic.clone();\n      const height = globe.getHeight(carto);\n      carto.height = height || 0;\n      bestTarget = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n    }\n    this.distance_ = Cesium.Cartesian3.distance(bestTarget, this.cam_.position);\n    const bestTargetCartographic = ellipsoid.cartesianToCartographic(bestTarget);\n    this.view_.setCenter(this.fromLonLat_([\n      toDegrees(bestTargetCartographic.longitude),\n      toDegrees(bestTargetCartographic.latitude)]));\n\n    // resolution\n    this.view_.setResolution(\n        this.calcResolutionForDistance(this.distance_,\n            bestTargetCartographic ? bestTargetCartographic.latitude : 0));\n\n\n    /*\n     * Since we are positioning the target, the values of heading and tilt\n     * need to be calculated _at the target_.\n     */\n    if (target) {\n      const pos = this.cam_.position;\n\n      // normal to the ellipsoid at the target\n      const targetNormal = new Cesium.Cartesian3();\n      ellipsoid.geocentricSurfaceNormal(target, targetNormal);\n\n      // vector from the target to the camera\n      const targetToCamera = new Cesium.Cartesian3();\n      Cesium.Cartesian3.subtract(pos, target, targetToCamera);\n      Cesium.Cartesian3.normalize(targetToCamera, targetToCamera);\n\n\n      // HEADING\n      const up = this.cam_.up;\n      const right = this.cam_.right;\n      const normal = new Cesium.Cartesian3(-target.y, target.x, 0); // what is it?\n      const heading = Cesium.Cartesian3.angleBetween(right, normal);\n      const cross = Cesium.Cartesian3.cross(target, up, new Cesium.Cartesian3());\n      const orientation = cross.z;\n\n      this.view_.setRotation((orientation < 0 ? heading : -heading));\n\n      // TILT\n      const tiltAngle = Math.acos(\n          Cesium.Cartesian3.dot(targetNormal, targetToCamera));\n      this.tilt_ = isNaN(tiltAngle) ? 0 : tiltAngle;\n    } else {\n      // fallback when there is no target\n      this.view_.setRotation(this.cam_.heading);\n      this.tilt_ = -this.cam_.pitch + Math.PI / 2;\n    }\n\n    this.viewUpdateInProgress_ = false;\n  }\n\n  /**\n   * Check if the underlying camera state has changed and ensure synchronization.\n   * @param {boolean=} opt_dontSync Do not synchronize the view.\n   */\n  checkCameraChange(opt_dontSync) {\n    const old = this.lastCameraViewMatrix_;\n    const current = this.cam_.viewMatrix;\n\n    if (!old || !Cesium.Matrix4.equalsEpsilon(old, current, 1e-5)) {\n      this.lastCameraViewMatrix_ = current.clone();\n      if (opt_dontSync !== true) {\n        this.updateView();\n      }\n    }\n  }\n\n  /**\n   * calculate the distance between camera and centerpoint based on the resolution and latitude value\n   * @param {number} resolution Number of map units per pixel.\n   * @param {number} latitude Latitude in radians.\n   * @return {number} The calculated distance.\n   * @api\n   */\n  calcDistanceForResolution(resolution, latitude) {\n    return calcDistanceForResolution(resolution, latitude, this.scene_, this.view_.getProjection());\n  }\n\n  /**\n   * calculate the resolution based on a distance(camera to position) and latitude value\n   * @param {number} distance\n   * @param {number} latitude\n   * @return {number} The calculated resolution.\n   * @api\n   */\n  calcResolutionForDistance(distance, latitude) {\n    return calcResolutionForDistance(distance, latitude, this.scene_, this.view_.getProjection());\n  }\n}\n\n\nexport default Camera;\n","/**\n * @module olcs.AbstractSynchronizer\n */\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\nimport olLayerGroup from 'ol/layer/Group.js';\nimport {olcsListen, getUid} from './util.js';\n\n\nclass AbstractSynchronizer {\n  /**\n   * @param {!ol.Map} map\n   * @param {!Cesium.Scene} scene\n   * @template T\n   * @abstract\n   * @api\n   */\n  constructor(map, scene) {\n    /**\n     * @type {!ol.Map}\n     * @protected\n     */\n    this.map = map;\n\n    /**\n     * @type {ol.View}\n     * @protected\n     */\n    this.view = map.getView();\n\n    /**\n     * @type {!Cesium.Scene}\n     * @protected\n     */\n    this.scene = scene;\n\n    /**\n     * @type {ol.Collection.<ol.layer.Base>}\n     * @protected\n     */\n    this.olLayers = map.getLayerGroup().getLayers();\n\n    /**\n     * @type {ol.layer.Group}\n     */\n    this.mapLayerGroup = map.getLayerGroup();\n\n    /**\n     * Map of OpenLayers layer ids (from getUid) to the Cesium ImageryLayers.\n     * Null value means, that we are unable to create equivalent layers.\n     * @type {Object.<string, ?Array.<T>>}\n     * @protected\n     */\n    this.layerMap = {};\n\n    /**\n     * Map of listen keys for OpenLayers layer layers ids (from getUid).\n     * @type {!Object.<string, Array<ol.EventsKey>>}\n     * @protected\n     */\n    this.olLayerListenKeys = {};\n\n    /**\n     * Map of listen keys for OpenLayers layer groups ids (from getUid).\n     * @type {!Object.<string, !Array.<ol.EventsKey>>}\n     * @private\n     */\n    this.olGroupListenKeys_ = {};\n  }\n\n  /**\n   * Destroy all and perform complete synchronization of the layers.\n   * @api\n   */\n  synchronize() {\n    this.destroyAll();\n    this.addLayers_(this.mapLayerGroup);\n  }\n\n  /**\n   * Order counterparts using the same algorithm as the Openlayers renderer:\n   * z-index then original sequence order.\n   * @protected\n   */\n  orderLayers() {\n    // Ordering logics is handled in subclasses.\n  }\n\n  /**\n   * Add a layer hierarchy.\n   * @param {ol.layer.Base} root\n   * @private\n   */\n  addLayers_(root) {\n    /** @type {Array<import('olsc/core.js').LayerWithParents>} */\n    const fifo = [{\n      layer: root,\n      parents: []\n    }];\n    while (fifo.length > 0) {\n      const olLayerWithParents = fifo.splice(0, 1)[0];\n      const olLayer = olLayerWithParents.layer;\n      const olLayerId = getUid(olLayer).toString();\n      this.olLayerListenKeys[olLayerId] = [];\n      console.assert(!this.layerMap[olLayerId]);\n\n      let cesiumObjects = null;\n      if (olLayer instanceof olLayerGroup) {\n        this.listenForGroupChanges_(olLayer);\n        if (olLayer !== this.mapLayerGroup) {\n          cesiumObjects = this.createSingleLayerCounterparts(olLayerWithParents);\n        }\n        if (!cesiumObjects) {\n          olLayer.getLayers().forEach((l) => {\n            if (l) {\n              const newOlLayerWithParents = {\n                layer: l,\n                parents: olLayer === this.mapLayerGroup ?\n                  [] :\n                  [olLayerWithParents.layer].concat(olLayerWithParents.parents)\n              };\n              fifo.push(newOlLayerWithParents);\n            }\n          });\n        }\n      } else {\n        cesiumObjects = this.createSingleLayerCounterparts(olLayerWithParents);\n        if (!cesiumObjects) {\n          // keep an eye on the layers that once failed to be added (might work when the layer is updated)\n          // for example when a source is set after the layer is added to the map\n          const layerId = olLayerId;\n          const layerWithParents = olLayerWithParents;\n          const onLayerChange = (e) => {\n            const cesiumObjs = this.createSingleLayerCounterparts(layerWithParents);\n            if (cesiumObjs) {\n              // unsubscribe event listener\n              layerWithParents.layer.un('change', onLayerChange);\n              this.addCesiumObjects_(cesiumObjs, layerId, layerWithParents.layer);\n              this.orderLayers();\n            }\n          };\n          this.olLayerListenKeys[olLayerId].push(olcsListen(layerWithParents.layer, 'change', onLayerChange));\n        }\n      }\n      // add Cesium layers\n      if (cesiumObjects) {\n        this.addCesiumObjects_(cesiumObjects, olLayerId, olLayer);\n      }\n    }\n\n    this.orderLayers();\n  }\n\n  /**\n   * Add Cesium objects.\n   * @param {Array.<T>} cesiumObjects\n   * @param {string} layerId\n   * @param {ol.layer.Base} layer\n   * @private\n   */\n  addCesiumObjects_(cesiumObjects, layerId, layer) {\n    this.layerMap[layerId] = cesiumObjects;\n    this.olLayerListenKeys[layerId].push(olcsListen(layer, 'change:zIndex', () => this.orderLayers()));\n    cesiumObjects.forEach((cesiumObject) => {\n      this.addCesiumObject(cesiumObject);\n    });\n  }\n\n  /**\n   * Remove and destroy a single layer.\n   * @param {ol.layer.Layer} layer\n   * @return {boolean} counterpart destroyed\n   * @private\n   */\n  removeAndDestroySingleLayer_(layer) {\n    const uid = getUid(layer).toString();\n    const counterparts = this.layerMap[uid];\n    if (!!counterparts) {\n      counterparts.forEach((counterpart) => {\n        this.removeSingleCesiumObject(counterpart, false);\n        this.destroyCesiumObject(counterpart);\n      });\n      this.olLayerListenKeys[uid].forEach(olObservableUnByKey);\n      delete this.olLayerListenKeys[uid];\n    }\n    delete this.layerMap[uid];\n    return !!counterparts;\n  }\n\n  /**\n   * Unlisten a single layer group.\n   * @param {ol.layer.Group} group\n   * @private\n   */\n  unlistenSingleGroup_(group) {\n    if (group === this.mapLayerGroup) {\n      return;\n    }\n    const uid = getUid(group).toString();\n    const keys = this.olGroupListenKeys_[uid];\n    keys.forEach((key) => {\n      olObservableUnByKey(key);\n    });\n    delete this.olGroupListenKeys_[uid];\n    delete this.layerMap[uid];\n  }\n\n  /**\n   * Remove layer hierarchy.\n   * @param {ol.layer.Base} root\n   * @private\n   */\n  removeLayer_(root) {\n    if (!!root) {\n      const fifo = [root];\n      while (fifo.length > 0) {\n        const olLayer = fifo.splice(0, 1)[0];\n        const done = this.removeAndDestroySingleLayer_(olLayer);\n        if (olLayer instanceof olLayerGroup) {\n          this.unlistenSingleGroup_(olLayer);\n          if (!done) {\n            // No counterpart for the group itself so removing\n            // each of the child layers.\n            olLayer.getLayers().forEach((l) => {\n              fifo.push(l);\n            });\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Register listeners for single layer group change.\n   * @param {ol.layer.Group} group\n   * @private\n   */\n  listenForGroupChanges_(group) {\n    const uuid = getUid(group).toString();\n\n    console.assert(this.olGroupListenKeys_[uuid] === undefined);\n\n    const listenKeyArray = [];\n    this.olGroupListenKeys_[uuid] = listenKeyArray;\n\n    // only the keys that need to be relistened when collection changes\n    let contentKeys = [];\n    const listenAddRemove = (function() {\n      const collection = group.getLayers();\n      if (collection) {\n        contentKeys = [\n          collection.on('add', (event) => {\n            this.addLayers_(event.element);\n          }),\n          collection.on('remove', (event) => {\n            this.removeLayer_(event.element);\n          })\n        ];\n        listenKeyArray.push(...contentKeys);\n      }\n    }).bind(this);\n\n    listenAddRemove();\n\n    listenKeyArray.push(group.on('change:layers', (e) => {\n      contentKeys.forEach((el) => {\n        const i = listenKeyArray.indexOf(el);\n        if (i >= 0) {\n          listenKeyArray.splice(i, 1);\n        }\n        olObservableUnByKey(el);\n      });\n      listenAddRemove();\n    }));\n  }\n\n  /**\n   * Destroys all the created Cesium objects.\n   * @protected\n   */\n  destroyAll() {\n    this.removeAllCesiumObjects(true); // destroy\n    let objKey;\n    for (objKey in this.olGroupListenKeys_) {\n      const keys = this.olGroupListenKeys_[objKey];\n      keys.forEach(olObservableUnByKey);\n    }\n    for (objKey in this.olLayerListenKeys) {\n      this.olLayerListenKeys[objKey].forEach(olObservableUnByKey);\n    }\n    this.olGroupListenKeys_ = {};\n    this.olLayerListenKeys = {};\n    this.layerMap = {};\n  }\n\n  /**\n   * Adds a single Cesium object to the collection.\n   * @param {!T} object\n   * @abstract\n   * @protected\n   */\n  addCesiumObject(object) {}\n\n  /**\n   * @param {!T} object\n   * @abstract\n   * @protected\n   */\n  destroyCesiumObject(object) {}\n\n  /**\n   * Remove single Cesium object from the collection.\n   * @param {!T} object\n   * @param {boolean} destroy\n   * @abstract\n   * @protected\n   */\n  removeSingleCesiumObject(object, destroy) {}\n\n  /**\n   * Remove all Cesium objects from the collection.\n   * @param {boolean} destroy\n   * @abstract\n   * @protected\n   */\n  removeAllCesiumObjects(destroy) {}\n\n  /**\n   * @param {import('olsc/core.js').LayerWithParents} olLayerWithParents\n   * @return {?Array.<T>}\n   * @abstract\n   * @protected\n   */\n  createSingleLayerCounterparts(olLayerWithParents) {}\n}\n\n\nexport default AbstractSynchronizer;\n","/**\n * @module olcs.RasterSynchronizer\n */\nimport olLayerGroup from 'ol/layer/Group.js';\nimport {getUid, stableSort} from './util.js';\nimport olcsAbstractSynchronizer from './AbstractSynchronizer.js';\nimport olcsCore from './core.js';\n\nclass RasterSynchronizer extends olcsAbstractSynchronizer {\n  /**\n   * This object takes care of one-directional synchronization of\n   * Openlayers raster layers to the given Cesium globe.\n   * @param {!ol.Map} map\n   * @param {!Cesium.Scene} scene\n   * @constructor\n   * @extends {olcsAbstractSynchronizer.<Cesium.ImageryLayer>}\n   * @api\n   */\n  constructor(map, scene) {\n    super(map, scene);\n\n    /**\n     * @type {!Cesium.ImageryLayerCollection}\n     * @private\n     */\n    this.cesiumLayers_ = scene.imageryLayers;\n\n    /**\n     * @type {!Cesium.ImageryLayerCollection}\n     * @private\n     */\n    this.ourLayers_ = new Cesium.ImageryLayerCollection();\n  }\n\n  /**\n   * @inheritDoc\n   */\n  addCesiumObject(object) {\n    this.cesiumLayers_.add(object);\n    this.ourLayers_.add(object);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  destroyCesiumObject(object) {\n    object.destroy();\n  }\n\n  /**\n   * @inheritDoc\n   */\n  removeSingleCesiumObject(object, destroy) {\n    this.cesiumLayers_.remove(object, destroy);\n    this.ourLayers_.remove(object, false);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  removeAllCesiumObjects(destroy) {\n    for (let i = 0; i < this.ourLayers_.length; ++i) {\n      this.cesiumLayers_.remove(this.ourLayers_.get(i), destroy);\n    }\n    this.ourLayers_.removeAll(false);\n  }\n\n  /**\n   * Creates an array of Cesium.ImageryLayer.\n   * May be overriden by child classes to implement custom behavior.\n   * The default implementation handles tiled imageries in EPSG:4326 or\n   * EPSG:3859.\n   * @param {!ol.layer.Base} olLayer\n   * @param {!ol.proj.Projection} viewProj Projection of the view.\n   * @return {?Array.<!Cesium.ImageryLayer>} array or null if not possible\n   * (or supported)\n   * @protected\n   */\n  convertLayerToCesiumImageries(olLayer, viewProj) {\n    const result = olcsCore.tileLayerToImageryLayer(this.map, olLayer, viewProj);\n    return result ? [result] : null;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  createSingleLayerCounterparts(olLayerWithParents) {\n    const olLayer = olLayerWithParents.layer;\n    const uid = getUid(olLayer).toString();\n    const viewProj = this.view.getProjection();\n    console.assert(viewProj);\n    const cesiumObjects = this.convertLayerToCesiumImageries(olLayer, viewProj);\n    if (cesiumObjects) {\n      const listenKeyArray = [];\n      [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayerItem) => {\n        listenKeyArray.push(olLayerItem.on(['change:opacity', 'change:visible'], () => {\n          // the compiler does not seem to be able to infer this\n          console.assert(cesiumObjects);\n          for (let i = 0; i < cesiumObjects.length; ++i) {\n            olcsCore.updateCesiumLayerProperties(olLayerWithParents, cesiumObjects[i]);\n          }\n        }));\n      });\n\n      if (olLayer.getStyleFunction) {\n        let previousStyleFunction = olLayer.getStyleFunction();\n        // there is no convenient way to detect a style function change in OL\n        listenKeyArray.push(olLayer.on('change', () => {\n          const currentStyleFunction = olLayer.getStyleFunction();\n          if (previousStyleFunction === currentStyleFunction) {\n            return;\n          }\n          previousStyleFunction = currentStyleFunction;\n          for (let i = 0; i < cesiumObjects.length; ++i) {\n            const csObj = cesiumObjects[i];\n            // clear cache and set new style\n            if (csObj._imageryCache && csObj.imageryProvider.cache_) {\n              csObj._imageryCache = {};\n              csObj.imageryProvider.cache_ = {};\n              csObj.imageryProvider.styleFunction_ = currentStyleFunction;\n            }\n          }\n          this.scene.requestRender();\n        }));\n      }\n\n      for (let i = 0; i < cesiumObjects.length; ++i) {\n        olcsCore.updateCesiumLayerProperties(olLayerWithParents, cesiumObjects[i]);\n      }\n\n      // there is no way to modify Cesium layer extent,\n      // we have to recreate when OpenLayers layer extent changes:\n      listenKeyArray.push(olLayer.on('change:extent', (e) => {\n        for (let i = 0; i < cesiumObjects.length; ++i) {\n          this.cesiumLayers_.remove(cesiumObjects[i], true); // destroy\n          this.ourLayers_.remove(cesiumObjects[i], false);\n        }\n        delete this.layerMap[getUid(olLayer)]; // invalidate the map entry\n        this.synchronize();\n      }));\n\n      listenKeyArray.push(olLayer.on('change', (e) => {\n        // when the source changes, re-add the layer to force update\n        for (let i = 0; i < cesiumObjects.length; ++i) {\n          const position = this.cesiumLayers_.indexOf(cesiumObjects[i]);\n          if (position >= 0) {\n            this.cesiumLayers_.remove(cesiumObjects[i], false);\n            this.cesiumLayers_.add(cesiumObjects[i], position);\n          }\n        }\n      }));\n\n      this.olLayerListenKeys[uid].push(...listenKeyArray);\n    }\n\n    return Array.isArray(cesiumObjects) ? cesiumObjects : null;\n  }\n\n  /**\n   * Order counterparts using the same algorithm as the Openlayers renderer:\n   * z-index then original sequence order.\n   * @override\n   * @protected\n   */\n  orderLayers() {\n    const layers = [];\n    const zIndices = {};\n    const queue = [this.mapLayerGroup];\n\n    while (queue.length > 0) {\n      const olLayer = queue.splice(0, 1)[0];\n      layers.push(olLayer);\n      zIndices[getUid(olLayer)] = olLayer.getZIndex() || 0;\n\n      if (olLayer instanceof olLayerGroup) {\n        const sublayers = olLayer.getLayers();\n        if (sublayers) {\n          // Prepend queue with sublayers in order\n          queue.unshift(...sublayers.getArray());\n        }\n      }\n    }\n\n    stableSort(layers, (layer1, layer2) =>\n      zIndices[getUid(layer1)] - zIndices[getUid(layer2)]\n    );\n\n    layers.forEach((olLayer) => {\n      const olLayerId = getUid(olLayer).toString();\n      const cesiumObjects = this.layerMap[olLayerId];\n      if (cesiumObjects) {\n        cesiumObjects.forEach((cesiumObject) => { this.raiseToTop(cesiumObject); });\n      }\n    });\n  }\n\n  /**\n   * @param {Cesium.ImageryLayer} counterpart\n   */\n  raiseToTop(counterpart) {\n    this.cesiumLayers_.raiseToTop(counterpart);\n  }\n}\n\n\nexport default RasterSynchronizer;\n","/**\n * @module olcs.core.VectorLayerCounterpart\n */\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\n\n\n/**\n * Context for feature conversion.\n * @typedef {Object} OlFeatureToCesiumContext\n * @property {!(import('ol/Projection.js').default|string)} projection\n * @property {!Cesium.PrimitiveCollection} primitives\n * @property {Object<number, Array<!Cesium.Primitive|!Cesium.Billboard>>} featureToCesiumMap\n * @property {!Cesium.BillboardCollection} billboards\n */\n\n\nclass VectorLayerCounterpart {\n  /**\n  * Result of the conversion of an OpenLayers layer to Cesium.\n  * @param {!(ol.proj.Projection|string)} layerProjection\n  * @param {!Cesium.Scene} scene\n  */\n  constructor(layerProjection, scene) {\n    const billboards = new Cesium.BillboardCollection({scene});\n    const primitives = new Cesium.PrimitiveCollection();\n\n    /**\n    * @type {!Array.<ol.EventsKey>}\n    */\n    this.olListenKeys = [];\n\n    this.rootCollection_ = new Cesium.PrimitiveCollection();\n    /**\n    * @type {!OlFeatureToCesiumContext}\n    */\n    this.context = {\n      projection: layerProjection,\n      billboards,\n      featureToCesiumMap: {},\n      primitives\n    };\n\n    this.rootCollection_.add(billboards);\n    this.rootCollection_.add(primitives);\n  }\n\n  /**\n  * Unlisten.\n  */\n  destroy() {\n    this.olListenKeys.forEach(olObservableUnByKey);\n    this.olListenKeys.length = 0;\n  }\n\n  /**\n  * @return {!Cesium.Primitive}\n  */\n  getRootPrimitive() {\n    return this.rootCollection_;\n  }\n}\n\n\nexport default VectorLayerCounterpart;\n","/**\n * @module olcs.FeatureConverter\n */\nimport olGeomGeometry from 'ol/geom/Geometry.js';\nimport olStyleIcon from 'ol/style/Icon.js';\nimport olSourceVector from 'ol/source/Vector.js';\nimport olSourceCluster from 'ol/source/Cluster.js';\nimport {circular as olCreateCircularPolygon} from 'ol/geom/Polygon.js';\nimport {boundingExtent, getCenter} from 'ol/extent.js';\nimport olGeomSimpleGeometry from 'ol/geom/SimpleGeometry.js';\nimport olcsCore from './core.js';\nimport olcsCoreVectorLayerCounterpart from './core/VectorLayerCounterpart.js';\nimport olcsUtil, {getUid, isGroundPolylinePrimitiveSupported} from './util.js';\n\n\n/**\n * @typedef {Object} ModelStyle\n * @property {Cesium.Matrix4} [debugModelMatrix]\n * @property {Cesium.ModelFromGltfOptions} cesiumOptions\n */\n\n\nclass FeatureConverter {\n  /**\n   * Concrete base class for converting from OpenLayers3 vectors to Cesium\n   * primitives.\n   * Extending this class is possible provided that the extending class and\n   * the library are compiled together by the closure compiler.\n   * @param {!Cesium.Scene} scene Cesium scene.\n   * @constructor\n   * @api\n   */\n  constructor(scene) {\n\n    /**\n     * @protected\n     */\n    this.scene = scene;\n\n    /**\n     * Bind once to have a unique function for using as a listener\n     * @type {function(ol.source.Vector.Event)}\n     * @private\n     */\n    this.boundOnRemoveOrClearFeatureListener_ = this.onRemoveOrClearFeature_.bind(this);\n\n    /**\n     * @type {Cesium.Cartesian3}\n     * @private\n     */\n    this.defaultBillboardEyeOffset_ = new Cesium.Cartesian3(0, 0, 10);\n  }\n\n  /**\n   * @param {ol.source.Vector.Event} evt\n   * @private\n   */\n  onRemoveOrClearFeature_(evt) {\n    const source = evt.target;\n    console.assert(source instanceof olSourceVector);\n\n    const cancellers = olcsUtil.obj(source)['olcs_cancellers'];\n    if (cancellers) {\n      const feature = evt.feature;\n      if (feature) {\n        // remove\n        const id = getUid(feature);\n        const canceller = cancellers[id];\n        if (canceller) {\n          canceller();\n          delete cancellers[id];\n        }\n      } else {\n        // clear\n        for (const key in cancellers) {\n          if (cancellers.hasOwnProperty(key)) {\n            cancellers[key]();\n          }\n        }\n        olcsUtil.obj(source)['olcs_cancellers'] = {};\n      }\n    }\n  }\n\n  /**\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!Cesium.Primitive|Cesium.Label|Cesium.Billboard} primitive\n   * @protected\n   */\n  setReferenceForPicking(layer, feature, primitive) {\n    primitive.olLayer = layer;\n    primitive.olFeature = feature;\n  }\n\n  /**\n   * Basics primitive creation using a color attribute.\n   * Note that Cesium has 'interior' and outline geometries.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!ol.geom.Geometry} olGeometry OpenLayers geometry.\n   * @param {!Cesium.Geometry} geometry\n   * @param {!Cesium.Color} color\n   * @param {number=} opt_lineWidth\n   * @return {Cesium.Primitive}\n   * @protected\n   */\n  createColoredPrimitive(layer, feature, olGeometry, geometry, color, opt_lineWidth) {\n    const createInstance = function(geometry, color) {\n      const instance = new Cesium.GeometryInstance({\n        // always update Cesium externs before adding a property\n        geometry\n      });\n      if (color && !(color instanceof Cesium.ImageMaterialProperty)) {\n        instance.attributes = {\n          color: Cesium.ColorGeometryInstanceAttribute.fromColor(color)\n        };\n      }\n      return instance;\n    };\n\n    const options = {\n      // always update Cesium externs before adding a property\n      flat: true, // work with all geometries\n      renderState: {\n        depthTest: {\n          enabled: true\n        }\n      }\n    };\n\n    if (opt_lineWidth !== undefined) {\n      if (!options.renderState) {\n        options.renderState = {};\n      }\n      options.renderState.lineWidth = opt_lineWidth;\n    }\n\n    const instances = createInstance(geometry, color);\n\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    let primitive;\n\n    if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n      const ctor = instances.geometry.constructor;\n      if (ctor && !ctor['createShadowVolume']) {\n        return null;\n      }\n      primitive = new Cesium.GroundPrimitive({\n        geometryInstances: instances\n      });\n    } else {\n      primitive = new Cesium.Primitive({\n        geometryInstances: instances\n      });\n    }\n\n    if (color instanceof Cesium.ImageMaterialProperty) {\n      const dataUri = color.image.getValue().toDataURL();\n\n      primitive.appearance = new Cesium.MaterialAppearance({\n        flat: true,\n        renderState: {\n          depthTest: {\n            enabled: true\n          }\n        },\n        material: new Cesium.Material({\n          fabric: {\n            type: 'Image',\n            uniforms: {\n              image: dataUri\n            }\n          }\n        })\n      });\n    } else {\n      primitive.appearance = new Cesium.PerInstanceColorAppearance(options);\n    }\n\n    this.setReferenceForPicking(layer, feature, primitive);\n    return primitive;\n  }\n\n  /**\n   * Return the fill or stroke color from a plain ol style.\n   * @param {!ol.style.Style|ol.style.Text} style\n   * @param {boolean} outline\n   * @return {!Cesium.Color}\n   * @protected\n   */\n  extractColorFromOlStyle(style, outline) {\n    const fillColor = style.getFill() ? style.getFill().getColor() : null;\n    const strokeColor = style.getStroke() ? style.getStroke().getColor() : null;\n\n    let olColor = 'black';\n    if (strokeColor && outline) {\n      olColor = strokeColor;\n    } else if (fillColor) {\n      olColor = fillColor;\n    }\n\n    return olcsCore.convertColorToCesium(olColor);\n  }\n\n  /**\n   * Return the width of stroke from a plain ol style.\n   * @param {!ol.style.Style|ol.style.Text} style\n   * @return {number}\n   * @protected\n   */\n  extractLineWidthFromOlStyle(style) {\n    // Handling of line width WebGL limitations is handled by Cesium.\n    const width = style.getStroke() ? style.getStroke().getWidth() : undefined;\n    return width !== undefined ? width : 1;\n  }\n\n  /**\n   * Create a primitive collection out of two Cesium geometries.\n   * Only the OpenLayers style colors will be used.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!ol.geom.Geometry} olGeometry OpenLayers geometry.\n   * @param {!Cesium.Geometry} fillGeometry\n   * @param {!Cesium.Geometry} outlineGeometry\n   * @param {!ol.style.Style} olStyle\n   * @return {!Cesium.PrimitiveCollection}\n   * @protected\n   */\n  wrapFillAndOutlineGeometries(layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle) {\n    const fillColor = this.extractColorFromOlStyle(olStyle, false);\n    const outlineColor = this.extractColorFromOlStyle(olStyle, true);\n\n    const primitives = new Cesium.PrimitiveCollection();\n    if (olStyle.getFill()) {\n      const p1 = this.createColoredPrimitive(layer, feature, olGeometry,\n          fillGeometry, fillColor);\n      console.assert(!!p1);\n      primitives.add(p1);\n    }\n\n    if (olStyle.getStroke() && outlineGeometry) {\n      const width = this.extractLineWidthFromOlStyle(olStyle);\n      const p2 = this.createColoredPrimitive(layer, feature, olGeometry,\n          outlineGeometry, outlineColor, width);\n      if (p2) {\n        // Some outline geometries are not supported by Cesium in clamp to ground\n        // mode. These primitives are skipped.\n        primitives.add(p2);\n      }\n    }\n\n    return primitives;\n  }\n\n  // Geometry converters\n  /**\n   * Create a Cesium primitive if style has a text component.\n   * Eventually return a PrimitiveCollection including current primitive.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry\n   * @param {!ol.style.Style} style\n   * @param {!Cesium.Primitive} primitive current primitive\n   * @return {!Cesium.PrimitiveCollection}\n   * @protected\n   */\n  addTextStyle(layer, feature, geometry, style, primitive) {\n    let primitives;\n    if (!(primitive instanceof Cesium.PrimitiveCollection)) {\n      primitives = new Cesium.PrimitiveCollection();\n      primitives.add(primitive);\n    } else {\n      primitives = primitive;\n    }\n\n    if (!style.getText()) {\n      return primitives;\n    }\n\n    const text = /** @type {!ol.style.Text} */ (style.getText());\n    const label = this.olGeometry4326TextPartToCesium(layer, feature, geometry,\n        text);\n    if (label) {\n      primitives.add(label);\n    }\n    return primitives;\n  }\n\n  /**\n   * Add a billboard to a Cesium.BillboardCollection.\n   * Overriding this wrapper allows manipulating the billboard options.\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {!Cesium.optionsBillboardCollectionAdd} bbOptions\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!ol.geom.Geometry} geometry\n   * @param {!ol.style.Style} style\n   * @return {!Cesium.Billboard} newly created billboard\n   * @api\n   */\n  csAddBillboard(billboards, bbOptions, layer, feature, geometry, style) {\n    if (!bbOptions.eyeOffset) {\n      bbOptions.eyeOffset = this.defaultBillboardEyeOffset_;\n    }\n    const bb = billboards.add(bbOptions);\n    this.setReferenceForPicking(layer, feature, bb);\n    return bb;\n  }\n\n  /**\n   * Convert an OpenLayers circle geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Circle} olGeometry OpenLayers circle geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @return {!Cesium.PrimitiveCollection} primitives\n   * @api\n   */\n  olCircleGeometryToCesium(layer, feature, olGeometry, projection, olStyle) {\n\n    olGeometry = olcsCore.olGeometryCloneTo4326(olGeometry, projection);\n    console.assert(olGeometry.getType() == 'Circle');\n\n    // ol.Coordinate\n    let center = olGeometry.getCenter();\n    const height = center.length == 3 ? center[2] : 0.0;\n    let point = center.slice();\n    point[0] += olGeometry.getRadius();\n\n    // Cesium\n    center = olcsCore.ol4326CoordinateToCesiumCartesian(center);\n    point = olcsCore.ol4326CoordinateToCesiumCartesian(point);\n\n    // Accurate computation of straight distance\n    const radius = Cesium.Cartesian3.distance(center, point);\n\n    const fillGeometry = new Cesium.CircleGeometry({\n      // always update Cesium externs before adding a property\n      center,\n      radius,\n      height\n    });\n\n    let outlinePrimitive, outlineGeometry;\n    if (this.getHeightReference(layer, feature, olGeometry) === Cesium.HeightReference.CLAMP_TO_GROUND) {\n      const width = this.extractLineWidthFromOlStyle(olStyle);\n      if (width) {\n        const circlePolygon = olCreateCircularPolygon(olGeometry.getCenter(), radius);\n        const positions = olcsCore.ol4326CoordinateArrayToCsCartesians(circlePolygon.getLinearRing(0).getCoordinates());\n        if (!isGroundPolylinePrimitiveSupported(this.scene)) {\n          const color = this.extractColorFromOlStyle(olStyle, true);\n          outlinePrimitive = this.createStackedGroundCorridors(layer, feature, width, color, positions);\n        } else {\n          outlinePrimitive = new Cesium.GroundPolylinePrimitive({\n            geometryInstances: new Cesium.GeometryInstance({\n              geometry: new Cesium.GroundPolylineGeometry({positions, width}),\n            }),\n            appearance: new Cesium.PolylineMaterialAppearance({\n              material: this.olStyleToCesium(feature, olStyle, true),\n            }),\n            classificationType: Cesium.ClassificationType.TERRAIN,\n          });\n          outlinePrimitive.readyPromise.then(() => {\n            this.setReferenceForPicking(layer, feature, outlinePrimitive._primitive);\n          });\n        }\n      }\n    } else {\n      outlineGeometry = new Cesium.CircleOutlineGeometry({\n        // always update Cesium externs before adding a property\n        center,\n        radius,\n        extrudedHeight: height,\n        height\n      });\n    }\n\n    const primitives = this.wrapFillAndOutlineGeometries(\n        layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle);\n\n    if (outlinePrimitive) {\n      primitives.add(outlinePrimitive);\n    }\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, primitives);\n  }\n\n  /**\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!number} width The width of the line.\n   * @param {!Cesium.Color} color The color of the line.\n   * @param {!Array<Cesium.Cartesian3>|Array<Array<Cesium.Cartesian3>>} positions The vertices of the line(s).\n   * @return {!Cesium.GroundPrimitive} primitive\n   */\n  createStackedGroundCorridors(layer, feature, width, color, positions) {\n    // Convert positions to an Array if it isn't\n    if (!Array.isArray(positions[0])) {\n      positions = [positions];\n    }\n    width = Math.max(3, width); // A <3px width is too small for ground primitives\n    const geometryInstances = [];\n    let previousDistance = 0;\n    // A stack of ground lines with increasing width (in meters) are created.\n    // Only one of these lines is displayed at any time giving a feeling of continuity.\n    // The values for the distance and width factor are more or less arbitrary.\n    // Applications can override this logics by subclassing the FeatureConverter class.\n    for (const distance of [1000, 4000, 16000, 64000, 254000, 1000000, 10000000]) {\n      width *= 2.14;\n      const geometryOptions = {\n        // always update Cesium externs before adding a property\n        width,\n        vertexFormat: Cesium.VertexFormat.POSITION_ONLY\n      };\n      for (const linePositions of positions) {\n        geometryOptions.positions = linePositions;\n        geometryInstances.push(new Cesium.GeometryInstance({\n          geometry: new Cesium.CorridorGeometry(geometryOptions),\n          attributes: {\n            color: Cesium.ColorGeometryInstanceAttribute.fromColor(color),\n            distanceDisplayCondition: new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(previousDistance, distance - 1)\n          }\n        }));\n      }\n      previousDistance = distance;\n    }\n    return new Cesium.GroundPrimitive({\n      // always update Cesium externs before adding a property\n      geometryInstances\n    });\n  }\n\n  /**\n   * Convert an OpenLayers line string geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.LineString} olGeometry OpenLayers line string geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @return {!Cesium.PrimitiveCollection} primitives\n   * @api\n   */\n  olLineStringGeometryToCesium(layer, feature, olGeometry, projection, olStyle) {\n\n    olGeometry = olcsCore.olGeometryCloneTo4326(olGeometry, projection);\n    console.assert(olGeometry.getType() == 'LineString');\n\n    const positions = olcsCore.ol4326CoordinateArrayToCsCartesians(olGeometry.getCoordinates());\n    const width = this.extractLineWidthFromOlStyle(olStyle);\n\n    let outlinePrimitive;\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND && !isGroundPolylinePrimitiveSupported(this.scene)) {\n      const color = this.extractColorFromOlStyle(olStyle, true);\n      outlinePrimitive = this.createStackedGroundCorridors(layer, feature, width, color, positions);\n    } else {\n      const appearance = new Cesium.PolylineMaterialAppearance({\n        // always update Cesium externs before adding a property\n        material: this.olStyleToCesium(feature, olStyle, true)\n      });\n      const geometryOptions = {\n        // always update Cesium externs before adding a property\n        positions,\n        width,\n      };\n      const primitiveOptions = {\n        // always update Cesium externs before adding a property\n        appearance\n      };\n      if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n        const geometry = new Cesium.GroundPolylineGeometry(geometryOptions);\n        primitiveOptions.geometryInstances = new Cesium.GeometryInstance({\n          geometry\n        }),\n        outlinePrimitive = new Cesium.GroundPolylinePrimitive(primitiveOptions);\n        outlinePrimitive.readyPromise.then(() => {\n          this.setReferenceForPicking(layer, feature, outlinePrimitive._primitive);\n        });\n      } else {\n        geometryOptions.vertexFormat = appearance.vertexFormat;\n        const geometry = new Cesium.PolylineGeometry(geometryOptions);\n        primitiveOptions.geometryInstances = new Cesium.GeometryInstance({\n          geometry\n        }),\n        outlinePrimitive = new Cesium.Primitive(primitiveOptions);\n      }\n    }\n\n    this.setReferenceForPicking(layer, feature, outlinePrimitive);\n\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, outlinePrimitive);\n  }\n\n  /**\n   * Convert an OpenLayers polygon geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Polygon} olGeometry OpenLayers polygon geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @return {!Cesium.PrimitiveCollection} primitives\n   * @api\n   */\n  olPolygonGeometryToCesium(layer, feature, olGeometry, projection, olStyle) {\n\n    olGeometry = olcsCore.olGeometryCloneTo4326(olGeometry, projection);\n    console.assert(olGeometry.getType() == 'Polygon');\n\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    let fillGeometry, outlineGeometry, outlinePrimitive;\n    if ((olGeometry.getCoordinates()[0].length == 5) &&\n        (feature.getGeometry().get('olcs.polygon_kind') === 'rectangle')) {\n      // Create a rectangle according to the longitude and latitude curves\n      const coordinates = olGeometry.getCoordinates()[0];\n      // Extract the West, South, East, North coordinates\n      const extent = boundingExtent(coordinates);\n      const rectangle = Cesium.Rectangle.fromDegrees(extent[0], extent[1],\n          extent[2], extent[3]);\n\n      // Extract the average height of the vertices\n      let maxHeight = 0.0;\n      if (coordinates[0].length == 3) {\n        for (let c = 0; c < coordinates.length; c++) {\n          maxHeight = Math.max(maxHeight, coordinates[c][2]);\n        }\n      }\n\n      // Render the cartographic rectangle\n      fillGeometry = new Cesium.RectangleGeometry({\n        ellipsoid: Cesium.Ellipsoid.WGS84,\n        rectangle,\n        height: maxHeight\n      });\n\n      outlineGeometry = new Cesium.RectangleOutlineGeometry({\n        ellipsoid: Cesium.Ellipsoid.WGS84,\n        rectangle,\n        height: maxHeight\n      });\n    } else {\n      const rings = olGeometry.getLinearRings();\n      // always update Cesium externs before adding a property\n      const hierarchy = {};\n      const polygonHierarchy = hierarchy;\n      console.assert(rings.length > 0);\n\n      for (let i = 0; i < rings.length; ++i) {\n        const olPos = rings[i].getCoordinates();\n        const positions = olcsCore.ol4326CoordinateArrayToCsCartesians(olPos);\n        console.assert(positions && positions.length > 0);\n        if (i == 0) {\n          hierarchy.positions = positions;\n        } else {\n          if (!hierarchy.holes) {\n            hierarchy.holes = [];\n          }\n          hierarchy.holes.push({\n            positions\n          });\n        }\n      }\n\n      fillGeometry = new Cesium.PolygonGeometry({\n        // always update Cesium externs before adding a property\n        polygonHierarchy,\n        perPositionHeight: true\n      });\n\n      // Since Cesium doesn't yet support Polygon outlines on terrain yet (coming soon...?)\n      // we don't create an outline geometry if clamped, but instead do the polyline method\n      // for each ring. Most of this code should be removeable when Cesium adds\n      // support for Polygon outlines on terrain.\n      if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n        const width = this.extractLineWidthFromOlStyle(olStyle);\n        if (width > 0) {\n          const positions = [hierarchy.positions];\n          if (hierarchy.holes) {\n            for (let i = 0; i < hierarchy.holes.length; ++i) {\n              positions.push(hierarchy.holes[i].positions);\n            }\n          }\n          if (!isGroundPolylinePrimitiveSupported(this.scene)) {\n            const color = this.extractColorFromOlStyle(olStyle, true);\n            outlinePrimitive = this.createStackedGroundCorridors(layer, feature, width, color, positions);\n          } else {\n            const appearance = new Cesium.PolylineMaterialAppearance({\n              // always update Cesium externs before adding a property\n              material: this.olStyleToCesium(feature, olStyle, true)\n            });\n            const geometryInstances = [];\n            for (const linePositions of positions) {\n              const polylineGeometry = new Cesium.GroundPolylineGeometry({positions: linePositions, width});\n              geometryInstances.push(new Cesium.GeometryInstance({\n                geometry: polylineGeometry\n              }));\n            }\n            const primitiveOptions = {\n              // always update Cesium externs before adding a property\n              appearance,\n              geometryInstances\n            };\n            outlinePrimitive = new Cesium.GroundPolylinePrimitive(primitiveOptions);\n            outlinePrimitive.readyPromise.then(() => {\n              this.setReferenceForPicking(layer, feature, outlinePrimitive._primitive);\n            });\n          }\n        }\n      } else {\n        // Actually do the normal polygon thing. This should end the removable\n        // section of code described above.\n        outlineGeometry = new Cesium.PolygonOutlineGeometry({\n          // always update Cesium externs before adding a property\n          polygonHierarchy: hierarchy,\n          perPositionHeight: true\n        });\n      }\n    }\n\n    const primitives = this.wrapFillAndOutlineGeometries(\n        layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle);\n\n    if (outlinePrimitive) {\n      primitives.add(outlinePrimitive);\n    }\n\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, primitives);\n  }\n\n  /**\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry\n   * @return {!Cesium.HeightReference}\n   * @api\n   */\n  getHeightReference(layer, feature, geometry) {\n\n    // Read from the geometry\n    let altitudeMode = geometry.get('altitudeMode');\n\n    // Or from the feature\n    if (altitudeMode === undefined) {\n      altitudeMode = feature.get('altitudeMode');\n    }\n\n    // Or from the layer\n    if (altitudeMode === undefined) {\n      altitudeMode = layer.get('altitudeMode');\n    }\n\n    let heightReference = Cesium.HeightReference.NONE;\n    if (altitudeMode === 'clampToGround') {\n      heightReference = Cesium.HeightReference.CLAMP_TO_GROUND;\n    } else if (altitudeMode === 'relativeToGround') {\n      heightReference = Cesium.HeightReference.RELATIVE_TO_GROUND;\n    }\n\n    return heightReference;\n  }\n\n  /**\n   * Convert a point geometry to a Cesium BillboardCollection.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Point} olGeometry OpenLayers point geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} style\n   * @param {!ol.style.Image} imageStyle\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when the new billboard is added.\n   * @api\n   */\n  createBillboardFromImage(\n      layer,\n      feature,\n      olGeometry,\n      projection,\n      style,\n      imageStyle,\n      billboards,\n      opt_newBillboardCallback\n  ) {\n\n    if (imageStyle instanceof olStyleIcon) {\n      // make sure the image is scheduled for load\n      imageStyle.load();\n    }\n\n    const image = imageStyle.getImage(1); // get normal density\n    const isImageLoaded = function(image) {\n      return image.src != '' &&\n          image.naturalHeight != 0 &&\n          image.naturalWidth != 0 &&\n          image.complete;\n    };\n    const reallyCreateBillboard = (function() {\n      if (!image) {\n        return;\n      }\n      if (!(image instanceof HTMLCanvasElement ||\n          image instanceof Image ||\n          image instanceof HTMLImageElement)) {\n        return;\n      }\n      const center = olGeometry.getCoordinates();\n      const position = olcsCore.ol4326CoordinateToCesiumCartesian(center);\n      let color;\n      const opacity = imageStyle.getOpacity();\n      if (opacity !== undefined) {\n        color = new Cesium.Color(1.0, 1.0, 1.0, opacity);\n      }\n\n      const scale = imageStyle.getScale();\n      const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n      const bbOptions = /** @type {Cesium.optionsBillboardCollectionAdd} */ ({\n        // always update Cesium externs before adding a property\n        image,\n        color,\n        scale,\n        heightReference,\n        position\n      });\n\n      // merge in cesium options from openlayers feature\n      Object.assign(bbOptions, feature.get('cesiumOptions'));\n\n      if (imageStyle instanceof olStyleIcon) {\n        const anchor = imageStyle.getAnchor();\n        if (anchor) {\n          bbOptions.pixelOffset = new Cesium.Cartesian2((image.width / 2 - anchor[0]) * scale, (image.height / 2 - anchor[1]) * scale);\n        }\n      }\n\n      const bb = this.csAddBillboard(billboards, bbOptions, layer, feature, olGeometry, style);\n      if (opt_newBillboardCallback) {\n        opt_newBillboardCallback(bb);\n      }\n    }).bind(this);\n\n    if (image instanceof Image && !isImageLoaded(image)) {\n      // Cesium requires the image to be loaded\n      let cancelled = false;\n      const source = layer.getSource();\n      const canceller = function() {\n        cancelled = true;\n      };\n      source.on(['removefeature', 'clear'],\n          this.boundOnRemoveOrClearFeatureListener_);\n      let cancellers = olcsUtil.obj(source)['olcs_cancellers'];\n      if (!cancellers) {\n        cancellers = olcsUtil.obj(source)['olcs_cancellers'] = {};\n      }\n\n      const fuid = getUid(feature);\n      if (cancellers[fuid]) {\n        // When the feature change quickly, a canceller may still be present so\n        // we cancel it here to prevent creation of a billboard.\n        cancellers[fuid]();\n      }\n      cancellers[fuid] = canceller;\n\n      const listener = function() {\n        image.removeEventListener('load', listener);\n        if (!billboards.isDestroyed() && !cancelled) {\n          // Create billboard if the feature is still displayed on the map.\n          reallyCreateBillboard();\n        }\n      };\n\n      image.addEventListener('load', listener);\n    } else {\n      reallyCreateBillboard();\n    }\n  }\n\n  /**\n   * Convert a point geometry to a Cesium BillboardCollection.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Point} olGeometry OpenLayers point geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} style\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when\n   * the new billboard is added.\n   * @return {Cesium.Primitive} primitives\n   * @api\n   */\n  olPointGeometryToCesium(\n      layer,\n      feature,\n      olGeometry,\n      projection,\n      style,\n      billboards,\n      opt_newBillboardCallback\n  ) {\n    console.assert(olGeometry.getType() == 'Point');\n    olGeometry = olcsCore.olGeometryCloneTo4326(olGeometry, projection);\n\n    let modelPrimitive = null;\n    const imageStyle = style.getImage();\n    if (imageStyle) {\n      const olcsModelFunction = /** @type {function():olcsx.ModelStyle} */ (olGeometry.get('olcs_model') || feature.get('olcs_model'));\n      if (olcsModelFunction) {\n        const olcsModel = olcsModelFunction();\n        const options = /** @type {Cesium.ModelFromGltfOptions} */ (Object.assign({}, {scene: this.scene}, olcsModel.cesiumOptions));\n        const model = Cesium.Model.fromGltf(options);\n        modelPrimitive = new Cesium.PrimitiveCollection();\n        modelPrimitive.add(model);\n        if (olcsModel.debugModelMatrix) {\n          modelPrimitive.add(new Cesium.DebugModelMatrixPrimitive({\n            modelMatrix: olcsModel.debugModelMatrix\n          }));\n        }\n      } else {\n        this.createBillboardFromImage(layer, feature, olGeometry, projection, style, imageStyle, billboards, opt_newBillboardCallback);\n      }\n    }\n\n    if (style.getText()) {\n      return this.addTextStyle(layer, feature, olGeometry, style, modelPrimitive || new Cesium.Primitive());\n    } else {\n      return modelPrimitive;\n    }\n  }\n\n  /**\n   * Convert an OpenLayers multi-something geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry OpenLayers geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when\n   * the new billboard is added.\n   * @return {Cesium.Primitive} primitives\n   * @api\n   */\n  olMultiGeometryToCesium(\n      layer,\n      feature,\n      geometry,\n      projection,\n      olStyle,\n      billboards,\n      opt_newBillboardCallback\n  ) {\n    // Do not reproject to 4326 now because it will be done later.\n\n    // FIXME: would be better to combine all child geometries in one primitive\n    // instead we create n primitives for simplicity.\n    const accumulate = function(geometries, functor) {\n      const primitives = new Cesium.PrimitiveCollection();\n      geometries.forEach((geometry) => {\n        primitives.add(functor(layer, feature, geometry, projection, olStyle));\n      });\n      return primitives;\n    };\n\n    let subgeos;\n    switch (geometry.getType()) {\n      case 'MultiPoint':\n        geometry = /** @type {!ol.geom.MultiPoint} */ (geometry);\n        subgeos = geometry.getPoints();\n        if (olStyle.getText()) {\n          const primitives = new Cesium.PrimitiveCollection();\n          subgeos.forEach((geometry) => {\n            console.assert(geometry);\n            const result = this.olPointGeometryToCesium(layer, feature, geometry,\n                projection, olStyle, billboards, opt_newBillboardCallback);\n            if (result) {\n              primitives.add(result);\n            }\n          });\n          return primitives;\n        } else {\n          subgeos.forEach((geometry) => {\n            console.assert(geometry);\n            this.olPointGeometryToCesium(layer, feature, geometry, projection,\n                olStyle, billboards, opt_newBillboardCallback);\n          });\n          return null;\n        }\n      case 'MultiLineString':\n        geometry = /** @type {!ol.geom.MultiLineString} */ (geometry);\n        subgeos = geometry.getLineStrings();\n        return accumulate(subgeos, this.olLineStringGeometryToCesium.bind(this));\n      case 'MultiPolygon':\n        geometry = /** @type {!ol.geom.MultiPolygon} */ (geometry);\n        subgeos = geometry.getPolygons();\n        return accumulate(subgeos, this.olPolygonGeometryToCesium.bind(this));\n      default:\n        console.assert(false, `Unhandled multi geometry type${geometry.getType()}`);\n    }\n  }\n\n  /**\n   * Convert an OpenLayers text style to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry\n   * @param {!ol.style.Text} style\n   * @return {Cesium.LabelCollection} Cesium primitive\n   * @api\n   */\n  olGeometry4326TextPartToCesium(layer, feature, geometry, style) {\n    const text = style.getText();\n    if (!text) {\n      return null;\n    }\n\n    const labels = new Cesium.LabelCollection({scene: this.scene});\n    // TODO: export and use the text draw position from OpenLayers .\n    // See src/ol/render/vector.js\n    const extentCenter = getCenter(geometry.getExtent());\n    if (geometry instanceof olGeomSimpleGeometry) {\n      const first = geometry.getFirstCoordinate();\n      extentCenter[2] = first.length == 3 ? first[2] : 0.0;\n    }\n    const options = /** @type {Cesium.optionsLabelCollection} */ ({});\n\n    options.position = olcsCore.ol4326CoordinateToCesiumCartesian(extentCenter);\n\n    options.text = text;\n\n    options.heightReference = this.getHeightReference(layer, feature, geometry);\n\n    const offsetX = style.getOffsetX();\n    const offsetY = style.getOffsetY();\n    if (offsetX != 0 && offsetY != 0) {\n      const offset = new Cesium.Cartesian2(offsetX, offsetY);\n      options.pixelOffset = offset;\n    }\n\n    options.font = style.getFont() || '10px sans-serif'; // OpenLayers default\n\n    let labelStyle = undefined;\n    if (style.getFill()) {\n      options.fillColor = this.extractColorFromOlStyle(style, false);\n      labelStyle = Cesium.LabelStyle.FILL;\n    }\n    if (style.getStroke()) {\n      options.outlineWidth = this.extractLineWidthFromOlStyle(style);\n      options.outlineColor = this.extractColorFromOlStyle(style, true);\n      labelStyle = Cesium.LabelStyle.OUTLINE;\n    }\n    if (style.getFill() && style.getStroke()) {\n      labelStyle = Cesium.LabelStyle.FILL_AND_OUTLINE;\n    }\n    options.style = labelStyle;\n\n    let horizontalOrigin;\n    switch (style.getTextAlign()) {\n      case 'left':\n        horizontalOrigin = Cesium.HorizontalOrigin.LEFT;\n        break;\n      case 'right':\n        horizontalOrigin = Cesium.HorizontalOrigin.RIGHT;\n        break;\n      case 'center':\n      default:\n        horizontalOrigin = Cesium.HorizontalOrigin.CENTER;\n    }\n    options.horizontalOrigin = horizontalOrigin;\n\n    if (style.getTextBaseline()) {\n      let verticalOrigin;\n      switch (style.getTextBaseline()) {\n        case 'top':\n          verticalOrigin = Cesium.VerticalOrigin.TOP;\n          break;\n        case 'middle':\n          verticalOrigin = Cesium.VerticalOrigin.CENTER;\n          break;\n        case 'bottom':\n          verticalOrigin = Cesium.VerticalOrigin.BOTTOM;\n          break;\n        case 'alphabetic':\n          verticalOrigin = Cesium.VerticalOrigin.TOP;\n          break;\n        case 'hanging':\n          verticalOrigin = Cesium.VerticalOrigin.BOTTOM;\n          break;\n        default:\n          console.assert(false, `unhandled baseline ${style.getTextBaseline()}`);\n      }\n      options.verticalOrigin = verticalOrigin;\n    }\n\n\n    const l = labels.add(options);\n    this.setReferenceForPicking(layer, feature, l);\n    return labels;\n  }\n\n  /**\n   * Convert an OpenLayers style to a Cesium Material.\n   * @param {ol.Feature} feature OpenLayers feature..\n   * @param {!ol.style.Style} style\n   * @param {boolean} outline\n   * @return {Cesium.Material}\n   * @api\n   */\n  olStyleToCesium(feature, style, outline) {\n    const fill = style.getFill();\n    const stroke = style.getStroke();\n    if ((outline && !stroke) || (!outline && !fill)) {\n      return null; // FIXME use a default style? Developer error?\n    }\n\n    let color = outline ? stroke.getColor() : fill.getColor();\n    color = olcsCore.convertColorToCesium(color);\n\n    if (outline && stroke.getLineDash()) {\n      return Cesium.Material.fromType('Stripe', {\n        // always update Cesium externs before adding a property\n        horizontal: false,\n        repeat: 500, // TODO how to calculate this?\n        evenColor: color,\n        oddColor: new Cesium.Color(0, 0, 0, 0) // transparent\n      });\n    } else {\n      return Cesium.Material.fromType('Color', {\n        // always update Cesium externs before adding a property\n        color\n      });\n    }\n\n  }\n\n  /**\n   * Compute OpenLayers plain style.\n   * Evaluates style function, blend arrays, get default style.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature\n   * @param {ol.StyleFunction|undefined} fallbackStyleFunction\n   * @param {number} resolution\n   * @return {Array.<!ol.style.Style>} null if no style is available\n   * @api\n   */\n  computePlainStyle(layer, feature, fallbackStyleFunction, resolution) {\n    /**\n     * @type {ol.FeatureStyleFunction|undefined}\n     */\n    const featureStyleFunction = feature.getStyleFunction();\n\n    /**\n     * @type {ol.style.Style|Array.<ol.style.Style>}\n     */\n    let style = null;\n\n    if (featureStyleFunction) {\n      style = featureStyleFunction(feature, resolution);\n    }\n\n    if (!style && fallbackStyleFunction) {\n      style = fallbackStyleFunction(feature, resolution);\n    }\n\n    if (!style) {\n      // The feature must not be displayed\n      return null;\n    }\n\n    // FIXME combine materials as in cesium-materials-pack?\n    // then this function must return a custom material\n    // More simply, could blend the colors like described in\n    // http://en.wikipedia.org/wiki/Alpha_compositing\n    return Array.isArray(style) ? style : [style];\n  }\n\n  /**\n   * @protected\n   * @param {!ol.Feature} feature\n   * @param {!ol.style.Style} style\n   * @param {!ol.geom.Geometry=} opt_geom Geometry to be converted.\n   * @return {ol.geom.Geometry|undefined}\n   */\n  getGeometryFromFeature(feature, style, opt_geom) {\n    if (opt_geom) {\n      return opt_geom;\n    }\n\n    const geom3d = /** @type {!ol.geom.Geometry} */(feature.get('olcs.3d_geometry'));\n    if (geom3d && geom3d instanceof olGeomGeometry) {\n      return geom3d;\n    }\n\n    if (style) {\n      const geomFuncRes = style.getGeometryFunction()(feature);\n      if (geomFuncRes instanceof olGeomGeometry) {\n        return geomFuncRes;\n      }\n    }\n\n    return feature.getGeometry();\n  }\n\n  /**\n   * Convert one OpenLayers feature up to a collection of Cesium primitives.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!ol.style.Style} style\n   * @param {!import('olcs/core/VectorLayerConterpart.js').OlFeatureToCesiumContext} context\n   * @param {!ol.geom.Geometry=} opt_geom Geometry to be converted.\n   * @return {Cesium.Primitive} primitives\n   * @api\n   */\n  olFeatureToCesium(layer, feature, style, context, opt_geom) {\n    let geom = this.getGeometryFromFeature(feature, style, opt_geom);\n\n    if (!geom) {\n      // OpenLayers features may not have a geometry\n      // See http://geojson.org/geojson-spec.html#feature-objects\n      return null;\n    }\n\n    const proj = context.projection;\n    const newBillboardAddedCallback = function(bb) {\n      const featureBb = context.featureToCesiumMap[getUid(feature)];\n      if (featureBb instanceof Array) {\n        featureBb.push(bb);\n      }\n      else {\n        context.featureToCesiumMap[getUid(feature)] = [bb];\n      }\n    };\n\n    switch (geom.getType()) {\n      case 'GeometryCollection':\n        const primitives = new Cesium.PrimitiveCollection();\n        const collection = /** @type {!ol.geom.GeometryCollection} */ (geom);\n        // TODO: use getGeometriesArray() instead\n        collection.getGeometries().forEach((geom) => {\n          if (geom) {\n            const prims = this.olFeatureToCesium(layer, feature, style, context,\n                geom);\n            if (prims) {\n              primitives.add(prims);\n            }\n          }\n        });\n        return primitives;\n      case 'Point':\n        geom = /** @type {!ol.geom.Point} */ (geom);\n        const bbs = context.billboards;\n        const result = this.olPointGeometryToCesium(layer, feature, geom, proj,\n            style, bbs, newBillboardAddedCallback);\n        if (!result) {\n          // no wrapping primitive\n          return null;\n        } else {\n          return result;\n        }\n      case 'Circle':\n        geom = /** @type {!ol.geom.Circle} */ (geom);\n        return this.olCircleGeometryToCesium(layer, feature, geom, proj,\n            style);\n      case 'LineString':\n        geom = /** @type {!ol.geom.LineString} */ (geom);\n        return this.olLineStringGeometryToCesium(layer, feature, geom, proj,\n            style);\n      case 'Polygon':\n        geom = /** @type {!ol.geom.Polygon} */ (geom);\n        return this.olPolygonGeometryToCesium(layer, feature, geom, proj,\n            style);\n      case 'MultiPoint':\n      case 'MultiLineString':\n      case 'MultiPolygon':\n        const result2 = this.olMultiGeometryToCesium(layer, feature, geom, proj,\n            style, context.billboards, newBillboardAddedCallback);\n        if (!result2) {\n          // no wrapping primitive\n          return null;\n        } else {\n          return result2;\n        }\n      case 'LinearRing':\n        throw new Error('LinearRing should only be part of polygon.');\n      default:\n        throw new Error(`Ol geom type not handled : ${geom.getType()}`);\n    }\n  }\n\n  /**\n   * Convert an OpenLayers vector layer to Cesium primitive collection.\n   * For each feature, the associated primitive will be stored in\n   * `featurePrimitiveMap`.\n   * @param {!(ol.layer.Vector|ol.layer.Image)} olLayer\n   * @param {!ol.View} olView\n   * @param {!Object.<number, !Cesium.Primitive>} featurePrimitiveMap\n   * @return {!olcs.core.VectorLayerCounterpart}\n   * @api\n   */\n  olVectorLayerToCesium(olLayer, olView, featurePrimitiveMap) {\n    const proj = olView.getProjection();\n    const resolution = olView.getResolution();\n\n    if (resolution === undefined || !proj) {\n      console.assert(false, 'View not ready');\n      // an assertion is not enough for closure to assume resolution and proj\n      // are defined\n      throw new Error('View not ready');\n    }\n\n    let source = olLayer.getSource();\n    if (source instanceof olSourceCluster) {\n      source = source.getSource();\n    }\n\n    console.assert(source instanceof olSourceVector);\n    const features = source.getFeatures();\n    const counterpart = new olcsCoreVectorLayerCounterpart(proj, this.scene);\n    const context = counterpart.context;\n    for (let i = 0; i < features.length; ++i) {\n      const feature = features[i];\n      if (!feature) {\n        continue;\n      }\n      /**\n       * @type {ol.StyleFunction|undefined}\n       */\n      const layerStyle = olLayer.getStyleFunction();\n      const styles = this.computePlainStyle(olLayer, feature, layerStyle,\n          resolution);\n      if (!styles || !styles.length) {\n        // only 'render' features with a style\n        continue;\n      }\n\n      /**\n       * @type {Cesium.Primitive|null}\n       */\n      let primitives = null;\n      for (let i = 0; i < styles.length; i++) {\n        const prims = this.olFeatureToCesium(olLayer, feature, styles[i], context);\n        if (prims) {\n          if (!primitives) {\n            primitives = prims;\n          } else if (prims) {\n            let i = 0, prim;\n            while ((prim = prims.get(i))) {\n              primitives.add(prim);\n              i++;\n            }\n          }\n        }\n      }\n      if (!primitives) {\n        continue;\n      }\n      featurePrimitiveMap[getUid(feature)] = primitives;\n      counterpart.getRootPrimitive().add(primitives);\n    }\n\n    return counterpart;\n  }\n\n  /**\n   * Convert an OpenLayers feature to Cesium primitive collection.\n   * @param {!(ol.layer.Vector|ol.layer.Image)} layer\n   * @param {!ol.View} view\n   * @param {!ol.Feature} feature\n   * @param {!import('olcs/core/VectorLayerConterpart.js').OlFeatureToCesiumContext} context\n   * @return {Cesium.Primitive}\n   * @api\n   */\n  convert(layer, view, feature, context) {\n    const proj = view.getProjection();\n    const resolution = view.getResolution();\n\n    if (resolution == undefined || !proj) {\n      return null;\n    }\n\n    /**\n     * @type {ol.StyleFunction|undefined}\n     */\n    const layerStyle = layer.getStyleFunction();\n\n    const styles = this.computePlainStyle(layer, feature, layerStyle, resolution);\n\n    if (!styles || !styles.length) {\n      // only 'render' features with a style\n      return null;\n    }\n\n    context.projection = proj;\n\n    /**\n     * @type {Cesium.Primitive|null}\n     */\n    let primitives = null;\n    for (let i = 0; i < styles.length; i++) {\n      const prims = this.olFeatureToCesium(layer, feature, styles[i], context);\n      if (!primitives) {\n        primitives = prims;\n      } else if (prims) {\n        let i = 0, prim;\n        while ((prim = prims.get(i))) {\n          primitives.add(prim);\n          i++;\n        }\n      }\n    }\n    return primitives;\n  }\n}\n\n\nexport default FeatureConverter;\n","/**\n * @module olcs.VectorSynchronizer\n */\nimport olSourceVector from 'ol/source/Vector.js';\nimport olLayerLayer from 'ol/layer/Layer.js';\nimport olSourceCluster from 'ol/source/Cluster.js';\nimport olLayerImage from 'ol/layer/Image.js';\nimport {olcsListen, getUid} from './util.js';\nimport olLayerVector from 'ol/layer/Vector.js';\nimport olLayerVectorTile from 'ol/layer/VectorTile.js';\nimport olcsAbstractSynchronizer from './AbstractSynchronizer.js';\nimport olcsFeatureConverter from './FeatureConverter.js';\n\nclass VectorSynchronizer extends olcsAbstractSynchronizer {\n  /**\n   * Unidirectionally synchronize OpenLayers vector layers to Cesium.\n   * @param {!ol.Map} map\n   * @param {!Cesium.Scene} scene\n   * @param {olcs.FeatureConverter=} opt_converter\n   * @extends {olcs.AbstractSynchronizer.<olcs.core.VectorLayerCounterpart>}\n   * @api\n   */\n  constructor(map, scene, opt_converter) {\n    super(map, scene);\n\n    /**\n     * @protected\n     */\n    this.converter = opt_converter || new olcsFeatureConverter(scene);\n\n    /**\n     * @private\n     */\n    this.csAllPrimitives_ = new Cesium.PrimitiveCollection();\n    scene.primitives.add(this.csAllPrimitives_);\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  addCesiumObject(counterpart) {\n    console.assert(counterpart);\n    counterpart.getRootPrimitive()['counterpart'] = counterpart;\n    this.csAllPrimitives_.add(counterpart.getRootPrimitive());\n  }\n\n  /**\n   * @inheritDoc\n   */\n  destroyCesiumObject(object) {\n    object.getRootPrimitive().destroy();\n  }\n\n  /**\n   * @inheritDoc\n   */\n  removeSingleCesiumObject(object, destroy) {\n    object.destroy();\n    this.csAllPrimitives_.destroyPrimitives = destroy;\n    this.csAllPrimitives_.remove(object.getRootPrimitive());\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  removeAllCesiumObjects(destroy) {\n    this.csAllPrimitives_.destroyPrimitives = destroy;\n    if (destroy) {\n      for (let i = 0; i < this.csAllPrimitives_.length; ++i) {\n        this.csAllPrimitives_.get(i)['counterpart'].destroy();\n      }\n    }\n    this.csAllPrimitives_.removeAll();\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  /**\n   * Synchronizes the layer visibility properties\n   * to the given Cesium Primitive.\n   * @param {import('olsc/core.js').LayerWithParents} olLayerWithParents\n   * @param {!Cesium.Primitive} csPrimitive\n   */\n  updateLayerVisibility(olLayerWithParents, csPrimitive) {\n    let visible = true;\n    [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayer) => {\n      const layerVisible = olLayer.getVisible();\n      if (layerVisible !== undefined) {\n        visible &= layerVisible;\n      } else {\n        visible = false;\n      }\n    });\n    csPrimitive.show = visible;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  createSingleLayerCounterparts(olLayerWithParents) {\n    const olLayer = olLayerWithParents.layer;\n    if (!(olLayer instanceof olLayerVector) || olLayer instanceof olLayerVectorTile) {\n      return null;\n    }\n    console.assert(olLayer instanceof olLayerLayer);\n\n    let source = olLayer.getSource();\n    if (source instanceof olSourceCluster) {\n      source = source.getSource();\n    }\n\n    if (!source) {\n      return null;\n    }\n\n    console.assert(source instanceof olSourceVector);\n    console.assert(this.view);\n\n    const view = this.view;\n    const featurePrimitiveMap = {};\n    const counterpart = this.converter.olVectorLayerToCesium(olLayer, view,\n        featurePrimitiveMap);\n    const csPrimitives = counterpart.getRootPrimitive();\n    const olListenKeys = counterpart.olListenKeys;\n\n    [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayerItem) => {\n      olListenKeys.push(olcsListen(olLayerItem, 'change:visible', () => {\n        this.updateLayerVisibility(olLayerWithParents, csPrimitives);\n      }));\n    });\n    this.updateLayerVisibility(olLayerWithParents, csPrimitives);\n\n    const onAddFeature = (function(feature) {\n      console.assert(\n          (olLayer instanceof olLayerVector) ||\n          (olLayer instanceof olLayerImage)\n      );\n      const context = counterpart.context;\n      const prim = this.converter.convert(olLayer, view, feature, context);\n      if (prim) {\n        featurePrimitiveMap[getUid(feature)] = prim;\n        csPrimitives.add(prim);\n      }\n    }).bind(this);\n\n    const onRemoveFeature = (function(feature) {\n      const id = getUid(feature);\n      const context = counterpart.context;\n      const bbs = context.featureToCesiumMap[id];\n      if (bbs) {\n        delete context.featureToCesiumMap[id];\n        bbs.forEach((bb) => {\n          if (bb instanceof Cesium.Billboard) {\n            context.billboards.remove(bb);\n          }\n        });\n      }\n      const csPrimitive = featurePrimitiveMap[id];\n      delete featurePrimitiveMap[id];\n      if (csPrimitive) {\n        csPrimitives.remove(csPrimitive);\n      }\n    }).bind(this);\n\n    olListenKeys.push(olcsListen(source, 'addfeature', (e) => {\n      console.assert(e.feature);\n      onAddFeature(e.feature);\n    }, this));\n\n    olListenKeys.push(olcsListen(source, 'removefeature', (e) => {\n      console.assert(e.feature);\n      onRemoveFeature(e.feature);\n    }, this));\n\n    olListenKeys.push(olcsListen(source, 'changefeature', (e) => {\n      const feature = e.feature;\n      console.assert(feature);\n      onRemoveFeature(feature);\n      onAddFeature(feature);\n    }, this));\n\n    return counterpart ? [counterpart] : null;\n  }\n}\n\nexport default VectorSynchronizer;\n","/**\n * @module olcs.SynchronizedOverlay\n */\nimport olOverlay from 'ol/Overlay.js';\nimport {transform} from 'ol/proj.js';\nimport {removeNode, removeChildren} from './util.js';\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\n\n\n/**\n * Options for SynchronizedOverlay\n * @typedef {Object} SynchronizedOverlayOptions\n * @property {!Cesium.Scene} scene\n * @property {olOverlay} parent\n * @property {!import('olsc/OverlaySynchronizer.js').default} synchronizer\n */\n\n\nclass SynchronizedOverlay extends olOverlay {\n  /**\n   * @param {olcsx.SynchronizedOverlayOptions} options SynchronizedOverlay Options.\n   * @api\n   */\n  constructor(options) {\n    const parent = options.parent;\n    super(parent.getOptions());\n\n    /**\n     * @private\n     * @type {?Function}\n     */\n    this.scenePostRenderListenerRemover_ = null;\n\n    /**\n     * @private\n     * @type {!Cesium.Scene}\n     */\n    this.scene_ = options.scene;\n\n    /**\n     * @private\n     * @type {!olcs.OverlaySynchronizer}\n     */\n    this.synchronizer_ = options.synchronizer;\n\n    /**\n     * @private\n     * @type {!ol.Overlay}\n     */\n    this.parent_ = parent;\n\n    /**\n     * @private\n     * @type {ol.Coordinate|undefined}\n     */\n    this.positionWGS84_ = undefined;\n\n    /**\n     * @private\n     * @type {MutationObserver}\n     */\n    this.observer_ = new MutationObserver(this.handleElementChanged.bind(this));\n\n    /**\n     * @private\n     * @type {Array.<MutationObserver>}\n     */\n    this.attributeObserver_ = [];\n\n    /**\n     * @private\n     * @type {Array<ol.EventsKey>}\n     */\n    this.listenerKeys_ = [];\n    // synchronize our Overlay with the parent Overlay\n    const setPropertyFromEvent = event => this.setPropertyFromEvent_(event);\n    this.listenerKeys_.push(this.parent_.on('change:position', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:element', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:offset', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:position', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:positioning', setPropertyFromEvent));\n\n    this.setProperties(this.parent_.getProperties());\n\n    this.handleMapChanged();\n    this.handleElementChanged();\n  }\n\n  /**\n   * @param {Node} target\n   * @private\n   */\n  observeTarget_(target) {\n    if (!this.observer_) {\n      // not ready, skip the event (this occurs on construction)\n      return;\n    }\n    this.observer_.disconnect();\n    this.observer_.observe(target, {\n      attributes: false,\n      childList: true,\n      characterData: true,\n      subtree: true\n    });\n    this.attributeObserver_.forEach((observer) => {\n      observer.disconnect();\n    });\n    this.attributeObserver_.length = 0;\n    for (let i = 0; i < target.childNodes.length; i++) {\n      const node = target.childNodes[i];\n      if (node.nodeType === 1) {\n        const observer = new MutationObserver(this.handleElementChanged.bind(this));\n        observer.observe(node, {\n          attributes: true,\n          subtree: true\n        });\n        this.attributeObserver_.push(observer);\n      }\n    }\n  }\n\n  /**\n   *\n   * @param {ol.Object.Event} event\n   * @private\n   */\n  setPropertyFromEvent_(event) {\n    if (event.target && event.key) {\n      this.set(event.key, event.target.get(event.key));\n    }\n  }\n\n  /**\n   * Get the scene associated with this overlay.\n   * @see ol.Overlay.prototype.getMap\n   * @return {!Cesium.Scene} The scene that the overlay is part of.\n   * @api\n   */\n  getScene() {\n    return this.scene_;\n  }\n\n  /**\n   * @override\n   */\n  handleMapChanged() {\n    if (this.scenePostRenderListenerRemover_) {\n      this.scenePostRenderListenerRemover_();\n      removeNode(this.element);\n    }\n    this.scenePostRenderListenerRemover_ = null;\n    const scene = this.getScene();\n    if (scene) {\n      this.scenePostRenderListenerRemover_ = scene.postRender.addEventListener(this.updatePixelPosition.bind(this));\n      this.updatePixelPosition();\n      const container = this.stopEvent ?\n        this.synchronizer_.getOverlayContainerStopEvent() : this.synchronizer_.getOverlayContainer();\n      if (this.insertFirst) {\n        container.insertBefore(this.element, container.childNodes[0] || null);\n      } else {\n        container.appendChild(this.element);\n      }\n    }\n  }\n\n  /**\n   * @override\n   */\n  handlePositionChanged() {\n    // transform position to WGS84\n    const position = this.getPosition();\n    if (position) {\n      const sourceProjection = this.parent_.getMap().getView().getProjection();\n      this.positionWGS84_ = transform(position, sourceProjection, 'EPSG:4326');\n    } else {\n      this.positionWGS84_ = undefined;\n    }\n    this.updatePixelPosition();\n  }\n\n  /**\n   * @override\n   */\n  handleElementChanged() {\n    function cloneNode(node, parent) {\n      const clone = node.cloneNode();\n      if (node.nodeName === 'CANVAS') {\n        const ctx = clone.getContext('2d');\n        ctx.drawImage(node, 0, 0);\n      }\n      if (parent) {\n        parent.appendChild(clone);\n      }\n      if (node.nodeType != Node.TEXT_NODE) {\n        clone.addEventListener('click', (event) => {\n          node.dispatchEvent(new MouseEvent('click', event));\n          event.stopPropagation();\n        });\n      }\n      const nodes = node.childNodes;\n      for (let i = 0; i < nodes.length; i++) {\n        if (!nodes[i]) {\n          continue;\n        }\n        cloneNode(nodes[i], clone);\n      }\n      return clone;\n    }\n    removeChildren(this.element);\n    const element = this.getElement();\n    if (element) {\n      if (element.parentNode && element.parentNode.childNodes) {\n        for (const node of element.parentNode.childNodes) {\n          const clonedNode = cloneNode(node, null);\n          this.element.appendChild(clonedNode);\n        }\n      }\n    }\n    if (element.parentNode) {\n      // set new Observer\n      this.observeTarget_(element.parentNode);\n    }\n  }\n\n  /**\n   * @override\n   */\n  updatePixelPosition() {\n    const position = this.positionWGS84_;\n    if (!this.scene_ || !position) {\n      this.setVisible(false);\n      return;\n    }\n    let height = 0;\n    if (position.length === 2) {\n      const globeHeight = this.scene_.globe.getHeight(Cesium.Cartographic.fromDegrees(position[0], position[1]));\n      if (globeHeight && this.scene_.globe.tilesLoaded) {\n        position[2] = globeHeight;\n      }\n      if (globeHeight) {\n        height = globeHeight;\n      }\n    } else {\n      height = position[2];\n    }\n    const cartesian = Cesium.Cartesian3.fromDegrees(position[0], position[1], height);\n    const camera = this.scene_.camera;\n    const ellipsoidBoundingSphere = new Cesium.BoundingSphere(new Cesium.Cartesian3(), 6356752);\n    const occluder = new Cesium.Occluder(ellipsoidBoundingSphere, camera.position);\n    // check if overlay position is behind the horizon\n    if (!occluder.isPointVisible(cartesian)) {\n      this.setVisible(false);\n      return;\n    }\n    const cullingVolume = camera.frustum.computeCullingVolume(camera.position, camera.direction, camera.up);\n    // check if overlay position is visible from the camera\n    if (cullingVolume.computeVisibility(new Cesium.BoundingSphere(cartesian)) !== 1) {\n      this.setVisible(false);\n      return;\n    }\n    this.setVisible(true);\n\n    const pixelCartesian = this.scene_.cartesianToCanvasCoordinates(cartesian);\n    const pixel = [pixelCartesian.x, pixelCartesian.y];\n    const mapSize = [this.scene_.canvas.width, this.scene_.canvas.height];\n    this.updateRenderedPosition(pixel, mapSize);\n  }\n\n  /**\n   * Destroys the overlay, removing all its listeners and elements\n   * @api\n   */\n  destroy() {\n    if (this.scenePostRenderListenerRemover_) {\n      this.scenePostRenderListenerRemover_();\n    }\n    if (this.observer_) {\n      this.observer_.disconnect();\n    }\n    olObservableUnByKey(this.listenerKeys_);\n    this.listenerKeys_.splice(0);\n    if (this.element.removeNode) {\n      this.element.removeNode(true);\n    } else {\n      this.element.remove();\n    }\n    this.element = null;\n  }\n}\n\nexport default SynchronizedOverlay;\n","/**\n * @module olcs.OverlaySynchronizer\n */\nimport olcsSynchronizedOverlay from './SynchronizedOverlay.js';\nimport {getUid} from './util.js';\n\nclass OverlaySynchronizer {\n  /**\n  * @param {!ol.Map} map\n  * @param {!Cesium.Scene} scene\n  * @constructor\n  * @template T\n  * @api\n  */\n  constructor(map, scene) {\n    /**\n    * @type {!ol.Map}\n    * @protected\n    */\n    this.map = map;\n\n    /**\n    * @type {ol.Collection.<ol.Overlay>}\n    * @private\n    */\n    this.overlays_ = this.map.getOverlays();\n\n    /**\n    * @type {!Cesium.Scene}\n    * @protected\n    */\n    this.scene = scene;\n\n    /**\n    * @private\n    * @type {!Element}\n    */\n    this.overlayContainerStopEvent_ = document.createElement('DIV');\n    this.overlayContainerStopEvent_.className = 'ol-overlaycontainer-stopevent';\n    const overlayEvents = ['click', 'dblclick', 'mousedown', 'touchstart', 'MSPointerDown', 'pointerdown', 'mousewheel', 'wheel'];\n    overlayEvents.forEach((event) => {\n      this.overlayContainerStopEvent_.addEventListener(event, evt => evt.stopPropagation());\n    });\n    this.scene.canvas.parentElement.appendChild(this.overlayContainerStopEvent_);\n\n    /**\n    * @private\n    * @type {!Element}\n    */\n    this.overlayContainer_ = document.createElement('DIV');\n    this.overlayContainer_.className = 'ol-overlaycontainer';\n    this.scene.canvas.parentElement.appendChild(this.overlayContainer_);\n\n\n    /**\n    * @type {!Object<?,olcs.SynchronizedOverlay>}\n    * @private\n    */\n    this.overlayMap_ = {};\n  }\n\n  /**\n  * Get the element that serves as a container for overlays that don't allow\n  * event propagation. Elements added to this container won't let mousedown and\n  * touchstart events through to the map, so clicks and gestures on an overlay\n  * don't trigger any {@link ol.MapBrowserEvent}.\n  * @return {!Element} The map's overlay container that stops events.\n  */\n  getOverlayContainerStopEvent() {\n    return this.overlayContainerStopEvent_;\n  }\n\n  /**\n  * Get the element that serves as a container for overlays.\n  * @return {!Element} The map's overlay container.\n  */\n  getOverlayContainer() {\n    return this.overlayContainer_;\n  }\n\n  /**\n  * Destroy all and perform complete synchronization of the overlays.\n  * @api\n  */\n  synchronize() {\n    this.destroyAll();\n    this.addOverlays();\n    this.overlays_.on('add', this.addOverlayFromEvent_.bind(this));\n    this.overlays_.on('remove', this.removeOverlayFromEvent_.bind(this));\n  }\n\n  /**\n  * @param {ol.Collection.Event} event\n  * @private\n  */\n  addOverlayFromEvent_(event) {\n    const overlay = /** @type {ol.Overlay} */ (event.element);\n    this.addOverlay(overlay);\n  }\n\n  /**\n  * @api\n  */\n  addOverlays() {\n    this.overlays_.forEach((overlay) => { this.addOverlay(overlay); });\n  }\n\n  /**\n  * @param {ol.Overlay} overlay\n  * @api\n  */\n  addOverlay(overlay) {\n    if (!overlay) {\n      return;\n    }\n    const cesiumOverlay = new olcsSynchronizedOverlay({\n      scene: this.scene,\n      synchronizer: this,\n      parent: overlay\n    });\n\n    const overlayId = getUid(overlay).toString();\n    this.overlayMap_[overlayId] = cesiumOverlay;\n  }\n\n  /**\n  * @param {ol.Collection.Event} event\n  * @private\n  */\n  removeOverlayFromEvent_(event) {\n    const removedOverlay = /** @type {ol.Overlay} */ (event.element);\n    this.removeOverlay(removedOverlay);\n  }\n\n  /**\n  * Removes an overlay from the scene\n  * @param {ol.Overlay} overlay\n  * @api\n  */\n  removeOverlay(overlay) {\n    const overlayId = getUid(overlay).toString();\n    const csOverlay = this.overlayMap_[overlayId];\n    if (csOverlay) {\n      csOverlay.destroy();\n      delete this.overlayMap_[overlayId];\n    }\n  }\n\n  /**\n  * Destroys all the created Cesium objects.\n  * @protected\n  */\n  destroyAll() {\n    Object.keys(this.overlayMap_).forEach((key) => {\n      const overlay = this.overlayMap_[key];\n      overlay.destroy();\n      delete this.overlayMap_[key];\n    });\n  }\n}\n\n\nexport default OverlaySynchronizer;\n","/**\n * @module olcs.OLCesium\n */\nimport olGeomPoint from 'ol/geom/Point.js';\nimport {getTransform} from 'ol/proj.js';\nimport olcsUtil from './util.js';\nimport olcsCore from './core.js';\nimport olcsAutoRenderLoop from './AutoRenderLoop.js';\nimport olcsCamera from './Camera.js';\nimport olcsRasterSynchronizer from './RasterSynchronizer.js';\nimport olcsVectorSynchronizer from './VectorSynchronizer.js';\nimport olcsOverlaySynchronizer from './OverlaySynchronizer.js';\n\n\n/**\n * @typedef {Object} OLCesiumOptions\n * @property {import('ol/Map.js').default} map The OpenLayers map we want to show on a Cesium scene.\n * @property {Element|string} [target] Target element for the Cesium scene.\n * @property {function(!import('ol/Map.js').default, !Cesium.Scene, !Cesium.DataSourceCollection): Array<import('olcs/AbstractSynchronizer.js').default>}\n *      [createSynchronizers] Callback function which will be called by the {@link olcs.OLCesium}\n *      constructor to create custom synchronizers. Receives an `ol.Map` and a `Cesium.Scene` as arguments,\n *      and needs to return an array of {@link import('olcs/AbstractSynchronizer.js').default}.\n * @property {function(): Cesium.JulianDate} [time] Control the current time used by Cesium.\n * @property {boolean} [stopOpenLayersEventsPropagation] Prevent propagation of mouse/touch events to\n *      OpenLayers when Cesium is active.\n * @property {Cesium.SceneOptions} [sceneOptions] Allows the passing of property value to the\n *      `Cesium.Scene`.\n */\n\n\nclass OLCesium {\n  /**\n   * @param {!OLCesiumOptions} options Options.\n   * @constructor\n   * @api\n   */\n  constructor(options) {\n\n    /**\n     * @type {olcs.AutoRenderLoop}\n     * @private\n     */\n    this.autoRenderLoop_ = null;\n\n    /**\n     * @type {!ol.Map}\n     * @private\n     */\n    this.map_ = options.map;\n\n    /**\n     * @type {!function(): Cesium.JulianDate}\n     * @private\n     */\n    this.time_ = options.time || function() {\n      return Cesium.JulianDate.now();\n    };\n\n    /**\n     * No change of the view projection.\n     * @private\n     */\n    this.to4326Transform_ = getTransform(this.map_.getView().getProjection(), 'EPSG:4326');\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.resolutionScale_ = 1.0;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.canvasClientWidth_ = 0.0;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.canvasClientHeight_ = 0.0;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.resolutionScaleChanged_ = true; // force resize\n\n    const fillArea = 'position:absolute;top:0;left:0;width:100%;height:100%;';\n\n    /**\n     * @type {!Element}\n     * @private\n     */\n    this.container_ = document.createElement('DIV');\n    const containerAttribute = document.createAttribute('style');\n    containerAttribute.value = `${fillArea}visibility:hidden;`;\n    this.container_.setAttributeNode(containerAttribute);\n\n    let targetElement = options.target || this.map_.getViewport();\n    if (typeof targetElement === 'string') {\n      targetElement = document.getElementById(targetElement);\n    }\n    targetElement.appendChild(this.container_);\n\n    /**\n     * Whether the Cesium container is placed over the ol map.\n     * a target => side by side mode\n     * no target => over map mode\n     * @type {boolean}\n     * @private\n     */\n    this.isOverMap_ = !options.target;\n\n\n    if (this.isOverMap_ && options.stopOpenLayersEventsPropagation) {\n      const overlayEvents = ['click', 'dblclick', 'mousedown', 'touchstart', 'MSPointerDown', 'pointerdown', 'mousewheel', 'wheel'];\n      for (let i = 0, ii = overlayEvents.length; i < ii; ++i) {\n        this.container_.addEventListener(overlayEvents[i], evt => evt.stopPropagation());\n      }\n    }\n\n\n    /**\n     * @type {!HTMLCanvasElement}\n     * @private\n     */\n    this.canvas_ = /** @type {!HTMLCanvasElement} */ (document.createElement('CANVAS'));\n    const canvasAttribute = document.createAttribute('style');\n    canvasAttribute.value = fillArea;\n    this.canvas_.setAttributeNode(canvasAttribute);\n\n    if (olcsUtil.supportsImageRenderingPixelated()) {\n      // non standard CSS4\n      this.canvas_.style['imageRendering'] = olcsUtil.imageRenderingValue();\n    }\n\n    this.canvas_.oncontextmenu = function() { return false; };\n    this.canvas_.onselectstart = function() { return false; };\n\n    this.container_.appendChild(this.canvas_);\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.enabled_ = false;\n\n    /**\n     * @type {!Array.<ol.interaction.Interaction>}\n     * @private\n     */\n    this.pausedInteractions_ = [];\n\n    /**\n     * @type {?ol.layer.Group}\n     * @private\n     */\n    this.hiddenRootGroup_ = null;\n\n    const sceneOptions = options.sceneOptions !== undefined ? options.sceneOptions :\n      /** @type {Cesium.SceneOptions} */ ({});\n    sceneOptions.canvas = this.canvas_;\n    sceneOptions.scene3DOnly = true;\n\n    /**\n     * @type {!Cesium.Scene}\n     * @private\n     */\n    this.scene_ = new Cesium.Scene(sceneOptions);\n\n    const sscc = this.scene_.screenSpaceCameraController;\n\n    sscc.tiltEventTypes.push({\n      'eventType': Cesium.CameraEventType.LEFT_DRAG,\n      'modifier': Cesium.KeyboardEventModifier.SHIFT\n    });\n\n    sscc.tiltEventTypes.push({\n      'eventType': Cesium.CameraEventType.LEFT_DRAG,\n      'modifier': Cesium.KeyboardEventModifier.ALT\n    });\n\n    sscc.enableLook = false;\n\n    this.scene_.camera.constrainedAxis = Cesium.Cartesian3.UNIT_Z;\n\n    /**\n     * @type {!olcs.Camera}\n     * @private\n     */\n    this.camera_ = new olcsCamera(this.scene_, this.map_);\n\n    /**\n     * @type {!Cesium.Globe}\n     * @private\n     */\n    this.globe_ = new Cesium.Globe(Cesium.Ellipsoid.WGS84);\n    this.globe_.baseColor = Cesium.Color.WHITE;\n    this.scene_.globe = this.globe_;\n    this.scene_.skyAtmosphere = new Cesium.SkyAtmosphere();\n\n    // The first layer of Cesium is special; using a 1x1 transparent image to workaround it.\n    // See https://github.com/AnalyticalGraphicsInc/cesium/issues/1323 for details.\n    const firstImageryProvider = new Cesium.SingleTileImageryProvider({\n      url: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=',\n      rectangle: Cesium.Rectangle.fromDegrees(0, 0, 1, 1) // the Rectangle dimensions are arbitrary\n    });\n    this.globe_.imageryLayers.addImageryProvider(firstImageryProvider, 0);\n\n    this.dataSourceCollection_ = new Cesium.DataSourceCollection();\n    this.dataSourceDisplay_ = new Cesium.DataSourceDisplay({\n      scene: this.scene_,\n      dataSourceCollection: this.dataSourceCollection_\n    });\n\n    const synchronizers = options.createSynchronizers ?\n      options.createSynchronizers(this.map_, this.scene_, this.dataSourceCollection_) : [\n        new olcsRasterSynchronizer(this.map_, this.scene_),\n        new olcsVectorSynchronizer(this.map_, this.scene_),\n        new olcsOverlaySynchronizer(this.map_, this.scene_)\n      ];\n\n    // Assures correct canvas size after initialisation\n    this.handleResize_();\n\n    for (let i = synchronizers.length - 1; i >= 0; --i) {\n      synchronizers[i].synchronize();\n    }\n\n    /**\n     * Time of the last rendered frame, as returned by `performance.now()`.\n     * @type {number}\n     * @private\n     */\n    this.lastFrameTime_ = 0;\n\n    /**\n     * The identifier returned by `requestAnimationFrame`.\n     * @type {number|undefined}\n     * @private\n     */\n    this.renderId_ = undefined;\n\n    /**\n     * Target frame rate for the render loop.\n     * @type {number}\n     * @private\n     */\n    this.targetFrameRate_ = Number.POSITIVE_INFINITY;\n\n    /**\n     * If the Cesium render loop is being blocked.\n     * @type {boolean}\n     * @private\n     */\n    this.blockCesiumRendering_ = false;\n\n    /**\n     * If the warmup routine is active.\n     * @type {boolean}\n     * @private\n     */\n    this.warmingUp_ = false;\n\n    /**\n     * @type {ol.Feature}\n     * @private\n     */\n    this.trackedFeature_ = null;\n\n    /**\n     * @type {Cesium.Entity}\n     * @private\n     */\n    this.trackedEntity_ = null;\n\n    /**\n     * @type {Cesium.EntityView}\n     * @private\n     */\n    this.entityView_ = null;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.needTrackedEntityUpdate_ = false;\n\n    /**\n     * @type {!Cesium.BoundingSphere}\n     */\n    this.boundingSphereScratch_ = new Cesium.BoundingSphere();\n\n    const eventHelper = new Cesium.EventHelper();\n    eventHelper.add(this.scene_.postRender, OLCesium.prototype.updateTrackedEntity_, this);\n\n    // Cesium has a mechanism to prevent the camera to go under the terrain.\n    // Unfortunately, it is only active when all the terrain has been loaded, which:\n    // - does not prevent the camera to sink under terrain anymore;\n    // - introduce a jumping effect once all terrain has been loaded and the position of the camera is finally fixed.\n    // The property below enables a workaround found in the Camptocamp Cesium fork.\n    // See also https://github.com/AnalyticalGraphicsInc/cesium/issues/5999.\n    Cesium.Camera.enableSuspendTerrainAdjustment = false;\n  }\n\n  /**\n   * Render the Cesium scene.\n   * @private\n   */\n  render_() {\n    // if a call to `requestAnimationFrame` is pending, cancel it\n    if (this.renderId_ !== undefined) {\n      cancelAnimationFrame(this.renderId_);\n      this.renderId_ = undefined;\n    }\n\n    // only render if Cesium is enabled/warming and rendering hasn't been blocked\n    if ((this.enabled_ || this.warmingUp_) && !this.blockCesiumRendering_) {\n      this.renderId_ = requestAnimationFrame(this.onAnimationFrame_.bind(this));\n    }\n  }\n\n  /**\n   * Callback for `requestAnimationFrame`.\n   * @param {number} frameTime The frame time, from `performance.now()`.\n   * @private\n   */\n  onAnimationFrame_(frameTime) {\n    this.renderId_ = undefined;\n\n    // check if a frame was rendered within the target frame rate\n    const interval = 1000.0 / this.targetFrameRate_;\n    const delta = frameTime - this.lastFrameTime_;\n    if (delta < interval) {\n      // too soon, don't render yet\n      this.render_();\n      return;\n    }\n\n    // time to render a frame, save the time\n    this.lastFrameTime_ = frameTime;\n\n    const julianDate = this.time_();\n    this.scene_.initializeFrame();\n    this.handleResize_();\n    this.dataSourceDisplay_.update(julianDate);\n\n    // Update tracked entity\n    if (this.entityView_) {\n      const trackedEntity = this.trackedEntity_;\n      const trackedState = this.dataSourceDisplay_.getBoundingSphere(trackedEntity, false, this.boundingSphereScratch_);\n      if (trackedState === Cesium.BoundingSphereState.DONE) {\n        this.boundingSphereScratch_.radius = 1; // a radius of 1 is enough for tracking points\n        this.entityView_.update(julianDate, this.boundingSphereScratch_);\n      }\n    }\n\n    this.scene_.render(julianDate);\n    this.camera_.checkCameraChange();\n\n    // request the next render call after this one completes to ensure the browser doesn't get backed up\n    this.render_();\n  }\n\n  /**\n   * @private\n   */\n  updateTrackedEntity_() {\n    if (!this.needTrackedEntityUpdate_) {\n      return;\n    }\n\n    const trackedEntity = this.trackedEntity_;\n    const scene = this.scene_;\n\n    const state = this.dataSourceDisplay_.getBoundingSphere(trackedEntity, false, this.boundingSphereScratch_);\n    if (state === Cesium.BoundingSphereState.PENDING) {\n      return;\n    }\n\n    scene.screenSpaceCameraController.enableTilt = false;\n\n    const bs = state !== Cesium.BoundingSphereState.FAILED ? this.boundingSphereScratch_ : undefined;\n    if (bs) {\n      bs.radius = 1;\n    }\n    this.entityView_ = new Cesium.EntityView(trackedEntity, scene, scene.mapProjection.ellipsoid);\n    this.entityView_.update(this.time_(), bs);\n    this.needTrackedEntityUpdate_ = false;\n  }\n\n  /**\n   * @private\n   */\n  handleResize_() {\n    let width = this.canvas_.clientWidth;\n    let height = this.canvas_.clientHeight;\n\n    if (width === 0 | height === 0) {\n      // The canvas DOM element is not ready yet.\n      return;\n    }\n\n    if (width === this.canvasClientWidth_ &&\n        height === this.canvasClientHeight_ &&\n        !this.resolutionScaleChanged_) {\n      return;\n    }\n\n    let resolutionScale = this.resolutionScale_;\n    if (!olcsUtil.supportsImageRenderingPixelated()) {\n      resolutionScale *= window.devicePixelRatio || 1.0;\n    }\n    this.resolutionScaleChanged_ = false;\n\n    this.canvasClientWidth_ = width;\n    this.canvasClientHeight_ = height;\n\n    width *= resolutionScale;\n    height *= resolutionScale;\n\n    this.canvas_.width = width;\n    this.canvas_.height = height;\n    this.scene_.camera.frustum.aspectRatio = width / height;\n  }\n\n  /**\n   * @return {!olcs.Camera}\n   * @api\n   */\n  getCamera() {\n    return this.camera_;\n  }\n\n  /**\n   * @return {!ol.Map}\n   * @api\n   */\n  getOlMap() {\n    return this.map_;\n  }\n\n  /**\n   * @return {!ol.View}\n   * @api\n   */\n  getOlView() {\n    const view = this.map_.getView();\n    console.assert(view);\n    return view;\n  }\n\n  /**\n   * @return {!Cesium.Scene}\n   * @api\n   */\n  getCesiumScene() {\n    return this.scene_;\n  }\n\n  /**\n   * @return {!Cesium.DataSourceCollection}\n   * @api\n   */\n  getDataSources() {\n    return this.dataSourceCollection_;\n  }\n\n  /**\n   * @return {!Cesium.DataSourceDisplay}\n   * @api\n   */\n  getDataSourceDisplay() {\n    return this.dataSourceDisplay_;\n  }\n\n  /**\n   * @return {boolean}\n   * @api\n   */\n  getEnabled() {\n    return this.enabled_;\n  }\n\n  /**\n   * Enables/disables the Cesium.\n   * This modifies the visibility style of the container element.\n   * @param {boolean} enable\n   * @api\n   */\n  setEnabled(enable) {\n    if (this.enabled_ === enable) {\n      return;\n    }\n    this.enabled_ = enable;\n\n    // some Cesium operations are operating with canvas.clientWidth,\n    // so we can't remove it from DOM or even make display:none;\n    this.container_.style.visibility = this.enabled_ ? 'visible' : 'hidden';\n    let interactions;\n    if (this.enabled_) {\n      this.throwOnUnitializedMap_();\n      if (this.isOverMap_) {\n        interactions = this.map_.getInteractions();\n        interactions.forEach((el, i, arr) => {\n          this.pausedInteractions_.push(el);\n        });\n        interactions.clear();\n\n        this.map_.addInteraction = interaction => this.pausedInteractions_.push(interaction);\n        this.map_.removeInteraction = interaction =>\n          this.pausedInteractions_ = this.pausedInteractions_.filter(i => i !== interaction);\n\n        const rootGroup = this.map_.getLayerGroup();\n        if (rootGroup.getVisible()) {\n          this.hiddenRootGroup_ = rootGroup;\n          this.hiddenRootGroup_.setVisible(false);\n        }\n\n        this.map_.getOverlayContainer().classList.add('olcs-hideoverlay');\n      }\n\n      this.camera_.readFromView();\n      this.render_();\n    } else {\n      if (this.isOverMap_) {\n        interactions = this.map_.getInteractions();\n        this.pausedInteractions_.forEach((interaction) => {\n          interactions.push(interaction);\n        });\n        this.pausedInteractions_.length = 0;\n\n        this.map_.addInteraction = interaction => this.map_.getInteractions().push(interaction);\n        this.map_.removeInteraction = interaction => this.map_.getInteractions().remove(interaction);\n\n        this.map_.getOverlayContainer().classList.remove('olcs-hideoverlay');\n        if (this.hiddenRootGroup_) {\n          this.hiddenRootGroup_.setVisible(true);\n          this.hiddenRootGroup_ = null;\n        }\n      }\n\n      this.camera_.updateView();\n    }\n  }\n\n  /**\n   * Preload Cesium so that it is ready when transitioning from 2D to 3D.\n   * @param {number} height Target height of the camera\n   * @param {number} timeout Milliseconds after which the warming will stop\n   * @api\n  */\n  warmUp(height, timeout) {\n    if (this.enabled_) {\n      // already enabled\n      return;\n    }\n    this.throwOnUnitializedMap_();\n    this.camera_.readFromView();\n    const ellipsoid = this.globe_.ellipsoid;\n    const csCamera = this.scene_.camera;\n    const position = ellipsoid.cartesianToCartographic(csCamera.position);\n    if (position.height < height) {\n      position.height = height;\n      csCamera.position = ellipsoid.cartographicToCartesian(position);\n    }\n\n    this.warmingUp_ = true;\n    this.render_();\n\n    setTimeout(() => {\n      this.warmingUp_ = false;\n    }, timeout);\n  }\n\n  /**\n   * Block Cesium rendering to save resources.\n   * @param {boolean} block True to block.\n   * @api\n  */\n  setBlockCesiumRendering(block) {\n    if (this.blockCesiumRendering_ !== block) {\n      this.blockCesiumRendering_ = block;\n\n      // reset the render loop\n      this.render_();\n    }\n  }\n\n  /**\n   * Render the globe only when necessary in order to save resources.\n   * Experimental.\n   * @api\n   */\n  enableAutoRenderLoop() {\n    if (!this.autoRenderLoop_) {\n      this.autoRenderLoop_ = new olcsAutoRenderLoop(this);\n    }\n  }\n\n  /**\n   * Get the autorender loop.\n   * @return {?olcs.AutoRenderLoop}\n   * @api\n  */\n  getAutoRenderLoop() {\n    return this.autoRenderLoop_;\n  }\n\n  /**\n   * The 3D Cesium globe is rendered in a canvas with two different dimensions:\n   * clientWidth and clientHeight which are the dimension on the screen and\n   * width and height which are the dimensions of the drawing buffer.\n   *\n   * By using a resolution scale lower than 1.0, it is possible to render the\n   * globe in a buffer smaller than the canvas client dimensions and improve\n   * performance, at the cost of quality.\n   *\n   * Pixel ratio should also be taken into account; by default, a device with\n   * pixel ratio of 2.0 will have a buffer surface 4 times bigger than the client\n   * surface.\n   *\n   * @param {number} value\n   * @this {olcs.OLCesium}\n   * @api\n   */\n  setResolutionScale(value) {\n    value = Math.max(0, value);\n    if (value !== this.resolutionScale_) {\n      this.resolutionScale_ = Math.max(0, value);\n      this.resolutionScaleChanged_ = true;\n      if (this.autoRenderLoop_) {\n        this.autoRenderLoop_.restartRenderLoop();\n      }\n    }\n  }\n\n  /**\n   * Set the target frame rate for the renderer. Set to `Number.POSITIVE_INFINITY`\n   * to render as quickly as possible.\n   * @param {number} value The frame rate, in frames per second.\n   * @api\n   */\n  setTargetFrameRate(value) {\n    if (this.targetFrameRate_ !== value) {\n      this.targetFrameRate_ = value;\n\n      // reset the render loop\n      this.render_();\n    }\n  }\n\n  /**\n   * Check if OpenLayers map is not properly initialized.\n   * @private\n   */\n  throwOnUnitializedMap_() {\n    const map = this.map_;\n    const view = map.getView();\n    const center = view.getCenter();\n    if (!view.isDef() || isNaN(center[0]) || isNaN(center[1])) {\n      throw new Error(`The OpenLayers map is not properly initialized: ${center} / ${view.getResolution()}`);\n    }\n  }\n\n  /**\n   * @type {ol.Feature}\n   */\n  get trackedFeature() {\n    return this.trackedFeature_;\n  }\n\n  /**\n   * @param {ol.Feature} feature\n   */\n  set trackedFeature(feature) {\n    if (this.trackedFeature_ !== feature) {\n\n      const scene = this.scene_;\n\n      //Stop tracking\n      if (!feature || !feature.getGeometry()) {\n        this.needTrackedEntityUpdate_ = false;\n        scene.screenSpaceCameraController.enableTilt = true;\n\n        if (this.trackedEntity_) {\n          this.dataSourceDisplay_.defaultDataSource.entities.remove(this.trackedEntity_);\n        }\n        this.trackedEntity_ = null;\n        this.trackedFeature_ = null;\n        this.entityView_ = null;\n        scene.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);\n        return;\n      }\n\n      this.trackedFeature_ = feature;\n\n      //We can't start tracking immediately, so we set a flag and start tracking\n      //when the bounding sphere is ready (most likely next frame).\n      this.needTrackedEntityUpdate_ = true;\n\n      const to4326Transform = this.to4326Transform_;\n      const toCesiumPosition = function() {\n        const geometry = feature.getGeometry();\n        console.assert(geometry instanceof olGeomPoint);\n        const coo = geometry.getCoordinates();\n        const coo4326 = to4326Transform(coo, undefined, coo.length);\n        return olcsCore.ol4326CoordinateToCesiumCartesian(coo4326);\n      };\n\n      // Create an invisible point entity for tracking.\n      // It is independant from the primitive/geometry created by the vector synchronizer.\n      const options = {\n        'position': new Cesium.CallbackProperty((time, result) => toCesiumPosition(), false),\n        'point': {\n          'pixelSize': 1,\n          'color': Cesium.Color.TRANSPARENT\n        }\n      };\n\n      this.trackedEntity_ = this.dataSourceDisplay_.defaultDataSource.entities.add(options);\n    }\n  }\n}\n\nexport default OLCesium;\n","export default \"__VITE_ASSET__e22a173a__\"","<script>\r\nimport { useSlots, onBeforeMount, onMounted, onBeforeUnmount, ref, reactive, computed, watch, nextTick, defineAsyncComponent, useCssModule, inject, getCurrentInstance } from 'vue'\r\nimport $ from 'jquery'\r\nimport { useStore } from 'vuex'\r\n\r\nimport { Map, View, Feature } from 'ol'\r\nimport XYZ from 'ol/source/XYZ'\r\nimport { Tile, Tile as TileLayer, Image as ImageLayer, Vector, Vector as VectorLayer } from 'ol/layer.js'\r\nimport WMTS from 'ol/source/WMTS'\r\nimport TilegridWMTS from 'ol/tilegrid/WMTS'\r\nimport WMTSTileGrid from 'ol/tilegrid/WMTS.js'\r\nimport { get as getProjection } from 'ol/proj.js'\r\nimport { getTopLeft, getWidth } from 'ol/extent.js'\r\nimport Select from 'ol/interaction/Select'\r\nimport { click } from 'ol/events/condition'\r\nimport { ScaleLine } from 'ol/control.js'\r\nimport VectorSource from 'ol/source/Vector.js'\r\nimport { Point } from 'ol/geom.js'\r\nimport { Icon, Style } from 'ol/style.js'\r\n\r\nimport OLCesium from 'olcs/OLCesium.js'\r\nimport Static from 'ol/source/ImageStatic.js'\r\n\r\nimport 'ol/ol.css'\r\nimport 'ol-ext/dist/ol-ext.css'\r\nimport Overlay from 'ol/Overlay.js'\r\nimport currentPositionImg from '@/assets/img/icon/currentPosition.svg'\r\n\r\nimport mapLayerList from '@/config/mapLayerList'\r\nimport baseMapList, { getBaseMapAll } from '@/config/baseMapList'\r\n\r\nexport default {\r\n    props: {},\r\n    setup(props, { emit }) {\r\n        const getMapLayers = mapLayerList\r\n        const baseMaps = baseMapList\r\n        const store = useStore()\r\n        const state = reactive({\r\n            // defaultCenter: [120.971859, 24.801583],\r\n            // defaultCenterZoom: 14,\r\n            defaultCenter: [121.326776, 24.655499],\r\n            defaultCenterZoom: 14,\r\n            targetNum: 1,\r\n            conditionWrap: false,\r\n            layerSelect: false,\r\n            currentLayers: [],\r\n            layers: [],\r\n            mapLayers: computed(() => {\r\n                const result = state.layers.map((node, index) => {\r\n                    return {\r\n                        label: node.group_title,\r\n                        value: node.value,\r\n                        layers: node.group_layers,\r\n                        groupClass: node.group_class\r\n                    }\r\n                })\r\n                return result\r\n            }),\r\n            selectLock: false,\r\n            mapCount: 1,\r\n            map1: null,\r\n            map2: null,\r\n            map1LayerStatus: [],\r\n            map2LayerStatus: [],\r\n            temp: {\r\n                map1BaseStatus: 0,\r\n                map2BaseStatus: 0,\r\n            },\r\n            deleteLightbox: false,\r\n            // 目前地圖狀態為2D or 3D\r\n            dimensionMap: {\r\n                map1: '2D',\r\n                map2: '2D'\r\n            },\r\n            toSearchDimensionStatus: computed(() => {\r\n                let target = state.targetNum == 1 ? 'map1' : 'map2'\r\n                return state.dimensionMap[target] === '2D'\r\n            }),\r\n            ol3d: null,\r\n            selectValueTemp: 0,\r\n            popup: {\r\n                nodeRef: null,\r\n                overlay: null,\r\n                popupId: 0,\r\n                coordinate: [],\r\n                popupData: '',\r\n            },\r\n            comSize: {\r\n                wrapHeight: '',\r\n                wrapWidth: '',\r\n            },\r\n            tribeQuery: {},\r\n        })\r\n\r\n        let ol3d = null\r\n\r\n        const defaultView = new View({\r\n            projection: 'EPSG:4326',\r\n            center: state.defaultCenter,\r\n            zoom: state.defaultCenterZoom,\r\n            minZoom: 8,\r\n            maxZoom: 16\r\n        })\r\n\r\n        // 初始化地圖\r\n        function initMap() {\r\n            state.map1 = new Map({\r\n                target: 'map1',\r\n                layers: [\r\n                    baseMapList.getBaseMapData(0)\r\n                ],\r\n                view: defaultView,\r\n                controls: [],\r\n            })\r\n\r\n            state.map1.addControl(new ScaleLine({\r\n                units: 'metric', // 比例尺單位\r\n            }));\r\n        }\r\n\r\n        function addPoint(targetLng, targetLat) {\r\n            const marker = new Vector({\r\n                source: new VectorSource({\r\n                    features: [\r\n                        new Feature({\r\n                            geometry: new Point([targetLng, targetLat]),\r\n                            population: 4000,\r\n                            rainfall: 500,\r\n                        })\r\n                    ]\r\n                }),\r\n                style: new Style({\r\n                    image: new Icon({\r\n                        anchor: [0.5, 100],\r\n                        anchorXUnits: 'fraction',\r\n                        anchorYUnits: 'pixels',\r\n                        src: currentPositionImg,\r\n                    }),\r\n                })\r\n            })\r\n\r\n            let target = state.targetNum == 1 ? 'map1' : 'map2'\r\n            state[target].addLayer(marker)\r\n        }\r\n\r\n        function mapControl({ action, value }) {\r\n            let mainMap = state.map1?.getTarget() == null ? 'map2' : 'map1'\r\n            let View = state[mainMap].getView()\r\n            switch (action) {\r\n                case 'In':\r\n                    View.animate({\r\n                        zoom: View.getZoom() + 1,\r\n                    })\r\n                    break;\r\n                case 'Out':\r\n                    View.animate({\r\n                        zoom: View.getZoom() - 1,\r\n                    })\r\n                    break;\r\n                case 'toNorth':\r\n                    View.animate({\r\n                        rotation: 0,\r\n                    })\r\n                    break;\r\n                case 'moveTo':\r\n                    if (value) {\r\n                        const { xAxis, yAxis } = value\r\n                        View.animate({\r\n                            center: [xAxis, yAxis],\r\n                            zoom: 17,\r\n                            duration: 100,\r\n                        });\r\n                    } else {\r\n                        navigator.geolocation.getCurrentPosition(function (pos) {\r\n                            View.animate({\r\n                                center: [pos.coords.longitude, pos.coords.latitude],\r\n                                zoom: 17,\r\n                                duration: 100,\r\n                            });\r\n                            addPoint(pos.coords.longitude, pos.coords.latitude)\r\n                        })\r\n                    }\r\n                    break;\r\n                case 'fullScreen':\r\n                    let target = document.getElementById(`map${state.targetNum}`)\r\n                    if (target.requestFullscreen) {\r\n                        target.requestFullscreen()\r\n                    } else if (target.msRequestFullscreen) {\r\n                        target.msRequestFullscreen()\r\n                    } else if (target.mozRequestFullScreen) {\r\n                        target.mozRequestFullScreen()\r\n                    } else if (target.webkitRequestFullscreen) {\r\n                        target.webkitRequestFullscreen()\r\n                    }\r\n                    break;\r\n            }\r\n        }\r\n        function layerControl({ action, value }) {\r\n            let target = state.targetNum == 1 ? state.map1 : state.map2\r\n            let targetLayers = target?.getLayers()\r\n            switch (action) {\r\n                case 'layerMode':\r\n                    if (value.checked) {\r\n                        let nestedSubNodeIndex = value.nestedSubNodeIndex\r\n                        // 點選父層後，自動帶入子層群組\r\n                        let isSingleTiles = state.layers[value.nodeIndex].group_layers[value.subNodeIndex].single_tiles\r\n                        let haveInfoBox = state.layers[value.nodeIndex].group_layers[value.subNodeIndex].info_box !== null\r\n                        if (!(isSingleTiles) || haveInfoBox) {\r\n                            let layersAry = targetLayers.getArray()\r\n\r\n                            layersAry.forEach(element => {\r\n                                if (!(element.get('id'))) { return }\r\n                                if (element.get('id').includes(`node${value.nodeIndex}_subNode${value.subNodeIndex}_nestedSubNode`)) {\r\n                                    target.removeLayer(element)\r\n                                }\r\n                            })\r\n                            nestedSubNodeIndex = state.selectValueTemp\r\n                            value.id = getMapLayers.resetLayerId(value.id, 'nestedSubNode', state.selectValueTemp)\r\n                        }\r\n                        let targetLayer = getMapLayers.getLayer(state.layers[value.nodeIndex].group_layers[value.subNodeIndex], nestedSubNodeIndex, value.id)\r\n\r\n                        target.addLayer(targetLayer)\r\n                        if (['雷達回波預測', '累積雨量預測', '氣溫預測'].includes(targetLayer.get('label'))) {\r\n                            const { currentLayerKey, tilesImageUrls, imageExtent } = targetLayer.get('ext')\r\n                            const timeKey = value.id.split('_nestedSubNode')[0]\r\n                            if (state.temp?.[`${timeKey}count`] === undefined) {\r\n                                state.temp[`${timeKey}count`] = currentLayerKey\r\n                            }\r\n                            state.temp[timeKey] = setInterval(function () {\r\n                                state.temp[`${timeKey}count`] = state.temp[`${timeKey}count`] + 1 > 4 ? 0 : state.temp[`${timeKey}count`] + 1\r\n                                let newSource = new Static({\r\n                                    url: tilesImageUrls[state.temp[`${timeKey}count`]],\r\n                                    projection: 'EPSG:4326',\r\n                                    imageExtent: imageExtent,\r\n                                    interpolate: true,\r\n                                })\r\n                                targetLayer.setSource(newSource)\r\n                            }, 1000)\r\n                        }\r\n                        if (['新竹縣原住民部落範圍', '近年歷史災害82處部落點位', '雨量站', '工程鑽探', '土石流潛勢溪流', '落石分布'].includes(targetLayer.get('label'))) {\r\n                            mapClickEvent(target, targetLayer.label)\r\n                            addSelectElement(value, targetLayer.get('label'))\r\n                        }\r\n                        onMapLayerStatus('add', target.getTarget(), value.id)\r\n                    } else {\r\n                        let layersAry = targetLayers.getArray()\r\n                        function removeLayersById(id) {\r\n                            const deleteKey = value.id.split('_nestedSubNode')[0]\r\n                            const toRemoveLayerId = layersAry.filter(element => element?.get('id')?.includes(deleteKey))\r\n                            toRemoveLayerId.forEach((node) => {\r\n                                target.removeLayer(node);\r\n                            });\r\n                        }\r\n                        removeLayersById()\r\n                        if (state.layers[value.nodeIndex].group_layers[value.subNodeIndex].layer_type === \"WFS\") {\r\n                            // FIXME: popup 修改\r\n                            // TODO: 結構優化\r\n                            addSelectElement(value);\r\n                            state.popup.popupId = 0\r\n                            state.popup.popupData = '';\r\n                            if (state.popup.overlay) {\r\n                                target.removeOverlay(state.popup.overlay);\r\n                                state.popup.overlay = null;\r\n                            }\r\n                        }\r\n                        if (['雷達回波預測', '累積雨量預測', '氣溫預測'].includes(state.layers[value.nodeIndex].group_layers[value.subNodeIndex].title)) {\r\n                            const timeKey = value.id.split('_nestedSubNode')[0]\r\n                            clearInterval(state.temp[timeKey]);\r\n                            delete state.temp[`${timeKey}count`]\r\n                        }\r\n\r\n                        onMapLayerStatus('delete', target.getTarget(), value.id)\r\n                    }\r\n                    break;\r\n                case 'selectLayerMode':\r\n                    if (state.selectLock) { return }\r\n                    if (value.layerName === 'all') {\r\n                        let layersAry = targetLayers.getArray()\r\n                        let layersToRemove = layersAry.filter(node => !(node.get('id') === undefined))\r\n                        layersToRemove.forEach((node) => {\r\n                            layerControl({ action: 'layerMode', value: { checked: false, ...getMapLayers.getLayerIndex(node.get('id')) } })\r\n                        })\r\n                    } else {\r\n                        layerControl({ action: 'layerMode', value: { checked: false, ...getMapLayers.getLayerIndex(value.id) } })\r\n                    }\r\n                    break;\r\n                case 'changeOrder':\r\n                    if (state.selectLock) { return }\r\n                    let { nodeIndex, subNodeIndex, nestedSubNodeIndex } = getMapLayers.getLayerIndex(value.id)\r\n                    let nowTileLayer = getMapLayers.getLayer(state.layers[nodeIndex].group_layers[subNodeIndex], nestedSubNodeIndex, value.id)\r\n                    if (value.movement === 'up') {\r\n                        if (value.key + 1 == targetLayers.getArray().length) { return }\r\n                        let obj = {\r\n                            checked: false,\r\n                            nodeIndex: nodeIndex,\r\n                            subNodeIndex: subNodeIndex,\r\n                            nestedSubNodeIndex: nestedSubNodeIndex,\r\n                            id: value.id\r\n                        }\r\n                        layerControl({ action: 'layerMode', value: obj })\r\n                        targetLayers.insertAt(value.key + 1, nowTileLayer)\r\n                    }\r\n                    if (value.movement === 'down') {\r\n                        if (value.key - 1 == 0) { return }\r\n                        let obj = {\r\n                            checked: false,\r\n                            nodeIndex: nodeIndex,\r\n                            subNodeIndex: subNodeIndex,\r\n                            nestedSubNodeIndex: nestedSubNodeIndex,\r\n                            id: value.id\r\n                        }\r\n                        layerControl({ action: 'layerMode', value: obj })\r\n                        targetLayers.insertAt(value.key - 1, nowTileLayer)\r\n                    }\r\n                    break;\r\n                case 'changeLayerVisible':\r\n                    if (state.selectLock) { return }\r\n                    let visibleStatus = !(targetLayers.getArray()[value.key].getVisible())\r\n                    targetLayers.getArray()[value.key].setVisible(visibleStatus)\r\n                    break;\r\n                case 'baseMap':\r\n                    state.temp[`map${state.targetNum}BaseStatus`] = value.baseId\r\n                    let newTileLayer = new Tile({\r\n                        preload: Infinity,\r\n                        name: value.name,\r\n                        label: value.label,\r\n                        type: value.mapType,\r\n                        baseId: value.baseId,\r\n                        source: new XYZ({\r\n                            url: value.url\r\n                        }),\r\n                        crossOrigin: 'anonymous',\r\n                    })\r\n                    let layersAry = target?.getLayers().getArray()\r\n                    targetLayers.insertAt(0, newTileLayer)\r\n\r\n                    layersAry.forEach(element => {\r\n                        if (element.get('type') == 'base' && element.get('baseId') !== value.baseId) {\r\n                            target.removeLayer(element)\r\n                        }\r\n                        return true\r\n                    })\r\n                    break;\r\n                case 'changeDimensionMap':\r\n                    let ta = state.targetNum == 1 ? 'map1' : 'map2'\r\n                    state.dimensionMap[ta] = value\r\n                    if (value === '3D') {\r\n                        // 先移除82處部落，後面補回\r\n                        let layersArray = targetLayers.getArray()\r\n                        const layerToRemove = layersArray.find(element => element.get('label').includes('近年歷史災害82處部落點位'))\r\n                        if (layerToRemove) {\r\n                            state[`map${state.targetNum}`].removeLayer(layerToRemove);\r\n                        }\r\n                        ol3d = new OLCesium({\r\n                            map: target,\r\n                        })\r\n                        ol3d.setEnabled(true)\r\n                        Cesium.Ion.defaultAccessToken = import.meta.env.VITE_Ol3D_TOKEN\r\n                        let scene = ol3d.getCesiumScene({})\r\n                        scene.terrainProvider = Cesium.createWorldTerrain({})\r\n                        state[`${ta}LayerStatus`].push('3D')\r\n                    } else {\r\n                        ol3d.setEnabled(false)\r\n                        state[`${ta}LayerStatus`] = state[`${ta}LayerStatus`].filter(node => node !== '3D')\r\n                        state[`map${state.targetNum}LayerStatus`].forEach(node => {\r\n                            let { nodeIndex, subNodeIndex, nestedSubNodeIndex } = getMapLayers.getLayerIndex(node)\r\n                            let nowTileLayer = getMapLayers.getLayer(state.layers[nodeIndex].group_layers[subNodeIndex], nestedSubNodeIndex, value.id)\r\n                            if (nowTileLayer.get('label').includes('近年歷史災害82處部落點位')) {\r\n                                layerControl({\r\n                                    action: 'layerMode', value: {\r\n                                        checked: true,\r\n                                        nodeIndex: nodeIndex,\r\n                                        subNodeIndex: subNodeIndex,\r\n                                        nestedSubNodeIndex: nestedSubNodeIndex,\r\n                                        id: node\r\n                                    }\r\n                                })\r\n                            }\r\n                            return node\r\n                        })\r\n                    }\r\n                    break;\r\n                case 'setOpacity':\r\n                    targetLayers.getArray()[value.key].setOpacity(Number(value.value))\r\n                    break;\r\n            }\r\n            getCurrentMapData()\r\n        }\r\n\r\n        function changeMapCount(qty) {\r\n            if (state.mapCount === qty) { return }\r\n            let otherMap = state.targetNum !== 1 ? 'map1' : 'map2'\r\n            state.mapCount = qty\r\n            let otherLayers = state[`${otherMap}LayerStatus`].filter(node => node !== '3D')\r\n            let otherLayersData = otherLayers.map(item => mapLayerList.getLayerIndex(item))\r\n            if (qty === 2) {\r\n                state[otherMap] = new Map({\r\n                    target: otherMap,\r\n                    layers: [\r\n                        baseMapList.getBaseMapData(0),\r\n                        // TODO: check\r\n                        ...otherLayersData.map(node => getMapLayers.getLayer(state.layers[node.nodeIndex].group_layers[node.subNodeIndex], node.nestedSubNodeIndex, node.id))\r\n                    ],\r\n                    view: defaultView,\r\n                    controls: [],\r\n                })\r\n                if (state[`${otherMap}LayerStatus`]?.indexOf('3D') !== -1) {\r\n                    ol3d = new OLCesium({\r\n                        map: state[otherMap],\r\n                    })\r\n                    ol3d.setEnabled(true)\r\n                    Cesium.Ion.defaultAccessToken = import.meta.env.VITE_Ol3D_TOKEN\r\n                    let scene = ol3d.getCesiumScene({})\r\n                    scene.terrainProvider = Cesium.createWorldTerrain({})\r\n                }\r\n            }\r\n            if (qty === 1) {\r\n                state[otherMap] = null\r\n                const element = document.getElementById(otherMap)\r\n                while (element.firstChild) {\r\n                    element.removeChild(element.firstChild)\r\n                }\r\n            }\r\n        }\r\n\r\n        function changeTarget(value) {\r\n            state.targetNum = value\r\n            let delToMap = state.targetNum !== 1 ? 'map1' : 'map2'\r\n            if (state.mapCount === 1) {\r\n                // 目標地圖為空\r\n                if (!state[`map${value}`]) {\r\n                    let otherLayers = state[`map${value}LayerStatus`].filter(node => node !== '3D')\r\n                    // TODO: 優化，把node0_subNode4_nestedSubNodeundefined移到最後面\r\n                    if (otherLayers.includes('node0_subNode4_nestedSubNodeundefined')) {\r\n                        let a = otherLayers.filter(node => node !== 'node0_subNode4_nestedSubNodeundefined')\r\n                        otherLayers = [...a, 'node0_subNode4_nestedSubNodeundefined']\r\n                    }\r\n\r\n                    let otherLayersData = otherLayers.map(item => mapLayerList.getLayerIndex(item))\r\n                    state[`map${value}`] = new Map({\r\n                        target: `map${value}`,\r\n                        layers: [\r\n                            baseMapList.getBaseMapData(state.temp[`map${state.targetNum}BaseStatus`]),\r\n                            ...otherLayersData.map(node => {\r\n                                return getMapLayers.getLayer(state.layers[node.nodeIndex].group_layers[node.subNodeIndex], node.nestedSubNodeIndex, node.id)\r\n                            })\r\n                        ],\r\n                        view: defaultView,\r\n                        controls: [],\r\n                    })\r\n\r\n                    mapClickEvent(state[`map${value}`])\r\n                    if (state[`map${value}LayerStatus`]?.indexOf('3D') !== -1) {\r\n                        ol3d = new OLCesium({\r\n                            map: state[`map${value}`],\r\n                        })\r\n                        ol3d.setEnabled(true)\r\n                    }\r\n\r\n                }\r\n                // 非目標地圖的刪除\r\n                if (state[delToMap]) {\r\n                    state[delToMap] = null\r\n                    const element = document.getElementById(delToMap)\r\n                    while (element.firstChild) {\r\n                        element.removeChild(element.firstChild)\r\n                    }\r\n                }\r\n            }\r\n            nextTick(() => {\r\n                getCurrentMapData()\r\n            })\r\n        }\r\n\r\n        function getCurrentMapData() {\r\n            let target = state.targetNum == 1 ? state.map1 : state.map2\r\n            const layers = target?.getLayers()?.getArray()\r\n            state.currentLayers = layers?.map(layer => {\r\n                return {\r\n                    label: layer.get('label'),\r\n                    id: layer.get('id'),\r\n                    visible: layer.getVisible(),\r\n                }\r\n            })\r\n        }\r\n\r\n        function conditionWrap() {\r\n            state.conditionWrap = !state.conditionWrap\r\n        }\r\n\r\n        function onMapLayerStatus(action, target, id) {\r\n            if (action === 'add') {\r\n                state[`${target}LayerStatus`].push(id)\r\n            } else if (action === 'delete') {\r\n                let a = state[`${target}LayerStatus`].findIndex(node => node === id)\r\n                state[`${target}LayerStatus`].splice(a, 1)\r\n            } else {\r\n                console.log('error')\r\n            }\r\n        }\r\n\r\n        function mapClickEvent(target) {\r\n            let selector = new Select({\r\n                layers: target?.getLayers()?.getArray(),\r\n                condition: click,\r\n            })\r\n            target.addInteraction(selector)\r\n            selector.on('select', (event) => {\r\n                let selectedFeatures = event.selected[0]\r\n                if (selectedFeatures) {\r\n                    state.popup.overlay = new Overlay({\r\n                        element: state.popup.nodeRef,\r\n                        autoPan: true,\r\n                        autoPanAnimation: {\r\n                            duration: 250\r\n                        }\r\n                    })\r\n                    state.popup.overlay.setPosition(event.mapBrowserEvent.coordinate)\r\n                    target.addOverlay(state.popup.overlay)\r\n                    // TODO: 截圖結構修改\r\n                    // TODO: 優化結構，獲取state.popupId.overlay方式修正，考慮整包selectedFeatures放進去\r\n                    // selectedFeatures.getKeys().forEach(key => console.log(`${key} -> ${selectedFeatures.get(key)}`))\r\n\r\n                    let selectIds = (selectedFeatures.getId() ?? selectedFeatures.getGeometryName()).split('.')\r\n                    state.popup.popupData = selectIds[0]\r\n                    state.popup.coordinate = event.mapBrowserEvent.coordinate\r\n                    if (selectIds[0] === '新竹縣原住民部落範圍') {\r\n                        state.popup.popupId = selectedFeatures.get('編號')\r\n                        return\r\n                    }\r\n                    if (selectIds[0] === '近年歷史災害82處部落點位') {\r\n                        state.popup.popupId = selectIds[1]\r\n                        return\r\n                    }\r\n                    if (selectIds[0] === '雨量站') {\r\n                        state.popup.popupId = selectedFeatures.get('Name')\r\n                        return\r\n                    }\r\n                    if (selectIds[0] === '工程鑽探') {\r\n                        console.log('選到工程鑽探')\r\n                        state.popup.popupId = selectedFeatures.get('name').split('_')[0]\r\n                        // state.popup.temp = selectedFeatures\r\n                        return\r\n                    }\r\n                    if (selectIds[0] === '土石流潛勢溪流') {\r\n                        state.popup.popupId = selectedFeatures.get('ID')\r\n                        state.popup.temp = selectedFeatures\r\n                        return\r\n                    }\r\n                    if (selectIds[0] === '落石分布') {\r\n                        state.popup.popupId = selectedFeatures.get('DATA_ID')\r\n                        state.popup.temp = selectedFeatures\r\n                        return\r\n                    }\r\n                } else {\r\n                    target.removeOverlay(state.popup.overlay)\r\n                    state.popup.overlay = null\r\n                    state.popup = {\r\n                        nodeRef: null,\r\n                        overlay: null,\r\n                        popupId: 0,\r\n                        coordinate: [],\r\n                        popupData: '',\r\n                    }\r\n                }\r\n            })\r\n        }\r\n\r\n        function closeAreaData() {\r\n            let target = state.targetNum == 1 ? state.map1 : state.map2\r\n            target.removeOverlay(state.popup.overlay)\r\n            state.popup.overlay = null\r\n        }\r\n\r\n        // TODO: 優化 移除id判斷?\r\n        function addSelectElement(value, layerName) {\r\n            const { checked, id } = value\r\n            if (!checked) { state.selectLayerOption = {}; return }\r\n            if (layerName === '新竹縣原住民部落範圍') {\r\n                $.ajax({\r\n                    url: 'https://api.edtest.site/tribeQuery',\r\n                    method: 'GET',\r\n                    success: (res) => {\r\n                        state.tribeQuery = res\r\n                    },\r\n                    error: (res) => {\r\n                        console.log(res)\r\n                    }\r\n                })\r\n            }\r\n        }\r\n\r\n        function moveToMap(val) {\r\n            let obj = {\r\n                action: 'moveTo',\r\n                value: {\r\n                    xAxis: val.WGS84.lng,\r\n                    yAxis: val.WGS84.lat\r\n                }\r\n            }\r\n            mapControl(obj)\r\n        }\r\n\r\n        onMounted(async () => {\r\n            let getBaseData = $.ajax({\r\n                url: 'https://api.edtest.site/underLayers',\r\n                method: 'GET',\r\n            }).done(res => {\r\n                return res\r\n            })\r\n\r\n            let getLayerData = $.ajax({\r\n                url: 'https://api.edtest.site/layers',\r\n                method: 'GET',\r\n            }).done(res => {\r\n                return res\r\n            })\r\n\r\n            Promise.all([getBaseData, getLayerData]).then((value) => {\r\n                // TODO: 優化\r\n                let result = value[0].data.map((node, nodeIndex) => {\r\n                    return {\r\n                        mapType: 'base',\r\n                        baseId: nodeIndex,\r\n                        onCurrent: false,\r\n                        ...node\r\n                    }\r\n                })\r\n                baseMapList.setBaseMapData(result)\r\n                state.temp.map1BaseStatus = 0\r\n                state.temp.baseMapList = getBaseMapAll()\r\n\r\n                state.layers = value[1].map((node, index) => {\r\n                    node.group_layers.forEach((sub, subIndex) => {\r\n                        let subNodeIndex = subIndex, nestedSubNodeIndex = undefined\r\n                        sub.id = `node${index}_subNode${subNodeIndex}_nestedSubNode${nestedSubNodeIndex}`\r\n\r\n                        if (!(sub.single_tiles)) {\r\n                            sub.tiles_list.forEach((nestedSub, nestedSubIndex) => {\r\n                                nestedSubNodeIndex = nestedSubIndex\r\n                                nestedSub.id = `node${index}_subNode${subNodeIndex}_nestedSubNode${nestedSubNodeIndex}`\r\n                            })\r\n                        }\r\n                    })\r\n                    return {\r\n                        ...node,\r\n                        value: index,\r\n                    }\r\n                })\r\n\r\n                nextTick(() => {\r\n                    initMap()\r\n                    getCurrentMapData()\r\n                })\r\n            })\r\n            state.comSize.wrapHeight = window.innerHeight\r\n            state.comSize.wrapWidth = window.innerWidth\r\n            store.dispatch('updateWindowWidth', window.innerWidth)\r\n            window.onresize = (e) => {\r\n                state.comSize.wrapHeight = e.target.innerHeight\r\n                state.comSize.wrapWidth = e.target.innerWidth\r\n                store.dispatch('updateWindowWidth', window.innerWidth)\r\n            }\r\n        })\r\n\r\n        function show() {\r\n            console.log(state.map1.getLayers().getArray())\r\n        }\r\n\r\n        return {\r\n            state,\r\n            props,\r\n            store,\r\n            mapControl,\r\n            layerControl,\r\n            changeTarget,\r\n            conditionWrap,\r\n            closeAreaData,\r\n            moveToMap,\r\n            changeMapCount,\r\n            show\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<template>\r\n    <div>\r\n        <!-- TODO: 寬度設定是否調整 -->\r\n        <div class=\"w-100 d-flex justify-content-between flex-sm-row flex-wrap flex-sm-nowrap mapWrap\" id=\"mapWrap\">\r\n            <div id=\"map1\" :class=\"{\r\n                'w-100': state.map1?.getTarget() == 'map1',\r\n                'h-100': state.mapCount === 1,\r\n                'h-50': state.mapCount === 2 && (state.comSize.wrapWidth < 600),\r\n                'middleMap': state.map1?.getTarget()\r\n            }\">\r\n            </div>\r\n            <div class=\"middleLine\" v-if=\"state.mapCount === 2\"></div>\r\n            <div id=\"map2\" :class=\"{\r\n                'w-100': state.map2?.getTarget() == 'map2',\r\n                'h-100': state.mapCount === 1,\r\n                'h-50': state.mapCount === 2 && (state.comSize.wrapWidth < 600),\r\n                'middleMap': state.map2?.getTarget()\r\n            }\">\r\n            </div>\r\n        </div>\r\n        <asideTool class=\"asideTool position-absolute top-50 translate-middle-y\" id=\"asideTool\"\r\n        :onChangeTarget=\"(value) => {\r\n            changeTarget(value)\r\n        }\"\r\n        @onMapControl=\"({ action, value }) => {\r\n            mapControl({ action, value })\r\n        }\" />\r\n\r\n        <div class=\"SearchBar d-block d-sm-block position-fixed w-100 w-sm-auto position-sm-absolute p-3 p-sm-0\">\r\n            <div class=\"d-flex align-items-center justify-content-between justify-content-sm-start\">\r\n                <img src=\"@/assets/logo.svg\" alt=\"\" class=\"logo col-5 col-sm-auto me-0 me-sm-5\">\r\n                <mapSourceOption class=\"mapSourceOption col-5 col-sm-auto d-block d-sm-block\"\r\n                    :baseMapList=\"state.temp.baseMapList\" :onChangeBaseMaps=\"({ action, value }) => {\r\n                        layerControl({ action, value })\r\n                    }\" />\r\n            </div>\r\n            <SearchBar class=\"mt-4 d-none d-sm-block\"\r\n            v-bind=\"{\r\n                dimensionMapStatus: state.toSearchDimensionStatus,\r\n                currentLayers: state.currentLayers,\r\n                mapCount: state.mapCount,\r\n                onChangeBaseMaps: ({ action, value }) => {\r\n                    layerControl({ action, value })\r\n                },\r\n                onChangeMapCount: (qty) => {\r\n                    changeMapCount(qty)\r\n                },\r\n            }\"\r\n            :onChangeTarget=\"(value) => {\r\n                changeTarget(value)\r\n            }\" @onLayerControl=\"({ action, value }) => {\r\n                layerControl({ action, value })\r\n            }\" @conditionWrap=\"(value) => {\r\n                conditionWrap(value)\r\n            }\" />\r\n        </div>\r\n\r\n        <div class=\"conditionCom d-none d-sm-block position-absolute\">\r\n            <div class=\"mb-4\">\r\n                <button class=\"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5\"\r\n                    v-if=\"!state.conditionWrap\" @click=\"state.conditionWrap = true\">\r\n                    圖層選項\r\n                </button>\r\n                <div class=\"mb-4\" v-if=\"state.conditionWrap\">\r\n                    <Condition v-bind=\"{\r\n                        tribeQuery: state.tribeQuery,\r\n                        mapLayers: state.mapLayers,\r\n                        currentLayers: state.currentLayers,\r\n                        onClose: () => {\r\n                            state.conditionWrap = false\r\n                        },\r\n                        showSelectLayerValue: (val) => {\r\n                            state.selectValueTemp = val\r\n                        },\r\n                        moveToMap: (val) => {\r\n                            moveToMap(val)\r\n                        }\r\n                    }\" @onLayerControl=\"({ action, value }) => { layerControl({ action, value }) }\" />\r\n                </div>\r\n                <OverLayer :text=\"'可選擇要加入的圖層'\" :styles=\"'right: 105%;top: 0;text-align: right;'\" />\r\n            </div>\r\n\r\n            <div>\r\n                <button class=\"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5\"\r\n                    v-if=\"!state.layerSelect\" @click=\"state.layerSelect = true\">\r\n                    已選擇的圖層\r\n                </button>\r\n                <div v-if=\"state.layerSelect\">\r\n                    <LayerSelector v-bind=\"{\r\n                        selectLock: state.selectLock,\r\n                        currentLayers: state.currentLayers,\r\n                        onClose: () => {\r\n                            state.layerSelect = false\r\n                        },\r\n                        onLockLayer: () => {\r\n                            state.selectLock = !state.selectLock\r\n                        },\r\n                        onDeleteLayer: ({ action, value }) => {\r\n                            if (value.layerName == 'all') {\r\n                                state.deleteLightbox = true\r\n                            } else {\r\n                                layerControl({ action, value })\r\n                            }\r\n                        },\r\n                        onDeleteLayerAll: () => {\r\n                            state.deleteLightbox = true\r\n                        },\r\n                        onLayerControl: ({ action, value }) => {\r\n                            layerControl({ action, value })\r\n                        },\r\n                    }\" />\r\n                </div>\r\n                <OverLayer :text=\"'顯示已經選擇的圖層'\" :styles=\"'right: 105%;top: 0;text-align: right;'\" />\r\n            </div>\r\n        </div>\r\n\r\n        <div class=\"m-Navbar d-flex d-sm-none position-relative w-100\">\r\n            <div class=\"position-absolute bottom-100 w-100\" style=\"max-height: 70vh;overflow-y: scroll;\">\r\n                <Condition class=\"w-100\" v-if=\"state.conditionWrap\" v-bind=\"{\r\n                    mapLayers: state.mapLayers,\r\n                    currentLayers: state.currentLayers,\r\n                    onClose: () => {\r\n                        state.conditionWrap = false\r\n                    },\r\n                    showSelectLayerValue: (val) => {\r\n                        state.selectValueTemp = val\r\n                    }\r\n                }\" @onLayerControl=\"({ action, value }) => { layerControl({ action, value }) }\" />\r\n            </div>\r\n            <div v-if=\"state.layerSelect\">\r\n                <LayerSelector class=\"position-absolute bottom-100 w-100\" v-bind=\"{\r\n                    selectLock: state.selectLock,\r\n                    currentLayers: state.currentLayers,\r\n                    onClose: () => {\r\n                        state.layerSelect = false\r\n                    },\r\n                    onLockLayer: () => {\r\n                        state.selectLock = !state.selectLock\r\n                    },\r\n                    onDeleteLayer: ({ action, value }) => {\r\n                        if (value.layerName == 'all') {\r\n                            state.deleteLightbox = true\r\n                        } else {\r\n                            layerControl({ action, value })\r\n                        }\r\n                    },\r\n                    onDeleteLayerAll: () => {\r\n                        state.deleteLightbox = true\r\n                    },\r\n                    onChangLayerVisible: (action) => {\r\n                        layerControl(action)\r\n                    },\r\n                    onChangeOrderLayer: ({ action, value }) => {\r\n                        layerControl({ action, value })\r\n                    },\r\n                    onLayerControl: ({ action, value }) => {\r\n                        layerControl({ action, value })\r\n                    },\r\n                }\" />\r\n            </div>\r\n            <mNavbar v-bind=\"{\r\n                dimensionMapStatus: state.toSearchDimensionStatus,\r\n                currentLayers: state.currentLayers,\r\n                mapCount: state.mapCount,\r\n                openConditionWrap: () => {\r\n                    state.conditionWrap = !state.conditionWrap\r\n                    state.layerSelect = false\r\n                },\r\n                openLayerSelect: () => {\r\n                    state.layerSelect = !state.layerSelect\r\n                    state.conditionWrap = false\r\n                },\r\n                onLayerControl: ({ action, value }) => {\r\n                    layerControl({ action, value })\r\n                },\r\n                onChangeMapCount: (qty) => {\r\n                    changeMapCount(qty)\r\n                },\r\n                onChangeTarget: (value) => {\r\n                    changeTarget(value)\r\n                }\r\n            }\"\r\n            @conditionWrap=\"(value) => { conditionWrap(value) }\" />\r\n        </div>\r\n\r\n        <div class=\"lightWrap w-100 h-100 d-flex justify-content-center align-items-center\" v-if=\"state.deleteLightbox\">\r\n            <div class=\"p-4 rounded bg-white\" style=\"width: 250px;\">\r\n                <p class=\"text-center fw-bold\">是否要取消全部圖層</p>\r\n                <div class=\" d-flex justify-content-around\">\r\n                    <button class=\"rounded px-3 py-1 bg-steel text-white border-0\" @click=\"() => {\r\n                        layerControl({\r\n                            action: 'selectLayerMode',\r\n                            value: {\r\n                                layerName: 'all'\r\n                            }\r\n                        })\r\n                        state.deleteLightbox = false\r\n                    }\">確定</button>\r\n                    <button class=\"rounded px-3 py-1 bg-secondary bg-gradient text-white border-0\" @click=\"() => {\r\n                        state.deleteLightbox = false\r\n                    }\">取消</button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <div id=\"popup\" class=\"popup position-absolute bottom-0\" :ref=\"(e) => {\r\n            state.popup.nodeRef = e\r\n        }\">\r\n            <areaData class=\"areaData\" v-if=\"state.popup.popupId !== 0\" :closeAreaData=\"() => {\r\n                closeAreaData()\r\n            }\" :popup=\"state.popup\" :maxHeight=\"500\" />\r\n        </div>\r\n\r\n        <div class=\"stepOverLayer position-absolute top-0 start-0 w-100 h-100 bg-black opacity-50\" id=\"firstEnter\"\r\n        v-if=\"store.state.isInit\"\r\n        @click=\"() => {\r\n            store.dispatch('updateLayerStatus', false)\r\n        }\"></div>\r\n    </div>\r\n</template>\r\n\r\n<style lang=\"sass\">\r\n@import '@/assets/styles/all.module.scss'\r\n.mapWrap\r\n    height: 100vh\r\n.asideTool\r\n    z-index: 220\r\n    left: 20px\r\n.SearchBar\r\n    top: 20px\r\n    left: 20px\r\n    z-index: 220\r\n.conditionCom\r\n    width: 480px\r\n    right: 1%\r\n    bottom: 5%\r\n.middleLine\r\n    width: 5px\r\n    background: $blue-steel\r\n.popup\r\n    z-index: 9999\r\n.areaData\r\n    width: 450px\r\n    max-height: 550px\r\n    background: #fff\r\n    box-sizing: border-box\r\n    border-radius: 10px\r\n    border: 1px solid #088\r\n.middleMap\r\n    position: relative\r\n    &::after\r\n        content: ''\r\n        position: absolute\r\n        display: block\r\n        border: 2px solid #000\r\n        width: 40px\r\n        height: 40px\r\n        top: calc((100% - 40px)/2)\r\n        left: calc((100% - 40px)/2)\r\n@media (max-width: 600px)\r\n    .mapWrap\r\n        // height: 92vh\r\n        height: 92%\r\n    .m-Navbar\r\n        z-index: 222\r\n        // height: 8vh\r\n        height: 8%\r\n    .SearchBar\r\n        top: 0\r\n        left: 0\r\n        .logo\r\n            width: 180px\r\n    .asideTool\r\n        left: 5px\r\n    .middleLine\r\n        height: 1px\r\n        width: 100%\r\n    .areaData\r\n        width: 85vw\r\n</style>\r\n"],"names":["Feature","BaseObject","geometryOrProperties","geometry","properties","clone","style","unlistenByKey","listen","EventType","createStyleFunction","id","name","obj","styles","assert","Feature$1","Fill","options","color","Fill$1","interpolatePoint","flatCoordinates","offset","end","stride","fraction","dest","dimension","o","t","n","x1","y1","length","cumulativeLengths","i","x2","y2","target","index","binarySearch","lerp","lineStringCoordinateAtM","m","extrapolate","coordinate","lo","hi","mid","m0","m1","lineStringsCoordinateAtM","ends","interpolate","ii","lineStringLength","LineString","SimpleGeometry","coordinates","layout","extend","lineString","x","y","closestPoint","minSquaredDistance","closestSquaredDistanceXY","maxSquaredDelta","assignClosestPoint","callback","forEachSegment","inflateCoordinates","squaredTolerance","simplifiedFlatCoordinates","douglasPeucker","extent","intersectsLineString","deflateCoordinates","LineString$1","Stroke","lineCap","lineDash","lineDashOffset","lineJoin","miterLimit","width","Stroke$1","ImageStyle","toSize","scale","abstract","pixelRatio","displacement","opacity","rotateWithView","rotation","listener","ImageStyle$1","asColorLike","toString","RegularShape","size","fill","image","renderOptions","context","createCanvasContext2D","ImageState","stroke","strokeWidth","r1","r2","tmp","points","alpha","a","b","d","e","miterRatio","k","l","bevelAdd","aa","bb","dd","innerMiterRatio","innerLength","defaultLineJoin","strokeStyle","defaultStrokeStyle","defaultLineWidth","defaultMiterLimit","add","maxRadius","defaultFillStyle","asArray","radius","radius2","startAngle","step","angle0","radiusC","RegularShape$1","CircleStyle","Circle","Style","defaultGeometryFunction","renderer","text","feature","zIndex","toFunction","styleFunction","defaultStyles","createDefaultStyle","resolution","createEditingStyle","white","blue","Style$1","DEFAULT_FILL_COLOR","Text","overflow","font","maxAngle","offsetX","offsetY","placement","textAlign","justify","textBaseline","padding","Text$1","quickselect","arr","left","right","compare","quickselectStep","defaultCompare","z","s","sd","newLeft","newRight","j","swap","RBush$2","maxEntries","bbox","node","result","intersects","toBBox","nodesToSearch","child","childBBox","contains","data","tmpNode","item","createNode","equalsFn","path","indexes","parent","goingUp","findItem","items","height","N","M","calcBBox","N2","N1","multiSelect","right2","right3","level","minArea","minEnlargement","targetNode","area","bboxArea","enlargement","enlargedArea","isNode","insertPath","splitIndex","newNode","minOverlap","bbox1","distBBox","bbox2","overlap","intersectionArea","compareMinX","compareNodeMinX","compareMinY","compareNodeMinY","xMargin","yMargin","leftBBox","rightBBox","margin","bboxMargin","siblings","p","destNode","minX","minY","maxX","maxY","children","stack","taintedTestContext","IconImage","EventTarget","src","crossOrigin","imageState","listenImage","canvas","ctx","asString","get","iconImage","iconImageCache","Icon","getUid","getIconImage","setScale","anchor","iconImageSize","widthScale","heightScale","Icon$1","toStyle","flatStyle","getFill","getStroke","getText","getImage","prefix","value","iconSrc","iconImg","shapePoints","circleRadius","Property","BaseVectorLayer","Layer","baseOptions","pixel","frameState","RBush","renderOrder","styleLike","len","toStyleFunction","BaseVectorLayer$1","Instruction","fillInstruction","strokeInstruction","beginPathInstruction","closePathInstruction","CanvasInstruction","VectorContext","hitDetectionRenderer","circleGeometry","geometryCollectionGeometry","lineStringGeometry","multiLineStringGeometry","multiPointGeometry","multiPolygonGeometry","pointGeometry","polygonGeometry","fillStyle","imageStyle","declutterImageWithText","textStyle","VectorContext$1","CanvasBuilder","tolerance","maxExtent","dashArray","dash","tmpCoord","myEnd","containsCoordinate","closed","skipFirst","lastXCoord","lastYCoord","nextCoord","skipped","lastRel","nextRel","coordinateRelationship","Relationship","builderEnds","builderEnd","type","builderBegin","builderEndss","endss","myEnds","inflateMultiCoordinatesArray","inflateCoordinatesArray","hitDetectionInstructions","instruction","begin","reverseSubArray","state","fillStyleColor","strokeStyleColor","strokeStyleLineCap","defaultLineCap","strokeStyleLineDash","defaultLineDash","strokeStyleLineDashOffset","defaultLineDashOffset","strokeStyleLineJoin","strokeStyleWidth","strokeStyleMiterLimit","createFill","applyStroke","lineWidth","equals","endGeometryInstruction","buffer","Builder","CanvasImageBuilder","myBegin","sharedData","origin","ImageBuilder","CanvasLineStringBuilder","moveToLineToInstruction","LineStringBuilder","CanvasPolygonBuilder","numEnds","circleInstruction","snap","PolygonBuilder","matchingChunk","chunkStart","chunkEnd","chunkM","start","acos","m12","m23","x12","y12","x23","y23","TEXT_ALIGN","CanvasTextBuilder","instructions","fillState","strokeState","textState","geometryType","flatOffset","flatEnd","oo","range","geometryWidths","interiorPoints","beg","w","keep","defaultPadding","p0","p1","p2","p3","strokeKey","textKey","defaultTextAlign","defaultTextBaseline","fillKey","baseline","textFillStyle","textStrokeStyle","defaultFont","registerFont","textScale","textOffsetX","textOffsetY","textRotateWithView","textRotation","BATCH_CONSTRUCTORS","TextBuilder","BuilderGroup","builderInstructions","zKey","builders","builderKey","builderInstruction","builderType","zIndexKey","replays","replay","Constructor","CanvasBuilderGroup","drawTextOnPath","startM","measureAndCacheTextWidth","cache","segmentLength","segmentM","advance","beginX","beginY","startOffset","startLength","endM","endX","endY","reverse","flat","rotate","PI","singleSegment","previousAngle","angle","delta","iStart","charLength","chars","tmpExtent","createEmpty","p4","getDeclutterBox","replayImageOrLabelArgs","rtlRegEx","horizontalTextAlign","align","createTextChunks","acc","line","Executor","overlaps","createTransform","key","textIsArray","chunks","widths","heights","lineWidths","getTextDimensions","renderWidth","contextInstructions","h","label","leftRight","strokeInstructions","fillInstructions","lineHeight","lineOffset","widthHeightIndex","lineWidthIndex","previousFont","fillStrokeArgs","sheetWidth","sheetHeight","centerX","centerY","anchorX","anchorY","originX","originY","snapToPixel","fillStroke","boxW","boxH","boxX","boxY","transform","composeTransform","applyTransform","createOrUpdate","contextScale","imageOrLabel","dimensions","box","strokePadding","drawImageOrLabel","repeatSize","featureCallback","hitExtent","declutterTree","pixelCoordinates","transform2D","transformSetFromArray","prevX","prevY","roundX","roundY","pendingFill","pendingStroke","lastFillInstruction","lastStrokeInstruction","coordinateCache","viewRotation","viewRotationFromTransform","batchSize","currentGeometry","dx","dy","r","fn","coords","declutterMode","labelWithAnchor","backgroundFill","backgroundStroke","widthIndex","args","imageArgs","imageDeclutterBox","measurePixelRatio","pixelRatioScale","cachedWidths","pathLength","textLength","parts","drawChars","c","cc","part","Executor$1","ORDER","ExecutorGroup","allInstructions","renderBuffer","flatClipCoords","executors","instructionByZindex","candidates","hitTolerance","declutteredFeatures","contextSize","newContext","extendCoordinate","getPixelIndexArray","imageData","idx","zs","ascending","executor","isEmpty","builderTypes","jj","circlePixelIndexArrayCache","maxDistanceSq","distances","distanceSq","distance","pixelIndex","CanvasExecutorGroup","CanvasImmediateRenderer","userTransform","toFixed","localTransform","close","transformGeom2D","geometries","flatMidpoint","geometryExtent","flatMidpoints","flatInteriorPoint","flatInteriorPoints","contextFillState","contextStrokeState","contextTextState","imageSize","imagePixelRatio","imageAnchor","imageOrigin","imageScale","textFillStyleColor","textStrokeStyleColor","textStrokeStyleLineCap","textStrokeStyleLineDash","textStrokeStyleLineDashOffset","textStrokeStyleLineJoin","textStrokeStyleWidth","textStrokeStyleMiterLimit","textFont","textText","textTextAlign","textTextBaseline","CanvasImmediateRenderer$1","HIT_DETECT_RESOLUTION","createHitDetectionImageData","transforms","features","featureCount","indexFactor","featuresByZIndex","featureStyleFunction","originalStyle","imgSize","imgContext","img","byGeometryType","zIndexKeys","geomAndStyle","kk","hitDetect","resultFeatures","clamp","g","SIMPLIFY_TOLERANCE","GEOMETRY_RENDERERS","renderPointGeometry","renderLineStringGeometry","renderPolygonGeometry","renderMultiPointGeometry","renderMultiLineStringGeometry","renderMultiPolygonGeometry","renderGeometryCollectionGeometry","renderCircleGeometry","defaultOrder","feature1","feature2","getSquaredTolerance","getTolerance","builderGroup","declutterBuilderGroup","circleReplay","textReplay","renderFeature","replayGroup","loading","renderFeatureInternal","simplifiedGeometry","renderGeometry","geometryRenderer","lineStringReplay","polygonReplay","imageBuilderGroup","imageReplay","textBuilderGroup","CanvasVectorLayerRenderer","CanvasLayerRenderer","vectorLayer","executorGroup","viewState","center","projection","projectionExtent","vectorSource","viewHints","ViewHint","multiWorld","worldWidth","getWidth","endWorld","world","compositionContext","canvasPool","releaseCanvas","layerState","makeScale","makeInverse","canvasTransform","transformToString","declutterExecutorGroup","clipped","render","layerExtent","fromUserExtent","intersectsExtent","containsExtent","resolve","apply","layer","source","startX","matches","match","executorGroups","event","animating","interacting","updateWhileAnimating","updateWhileInteracting","frameStateExtent","vectorLayerRevision","vectorLayerRenderBuffer","vectorLayerRenderOrder","defaultRenderOrder","renderedExtent","loadExtents","gutter","wrapCoordinateX","loadExtent","wrapExtentX","getRenderTolerance","getSquaredRenderTolerance","ready","dirty","userExtent","toUserExtent","replayGroupInstructions","CanvasVectorLayerRenderer$1","VectorLayer","Vector","RBush_","extents","values","uid","rbush","RBush$1","VectorEventType","all","withCredentials","loadFeaturesXhr","url","format","success","failure","xhr","dataProjection","VOID","VectorSourceEvent","Event","VectorSource","Source","allStrategy","useSpatialIndex","collection","Collection","featureKey","ObjectEventType","valid","newFeatures","geometryFeatures","modifyingCollection","evt","CollectionEventType","fast","featureId","removeAndIgnoreReturn","clearEvent","wrapAndSliceX","anExtent","filter","closestFeature","TRUE","previousMinSquaredDistance","minDistance","sid","loadedExtentsRtree","extentsToLoad","extentToLoad","object","featureChangeKeys","removed","loader","VectorSource$1","toContext","DEVICE_PIXEL_RATIO","scaleTransform","Overlay","CLASS_SELECTABLE","removeChildren","element","removeNode","map","MapEventType","container","position","panIntoViewOptions","mapRect","overlayRect","outerWidth","outerHeight","myMargin","offsetLeft","offsetRight","offsetTop","offsetBottom","centerPx","newCenterPx","panOptions","positioning","visible","mapSize","posX","posY","Overlay$1","VectorRenderTile","Tile","tileCoord","urlTileCoord","getSourceTiles","VectorRenderTile$1","tileLoadFunction","TileState","VectorTile","Cluster","ratio","changed","mapDistance","clustered","createOrUpdateFromCoordinate","neighbors","neighbor","centroid","addCoordinate","scaleCoordinate","searchCenter","getCenter","Point","olSourceCluster","DECIMALS","GETFEATUREINFO_IMAGE_SIZE","ImageWMS","ImageSource","defaultImageLoadFunction","params","projectionObj","getProjection","sourceProjectionObj","calculateSourceResolution","getForViewAndSize","baseParams","DEFAULT_VERSION","floor","layers","mpu","pixelSize","appendParams","imageResolution","viewWidth","ceil","viewHeight","getHeight","viewExtent","requestWidth","requestHeight","requestExtent","round","ImageWrapper","dpi","axisOrientation","imageLoadFunction","version","compareVersions","olSourceImageWMS","UrlTile","extentFromProjection","tileGrid","createXYZ","defaultLoadFunction","TileCache","tileCache","fromKey","tile","sourceTiles","sourceTile","tileFeatures","candidate","usedTiles","usedSourceTiles","cacheKey","getCacheKeyForTileKey","bufferExtent","sourceTileGrid","sourceExtent","getIntersection","sourceZ","sourceTileCoord","tileUrl","sourceTileState","listenChange","sourceTileKey","coordKey","getKeyZXY","tileExtent","empty","newTile","code","resolutions","origins","tileSizes","DEFAULT_MAX_ZOOM","TileGrid","tileSize","tileCount","olSourceVectorTile","WMTSTileGrid","TilegridWMTS","WMTS","TileImage","requestEncoding","urls","expandUrl","createFromTileUrlFunctions","res","template","localContext","WMTS$1","FeatureFormat","FeatureFormat$1","transformGeometryWithOptions","write","featureProjection","transformed","equivalentProjection","power","MultiLineString","lineStrings","multiLineString","arrayMaxSquaredDelta","assignClosestArrayPoint","midpoints","midpoint","simplifiedEnds","douglasPeuckerArray","intersectsLineStringArray","deflateCoordinatesArray","MultiLineString$1","MultiPoint","point","multiPoint","squaredDistance","squaredDx","containsXY","MultiPoint$1","linearRingss","flatCenters","createOrUpdateFromFlatCoordinates","MultiPolygon","thisLayout","polygons","thisEndss","polygon","newEndss","multiPolygon","multiArrayMaxSquaredDelta","assignClosestMultiArrayPoint","linearRingssContainsXY","linearRingssArea","orientLinearRingsArray","linearRingssCenter","getInteriorPointsOfMultiArray","linearRingssAreOriented","simplifiedEndss","quantizeMultiArray","prevEnds","Polygon","intersectsLinearRingMultiArray","deflateMultiCoordinatesArray","lastEnds","MultiPolygon$1","ieee754","isLE","mLen","nBytes","eLen","eMax","eBias","nBits","rt","pbf","Pbf","require$$0","buf","SHIFT_LEFT_32","SHIFT_RIGHT_32","TEXT_DECODER_MIN_LENGTH","utf8TextDecoder","readField","val","tag","startPos","readUInt32","readInt32","isSigned","readVarintRemainder","num","pos","readUtf8TextDecoder","readUtf8","readPackedEnd","min","writeInt32","writeBigVarint","str","writeUtf8","makeRoomForExtraLength","writePackedVarint","writePackedSVarint","writePackedBoolean","writePackedFloat","writePackedDouble","writePackedFixed32","writePackedSFixed32","writePackedFixed64","writePackedSFixed64","toNum","low","high","writeBigVarintLow","writeBigVarintHigh","lsb","extraLen","b0","bytesPerSequence","b1","b2","b3","lead","GeometryCollection","Geometry","geometryCollection","createOrUpdateEmpty","cloneGeometries","geometriesArray","simplifiedGeometries","simplified","simplifiedGeometryCollection","sx","sy","transformFn","deltaX","deltaY","clonedGeometries","GeometryCollection$1","tmpTransform","RenderFeature","flatCenter","getInteriorPointOfArray","pixelExtent","projectedExtent","RenderFeature$1","MVT","Projection","cmd","coordsLen","currentEnd","cmdLen","rawFeature","getGeometryType","geom","inflateEnds","ctor","PBF","pbfLayers","layersPBFReader","pbfLayer","readRawFeature","layerPBFReader","featurePBFReader","MVT$1","IMAGE_REPLAYS","VECTOR_REPLAYS","CanvasVectorTileLayerRenderer","CanvasTileLayerRenderer","hifi","layerRevision","revision","builderState","declutter","layerUid","tt","sourceTileExtent","sharedExtent","builderExtent","bufferedExtent","executorGroupInstructions","replayExtent","renderingReplayGroup","boundingExtent","renderedTiles","found","declutterExecutorGroups","reject","wrapX","corner","getTopLeft","tilePixel","accumulator","hitDetectionImageData","tiles","worldOffset","multiply","renderMode","replayTypes","tileSource","clips","clipZs","group","currentZ","contextSaved","currentClip","clip","replayState","tileResolution","renderPixelRatio","renderScale","resetTransform","pixelScale","translateTransform","CanvasVectorTileLayerRenderer$1","VectorTileLayer","TileProperty","preload","useInterimTilesOnError","olLayerVectorTile","JSONFeature","getObject","JSONFeature$1","GeoJSON","geoJSONFeature","readGeometry","geoJSONObject","geoJSONFeatureCollection","geoJSONFeatures","crs","writeGeometry","objects","readPointGeometry","readLineStringGeometry","readPolygonGeometry","readMultiPointGeometry","readMultiLineStringGeometry","readMultiPolygonGeometry","readGeometryCollectionGeometry","geoJSON","writePointGeometry","writeLineStringGeometry","writePolygonGeometry","writeMultiPointGeometry","writeMultiLineStringGeometry","writeMultiPolygonGeometry","writeGeometryCollectionGeometry","GeoJSON$1","resolveUrl","baseUrl","doc","base","uuid","counter","random","toArray","arrayLike","px","styleProperty","getNodeWidth","leftBorder","rightBorder","getNodeHeight","topBorder","bottomBorder","getImageSize","getPixelRatio","FINAL_PROCESS","canvasDimensionLimit","checkCanvasDimensions","createImage","svgToDataURL","svg","html","nodeToDataURL","xmlns","foreignObject","isInstanceOfElement","instance","nodePrototype","formatCSSText","content","formatCSSProperties","priority","getPseudoElementStyle","className","pseudo","selector","cssText","clonePseudoElement","nativeNode","clonedNode","styleElement","clonePseudoElements","WOFF","JPEG","mimes","getExtension","getMimeType","extension","getContentFromDataUrl","dataURL","isDataUrl","makeDataUrl","mimeType","fetchAsDataURL","init","process","blob","reader","error","getCacheKey","contentType","includeQueryParams","resourceToDataURL","resourceUrl","msg","cloneCanvasElement","cloneVideoElement","video","poster","cloneIFrameElement","iframe","_a","cloneNode","cloneSingleNode","isSlotElement","cloneChildren","_b","deferred","clonedChild","cloneCSSStyle","targetStyle","sourceStyle","cloneInputValue","cloneSelectValue","clonedSelect","selectedOption","decorate","ensureSVGSymbols","uses","processedDefs","exist","definition","nodes","ns","defs","isRoot","URL_REGEX","URL_WITH_FORMAT_REGEX","FONT_SRC_REGEX","toRegex","escaped","parseURLs","raw","quotation","embed","resourceURL","baseURL","getContentFromUrl","resolvedURL","filterPreferredFontFormat","preferredFontFormat","shouldEmbed","embedResources","filteredCSSText","css","embedProp","propName","propValue","cssString","embedBackground","embedImageNode","isImageElement","embedChildren","deferreds","embedImages","applyStyle","manual","cssFetchCache","fetchCSS","embedFonts","regexUrl","loadFonts","loc","parseCSS","commentsRegex","keyframesRegex","importRegex","combinedCSSRegex","unifiedRegex","getCSSRules","styleSheets","ret","sheet","importIndex","metadata","rule","inline","err","getWebFontRules","cssRules","parseWebFontRules","getWebFontCSS","rules","embedWebFonts","styleNode","sytleContent","toSvg","toCanvas","canvasWidth","canvasHeight","toPng","currentPositionImg","_sfc_main","props","emit","reactive","onMounted","OSM","_openBlock","_createElementBlock","_hoisted_1","$setup","_imports_0$5","getTribeData","tribeId","FailMethod","getDisasterData","getRainfallStation","stationName","getHarvestDrill","projNo","getPotentialDebrisFlowTorrent","initialize","popup","getRockfall","onUpdated","router","_hoisted_2","_hoisted_3","_withScopeId","_createElementVNode","_hoisted_6","_hoisted_7","_hoisted_8","_imports_0","_hoisted_10","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_17","_hoisted_20","_hoisted_22","_hoisted_23","_hoisted_25","_hoisted_26","_hoisted_28","_hoisted_29","_hoisted_31","_hoisted_32","_hoisted_34","_hoisted_35","_hoisted_37","_hoisted_38","_hoisted_40","_hoisted_41","_hoisted_43","_hoisted_44","_hoisted_46","_hoisted_47","_hoisted_48","_hoisted_50","_hoisted_51","_hoisted_52","_hoisted_53","_hoisted_54","_hoisted_55","_hoisted_56","_hoisted_58","_hoisted_60","_hoisted_61","_hoisted_63","_hoisted_64","_hoisted_66","_hoisted_67","_hoisted_69","_hoisted_70","_hoisted_72","_hoisted_73","_hoisted_74","_hoisted_75","_hoisted_78","_hoisted_80","_hoisted_81","_hoisted_83","_hoisted_84","_hoisted_86","_hoisted_87","_hoisted_89","_hoisted_90","_hoisted_92","_hoisted_93","_hoisted_95","_hoisted_98","_hoisted_100","_hoisted_101","_hoisted_103","_hoisted_104","_hoisted_106","_hoisted_107","_hoisted_109","_hoisted_110","_hoisted_112","_hoisted_113","_normalizeStyle","_cache","_toDisplayString","_f","_e","_hoisted_11","_Fragment","_renderList","_p","_o","_hoisted_16","_hoisted_18","_hoisted_21","_hoisted_24","_hoisted_27","_hoisted_30","_hoisted_33","_hoisted_36","_hoisted_39","_q","_r","_s","_t","_u","_v","_w","_hoisted_59","_hoisted_62","_hoisted_65","_hoisted_68","_hoisted_71","_hoisted_79","_hoisted_82","_hoisted_85","_hoisted_88","_hoisted_91","_hoisted_94","_hoisted_99","_hoisted_102","_hoisted_105","_hoisted_108","_hoisted_111","_imports_0$4","_imports_1$3","_imports_2$3","_imports_3$3","_imports_4$3","_imports_5","toolSwitch","onLayerControl","action","_imports_0$3","_imports_1$2","_imports_2$2","_imports_3$2","_imports_4$2","_imports_1","_hoisted_9","_imports_2","_imports_3","_imports_4","_withModifiers","_hoisted_5","_normalizeClass","nodeIndex","store","useStore","route","overLayCom","computed","proj4","register","mapLayerList","nestedSubNodeIndex","layerSource","layerType","figureType","tileTitle","request","api","pathname","searchParams","searchParamsObject","TileWMS","TileLayer","matrixIds","hasSelectColor","layerStyle","featureGroupName","getRandomUniqueColor","usedColors","characters","imageLayer","Static","ImageLayer","subNodeIndex","keyName","newVal","newStr","baseMapDataList","baseMapList","XYZ","getBaseMapAll","LayerCheckBoxChange","defaultChecked","$","selectValue","mapList","tribeYear","tribeTown","moveMap","_hoisted_4","subNode","_hoisted_19","subNodeIds","_createTextVNode","$event","_vModelSelect","_imports_0$2","_imports_1$1","_imports_2$1","_imports_3$1","_imports_4$1","_hoisted_15","_imports_0$1","SelectEventType","SelectEvent","selected","deselected","mapBrowserEvent","originalFeatureStyles","Select","Interaction","singleClick","never","shiftKeyOnly","getDefaultStyleFunction","layerFilter","interactions","interaction","remove","toggle","set","clear","Select$1","UNITS_PROP","LEADING_DIGITS","DEFAULT_DPI","ScaleLine","Control","CLASS_UNSELECTABLE","units","pointResolutionUnits","pointResolution","getPointResolution","minWidth","maxWidth","nominalCount","suffix","metersPerDegree","METERS_PER_UNIT","count","decimalCount","previousCount","previousWidth","previousDecimalCount","decimal","resolutionScale","mapScale","steps","stepWidth","scaleSteps","cls","isLast","lengthString","inchesPerMeter","mapEvent","ScaleLine$1","exports","param","olcsListen","observable","uidCounter_","stableSort","compareFnc","isGroundPolylinePrimitiveSupported","scene","olUseNewCoordinates","TileSource","OLImageryProvider","olMap","opt_fallbackProj","proxy","olcsUtil","zoom","xIndex","yIndex","attributionsFunction","attributionsFunctionToCredits","tileUrlFunction","z_","y_","tg","MVTImageryProvider","cacheSize","LRUCache","getTilegridForProjection","createTileUrlFunctions","promise","scaleFactor","f","vectorContext","camera","frustum","amount","bottomLeft","topRight","input","output","translation","rawMatrix","quaternion","rotationMatrix","axis","opt_options","defaultValue","duration","easing","linearEasing","lastProgress","oldTransform","timeDifference","progress","stepAngle","heading","bottomCenter","angleToZenith","vector","zenith","rotateAroundAxis","ray","bottom","ellipsoid","normal","angleBetween","fovy2","direction","matrix","first","second","cosine","sine","sign","pivot","fy","ext","transformExtent","viewProj","olLayer","skip","provider","sourceProps","olSourceTileWMS","olSourceTileImage","olcsCoreOLImageryProvider","olSourceImageStatic","fromCode","u","rectangle","minimumLevel","credit","getExtentCenter","olLayerTile","olLayerImage","layerOptions","olLayerWithParents","csLayer","layerOpacity","layerVisible","coo","toCartesian","cartesians","proj4326","proj","olColor","subdomains","re","startCharCode","stopCharCode","charCode","currentHeading","view","is3857","is4326","attributions","calcDistanceForResolution","latitude","fovy","metersPerUnit","visibleMapUnits","relativeCircumference","calcResolutionForDistance","visibleMeters","AutoRenderLoop","ol3d","repaintKey","toDegrees","angleInRadians","toRadians","angleInDegrees","Camera","opt_output","opt_dimension","dim","olObservableUnByKey","toLonLat","getTransform","fromLonLat","tilt","ll","carto","altitude","destination","orientation","olcsCore","bestTarget","globe","bestTargetCartographic","targetNormal","targetToCamera","up","tiltAngle","opt_dontSync","old","current","AbstractSynchronizer","root","fifo","olLayerId","cesiumObjects","olLayerGroup","newOlLayerWithParents","layerId","layerWithParents","onLayerChange","cesiumObjs","cesiumObject","counterparts","counterpart","done","listenKeyArray","contentKeys","listenAddRemove","el","objKey","destroy","RasterSynchronizer","olcsAbstractSynchronizer","olLayerItem","previousStyleFunction","currentStyleFunction","csObj","zIndices","queue","sublayers","layer1","layer2","VectorLayerCounterpart","layerProjection","billboards","primitives","FeatureConverter","olSourceVector","cancellers","canceller","primitive","olGeometry","opt_lineWidth","createInstance","instances","heightReference","dataUri","outline","fillColor","strokeColor","fillGeometry","outlineGeometry","olStyle","outlineColor","bbOptions","outlinePrimitive","circlePolygon","olCreateCircularPolygon","positions","geometryInstances","previousDistance","geometryOptions","linePositions","appearance","primitiveOptions","maxHeight","rings","hierarchy","polygonHierarchy","olPos","polylineGeometry","altitudeMode","opt_newBillboardCallback","olStyleIcon","isImageLoaded","reallyCreateBillboard","cancelled","fuid","modelPrimitive","olcsModelFunction","olcsModel","model","accumulate","functor","subgeos","labels","extentCenter","olGeomSimpleGeometry","labelStyle","horizontalOrigin","verticalOrigin","fallbackStyleFunction","opt_geom","geom3d","olGeomGeometry","geomFuncRes","newBillboardAddedCallback","featureBb","prims","bbs","result2","olView","featurePrimitiveMap","olcsCoreVectorLayerCounterpart","prim","VectorSynchronizer","opt_converter","olcsFeatureConverter","csPrimitive","olLayerVector","olLayerLayer","csPrimitives","olListenKeys","onAddFeature","onRemoveFeature","SynchronizedOverlay","olOverlay","setPropertyFromEvent","observer","sourceProjection","globeHeight","cartesian","ellipsoidBoundingSphere","pixelCartesian","OverlaySynchronizer","overlay","cesiumOverlay","olcsSynchronizedOverlay","overlayId","removedOverlay","csOverlay","OLCesium","fillArea","containerAttribute","targetElement","overlayEvents","canvasAttribute","sceneOptions","sscc","olcsCamera","firstImageryProvider","synchronizers","olcsRasterSynchronizer","olcsVectorSynchronizer","olcsOverlaySynchronizer","frameTime","interval","julianDate","trackedEntity","bs","enable","rootGroup","timeout","csCamera","block","olcsAutoRenderLoop","to4326Transform","toCesiumPosition","olGeomPoint","coo4326","time","initMap","Map","defaultView","addPoint","targetLng","targetLat","mapControl","View","mainMap","xAxis","yAxis","layerControl","targetLayers","isSingleTiles","haveInfoBox","getMapLayers","targetLayer","currentLayerKey","tilesImageUrls","imageExtent","timeKey","newSource","mapClickEvent","layersAry","deleteKey","removeLayersById","visibleStatus","newTileLayer","ta","layerToRemove","getCurrentMapData","qty","otherMap","otherLayersData","delToMap","otherLayers","onMapLayerStatus","click","selectedFeatures","selectIds","addSelectElement","layerName","sub","subIndex","nestedSubIndex","nestedSub","show","moveToMap","changeMapCount","_createVNode","_component_SearchBar","_mergeProps","_component_Condition","_createBlock","_component_LayerSelector","_component_mNavbar"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123]}