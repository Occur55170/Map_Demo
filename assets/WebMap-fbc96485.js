import{_ as Z,r as ne,o as Et,a as lt,b as L,c as x,d as f,t as A,e as ee,F as te,f as se,g as k,$ as ct,p as Ve,h as $e,w as T,n as B,i as Rt,j as dt,v as ht,u as Ft,k as Te,l as He,m as ze,q as ce,s as Tt,x as It,y as Ot,z as Mt}from"./index-ff353134.js";import{o as Pt,u as Ae,l as ke,E as xe,a as ie,C as At,c as Se,V as ve,g as we,b as kt,r as Gt,d as We,m as Nt,e as Dt,t as Vt,f as ut,i as mt,h as q,j as $t,H as de,k as Bt,n as jt,p as ft,w as Ht,q as zt,s as Wt,v as Ue,x as Ke,y as Ut,z as Xe,A as Ze,B as G,D as Kt,F as pt,G as Xt,R as Zt,I as gt,J as Ee,K as _t,L as Yt,S as qt,M as Jt,N as Ye,O as Qt,P as es,Q as qe,T as ts,U as ss,W as is,X as ns,Y as yt,Z as rs,_ as os,$ as as,a0 as ls,a1 as cs,a2 as U,a3 as ds,a4 as hs,a5 as us,a6 as Ct,a7 as K,a8 as ms,a9 as fs,aa as ps,ab as gs,ac as _s,ad as ys,ae as Je,af as vt,ag as Cs,ah as vs,ai as Qe,aj as ws,ak as bs,al as Ls,am as xs,an as wt,ao as Ie,ap as fe,aq as Oe,ar as et,as as tt,at as he,au as z,av as Ge,aw as M,ax as Ss,ay as Es,az as I,aA as Ne,aB as J,aC as Rs,aD as X,aE as Fs,aF as Me,aG as Ts,aH as De,aI as st,aJ as Is,aK as Os,aL as Ms,aM as Ps,aN as As,aO as ks,aP as Gs,aQ as Ns,aR as Pe,aS as ue}from"./core-2015dc45.js";const Ds="/Map_Demo/assets/example-AddressData-2d340b55.jpg",Vs="/Map_Demo/assets/vector-20ddd9fb.svg";const $s={props:{tribeId:{Type:String,default:0},closeMapData:{Type:Function,default:()=>{}},maxHeight:{Type:Number,default:0}},setup(l,{emit:e}){const t=ne({media:"photo",scrollY:!1,tribeData:{}});async function s(i){return await ct.ajax({url:`https://api.edtest.site/tribe?tribeCode=${i}`,method:"GET"}).done(n=>n).fail(n=>(console.log("Fail",n),!1))}return Et(l.tribeId,()=>{s(l.tribeId).then(i=>{t.tribeData=i})}),lt(()=>{s(l.tribeId).then(i=>{t.tribeData=i})}),{props:l,state:t}}},ye=l=>(Ve("data-v-d8ece85d"),l=l(),$e(),l),Bs={class:"bg-white rounded py-2",style:{"overflow-y":"auto"}},js={class:"row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold"},Hs=ye(()=>f("svg",{width:"32",height:"32",viewBox:"0 0 24 24"},[f("path",{fill:"currentColor",d:"M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10zm0-11.414L9.172 7.757L7.757 9.172L10.586 12l-2.829 2.828l1.415 1.415L12 13.414l2.828 2.829l1.415-1.415L13.414 12l2.829-2.828l-1.415-1.415L12 10.586z"})],-1)),zs=[Hs],Ws=ye(()=>f("img",{src:Ds,class:"w-100",alt:""},null,-1)),Us={class:"row mx-0 align-items-center p-2 position-relative"},Ks=ye(()=>f("div",{class:"position-absolute w-auto top-0 end-0 mt-2"},"更多資訊",-1)),Xs={href:""},Zs=ye(()=>f("img",{src:Vs,alt:""},null,-1)),Ys={class:"border-bottom row flex-nowrap p-2 my-3 cursor-pointer mx-0"},qs={key:0,class:"py-2 px-4"},Js={class:"d-flex flex-wrap justify-content-between"},Qs={class:"w-50 mb-4"},ei={class:"mb-0"},ti=["src"],si={key:1,class:"py-2 px-4"},ii=ye(()=>f("div",null,"影片影片影片影片影片影片",-1)),ni=[ii];function ri(l,e,t,s,i,r){var n,a,o,d,h,c,u,g,m,p,C,y,_,w,v,F,S,O,D,V,oe;return L(),x("div",Bs,[f("div",js,[f("p",null,"詳細資訊 "+A(s.state.scrollY),1),f("div",{class:"position-absolute col-auto end-0",style:{top:"10px"},onClick:e[0]||(e[0]=(...P)=>t.closeMapData&&t.closeMapData(...P))},zs)]),Ws,f("div",Us,[f("p",null,"title: "+A(s.props.tribeId)+" "+A((o=(a=(n=s.state)==null?void 0:n.tribeData)==null?void 0:a.basicInformation)==null?void 0:o.tribeName),1),f("p",null,"描述: "+A((c=(h=(d=s.state)==null?void 0:d.tribeData)==null?void 0:h.basicInformation)==null?void 0:c.description),1),Ks,f("p",null,A((m=(g=(u=s.state)==null?void 0:u.tribeData)==null?void 0:g.basicInformation)==null?void 0:m.area),1),f("a",Xs,[Zs,ee(" "+A((w=(_=(y=(C=(p=s.state)==null?void 0:p.tribeData)==null?void 0:C.basicInformation)==null?void 0:y.coordinates)==null?void 0:_.WGS84)==null?void 0:w.lat)+" , "+A((D=(O=(S=(F=(v=s.state)==null?void 0:v.tribeData)==null?void 0:F.basicInformation)==null?void 0:S.coordinates)==null?void 0:O.WGS84)==null?void 0:D.lng),1)])]),f("div",null,[f("div",Ys,[f("div",{class:"col-6 cursor-pointer",onClick:e[1]||(e[1]=P=>s.state.media="photo")},"相片"),f("div",{class:"col-6 cursor-pointer",onClick:e[2]||(e[2]=P=>s.state.media="video")},"影片")]),s.state.media==="photo"?(L(),x("div",qs,[f("div",Js,[(L(!0),x(te,null,se((oe=(V=s.state)==null?void 0:V.tribeData)==null?void 0:oe.culturalLandscape,P=>(L(),x("div",Qs,[f("p",ei,A(P.name),1),f("img",{src:P.image,alt:"",class:"w-100"},null,8,ti)]))),256))])])):k("",!0),s.state.media==="video"?(L(),x("div",si,ni)):k("",!0)])])}const oi=Z($s,[["render",ri],["__scopeId","data-v-d8ece85d"]]);class Be extends Pt{constructor(e){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),e)if(typeof e.getSimplifiedGeometry=="function"){const t=e;this.setGeometry(t)}else{const t=e;this.setProperties(t)}}clone(){const e=new Be(this.hasProperties()?this.getProperties():null);e.setGeometryName(this.getGeometryName());const t=this.getGeometry();t&&e.setGeometry(t.clone());const s=this.getStyle();return s&&e.setStyle(s),e}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(Ae(this.geometryChangeKey_),this.geometryChangeKey_=null);const e=this.getGeometry();e&&(this.geometryChangeKey_=ke(e,xe.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(e){this.set(this.geometryName_,e)}setStyle(e){this.style_=e,this.styleFunction_=e?ai(e):void 0,this.changed()}setId(e){this.id_=e,this.changed()}setGeometryName(e){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=e,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function ai(l){if(typeof l=="function")return l;let e;return Array.isArray(l)?e=l:(ie(typeof l.getZIndex=="function",41),e=[l]),function(){return e}}const _e=Be;class li extends At{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=Se(),this.wrappedRenderedExtent_=Se(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.declutterExecutorGroup=null,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(e,t,s){const i=t.extent,r=t.viewState,n=r.center,a=r.resolution,o=r.projection,d=r.rotation,h=o.getExtent(),c=this.getLayer().getSource(),u=t.pixelRatio,g=t.viewHints,m=!(g[ve.ANIMATING]||g[ve.INTERACTING]),p=this.compositionContext_,C=Math.round(t.size[0]*u),y=Math.round(t.size[1]*u),_=c.getWrapX()&&o.canWrapX(),w=_?we(h):null,v=_?Math.ceil((i[2]-h[2])/w)+1:1;let F=_?Math.floor((i[0]-h[0])/w):0;do{const S=this.getRenderTransform(n,a,d,u,C,y,F*w);e.execute(p,1,S,d,m,void 0,s)}while(++F<v)}setupCompositionContext_(){if(this.opacity_!==1){const e=kt(this.context.canvas.width,this.context.canvas.height,We);this.compositionContext_=e}else this.compositionContext_=this.context}releaseCompositionContext_(){if(this.opacity_!==1){const e=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=e,Gt(this.compositionContext_),We.push(this.compositionContext_.canvas),this.compositionContext_=null}}renderDeclutter(e){this.declutterExecutorGroup&&(this.setupCompositionContext_(),this.renderWorlds(this.declutterExecutorGroup,e,e.declutterTree),this.releaseCompositionContext_())}renderFrame(e,t){const s=e.pixelRatio,i=e.layerStatesArray[e.layerIndex];Nt(this.pixelTransform,1/s,1/s),Dt(this.inversePixelTransform,this.pixelTransform);const r=Vt(this.pixelTransform);this.useContainer(t,r,this.getBackground(e));const n=this.context,a=n.canvas,o=this.replayGroup_,d=this.declutterExecutorGroup;if((!o||o.isEmpty())&&(!d||d.isEmpty()))return null;const h=Math.round(e.size[0]*s),c=Math.round(e.size[1]*s);a.width!=h||a.height!=c?(a.width=h,a.height=c,a.style.transform!==r&&(a.style.transform=r)):this.containerReused||n.clearRect(0,0,h,c),this.preRender(n,e);const u=e.viewState;u.projection,this.opacity_=i.opacity,this.setupCompositionContext_();let g=!1,m=!0;if(i.extent&&this.clipping){const p=ut(i.extent);m=mt(p,e.extent),g=m&&!q(p,e.extent),g&&this.clipUnrotated(this.compositionContext_,e,p)}return m&&this.renderWorlds(o,e),g&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(n,e),this.renderedRotation_!==u.rotation&&(this.renderedRotation_=u.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(e){return new Promise(t=>{if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const s=[this.context.canvas.width,this.context.canvas.height];$t(this.pixelTransform,s);const i=this.renderedCenter_,r=this.renderedResolution_,n=this.renderedRotation_,a=this.renderedProjection_,o=this.wrappedRenderedExtent_,d=this.getLayer(),h=[],c=s[0]*de,u=s[1]*de;h.push(this.getRenderTransform(i,r,n,de,c,u,0).slice());const g=d.getSource(),m=a.getExtent();if(g.getWrapX()&&a.canWrapX()&&!q(m,o)){let p=o[0];const C=we(m);let y=0,_;for(;p<m[0];)--y,_=C*y,h.push(this.getRenderTransform(i,r,n,de,c,u,_).slice()),p+=C;for(y=0,p=o[2];p>m[2];)++y,_=C*y,h.push(this.getRenderTransform(i,r,n,de,c,u,_).slice()),p-=C}this.hitDetectionImageData_=Bt(s,h,this.renderedFeatures_,d.getStyleFunction(),o,r,n)}t(jt(e,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(e,t,s,i,r){if(!this.replayGroup_)return;const n=t.viewState.resolution,a=t.viewState.rotation,o=this.getLayer(),d={},h=function(g,m,p){const C=G(g),y=d[C];if(y){if(y!==!0&&p<y.distanceSq){if(p===0)return d[C]=!0,r.splice(r.lastIndexOf(y),1),i(g,o,m);y.geometry=m,y.distanceSq=p}}else{if(p===0)return d[C]=!0,i(g,o,m);r.push(d[C]={feature:g,layer:o,geometry:m,distanceSq:p,callback:i})}};let c;const u=[this.replayGroup_];return this.declutterExecutorGroup&&u.push(this.declutterExecutorGroup),u.some(g=>c=g.forEachFeatureAtCoordinate(e,n,a,s,h,g===this.declutterExecutorGroup&&t.declutterTree?t.declutterTree.all().map(m=>m.value):null)),c}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){const t=this.getLayer(),s=t.getSource();if(!s)return!1;const i=e.viewHints[ve.ANIMATING],r=e.viewHints[ve.INTERACTING],n=t.getUpdateWhileAnimating(),a=t.getUpdateWhileInteracting();if(this.ready&&!n&&i||!a&&r)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const o=e.extent,d=e.viewState,h=d.projection,c=d.resolution,u=e.pixelRatio,g=t.getRevision(),m=t.getRenderBuffer();let p=t.getRenderOrder();p===void 0&&(p=Kt);const C=d.center.slice(),y=ft(o,m*c),_=y.slice(),w=[y.slice()],v=h.getExtent();if(s.getWrapX()&&h.canWrapX()&&!q(v,e.extent)){const b=we(v),R=Math.max(we(y)/2,b);y[0]=v[0]-R,y[2]=v[2]+R,Ht(C,h);const E=zt(w[0],h);E[0]<v[0]&&E[2]<v[2]?w.push([E[0]+b,E[1],E[2]+b,E[3]]):E[0]>v[0]&&E[2]>v[2]&&w.push([E[0]-b,E[1],E[2]-b,E[3]])}if(this.ready&&this.renderedResolution_==c&&this.renderedRevision_==g&&this.renderedRenderOrder_==p&&q(this.wrappedRenderedExtent_,y))return Wt(this.renderedExtent_,_)||(this.hitDetectionImageData_=null,this.renderedExtent_=_),this.renderedCenter_=C,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const F=new Ue(Ke(c,u),y,c,u);let S;this.getLayer().getDeclutter()&&(S=new Ue(Ke(c,u),y,c,u));let O;for(let b=0,R=w.length;b<R;++b)s.loadFeatures(w[b],c,h);const D=Ut(c,u);let V=!0;const oe=b=>{let R;const E=b.getStyleFunction()||t.getStyleFunction();if(E&&(R=E(b,c)),R){const le=this.renderFeature(b,D,R,F,O,S);V=V&&!le}},P=pt(y),ae=s.getFeaturesInExtent(P);p&&ae.sort(p);for(let b=0,R=ae.length;b<R;++b)oe(ae[b]);this.renderedFeatures_=ae,this.ready=V;const Fe=F.finish(),Y=new Xe(y,c,u,s.getOverlaps(),Fe,t.getRenderBuffer());return S&&(this.declutterExecutorGroup=new Xe(y,c,u,s.getOverlaps(),S.finish(),t.getRenderBuffer())),this.renderedResolution_=c,this.renderedRevision_=g,this.renderedRenderOrder_=p,this.renderedExtent_=_,this.wrappedRenderedExtent_=y,this.renderedCenter_=C,this.renderedProjection_=h,this.replayGroup_=Y,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,s,i,r,n){if(!s)return!1;let a=!1;if(Array.isArray(s))for(let o=0,d=s.length;o<d;++o)a=Ze(i,e,s[o],t,this.boundHandleStyleImageChange_,r,n)||a;else a=Ze(i,e,s,t,this.boundHandleStyleImageChange_,r,n);return a}}const ci=li;class di extends Xt{constructor(e){super(e)}createRenderer(){return new ci(this)}}const W=di;class hi{constructor(e){this.rbush_=new Zt(e),this.items_={}}insert(e,t){const s={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(s),this.items_[G(t)]=s}load(e,t){const s=new Array(t.length);for(let i=0,r=t.length;i<r;i++){const n=e[i],a=t[i],o={minX:n[0],minY:n[1],maxX:n[2],maxY:n[3],value:a};s[i]=o,this.items_[G(a)]=o}this.rbush_.load(s)}remove(e){const t=G(e),s=this.items_[t];return delete this.items_[t],this.rbush_.remove(s)!==null}update(e,t){const s=this.items_[G(t)],i=[s.minX,s.minY,s.maxX,s.maxY];gt(i,e)||(this.remove(t),this.insert(e,t))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(e){const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(t).map(function(i){return i.value})}forEach(e){return this.forEach_(this.getAll(),e)}forEachInExtent(e,t){return this.forEach_(this.getInExtent(e),t)}forEach_(e,t){let s;for(let i=0,r=e.length;i<r;i++)if(s=t(e[i]),s)return s;return s}isEmpty(){return Ee(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(e){const t=this.rbush_.toJSON();return _t(t.minX,t.minY,t.maxX,t.maxY,e)}concat(e){this.rbush_.load(e.rbush_.all());for(const t in e.items_)this.items_[t]=e.items_[t]}}const it=hi,N={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function ui(l,e){return[[-1/0,-1/0,1/0,1/0]]}function nt(l){return function(e,t,s){const i=l.getZForResolution(Yt(t)),r=l.getTileRangeForExtentAndZ(ut(e),i),n=[],a=[i,0,0];for(a[1]=r.minX;a[1]<=r.maxX;++a[1])for(a[2]=r.minY;a[2]<=r.maxY;++a[2])n.push(pt(l.getTileCoordExtent(a)));return n}}class H extends is{constructor(e,t,s){super(e),this.feature=t,this.features=s}}class mi extends qt{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:e.wrapX!==void 0?e.wrapX:!0}),this.on,this.once,this.un,this.loader_=Jt,this.format_=e.format,this.overlaps_=e.overlaps===void 0?!0:e.overlaps,this.url_=e.url,e.loader!==void 0?this.loader_=e.loader:this.url_!==void 0&&(ie(this.format_,7),this.loader_=Ye(this.url_,this.format_)),this.strategy_=e.strategy!==void 0?e.strategy:ui;const t=e.useSpatialIndex!==void 0?e.useSpatialIndex:!0;this.featuresRtree_=t?new it:null,this.loadedExtentsRtree_=new it,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let s,i;Array.isArray(e.features)?i=e.features:e.features&&(s=e.features,i=s.getArray()),!t&&s===void 0&&(s=new Qt(i)),i!==void 0&&this.addFeaturesInternal(i),s!==void 0&&this.bindFeaturesCollection_(s)}addFeature(e){this.addFeatureInternal(e),this.changed()}addFeatureInternal(e){const t=G(e);if(!this.addToIndex_(t,e)){this.featuresCollection_&&this.featuresCollection_.remove(e);return}this.setupChangeEvents_(t,e);const s=e.getGeometry();if(s){const i=s.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(i,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new H(N.ADDFEATURE,e))}setupChangeEvents_(e,t){this.featureChangeKeys_[e]=[ke(t,xe.CHANGE,this.handleFeatureChange_,this),ke(t,es.PROPERTYCHANGE,this.handleFeatureChange_,this)]}addToIndex_(e,t){let s=!0;const i=t.getId();return i!==void 0&&(i.toString()in this.idIndex_?s=!1:this.idIndex_[i.toString()]=t),s&&(ie(!(e in this.uidIndex_),30),this.uidIndex_[e]=t),s}addFeatures(e){this.addFeaturesInternal(e),this.changed()}addFeaturesInternal(e){const t=[],s=[],i=[];for(let r=0,n=e.length;r<n;r++){const a=e[r],o=G(a);this.addToIndex_(o,a)&&s.push(a)}for(let r=0,n=s.length;r<n;r++){const a=s[r],o=G(a);this.setupChangeEvents_(o,a);const d=a.getGeometry();if(d){const h=d.getExtent();t.push(h),i.push(a)}else this.nullGeometryFeatures_[o]=a}if(this.featuresRtree_&&this.featuresRtree_.load(t,i),this.hasListener(N.ADDFEATURE))for(let r=0,n=s.length;r<n;r++)this.dispatchEvent(new H(N.ADDFEATURE,s[r]))}bindFeaturesCollection_(e){let t=!1;this.addEventListener(N.ADDFEATURE,function(s){t||(t=!0,e.push(s.feature),t=!1)}),this.addEventListener(N.REMOVEFEATURE,function(s){t||(t=!0,e.remove(s.feature),t=!1)}),e.addEventListener(qe.ADD,s=>{t||(t=!0,this.addFeature(s.element),t=!1)}),e.addEventListener(qe.REMOVE,s=>{t||(t=!0,this.removeFeature(s.element),t=!1)}),this.featuresCollection_=e}clear(e){if(e){for(const s in this.featureChangeKeys_)this.featureChangeKeys_[s].forEach(Ae);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const s=i=>{this.removeFeatureInternal(i)};this.featuresRtree_.forEach(s);for(const i in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[i])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const t=new H(N.CLEAR);this.dispatchEvent(t),this.changed()}forEachFeature(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureAtCoordinateDirect(e,t){const s=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(s,function(i){if(i.getGeometry().intersectsCoordinate(e))return t(i)})}forEachFeatureInExtent(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureIntersectingExtent(e,t){return this.forEachFeatureInExtent(e,function(s){if(s.getGeometry().intersectsExtent(e)){const r=t(s);if(r)return r}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),Ee(this.nullGeometryFeatures_)||ts(e,Object.values(this.nullGeometryFeatures_))),e}getFeaturesAtCoordinate(e){const t=[];return this.forEachFeatureAtCoordinateDirect(e,function(s){t.push(s)}),t}getFeaturesInExtent(e,t){if(this.featuresRtree_){if(!(t&&t.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(e);const i=ss(e,t);return[].concat(...i.map(r=>this.featuresRtree_.getInExtent(r)))}else if(this.featuresCollection_)return this.featuresCollection_.getArray().slice(0);return[]}getClosestFeatureToCoordinate(e,t){const s=e[0],i=e[1];let r=null;const n=[NaN,NaN];let a=1/0;const o=[-1/0,-1/0,1/0,1/0];return t=t||ns,this.featuresRtree_.forEachInExtent(o,function(d){if(t(d)){const h=d.getGeometry(),c=a;if(a=h.closestPointXY(s,i,n,a),a<c){r=d;const u=Math.sqrt(a);o[0]=s-u,o[1]=i-u,o[2]=s+u,o[3]=i+u}}}),r}getExtent(e){return this.featuresRtree_.getExtent(e)}getFeatureById(e){const t=this.idIndex_[e.toString()];return t!==void 0?t:null}getFeatureByUid(e){const t=this.uidIndex_[e];return t!==void 0?t:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(e){const t=e.target,s=G(t),i=t.getGeometry();if(!i)s in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[s]=t);else{const n=i.getExtent();s in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[s],this.featuresRtree_&&this.featuresRtree_.insert(n,t)):this.featuresRtree_&&this.featuresRtree_.update(n,t)}const r=t.getId();if(r!==void 0){const n=r.toString();this.idIndex_[n]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[n]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[s]=t;this.changed(),this.dispatchEvent(new H(N.CHANGEFEATURE,t))}hasFeature(e){const t=e.getId();return t!==void 0?t in this.idIndex_:G(e)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&Ee(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(e,t,s){const i=this.loadedExtentsRtree_,r=this.strategy_(e,t,s);for(let n=0,a=r.length;n<a;++n){const o=r[n];i.forEachInExtent(o,function(h){return q(h.extent,o)})||(++this.loadingExtentsCount_,this.dispatchEvent(new H(N.FEATURESLOADSTART)),this.loader_.call(this,o,t,s,h=>{--this.loadingExtentsCount_,this.dispatchEvent(new H(N.FEATURESLOADEND,void 0,h))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new H(N.FEATURESLOADERROR))}),i.insert(o,{extent:o.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(e){const t=this.loadedExtentsRtree_;let s;t.forEachInExtent(e,function(i){if(gt(i.extent,e))return s=i,!0}),s&&t.remove(s)}removeFeature(e){if(!e)return;const t=G(e);t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e),this.removeFeatureInternal(e)&&this.changed()}removeFeatureInternal(e){const t=G(e),s=this.featureChangeKeys_[t];if(!s)return;s.forEach(Ae),delete this.featureChangeKeys_[t];const i=e.getId();return i!==void 0&&delete this.idIndex_[i.toString()],delete this.uidIndex_[t],this.dispatchEvent(new H(N.REMOVEFEATURE,e)),e}removeFromIdIndex_(e){let t=!1;for(const s in this.idIndex_)if(this.idIndex_[s]===e){delete this.idIndex_[s],t=!0;break}return t}setLoader(e){this.loader_=e}setUrl(e){ie(this.format_,7),this.url_=e,this.setLoader(Ye(e,this.format_))}}const $=mi;class Re extends yt{constructor(e,t,s){super(),s!==void 0&&t===void 0?this.setFlatCoordinates(s,e):(t=t||0,this.setCenterAndRadius(e,t,s))}clone(){const e=new Re(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,s,i){const r=this.flatCoordinates,n=e-r[0],a=t-r[1],o=n*n+a*a;if(o<i){if(o===0)for(let d=0;d<this.stride;++d)s[d]=r[d];else{const d=this.getRadius()/Math.sqrt(o);s[0]=r[0]+d*n,s[1]=r[1]+d*a;for(let h=2;h<this.stride;++h)s[h]=r[h]}return s.length=this.stride,o}return i}containsXY(e,t){const s=this.flatCoordinates,i=e-s[0],r=t-s[1];return i*i+r*r<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,s=t[this.stride]-t[0];return _t(t[0]-s,t[1]-s,t[0]+s,t[1]+s,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if(mt(e,t)){const s=this.getCenter();return e[0]<=s[0]&&e[2]>=s[0]||e[1]<=s[1]&&e[3]>=s[1]?!0:rs(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,s=this.flatCoordinates[t]-this.flatCoordinates[0],i=e.slice();i[t]=i[0]+s;for(let r=1;r<t;++r)i[t+r]=e[r];this.setFlatCoordinates(this.layout,i),this.changed()}setCenterAndRadius(e,t,s){this.setLayout(s,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const i=this.flatCoordinates;let r=os(i,0,e,this.stride);i[r++]=i[0]+t;for(let n=1,a=this.stride;n<a;++n)i[r++]=i[n];i.length=r,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const s=this.getCenter(),i=this.getStride();this.setCenter(as(s,0,s.length,i,e,t,s)),this.changed()}translate(e,t){const s=this.getCenter(),i=this.getStride();this.setCenter(ls(s,0,s.length,i,e,t,s)),this.changed()}}Re.prototype.transform;const fi=Re;class pi extends cs{constructor(){super()}getType(){return"json"}readFeature(e,t){return this.readFeatureFromObject(be(e),this.getReadOptions(e,t))}readFeatures(e,t){return this.readFeaturesFromObject(be(e),this.getReadOptions(e,t))}readFeatureFromObject(e,t){return U()}readFeaturesFromObject(e,t){return U()}readGeometry(e,t){return this.readGeometryFromObject(be(e),this.getReadOptions(e,t))}readGeometryFromObject(e,t){return U()}readProjection(e){return this.readProjectionFromObject(be(e))}readProjectionFromObject(e){return U()}writeFeature(e,t){return JSON.stringify(this.writeFeatureObject(e,t))}writeFeatureObject(e,t){return U()}writeFeatures(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))}writeFeaturesObject(e,t){return U()}writeGeometry(e,t){return JSON.stringify(this.writeGeometryObject(e,t))}writeGeometryObject(e,t){return U()}}function be(l){if(typeof l=="string"){const e=JSON.parse(l);return e||null}else if(l!==null)return l;return null}const gi=pi;const _i={props:{onClose:{type:Function,default:()=>{}},onChangLayerVisible:{type:Function,default:()=>{}},onDeleteLayer:{type:Function,default:()=>{}},onLockLayer:{type:Function,default:()=>{}},onChangeOrderLayer:{type:Function,default:()=>{}},currentLayers:{type:Array,default:[]},selectLock:{type:Boolean,default:!1}},setup(l,{emit:e}){const t=ne({});return{props:l,state:t}}},j=l=>(Ve("data-v-284208de"),l=l(),$e(),l),yi={class:"rounded-4 bg-white"},Ci={class:"row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold"},vi=j(()=>f("p",{class:"mb-0 fs-5"},"已選擇的圖層",-1)),wi=j(()=>f("svg",{width:"32",height:"32",viewBox:"0 0 24 24"},[f("path",{fill:"currentColor",d:"M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10zm0-11.414L9.172 7.757L7.757 9.172L10.586 12l-2.829 2.828l1.415 1.415L12 13.414l2.828 2.829l1.415-1.415L13.414 12l2.829-2.828l-1.415-1.415L12 10.586z"})],-1)),bi=[wi],Li=j(()=>f("hr",{class:"my-0"},null,-1)),xi={class:"py-3 px-4 content"},Si={class:"allControl d-flex align-items-center justify-content-end mb-0"},Ei=j(()=>f("svg",{viewBox:"0 0 25 24",fill:"currentColor"},[f("path",{d:"M8.02381 9.33333H14.881V7.80952C14.881 7.1746 14.6587 6.63492 14.2143 6.19048C13.7698 5.74603 13.2302 5.52381 12.5952 5.52381C11.9603 5.52381 11.4206 5.74603 10.9762 6.19048C10.5317 6.63492 10.3095 7.1746 10.3095 7.80952H8.78571C8.78571 6.75556 9.15727 5.85702 9.90038 5.1139C10.643 4.3713 11.5413 4 12.5952 4C13.6492 4 14.5477 4.3713 15.2909 5.1139C16.0335 5.85702 16.4048 6.75556 16.4048 7.80952V9.33333H17.1667C17.5857 9.33333 17.9446 9.48241 18.2432 9.78057C18.5414 10.0792 18.6905 10.4381 18.6905 10.8571V18.4762C18.6905 18.8952 18.5414 19.2541 18.2432 19.5528C17.9446 19.8509 17.5857 20 17.1667 20H8.02381C7.60476 20 7.24616 19.8509 6.948 19.5528C6.64933 19.2541 6.5 18.8952 6.5 18.4762V10.8571C6.5 10.4381 6.64933 10.0792 6.948 9.78057C7.24616 9.48241 7.60476 9.33333 8.02381 9.33333ZM12.5952 16.1905C13.0143 16.1905 13.3731 16.0414 13.6718 15.7432C13.97 15.4446 14.119 15.0857 14.119 14.6667C14.119 14.2476 13.97 13.8888 13.6718 13.5901C13.3731 13.2919 13.0143 13.1429 12.5952 13.1429C12.1762 13.1429 11.8176 13.2919 11.5194 13.5901C11.2208 13.8888 11.0714 14.2476 11.0714 14.6667C11.0714 15.0857 11.2208 15.4446 11.5194 15.7432C11.8176 16.0414 12.1762 16.1905 12.5952 16.1905Z"})],-1)),Ri=j(()=>f("svg",{viewBox:"0 0 25 24",fill:"currentColor"},[f("path",{d:"M7.5 21C6.95 21 6.47933 20.8043 6.088 20.413C5.696 20.021 5.5 19.55 5.5 19V6H4.5V4H9.5V3H15.5V4H20.5V6H19.5V19C19.5 19.55 19.3043 20.021 18.913 20.413C18.521 20.8043 18.05 21 17.5 21H7.5ZM9.5 17H11.5V8H9.5V17ZM13.5 17H15.5V8H13.5V17Z"})],-1)),Fi={class:"list-unstyled d-flex flex-wrap flex-column-reverse"},Ti={key:0,class:"d-flex justify-content-between align-items-center border-bottom py-2"},Ii={class:"tool"},Oi=["onClick"],Mi=j(()=>f("svg",{viewBox:"0 0 25 24",fill:"currentColor"},[f("path",{d:"M9.49991 19.84H15.4999V11.84H20.3399L12.4999 4.00003L4.65991 11.84H9.49991V19.84Z",fill:"#808080"})],-1)),Pi=[Mi],Ai=["onClick"],ki=j(()=>f("svg",{viewBox:"0 0 25 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[f("path",{d:"M9.49991 4H15.4999V12H20.3399L12.4999 19.84L4.65991 12H9.49991V4Z",fill:"#808080"})],-1)),Gi=[ki],Ni=["onClick"],Di=j(()=>f("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[f("path",{d:"M12.3333 10C11.8029 10 11.2942 10.2107 10.9191 10.5858C10.544 10.9609 10.3333 11.4696 10.3333 12C10.3333 12.5304 10.544 13.0391 10.9191 13.4142C11.2942 13.7893 11.8029 14 12.3333 14C12.8638 14 13.3725 13.7893 13.7475 13.4142C14.1226 13.0391 14.3333 12.5304 14.3333 12C14.3333 11.4696 14.1226 10.9609 13.7475 10.5858C13.3725 10.2107 12.8638 10 12.3333 10ZM12.3333 15.3333C11.4493 15.3333 10.6014 14.9821 9.97631 14.357C9.35119 13.7319 9 12.8841 9 12C9 11.1159 9.35119 10.2681 9.97631 9.64298C10.6014 9.01786 11.4493 8.66667 12.3333 8.66667C13.2174 8.66667 14.0652 9.01786 14.6904 9.64298C15.3155 10.2681 15.6667 11.1159 15.6667 12C15.6667 12.8841 15.3155 13.7319 14.6904 14.357C14.0652 14.9821 13.2174 15.3333 12.3333 15.3333ZM12.3333 7C9 7 6.15333 9.07333 5 12C6.15333 14.9267 9 17 12.3333 17C15.6667 17 18.5133 14.9267 19.6667 12C18.5133 9.07333 15.6667 7 12.3333 7Z",fill:"#808080"})],-1)),Vi=[Di],$i=["onClick"],Bi=j(()=>f("svg",{viewBox:"0 0 25 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[f("path",{d:"M7.5 21C6.95 21 6.47933 20.8043 6.088 20.413C5.696 20.021 5.5 19.55 5.5 19V6H4.5V4H9.5V3H15.5V4H20.5V6H19.5V19C19.5 19.55 19.3043 20.021 18.913 20.413C18.521 20.8043 18.05 21 17.5 21H7.5ZM9.5 17H11.5V8H9.5V17ZM13.5 17H15.5V8H13.5V17Z",fill:"#808080"})],-1)),ji=[Bi];function Hi(l,e,t,s,i,r){return L(),x("div",yi,[f("div",Ci,[vi,f("a",{href:"",class:"closeBtn position-absolute col-auto",onClick:e[0]||(e[0]=T((...n)=>s.props.onClose&&s.props.onClose(...n),["prevent"]))},bi)]),Li,f("div",xi,[f("div",Si,[f("a",{href:"",class:B(["d-flex align-items-center text-decoration-none me-4",{lockUp:s.props.selectLock,unlock:!s.props.selectLock}]),onClick:e[1]||(e[1]=T(()=>{s.props.onLockLayer()},["prevent"]))},[Ei,ee(" 鎖定圖層 ")],2),f("a",{href:"",class:B(["d-flex align-items-center text-decoration-none",{disabled:s.props.currentLayers.length<=1}]),onClick:e[2]||(e[2]=T(()=>{s.props.currentLayers.length>0&&s.props.onDeleteLayer({action:"selectLayerMode",value:{layerName:"all"}})},["prevent"]))},[Ri,ee(" 全部刪除 ")],2)]),f("ul",Fi,[(L(!0),x(te,null,se(s.props.currentLayers,(n,a)=>(L(),x("li",null,[n.id?(L(),x("div",Ti,[f("div",null,A(n==null?void 0:n.label),1),f("div",Ii,[f("a",{href:"",onClick:T(o=>s.props.onChangeOrderLayer({action:"changeOrder",value:{movement:"up",id:n.id,key:a}}),["prevent"])},Pi,8,Oi),f("a",{href:"",onClick:T(o=>s.props.onChangeOrderLayer({action:"changeOrder",value:{movement:"down",id:n.id,key:a}}),["prevent"])},Gi,8,Ai),f("a",{href:"",class:B({Invisible:!(n!=null&&n.visible)}),onClick:T(()=>{s.props.onChangLayerVisible({action:"changeLayerVisible",value:{key:a}})},["prevent"])},Vi,10,Ni),f("a",{href:"",onClick:T(o=>s.props.onDeleteLayer({action:"selectLayerMode",value:{id:n==null?void 0:n.id}}),["prevent"])},ji,8,$i)])])):k("",!0)]))),256))])])])}const zi=Z(_i,[["render",Hi],["__scopeId","data-v-284208de"]]);class Wi extends ${constructor(e){super({attributions:e.attributions,wrapX:e.wrapX}),this.resolution=void 0,this.distance=e.distance!==void 0?e.distance:20,this.minDistance=e.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=e.geometryFunction||function(t){const s=t.getGeometry();return ie(s.getType()=="Point",10),s},this.createCustomCluster_=e.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(e.source||null)}clear(e){this.features.length=0,super.clear(e)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(e,t,s){this.source.loadFeatures(e,t,s),t!==this.resolution&&(this.resolution=t,this.refresh())}setDistance(e){this.updateDistance(e,this.minDistance)}setMinDistance(e){this.updateDistance(this.distance,e)}getMinDistance(){return this.minDistance}setSource(e){this.source&&this.source.removeEventListener(xe.CHANGE,this.boundRefresh_),this.source=e,e&&e.addEventListener(xe.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(e,t){const s=e===0?0:Math.min(t,e)/e,i=e!==this.distance||this.interpolationRatio!==s;this.distance=e,this.minDistance=t,this.interpolationRatio=s,i&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;const e=Se(),t=this.distance*this.resolution,s=this.source.getFeatures(),i={};for(let r=0,n=s.length;r<n;r++){const a=s[r];if(!(G(a)in i)){const o=this.geometryFunction(a);if(o){const d=o.getCoordinates();ds(d,e),ft(e,t,e);const h=this.source.getFeaturesInExtent(e).filter(function(c){const u=G(c);return u in i?!1:(i[u]=!0,!0)});this.features.push(this.createCluster(h,e))}}}}createCluster(e,t){const s=[0,0];for(let a=e.length-1;a>=0;--a){const o=this.geometryFunction(e[a]);o?hs(s,o.getCoordinates()):e.splice(a,1)}us(s,1/e.length);const i=Ct(t),r=this.interpolationRatio,n=new K([s[0]*(1-r)+i[0]*r,s[1]*(1-r)+i[1]*r]);return this.createCustomCluster_?this.createCustomCluster_(n,e):new _e({geometry:n,features:e})}}const bt=Wi;class Ui extends ms{constructor(e){e=e||{},super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.params_=e.params||{},this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.tmpExtent_=Se(),this.setKey(this.getKeyForParams_())}getKeyForParams_(){let e=0;const t=[];for(const s in this.params_)t[e++]=s+"-"+this.params_[s];return t.join("/")}getParams(){return this.params_}getRequestUrl_(e,t,s,i,r,n){const a=this.urls;if(!a)return;const o=r.getCode().split(/:(?=\d+$)/).pop();n.SIZE=t[0]+","+t[1],n.BBOX=s.join(","),n.BBOXSR=o,n.IMAGESR=o,n.DPI=Math.round(n.DPI?n.DPI*i:90*i);let d;if(a.length==1)d=a[0];else{const c=fs(ps(e),a.length);d=a[c]}const h=d.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage");return gs(h,n)}getTilePixelRatio(e){return this.hidpi_?e:1}updateParams(e){Object.assign(this.params_,e),this.setKey(this.getKeyForParams_())}tileUrlFunction(e,t,s){let i=this.getTileGrid();if(i||(i=this.getTileGridForProjection(s)),i.getResolutions().length<=e[0])return;t!=1&&!this.hidpi_&&(t=1);const r=i.getTileCoordExtent(e,this.tmpExtent_);let n=_s(i.getTileSize(e[0]),this.tmpSize);t!=1&&(n=ys(n,t,this.tmpSize));const a={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};return Object.assign(a,this.params_),this.getRequestUrl_(e,n,r,t,s,a)}}const Ki=Ui,Xi={Point:Ji,LineString:Qi,Polygon:nn,MultiPoint:tn,MultiLineString:en,MultiPolygon:sn},Zi={Point:rn,LineString:on,Polygon:an,MultiPoint:cn,MultiLineString:ln,MultiPolygon:dn};class Yi extends gi{constructor(e){e=e||{},super(),this.geometryName_=e.geometryName}readFeatureFromObject(e,t,s){const i=e,r=rt(i.geometry,t),n=new _e;if(this.geometryName_&&n.setGeometryName(this.geometryName_),n.setGeometry(r),i.attributes){n.setProperties(i.attributes,!0);const a=i.attributes[s];a!==void 0&&n.setId(a)}return n}readFeaturesFromObject(e,t){if(t=t||{},e.features){const s=e,i=[],r=s.features;for(let n=0,a=r.length;n<a;++n)i.push(this.readFeatureFromObject(r[n],t,e.objectIdFieldName));return i}return[this.readFeatureFromObject(e,t)]}readGeometryFromObject(e,t){return rt(e,t)}readProjectionFromObject(e){if(e.spatialReference&&e.spatialReference.wkid!==void 0){const s=e.spatialReference.wkid;return Je("EPSG:"+s)}return null}writeGeometryObject(e,t){return ot(e,this.adaptOptions(t))}writeFeatureObject(e,t){t=this.adaptOptions(t);const s={};if(!e.hasProperties())return s.attributes={},s;const i=e.getProperties(),r=e.getGeometry();if(r){s.geometry=ot(r,t);const n=t&&(t.dataProjection||t.featureProjection);n&&(s.geometry.spatialReference={wkid:Number(Je(n).getCode().split(":").pop())}),delete i[e.getGeometryName()]}return Ee(i)?s.attributes={}:s.attributes=i,s}writeFeaturesObject(e,t){t=this.adaptOptions(t);const s=[];for(let i=0,r=e.length;i<r;++i)s.push(this.writeFeatureObject(e[i],t));return{features:s}}}function rt(l,e){if(!l)return null;let t;if(typeof l.x=="number"&&typeof l.y=="number")t="Point";else if(l.points)t="MultiPoint";else if(l.paths)l.paths.length===1?t="LineString":t="MultiLineString";else if(l.rings){const i=l,r=re(i),n=qi(i.rings,r);n.length===1?(t="Polygon",l=Object.assign({},l,{rings:n[0]})):(t="MultiPolygon",l=Object.assign({},l,{rings:n}))}const s=Xi[t];return vt(s(l),!1,e)}function qi(l,e){const t=[],s=[],i=[];let r,n;for(r=0,n=l.length;r<n;++r)t.length=0,Cs(t,0,l[r],e.length),vs(t,0,t.length,e.length)?s.push([l[r]]):i.push(l[r]);for(;i.length;){const a=i.shift();let o=!1;for(r=s.length-1;r>=0;r--){const d=s[r][0];if(q(new Qe(d).getExtent(),new Qe(a).getExtent())){s[r].push(a),o=!0;break}}o||s.push([a.reverse()])}return s}function Ji(l){let e;return l.m!==void 0&&l.z!==void 0?e=new K([l.x,l.y,l.z,l.m],"XYZM"):l.z!==void 0?e=new K([l.x,l.y,l.z],"XYZ"):l.m!==void 0?e=new K([l.x,l.y,l.m],"XYM"):e=new K([l.x,l.y]),e}function Qi(l){const e=re(l);return new ws(l.paths[0],e)}function en(l){const e=re(l);return new bs(l.paths,e)}function re(l){let e="XY";return l.hasZ===!0&&l.hasM===!0?e="XYZM":l.hasZ===!0?e="XYZ":l.hasM===!0&&(e="XYM"),e}function tn(l){const e=re(l);return new Ls(l.points,e)}function sn(l){const e=re(l);return new xs(l.rings,e)}function nn(l){const e=re(l);return new wt(l.rings,e)}function rn(l,e){const t=l.getCoordinates();let s;const i=l.getLayout();return i==="XYZ"?s={x:t[0],y:t[1],z:t[2]}:i==="XYM"?s={x:t[0],y:t[1],m:t[2]}:i==="XYZM"?s={x:t[0],y:t[1],z:t[2],m:t[3]}:i==="XY"?s={x:t[0],y:t[1]}:ie(!1,34),s}function Ce(l){const e=l.getLayout();return{hasZ:e==="XYZ"||e==="XYZM",hasM:e==="XYM"||e==="XYZM"}}function on(l,e){const t=Ce(l);return{hasZ:t.hasZ,hasM:t.hasM,paths:[l.getCoordinates()]}}function an(l,e){const t=Ce(l);return{hasZ:t.hasZ,hasM:t.hasM,rings:l.getCoordinates(!1)}}function ln(l,e){const t=Ce(l);return{hasZ:t.hasZ,hasM:t.hasM,paths:l.getCoordinates()}}function cn(l,e){const t=Ce(l);return{hasZ:t.hasZ,hasM:t.hasM,points:l.getCoordinates()}}function dn(l,e){const t=Ce(l),s=l.getCoordinates(!1),i=[];for(let r=0;r<s.length;r++)for(let n=s[r].length-1;n>=0;n--)i.push(s[r][n]);return{hasZ:t.hasZ,hasM:t.hasM,rings:i}}function ot(l,e){const t=Zi[l.getType()];return t(vt(l,!0,e),e)}const at=Yi,pe={america:()=>new Ie({name:"america",className:"america",preload:1/0,source:new Ki({url:"https://sampleserver6.arcgisonline.com/ArcGIS/rest/services/USA/MapServer"})}),EsriJSON:()=>{const l="https://services8.arcgis.com/jz4Cju60Wi6R7jAW/arcgis/rest/services/RIVERPOLY_(1)/FeatureServer/0",e=new fe({fill:new Oe,stroke:new et({color:[0,38,115,1],width:.5})}),t=new $({format:new at,url:function(s,i,r){const n=r.getCode().split(/:(?=\d+$)/).pop();return l+"/query/?f=json&returnGeometry=true&spatialRel=esriSpatialRelIntersects&geometry="+encodeURIComponent(`{"xmin":${s[0]},"ymin":${s[1]},"xmax":${s[2]},"ymax":${s[3]},"spatialReference":{"wkid":${n}}}`)+"&geometryType=esriGeometryEnvelope&inSR="+n+"&outFields=*&outSR="+n},strategy:nt(tt({tileSize:512}))});return new W({name:"EsriJSON",source:t,style:function(s){const i=[0,38,115,1];return e.getFill().setColor(i),e},opacity:.7})},BsriJSON:()=>{const l="https://services8.arcgis.com/jz4Cju60Wi6R7jAW/arcgis/rest/services/河川支流/FeatureServer/0",e=new fe({fill:new Oe,stroke:new et({color:[0,0,0,1],width:.5})}),t=new $({format:new at,url:function(s,i,r){const n=r.getCode().split(/:(?=\d+$)/).pop();return l+"/query/?f=json&returnGeometry=true&spatialRel=esriSpatialRelIntersects&geometry="+encodeURIComponent(`{"xmin":${s[0]},"ymin":${s[1]},"xmax":${s[2]},"ymax":${s[3]},"spatialReference":{"wkid":${n}}}`)+"&geometryType=esriGeometryEnvelope&inSR="+n+"&outFields=*&outSR="+n},strategy:nt(tt({tileSize:512}))});return new W({name:"BsriJSON",type:"BsriJSON",source:t,style:function(s){const i=[0,0,0,1];return e.getFill().setColor(i),e},opacity:1})},DimensionMap:()=>{const l=new _e({name:"DimensionMap",title:"DimensionMap",geometry:new fi([120.9984423386347,24.791781619336316],.005)}),e=new fe({renderer(r,n){const[[a,o],[d,h]]=r,c=n.context,u=d-a,g=h-o,m=Math.sqrt(u*u+g*g);c.beginPath(),c.arc(a,o,m,0,2*Math.PI,!0),c.fillStyle="rgba(255,0,0)",c.fill()}}),t=new W({source:new $({features:[l]}),style:e}),s=[[120.971859,24.801583],[120.97,24.809583],[120.985,24.808583],[120.99,24.806583],[120.971859,24.801583]],i=new W({name:"DimensionMap",title:"DimensionMap",source:new $({features:[new _e({name:"areaLineLayer",title:"areaLineLayer",geometry:new wt([s])})]}),style:new fe({fill:new Oe({color:"#0f9ce2"})})});return[t,i]},getLayer:(l,e,t)=>{var a;let s,i,r=l.layer_type,n=l.figure_type;if(r==="WMS"){let o=[];const d=l.single_tiles?l.tiles_url:l.tiles_list[e].tile_url;switch(n){case"Point":if(d){const c=new URL(d),u=c.origin,g=c.pathname,m=c.searchParams,p={};for(const[C,y]of m.entries())p[C]=y;o[0]=u+g,o[1]=p}i=new he({maxzoom:18,minzoom:3,url:o[0],params:o[1],serverType:"mapserver",crossOrigin:"anonymous"});break;case"Surface":if(d){const c=new URL(d),u=c.origin,g=c.pathname,m=c.searchParams,p={};for(const[C,y]of m.entries())p[C]=y;o[0]=u+g,o[1]=p}i=new he({maxzoom:18,minzoom:3,url:o[0],params:o[1],serverType:"mapserver"});break;case"Line":if(d){const c=new URL(d),u=c.origin,g=c.pathname,m=c.searchParams,p={};for(const[C,y]of m.entries())p[C]=y;o[0]=u+g,o[1]=p}i=new he({maxzoom:18,minzoom:3,url:o[0],params:o[1],serverType:"mapserver"});break;default:console.log("otherWMSLayer",n)}let h=l.single_tiles?"":`- ${(a=l.tiles_list[e])==null?void 0:a.title}`;s=new Ie({id:t,label:`${l.title} ${h}`,source:new he({name:l.title,url:i.getUrls()[0],params:i.getParams(),serverType:"geoserver",crossOrigin:"anonymous"})})}if(r==="GeoJson")switch(console.log("GeoJsonLayer",n),n){case"Line":s=new W({source:new $({url:"http://gis.edtest.site:8010/ogc/temp",params:{SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetMap",FORMAT:"image/png",STYLE:"default",SLD_VERSION:"1.1.0"}})});break;case"Point":const o=new he({maxzoom:18,minzoom:3,url:"https://dwgis1.ncdr.nat.gov.tw/server/services/MAP0627/Map2022FloodingPoint1721/MapServer/WMSServer",params:{SERVICE:"WMS",BGCOLOR:"0xFFFFFF",TRANSPARENT:"TRUE",SRS:"EPSG:3826",LAYERS:"0",VERSION:"1.1.1",FORMAT:"image/png"},crossOrigin:"anonymous"});s=new Ie({source:o});break;default:console.log(n)}return s},getLayerIndex:l=>{let e,t,s;return l.split("_").forEach((i,r)=>{switch(r){case 0:e=Number(i.split("node")[1]);break;case 1:t=Number(i.split("subNode")[1]);break;case 2:s=i.split("nestedSubNode")[1]!=="undefined"?Number(i.split("nestedSubNode")[1]):"undefined";break}}),{nodeIndex:e,subNodeIndex:t,nestedSubNodeIndex:s,layeredIndex:l}}};const hn={props:{onClose:{type:Function,default:()=>{}},mapLayers:{type:Array,default:[]},currentLayers:{type:Array,default:[]},showSelectLayerValue:{type:Function,default:()=>{}}},setup(l,{emit:e}){const t=pe,s=Ft(),i=ne({DropDown:null,TilesListValue:0});function r(h,c){e("onMapControl",{action:h,value:c})}function n(h,c){e("onLayerControl",{action:h,value:c})}function a(h){i.DropDown!==h?i.DropDown=h:i.DropDown=null}function o(h,c){let u=h.target.checked||typeof h.target.checked>"u";n("layerMode",{checked:u,nodeIndex:c.nodeIndex,subNodeIndex:c.subNodeIndex,nestedSubNodeIndex:String(c.nestedSubNodeIndex)?c.nestedSubNodeIndex:void 0,nestedSubNode:!!String(c.nestedSubNodeIndex),id:c.id})}function d(h){let c=h.target.checked||typeof h.target.checked>"u";n("layerMode",{checked:c})}return Rt(()=>i.TilesListValue,(h,c)=>{l.showSelectLayerValue(h)}),{props:l,state:i,router:s,mapLayers:t,onMapControl:r,onLayerControl:n,openLayerList:a,LayerCheckBoxChange:o,checkTribe:d}}},je=l=>(Ve("data-v-db172b9e"),l=l(),$e(),l),un={class:"rounded-4 bg-white"},mn={class:"row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold border-bottom"},fn=je(()=>f("p",{class:"mb-0 fs-5"},"圖層選項",-1)),pn=je(()=>f("svg",{width:"32",height:"32",viewBox:"0 0 24 24"},[f("path",{fill:"currentColor",d:"M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10zm0-11.414L9.172 7.757L7.757 9.172L10.586 12l-2.829 2.828l1.415 1.415L12 13.414l2.828 2.829l1.415-1.415L13.414 12l2.829-2.828l-1.415-1.415L12 10.586z"})],-1)),gn=[pn],_n={class:"py-3 px-4 content"},yn={class:"mb-2 landBoundary"},Cn={class:"mb-2"},vn=["onClick"],wn=je(()=>f("path",{fill:"currentColor",d:"M8 5v14l11-7z"},null,-1)),bn=[wn],Ln={class:"ms-3 mb-1"},xn={key:0},Sn=["checked","onChange"],En={key:1},Rn=["checked","onChange"],Fn=["onChange"],Tn=["value"];function In(l,e,t,s,i,r){return L(),x("div",un,[f("div",mn,[fn,ee(" "+A(s.state.TilesListValue)+" ",1),f("a",{href:"",class:"closeBtn position-absolute col-auto",onClick:e[0]||(e[0]=T((...n)=>s.props.onClose&&s.props.onClose(...n),["prevent"]))},gn)]),f("div",_n,[f("div",yn,[f("div",{onClick:e[1]||(e[1]=n=>s.router.push({path:"/Map_Demo/detail"})),class:"my-3 fw-bold h5 text-primary cursor-pointer"},"前往地圖細節"),(L(!0),x(te,null,se(s.props.mapLayers,(n,a)=>(L(),x("div",Cn,[f("div",{class:"title d-flex align-items-center fw-bold text-black order-1 mb-1 text-decoration-none",onClick:o=>s.openLayerList(a)},[f("div",{class:B(n.groupClass)},null,2),f("div",null,A(n.label),1),(L(),x("svg",{viewBox:"0 0 24 24",class:B({openTitle:s.state.DropDown==a})},bn,2))],8,vn),s.state.DropDown==a?(L(!0),x(te,{key:0},se(n.layers,(o,d)=>(L(),x("div",Ln,[o.single_tiles?(L(),x("div",xn,[f("input",{type:"checkbox",checked:s.props.currentLayers.some(h=>h.id===o.id),onChange:h=>{s.LayerCheckBoxChange(h,{nodeIndex:a,subNode:o,subNodeIndex:d,nestedSubNodeIndex:"",id:o.id})}},null,40,Sn),ee(" "+A(o.title),1)])):(L(),x("div",En,[f("input",{type:"checkbox",checked:s.props.currentLayers.some(h=>h.id===o.id),onChange:h=>{s.LayerCheckBoxChange(h,{nodeIndex:a,subNode:o,subNodeIndex:d,nestedSubNodeIndex:"",id:o.id})}},null,40,Rn),ee(" "+A(o.title)+" ",1),dt(f("select",{name:"",id:"",class:"ms-3","onUpdate:modelValue":e[2]||(e[2]=h=>s.state.TilesListValue=h),onChange:h=>{s.LayerCheckBoxChange(h,{nodeIndex:a,subNode:o,subNodeIndex:d,nestedSubNodeIndex:s.state.TilesListValue,id:o.id})}},[(L(!0),x(te,null,se(o.tiles_list,(h,c)=>(L(),x("option",{value:c},A(h.title),9,Tn))),256))],40,Fn),[[ht,s.state.TilesListValue]])]))]))),256)):k("",!0)]))),256))])])])}const On=Z(hn,[["render",In],["__scopeId","data-v-db172b9e"]]),Mn="/Map_Demo/assets/zoomIn-d7961c14.svg",Pn="/Map_Demo/assets/zoomOut-dd9d0f3f.svg",An="/Map_Demo/assets/compass-235c0aa1.svg",kn="/Map_Demo/assets/location-cd504b9c.svg",Gn="/Map_Demo/assets/zoom-d9d9881c.svg",Nn={props:{id:{Type:String,default:0},map:{}},setup(l,{emit:e}){function t(s){e("onMapControl",{action:s})}return{onMapControl:t}}},Dn={class:"d-flex flex-nowrap flex-column"},Vn=f("img",{src:Mn,alt:"zoomIn"},null,-1),$n=[Vn],Bn=f("img",{src:Pn,alt:"zoomOut"},null,-1),jn=[Bn],Hn=f("img",{src:An,alt:"compass"},null,-1),zn=[Hn],Wn=f("img",{src:kn,alt:"location"},null,-1),Un=[Wn],Kn=f("img",{src:Gn,alt:"zoom"},null,-1),Xn=[Kn];function Zn(l,e,t,s,i,r){return L(),x("div",Dn,[f("a",{href:"",class:"asideTool-btn order-1 mb-0",onClick:e[0]||(e[0]=T(n=>s.onMapControl("In"),["prevent"]))},$n),f("a",{href:"",class:"asideTool-btn order-1 mb-2",onClick:e[1]||(e[1]=T(n=>s.onMapControl("Out"),["prevent"]))},jn),f("a",{href:"",class:"asideTool-btn order-1 mb-2",onClick:e[2]||(e[2]=T(n=>s.onMapControl("toNorth"),["prevent"]))},zn),f("a",{href:"",class:"asideTool-btn order-1 mb-2",onClick:e[3]||(e[3]=T(n=>s.onMapControl("moveTo"),["prevent"]))},Un),f("a",{href:"",class:"asideTool-btn order-1 mb-2",onClick:e[4]||(e[4]=T(n=>s.onMapControl("fullScreen"),["prevent"]))},Xn)])}const Yn=Z(Nn,[["render",Zn]]);const qn={props:{baseMapsOptions:{type:Array,default:[]},onChangeBaseMaps:{type:Function,default:()=>{}}},setup(l,{emit:e}){const t=ne({selectMap:l.baseMapsOptions[0]});function s(i){let r="baseMap",n={checked:!0,layerName:t.selectMap};e("onChangeBaseMaps",{action:r,value:n})}return{state:t,props:l,onChangeBaseMaps:s}}},Jn=["value"];function Qn(l,e,t,s,i,r){return L(),x("div",null,[dt(f("select",{name:"",id:"","onUpdate:modelValue":e[0]||(e[0]=n=>s.state.selectMap=n),onChange:e[1]||(e[1]=n=>{s.onChangeBaseMaps()})},[(L(!0),x(te,null,se(s.props.baseMapsOptions,(n,a)=>(L(),x("option",{value:n.name},A(n.label),9,Jn))),256))],544),[[ht,s.state.selectMap]])])}const er=Z(qn,[["render",Qn],["__scopeId","data-v-900622e9"]]),tr="/Map_Demo/assets/twoDimensional-5bf9d973.svg",sr="/Map_Demo/assets/threeDimensional-ddd85ad7.svg",ir="/Map_Demo/assets/baseLayer-c8f03bce.svg",Lt="/Map_Demo/assets/singleWindow-b535810b.svg",xt="/Map_Demo/assets/doubleWindows-27e0deda.svg";const nr={props:{currentLayers:{type:Array,default:[]},mapCount:{type:Number,default:1},dimensionMapStatus:{type:Boolean,default:!1}},setup(l,{emit:e}){const t=ne({toolSwitch:{threeDimensionalBtn:!1,layerConditionBtn:!1,splitWindowBtn:!1},targetNum:1});function s(a,o){Object.keys(t.toolSwitch).forEach(d=>{d===a?t.toolSwitch[a]?t.toolSwitch[a]=!1:t.toolSwitch[a]=!0:t.toolSwitch[d]=!1})}function i(a,o){a==="changeMapCount"&&(t.toolSwitch.splitWindowBtn=!1),e("onLayerControl",{action:a,value:o})}function r(){e("conditionWrap")}function n(a){t.targetNum=a,e("onChangeTarget",a)}return{props:l,state:t,toolSwitch:s,onLayerControl:i,conditionWrap:r,onChangeTarget:n}}},rr={class:"list-unstyled d-flex align-items-center flex-nowrap w-full"},or={class:"me-4 position-relative"},ar={class:"MapFeatureBtn text-white"},lr=f("img",{src:tr},null,-1),cr=[lr],dr=f("img",{src:sr},null,-1),hr=[dr],ur={class:"me-4 position-relative"},mr=f("img",{src:ir,alt:""},null,-1),fr=[mr],pr={class:"me-4 position-relative"},gr={key:0,src:Lt,alt:""},_r={key:1,src:xt,alt:""},yr={key:0,class:"list-unstyled position-absolute start-0 top-100 p-0"},Cr={class:"mt-2"},vr=f("img",{src:Lt,alt:""},null,-1),wr=[vr],br={class:"mt-2"},Lr=f("img",{src:xt,alt:""},null,-1),xr=[Lr],Sr={class:"switchControl d-flex position-fixed rounded-pill translate-middle-x p-2",id:"switchControl",style:{"z-index":"99"}};function Er(l,e,t,s,i,r){return L(),x("div",null,[f("ul",rr,[f("li",or,[f("div",ar,[s.props.dimensionMapStatus?(L(),x("a",{key:0,href:"",onClick:e[0]||(e[0]=T(n=>(s.toolSwitch("threeDimensionalBtn"),s.onLayerControl("changeDimensionMap","3D")),["prevent"]))},cr)):(L(),x("a",{key:1,href:"",onClick:e[1]||(e[1]=T(n=>(s.toolSwitch("threeDimensionalBtn"),s.onLayerControl("changeDimensionMap","2D")),["prevent"]))},hr))])]),f("li",ur,[f("a",{href:"",class:"MapFeatureBtn text-white",onClick:e[2]||(e[2]=T(n=>(s.toolSwitch("layerConditionBtn"),s.conditionWrap()),["prevent"]))},fr)]),f("li",pr,[f("a",{href:"",class:"MapFeatureBtn text-white",onClick:e[3]||(e[3]=T(n=>s.toolSwitch("splitWindowBtn"),["prevent"]))},[s.props.mapCount===1?(L(),x("img",gr)):k("",!0),s.props.mapCount===2?(L(),x("img",_r)):k("",!0)]),s.state.toolSwitch.splitWindowBtn?(L(),x("ul",yr,[f("li",Cr,[f("a",{href:"",class:"text-white MapFeatureBtn",onClick:e[4]||(e[4]=T(n=>s.onLayerControl("changeMapCount",1),["prevent"]))},wr)]),f("li",br,[f("a",{href:"",class:"text-white MapFeatureBtn",onClick:e[5]||(e[5]=T(n=>s.onLayerControl("changeMapCount",2),["prevent"]))},xr)])])):k("",!0)])]),f("div",Sr,[f("div",{class:B(["fs-3 text-white rounded-pill",{active:s.state.targetNum===1}]),onClick:e[6]||(e[6]=()=>{s.onChangeTarget(1)})},"左",2),f("div",{class:B(["fs-3 text-white rounded-pill",{active:s.state.targetNum===2}]),onClick:e[7]||(e[7]=()=>{s.onChangeTarget(2)})},"右",2)])])}const Rr=Z(nr,[["render",Er]]);class Fr{constructor(e){this.ol3d=e,this.scene_=e.getCesiumScene(),this.canvas_=this.scene_.canvas,this._boundNotifyRepaintRequired=this.notifyRepaintRequired.bind(this),this.repaintEventNames_=["mousemove","mousedown","mouseup","touchstart","touchend","touchmove","pointerdown","pointerup","pointermove","wheel"],this.enable()}enable(){this.scene_.requestRenderMode=!0,this.scene_.maximumRenderTimeChange=1e3;for(const e of this.repaintEventNames_)this.canvas_.addEventListener(e,this._boundNotifyRepaintRequired,!1);window.addEventListener("resize",this._boundNotifyRepaintRequired,!1),this.ol3d.getOlMap().getLayerGroup().on("change",this._boundNotifyRepaintRequired)}disable(){for(const e of this.repaintEventNames_)this.canvas_.removeEventListener(e,this._boundNotifyRepaintRequired,!1);window.removeEventListener("resize",this._boundNotifyRepaintRequired,!1),this.ol3d.getOlMap().getLayerGroup().un("change",this._boundNotifyRepaintRequired),this.scene_.requestRenderMode=!1}restartRenderLoop(){this.notifyRepaintRequired()}notifyRepaintRequired(){this.scene_.requestRender()}}function Le(l){return l*180/Math.PI}function me(l){return l*Math.PI/180}class Q{constructor(e,t){this.scene_=e,this.cam_=e.camera,this.map_=t,this.view_=null,this.viewListenKey_=null,this.toLonLat_=Q.identityProjection,this.fromLonLat_=Q.identityProjection,this.tilt_=0,this.distance_=0,this.lastCameraViewMatrix_=null,this.viewUpdateInProgress_=!1,this.map_.on("change:view",s=>{this.setView_(this.map_.getView())}),this.setView_(this.map_.getView())}static identityProjection(e,t,s){const i=s||e.length;if(t)for(let r=0;r<i;++r)t[r]=e[r];return e}setView_(e){if(this.view_&&(z(this.viewListenKey_),this.viewListenKey_=null),this.view_=e,e){const t=Ge(e.getProjection(),"EPSG:4326"),s=Ge("EPSG:4326",e.getProjection());console.assert(t&&s),this.toLonLat_=t,this.fromLonLat_=s,this.viewListenKey_=e.on("propertychange",i=>this.handleViewEvent_(i)),this.readFromView()}else this.toLonLat_=Q.identityProjection,this.fromLonLat_=Q.identityProjection}handleViewEvent_(e){this.viewUpdateInProgress_||this.readFromView()}setHeading(e){this.view_&&this.view_.setRotation(e)}getHeading(){return this.view_?this.view_.getRotation()||0:void 0}setTilt(e){this.tilt_=e,this.updateCamera_()}getTilt(){return this.tilt_}setDistance(e){this.distance_=e,this.updateCamera_(),this.updateView()}getDistance(){return this.distance_}setCenter(e){this.view_&&this.view_.setCenter(e)}getCenter(){if(this.view_)return this.view_.getCenter()}setPosition(e){if(!this.toLonLat_)return;const t=this.toLonLat_(e);console.assert(t);const s=new Cesium.Cartographic(me(t[0]),me(t[1]),this.getAltitude());this.cam_.setView({destination:Cesium.Ellipsoid.WGS84.cartographicToCartesian(s)}),this.updateView()}getPosition(){if(!this.fromLonLat_)return;const e=Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position),t=this.fromLonLat_([Le(e.longitude),Le(e.latitude)]);return console.assert(t),t}setAltitude(e){const t=Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position);t.height=e,this.cam_.position=Cesium.Ellipsoid.WGS84.cartographicToCartesian(t),this.updateView()}getAltitude(){return Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position).height}updateCamera_(){if(!this.view_||!this.toLonLat_)return;const e=this.view_.getCenter();if(!e)return;const t=this.toLonLat_(e);console.assert(t);const s=new Cesium.Cartographic(me(t[0]),me(t[1]));if(this.scene_.globe){const n=this.scene_.globe.getHeight(s);s.height=n||0}const i=Cesium.Ellipsoid.WGS84.cartographicToCartesian(s),r={pitch:this.tilt_-Cesium.Math.PI_OVER_TWO,heading:-this.view_.getRotation(),roll:void 0};this.cam_.setView({destination:i,orientation:r}),this.cam_.moveBackward(this.distance_),this.checkCameraChange(!0)}readFromView(){if(!this.view_||!this.toLonLat_)return;const e=this.view_.getCenter();if(e==null)return;const t=this.toLonLat_(e);console.assert(t);const s=this.view_.getResolution();this.distance_=this.calcDistanceForResolution(s||0,me(t[1])),this.updateCamera_()}updateView(){if(!this.view_||!this.fromLonLat_)return;this.viewUpdateInProgress_=!0;const e=Cesium.Ellipsoid.WGS84,t=this.scene_,s=M.pickCenterPoint(t);let i=s;if(!i){const n=t.globe,a=this.cam_.positionCartographic.clone(),o=n.getHeight(a);a.height=o||0,i=Cesium.Ellipsoid.WGS84.cartographicToCartesian(a)}this.distance_=Cesium.Cartesian3.distance(i,this.cam_.position);const r=e.cartesianToCartographic(i);if(this.view_.setCenter(this.fromLonLat_([Le(r.longitude),Le(r.latitude)])),this.view_.setResolution(this.calcResolutionForDistance(this.distance_,r?r.latitude:0)),s){const n=this.cam_.position,a=new Cesium.Cartesian3;e.geocentricSurfaceNormal(s,a);const o=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(n,s,o),Cesium.Cartesian3.normalize(o,o);const d=this.cam_.up,h=this.cam_.right,c=new Cesium.Cartesian3(-s.y,s.x,0),u=Cesium.Cartesian3.angleBetween(h,c),m=Cesium.Cartesian3.cross(s,d,new Cesium.Cartesian3).z;this.view_.setRotation(m<0?u:-u);const p=Math.acos(Cesium.Cartesian3.dot(a,o));this.tilt_=isNaN(p)?0:p}else this.view_.setRotation(this.cam_.heading),this.tilt_=-this.cam_.pitch+Math.PI/2;this.viewUpdateInProgress_=!1}checkCameraChange(e){const t=this.lastCameraViewMatrix_,s=this.cam_.viewMatrix;(!t||!Cesium.Matrix4.equalsEpsilon(t,s,1e-5))&&(this.lastCameraViewMatrix_=s.clone(),e!==!0&&this.updateView())}calcDistanceForResolution(e,t){return Ss(e,t,this.scene_,this.view_.getProjection())}calcResolutionForDistance(e,t){return Es(e,t,this.scene_,this.view_.getProjection())}}class St{constructor(e,t){this.map=e,this.view=e.getView(),this.scene=t,this.olLayers=e.getLayerGroup().getLayers(),this.mapLayerGroup=e.getLayerGroup(),this.layerMap={},this.olLayerListenKeys={},this.olGroupListenKeys_={}}synchronize(){this.destroyAll(),this.addLayers_(this.mapLayerGroup)}orderLayers(){}addLayers_(e){const t=[{layer:e,parents:[]}];for(;t.length>0;){const s=t.splice(0,1)[0],i=s.layer,r=I(i).toString();this.olLayerListenKeys[r]=[],console.assert(!this.layerMap[r]);let n=null;if(i instanceof Ne)this.listenForGroupChanges_(i),i!==this.mapLayerGroup&&(n=this.createSingleLayerCounterparts(s)),n||i.getLayers().forEach(a=>{if(a){const o={layer:a,parents:i===this.mapLayerGroup?[]:[s.layer].concat(s.parents)};t.push(o)}});else if(n=this.createSingleLayerCounterparts(s),!n){const a=r,o=s,d=h=>{const c=this.createSingleLayerCounterparts(o);c&&(o.layer.un("change",d),this.addCesiumObjects_(c,a,o.layer),this.orderLayers())};this.olLayerListenKeys[r].push(J(o.layer,"change",d))}n&&this.addCesiumObjects_(n,r,i)}this.orderLayers()}addCesiumObjects_(e,t,s){this.layerMap[t]=e,this.olLayerListenKeys[t].push(J(s,"change:zIndex",()=>this.orderLayers())),e.forEach(i=>{this.addCesiumObject(i)})}removeAndDestroySingleLayer_(e){const t=I(e).toString(),s=this.layerMap[t];return s&&(s.forEach(i=>{this.removeSingleCesiumObject(i,!1),this.destroyCesiumObject(i)}),this.olLayerListenKeys[t].forEach(z),delete this.olLayerListenKeys[t]),delete this.layerMap[t],!!s}unlistenSingleGroup_(e){if(e===this.mapLayerGroup)return;const t=I(e).toString();this.olGroupListenKeys_[t].forEach(i=>{z(i)}),delete this.olGroupListenKeys_[t],delete this.layerMap[t]}removeLayer_(e){if(e){const t=[e];for(;t.length>0;){const s=t.splice(0,1)[0],i=this.removeAndDestroySingleLayer_(s);s instanceof Ne&&(this.unlistenSingleGroup_(s),i||s.getLayers().forEach(r=>{t.push(r)}))}}}listenForGroupChanges_(e){const t=I(e).toString();console.assert(this.olGroupListenKeys_[t]===void 0);const s=[];this.olGroupListenKeys_[t]=s;let i=[];const r=function(){const n=e.getLayers();n&&(i=[n.on("add",a=>{this.addLayers_(a.element)}),n.on("remove",a=>{this.removeLayer_(a.element)})],s.push(...i))}.bind(this);r(),s.push(e.on("change:layers",n=>{i.forEach(a=>{const o=s.indexOf(a);o>=0&&s.splice(o,1),z(a)}),r()}))}destroyAll(){this.removeAllCesiumObjects(!0);let e;for(e in this.olGroupListenKeys_)this.olGroupListenKeys_[e].forEach(z);for(e in this.olLayerListenKeys)this.olLayerListenKeys[e].forEach(z);this.olGroupListenKeys_={},this.olLayerListenKeys={},this.layerMap={}}addCesiumObject(e){}destroyCesiumObject(e){}removeSingleCesiumObject(e,t){}removeAllCesiumObjects(e){}createSingleLayerCounterparts(e){}}class Tr extends St{constructor(e,t){super(e,t),this.cesiumLayers_=t.imageryLayers,this.ourLayers_=new Cesium.ImageryLayerCollection}addCesiumObject(e){this.cesiumLayers_.add(e),this.ourLayers_.add(e)}destroyCesiumObject(e){e.destroy()}removeSingleCesiumObject(e,t){this.cesiumLayers_.remove(e,t),this.ourLayers_.remove(e,!1)}removeAllCesiumObjects(e){for(let t=0;t<this.ourLayers_.length;++t)this.cesiumLayers_.remove(this.ourLayers_.get(t),e);this.ourLayers_.removeAll(!1)}convertLayerToCesiumImageries(e,t){const s=M.tileLayerToImageryLayer(this.map,e,t);return s?[s]:null}createSingleLayerCounterparts(e){const t=e.layer,s=I(t).toString(),i=this.view.getProjection();console.assert(i);const r=this.convertLayerToCesiumImageries(t,i);if(r){const n=[];if([e.layer].concat(e.parents).forEach(a=>{n.push(a.on(["change:opacity","change:visible"],()=>{console.assert(r);for(let o=0;o<r.length;++o)M.updateCesiumLayerProperties(e,r[o])}))}),t.getStyleFunction){let a=t.getStyleFunction();n.push(t.on("change",()=>{const o=t.getStyleFunction();if(a!==o){a=o;for(let d=0;d<r.length;++d){const h=r[d];h._imageryCache&&h.imageryProvider.cache_&&(h._imageryCache={},h.imageryProvider.cache_={},h.imageryProvider.styleFunction_=o)}this.scene.requestRender()}}))}for(let a=0;a<r.length;++a)M.updateCesiumLayerProperties(e,r[a]);n.push(t.on("change:extent",a=>{for(let o=0;o<r.length;++o)this.cesiumLayers_.remove(r[o],!0),this.ourLayers_.remove(r[o],!1);delete this.layerMap[I(t)],this.synchronize()})),n.push(t.on("change",a=>{for(let o=0;o<r.length;++o){const d=this.cesiumLayers_.indexOf(r[o]);d>=0&&(this.cesiumLayers_.remove(r[o],!1),this.cesiumLayers_.add(r[o],d))}})),this.olLayerListenKeys[s].push(...n)}return Array.isArray(r)?r:null}orderLayers(){const e=[],t={},s=[this.mapLayerGroup];for(;s.length>0;){const i=s.splice(0,1)[0];if(e.push(i),t[I(i)]=i.getZIndex()||0,i instanceof Ne){const r=i.getLayers();r&&s.unshift(...r.getArray())}}Rs(e,(i,r)=>t[I(i)]-t[I(r)]),e.forEach(i=>{const r=I(i).toString(),n=this.layerMap[r];n&&n.forEach(a=>{this.raiseToTop(a)})})}raiseToTop(e){this.cesiumLayers_.raiseToTop(e)}}class Ir{constructor(e,t){const s=new Cesium.BillboardCollection({scene:t}),i=new Cesium.PrimitiveCollection;this.olListenKeys=[],this.rootCollection_=new Cesium.PrimitiveCollection,this.context={projection:e,billboards:s,featureToCesiumMap:{},primitives:i},this.rootCollection_.add(s),this.rootCollection_.add(i)}destroy(){this.olListenKeys.forEach(z),this.olListenKeys.length=0}getRootPrimitive(){return this.rootCollection_}}class Or{constructor(e){this.scene=e,this.boundOnRemoveOrClearFeatureListener_=this.onRemoveOrClearFeature_.bind(this),this.defaultBillboardEyeOffset_=new Cesium.Cartesian3(0,0,10)}onRemoveOrClearFeature_(e){const t=e.target;console.assert(t instanceof $);const s=X.obj(t).olcs_cancellers;if(s){const i=e.feature;if(i){const r=I(i),n=s[r];n&&(n(),delete s[r])}else{for(const r in s)s.hasOwnProperty(r)&&s[r]();X.obj(t).olcs_cancellers={}}}}setReferenceForPicking(e,t,s){s.olLayer=e,s.olFeature=t}createColoredPrimitive(e,t,s,i,r,n){const a=function(u,g){const m=new Cesium.GeometryInstance({geometry:u});return g&&!(g instanceof Cesium.ImageMaterialProperty)&&(m.attributes={color:Cesium.ColorGeometryInstanceAttribute.fromColor(g)}),m},o={flat:!0,renderState:{depthTest:{enabled:!0}}};n!==void 0&&(o.renderState||(o.renderState={}),o.renderState.lineWidth=n);const d=a(i,r),h=this.getHeightReference(e,t,s);let c;if(h===Cesium.HeightReference.CLAMP_TO_GROUND){const u=d.geometry.constructor;if(u&&!u.createShadowVolume)return null;c=new Cesium.GroundPrimitive({geometryInstances:d})}else c=new Cesium.Primitive({geometryInstances:d});if(r instanceof Cesium.ImageMaterialProperty){const u=r.image.getValue().toDataURL();c.appearance=new Cesium.MaterialAppearance({flat:!0,renderState:{depthTest:{enabled:!0}},material:new Cesium.Material({fabric:{type:"Image",uniforms:{image:u}}})})}else c.appearance=new Cesium.PerInstanceColorAppearance(o);return this.setReferenceForPicking(e,t,c),c}extractColorFromOlStyle(e,t){const s=e.getFill()?e.getFill().getColor():null,i=e.getStroke()?e.getStroke().getColor():null;let r="black";return i&&t?r=i:s&&(r=s),M.convertColorToCesium(r)}extractLineWidthFromOlStyle(e){const t=e.getStroke()?e.getStroke().getWidth():void 0;return t!==void 0?t:1}wrapFillAndOutlineGeometries(e,t,s,i,r,n){const a=this.extractColorFromOlStyle(n,!1),o=this.extractColorFromOlStyle(n,!0),d=new Cesium.PrimitiveCollection;if(n.getFill()){const h=this.createColoredPrimitive(e,t,s,i,a);console.assert(!!h),d.add(h)}if(n.getStroke()&&r){const h=this.extractLineWidthFromOlStyle(n),c=this.createColoredPrimitive(e,t,s,r,o,h);c&&d.add(c)}return d}addTextStyle(e,t,s,i,r){let n;if(r instanceof Cesium.PrimitiveCollection?n=r:(n=new Cesium.PrimitiveCollection,n.add(r)),!i.getText())return n;const a=i.getText(),o=this.olGeometry4326TextPartToCesium(e,t,s,a);return o&&n.add(o),n}csAddBillboard(e,t,s,i,r,n){t.eyeOffset||(t.eyeOffset=this.defaultBillboardEyeOffset_);const a=e.add(t);return this.setReferenceForPicking(s,i,a),a}olCircleGeometryToCesium(e,t,s,i,r){s=M.olGeometryCloneTo4326(s,i),console.assert(s.getType()=="Circle");let n=s.getCenter();const a=n.length==3?n[2]:0;let o=n.slice();o[0]+=s.getRadius(),n=M.ol4326CoordinateToCesiumCartesian(n),o=M.ol4326CoordinateToCesiumCartesian(o);const d=Cesium.Cartesian3.distance(n,o),h=new Cesium.CircleGeometry({center:n,radius:d,height:a});let c,u;if(this.getHeightReference(e,t,s)===Cesium.HeightReference.CLAMP_TO_GROUND){const m=this.extractLineWidthFromOlStyle(r);if(m){const p=Fs(s.getCenter(),d),C=M.ol4326CoordinateArrayToCsCartesians(p.getLinearRing(0).getCoordinates());if(Me(this.scene))c=new Cesium.GroundPolylinePrimitive({geometryInstances:new Cesium.GeometryInstance({geometry:new Cesium.GroundPolylineGeometry({positions:C,width:m})}),appearance:new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(t,r,!0)}),classificationType:Cesium.ClassificationType.TERRAIN}),c.readyPromise.then(()=>{this.setReferenceForPicking(e,t,c._primitive)});else{const y=this.extractColorFromOlStyle(r,!0);c=this.createStackedGroundCorridors(e,t,m,y,C)}}}else u=new Cesium.CircleOutlineGeometry({center:n,radius:d,extrudedHeight:a,height:a});const g=this.wrapFillAndOutlineGeometries(e,t,s,h,u,r);return c&&g.add(c),this.addTextStyle(e,t,s,r,g)}createStackedGroundCorridors(e,t,s,i,r){Array.isArray(r[0])||(r=[r]),s=Math.max(3,s);const n=[];let a=0;for(const o of[1e3,4e3,16e3,64e3,254e3,1e6,1e7]){s*=2.14;const d={width:s,vertexFormat:Cesium.VertexFormat.POSITION_ONLY};for(const h of r)d.positions=h,n.push(new Cesium.GeometryInstance({geometry:new Cesium.CorridorGeometry(d),attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(i),distanceDisplayCondition:new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(a,o-1)}}));a=o}return new Cesium.GroundPrimitive({geometryInstances:n})}olLineStringGeometryToCesium(e,t,s,i,r){s=M.olGeometryCloneTo4326(s,i),console.assert(s.getType()=="LineString");const n=M.ol4326CoordinateArrayToCsCartesians(s.getCoordinates()),a=this.extractLineWidthFromOlStyle(r);let o;const d=this.getHeightReference(e,t,s);if(d===Cesium.HeightReference.CLAMP_TO_GROUND&&!Me(this.scene)){const h=this.extractColorFromOlStyle(r,!0);o=this.createStackedGroundCorridors(e,t,a,h,n)}else{const h=new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(t,r,!0)}),c={positions:n,width:a},u={appearance:h};if(d===Cesium.HeightReference.CLAMP_TO_GROUND){const g=new Cesium.GroundPolylineGeometry(c);u.geometryInstances=new Cesium.GeometryInstance({geometry:g}),o=new Cesium.GroundPolylinePrimitive(u),o.readyPromise.then(()=>{this.setReferenceForPicking(e,t,o._primitive)})}else{c.vertexFormat=h.vertexFormat;const g=new Cesium.PolylineGeometry(c);u.geometryInstances=new Cesium.GeometryInstance({geometry:g}),o=new Cesium.Primitive(u)}}return this.setReferenceForPicking(e,t,o),this.addTextStyle(e,t,s,r,o)}olPolygonGeometryToCesium(e,t,s,i,r){s=M.olGeometryCloneTo4326(s,i),console.assert(s.getType()=="Polygon");const n=this.getHeightReference(e,t,s);let a,o,d;if(s.getCoordinates()[0].length==5&&t.getGeometry().get("olcs.polygon_kind")==="rectangle"){const c=s.getCoordinates()[0],u=Ts(c),g=Cesium.Rectangle.fromDegrees(u[0],u[1],u[2],u[3]);let m=0;if(c[0].length==3)for(let p=0;p<c.length;p++)m=Math.max(m,c[p][2]);a=new Cesium.RectangleGeometry({ellipsoid:Cesium.Ellipsoid.WGS84,rectangle:g,height:m}),o=new Cesium.RectangleOutlineGeometry({ellipsoid:Cesium.Ellipsoid.WGS84,rectangle:g,height:m})}else{const c=s.getLinearRings(),u={},g=u;console.assert(c.length>0);for(let m=0;m<c.length;++m){const p=c[m].getCoordinates(),C=M.ol4326CoordinateArrayToCsCartesians(p);console.assert(C&&C.length>0),m==0?u.positions=C:(u.holes||(u.holes=[]),u.holes.push({positions:C}))}if(a=new Cesium.PolygonGeometry({polygonHierarchy:g,perPositionHeight:!0}),n===Cesium.HeightReference.CLAMP_TO_GROUND){const m=this.extractLineWidthFromOlStyle(r);if(m>0){const p=[u.positions];if(u.holes)for(let C=0;C<u.holes.length;++C)p.push(u.holes[C].positions);if(Me(this.scene)){const C=new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(t,r,!0)}),y=[];for(const w of p){const v=new Cesium.GroundPolylineGeometry({positions:w,width:m});y.push(new Cesium.GeometryInstance({geometry:v}))}const _={appearance:C,geometryInstances:y};d=new Cesium.GroundPolylinePrimitive(_),d.readyPromise.then(()=>{this.setReferenceForPicking(e,t,d._primitive)})}else{const C=this.extractColorFromOlStyle(r,!0);d=this.createStackedGroundCorridors(e,t,m,C,p)}}}else o=new Cesium.PolygonOutlineGeometry({polygonHierarchy:u,perPositionHeight:!0})}const h=this.wrapFillAndOutlineGeometries(e,t,s,a,o,r);return d&&h.add(d),this.addTextStyle(e,t,s,r,h)}getHeightReference(e,t,s){let i=s.get("altitudeMode");i===void 0&&(i=t.get("altitudeMode")),i===void 0&&(i=e.get("altitudeMode"));let r=Cesium.HeightReference.NONE;return i==="clampToGround"?r=Cesium.HeightReference.CLAMP_TO_GROUND:i==="relativeToGround"&&(r=Cesium.HeightReference.RELATIVE_TO_GROUND),r}createBillboardFromImage(e,t,s,i,r,n,a,o){n instanceof De&&n.load();const d=n.getImage(1),h=function(u){return u.src!=""&&u.naturalHeight!=0&&u.naturalWidth!=0&&u.complete},c=function(){if(!d||!(d instanceof HTMLCanvasElement||d instanceof Image||d instanceof HTMLImageElement))return;const u=s.getCoordinates(),g=M.ol4326CoordinateToCesiumCartesian(u);let m;const p=n.getOpacity();p!==void 0&&(m=new Cesium.Color(1,1,1,p));const C=n.getScale(),y=this.getHeightReference(e,t,s),_={image:d,color:m,scale:C,heightReference:y,position:g};if(Object.assign(_,t.get("cesiumOptions")),n instanceof De){const v=n.getAnchor();v&&(_.pixelOffset=new Cesium.Cartesian2((d.width/2-v[0])*C,(d.height/2-v[1])*C))}const w=this.csAddBillboard(a,_,e,t,s,r);o&&o(w)}.bind(this);if(d instanceof Image&&!h(d)){let u=!1;const g=e.getSource(),m=function(){u=!0};g.on(["removefeature","clear"],this.boundOnRemoveOrClearFeatureListener_);let p=X.obj(g).olcs_cancellers;p||(p=X.obj(g).olcs_cancellers={});const C=I(t);p[C]&&p[C](),p[C]=m;const y=function(){d.removeEventListener("load",y),!a.isDestroyed()&&!u&&c()};d.addEventListener("load",y)}else c()}olPointGeometryToCesium(e,t,s,i,r,n,a){console.assert(s.getType()=="Point"),s=M.olGeometryCloneTo4326(s,i);let o=null;const d=r.getImage();if(d){const h=s.get("olcs_model")||t.get("olcs_model");if(h){const c=h(),u=Object.assign({},{scene:this.scene},c.cesiumOptions),g=Cesium.Model.fromGltf(u);o=new Cesium.PrimitiveCollection,o.add(g),c.debugModelMatrix&&o.add(new Cesium.DebugModelMatrixPrimitive({modelMatrix:c.debugModelMatrix}))}else this.createBillboardFromImage(e,t,s,i,r,d,n,a)}return r.getText()?this.addTextStyle(e,t,s,r,o||new Cesium.Primitive):o}olMultiGeometryToCesium(e,t,s,i,r,n,a){const o=function(h,c){const u=new Cesium.PrimitiveCollection;return h.forEach(g=>{u.add(c(e,t,g,i,r))}),u};let d;switch(s.getType()){case"MultiPoint":if(s=s,d=s.getPoints(),r.getText()){const h=new Cesium.PrimitiveCollection;return d.forEach(c=>{console.assert(c);const u=this.olPointGeometryToCesium(e,t,c,i,r,n,a);u&&h.add(u)}),h}else return d.forEach(h=>{console.assert(h),this.olPointGeometryToCesium(e,t,h,i,r,n,a)}),null;case"MultiLineString":return s=s,d=s.getLineStrings(),o(d,this.olLineStringGeometryToCesium.bind(this));case"MultiPolygon":return s=s,d=s.getPolygons(),o(d,this.olPolygonGeometryToCesium.bind(this));default:console.assert(!1,`Unhandled multi geometry type${s.getType()}`)}}olGeometry4326TextPartToCesium(e,t,s,i){const r=i.getText();if(!r)return null;const n=new Cesium.LabelCollection({scene:this.scene}),a=Ct(s.getExtent());if(s instanceof yt){const m=s.getFirstCoordinate();a[2]=m.length==3?m[2]:0}const o={};o.position=M.ol4326CoordinateToCesiumCartesian(a),o.text=r,o.heightReference=this.getHeightReference(e,t,s);const d=i.getOffsetX(),h=i.getOffsetY();if(d!=0&&h!=0){const m=new Cesium.Cartesian2(d,h);o.pixelOffset=m}o.font=i.getFont()||"10px sans-serif";let c;i.getFill()&&(o.fillColor=this.extractColorFromOlStyle(i,!1),c=Cesium.LabelStyle.FILL),i.getStroke()&&(o.outlineWidth=this.extractLineWidthFromOlStyle(i),o.outlineColor=this.extractColorFromOlStyle(i,!0),c=Cesium.LabelStyle.OUTLINE),i.getFill()&&i.getStroke()&&(c=Cesium.LabelStyle.FILL_AND_OUTLINE),o.style=c;let u;switch(i.getTextAlign()){case"left":u=Cesium.HorizontalOrigin.LEFT;break;case"right":u=Cesium.HorizontalOrigin.RIGHT;break;case"center":default:u=Cesium.HorizontalOrigin.CENTER}if(o.horizontalOrigin=u,i.getTextBaseline()){let m;switch(i.getTextBaseline()){case"top":m=Cesium.VerticalOrigin.TOP;break;case"middle":m=Cesium.VerticalOrigin.CENTER;break;case"bottom":m=Cesium.VerticalOrigin.BOTTOM;break;case"alphabetic":m=Cesium.VerticalOrigin.TOP;break;case"hanging":m=Cesium.VerticalOrigin.BOTTOM;break;default:console.assert(!1,`unhandled baseline ${i.getTextBaseline()}`)}o.verticalOrigin=m}const g=n.add(o);return this.setReferenceForPicking(e,t,g),n}olStyleToCesium(e,t,s){const i=t.getFill(),r=t.getStroke();if(s&&!r||!s&&!i)return null;let n=s?r.getColor():i.getColor();return n=M.convertColorToCesium(n),s&&r.getLineDash()?Cesium.Material.fromType("Stripe",{horizontal:!1,repeat:500,evenColor:n,oddColor:new Cesium.Color(0,0,0,0)}):Cesium.Material.fromType("Color",{color:n})}computePlainStyle(e,t,s,i){const r=t.getStyleFunction();let n=null;return r&&(n=r(t,i)),!n&&s&&(n=s(t,i)),n?Array.isArray(n)?n:[n]:null}getGeometryFromFeature(e,t,s){if(s)return s;const i=e.get("olcs.3d_geometry");if(i&&i instanceof st)return i;if(t){const r=t.getGeometryFunction()(e);if(r instanceof st)return r}return e.getGeometry()}olFeatureToCesium(e,t,s,i,r){let n=this.getGeometryFromFeature(t,s,r);if(!n)return null;const a=i.projection,o=function(d){const h=i.featureToCesiumMap[I(t)];h instanceof Array?h.push(d):i.featureToCesiumMap[I(t)]=[d]};switch(n.getType()){case"GeometryCollection":const d=new Cesium.PrimitiveCollection;return n.getGeometries().forEach(m=>{if(m){const p=this.olFeatureToCesium(e,t,s,i,m);p&&d.add(p)}}),d;case"Point":n=n;const c=i.billboards,u=this.olPointGeometryToCesium(e,t,n,a,s,c,o);return u||null;case"Circle":return n=n,this.olCircleGeometryToCesium(e,t,n,a,s);case"LineString":return n=n,this.olLineStringGeometryToCesium(e,t,n,a,s);case"Polygon":return n=n,this.olPolygonGeometryToCesium(e,t,n,a,s);case"MultiPoint":case"MultiLineString":case"MultiPolygon":const g=this.olMultiGeometryToCesium(e,t,n,a,s,i.billboards,o);return g||null;case"LinearRing":throw new Error("LinearRing should only be part of polygon.");default:throw new Error(`Ol geom type not handled : ${n.getType()}`)}}olVectorLayerToCesium(e,t,s){const i=t.getProjection(),r=t.getResolution();if(r===void 0||!i)throw console.assert(!1,"View not ready"),new Error("View not ready");let n=e.getSource();n instanceof bt&&(n=n.getSource()),console.assert(n instanceof $);const a=n.getFeatures(),o=new Ir(i,this.scene),d=o.context;for(let h=0;h<a.length;++h){const c=a[h];if(!c)continue;const u=e.getStyleFunction(),g=this.computePlainStyle(e,c,u,r);if(!g||!g.length)continue;let m=null;for(let p=0;p<g.length;p++){const C=this.olFeatureToCesium(e,c,g[p],d);if(C){if(!m)m=C;else if(C){let y=0,_;for(;_=C.get(y);)m.add(_),y++}}}m&&(s[I(c)]=m,o.getRootPrimitive().add(m))}return o}convert(e,t,s,i){const r=t.getProjection(),n=t.getResolution();if(n==null||!r)return null;const a=e.getStyleFunction(),o=this.computePlainStyle(e,s,a,n);if(!o||!o.length)return null;i.projection=r;let d=null;for(let h=0;h<o.length;h++){const c=this.olFeatureToCesium(e,s,o[h],i);if(!d)d=c;else if(c){let u=0,g;for(;g=c.get(u);)d.add(g),u++}}return d}}class Mr extends St{constructor(e,t,s){super(e,t),this.converter=s||new Or(t),this.csAllPrimitives_=new Cesium.PrimitiveCollection,t.primitives.add(this.csAllPrimitives_),this.csAllPrimitives_.destroyPrimitives=!1}addCesiumObject(e){console.assert(e),e.getRootPrimitive().counterpart=e,this.csAllPrimitives_.add(e.getRootPrimitive())}destroyCesiumObject(e){e.getRootPrimitive().destroy()}removeSingleCesiumObject(e,t){e.destroy(),this.csAllPrimitives_.destroyPrimitives=t,this.csAllPrimitives_.remove(e.getRootPrimitive()),this.csAllPrimitives_.destroyPrimitives=!1}removeAllCesiumObjects(e){if(this.csAllPrimitives_.destroyPrimitives=e,e)for(let t=0;t<this.csAllPrimitives_.length;++t)this.csAllPrimitives_.get(t).counterpart.destroy();this.csAllPrimitives_.removeAll(),this.csAllPrimitives_.destroyPrimitives=!1}updateLayerVisibility(e,t){let s=!0;[e.layer].concat(e.parents).forEach(i=>{const r=i.getVisible();r!==void 0?s&=r:s=!1}),t.show=s}createSingleLayerCounterparts(e){const t=e.layer;if(!(t instanceof W)||t instanceof Is)return null;console.assert(t instanceof Os);let s=t.getSource();if(s instanceof bt&&(s=s.getSource()),!s)return null;console.assert(s instanceof $),console.assert(this.view);const i=this.view,r={},n=this.converter.olVectorLayerToCesium(t,i,r),a=n.getRootPrimitive(),o=n.olListenKeys;[e.layer].concat(e.parents).forEach(c=>{o.push(J(c,"change:visible",()=>{this.updateLayerVisibility(e,a)}))}),this.updateLayerVisibility(e,a);const d=function(c){console.assert(t instanceof W||t instanceof Ms);const u=n.context,g=this.converter.convert(t,i,c,u);g&&(r[I(c)]=g,a.add(g))}.bind(this),h=function(c){const u=I(c),g=n.context,m=g.featureToCesiumMap[u];m&&(delete g.featureToCesiumMap[u],m.forEach(C=>{C instanceof Cesium.Billboard&&g.billboards.remove(C)}));const p=r[u];delete r[u],p&&a.remove(p)}.bind(this);return o.push(J(s,"addfeature",c=>{console.assert(c.feature),d(c.feature)})),o.push(J(s,"removefeature",c=>{console.assert(c.feature),h(c.feature)})),o.push(J(s,"changefeature",c=>{const u=c.feature;console.assert(u),h(u),d(u)})),n?[n]:null}}class Pr extends Ps{constructor(e){const t=e.parent;super(t.getOptions()),this.scenePostRenderListenerRemover_=null,this.scene_=e.scene,this.synchronizer_=e.synchronizer,this.parent_=t,this.positionWGS84_=void 0,this.observer_=new MutationObserver(this.handleElementChanged.bind(this)),this.attributeObserver_=[],this.listenerKeys_=[];const s=i=>this.setPropertyFromEvent_(i);this.listenerKeys_.push(this.parent_.on("change:position",s)),this.listenerKeys_.push(this.parent_.on("change:element",s)),this.listenerKeys_.push(this.parent_.on("change:offset",s)),this.listenerKeys_.push(this.parent_.on("change:position",s)),this.listenerKeys_.push(this.parent_.on("change:positioning",s)),this.setProperties(this.parent_.getProperties()),this.handleMapChanged(),this.handleElementChanged()}observeTarget_(e){if(this.observer_){this.observer_.disconnect(),this.observer_.observe(e,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),this.attributeObserver_.forEach(t=>{t.disconnect()}),this.attributeObserver_.length=0;for(let t=0;t<e.childNodes.length;t++){const s=e.childNodes[t];if(s.nodeType===1){const i=new MutationObserver(this.handleElementChanged.bind(this));i.observe(s,{attributes:!0,subtree:!0}),this.attributeObserver_.push(i)}}}}setPropertyFromEvent_(e){e.target&&e.key&&this.set(e.key,e.target.get(e.key))}getScene(){return this.scene_}handleMapChanged(){this.scenePostRenderListenerRemover_&&(this.scenePostRenderListenerRemover_(),As(this.element)),this.scenePostRenderListenerRemover_=null;const e=this.getScene();if(e){this.scenePostRenderListenerRemover_=e.postRender.addEventListener(this.updatePixelPosition.bind(this)),this.updatePixelPosition();const t=this.stopEvent?this.synchronizer_.getOverlayContainerStopEvent():this.synchronizer_.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element)}}handlePositionChanged(){const e=this.getPosition();if(e){const t=this.parent_.getMap().getView().getProjection();this.positionWGS84_=ks(e,t,"EPSG:4326")}else this.positionWGS84_=void 0;this.updatePixelPosition()}handleElementChanged(){function e(s,i){const r=s.cloneNode();s.nodeName==="CANVAS"&&r.getContext("2d").drawImage(s,0,0),i&&i.appendChild(r),s.nodeType!=Node.TEXT_NODE&&r.addEventListener("click",a=>{s.dispatchEvent(new MouseEvent("click",a)),a.stopPropagation()});const n=s.childNodes;for(let a=0;a<n.length;a++)n[a]&&e(n[a],r);return r}Gs(this.element);const t=this.getElement();if(t&&t.parentNode&&t.parentNode.childNodes)for(const s of t.parentNode.childNodes){const i=e(s,null);this.element.appendChild(i)}t.parentNode&&this.observeTarget_(t.parentNode)}updatePixelPosition(){const e=this.positionWGS84_;if(!this.scene_||!e){this.setVisible(!1);return}let t=0;if(e.length===2){const c=this.scene_.globe.getHeight(Cesium.Cartographic.fromDegrees(e[0],e[1]));c&&this.scene_.globe.tilesLoaded&&(e[2]=c),c&&(t=c)}else t=e[2];const s=Cesium.Cartesian3.fromDegrees(e[0],e[1],t),i=this.scene_.camera,r=new Cesium.BoundingSphere(new Cesium.Cartesian3,6356752);if(!new Cesium.Occluder(r,i.position).isPointVisible(s)){this.setVisible(!1);return}if(i.frustum.computeCullingVolume(i.position,i.direction,i.up).computeVisibility(new Cesium.BoundingSphere(s))!==1){this.setVisible(!1);return}this.setVisible(!0);const o=this.scene_.cartesianToCanvasCoordinates(s),d=[o.x,o.y],h=[this.scene_.canvas.width,this.scene_.canvas.height];this.updateRenderedPosition(d,h)}destroy(){this.scenePostRenderListenerRemover_&&this.scenePostRenderListenerRemover_(),this.observer_&&this.observer_.disconnect(),z(this.listenerKeys_),this.listenerKeys_.splice(0),this.element.removeNode?this.element.removeNode(!0):this.element.remove(),this.element=null}}class Ar{constructor(e,t){this.map=e,this.overlays_=this.map.getOverlays(),this.scene=t,this.overlayContainerStopEvent_=document.createElement("DIV"),this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",["click","dblclick","mousedown","touchstart","MSPointerDown","pointerdown","mousewheel","wheel"].forEach(i=>{this.overlayContainerStopEvent_.addEventListener(i,r=>r.stopPropagation())}),this.scene.canvas.parentElement.appendChild(this.overlayContainerStopEvent_),this.overlayContainer_=document.createElement("DIV"),this.overlayContainer_.className="ol-overlaycontainer",this.scene.canvas.parentElement.appendChild(this.overlayContainer_),this.overlayMap_={}}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOverlayContainer(){return this.overlayContainer_}synchronize(){this.destroyAll(),this.addOverlays(),this.overlays_.on("add",this.addOverlayFromEvent_.bind(this)),this.overlays_.on("remove",this.removeOverlayFromEvent_.bind(this))}addOverlayFromEvent_(e){const t=e.element;this.addOverlay(t)}addOverlays(){this.overlays_.forEach(e=>{this.addOverlay(e)})}addOverlay(e){if(!e)return;const t=new Pr({scene:this.scene,synchronizer:this,parent:e}),s=I(e).toString();this.overlayMap_[s]=t}removeOverlayFromEvent_(e){const t=e.element;this.removeOverlay(t)}removeOverlay(e){const t=I(e).toString(),s=this.overlayMap_[t];s&&(s.destroy(),delete this.overlayMap_[t])}destroyAll(){Object.keys(this.overlayMap_).forEach(e=>{this.overlayMap_[e].destroy(),delete this.overlayMap_[e]})}}class ge{constructor(e){this.autoRenderLoop_=null,this.map_=e.map,this.time_=e.time||function(){return Cesium.JulianDate.now()},this.to4326Transform_=Ge(this.map_.getView().getProjection(),"EPSG:4326"),this.resolutionScale_=1,this.canvasClientWidth_=0,this.canvasClientHeight_=0,this.resolutionScaleChanged_=!0;const t="position:absolute;top:0;left:0;width:100%;height:100%;";this.container_=document.createElement("DIV");const s=document.createAttribute("style");s.value=`${t}visibility:hidden;`,this.container_.setAttributeNode(s);let i=e.target||this.map_.getViewport();if(typeof i=="string"&&(i=document.getElementById(i)),i.appendChild(this.container_),this.isOverMap_=!e.target,this.isOverMap_&&e.stopOpenLayersEventsPropagation){const c=["click","dblclick","mousedown","touchstart","MSPointerDown","pointerdown","mousewheel","wheel"];for(let u=0,g=c.length;u<g;++u)this.container_.addEventListener(c[u],m=>m.stopPropagation())}this.canvas_=document.createElement("CANVAS");const r=document.createAttribute("style");r.value=t,this.canvas_.setAttributeNode(r),X.supportsImageRenderingPixelated()&&(this.canvas_.style.imageRendering=X.imageRenderingValue()),this.canvas_.oncontextmenu=function(){return!1},this.canvas_.onselectstart=function(){return!1},this.container_.appendChild(this.canvas_),this.enabled_=!1,this.pausedInteractions_=[],this.hiddenRootGroup_=null;const n=e.sceneOptions!==void 0?e.sceneOptions:{};n.canvas=this.canvas_,n.scene3DOnly=!0,this.scene_=new Cesium.Scene(n);const a=this.scene_.screenSpaceCameraController;a.tiltEventTypes.push({eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.SHIFT}),a.tiltEventTypes.push({eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.ALT}),a.enableLook=!1,this.scene_.camera.constrainedAxis=Cesium.Cartesian3.UNIT_Z,this.camera_=new Q(this.scene_,this.map_),this.globe_=new Cesium.Globe(Cesium.Ellipsoid.WGS84),this.globe_.baseColor=Cesium.Color.WHITE,this.scene_.globe=this.globe_,this.scene_.skyAtmosphere=new Cesium.SkyAtmosphere;const o=new Cesium.SingleTileImageryProvider({url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",rectangle:Cesium.Rectangle.fromDegrees(0,0,1,1)});this.globe_.imageryLayers.addImageryProvider(o,0),this.dataSourceCollection_=new Cesium.DataSourceCollection,this.dataSourceDisplay_=new Cesium.DataSourceDisplay({scene:this.scene_,dataSourceCollection:this.dataSourceCollection_});const d=e.createSynchronizers?e.createSynchronizers(this.map_,this.scene_,this.dataSourceCollection_):[new Tr(this.map_,this.scene_),new Mr(this.map_,this.scene_),new Ar(this.map_,this.scene_)];this.handleResize_();for(let c=d.length-1;c>=0;--c)d[c].synchronize();this.lastFrameTime_=0,this.renderId_=void 0,this.targetFrameRate_=Number.POSITIVE_INFINITY,this.blockCesiumRendering_=!1,this.warmingUp_=!1,this.trackedFeature_=null,this.trackedEntity_=null,this.entityView_=null,this.needTrackedEntityUpdate_=!1,this.boundingSphereScratch_=new Cesium.BoundingSphere,new Cesium.EventHelper().add(this.scene_.postRender,ge.prototype.updateTrackedEntity_,this),Cesium.Camera.enableSuspendTerrainAdjustment=!1}render_(){this.renderId_!==void 0&&(cancelAnimationFrame(this.renderId_),this.renderId_=void 0),(this.enabled_||this.warmingUp_)&&!this.blockCesiumRendering_&&(this.renderId_=requestAnimationFrame(this.onAnimationFrame_.bind(this)))}onAnimationFrame_(e){this.renderId_=void 0;const t=1e3/this.targetFrameRate_;if(e-this.lastFrameTime_<t){this.render_();return}this.lastFrameTime_=e;const i=this.time_();if(this.scene_.initializeFrame(),this.handleResize_(),this.dataSourceDisplay_.update(i),this.entityView_){const r=this.trackedEntity_;this.dataSourceDisplay_.getBoundingSphere(r,!1,this.boundingSphereScratch_)===Cesium.BoundingSphereState.DONE&&(this.boundingSphereScratch_.radius=1,this.entityView_.update(i,this.boundingSphereScratch_))}this.scene_.render(i),this.camera_.checkCameraChange(),this.render_()}updateTrackedEntity_(){if(!this.needTrackedEntityUpdate_)return;const e=this.trackedEntity_,t=this.scene_,s=this.dataSourceDisplay_.getBoundingSphere(e,!1,this.boundingSphereScratch_);if(s===Cesium.BoundingSphereState.PENDING)return;t.screenSpaceCameraController.enableTilt=!1;const i=s!==Cesium.BoundingSphereState.FAILED?this.boundingSphereScratch_:void 0;i&&(i.radius=1),this.entityView_=new Cesium.EntityView(e,t,t.mapProjection.ellipsoid),this.entityView_.update(this.time_(),i),this.needTrackedEntityUpdate_=!1}handleResize_(){let e=this.canvas_.clientWidth,t=this.canvas_.clientHeight;if(e===0|t===0||e===this.canvasClientWidth_&&t===this.canvasClientHeight_&&!this.resolutionScaleChanged_)return;let s=this.resolutionScale_;X.supportsImageRenderingPixelated()||(s*=window.devicePixelRatio||1),this.resolutionScaleChanged_=!1,this.canvasClientWidth_=e,this.canvasClientHeight_=t,e*=s,t*=s,this.canvas_.width=e,this.canvas_.height=t,this.scene_.camera.frustum.aspectRatio=e/t}getCamera(){return this.camera_}getOlMap(){return this.map_}getOlView(){const e=this.map_.getView();return console.assert(e),e}getCesiumScene(){return this.scene_}getDataSources(){return this.dataSourceCollection_}getDataSourceDisplay(){return this.dataSourceDisplay_}getEnabled(){return this.enabled_}setEnabled(e){if(this.enabled_===e)return;this.enabled_=e,this.container_.style.visibility=this.enabled_?"visible":"hidden";let t;if(this.enabled_){if(this.throwOnUnitializedMap_(),this.isOverMap_){t=this.map_.getInteractions(),t.forEach((i,r,n)=>{this.pausedInteractions_.push(i)}),t.clear(),this.map_.addInteraction=i=>this.pausedInteractions_.push(i),this.map_.removeInteraction=i=>this.pausedInteractions_=this.pausedInteractions_.filter(r=>r!==i);const s=this.map_.getLayerGroup();s.getVisible()&&(this.hiddenRootGroup_=s,this.hiddenRootGroup_.setVisible(!1)),this.map_.getOverlayContainer().classList.add("olcs-hideoverlay")}this.camera_.readFromView(),this.render_()}else this.isOverMap_&&(t=this.map_.getInteractions(),this.pausedInteractions_.forEach(s=>{t.push(s)}),this.pausedInteractions_.length=0,this.map_.addInteraction=s=>this.map_.getInteractions().push(s),this.map_.removeInteraction=s=>this.map_.getInteractions().remove(s),this.map_.getOverlayContainer().classList.remove("olcs-hideoverlay"),this.hiddenRootGroup_&&(this.hiddenRootGroup_.setVisible(!0),this.hiddenRootGroup_=null)),this.camera_.updateView()}warmUp(e,t){if(this.enabled_)return;this.throwOnUnitializedMap_(),this.camera_.readFromView();const s=this.globe_.ellipsoid,i=this.scene_.camera,r=s.cartesianToCartographic(i.position);r.height<e&&(r.height=e,i.position=s.cartographicToCartesian(r)),this.warmingUp_=!0,this.render_(),setTimeout(()=>{this.warmingUp_=!1},t)}setBlockCesiumRendering(e){this.blockCesiumRendering_!==e&&(this.blockCesiumRendering_=e,this.render_())}enableAutoRenderLoop(){this.autoRenderLoop_||(this.autoRenderLoop_=new Fr(this))}getAutoRenderLoop(){return this.autoRenderLoop_}setResolutionScale(e){e=Math.max(0,e),e!==this.resolutionScale_&&(this.resolutionScale_=Math.max(0,e),this.resolutionScaleChanged_=!0,this.autoRenderLoop_&&this.autoRenderLoop_.restartRenderLoop())}setTargetFrameRate(e){this.targetFrameRate_!==e&&(this.targetFrameRate_=e,this.render_())}throwOnUnitializedMap_(){const t=this.map_.getView(),s=t.getCenter();if(!t.isDef()||isNaN(s[0])||isNaN(s[1]))throw new Error(`The OpenLayers map is not properly initialized: ${s} / ${t.getResolution()}`)}get trackedFeature(){return this.trackedFeature_}set trackedFeature(e){if(this.trackedFeature_!==e){const t=this.scene_;if(!e||!e.getGeometry()){this.needTrackedEntityUpdate_=!1,t.screenSpaceCameraController.enableTilt=!0,this.trackedEntity_&&this.dataSourceDisplay_.defaultDataSource.entities.remove(this.trackedEntity_),this.trackedEntity_=null,this.trackedFeature_=null,this.entityView_=null,t.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);return}this.trackedFeature_=e,this.needTrackedEntityUpdate_=!0;const s=this.to4326Transform_,i=function(){const n=e.getGeometry();console.assert(n instanceof K);const a=n.getCoordinates(),o=s(a,void 0,a.length);return M.ol4326CoordinateToCesiumCartesian(o)},r={position:new Cesium.CallbackProperty((n,a)=>i(),!1),point:{pixelSize:1,color:Cesium.Color.TRANSPARENT}};this.trackedEntity_=this.dataSourceDisplay_.defaultDataSource.entities.add(r)}}}const kr="/Map_Demo/assets/logo-7dcf33a4.svg";const Gr={props:{},setup(l,{emit:e}){const t=pe,s=ue,i=ne({defaultCenter:[121.326776,24.655499],defaultCenterZoom:14,targetNum:1,conditionWrap:!1,layerSelect:!1,currentLayers:[],layers:[],mapLayers:Te(()=>i.layers.map((y,_)=>({label:y.group_title,value:y.value,layers:y.group_layers,groupClass:y.group_class}))),baseMapsOptions:Te(()=>ue.sourceData()),selectLock:!1,mapCount:1,map1:null,map2:null,map1LayerStatus:[],map2LayerStatus:[],deleteLightbox:!1,dimensionMap:{map1:"2D",map2:"2D"},toSearchDimensionStatus:Te(()=>{let y=i.targetNum==1?"map1":"map2";return i.dimensionMap[y]==="2D"}),tribeId:"",ol3d:null,selectValueTemp:0}),r=new Ns({projection:"EPSG:4326",center:i.defaultCenter,zoom:i.defaultCenterZoom}),n=He(null),a=He(null);let o=null;function d(){i.map1=new Pe({target:"map1",layers:[ue.sourceFun("default")],view:r,controls:[]})}function h(y,_){const w=new W({source:new $({features:[new _e({geometry:new K([y,_]),name:"Null Island",population:4e3,rainfall:500})]}),style:new fe({image:new De({anchor:[.5,100],anchorXUnits:"fraction",anchorYUnits:"pixels",src:"https://www.ockert-cnc.de/wp-content/uploads/2016/12/map-marker-icon-100x100.png"})})});let v=i.targetNum==1?"map1":"map2";i[v].addLayer(w)}function c({action:y,value:_}){var F;let w=((F=i.map1)==null?void 0:F.getTarget())==null?"map2":"map1",v=i[w].getView();switch(y){case"In":v.animate({zoom:v.getZoom()+1});break;case"Out":v.animate({zoom:v.getZoom()-1});break;case"toNorth":v.animate({rotation:0});break;case"moveTo":if(_){const{xAxis:O,yAxis:D}=_;v.animate({center:[O,D],zoom:10,duration:100})}else navigator.geolocation.getCurrentPosition(function(O){v.animate({center:[O.coords.longitude,O.coords.latitude],zoom:17,duration:100}),h(O.coords.longitude,O.coords.latitude)});break;case"fullScreen":let S=document.getElementById(`map${i.targetNum}`);S.requestFullscreen?S.requestFullscreen():S.msRequestFullscreen?S.msRequestFullscreen():S.mozRequestFullScreen?S.mozRequestFullScreen():S.webkitRequestFullscreen&&S.webkitRequestFullscreen();break}}function u({action:y,value:_}){var F;let w=i.targetNum==1?i.map1:i.map2,v=w==null?void 0:w.getLayers();switch(y){case"layerMode":if(_.checked){i.layers[_.nodeIndex].group_layers[_.subNodeIndex].single_tiles||(v.getArray().forEach(le=>{le.get("id")&&le.get("id").includes(`node${_.nodeIndex}_subNode${_.subNodeIndex}_nestedSubNode`)&&w.removeLayer(le)}),C("delete",w.getTarget(),_.id));let b=_.nestedSubNodeIndex||i.selectValueTemp,R=t.getLayer(i.layers[_.nodeIndex].group_layers[_.subNodeIndex],b,_.id);w.addLayer(R),_.id==="node0_subNode3_nestedSubNodeundefined"&&w.on("click",E=>{}),C("add",w.getTarget(),_.id)}else{let b=v.getArray(),R;switch(_.id){case"node0_subNode0_nestedSubNodeundefined":R=b.filter(E=>E.get("id")==="node0_subNode0_nestedSubNodeundefined"),R.forEach(E=>{w.removeLayer(E)});break;case"node3_subNode1_nestedSubNodeundefined":R=b.filter(E=>E.get("id")==="node3_subNode1_nestedSubNodeundefined"),R.forEach(E=>{w.removeLayer(E)});break;default:b.forEach(E=>{E.get("id")==_.id&&w.removeLayer(E)});break}C("delete",w.getTarget(),_.id)}break;case"selectLayerMode":if(i.selectLock)return;_.layerName==="all"?v.getArray().filter(E=>E.get("name")!=="default").forEach(E=>{w.removeLayer(E)}):v.getArray().forEach(R=>{R.get("id")==_.id&&w.removeLayer(R)});break;case"changeOrder":if(i.selectLock)return;let S=pe.getLayerIndex(_.id),O=t.getLayer(i.layers[S.nodeIndex].group_layers[S.subNodeIndex],S.nestedSubNodeIndex,_.id);if(_.movement==="up"){if(_.key+1==v.getArray().length)return;_.checked=!1,u({action:"layerMode",value:_}),v.insertAt(_.key+1,O)}if(_.movement==="down"){if(_.key-1==0)return;_.checked=!1,u({action:"layerMode",value:_}),v.insertAt(_.key-1,O)}break;case"changeLayerVisible":if(i.selectLock)return;let D=!v.getArray()[_.key].getVisible();v.getArray()[_.key].setVisible(D);break;case"baseMap":let V=s.sourceFun(_.layerName);v.extend([V]),v.getArray().forEach(b=>{b.get("name")!==_.layerName&&w.removeLayer(b)});break;case"changeMapCount":if(i.mapCount===_)return;let P=i.targetNum!==1?"map1":"map2";i.mapCount=_;let Fe=i[`${P}LayerStatus`].filter(b=>b!=="3D").map(b=>pe.getLayerIndex(b));if(_===2&&(i[P]=new Pe({target:P,layers:[ue.sourceFun("default"),...Fe.map(b=>t.getLayer(i.layers[b.nodeIndex].group_layers[b.subNodeIndex],b.nestedSubNodeIndex,b.id))],view:r,controls:[]}),((F=i[`${P}LayerStatus`])==null?void 0:F.indexOf("3D"))!==-1&&(o=new ge({map:i[P]}),o.setEnabled(!0))),_===1){i[P]=null;const b=document.getElementById(P);for(;b.firstChild;)b.removeChild(b.firstChild)}break;case"changeDimensionMap":let Y=i.targetNum==1?"map1":"map2";i.dimensionMap[Y]=_,_==="3D"?(o=new ge({map:w}),o.setEnabled(!0),i[`${Y}LayerStatus`].push("3D")):(o.setEnabled(!1),i[`${Y}LayerStatus`]=i[`${Y}LayerStatus`].filter(b=>b!=="3D"));break}m()}function g(y){var w;i.targetNum=y;let _=i.targetNum!==1?"map1":"map2";if(i.mapCount===1){if(!i[`map${y}`]){let F=i[`map${y}LayerStatus`].filter(S=>S!=="3D").map(S=>pe.getLayerIndex(S));i[`map${y}`]=new Pe({target:`map${y}`,layers:[ue.sourceFun("default"),...F.map(S=>t.getLayer(i.layers[S.nodeIndex].group_layers[S.subNodeIndex],S.nestedSubNodeIndex,S.layeredIndex))],view:r,controls:[]}),((w=i[`map${y}LayerStatus`])==null?void 0:w.indexOf("3D"))!==-1&&(o=new ge({map:i[`map${y}`]}),o.setEnabled(!0))}if(i[_]){i[_]=null;const v=document.getElementById(_);for(;v.firstChild;)v.removeChild(v.firstChild)}}ze(()=>{m()})}function m(){var w;let y=i.targetNum==1?i.map1:i.map2;const _=(w=y==null?void 0:y.getLayers())==null?void 0:w.getArray();i.currentLayers=_==null?void 0:_.map(v=>({label:v.get("label"),id:v.get("id"),visible:v.getVisible()}))}function p(){i.conditionWrap=!i.conditionWrap}function C(y,_,w){if(y==="add")i[`${_}LayerStatus`].push(w);else if(y==="delete"){let v=i[`${_}LayerStatus`].findIndex(F=>F===w);i[`${_}LayerStatus`].splice(v,1)}else console.log("error")}return lt(async()=>{await ct.ajax({url:"https://api.edtest.site/layers",method:"GET"}).done(y=>{i.layers=y.map((_,w)=>(_.group_layers.forEach((v,F)=>{let S,O;S=F,v.id=`node${w}_subNode${S}_nestedSubNode${O}`,v.single_tiles||v.tiles_list.forEach((D,V)=>{O=V,D.id=`node${w}_subNode${S}_nestedSubNode${O}`})}),{..._,value:w})),ze(()=>{d(),m()})}).fail(y=>{console.log("Fail",y)})}),{state:i,props:l,mapDetailsPopup:a,overlay:n,mapControl:c,layerControl:u,getCurrentLayerNames:m,changeTarget:g,conditionWrap:p}}},Nr={class:"SearchBar position-absolute"},Dr=f("img",{src:kr,alt:"",class:"mb-2"},null,-1),Vr={class:"w-100 d-flex flex-nowrap mapWrap",id:"mapWrap"},$r={key:0,class:"middleLine"},Br={class:"condition position-absolute"},jr={class:"mb-2"},Hr={key:1,class:"mb-4"},zr={key:1},Wr={key:0,class:"lightWrap w-100 h-100 d-flex justify-content-center align-items-center"},Ur={class:"p-4 rounded bg-white",style:{width:"250px"}},Kr=f("p",{class:"text-center fw-bold"},"是否要刪除全部圖層",-1),Xr={class:"d-flex justify-content-around"};function Zr(l,e,t,s,i,r){var u,g;const n=Rr,a=er,o=Yn,d=On,h=zi,c=oi;return L(),x("div",null,[f("div",{class:"btn",onClick:e[0]||(e[0]=m=>s.state.tribeId="88")},"88"),f("div",Nr,[Dr,ce(n,{dimensionMapStatus:s.state.toSearchDimensionStatus,currentLayers:s.state.currentLayers,mapCount:s.state.mapCount,onOnLayerControl:e[1]||(e[1]=({action:m,value:p})=>{s.layerControl({action:m,value:p})}),onOnChangeTarget:e[2]||(e[2]=m=>{s.changeTarget(m)}),onConditionWrap:e[3]||(e[3]=m=>{s.conditionWrap(m)})},null,8,["dimensionMapStatus","currentLayers","mapCount"])]),ce(a,{class:"mapSourceOption",baseMapsOptions:s.state.baseMapsOptions,onOnChangeBaseMaps:e[4]||(e[4]=({action:m,value:p})=>{s.layerControl({action:m,value:p})})},null,8,["baseMapsOptions"]),ce(o,{class:"asideTool position-absolute top-50 translate-middle-y",id:"asideTool",onOnMapControl:e[5]||(e[5]=({action:m,value:p})=>{s.mapControl({action:m,value:p})})}),f("div",Vr,[f("div",{id:"map1",class:B({"w-100":((u=s.state.map1)==null?void 0:u.getTarget())=="map1"})},null,2),s.state.mapCount===2?(L(),x("div",$r)):k("",!0),f("div",{id:"map2",class:B({"w-100":((g=s.state.map2)==null?void 0:g.getTarget())=="map2"})},null,2)]),f("div",Br,[f("div",jr,[s.state.conditionWrap?k("",!0):(L(),x("button",{key:0,class:"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5",onClick:e[6]||(e[6]=m=>s.state.conditionWrap=!0)}," 圖層選項 ")),s.state.conditionWrap?(L(),x("div",Hr,[ce(d,Tt({mapLayers:s.state.mapLayers,currentLayers:s.state.currentLayers,onClose:()=>{s.state.conditionWrap=!1},showSelectLayerValue:m=>{s.state.selectValueTemp=m}},{onOnMapControl:e[7]||(e[7]=({action:m,value:p})=>{s.mapControl({action:m,value:p})}),onOnLayerControl:e[8]||(e[8]=({action:m,value:p})=>{s.layerControl({action:m,value:p})})}),null,16)])):k("",!0)]),f("div",null,[s.state.layerSelect?k("",!0):(L(),x("button",{key:0,class:"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5",onClick:e[9]||(e[9]=m=>s.state.layerSelect=!0)}," 已選擇的圖層 ")),s.state.layerSelect?(L(),x("div",zr,[ce(h,It(Ot({selectLock:s.state.selectLock,currentLayers:s.state.currentLayers,onClose:()=>{s.state.layerSelect=!1},onChangLayerVisible:m=>{s.layerControl(m)},onChangeOrderLayer:({action:m,value:p})=>{s.layerControl({action:m,value:p})},onLockLayer:()=>{s.state.selectLock=!s.state.selectLock},onDeleteLayer:({action:m,value:p})=>{p.layerName=="all"?s.state.deleteLightbox=!0:s.layerControl({action:m,value:p})},onDeleteLayerAll:()=>{s.state.deleteLightbox=!0}})),null,16)])):k("",!0)])]),s.state.deleteLightbox?(L(),x("div",Wr,[f("div",Ur,[Kr,f("div",Xr,[f("button",{class:"rounded px-3 py-1 bg-steel text-white border-0",onClick:e[10]||(e[10]=()=>{s.layerControl({action:"selectLayerMode",value:{layerName:"all"}}),s.state.deleteLightbox=!1})},"確定"),f("button",{class:"rounded px-3 py-1 bg-secondary bg-gradient text-white border-0",onClick:e[11]||(e[11]=()=>{s.state.deleteLightbox=!1})},"取消")])])])):k("",!0),s.state.tribeId?(L(),Mt(c,{key:1,ref:"mapDetailsPopup",class:"areaData",closeMapData:()=>{s.state.tribeId=""},tribeId:s.state.tribeId,maxHeight:500},null,8,["closeMapData","tribeId"])):k("",!0)])}const Jr=Z(Gr,[["render",Zr]]);export{Jr as default};
//# sourceMappingURL=WebMap-fbc96485.js.map
