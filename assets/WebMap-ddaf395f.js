import{V as Q,T as R,X as Z,O as V,m as T,M as j,b as B,S as X,c as U,a as K,_ as $,d as ee,e as te,f as ae,g as oe,h as ne,i as re,j as se,k as ie,F as le,P as de,l as ce,I as ye,n as me}from"./OLCesium-10aba27b.js";import{_ as ue,r as pe,f as q,g as ge,$ as fe,n as Y,c as b,d,h as J,i as f,j as C,m as v,k as be,l as Le,p as G,o as p}from"./index-dd2b276c.js";const _e={props:{},setup(P,{emit:i}){const k=T,e=pe({defaultCenter:[121.326776,24.655499],defaultCenterZoom:14,targetNum:1,conditionWrap:!1,layerSelect:!1,currentLayers:[],layers:[],mapLayers:q(()=>e.layers.map((a,t)=>({label:a.group_title,value:a.value,layers:a.group_layers,groupClass:a.group_class}))),selectLock:!1,mapCount:1,map1:null,map2:null,map1LayerStatus:[],map2LayerStatus:[],deleteLightbox:!1,dimensionMap:{map1:"2D",map2:"2D"},toSearchDimensionStatus:q(()=>{let a=e.targetNum==1?"map1":"map2";return e.dimensionMap[a]==="2D"}),ol3d:null,selectValueTemp:0,areaData:{nodeRef:null,overlay:null,tribeAreaData:{}},comSize:{wrapHeight:"",wrapWidth:""}}),x=new Q({projection:"EPSG:4326",center:e.defaultCenter,zoom:e.defaultCenterZoom});new R({preload:1/0,name:"source_nlsc_EMAP",label:"臺灣通用電子地圖",source:new Z({url:"https://wmts.nlsc.gov.tw/wmts/EMAP5/default/EPSG:3857/{z}/{y}/{x}"}),crossOrigin:"anonymous"});let m=null;function A(){e.map1=new j({target:"map1",layers:[B.getBaseMapData(0)],view:x,controls:[]})}function O(a,t){const n=new se({source:new ie({features:[new le({geometry:new de([a,t]),name:"Null Island",population:4e3,rainfall:500})]}),style:new ce({image:new ye({anchor:[.5,100],anchorXUnits:"fraction",anchorYUnits:"pixels",src:"https://www.ockert-cnc.de/wp-content/uploads/2016/12/map-marker-icon-100x100.png"})})});let o=e.targetNum==1?"map1":"map2";e[o].addLayer(n)}function W({action:a,value:t}){var y;let n=((y=e.map1)==null?void 0:y.getTarget())==null?"map2":"map1",o=e[n].getView();switch(a){case"In":o.animate({zoom:o.getZoom()+1});break;case"Out":o.animate({zoom:o.getZoom()-1});break;case"toNorth":o.animate({rotation:0});break;case"moveTo":if(t){const{xAxis:c,yAxis:_}=t;o.animate({center:[c,_],zoom:10,duration:100})}else navigator.geolocation.getCurrentPosition(function(c){o.animate({center:[c.coords.longitude,c.coords.latitude],zoom:17,duration:100}),O(c.coords.longitude,c.coords.latitude)});break;case"fullScreen":let r=document.getElementById(`map${e.targetNum}`);r.requestFullscreen?r.requestFullscreen():r.msRequestFullscreen?r.msRequestFullscreen():r.mozRequestFullScreen?r.mozRequestFullScreen():r.webkitRequestFullscreen&&r.webkitRequestFullscreen();break}}function L({action:a,value:t}){var y;console.log(a,t);let n=e.targetNum==1?e.map1:e.map2,o=n==null?void 0:n.getLayers();switch(a){case"layerMode":if(t.checked){e.layers[t.nodeIndex].group_layers[t.subNodeIndex].single_tiles||(o.getArray().forEach(z=>{z.get("id")&&z.get("id").includes(`node${t.nodeIndex}_subNode${t.subNodeIndex}_nestedSubNode`)&&n.removeLayer(z)}),S("delete",n.getTarget(),t.id));let s=t.nestedSubNodeIndex||e.selectValueTemp,u=k.getLayer(e.layers[t.nodeIndex].group_layers[t.subNodeIndex],s,t.id);n.addLayer(u),t.id==="node0_subNode3_nestedSubNodeundefined"&&L({action:"layerMode",value:{checked:!0,id:"node0_subNode4_nestedSubNodeundefined",nestedSubNode:!1,nestedSubNodeIndex:void 0,nodeIndex:0,subNodeIndex:4}}),["node0_subNode4_nestedSubNodeundefined","node0_subNode5_nestedSubNodeundefined"].includes(t.id)&&N(n,t.id),S("add",n.getTarget(),t.id)}else{let s=o.getArray(),u;switch(t.id){case"node0_subNode0_nestedSubNodeundefined":u=s.filter(l=>(console.log(l.get("id")),l.get("id")?l==null?void 0:l.get("id").includes("node0_subNode0_nestedSubNode"):!1)),u.forEach(l=>{n.removeLayer(l)});break;case"node3_subNode1_nestedSubNodeundefined":u=s.filter(l=>l.get("id")?l==null?void 0:l.get("id").includes("node3_subNode1_nestedSubNodeundefined"):!1),u.forEach(l=>{n.removeLayer(l)});break;default:s.forEach(l=>{l.get("id")==t.id&&n.removeLayer(l)});break}S("delete",n.getTarget(),t.id)}break;case"selectLayerMode":if(e.selectLock)return;t.layerName==="all"?o.getArray().filter(l=>l.get("id")!==void 0).forEach(l=>{n.removeLayer(l)}):o.getArray().forEach(u=>{u.get("id")==t.id&&n.removeLayer(u)});break;case"changeOrder":if(e.selectLock)return;let r=T.getLayerIndex(t.id),c=k.getLayer(e.layers[r.nodeIndex].group_layers[r.subNodeIndex],r.nestedSubNodeIndex,t.id);if(t.movement==="up"){if(t.key+1==o.getArray().length)return;t.checked=!1,L({action:"layerMode",value:t}),o.insertAt(t.key+1,c)}if(t.movement==="down"){if(t.key-1==0)return;t.checked=!1,L({action:"layerMode",value:t}),o.insertAt(t.key-1,c)}break;case"changeLayerVisible":if(e.selectLock)return;let _=!o.getArray()[t.key].getVisible();o.getArray()[t.key].setVisible(_);break;case"baseMap":let w=new R({preload:1/0,name:t.layer.name,label:t.layer.label,source:new Z({url:t.layer.url}),crossOrigin:"anonymous"});o.extend([w]),o.getArray().forEach(s=>{s.get("name")!==t.layerName&&n.removeLayer(s)});break;case"changeMapCount":if(e.mapCount===t.qty)return;let g=e.targetNum!==1?"map1":"map2";e.mapCount=t.qty;let H=e[`${g}LayerStatus`].filter(s=>s!=="3D").map(s=>T.getLayerIndex(s));if(t.qty===2&&(e[g]=new j({target:g,layers:[B.getBaseMapData(0),...H.map(s=>k.getLayer(e.layers[s.nodeIndex].group_layers[s.subNodeIndex],s.nestedSubNodeIndex,s.id))],view:x,controls:[]}),((y=e[`${g}LayerStatus`])==null?void 0:y.indexOf("3D"))!==-1)){m=new V({map:e[g]}),m.setEnabled(!0),Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0NzM3MWFhYS0xMjNlLTQ3MTMtODFjZS0xZjMzM2I5NGZiYTEiLCJpZCI6MTMwODE4LCJpYXQiOjE2ODQwNzM3Mjl9.UYu4kBialPo19dcvosHzZTpg2BD1zkFQnjCD78YiiYo";let s=m.getCesiumScene({});s.terrainProvider=Cesium.createWorldTerrain({})}if(t.qty===1){e[g]=null;const s=document.getElementById(g);for(;s.firstChild;)s.removeChild(s.firstChild)}break;case"changeDimensionMap":let I=e.targetNum==1?"map1":"map2";if(e.dimensionMap[I]=t,t==="3D"){m=new V({map:n}),m.setEnabled(!0),Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0NzM3MWFhYS0xMjNlLTQ3MTMtODFjZS0xZjMzM2I5NGZiYTEiLCJpZCI6MTMwODE4LCJpYXQiOjE2ODQwNzM3Mjl9.UYu4kBialPo19dcvosHzZTpg2BD1zkFQnjCD78YiiYo";let s=m.getCesiumScene({});s.terrainProvider=Cesium.createWorldTerrain({}),e[`${I}LayerStatus`].push("3D")}else m.setEnabled(!1),e[`${I}LayerStatus`]=e[`${I}LayerStatus`].filter(s=>s!=="3D");break;case"setOpacity":o.getArray()[t.key].getOpacity()!==1?o.getArray()[t.key].setOpacity(1):o.getArray()[t.key].setOpacity(.5);break}h()}function M(a){var n;e.targetNum=a;let t=e.targetNum!==1?"map1":"map2";if(e.mapCount===1){if(!e[`map${a}`]){let o=e[`map${a}LayerStatus`].filter(r=>r!=="3D");o.includes("node0_subNode4_nestedSubNodeundefined")&&(o=[...o.filter(c=>c!=="node0_subNode4_nestedSubNodeundefined"),"node0_subNode4_nestedSubNodeundefined"]);let y=o.map(r=>T.getLayerIndex(r));e[`map${a}`]=new j({target:`map${a}`,layers:[B.getBaseMapData(0),...y.map(r=>k.getLayer(e.layers[r.nodeIndex].group_layers[r.subNodeIndex],r.nestedSubNodeIndex,r.layeredIndex))],view:x,controls:[]}),N(e[`map${a}`]),((n=e[`map${a}LayerStatus`])==null?void 0:n.indexOf("3D"))!==-1&&(m=new V({map:e[`map${a}`]}),m.setEnabled(!0))}if(e[t]){e[t]=null;const o=document.getElementById(t);for(;o.firstChild;)o.removeChild(o.firstChild)}}Y(()=>{h()})}function h(){var n;let a=e.targetNum==1?e.map1:e.map2;const t=(n=a==null?void 0:a.getLayers())==null?void 0:n.getArray();e.currentLayers=t==null?void 0:t.map(o=>({label:o.get("label"),id:o.get("id"),visible:o.getVisible()}))}function E(){e.conditionWrap=!e.conditionWrap}function S(a,t,n){if(a==="add")e[`${t}LayerStatus`].push(n);else if(a==="delete"){let o=e[`${t}LayerStatus`].findIndex(y=>y===n);e[`${t}LayerStatus`].splice(o,1)}else console.log("error")}function N(a,t="node0_subNode4_nestedSubNodeundefined"){var o;let n=new X({layers:(o=a==null?void 0:a.getLayers())==null?void 0:o.getArray(),condition:U});a.addInteraction(n),n.on("select",y=>{let r=y.selected;y.selected[0]?(e.areaData.overlay=new K({element:e.areaData.nodeRef,autoPan:!0,autoPanAnimation:{duration:250}}),a.addOverlay(e.areaData.overlay),e.areaData.overlay.setPosition(y.mapBrowserEvent.coordinate),e.areaData.tribeAreaData={},r[0].get("編號")===void 0?e.areaData.tribeAreaData=r[0]:r.forEach(c=>{let _=c.getProperties();Object.entries(_).forEach(w=>{const F=w[0],g=w[1];e.areaData.tribeAreaData[F]=g})})):(e.areaData.tribeAreaData={},a.removeOverlay(e.areaData.overlay),e.areaData.overlay=null)})}function D(){(e.targetNum==1?e.map1:e.map2).removeOverlay(e.areaData.overlay),e.areaData.overlay=null}return ge(async()=>{await fe.ajax({url:"https://api.edtest.site/layers",method:"GET"}).done(a=>{e.layers=a.map((t,n)=>(t.group_layers.forEach((o,y)=>{let r=y,c;o.id=`node${n}_subNode${r}_nestedSubNode${c}`,o.single_tiles||o.tiles_list.forEach((_,w)=>{c=w,_.id=`node${n}_subNode${r}_nestedSubNode${c}`})}),{...t,value:n})),Y(()=>{A(),h()})}).fail(a=>{console.log("Fail",a)}),e.comSize.wrapHeight=window.innerHeight,e.comSize.wrapWidth=window.innerWidth,window.onresize=a=>{e.comSize.wrapHeight=a.target.innerHeight,e.comSize.wrapWidth=a.target.innerWidth}}),{state:e,props:P,mapControl:W,layerControl:L,getCurrentLayerNames:h,changeTarget:M,conditionWrap:E,closeMapData:D}}},Ce={class:"w-100 d-flex flex flex-sm-row flex-wrap flex-sm-nowrap mapWrap",id:"mapWrap"},he={key:0,class:"middleLine"},Se={class:"SearchBar d-none d-sm-block position-absolute"},we={class:"d-flex align-items-center"},ke=d("img",{src:$,alt:"",class:"mb-2"},null,-1),Ne={class:"d-flex align-items-center"},xe=d("span",{class:"me-2"},"部落",-1),Me=d("li",{class:"d-flex align-items-center"},null,-1),De=d("li",{class:"d-flex align-items-center"},null,-1),Ie={class:"conditionCom d-none d-sm-block position-absolute"},Te={class:"mb-2"},Ae={key:1,class:"mb-4"},Oe={key:1},We={key:0,class:"lightWrap w-100 h-100 d-flex justify-content-center align-items-center"},Ee={class:"p-4 rounded bg-white",style:{width:"250px"}},ze=d("p",{class:"text-center fw-bold"},"是否要刪除全部圖層",-1),Ve={class:"d-flex justify-content-around"},je={class:"m-Navbar d-flex d-sm-none position-fixed bottom-0 start-0 w-100"},Be={key:1};function ve(P,i,k,e,x,m){var S,N,D;const A=ee,O=me,W=te,L=ae,M=oe,h=ne,E=re;return p(),b("div",null,[d("div",Ce,[d("div",{id:"map1",class:J({"w-100":((S=e.state.map1)==null?void 0:S.getTarget())=="map1","h-100":e.state.mapCount===1,"h-50":e.state.mapCount===2&&e.state.comSize.wrapWidth<600})},null,2),e.state.mapCount===2?(p(),b("div",he)):f("",!0),d("div",{id:"map2",class:J({"w-100":((N=e.state.map2)==null?void 0:N.getTarget())=="map2","h-100":e.state.mapCount===1,"h-50":e.state.mapCount===2&&e.state.comSize.wrapWidth<600})},null,2)]),C(A,{class:"asideTool position-absolute top-50 translate-middle-y",id:"asideTool",onOnMapControl:i[0]||(i[0]=({action:a,value:t})=>{e.mapControl({action:a,value:t})})}),d("div",Se,[d("div",we,[ke,d("ul",null,[d("li",Ne,[xe,C(O,{class:"mapSourceOption d-none d-sm-block",onChangeBaseMaps:({action:a,value:t})=>{e.layerControl({action:a,value:t})}},null,8,["onChangeBaseMaps"])]),Me,De])]),C(W,{dimensionMapStatus:e.state.toSearchDimensionStatus,currentLayers:e.state.currentLayers,mapCount:e.state.mapCount,onChangeBaseMaps:({action:a,value:t})=>{e.layerControl({action:a,value:t})},onOnLayerControl:i[1]||(i[1]=({action:a,value:t})=>{e.layerControl({action:a,value:t})}),onOnChangeTarget:i[2]||(i[2]=a=>{e.changeTarget(a)}),onConditionWrap:i[3]||(i[3]=a=>{e.conditionWrap(a)})},null,8,["dimensionMapStatus","currentLayers","mapCount","onChangeBaseMaps"])]),d("div",Ie,[d("div",Te,[e.state.conditionWrap?f("",!0):(p(),b("button",{key:0,class:"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5",onClick:i[4]||(i[4]=a=>e.state.conditionWrap=!0)}," 圖層選項 ")),e.state.conditionWrap?(p(),b("div",Ae,[C(L,v({mapLayers:e.state.mapLayers,currentLayers:e.state.currentLayers,onClose:()=>{e.state.conditionWrap=!1},showSelectLayerValue:a=>{e.state.selectValueTemp=a}},{onOnMapControl:i[5]||(i[5]=({action:a,value:t})=>{e.mapControl({action:a,value:t})}),onOnLayerControl:i[6]||(i[6]=({action:a,value:t})=>{e.layerControl({action:a,value:t})})}),null,16)])):f("",!0)]),d("div",null,[e.state.layerSelect?f("",!0):(p(),b("button",{key:0,class:"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5",onClick:i[7]||(i[7]=a=>e.state.layerSelect=!0)}," 已選擇的圖層 ")),e.state.layerSelect?(p(),b("div",Oe,[C(M,be(Le({selectLock:e.state.selectLock,currentLayers:e.state.currentLayers,onClose:()=>{e.state.layerSelect=!1},onLockLayer:()=>{e.state.selectLock=!e.state.selectLock},onDeleteLayer:({action:a,value:t})=>{t.layerName=="all"?e.state.deleteLightbox=!0:e.layerControl({action:a,value:t})},onDeleteLayerAll:()=>{e.state.deleteLightbox=!0},onLayerControl:({action:a,value:t})=>{e.layerControl({action:a,value:t})}})),null,16)])):f("",!0)])]),e.state.deleteLightbox?(p(),b("div",We,[d("div",Ee,[ze,d("div",Ve,[d("button",{class:"rounded px-3 py-1 bg-steel text-white border-0",onClick:i[8]||(i[8]=()=>{e.layerControl({action:"selectLayerMode",value:{layerName:"all"}}),e.state.deleteLightbox=!1})},"確定"),d("button",{class:"rounded px-3 py-1 bg-secondary bg-gradient text-white border-0",onClick:i[9]||(i[9]=()=>{e.state.deleteLightbox=!1})},"取消")])])])):f("",!0),d("div",{id:"popup",class:"position-absolute bottom-0",ref:a=>{e.state.areaData.nodeRef=a}},[(D=e.state.areaData)!=null&&D.overlay?(p(),G(h,{key:0,class:"areaData",closeMapData:()=>{e.closeMapData()},tribeAreaData:e.state.areaData.tribeAreaData,maxHeight:500},null,8,["closeMapData","tribeAreaData"])):f("",!0)],512),d("div",je,[e.state.conditionWrap?(p(),G(L,v({key:0,class:"position-absolute bottom-100 w-100"},{mapLayers:e.state.mapLayers,currentLayers:e.state.currentLayers,onClose:()=>{e.state.conditionWrap=!1},showSelectLayerValue:a=>{e.state.selectValueTemp=a}},{onOnMapControl:i[10]||(i[10]=({action:a,value:t})=>{e.mapControl({action:a,value:t})}),onOnLayerControl:i[11]||(i[11]=({action:a,value:t})=>{e.layerControl({action:a,value:t})})}),null,16)):f("",!0),e.state.layerSelect?(p(),b("div",Be,[C(M,v({class:"position-absolute bottom-100 w-100"},{selectLock:e.state.selectLock,currentLayers:e.state.currentLayers,onClose:()=>{e.state.layerSelect=!1},onChangLayerVisible:a=>{e.layerControl(a)},onChangeOrderLayer:({action:a,value:t})=>{e.layerControl({action:a,value:t})},onLockLayer:()=>{e.state.selectLock=!e.state.selectLock},onDeleteLayer:({action:a,value:t})=>{t.layerName=="all"?e.state.deleteLightbox=!0:e.layerControl({action:a,value:t})},onDeleteLayerAll:()=>{e.state.deleteLightbox=!0}},{setOpacity:({action:a,value:t})=>{e.layerControl({action:a,value:t})}}),null,16,["setOpacity"])])):f("",!0),C(E,{dimensionMapStatus:e.state.toSearchDimensionStatus,currentLayers:e.state.currentLayers,mapCount:e.state.mapCount,openConditionWrap:()=>{e.state.conditionWrap=!e.state.conditionWrap,e.state.layerSelect=!1},openLayerSelect:()=>{e.state.layerSelect=!e.state.layerSelect,e.state.conditionWrap=!1},onLayerControl:({action:a,value:t})=>{e.layerControl({action:a,value:t})},onChangeTarget:a=>{e.changeTarget(a)},onConditionWrap:i[12]||(i[12]=a=>{e.conditionWrap(a)})},null,8,["dimensionMapStatus","currentLayers","mapCount","openConditionWrap","openLayerSelect","onLayerControl","onChangeTarget"])])])}const Ze=ue(_e,[["render",ve]]);export{Ze as default};
//# sourceMappingURL=WebMap-ddaf395f.js.map
