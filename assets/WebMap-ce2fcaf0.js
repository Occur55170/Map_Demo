import{_ as Y,r as X,o as C,c as v,b as c,n as B,w as k,f as T,g as Fe,h as st,p as me,e as pe,i as nt,j as Z,t as M,k as ue,F as U,l as K,u as ot,$ as re,m as rt,v as at,q as We,s as He,x as _e,y as Dt,z as At,A as $e}from"./index-4cdc8671.js";import{V as he,a as lt,E as ze,g as Ue,c as Ft,b as Vt,d as Nt,s as Bt,e as ct,P as Ve,F as dt,f as Gt,M as we,T as Ne,O as jt,h as ut,X as ht,m as Le,C as Wt,i as Ht,j as Ke,k as $t,u as Q,l as Pe,n as O,o as zt,p as Ut,q as R,r as Oe,t as ne,v as Kt,w as ie,x as qt,y as Ee,z as Yt,I as Se,S as Zt,A as qe,B as De,D as Qt,G as Xt,H as Jt,J as mt,K as ei,L as ti,N as ii,Q as Ye,R as si,U as ni}from"./core-14d9128b.js";const pt="/assets/logo-83a41ce3.svg",oi="/assets/2D-m-0cdbc246.svg",ri="/assets/3D-m-4ecf18c0.svg",ai="/assets/vector-m-1fc5cf13.svg",li="/assets/selectVector-m-e4f4d97a.svg",ci="/assets/singleWindow-m-4635df1a.svg",di="/assets/doubleWindow-m-cccef2df.svg";const ui={props:{currentLayers:{type:Array,default:[]},mapCount:{type:Number,default:1},dimensionMapStatus:{type:Boolean,default:!1},openConditionWrap:{type:Function,default:()=>{}},openLayerSelect:{type:Function,default:()=>{}},onLayerControl:{type:Function,default:()=>{}},onChangeTarget:{type:Function,default:()=>{}}},setup(n,{emit:t}){const i=X({toolSwitch:{threeDimensionalBtn:!1,layerConditionBtn:!1,splitWindowBtn:!1},targetNum:1});function e(o,a){Object.keys(i.toolSwitch).forEach(l=>{l===o?i.toolSwitch[o]?i.toolSwitch[o]=!1:i.toolSwitch[o]=!0:i.toolSwitch[l]=!1})}function s(o,a){o==="changeMapCount"&&(i.toolSwitch.splitWindowBtn=!1),n.onLayerControl({action:o,value:a})}function r(){t("conditionWrap")}return{props:n,state:i,toolSwitch:e,onLayerControl:s,conditionWrap:r}}},hi={class:"w-100"},mi={class:"position-fixed top-0 w-100 d-flex justify-content-end flex-wrap"},pi=c("img",{src:pt,class:"w-100"},null,-1),gi={class:"switchControl me-2 d-block rounded-4 p-2",id:"switchControl",style:{"z-index":"99"}},fi={class:"list-unstyled d-flex align-items-center justify-content-around py-2 flex-nowrap w-100 bg-white mb-0"},yi=c("img",{src:oi},null,-1),_i=[yi],Ci=c("img",{src:ri},null,-1),vi=[Ci],bi=c("img",{src:ai},null,-1),wi=[bi],Li=c("img",{src:li},null,-1),Si=[Li],xi={class:"text-white"},Ti=c("img",{src:ci},null,-1),ki=[Ti],Mi=c("img",{src:di},null,-1),Ei=[Mi];function Ii(n,t,i,e,s,r){return C(),v("div",hi,[c("div",mi,[pi,c("div",gi,[c("div",{class:B(["text-white rounded-pill",{active:e.state.targetNum===1}]),onClick:t[0]||(t[0]=()=>{e.state.targetNum=1,e.props.onChangeTarget(1)})},"上",2),c("div",{class:B(["text-white rounded-pill",{active:e.state.targetNum===2}]),onClick:t[1]||(t[1]=()=>{e.state.targetNum=2,e.props.onChangeTarget(2)})},"下",2)])]),c("ul",fi,[c("li",null,[c("div",null,[e.props.dimensionMapStatus?(C(),v("div",{key:0,class:"navbarBtn",onClick:t[2]||(t[2]=k(o=>(e.toolSwitch("threeDimensionalBtn"),e.onLayerControl("changeDimensionMap","3D")),["prevent"]))},_i)):(C(),v("div",{key:1,class:"navbarBtn",onClick:t[3]||(t[3]=k(o=>(e.toolSwitch("threeDimensionalBtn"),e.onLayerControl("changeDimensionMap","2D")),["prevent"]))},vi))])]),c("li",null,[c("div",{class:"navbarBtn",onClick:t[4]||(t[4]=o=>e.props.openConditionWrap())},wi)]),c("li",null,[c("div",{class:"navbarBtn",onClick:t[5]||(t[5]=o=>e.props.openLayerSelect())},Si)]),c("li",null,[c("div",xi,[e.props.mapCount===1?(C(),v("div",{key:0,class:"navbarBtn",onClick:t[6]||(t[6]=k(o=>e.props.onLayerControl({action:"changeMapCount",value:{qty:2}}),["prevent"]))},ki)):T("",!0),e.props.mapCount===2?(C(),v("div",{key:1,class:"navbarBtn",onClick:t[7]||(t[7]=k(o=>e.props.onLayerControl({action:"changeMapCount",value:{qty:1}}),["prevent"]))},Ei)):T("",!0)])])])])}const Ri=Y(ui,[["render",Ii]]);class Pi extends he{constructor(t){super({attributions:t.attributions,wrapX:t.wrapX}),this.resolution=void 0,this.distance=t.distance!==void 0?t.distance:20,this.minDistance=t.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=t.geometryFunction||function(i){const e=i.getGeometry();return lt(e.getType()=="Point",10),e},this.createCustomCluster_=t.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(t.source||null)}clear(t){this.features.length=0,super.clear(t)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(t,i,e){this.source.loadFeatures(t,i,e),i!==this.resolution&&(this.resolution=i,this.refresh())}setDistance(t){this.updateDistance(t,this.minDistance)}setMinDistance(t){this.updateDistance(this.distance,t)}getMinDistance(){return this.minDistance}setSource(t){this.source&&this.source.removeEventListener(ze.CHANGE,this.boundRefresh_),this.source=t,t&&t.addEventListener(ze.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(t,i){const e=t===0?0:Math.min(i,t)/t,s=t!==this.distance||this.interpolationRatio!==e;this.distance=t,this.minDistance=i,this.interpolationRatio=e,s&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;const t=Gt(),i=this.distance*this.resolution,e=this.source.getFeatures(),s={};for(let r=0,o=e.length;r<o;r++){const a=e[r];if(!(Ue(a)in s)){const l=this.geometryFunction(a);if(l){const u=l.getCoordinates();Ft(u,t),Vt(t,i,t);const d=this.source.getFeaturesInExtent(t).filter(function(h){const m=Ue(h);return m in s?!1:(s[m]=!0,!0)});this.features.push(this.createCluster(d,t))}}}}createCluster(t,i){const e=[0,0];for(let a=t.length-1;a>=0;--a){const l=this.geometryFunction(t[a]);l?Nt(e,l.getCoordinates()):t.splice(a,1)}Bt(e,1/t.length);const s=ct(i),r=this.interpolationRatio,o=new Ve([e[0]*(1-r)+s[0]*r,e[1]*(1-r)+s[1]*r]);return this.createCustomCluster_?this.createCustomCluster_(o,t):new dt({geometry:o,features:t})}}const gt=Pi;function Oi(n,t){if(n.match(/^[a-z]+:\/\//i))return n;if(n.match(/^\/\//))return window.location.protocol+n;if(n.match(/^[a-z]+:/i))return n;const i=document.implementation.createHTMLDocument(),e=i.createElement("base"),s=i.createElement("a");return i.head.appendChild(e),i.body.appendChild(s),t&&(e.href=t),s.href=n,s.href}const Di=(()=>{let n=0;const t=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(n+=1,`u${t()}${n}`)})();function q(n){const t=[];for(let i=0,e=n.length;i<e;i++)t.push(n[i]);return t}function xe(n,t){const e=(n.ownerDocument.defaultView||window).getComputedStyle(n).getPropertyValue(t);return e?parseFloat(e.replace("px","")):0}function Ai(n){const t=xe(n,"border-left-width"),i=xe(n,"border-right-width");return n.clientWidth+t+i}function Fi(n){const t=xe(n,"border-top-width"),i=xe(n,"border-bottom-width");return n.clientHeight+t+i}function ft(n,t={}){const i=t.width||Ai(n),e=t.height||Fi(n);return{width:i,height:e}}function Vi(){let n,t;try{t=process}catch{}const i=t&&t.env?t.env.devicePixelRatio:null;return i&&(n=parseInt(i,10),Number.isNaN(n)&&(n=1)),n||window.devicePixelRatio||1}const V=16384;function Ni(n){(n.width>V||n.height>V)&&(n.width>V&&n.height>V?n.width>n.height?(n.height*=V/n.width,n.width=V):(n.width*=V/n.height,n.height=V):n.width>V?(n.height*=V/n.width,n.width=V):(n.width*=V/n.height,n.height=V))}function Te(n){return new Promise((t,i)=>{const e=new Image;e.decode=()=>t(e),e.onload=()=>t(e),e.onerror=i,e.crossOrigin="anonymous",e.decoding="async",e.src=n})}async function Bi(n){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(n)).then(encodeURIComponent).then(t=>`data:image/svg+xml;charset=utf-8,${t}`)}async function Gi(n,t,i){const e="http://www.w3.org/2000/svg",s=document.createElementNS(e,"svg"),r=document.createElementNS(e,"foreignObject");return s.setAttribute("width",`${t}`),s.setAttribute("height",`${i}`),s.setAttribute("viewBox",`0 0 ${t} ${i}`),r.setAttribute("width","100%"),r.setAttribute("height","100%"),r.setAttribute("x","0"),r.setAttribute("y","0"),r.setAttribute("externalResourcesRequired","true"),s.appendChild(r),r.appendChild(n),Bi(s)}const F=(n,t)=>{if(n instanceof t)return!0;const i=Object.getPrototypeOf(n);return i===null?!1:i.constructor.name===t.name||F(i,t)};function ji(n){const t=n.getPropertyValue("content");return`${n.cssText} content: '${t.replace(/'|"/g,"")}';`}function Wi(n){return q(n).map(t=>{const i=n.getPropertyValue(t),e=n.getPropertyPriority(t);return`${t}: ${i}${e?" !important":""};`}).join(" ")}function Hi(n,t,i){const e=`.${n}:${t}`,s=i.cssText?ji(i):Wi(i);return document.createTextNode(`${e}{${s}}`)}function Ze(n,t,i){const e=window.getComputedStyle(n,i),s=e.getPropertyValue("content");if(s===""||s==="none")return;const r=Di();try{t.className=`${t.className} ${r}`}catch{return}const o=document.createElement("style");o.appendChild(Hi(r,i,e)),t.appendChild(o)}function $i(n,t){Ze(n,t,":before"),Ze(n,t,":after")}const Qe="application/font-woff",Xe="image/jpeg",zi={woff:Qe,woff2:Qe,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:Xe,jpeg:Xe,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function Ui(n){const t=/\.([^./]*?)$/g.exec(n);return t?t[1]:""}function Be(n){const t=Ui(n).toLowerCase();return zi[t]||""}function Ki(n){return n.split(/,/)[1]}function Ae(n){return n.search(/^(data:)/)!==-1}function yt(n,t){return`data:${t};base64,${n}`}async function _t(n,t,i){const e=await fetch(n,t);if(e.status===404)throw new Error(`Resource "${e.url}" not found`);const s=await e.blob();return new Promise((r,o)=>{const a=new FileReader;a.onerror=o,a.onloadend=()=>{try{r(i({res:e,result:a.result}))}catch(l){o(l)}},a.readAsDataURL(s)})}const Ie={};function qi(n,t,i){let e=n.replace(/\?.*/,"");return i&&(e=n),/ttf|otf|eot|woff2?/i.test(e)&&(e=e.replace(/.*\//,"")),t?`[${t}]${e}`:e}async function Ge(n,t,i){const e=qi(n,t,i.includeQueryParams);if(Ie[e]!=null)return Ie[e];i.cacheBust&&(n+=(/\?/.test(n)?"&":"?")+new Date().getTime());let s;try{const r=await _t(n,i.fetchRequestInit,({res:o,result:a})=>(t||(t=o.headers.get("Content-Type")||""),Ki(a)));s=yt(r,t)}catch(r){s=i.imagePlaceholder||"";let o=`Failed to fetch resource: ${n}`;r&&(o=typeof r=="string"?r:r.message),o&&console.warn(o)}return Ie[e]=s,s}async function Yi(n){const t=n.toDataURL();return t==="data:,"?n.cloneNode(!1):Te(t)}async function Zi(n,t){if(n.currentSrc){const r=document.createElement("canvas"),o=r.getContext("2d");r.width=n.clientWidth,r.height=n.clientHeight,o==null||o.drawImage(n,0,0,r.width,r.height);const a=r.toDataURL();return Te(a)}const i=n.poster,e=Be(i),s=await Ge(i,e,t);return Te(s)}async function Qi(n){var t;try{if(!((t=n==null?void 0:n.contentDocument)===null||t===void 0)&&t.body)return await ke(n.contentDocument.body,{},!0)}catch{}return n.cloneNode(!1)}async function Xi(n,t){return F(n,HTMLCanvasElement)?Yi(n):F(n,HTMLVideoElement)?Zi(n,t):F(n,HTMLIFrameElement)?Qi(n):n.cloneNode(!1)}const Ji=n=>n.tagName!=null&&n.tagName.toUpperCase()==="SLOT";async function es(n,t,i){var e,s;let r=[];return Ji(n)&&n.assignedNodes?r=q(n.assignedNodes()):F(n,HTMLIFrameElement)&&(!((e=n.contentDocument)===null||e===void 0)&&e.body)?r=q(n.contentDocument.body.childNodes):r=q(((s=n.shadowRoot)!==null&&s!==void 0?s:n).childNodes),r.length===0||F(n,HTMLVideoElement)||await r.reduce((o,a)=>o.then(()=>ke(a,i)).then(l=>{l&&t.appendChild(l)}),Promise.resolve()),t}function ts(n,t){const i=t.style;if(!i)return;const e=window.getComputedStyle(n);e.cssText?(i.cssText=e.cssText,i.transformOrigin=e.transformOrigin):q(e).forEach(s=>{let r=e.getPropertyValue(s);s==="font-size"&&r.endsWith("px")&&(r=`${Math.floor(parseFloat(r.substring(0,r.length-2)))-.1}px`),F(n,HTMLIFrameElement)&&s==="display"&&r==="inline"&&(r="block"),s==="d"&&t.getAttribute("d")&&(r=`path(${t.getAttribute("d")})`),i.setProperty(s,r,e.getPropertyPriority(s))})}function is(n,t){F(n,HTMLTextAreaElement)&&(t.innerHTML=n.value),F(n,HTMLInputElement)&&t.setAttribute("value",n.value)}function ss(n,t){if(F(n,HTMLSelectElement)){const i=t,e=Array.from(i.children).find(s=>n.value===s.getAttribute("value"));e&&e.setAttribute("selected","")}}function ns(n,t){return F(t,Element)&&(ts(n,t),$i(n,t),is(n,t),ss(n,t)),t}async function os(n,t){const i=n.querySelectorAll?n.querySelectorAll("use"):[];if(i.length===0)return n;const e={};for(let r=0;r<i.length;r++){const a=i[r].getAttribute("xlink:href");if(a){const l=n.querySelector(a),u=document.querySelector(a);!l&&u&&!e[a]&&(e[a]=await ke(u,t,!0))}}const s=Object.values(e);if(s.length){const r="http://www.w3.org/1999/xhtml",o=document.createElementNS(r,"svg");o.setAttribute("xmlns",r),o.style.position="absolute",o.style.width="0",o.style.height="0",o.style.overflow="hidden",o.style.display="none";const a=document.createElementNS(r,"defs");o.appendChild(a);for(let l=0;l<s.length;l++)a.appendChild(s[l]);n.appendChild(o)}return n}async function ke(n,t,i){return!i&&t.filter&&!t.filter(n)?null:Promise.resolve(n).then(e=>Xi(e,t)).then(e=>es(n,e,t)).then(e=>ns(n,e)).then(e=>os(e,t))}const Ct=/url\((['"]?)([^'"]+?)\1\)/g,rs=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,as=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function ls(n){const t=n.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}function cs(n){const t=[];return n.replace(Ct,(i,e,s)=>(t.push(s),i)),t.filter(i=>!Ae(i))}async function ds(n,t,i,e,s){try{const r=i?Oi(t,i):t,o=Be(t);let a;if(s){const l=await s(r);a=yt(l,o)}else a=await Ge(r,o,e);return n.replace(ls(t),`$1${a}$3`)}catch{}return n}function us(n,{preferredFontFormat:t}){return t?n.replace(as,i=>{for(;;){const[e,,s]=rs.exec(i)||[];if(!s)return"";if(s===t)return`src: ${e};`}}):n}function vt(n){return n.search(Ct)!==-1}async function bt(n,t,i){if(!vt(n))return n;const e=us(n,i);return cs(e).reduce((r,o)=>r.then(a=>ds(a,o,t,i)),Promise.resolve(e))}async function Ce(n,t,i){var e;const s=(e=t.style)===null||e===void 0?void 0:e.getPropertyValue(n);if(s){const r=await bt(s,null,i);return t.style.setProperty(n,r,t.style.getPropertyPriority(n)),!0}return!1}async function hs(n,t){await Ce("background",n,t)||await Ce("background-image",n,t),await Ce("mask",n,t)||await Ce("mask-image",n,t)}async function ms(n,t){const i=F(n,HTMLImageElement);if(!(i&&!Ae(n.src))&&!(F(n,SVGImageElement)&&!Ae(n.href.baseVal)))return;const e=i?n.src:n.href.baseVal,s=await Ge(e,Be(e),t);await new Promise((r,o)=>{n.onload=r,n.onerror=o;const a=n;a.decode&&(a.decode=r),a.loading==="lazy"&&(a.loading="eager"),i?(n.srcset="",n.src=s):n.href.baseVal=s})}async function ps(n,t){const e=q(n.childNodes).map(s=>wt(s,t));await Promise.all(e).then(()=>n)}async function wt(n,t){F(n,Element)&&(await hs(n,t),await ms(n,t),await ps(n,t))}function gs(n,t){const{style:i}=n;t.backgroundColor&&(i.backgroundColor=t.backgroundColor),t.width&&(i.width=`${t.width}px`),t.height&&(i.height=`${t.height}px`);const e=t.style;return e!=null&&Object.keys(e).forEach(s=>{i[s]=e[s]}),n}const Je={};async function et(n){let t=Je[n];if(t!=null)return t;const e=await(await fetch(n)).text();return t={url:n,cssText:e},Je[n]=t,t}async function tt(n,t){let i=n.cssText;const e=/url\(["']?([^"')]+)["']?\)/g,r=(i.match(/url\([^)]+\)/g)||[]).map(async o=>{let a=o.replace(e,"$1");return a.startsWith("https://")||(a=new URL(a,n.url).href),_t(a,t.fetchRequestInit,({result:l})=>(i=i.replace(o,`url(${l})`),[o,l]))});return Promise.all(r).then(()=>i)}function it(n){if(n==null)return[];const t=[],i=/(\/\*[\s\S]*?\*\/)/gi;let e=n.replace(i,"");const s=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const l=s.exec(e);if(l===null)break;t.push(l[0])}e=e.replace(s,"");const r=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,o="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",a=new RegExp(o,"gi");for(;;){let l=r.exec(e);if(l===null){if(l=a.exec(e),l===null)break;r.lastIndex=a.lastIndex}else a.lastIndex=r.lastIndex;t.push(l[0])}return t}async function fs(n,t){const i=[],e=[];return n.forEach(s=>{if("cssRules"in s)try{q(s.cssRules||[]).forEach((r,o)=>{if(r.type===CSSRule.IMPORT_RULE){let a=o+1;const l=r.href,u=et(l).then(d=>tt(d,t)).then(d=>it(d).forEach(h=>{try{s.insertRule(h,h.startsWith("@import")?a+=1:s.cssRules.length)}catch(m){console.error("Error inserting rule from remote css",{rule:h,error:m})}})).catch(d=>{console.error("Error loading remote css",d.toString())});e.push(u)}})}catch(r){const o=n.find(a=>a.href==null)||document.styleSheets[0];s.href!=null&&e.push(et(s.href).then(a=>tt(a,t)).then(a=>it(a).forEach(l=>{o.insertRule(l,s.cssRules.length)})).catch(a=>{console.error("Error loading remote stylesheet",a)})),console.error("Error inlining remote css file",r)}}),Promise.all(e).then(()=>(n.forEach(s=>{if("cssRules"in s)try{q(s.cssRules||[]).forEach(r=>{i.push(r)})}catch(r){console.error(`Error while reading CSS rules from ${s.href}`,r)}}),i))}function ys(n){return n.filter(t=>t.type===CSSRule.FONT_FACE_RULE).filter(t=>vt(t.style.getPropertyValue("src")))}async function _s(n,t){if(n.ownerDocument==null)throw new Error("Provided element is not within a Document");const i=q(n.ownerDocument.styleSheets),e=await fs(i,t);return ys(e)}async function Cs(n,t){const i=await _s(n,t);return(await Promise.all(i.map(s=>{const r=s.parentStyleSheet?s.parentStyleSheet.href:null;return bt(s.cssText,r,t)}))).join(`
`)}async function vs(n,t){const i=t.fontEmbedCSS!=null?t.fontEmbedCSS:t.skipFonts?null:await Cs(n,t);if(i){const e=document.createElement("style"),s=document.createTextNode(i);e.appendChild(s),n.firstChild?n.insertBefore(e,n.firstChild):n.appendChild(e)}}async function bs(n,t={}){const{width:i,height:e}=ft(n,t),s=await ke(n,t,!0);return await vs(s,t),await wt(s,t),gs(s,t),await Gi(s,i,e)}async function ws(n,t={}){const{width:i,height:e}=ft(n,t),s=await bs(n,t),r=await Te(s),o=document.createElement("canvas"),a=o.getContext("2d"),l=t.pixelRatio||Vi(),u=t.canvasWidth||i,d=t.canvasHeight||e;return o.width=u*l,o.height=d*l,t.skipAutoScale||Ni(o),o.style.width=`${u}`,o.style.height=`${d}`,t.backgroundColor&&(a.fillStyle=t.backgroundColor,a.fillRect(0,0,o.width,o.height)),a.drawImage(r,0,0,o.width,o.height),o}async function Ls(n,t={}){return(await ws(n,t)).toDataURL()}const Ss="/assets/currentPosition-33b00a21.svg";const xs={props:{coordinate:{type:Object,default:{}}},setup(n,{emit:t}){let i;const e=X({imgSrc:"dddd"});return Fe(async()=>{i=new we({target:"imgMap",layers:[new Ne({preload:1/0,crossOrigin:"Anonymous",source:new jt})],view:new ut({projection:"EPSG:4326",center:n.coordinate,zoom:14})}),i.once("loadend",function(){Ls(i.getTargetElement()).then(function(s){document.getElementById("imgMap")!==null&&(document.getElementById("imgMap").remove(),e.imgSrc=s)})})}),{props:n,state:e}}},Ts=n=>(me("data-v-6ba1c373"),n=n(),pe(),n),ks={class:"position-relative",style:{overflow:"hidden"}},Ms=Ts(()=>c("div",{id:"imgMap",class:"position-absolute",style:{width:"600px",height:"600px"}},null,-1));function Es(n,t,i,e,s,r){return C(),v("div",ks,[Ms,c("div",{style:st([{background:`url('${e.state.imgSrc}')`,"background-size":"cover"},{width:"100%",height:"200px"}])},null,4)])}const Is=Y(xs,[["render",Es],["__scopeId","data-v-6ba1c373"]]),Rs="/assets/vector-a2cf21ef.svg";const Ps={props:{popup:{type:Object,default:{}},closeMapData:{Type:Function,default:()=>{}},maxHeight:{Type:Number,default:0},coordinate:{type:Object,default:{}}},setup(n,{emit:t}){const i=ot(),e=X({type:0,media:"photo",scrollY:!1,tribeData:{data:{}}});async function s(o){return await re.ajax({url:`https://api.edtest.site/tribe?tribeCode=${o}`,method:"GET"}).done(l=>l).fail(l=>(console.log("Fail",l),!1))}async function r(o){return await re.ajax({url:`https://api.edtest.site/historicalDiseaster?id=${o}`,method:"GET"}).done(l=>l).fail(l=>(console.log("Fail",l),!1))}return nt(n.popup,async o=>{if(o.popupData=="新竹縣原住民部落範圍"){s(o.popupId).then(a=>{e.type=1,e.tribeData=a});return}if(n.popup.popupData=="近年歷史災害82處部落點位"){r(`近年歷史災害82處部落點位.${n.popup.popupId}`).then(a=>{e.type=2,e.tribeData=a.data});return}}),Fe(async()=>{if(n.popup.popupData=="新竹縣原住民部落範圍"){s(n.popup.popupId).then(o=>{e.type=1,e.tribeData=o});return}if(n.popup.popupData=="近年歷史災害82處部落點位"){r(`近年歷史災害82處部落點位.${n.popup.popupId}`).then(o=>{e.type=2,e.tribeData=o.data});return}}),{router:i,props:n,state:e}}},W=n=>(me("data-v-13bd0946"),n=n(),pe(),n),Os={key:0},Ds=W(()=>c("div",{class:"row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold"},[c("p",null,"詳細資訊")],-1)),As={class:"row mx-0 align-items-center p-2 position-relative"},Fs={class:"d-flex flex-nowrap align-items-center justify-content-between my-2"},Vs={class:""},Ns={href:"#"},Bs=W(()=>c("img",{src:Rs,alt:""},null,-1)),Gs={class:"border-bottom row flex-nowrap p-2 my-3 cursor-pointer mx-0"},js={key:0,class:"py-2 px-4"},Ws={class:"d-flex flex-wrap justify-content-between"},Hs={class:"w-50 mb-4"},$s={class:"mb-0"},zs=["src"],Us={key:1,class:"py-2 px-4"},Ks=W(()=>c("div",null,"尚無影片",-1)),qs=[Ks],Ys={key:1},Zs={class:"row mx-0 align-items-center px-2 py-4 position-relative"},Qs={key:0,class:"row mx-0 mb-2"},Xs=W(()=>c("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"事件:",-1)),Js={class:"col-8 py-1 px-2 bg-grey-light text-start"},en={key:1,class:"row mx-0 mb-2"},tn=W(()=>c("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"發生時間:",-1)),sn={class:"col-8 py-1 px-2 bg-grey-light text-start"},nn={key:2,class:"row mx-0 mb-2"},on=W(()=>c("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"鄉鎮: ",-1)),rn={class:"col-8 py-1 px-2 bg-grey-light text-start"},an={key:3,class:"row mx-0 mb-2"},ln=W(()=>c("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"地方: ",-1)),cn={class:"col-8 py-1 px-2 bg-grey-light text-start"},dn={key:4,class:"row mx-0 mb-2"},un=W(()=>c("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"村落: ",-1)),hn={class:"col-8 py-1 px-2 bg-grey-light text-start"},mn={key:5,class:"row mx-0 mb-2"},pn=W(()=>c("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"災害種類: ",-1)),gn={class:"col-8 py-1 px-2 bg-grey-light text-start"},fn={key:6,class:"row mx-0 mb-2"},yn=W(()=>c("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"描述: ",-1)),_n={class:"col-8 py-1 px-2 bg-grey-light text-start"};function Cn(n,t,i,e,s,r){var a,l,u,d,h,m,f,y,g,_,E,b,p,w,L,I,x,P,G,H,j;const o=Is;return C(),v("div",{class:"bg-white rounded py-2",style:st([{"overflow-y":"auto"},{"max-height":e.props.maxHeight+"px",width:"480px"}])},[e.state.type===1?(C(),v("div",Os,[Ds,Z(o,{coordinate:e.props.popup.coordinate,type:e.state.type},null,8,["coordinate","type"]),c("div",As,[c("div",Fs,[c("span",Vs,M((u=(l=(a=e.state)==null?void 0:a.tribeData)==null?void 0:l.basicInformation)==null?void 0:u.tribeName),1),c("div",{class:"p-2 bg-steel w-auto text-white d-inline-block rounded-2 cursor-pointer",onClick:t[0]||(t[0]=()=>{e.router.push({path:`/mapDetails/${e.props.popup.popupId}`})})},"更多資訊")]),c("p",null,"描述: "+M((m=(h=(d=e.state)==null?void 0:d.tribeData)==null?void 0:h.basicInformation)==null?void 0:m.description),1),c("p",null,M((g=(y=(f=e.state)==null?void 0:f.tribeData)==null?void 0:y.basicInformation)==null?void 0:g.area),1),c("a",Ns,[Bs,ue(" "+M((w=(p=(b=(E=(_=e.state)==null?void 0:_.tribeData)==null?void 0:E.basicInformation)==null?void 0:b.coordinates)==null?void 0:p.WGS84)==null?void 0:w.lat)+" , "+M((G=(P=(x=(I=(L=e.state)==null?void 0:L.tribeData)==null?void 0:I.basicInformation)==null?void 0:x.coordinates)==null?void 0:P.WGS84)==null?void 0:G.lng),1)])]),c("div",null,[c("div",Gs,[c("div",{class:"col-6 cursor-pointer",onClick:t[1]||(t[1]=$=>e.state.media="photo")},"相片"),c("div",{class:"col-6 cursor-pointer",onClick:t[2]||(t[2]=$=>e.state.media="video")},"影片")]),e.state.media==="photo"?(C(),v("div",js,[c("div",Ws,[(C(!0),v(U,null,K((j=(H=e.state)==null?void 0:H.tribeData)==null?void 0:j.culturalLandscape,$=>(C(),v("div",Hs,[c("p",$s,M($.name),1),c("img",{src:$.image,alt:"",class:"w-100"},null,8,zs)]))),256))])])):T("",!0),e.state.media==="video"?(C(),v("div",Us,qs)):T("",!0)])])):T("",!0),e.state.type===2?(C(),v("div",Ys,[c("div",Zs,[e.state.tribeData.event?(C(),v("div",Qs,[Xs,c("div",Js,M(e.state.tribeData.event),1)])):T("",!0),e.state.tribeData.date?(C(),v("div",en,[tn,c("div",sn,M(e.state.tribeData.date),1)])):T("",!0),e.state.tribeData.township?(C(),v("div",nn,[on,c("div",rn,M(e.state.tribeData.township),1)])):T("",!0),e.state.tribeData.village?(C(),v("div",an,[ln,c("div",cn,M(e.state.tribeData.village),1)])):T("",!0),e.state.tribeData.place?(C(),v("div",dn,[un,c("div",hn,M(e.state.tribeData.place),1)])):T("",!0),e.state.tribeData.category?(C(),v("div",mn,[pn,c("div",gn,M(e.state.tribeData.category),1)])):T("",!0),e.state.tribeData.description?(C(),v("div",fn,[yn,c("div",_n,M(e.state.tribeData.description),1)])):T("",!0)])])):T("",!0)],4)}const vn=Y(Ps,[["render",Cn],["__scopeId","data-v-13bd0946"]]);const bn={props:{onClose:{type:Function,default:()=>{}},onDeleteLayer:{type:Function,default:()=>{}},onLockLayer:{type:Function,default:()=>{}},currentLayers:{type:Array,default:[]},selectLock:{type:Boolean,default:!1},onLayerControl:{type:Function,default:()=>{}}},setup(n,{emit:t}){const i=X({});function e(s){n.onLayerControl({action:"setOpacity",value:{key:s.target.getAttribute("nodeindex"),value:s.target.value}});const r=parseFloat(Number(s.target.value));document.getElementById(`opacityControl${s.target.getAttribute("nodeindex")}`).innerText=r.toFixed(2)}return{props:n,state:i,updateOpacity:e}}},J=n=>(me("data-v-8cce132a"),n=n(),pe(),n),wn={class:"layerSelect bg-white"},Ln={class:"row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold"},Sn=J(()=>c("p",{class:"mb-0 fs-5"},"已選擇的圖層",-1)),xn=J(()=>c("hr",{class:"my-0"},null,-1)),Tn={class:"py-3 px-4 content"},kn={class:"allControl d-flex align-items-center justify-content-end mb-0"},Mn=J(()=>c("svg",{viewBox:"0 0 25 24",fill:"currentColor"},[c("path",{d:"M8.02381 9.33333H14.881V7.80952C14.881 7.1746 14.6587 6.63492 14.2143 6.19048C13.7698 5.74603 13.2302 5.52381 12.5952 5.52381C11.9603 5.52381 11.4206 5.74603 10.9762 6.19048C10.5317 6.63492 10.3095 7.1746 10.3095 7.80952H8.78571C8.78571 6.75556 9.15727 5.85702 9.90038 5.1139C10.643 4.3713 11.5413 4 12.5952 4C13.6492 4 14.5477 4.3713 15.2909 5.1139C16.0335 5.85702 16.4048 6.75556 16.4048 7.80952V9.33333H17.1667C17.5857 9.33333 17.9446 9.48241 18.2432 9.78057C18.5414 10.0792 18.6905 10.4381 18.6905 10.8571V18.4762C18.6905 18.8952 18.5414 19.2541 18.2432 19.5528C17.9446 19.8509 17.5857 20 17.1667 20H8.02381C7.60476 20 7.24616 19.8509 6.948 19.5528C6.64933 19.2541 6.5 18.8952 6.5 18.4762V10.8571C6.5 10.4381 6.64933 10.0792 6.948 9.78057C7.24616 9.48241 7.60476 9.33333 8.02381 9.33333ZM12.5952 16.1905C13.0143 16.1905 13.3731 16.0414 13.6718 15.7432C13.97 15.4446 14.119 15.0857 14.119 14.6667C14.119 14.2476 13.97 13.8888 13.6718 13.5901C13.3731 13.2919 13.0143 13.1429 12.5952 13.1429C12.1762 13.1429 11.8176 13.2919 11.5194 13.5901C11.2208 13.8888 11.0714 14.2476 11.0714 14.6667C11.0714 15.0857 11.2208 15.4446 11.5194 15.7432C11.8176 16.0414 12.1762 16.1905 12.5952 16.1905Z"})],-1)),En=J(()=>c("svg",{viewBox:"0 0 25 24",fill:"currentColor"},[c("path",{d:"M7.5 21C6.95 21 6.47933 20.8043 6.088 20.413C5.696 20.021 5.5 19.55 5.5 19V6H4.5V4H9.5V3H15.5V4H20.5V6H19.5V19C19.5 19.55 19.3043 20.021 18.913 20.413C18.521 20.8043 18.05 21 17.5 21H7.5ZM9.5 17H11.5V8H9.5V17ZM13.5 17H15.5V8H13.5V17Z"})],-1)),In={class:"list-unstyled d-flex flex-wrap flex-column-reverse"},Rn={key:0,class:"d-flex justify-content-between align-items-center border-bottom py-2 flex-wrap"},Pn={class:"tool"},On=["onClick"],Dn=J(()=>c("svg",{viewBox:"0 0 25 24",fill:"currentColor"},[c("path",{d:"M9.49991 19.84H15.4999V11.84H20.3399L12.4999 4.00003L4.65991 11.84H9.49991V19.84Z",fill:"#808080"})],-1)),An=[Dn],Fn=["onClick"],Vn=J(()=>c("svg",{viewBox:"0 0 25 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[c("path",{d:"M9.49991 4H15.4999V12H20.3399L12.4999 19.84L4.65991 12H9.49991V4Z",fill:"#808080"})],-1)),Nn=[Vn],Bn=["onClick"],Gn=J(()=>c("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[c("path",{d:"M12.3333 10C11.8029 10 11.2942 10.2107 10.9191 10.5858C10.544 10.9609 10.3333 11.4696 10.3333 12C10.3333 12.5304 10.544 13.0391 10.9191 13.4142C11.2942 13.7893 11.8029 14 12.3333 14C12.8638 14 13.3725 13.7893 13.7475 13.4142C14.1226 13.0391 14.3333 12.5304 14.3333 12C14.3333 11.4696 14.1226 10.9609 13.7475 10.5858C13.3725 10.2107 12.8638 10 12.3333 10ZM12.3333 15.3333C11.4493 15.3333 10.6014 14.9821 9.97631 14.357C9.35119 13.7319 9 12.8841 9 12C9 11.1159 9.35119 10.2681 9.97631 9.64298C10.6014 9.01786 11.4493 8.66667 12.3333 8.66667C13.2174 8.66667 14.0652 9.01786 14.6904 9.64298C15.3155 10.2681 15.6667 11.1159 15.6667 12C15.6667 12.8841 15.3155 13.7319 14.6904 14.357C14.0652 14.9821 13.2174 15.3333 12.3333 15.3333ZM12.3333 7C9 7 6.15333 9.07333 5 12C6.15333 14.9267 9 17 12.3333 17C15.6667 17 18.5133 14.9267 19.6667 12C18.5133 9.07333 15.6667 7 12.3333 7Z",fill:"#808080"})],-1)),jn=[Gn],Wn=["onClick"],Hn=J(()=>c("svg",{viewBox:"0 0 25 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[c("path",{d:"M7.5 21C6.95 21 6.47933 20.8043 6.088 20.413C5.696 20.021 5.5 19.55 5.5 19V6H4.5V4H9.5V3H15.5V4H20.5V6H19.5V19C19.5 19.55 19.3043 20.021 18.913 20.413C18.521 20.8043 18.05 21 17.5 21H7.5ZM9.5 17H11.5V8H9.5V17ZM13.5 17H15.5V8H13.5V17Z",fill:"#808080"})],-1)),$n=[Hn],zn={class:"w-100 mt-2 d-flex align-items-center"},Un=["nodeIndex"],Kn=["id"];function qn(n,t,i,e,s,r){return C(),v("div",wn,[c("div",Ln,[Sn,c("a",{href:"#",class:"closeBtn bg-dark text-decoration-none rounded-circle position-absolute d-flex align-items-center justify-content-center",onClick:t[0]||(t[0]=k((...o)=>e.props.onClose&&e.props.onClose(...o),["prevent"]))})]),xn,c("div",Tn,[c("div",kn,[c("a",{href:"",class:B(["d-flex align-items-center text-decoration-none me-4",{lockUp:e.props.selectLock,unlock:!e.props.selectLock}]),onClick:t[1]||(t[1]=k(()=>{e.props.onLockLayer()},["prevent"]))},[Mn,ue(" 鎖定圖層 ")],2),c("a",{href:"",class:B(["d-flex align-items-center text-decoration-none",{disabled:e.props.currentLayers.length<=1}]),onClick:t[2]||(t[2]=k(()=>{e.props.currentLayers.length>0&&e.props.onDeleteLayer({action:"selectLayerMode",value:{layerName:"all"}})},["prevent"]))},[En,ue(" 全部刪除 ")],2)]),c("ul",In,[(C(!0),v(U,null,K(e.props.currentLayers,(o,a)=>(C(),v("li",null,[o.id?(C(),v("div",Rn,[c("div",null,M(o==null?void 0:o.label),1),c("div",Pn,[c("a",{href:"",onClick:k(l=>e.props.onLayerControl({action:"changeOrder",value:{movement:"up",id:o.id,key:a}}),["prevent"])},An,8,On),c("a",{href:"",onClick:k(l=>e.props.onLayerControl({action:"changeOrder",value:{movement:"down",id:o.id,key:a}}),["prevent"])},Nn,8,Fn),c("a",{href:"",class:B({Invisible:!(o!=null&&o.visible)}),onClick:k(()=>{e.props.onLayerControl({action:"changeLayerVisible",value:{key:a}})},["prevent"])},jn,10,Bn),c("a",{href:"",onClick:k(l=>e.props.onDeleteLayer({action:"selectLayerMode",value:{id:o==null?void 0:o.id}}),["prevent"])},$n,8,Wn)]),c("label",zn,[c("input",{id:"opacity-input",class:"w-75 me-2",type:"range",min:"0",max:"1",step:"0.01",value:"1",nodeIndex:a,onInput:t[3]||(t[3]=(...l)=>e.updateOpacity&&e.updateOpacity(...l))},null,40,Un),c("span",{id:`opacityControl${a}`},"1",8,Kn)])])):T("",!0)]))),256))])])])}const Yn=Y(bn,[["render",qn],["__scopeId","data-v-8cce132a"]]);let ce=[];const ve={getBaseMapData:n=>{let t;return Number.isInteger(n)?t=ce[n]:t=n.layer,new Ne({preload:1/0,name:t.name,label:t.label,type:t.mapType,baseId:t.baseId,source:new ht({url:t.url}),crossOrigin:"anonymous"})},setBaseMapData:n=>{ce=n},getCurrentBase:()=>ce.filter(n=>n.onCurrent),showBaseMapData:()=>{console.log(ce)}};function Zn(){return ce}const Qn={props:{onClose:{type:Function,default:()=>{}},mapLayers:{type:Array,default:[]},currentLayers:{type:Array,default:[]},showSelectLayerValue:{type:Function,default:()=>{}},selectLayerOption:{type:Object,default:{}},tribeQuery:{type:Object,default:{}},moveToMap:{type:Function,default:()=>{}}},setup(n,{emit:t}){const i=Le,e=ot(),s=X({DropDown:null,TilesListValue:0,conditionYear:"",conditionTown:"",selectLayerOption:[]});function r(m,f){t("onLayerControl",{action:m,value:f})}function o(m){s.DropDown!==m?s.DropDown=m:s.DropDown=null}function a(m,f){let y=m.target.checked||typeof m.target.checked==" ";r("layerMode",{checked:y,nodeIndex:f.nodeIndex,subNodeIndex:f.subNodeIndex,nestedSubNodeIndex:String(f.nestedSubNodeIndex)?f.nestedSubNodeIndex:void 0,id:f.single_tiles||!m.target.selectedOptions?f.id:m.target.selectedOptions[0].id})}function l(m){s.conditionYear=m.target.value,d()}function u(m){s.conditionTown=m.target.value,d()}async function d(){const m=await re.ajax(`https://api.edtest.site/tribes?${"years="+s.conditionYear}&${"township="+s.conditionTown}`,"GET");s.selectLayerOption=m}function h(m){let f=s.selectLayerOption.find(y=>y.tribeCode===m.target.value);n.moveToMap(f.coordinates)}return nt(()=>s.TilesListValue,(m,f)=>{n.showSelectLayerValue(m)}),{props:n,state:s,router:e,mapList:i,onLayerControl:r,openLayerList:o,LayerCheckBoxChange:a,tribeYear:l,tribeTown:u,moveMap:h}}},Lt=n=>(me("data-v-a7e20171"),n=n(),pe(),n),Xn={class:"condition bg-white"},Jn={class:"row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold border-bottom"},eo=Lt(()=>c("p",{class:"mb-0 fs-5"},"圖層選項",-1)),to={class:"py-3 px-4 content"},io={class:"mb-2 landBoundary"},so={class:"mb-2"},no=["onClick"],oo=Lt(()=>c("path",{fill:"currentColor",d:"M8 5v14l11-7z"},null,-1)),ro=[oo],ao={class:"ms-3 mb-1"},lo={key:0},co=["checked","onChange"],uo={key:0},ho={key:0},mo=["value"],po=["value"],go=["value"],fo={key:1},yo=["checked","onChange"],_o=["onChange"],Co=["value","id"];function vo(n,t,i,e,s,r){return C(),v("div",Xn,[c("div",Jn,[eo,c("a",{href:"#",class:"closeBtn bg-dark text-decoration-none rounded-circle position-absolute d-flex align-items-center justify-content-center",onClick:t[0]||(t[0]=k((...o)=>e.props.onClose&&e.props.onClose(...o),["prevent"]))})]),c("div",to,[c("div",io,[(C(!0),v(U,null,K(e.props.mapLayers,(o,a)=>(C(),v("div",so,[c("div",{class:"title d-flex align-items-center fw-bold text-black order-1 mb-1 text-decoration-none",onClick:l=>e.openLayerList(a)},[c("div",{class:B(o.groupClass)},null,2),c("div",null,M(o.label),1),(C(),v("svg",{viewBox:"0 0 24 24",class:B({openTitle:e.state.DropDown==a})},ro,2))],8,no),e.state.DropDown==a?(C(!0),v(U,{key:0},K(o.layers,(l,u)=>(C(),v("div",ao,[l.single_tiles?(C(),v("div",lo,[c("input",{type:"checkbox",checked:e.props.currentLayers.some(d=>d.id===l.id),onChange:d=>{e.LayerCheckBoxChange(d,{nodeIndex:a,subNode:l,subNodeIndex:u,nestedSubNodeIndex:"",single_tiles:l.single_tiles,id:l.id})}},null,40,co),ue(" "+M(l.title)+" ",1),(C(),v("div",uo,[l.id==="node4_subNode0_nestedSubNodeundefined"?(C(),v("div",ho,[e.props.tribeQuery.years!==void 0?(C(),v("select",{key:0,class:"me-2",onChange:t[1]||(t[1]=(...d)=>e.tribeYear&&e.tribeYear(...d)),placeholder:"請選擇年度"},[(C(!0),v(U,null,K(e.props.tribeQuery.years,(d,h)=>(C(),v("option",{value:d},M(d),9,mo))),256))],32)):T("",!0),e.props.tribeQuery.township!==void 0?(C(),v("select",{key:1,class:"me-2",onChange:t[2]||(t[2]=(...d)=>e.tribeTown&&e.tribeTown(...d)),placeholder:"請選擇鄉鎮"},[(C(!0),v(U,null,K(e.props.tribeQuery.township,(d,h)=>(C(),v("option",{value:d},M(d),9,po))),256))],32)):T("",!0),e.state.selectLayerOption.length!==0?(C(),v("select",{key:2,class:"me-2",onChange:t[3]||(t[3]=(...d)=>e.moveMap&&e.moveMap(...d))},[(C(!0),v(U,null,K(e.state.selectLayerOption,(d,h)=>(C(),v("option",{value:d.tribeCode},M(d.tribeName),9,go))),256))],32)):T("",!0)])):T("",!0)]))])):(C(),v("div",fo,[c("input",{type:"checkbox",checked:e.props.currentLayers.some(d=>{let h=e.mapList.getLayerIndex(d.id);return h.nodeIndex==a&&h.subNodeIndex==u}),onChange:d=>{e.LayerCheckBoxChange(d,{nodeIndex:a,subNode:l,subNodeIndex:u,nestedSubNodeIndex:"",single_tiles:l.single_tiles,id:l.id})}},null,40,yo),ue(" "+M(l.title)+" ",1),rt(c("select",{name:"",id:"",class:"ms-3","onUpdate:modelValue":t[4]||(t[4]=d=>e.state.TilesListValue=d),onChange:d=>{e.LayerCheckBoxChange(d,{nodeIndex:a,subNode:l,subNodeIndex:u,nestedSubNodeIndex:e.state.TilesListValue,single_tiles:l.single_tiles,id:l.id})}},[(C(!0),v(U,null,K(l.tiles_list,(d,h)=>(C(),v("option",{value:h,id:d.id},M(d.title),9,Co))),256))],40,_o),[[at,e.state.TilesListValue]])]))]))),256)):T("",!0)]))),256))])])])}const bo=Y(Qn,[["render",vo],["__scopeId","data-v-a7e20171"]]),wo="/assets/2D-70e1bbad.svg",Lo="/assets/3D-cb71f302.svg",So="/assets/baseLayer-3608307c.svg",St="/assets/singleWindow-1afc73e5.svg",xt="/assets/doubleWindows-82f012fb.svg";const xo={props:{currentLayers:{type:Array,default:[]},mapCount:{type:Number,default:1},dimensionMapStatus:{type:Boolean,default:!1}},setup(n,{emit:t}){const i=X({toolSwitch:{threeDimensionalBtn:!1,layerConditionBtn:!1,splitWindowBtn:!1},targetNum:1});function e(a,l){Object.keys(i.toolSwitch).forEach(u=>{u===a?i.toolSwitch[a]?i.toolSwitch[a]=!1:i.toolSwitch[a]=!0:i.toolSwitch[u]=!1})}function s(a,l){a==="changeMapCount"&&(i.toolSwitch.splitWindowBtn=!1),t("onLayerControl",{action:a,value:l})}function r(){t("conditionWrap")}function o(a){i.targetNum=a,t("onChangeTarget",a)}return{props:n,state:i,toolSwitch:e,onLayerControl:s,conditionWrap:r,onChangeTarget:o}}},ge=n=>(me("data-v-ad9286bd"),n=n(),pe(),n),To={class:"list-unstyled d-flex align-items-center flex-nowrap w-full"},ko={class:"me-4 position-relative"},Mo={class:"MapFeatureBtn text-white"},Eo=ge(()=>c("img",{src:wo},null,-1)),Io=[Eo],Ro=ge(()=>c("img",{src:Lo},null,-1)),Po=[Ro],Oo={class:"me-4 position-relative"},Do=ge(()=>c("img",{src:So,alt:""},null,-1)),Ao=[Do],Fo={class:"me-4 position-relative"},Vo={key:0,src:St,alt:""},No={key:1,src:xt,alt:""},Bo={key:0,class:"list-unstyled position-absolute start-0 top-100 p-0"},Go={class:"mt-2"},jo=ge(()=>c("img",{src:St,alt:""},null,-1)),Wo=[jo],Ho={class:"mt-2"},$o=ge(()=>c("img",{src:xt,alt:""},null,-1)),zo=[$o],Uo={class:"switchControl d-flex position-fixed rounded-pill translate-middle-x p-2",id:"switchControl",style:{"z-index":"99"}};function Ko(n,t,i,e,s,r){return C(),v("div",null,[c("ul",To,[c("li",ko,[c("div",Mo,[e.props.dimensionMapStatus?(C(),v("a",{key:0,href:"",onClick:t[0]||(t[0]=k(o=>(e.toolSwitch("threeDimensionalBtn"),e.onLayerControl("changeDimensionMap","3D")),["prevent"]))},Io)):(C(),v("a",{key:1,href:"",onClick:t[1]||(t[1]=k(o=>(e.toolSwitch("threeDimensionalBtn"),e.onLayerControl("changeDimensionMap","2D")),["prevent"]))},Po))])]),c("li",Oo,[c("a",{href:"",class:"MapFeatureBtn text-white",onClick:t[2]||(t[2]=k(o=>(e.toolSwitch("layerConditionBtn"),e.conditionWrap()),["prevent"]))},Ao)]),c("li",Fo,[c("a",{href:"",class:"MapFeatureBtn text-white",onClick:t[3]||(t[3]=k(o=>e.toolSwitch("splitWindowBtn"),["prevent"]))},[e.props.mapCount===1?(C(),v("img",Vo)):T("",!0),e.props.mapCount===2?(C(),v("img",No)):T("",!0)]),e.state.toolSwitch.splitWindowBtn?(C(),v("ul",Bo,[c("li",Go,[c("a",{href:"",class:"text-white MapFeatureBtn",onClick:t[4]||(t[4]=k(o=>e.onLayerControl("changeMapCount",{qty:1}),["prevent"]))},Wo)]),c("li",Ho,[c("a",{href:"",class:"text-white MapFeatureBtn",onClick:t[5]||(t[5]=k(o=>e.onLayerControl("changeMapCount",{qty:2}),["prevent"]))},zo)])])):T("",!0)])]),c("div",Uo,[c("div",{class:B(["fs-3 text-white rounded-pill",{active:e.state.targetNum===1}]),onClick:t[6]||(t[6]=()=>{e.onChangeTarget(1)})},"左",2),c("div",{class:B(["fs-3 text-white rounded-pill",{active:e.state.targetNum===2}]),onClick:t[7]||(t[7]=()=>{e.onChangeTarget(2)})},"右",2)])])}const qo=Y(xo,[["render",Ko],["__scopeId","data-v-ad9286bd"]]);const Yo={props:{baseMapList:{type:Array,default:[]},onChangeBaseMaps:{type:Function,default:()=>{}}},setup(n,{emit:t}){const i=X({selectMap:0,mapSourceList:[]});function e(){let s="baseMap",r=n.baseMapList.find(o=>o.baseId===i.selectMap);n.onChangeBaseMaps({action:s,value:r})}return{state:i,props:n,onChangeBaseMaps:e}}},Zo=["value"];function Qo(n,t,i,e,s,r){return C(),v("div",null,[rt(c("select",{name:"",id:"","onUpdate:modelValue":t[0]||(t[0]=o=>e.state.selectMap=o),onChange:t[1]||(t[1]=o=>{e.onChangeBaseMaps(o)})},[(C(!0),v(U,null,K(e.props.baseMapList,(o,a)=>(C(),v("option",{key:a,value:o.baseId},M(o.label),9,Zo))),128))],544),[[at,e.state.selectMap]])])}const Xo=Y(Yo,[["render",Qo],["__scopeId","data-v-3d748ef3"]]),Jo="/assets/zoomIn-c80b5dd3.svg",er="/assets/zoomOut-88993246.svg",tr="/assets/compass-1c1efd7a.svg",ir="/assets/location-b52d62b2.svg",sr="/assets/zoom-8acdf5b3.svg",nr={props:{id:{Type:String,default:0},map:{}},setup(n,{emit:t}){function i(e){t("onMapControl",{action:e})}return{onMapControl:i}}},or={class:"d-flex flex-nowrap flex-column"},rr=c("img",{src:Jo,alt:"zoomIn"},null,-1),ar=[rr],lr=c("img",{src:er,alt:"zoomOut"},null,-1),cr=[lr],dr=c("img",{src:tr,alt:"compass"},null,-1),ur=[dr],hr=c("img",{src:ir,alt:"location"},null,-1),mr=[hr],pr=c("img",{src:sr,alt:"zoom"},null,-1),gr=[pr];function fr(n,t,i,e,s,r){return C(),v("div",or,[c("a",{href:"",class:"d-none d-sm-block order-1 mb-0",onClick:t[0]||(t[0]=k(o=>e.onMapControl("In"),["prevent"]))},ar),c("a",{href:"",class:"d-none d-sm-block order-1 mb-2",onClick:t[1]||(t[1]=k(o=>e.onMapControl("Out"),["prevent"]))},cr),c("a",{href:"",class:"order-1 mb-2",onClick:t[2]||(t[2]=k(o=>e.onMapControl("toNorth"),["prevent"]))},ur),c("a",{href:"",class:"order-1 mb-2",onClick:t[3]||(t[3]=k(o=>e.onMapControl("moveTo"),["prevent"]))},mr),c("a",{href:"",class:"order-1 mb-2",onClick:t[4]||(t[4]=k(o=>e.onMapControl("fullScreen"),["prevent"]))},gr)])}const yr=Y(nr,[["render",fr]]),Re="units",_r=[1,2,5],ae=25.4/.28;class Cr extends Wt{constructor(t){t=t||{};const i=document.createElement("div");i.style.pointerEvents="none",super({element:i,render:t.render,target:t.target}),this.on,this.once,this.un;const e=t.className!==void 0?t.className:t.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=e+"-inner",this.element.className=e+" "+Ht,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=t.minWidth!==void 0?t.minWidth:64,this.maxWidth_=t.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(Re,this.handleUnitsChanged_),this.setUnits(t.units||"metric"),this.scaleBar_=t.bar||!1,this.scaleBarSteps_=t.steps||4,this.scaleBarText_=t.text||!1,this.dpi_=t.dpi||void 0}getUnits(){return this.get(Re)}handleUnitsChanged_(){this.updateElement_()}setUnits(t){this.set(Re,t)}setDpi(t){this.dpi_=t}updateElement_(){const t=this.viewState_;if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const i=t.center,e=t.projection,s=this.getUnits(),r=s=="degrees"?"degrees":"m";let o=Ke(e,t.resolution,i,r);const a=this.minWidth_*(this.dpi_||ae)/ae,l=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||ae)/ae:void 0;let u=a*o,d="";if(s=="degrees"){const p=$t.degrees;u*=p,u<p/60?(d="″",o*=3600):u<p?(d="′",o*=60):d="°"}else s=="imperial"?u<.9144?(d="in",o/=.0254):u<1609.344?(d="ft",o/=.3048):(d="mi",o/=1609.344):s=="nautical"?(o/=1852,d="NM"):s=="metric"?u<.001?(d="μm",o*=1e6):u<1?(d="mm",o*=1e3):u<1e3?d="m":(d="km",o/=1e3):s=="us"?u<.9144?(d="in",o*=39.37):u<1609.344?(d="ft",o/=.30480061):(d="mi",o/=1609.3472):lt(!1,33);let h=3*Math.floor(Math.log(a*o)/Math.log(10)),m,f,y,g,_,E;for(;;){y=Math.floor(h/3);const p=Math.pow(10,y);if(m=_r[(h%3+3)%3]*p,f=Math.round(m/o),isNaN(f)){this.element.style.display="none",this.renderedVisible_=!1;return}if(l!==void 0&&f>=l){m=g,f=_,y=E;break}else if(f>=a)break;g=m,_=f,E=y,++h}const b=this.scaleBar_?this.createScaleBar(f,m,d):m.toFixed(y<0?-y:0)+" "+d;this.renderedHTML_!=b&&(this.innerElement_.innerHTML=b,this.renderedHTML_=b),this.renderedWidth_!=f&&(this.innerElement_.style.width=f+"px",this.renderedWidth_=f),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(t,i,e){const s=this.getScaleForResolution(),r=s<1?Math.round(1/s).toLocaleString()+" : 1":"1 : "+Math.round(s).toLocaleString(),o=this.scaleBarSteps_,a=t/o,l=[this.createMarker("absolute")];for(let d=0;d<o;++d){const h=d%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";l.push(`<div><div class="ol-scale-singlebar ${h}" style="width: ${a}px;"></div>`+this.createMarker("relative")+(d%2===0||o===2?this.createStepText(d,t,!1,i,e):"")+"</div>")}return l.push(this.createStepText(o,t,!0,i,e)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${t}px;">`+r+"</div>":"")+l.join("")}createMarker(t){return`<div class="ol-scale-step-marker" style="position: ${t}; top: ${t==="absolute"?3:-10}px;"></div>`}createStepText(t,i,e,s,r){const a=(t===0?0:Math.round(s/this.scaleBarSteps_*t*100)/100)+(t===0?"":" "+r),l=t===0?-3:i/this.scaleBarSteps_*-1,u=t===0?0:i/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${l}px;text-align: ${t===0?"left":"center"};min-width: ${u}px;left: ${e?i+"px":"unset"};">`+a+"</div>"}getScaleForResolution(){const t=Ke(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),i=this.dpi_||ae,e=1e3/25.4;return t*e*i}render(t){const i=t.frameState;i?this.viewState_=i.viewState:this.viewState_=null,this.updateElement_()}}const vr=Cr;class br{constructor(t){this.ol3d=t,this.scene_=t.getCesiumScene(),this.canvas_=this.scene_.canvas,this._boundNotifyRepaintRequired=this.notifyRepaintRequired.bind(this),this.repaintEventNames_=["mousemove","mousedown","mouseup","touchstart","touchend","touchmove","pointerdown","pointerup","pointermove","wheel"],this.enable()}enable(){this.scene_.requestRenderMode=!0,this.scene_.maximumRenderTimeChange=1e3;for(const t of this.repaintEventNames_)this.canvas_.addEventListener(t,this._boundNotifyRepaintRequired,!1);window.addEventListener("resize",this._boundNotifyRepaintRequired,!1),this.ol3d.getOlMap().getLayerGroup().on("change",this._boundNotifyRepaintRequired)}disable(){for(const t of this.repaintEventNames_)this.canvas_.removeEventListener(t,this._boundNotifyRepaintRequired,!1);window.removeEventListener("resize",this._boundNotifyRepaintRequired,!1),this.ol3d.getOlMap().getLayerGroup().un("change",this._boundNotifyRepaintRequired),this.scene_.requestRenderMode=!1}restartRenderLoop(){this.notifyRepaintRequired()}notifyRepaintRequired(){this.scene_.requestRender()}}function be(n){return n*180/Math.PI}function le(n){return n*Math.PI/180}class oe{constructor(t,i){this.scene_=t,this.cam_=t.camera,this.map_=i,this.view_=null,this.viewListenKey_=null,this.toLonLat_=oe.identityProjection,this.fromLonLat_=oe.identityProjection,this.tilt_=0,this.distance_=0,this.lastCameraViewMatrix_=null,this.viewUpdateInProgress_=!1,this.map_.on("change:view",e=>{this.setView_(this.map_.getView())}),this.setView_(this.map_.getView())}static identityProjection(t,i,e){const s=e||t.length;if(i)for(let r=0;r<s;++r)i[r]=t[r];return t}setView_(t){if(this.view_&&(Q(this.viewListenKey_),this.viewListenKey_=null),this.view_=t,t){const i=Pe(t.getProjection(),"EPSG:4326"),e=Pe("EPSG:4326",t.getProjection());console.assert(i&&e),this.toLonLat_=i,this.fromLonLat_=e,this.viewListenKey_=t.on("propertychange",s=>this.handleViewEvent_(s)),this.readFromView()}else this.toLonLat_=oe.identityProjection,this.fromLonLat_=oe.identityProjection}handleViewEvent_(t){this.viewUpdateInProgress_||this.readFromView()}setHeading(t){this.view_&&this.view_.setRotation(t)}getHeading(){return this.view_?this.view_.getRotation()||0:void 0}setTilt(t){this.tilt_=t,this.updateCamera_()}getTilt(){return this.tilt_}setDistance(t){this.distance_=t,this.updateCamera_(),this.updateView()}getDistance(){return this.distance_}setCenter(t){this.view_&&this.view_.setCenter(t)}getCenter(){if(this.view_)return this.view_.getCenter()}setPosition(t){if(!this.toLonLat_)return;const i=this.toLonLat_(t);console.assert(i);const e=new Cesium.Cartographic(le(i[0]),le(i[1]),this.getAltitude());this.cam_.setView({destination:Cesium.Ellipsoid.WGS84.cartographicToCartesian(e)}),this.updateView()}getPosition(){if(!this.fromLonLat_)return;const t=Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position),i=this.fromLonLat_([be(t.longitude),be(t.latitude)]);return console.assert(i),i}setAltitude(t){const i=Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position);i.height=t,this.cam_.position=Cesium.Ellipsoid.WGS84.cartographicToCartesian(i),this.updateView()}getAltitude(){return Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position).height}updateCamera_(){if(!this.view_||!this.toLonLat_)return;const t=this.view_.getCenter();if(!t)return;const i=this.toLonLat_(t);console.assert(i);const e=new Cesium.Cartographic(le(i[0]),le(i[1]));if(this.scene_.globe){const o=this.scene_.globe.getHeight(e);e.height=o||0}const s=Cesium.Ellipsoid.WGS84.cartographicToCartesian(e),r={pitch:this.tilt_-Cesium.Math.PI_OVER_TWO,heading:-this.view_.getRotation(),roll:void 0};this.cam_.setView({destination:s,orientation:r}),this.cam_.moveBackward(this.distance_),this.checkCameraChange(!0)}readFromView(){if(!this.view_||!this.toLonLat_)return;const t=this.view_.getCenter();if(t==null)return;const i=this.toLonLat_(t);console.assert(i);const e=this.view_.getResolution();this.distance_=this.calcDistanceForResolution(e||0,le(i[1])),this.updateCamera_()}updateView(){if(!this.view_||!this.fromLonLat_)return;this.viewUpdateInProgress_=!0;const t=Cesium.Ellipsoid.WGS84,i=this.scene_,e=O.pickCenterPoint(i);let s=e;if(!s){const o=i.globe,a=this.cam_.positionCartographic.clone(),l=o.getHeight(a);a.height=l||0,s=Cesium.Ellipsoid.WGS84.cartographicToCartesian(a)}this.distance_=Cesium.Cartesian3.distance(s,this.cam_.position);const r=t.cartesianToCartographic(s);if(this.view_.setCenter(this.fromLonLat_([be(r.longitude),be(r.latitude)])),this.view_.setResolution(this.calcResolutionForDistance(this.distance_,r?r.latitude:0)),e){const o=this.cam_.position,a=new Cesium.Cartesian3;t.geocentricSurfaceNormal(e,a);const l=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(o,e,l),Cesium.Cartesian3.normalize(l,l);const u=this.cam_.up,d=this.cam_.right,h=new Cesium.Cartesian3(-e.y,e.x,0),m=Cesium.Cartesian3.angleBetween(d,h),y=Cesium.Cartesian3.cross(e,u,new Cesium.Cartesian3).z;this.view_.setRotation(y<0?m:-m);const g=Math.acos(Cesium.Cartesian3.dot(a,l));this.tilt_=isNaN(g)?0:g}else this.view_.setRotation(this.cam_.heading),this.tilt_=-this.cam_.pitch+Math.PI/2;this.viewUpdateInProgress_=!1}checkCameraChange(t){const i=this.lastCameraViewMatrix_,e=this.cam_.viewMatrix;(!i||!Cesium.Matrix4.equalsEpsilon(i,e,1e-5))&&(this.lastCameraViewMatrix_=e.clone(),t!==!0&&this.updateView())}calcDistanceForResolution(t,i){return zt(t,i,this.scene_,this.view_.getProjection())}calcResolutionForDistance(t,i){return Ut(t,i,this.scene_,this.view_.getProjection())}}class Tt{constructor(t,i){this.map=t,this.view=t.getView(),this.scene=i,this.olLayers=t.getLayerGroup().getLayers(),this.mapLayerGroup=t.getLayerGroup(),this.layerMap={},this.olLayerListenKeys={},this.olGroupListenKeys_={}}synchronize(){this.destroyAll(),this.addLayers_(this.mapLayerGroup)}orderLayers(){}addLayers_(t){const i=[{layer:t,parents:[]}];for(;i.length>0;){const e=i.splice(0,1)[0],s=e.layer,r=R(s).toString();this.olLayerListenKeys[r]=[],console.assert(!this.layerMap[r]);let o=null;if(s instanceof Oe)this.listenForGroupChanges_(s),s!==this.mapLayerGroup&&(o=this.createSingleLayerCounterparts(e)),o||s.getLayers().forEach(a=>{if(a){const l={layer:a,parents:s===this.mapLayerGroup?[]:[e.layer].concat(e.parents)};i.push(l)}});else if(o=this.createSingleLayerCounterparts(e),!o){const a=r,l=e,u=d=>{const h=this.createSingleLayerCounterparts(l);h&&(l.layer.un("change",u),this.addCesiumObjects_(h,a,l.layer),this.orderLayers())};this.olLayerListenKeys[r].push(ne(l.layer,"change",u))}o&&this.addCesiumObjects_(o,r,s)}this.orderLayers()}addCesiumObjects_(t,i,e){this.layerMap[i]=t,this.olLayerListenKeys[i].push(ne(e,"change:zIndex",()=>this.orderLayers())),t.forEach(s=>{this.addCesiumObject(s)})}removeAndDestroySingleLayer_(t){const i=R(t).toString(),e=this.layerMap[i];return e&&(e.forEach(s=>{this.removeSingleCesiumObject(s,!1),this.destroyCesiumObject(s)}),this.olLayerListenKeys[i].forEach(Q),delete this.olLayerListenKeys[i]),delete this.layerMap[i],!!e}unlistenSingleGroup_(t){if(t===this.mapLayerGroup)return;const i=R(t).toString();this.olGroupListenKeys_[i].forEach(s=>{Q(s)}),delete this.olGroupListenKeys_[i],delete this.layerMap[i]}removeLayer_(t){if(t){const i=[t];for(;i.length>0;){const e=i.splice(0,1)[0],s=this.removeAndDestroySingleLayer_(e);e instanceof Oe&&(this.unlistenSingleGroup_(e),s||e.getLayers().forEach(r=>{i.push(r)}))}}}listenForGroupChanges_(t){const i=R(t).toString();console.assert(this.olGroupListenKeys_[i]===void 0);const e=[];this.olGroupListenKeys_[i]=e;let s=[];const r=function(){const o=t.getLayers();o&&(s=[o.on("add",a=>{this.addLayers_(a.element)}),o.on("remove",a=>{this.removeLayer_(a.element)})],e.push(...s))}.bind(this);r(),e.push(t.on("change:layers",o=>{s.forEach(a=>{const l=e.indexOf(a);l>=0&&e.splice(l,1),Q(a)}),r()}))}destroyAll(){this.removeAllCesiumObjects(!0);let t;for(t in this.olGroupListenKeys_)this.olGroupListenKeys_[t].forEach(Q);for(t in this.olLayerListenKeys)this.olLayerListenKeys[t].forEach(Q);this.olGroupListenKeys_={},this.olLayerListenKeys={},this.layerMap={}}addCesiumObject(t){}destroyCesiumObject(t){}removeSingleCesiumObject(t,i){}removeAllCesiumObjects(t){}createSingleLayerCounterparts(t){}}class wr extends Tt{constructor(t,i){super(t,i),this.cesiumLayers_=i.imageryLayers,this.ourLayers_=new Cesium.ImageryLayerCollection}addCesiumObject(t){this.cesiumLayers_.add(t),this.ourLayers_.add(t)}destroyCesiumObject(t){t.destroy()}removeSingleCesiumObject(t,i){this.cesiumLayers_.remove(t,i),this.ourLayers_.remove(t,!1)}removeAllCesiumObjects(t){for(let i=0;i<this.ourLayers_.length;++i)this.cesiumLayers_.remove(this.ourLayers_.get(i),t);this.ourLayers_.removeAll(!1)}convertLayerToCesiumImageries(t,i){const e=O.tileLayerToImageryLayer(this.map,t,i);return e?[e]:null}createSingleLayerCounterparts(t){const i=t.layer,e=R(i).toString(),s=this.view.getProjection();console.assert(s);const r=this.convertLayerToCesiumImageries(i,s);if(r){const o=[];if([t.layer].concat(t.parents).forEach(a=>{o.push(a.on(["change:opacity","change:visible"],()=>{console.assert(r);for(let l=0;l<r.length;++l)O.updateCesiumLayerProperties(t,r[l])}))}),i.getStyleFunction){let a=i.getStyleFunction();o.push(i.on("change",()=>{const l=i.getStyleFunction();if(a!==l){a=l;for(let u=0;u<r.length;++u){const d=r[u];d._imageryCache&&d.imageryProvider.cache_&&(d._imageryCache={},d.imageryProvider.cache_={},d.imageryProvider.styleFunction_=l)}this.scene.requestRender()}}))}for(let a=0;a<r.length;++a)O.updateCesiumLayerProperties(t,r[a]);o.push(i.on("change:extent",a=>{for(let l=0;l<r.length;++l)this.cesiumLayers_.remove(r[l],!0),this.ourLayers_.remove(r[l],!1);delete this.layerMap[R(i)],this.synchronize()})),o.push(i.on("change",a=>{for(let l=0;l<r.length;++l){const u=this.cesiumLayers_.indexOf(r[l]);u>=0&&(this.cesiumLayers_.remove(r[l],!1),this.cesiumLayers_.add(r[l],u))}})),this.olLayerListenKeys[e].push(...o)}return Array.isArray(r)?r:null}orderLayers(){const t=[],i={},e=[this.mapLayerGroup];for(;e.length>0;){const s=e.splice(0,1)[0];if(t.push(s),i[R(s)]=s.getZIndex()||0,s instanceof Oe){const r=s.getLayers();r&&e.unshift(...r.getArray())}}Kt(t,(s,r)=>i[R(s)]-i[R(r)]),t.forEach(s=>{const r=R(s).toString(),o=this.layerMap[r];o&&o.forEach(a=>{this.raiseToTop(a)})})}raiseToTop(t){this.cesiumLayers_.raiseToTop(t)}}class Lr{constructor(t,i){const e=new Cesium.BillboardCollection({scene:i}),s=new Cesium.PrimitiveCollection;this.olListenKeys=[],this.rootCollection_=new Cesium.PrimitiveCollection,this.context={projection:t,billboards:e,featureToCesiumMap:{},primitives:s},this.rootCollection_.add(e),this.rootCollection_.add(s)}destroy(){this.olListenKeys.forEach(Q),this.olListenKeys.length=0}getRootPrimitive(){return this.rootCollection_}}class Sr{constructor(t){this.scene=t,this.boundOnRemoveOrClearFeatureListener_=this.onRemoveOrClearFeature_.bind(this),this.defaultBillboardEyeOffset_=new Cesium.Cartesian3(0,0,10)}onRemoveOrClearFeature_(t){const i=t.target;console.assert(i instanceof he);const e=ie.obj(i).olcs_cancellers;if(e){const s=t.feature;if(s){const r=R(s),o=e[r];o&&(o(),delete e[r])}else{for(const r in e)e.hasOwnProperty(r)&&e[r]();ie.obj(i).olcs_cancellers={}}}}setReferenceForPicking(t,i,e){e.olLayer=t,e.olFeature=i}createColoredPrimitive(t,i,e,s,r,o){const a=function(m,f){const y=new Cesium.GeometryInstance({geometry:m});return f&&!(f instanceof Cesium.ImageMaterialProperty)&&(y.attributes={color:Cesium.ColorGeometryInstanceAttribute.fromColor(f)}),y},l={flat:!0,renderState:{depthTest:{enabled:!0}}};o!==void 0&&(l.renderState||(l.renderState={}),l.renderState.lineWidth=o);const u=a(s,r),d=this.getHeightReference(t,i,e);let h;if(d===Cesium.HeightReference.CLAMP_TO_GROUND){const m=u.geometry.constructor;if(m&&!m.createShadowVolume)return null;h=new Cesium.GroundPrimitive({geometryInstances:u})}else h=new Cesium.Primitive({geometryInstances:u});if(r instanceof Cesium.ImageMaterialProperty){const m=r.image.getValue().toDataURL();h.appearance=new Cesium.MaterialAppearance({flat:!0,renderState:{depthTest:{enabled:!0}},material:new Cesium.Material({fabric:{type:"Image",uniforms:{image:m}}})})}else h.appearance=new Cesium.PerInstanceColorAppearance(l);return this.setReferenceForPicking(t,i,h),h}extractColorFromOlStyle(t,i){const e=t.getFill()?t.getFill().getColor():null,s=t.getStroke()?t.getStroke().getColor():null;let r="black";return s&&i?r=s:e&&(r=e),O.convertColorToCesium(r)}extractLineWidthFromOlStyle(t){const i=t.getStroke()?t.getStroke().getWidth():void 0;return i!==void 0?i:1}wrapFillAndOutlineGeometries(t,i,e,s,r,o){const a=this.extractColorFromOlStyle(o,!1),l=this.extractColorFromOlStyle(o,!0),u=new Cesium.PrimitiveCollection;if(o.getFill()){const d=this.createColoredPrimitive(t,i,e,s,a);console.assert(!!d),u.add(d)}if(o.getStroke()&&r){const d=this.extractLineWidthFromOlStyle(o),h=this.createColoredPrimitive(t,i,e,r,l,d);h&&u.add(h)}return u}addTextStyle(t,i,e,s,r){let o;if(r instanceof Cesium.PrimitiveCollection?o=r:(o=new Cesium.PrimitiveCollection,o.add(r)),!s.getText())return o;const a=s.getText(),l=this.olGeometry4326TextPartToCesium(t,i,e,a);return l&&o.add(l),o}csAddBillboard(t,i,e,s,r,o){i.eyeOffset||(i.eyeOffset=this.defaultBillboardEyeOffset_);const a=t.add(i);return this.setReferenceForPicking(e,s,a),a}olCircleGeometryToCesium(t,i,e,s,r){e=O.olGeometryCloneTo4326(e,s),console.assert(e.getType()=="Circle");let o=e.getCenter();const a=o.length==3?o[2]:0;let l=o.slice();l[0]+=e.getRadius(),o=O.ol4326CoordinateToCesiumCartesian(o),l=O.ol4326CoordinateToCesiumCartesian(l);const u=Cesium.Cartesian3.distance(o,l),d=new Cesium.CircleGeometry({center:o,radius:u,height:a});let h,m;if(this.getHeightReference(t,i,e)===Cesium.HeightReference.CLAMP_TO_GROUND){const y=this.extractLineWidthFromOlStyle(r);if(y){const g=qt(e.getCenter(),u),_=O.ol4326CoordinateArrayToCsCartesians(g.getLinearRing(0).getCoordinates());if(Ee(this.scene))h=new Cesium.GroundPolylinePrimitive({geometryInstances:new Cesium.GeometryInstance({geometry:new Cesium.GroundPolylineGeometry({positions:_,width:y})}),appearance:new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(i,r,!0)}),classificationType:Cesium.ClassificationType.TERRAIN}),h.readyPromise.then(()=>{this.setReferenceForPicking(t,i,h._primitive)});else{const E=this.extractColorFromOlStyle(r,!0);h=this.createStackedGroundCorridors(t,i,y,E,_)}}}else m=new Cesium.CircleOutlineGeometry({center:o,radius:u,extrudedHeight:a,height:a});const f=this.wrapFillAndOutlineGeometries(t,i,e,d,m,r);return h&&f.add(h),this.addTextStyle(t,i,e,r,f)}createStackedGroundCorridors(t,i,e,s,r){Array.isArray(r[0])||(r=[r]),e=Math.max(3,e);const o=[];let a=0;for(const l of[1e3,4e3,16e3,64e3,254e3,1e6,1e7]){e*=2.14;const u={width:e,vertexFormat:Cesium.VertexFormat.POSITION_ONLY};for(const d of r)u.positions=d,o.push(new Cesium.GeometryInstance({geometry:new Cesium.CorridorGeometry(u),attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(s),distanceDisplayCondition:new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(a,l-1)}}));a=l}return new Cesium.GroundPrimitive({geometryInstances:o})}olLineStringGeometryToCesium(t,i,e,s,r){e=O.olGeometryCloneTo4326(e,s),console.assert(e.getType()=="LineString");const o=O.ol4326CoordinateArrayToCsCartesians(e.getCoordinates()),a=this.extractLineWidthFromOlStyle(r);let l;const u=this.getHeightReference(t,i,e);if(u===Cesium.HeightReference.CLAMP_TO_GROUND&&!Ee(this.scene)){const d=this.extractColorFromOlStyle(r,!0);l=this.createStackedGroundCorridors(t,i,a,d,o)}else{const d=new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(i,r,!0)}),h={positions:o,width:a},m={appearance:d};if(u===Cesium.HeightReference.CLAMP_TO_GROUND){const f=new Cesium.GroundPolylineGeometry(h);m.geometryInstances=new Cesium.GeometryInstance({geometry:f}),l=new Cesium.GroundPolylinePrimitive(m),l.readyPromise.then(()=>{this.setReferenceForPicking(t,i,l._primitive)})}else{h.vertexFormat=d.vertexFormat;const f=new Cesium.PolylineGeometry(h);m.geometryInstances=new Cesium.GeometryInstance({geometry:f}),l=new Cesium.Primitive(m)}}return this.setReferenceForPicking(t,i,l),this.addTextStyle(t,i,e,r,l)}olPolygonGeometryToCesium(t,i,e,s,r){e=O.olGeometryCloneTo4326(e,s),console.assert(e.getType()=="Polygon");const o=this.getHeightReference(t,i,e);let a,l,u;if(e.getCoordinates()[0].length==5&&i.getGeometry().get("olcs.polygon_kind")==="rectangle"){const h=e.getCoordinates()[0],m=Yt(h),f=Cesium.Rectangle.fromDegrees(m[0],m[1],m[2],m[3]);let y=0;if(h[0].length==3)for(let g=0;g<h.length;g++)y=Math.max(y,h[g][2]);a=new Cesium.RectangleGeometry({ellipsoid:Cesium.Ellipsoid.WGS84,rectangle:f,height:y}),l=new Cesium.RectangleOutlineGeometry({ellipsoid:Cesium.Ellipsoid.WGS84,rectangle:f,height:y})}else{const h=e.getLinearRings(),m={},f=m;console.assert(h.length>0);for(let y=0;y<h.length;++y){const g=h[y].getCoordinates(),_=O.ol4326CoordinateArrayToCsCartesians(g);console.assert(_&&_.length>0),y==0?m.positions=_:(m.holes||(m.holes=[]),m.holes.push({positions:_}))}if(a=new Cesium.PolygonGeometry({polygonHierarchy:f,perPositionHeight:!0}),o===Cesium.HeightReference.CLAMP_TO_GROUND){const y=this.extractLineWidthFromOlStyle(r);if(y>0){const g=[m.positions];if(m.holes)for(let _=0;_<m.holes.length;++_)g.push(m.holes[_].positions);if(Ee(this.scene)){const _=new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(i,r,!0)}),E=[];for(const p of g){const w=new Cesium.GroundPolylineGeometry({positions:p,width:y});E.push(new Cesium.GeometryInstance({geometry:w}))}const b={appearance:_,geometryInstances:E};u=new Cesium.GroundPolylinePrimitive(b),u.readyPromise.then(()=>{this.setReferenceForPicking(t,i,u._primitive)})}else{const _=this.extractColorFromOlStyle(r,!0);u=this.createStackedGroundCorridors(t,i,y,_,g)}}}else l=new Cesium.PolygonOutlineGeometry({polygonHierarchy:m,perPositionHeight:!0})}const d=this.wrapFillAndOutlineGeometries(t,i,e,a,l,r);return u&&d.add(u),this.addTextStyle(t,i,e,r,d)}getHeightReference(t,i,e){let s=e.get("altitudeMode");s===void 0&&(s=i.get("altitudeMode")),s===void 0&&(s=t.get("altitudeMode"));let r=Cesium.HeightReference.NONE;return s==="clampToGround"?r=Cesium.HeightReference.CLAMP_TO_GROUND:s==="relativeToGround"&&(r=Cesium.HeightReference.RELATIVE_TO_GROUND),r}createBillboardFromImage(t,i,e,s,r,o,a,l){o instanceof Se&&o.load();const u=o.getImage(1),d=function(m){return m.src!=""&&m.naturalHeight!=0&&m.naturalWidth!=0&&m.complete},h=function(){if(!u||!(u instanceof HTMLCanvasElement||u instanceof Image||u instanceof HTMLImageElement))return;const m=e.getCoordinates(),f=O.ol4326CoordinateToCesiumCartesian(m);let y;const g=o.getOpacity();g!==void 0&&(y=new Cesium.Color(1,1,1,g));const _=o.getScale(),E=this.getHeightReference(t,i,e),b={image:u,color:y,scale:_,heightReference:E,position:f};if(Object.assign(b,i.get("cesiumOptions")),o instanceof Se){const w=o.getAnchor();w&&(b.pixelOffset=new Cesium.Cartesian2((u.width/2-w[0])*_,(u.height/2-w[1])*_))}const p=this.csAddBillboard(a,b,t,i,e,r);l&&l(p)}.bind(this);if(u instanceof Image&&!d(u)){let m=!1;const f=t.getSource(),y=function(){m=!0};f.on(["removefeature","clear"],this.boundOnRemoveOrClearFeatureListener_);let g=ie.obj(f).olcs_cancellers;g||(g=ie.obj(f).olcs_cancellers={});const _=R(i);g[_]&&g[_](),g[_]=y;const E=function(){u.removeEventListener("load",E),!a.isDestroyed()&&!m&&h()};u.addEventListener("load",E)}else h()}olPointGeometryToCesium(t,i,e,s,r,o,a){console.assert(e.getType()=="Point"),e=O.olGeometryCloneTo4326(e,s);let l=null;const u=r.getImage();if(u){const d=e.get("olcs_model")||i.get("olcs_model");if(d){const h=d(),m=Object.assign({},{scene:this.scene},h.cesiumOptions),f=Cesium.Model.fromGltf(m);l=new Cesium.PrimitiveCollection,l.add(f),h.debugModelMatrix&&l.add(new Cesium.DebugModelMatrixPrimitive({modelMatrix:h.debugModelMatrix}))}else this.createBillboardFromImage(t,i,e,s,r,u,o,a)}return r.getText()?this.addTextStyle(t,i,e,r,l||new Cesium.Primitive):l}olMultiGeometryToCesium(t,i,e,s,r,o,a){const l=function(d,h){const m=new Cesium.PrimitiveCollection;return d.forEach(f=>{m.add(h(t,i,f,s,r))}),m};let u;switch(e.getType()){case"MultiPoint":if(e=e,u=e.getPoints(),r.getText()){const d=new Cesium.PrimitiveCollection;return u.forEach(h=>{console.assert(h);const m=this.olPointGeometryToCesium(t,i,h,s,r,o,a);m&&d.add(m)}),d}else return u.forEach(d=>{console.assert(d),this.olPointGeometryToCesium(t,i,d,s,r,o,a)}),null;case"MultiLineString":return e=e,u=e.getLineStrings(),l(u,this.olLineStringGeometryToCesium.bind(this));case"MultiPolygon":return e=e,u=e.getPolygons(),l(u,this.olPolygonGeometryToCesium.bind(this));default:console.assert(!1,`Unhandled multi geometry type${e.getType()}`)}}olGeometry4326TextPartToCesium(t,i,e,s){const r=s.getText();if(!r)return null;const o=new Cesium.LabelCollection({scene:this.scene}),a=ct(e.getExtent());if(e instanceof Zt){const y=e.getFirstCoordinate();a[2]=y.length==3?y[2]:0}const l={};l.position=O.ol4326CoordinateToCesiumCartesian(a),l.text=r,l.heightReference=this.getHeightReference(t,i,e);const u=s.getOffsetX(),d=s.getOffsetY();if(u!=0&&d!=0){const y=new Cesium.Cartesian2(u,d);l.pixelOffset=y}l.font=s.getFont()||"10px sans-serif";let h;s.getFill()&&(l.fillColor=this.extractColorFromOlStyle(s,!1),h=Cesium.LabelStyle.FILL),s.getStroke()&&(l.outlineWidth=this.extractLineWidthFromOlStyle(s),l.outlineColor=this.extractColorFromOlStyle(s,!0),h=Cesium.LabelStyle.OUTLINE),s.getFill()&&s.getStroke()&&(h=Cesium.LabelStyle.FILL_AND_OUTLINE),l.style=h;let m;switch(s.getTextAlign()){case"left":m=Cesium.HorizontalOrigin.LEFT;break;case"right":m=Cesium.HorizontalOrigin.RIGHT;break;case"center":default:m=Cesium.HorizontalOrigin.CENTER}if(l.horizontalOrigin=m,s.getTextBaseline()){let y;switch(s.getTextBaseline()){case"top":y=Cesium.VerticalOrigin.TOP;break;case"middle":y=Cesium.VerticalOrigin.CENTER;break;case"bottom":y=Cesium.VerticalOrigin.BOTTOM;break;case"alphabetic":y=Cesium.VerticalOrigin.TOP;break;case"hanging":y=Cesium.VerticalOrigin.BOTTOM;break;default:console.assert(!1,`unhandled baseline ${s.getTextBaseline()}`)}l.verticalOrigin=y}const f=o.add(l);return this.setReferenceForPicking(t,i,f),o}olStyleToCesium(t,i,e){const s=i.getFill(),r=i.getStroke();if(e&&!r||!e&&!s)return null;let o=e?r.getColor():s.getColor();return o=O.convertColorToCesium(o),e&&r.getLineDash()?Cesium.Material.fromType("Stripe",{horizontal:!1,repeat:500,evenColor:o,oddColor:new Cesium.Color(0,0,0,0)}):Cesium.Material.fromType("Color",{color:o})}computePlainStyle(t,i,e,s){const r=i.getStyleFunction();let o=null;return r&&(o=r(i,s)),!o&&e&&(o=e(i,s)),o?Array.isArray(o)?o:[o]:null}getGeometryFromFeature(t,i,e){if(e)return e;const s=t.get("olcs.3d_geometry");if(s&&s instanceof qe)return s;if(i){const r=i.getGeometryFunction()(t);if(r instanceof qe)return r}return t.getGeometry()}olFeatureToCesium(t,i,e,s,r){let o=this.getGeometryFromFeature(i,e,r);if(!o)return null;const a=s.projection,l=function(u){const d=s.featureToCesiumMap[R(i)];d instanceof Array?d.push(u):s.featureToCesiumMap[R(i)]=[u]};switch(o.getType()){case"GeometryCollection":const u=new Cesium.PrimitiveCollection;return o.getGeometries().forEach(y=>{if(y){const g=this.olFeatureToCesium(t,i,e,s,y);g&&u.add(g)}}),u;case"Point":o=o;const h=s.billboards,m=this.olPointGeometryToCesium(t,i,o,a,e,h,l);return m||null;case"Circle":return o=o,this.olCircleGeometryToCesium(t,i,o,a,e);case"LineString":return o=o,this.olLineStringGeometryToCesium(t,i,o,a,e);case"Polygon":return o=o,this.olPolygonGeometryToCesium(t,i,o,a,e);case"MultiPoint":case"MultiLineString":case"MultiPolygon":const f=this.olMultiGeometryToCesium(t,i,o,a,e,s.billboards,l);return f||null;case"LinearRing":throw new Error("LinearRing should only be part of polygon.");default:throw new Error(`Ol geom type not handled : ${o.getType()}`)}}olVectorLayerToCesium(t,i,e){const s=i.getProjection(),r=i.getResolution();if(r===void 0||!s)throw console.assert(!1,"View not ready"),new Error("View not ready");let o=t.getSource();o instanceof gt&&(o=o.getSource()),console.assert(o instanceof he);const a=o.getFeatures(),l=new Lr(s,this.scene),u=l.context;for(let d=0;d<a.length;++d){const h=a[d];if(!h)continue;const m=t.getStyleFunction(),f=this.computePlainStyle(t,h,m,r);if(!f||!f.length)continue;let y=null;for(let g=0;g<f.length;g++){const _=this.olFeatureToCesium(t,h,f[g],u);if(_){if(!y)y=_;else if(_){let E=0,b;for(;b=_.get(E);)y.add(b),E++}}}y&&(e[R(h)]=y,l.getRootPrimitive().add(y))}return l}convert(t,i,e,s){const r=i.getProjection(),o=i.getResolution();if(o==null||!r)return null;const a=t.getStyleFunction(),l=this.computePlainStyle(t,e,a,o);if(!l||!l.length)return null;s.projection=r;let u=null;for(let d=0;d<l.length;d++){const h=this.olFeatureToCesium(t,e,l[d],s);if(!u)u=h;else if(h){let m=0,f;for(;f=h.get(m);)u.add(f),m++}}return u}}class xr extends Tt{constructor(t,i,e){super(t,i),this.converter=e||new Sr(i),this.csAllPrimitives_=new Cesium.PrimitiveCollection,i.primitives.add(this.csAllPrimitives_),this.csAllPrimitives_.destroyPrimitives=!1}addCesiumObject(t){console.assert(t),t.getRootPrimitive().counterpart=t,this.csAllPrimitives_.add(t.getRootPrimitive())}destroyCesiumObject(t){t.getRootPrimitive().destroy()}removeSingleCesiumObject(t,i){t.destroy(),this.csAllPrimitives_.destroyPrimitives=i,this.csAllPrimitives_.remove(t.getRootPrimitive()),this.csAllPrimitives_.destroyPrimitives=!1}removeAllCesiumObjects(t){if(this.csAllPrimitives_.destroyPrimitives=t,t)for(let i=0;i<this.csAllPrimitives_.length;++i)this.csAllPrimitives_.get(i).counterpart.destroy();this.csAllPrimitives_.removeAll(),this.csAllPrimitives_.destroyPrimitives=!1}updateLayerVisibility(t,i){let e=!0;[t.layer].concat(t.parents).forEach(s=>{const r=s.getVisible();r!==void 0?e&=r:e=!1}),i.show=e}createSingleLayerCounterparts(t){const i=t.layer;if(!(i instanceof De)||i instanceof Qt)return null;console.assert(i instanceof Xt);let e=i.getSource();if(e instanceof gt&&(e=e.getSource()),!e)return null;console.assert(e instanceof he),console.assert(this.view);const s=this.view,r={},o=this.converter.olVectorLayerToCesium(i,s,r),a=o.getRootPrimitive(),l=o.olListenKeys;[t.layer].concat(t.parents).forEach(h=>{l.push(ne(h,"change:visible",()=>{this.updateLayerVisibility(t,a)}))}),this.updateLayerVisibility(t,a);const u=function(h){console.assert(i instanceof De||i instanceof Jt);const m=o.context,f=this.converter.convert(i,s,h,m);f&&(r[R(h)]=f,a.add(f))}.bind(this),d=function(h){const m=R(h),f=o.context,y=f.featureToCesiumMap[m];y&&(delete f.featureToCesiumMap[m],y.forEach(_=>{_ instanceof Cesium.Billboard&&f.billboards.remove(_)}));const g=r[m];delete r[m],g&&a.remove(g)}.bind(this);return l.push(ne(e,"addfeature",h=>{console.assert(h.feature),u(h.feature)})),l.push(ne(e,"removefeature",h=>{console.assert(h.feature),d(h.feature)})),l.push(ne(e,"changefeature",h=>{const m=h.feature;console.assert(m),d(m),u(m)})),o?[o]:null}}class Tr extends mt{constructor(t){const i=t.parent;super(i.getOptions()),this.scenePostRenderListenerRemover_=null,this.scene_=t.scene,this.synchronizer_=t.synchronizer,this.parent_=i,this.positionWGS84_=void 0,this.observer_=new MutationObserver(this.handleElementChanged.bind(this)),this.attributeObserver_=[],this.listenerKeys_=[];const e=s=>this.setPropertyFromEvent_(s);this.listenerKeys_.push(this.parent_.on("change:position",e)),this.listenerKeys_.push(this.parent_.on("change:element",e)),this.listenerKeys_.push(this.parent_.on("change:offset",e)),this.listenerKeys_.push(this.parent_.on("change:position",e)),this.listenerKeys_.push(this.parent_.on("change:positioning",e)),this.setProperties(this.parent_.getProperties()),this.handleMapChanged(),this.handleElementChanged()}observeTarget_(t){if(this.observer_){this.observer_.disconnect(),this.observer_.observe(t,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),this.attributeObserver_.forEach(i=>{i.disconnect()}),this.attributeObserver_.length=0;for(let i=0;i<t.childNodes.length;i++){const e=t.childNodes[i];if(e.nodeType===1){const s=new MutationObserver(this.handleElementChanged.bind(this));s.observe(e,{attributes:!0,subtree:!0}),this.attributeObserver_.push(s)}}}}setPropertyFromEvent_(t){t.target&&t.key&&this.set(t.key,t.target.get(t.key))}getScene(){return this.scene_}handleMapChanged(){this.scenePostRenderListenerRemover_&&(this.scenePostRenderListenerRemover_(),ei(this.element)),this.scenePostRenderListenerRemover_=null;const t=this.getScene();if(t){this.scenePostRenderListenerRemover_=t.postRender.addEventListener(this.updatePixelPosition.bind(this)),this.updatePixelPosition();const i=this.stopEvent?this.synchronizer_.getOverlayContainerStopEvent():this.synchronizer_.getOverlayContainer();this.insertFirst?i.insertBefore(this.element,i.childNodes[0]||null):i.appendChild(this.element)}}handlePositionChanged(){const t=this.getPosition();if(t){const i=this.parent_.getMap().getView().getProjection();this.positionWGS84_=ti(t,i,"EPSG:4326")}else this.positionWGS84_=void 0;this.updatePixelPosition()}handleElementChanged(){function t(e,s){const r=e.cloneNode();e.nodeName==="CANVAS"&&r.getContext("2d").drawImage(e,0,0),s&&s.appendChild(r),e.nodeType!=Node.TEXT_NODE&&r.addEventListener("click",a=>{e.dispatchEvent(new MouseEvent("click",a)),a.stopPropagation()});const o=e.childNodes;for(let a=0;a<o.length;a++)o[a]&&t(o[a],r);return r}ii(this.element);const i=this.getElement();if(i&&i.parentNode&&i.parentNode.childNodes)for(const e of i.parentNode.childNodes){const s=t(e,null);this.element.appendChild(s)}i.parentNode&&this.observeTarget_(i.parentNode)}updatePixelPosition(){const t=this.positionWGS84_;if(!this.scene_||!t){this.setVisible(!1);return}let i=0;if(t.length===2){const h=this.scene_.globe.getHeight(Cesium.Cartographic.fromDegrees(t[0],t[1]));h&&this.scene_.globe.tilesLoaded&&(t[2]=h),h&&(i=h)}else i=t[2];const e=Cesium.Cartesian3.fromDegrees(t[0],t[1],i),s=this.scene_.camera,r=new Cesium.BoundingSphere(new Cesium.Cartesian3,6356752);if(!new Cesium.Occluder(r,s.position).isPointVisible(e)){this.setVisible(!1);return}if(s.frustum.computeCullingVolume(s.position,s.direction,s.up).computeVisibility(new Cesium.BoundingSphere(e))!==1){this.setVisible(!1);return}this.setVisible(!0);const l=this.scene_.cartesianToCanvasCoordinates(e),u=[l.x,l.y],d=[this.scene_.canvas.width,this.scene_.canvas.height];this.updateRenderedPosition(u,d)}destroy(){this.scenePostRenderListenerRemover_&&this.scenePostRenderListenerRemover_(),this.observer_&&this.observer_.disconnect(),Q(this.listenerKeys_),this.listenerKeys_.splice(0),this.element.removeNode?this.element.removeNode(!0):this.element.remove(),this.element=null}}class kr{constructor(t,i){this.map=t,this.overlays_=this.map.getOverlays(),this.scene=i,this.overlayContainerStopEvent_=document.createElement("DIV"),this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",["click","dblclick","mousedown","touchstart","MSPointerDown","pointerdown","mousewheel","wheel"].forEach(s=>{this.overlayContainerStopEvent_.addEventListener(s,r=>r.stopPropagation())}),this.scene.canvas.parentElement.appendChild(this.overlayContainerStopEvent_),this.overlayContainer_=document.createElement("DIV"),this.overlayContainer_.className="ol-overlaycontainer",this.scene.canvas.parentElement.appendChild(this.overlayContainer_),this.overlayMap_={}}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOverlayContainer(){return this.overlayContainer_}synchronize(){this.destroyAll(),this.addOverlays(),this.overlays_.on("add",this.addOverlayFromEvent_.bind(this)),this.overlays_.on("remove",this.removeOverlayFromEvent_.bind(this))}addOverlayFromEvent_(t){const i=t.element;this.addOverlay(i)}addOverlays(){this.overlays_.forEach(t=>{this.addOverlay(t)})}addOverlay(t){if(!t)return;const i=new Tr({scene:this.scene,synchronizer:this,parent:t}),e=R(t).toString();this.overlayMap_[e]=i}removeOverlayFromEvent_(t){const i=t.element;this.removeOverlay(i)}removeOverlay(t){const i=R(t).toString(),e=this.overlayMap_[i];e&&(e.destroy(),delete this.overlayMap_[i])}destroyAll(){Object.keys(this.overlayMap_).forEach(t=>{this.overlayMap_[t].destroy(),delete this.overlayMap_[t]})}}class de{constructor(t){this.autoRenderLoop_=null,this.map_=t.map,this.time_=t.time||function(){return Cesium.JulianDate.now()},this.to4326Transform_=Pe(this.map_.getView().getProjection(),"EPSG:4326"),this.resolutionScale_=1,this.canvasClientWidth_=0,this.canvasClientHeight_=0,this.resolutionScaleChanged_=!0;const i="position:absolute;top:0;left:0;width:100%;height:100%;";this.container_=document.createElement("DIV");const e=document.createAttribute("style");e.value=`${i}visibility:hidden;`,this.container_.setAttributeNode(e);let s=t.target||this.map_.getViewport();if(typeof s=="string"&&(s=document.getElementById(s)),s.appendChild(this.container_),this.isOverMap_=!t.target,this.isOverMap_&&t.stopOpenLayersEventsPropagation){const h=["click","dblclick","mousedown","touchstart","MSPointerDown","pointerdown","mousewheel","wheel"];for(let m=0,f=h.length;m<f;++m)this.container_.addEventListener(h[m],y=>y.stopPropagation())}this.canvas_=document.createElement("CANVAS");const r=document.createAttribute("style");r.value=i,this.canvas_.setAttributeNode(r),ie.supportsImageRenderingPixelated()&&(this.canvas_.style.imageRendering=ie.imageRenderingValue()),this.canvas_.oncontextmenu=function(){return!1},this.canvas_.onselectstart=function(){return!1},this.container_.appendChild(this.canvas_),this.enabled_=!1,this.pausedInteractions_=[],this.hiddenRootGroup_=null;const o=t.sceneOptions!==void 0?t.sceneOptions:{};o.canvas=this.canvas_,o.scene3DOnly=!0,this.scene_=new Cesium.Scene(o);const a=this.scene_.screenSpaceCameraController;a.tiltEventTypes.push({eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.SHIFT}),a.tiltEventTypes.push({eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.ALT}),a.enableLook=!1,this.scene_.camera.constrainedAxis=Cesium.Cartesian3.UNIT_Z,this.camera_=new oe(this.scene_,this.map_),this.globe_=new Cesium.Globe(Cesium.Ellipsoid.WGS84),this.globe_.baseColor=Cesium.Color.WHITE,this.scene_.globe=this.globe_,this.scene_.skyAtmosphere=new Cesium.SkyAtmosphere;const l=new Cesium.SingleTileImageryProvider({url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",rectangle:Cesium.Rectangle.fromDegrees(0,0,1,1)});this.globe_.imageryLayers.addImageryProvider(l,0),this.dataSourceCollection_=new Cesium.DataSourceCollection,this.dataSourceDisplay_=new Cesium.DataSourceDisplay({scene:this.scene_,dataSourceCollection:this.dataSourceCollection_});const u=t.createSynchronizers?t.createSynchronizers(this.map_,this.scene_,this.dataSourceCollection_):[new wr(this.map_,this.scene_),new xr(this.map_,this.scene_),new kr(this.map_,this.scene_)];this.handleResize_();for(let h=u.length-1;h>=0;--h)u[h].synchronize();this.lastFrameTime_=0,this.renderId_=void 0,this.targetFrameRate_=Number.POSITIVE_INFINITY,this.blockCesiumRendering_=!1,this.warmingUp_=!1,this.trackedFeature_=null,this.trackedEntity_=null,this.entityView_=null,this.needTrackedEntityUpdate_=!1,this.boundingSphereScratch_=new Cesium.BoundingSphere,new Cesium.EventHelper().add(this.scene_.postRender,de.prototype.updateTrackedEntity_,this),Cesium.Camera.enableSuspendTerrainAdjustment=!1}render_(){this.renderId_!==void 0&&(cancelAnimationFrame(this.renderId_),this.renderId_=void 0),(this.enabled_||this.warmingUp_)&&!this.blockCesiumRendering_&&(this.renderId_=requestAnimationFrame(this.onAnimationFrame_.bind(this)))}onAnimationFrame_(t){this.renderId_=void 0;const i=1e3/this.targetFrameRate_;if(t-this.lastFrameTime_<i){this.render_();return}this.lastFrameTime_=t;const s=this.time_();if(this.scene_.initializeFrame(),this.handleResize_(),this.dataSourceDisplay_.update(s),this.entityView_){const r=this.trackedEntity_;this.dataSourceDisplay_.getBoundingSphere(r,!1,this.boundingSphereScratch_)===Cesium.BoundingSphereState.DONE&&(this.boundingSphereScratch_.radius=1,this.entityView_.update(s,this.boundingSphereScratch_))}this.scene_.render(s),this.camera_.checkCameraChange(),this.render_()}updateTrackedEntity_(){if(!this.needTrackedEntityUpdate_)return;const t=this.trackedEntity_,i=this.scene_,e=this.dataSourceDisplay_.getBoundingSphere(t,!1,this.boundingSphereScratch_);if(e===Cesium.BoundingSphereState.PENDING)return;i.screenSpaceCameraController.enableTilt=!1;const s=e!==Cesium.BoundingSphereState.FAILED?this.boundingSphereScratch_:void 0;s&&(s.radius=1),this.entityView_=new Cesium.EntityView(t,i,i.mapProjection.ellipsoid),this.entityView_.update(this.time_(),s),this.needTrackedEntityUpdate_=!1}handleResize_(){let t=this.canvas_.clientWidth,i=this.canvas_.clientHeight;if(t===0|i===0||t===this.canvasClientWidth_&&i===this.canvasClientHeight_&&!this.resolutionScaleChanged_)return;let e=this.resolutionScale_;ie.supportsImageRenderingPixelated()||(e*=window.devicePixelRatio||1),this.resolutionScaleChanged_=!1,this.canvasClientWidth_=t,this.canvasClientHeight_=i,t*=e,i*=e,this.canvas_.width=t,this.canvas_.height=i,this.scene_.camera.frustum.aspectRatio=t/i}getCamera(){return this.camera_}getOlMap(){return this.map_}getOlView(){const t=this.map_.getView();return console.assert(t),t}getCesiumScene(){return this.scene_}getDataSources(){return this.dataSourceCollection_}getDataSourceDisplay(){return this.dataSourceDisplay_}getEnabled(){return this.enabled_}setEnabled(t){if(this.enabled_===t)return;this.enabled_=t,this.container_.style.visibility=this.enabled_?"visible":"hidden";let i;if(this.enabled_){if(this.throwOnUnitializedMap_(),this.isOverMap_){i=this.map_.getInteractions(),i.forEach((s,r,o)=>{this.pausedInteractions_.push(s)}),i.clear(),this.map_.addInteraction=s=>this.pausedInteractions_.push(s),this.map_.removeInteraction=s=>this.pausedInteractions_=this.pausedInteractions_.filter(r=>r!==s);const e=this.map_.getLayerGroup();e.getVisible()&&(this.hiddenRootGroup_=e,this.hiddenRootGroup_.setVisible(!1)),this.map_.getOverlayContainer().classList.add("olcs-hideoverlay")}this.camera_.readFromView(),this.render_()}else this.isOverMap_&&(i=this.map_.getInteractions(),this.pausedInteractions_.forEach(e=>{i.push(e)}),this.pausedInteractions_.length=0,this.map_.addInteraction=e=>this.map_.getInteractions().push(e),this.map_.removeInteraction=e=>this.map_.getInteractions().remove(e),this.map_.getOverlayContainer().classList.remove("olcs-hideoverlay"),this.hiddenRootGroup_&&(this.hiddenRootGroup_.setVisible(!0),this.hiddenRootGroup_=null)),this.camera_.updateView()}warmUp(t,i){if(this.enabled_)return;this.throwOnUnitializedMap_(),this.camera_.readFromView();const e=this.globe_.ellipsoid,s=this.scene_.camera,r=e.cartesianToCartographic(s.position);r.height<t&&(r.height=t,s.position=e.cartographicToCartesian(r)),this.warmingUp_=!0,this.render_(),setTimeout(()=>{this.warmingUp_=!1},i)}setBlockCesiumRendering(t){this.blockCesiumRendering_!==t&&(this.blockCesiumRendering_=t,this.render_())}enableAutoRenderLoop(){this.autoRenderLoop_||(this.autoRenderLoop_=new br(this))}getAutoRenderLoop(){return this.autoRenderLoop_}setResolutionScale(t){t=Math.max(0,t),t!==this.resolutionScale_&&(this.resolutionScale_=Math.max(0,t),this.resolutionScaleChanged_=!0,this.autoRenderLoop_&&this.autoRenderLoop_.restartRenderLoop())}setTargetFrameRate(t){this.targetFrameRate_!==t&&(this.targetFrameRate_=t,this.render_())}throwOnUnitializedMap_(){const i=this.map_.getView(),e=i.getCenter();if(!i.isDef()||isNaN(e[0])||isNaN(e[1]))throw new Error(`The OpenLayers map is not properly initialized: ${e} / ${i.getResolution()}`)}get trackedFeature(){return this.trackedFeature_}set trackedFeature(t){if(this.trackedFeature_!==t){const i=this.scene_;if(!t||!t.getGeometry()){this.needTrackedEntityUpdate_=!1,i.screenSpaceCameraController.enableTilt=!0,this.trackedEntity_&&this.dataSourceDisplay_.defaultDataSource.entities.remove(this.trackedEntity_),this.trackedEntity_=null,this.trackedFeature_=null,this.entityView_=null,i.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);return}this.trackedFeature_=t,this.needTrackedEntityUpdate_=!0;const e=this.to4326Transform_,s=function(){const o=t.getGeometry();console.assert(o instanceof Ve);const a=o.getCoordinates(),l=e(a,void 0,a.length);return O.ol4326CoordinateToCesiumCartesian(l)},r={position:new Cesium.CallbackProperty((o,a)=>s(),!1),point:{pixelSize:1,color:Cesium.Color.TRANSPARENT}};this.trackedEntity_=this.dataSourceDisplay_.defaultDataSource.entities.add(r)}}}const Mr={props:{},setup(n,{emit:t}){const i=Le,e=X({defaultCenter:[121.326776,24.655499],defaultCenterZoom:14,targetNum:1,conditionWrap:!1,layerSelect:!1,currentLayers:[],layers:[],mapLayers:We(()=>e.layers.map((b,p)=>({label:b.group_title,value:b.value,layers:b.group_layers,groupClass:b.group_class}))),selectLock:!1,mapCount:1,map1:null,map2:null,map1LayerStatus:[],map2LayerStatus:[],temp:{map1BaseStatus:0,map2BaseStatus:0},deleteLightbox:!1,dimensionMap:{map1:"2D",map2:"2D"},toSearchDimensionStatus:We(()=>{let b=e.targetNum==1?"map1":"map2";return e.dimensionMap[b]==="2D"}),ol3d:null,selectValueTemp:0,popup:{nodeRef:null,overlay:null,popupId:0,coordinate:[],popupData:""},comSize:{wrapHeight:"",wrapWidth:"",conditionCom:{}},tribeQuery:{}});let s=null;const r=new ut({projection:"EPSG:4326",center:e.defaultCenter,zoom:e.defaultCenterZoom});function o(){e.map1=new we({target:"map1",layers:[ve.getBaseMapData(0)],view:r,controls:[]}),e.map1.addControl(new vr({units:"metric"}))}function a(b,p){const w=new De({source:new he({features:[new dt({geometry:new Ve([b,p]),population:4e3,rainfall:500})]}),style:new Ye({image:new Se({anchor:[.5,100],anchorXUnits:"fraction",anchorYUnits:"pixels",src:Ss})})});let L=e.targetNum==1?"map1":"map2";e[L].addLayer(w)}function l({action:b,value:p}){var I;let w=((I=e.map1)==null?void 0:I.getTarget())==null?"map2":"map1",L=e[w].getView();switch(b){case"In":L.animate({zoom:L.getZoom()+1});break;case"Out":L.animate({zoom:L.getZoom()-1});break;case"toNorth":L.animate({rotation:0});break;case"moveTo":if(p){const{xAxis:P,yAxis:G}=p;L.animate({center:[P,G],zoom:17,duration:100})}else navigator.geolocation.getCurrentPosition(function(P){L.animate({center:[P.coords.longitude,P.coords.latitude],zoom:17,duration:100}),a(P.coords.longitude,P.coords.latitude)});break;case"fullScreen":let x=document.getElementById(`map${e.targetNum}`);x.requestFullscreen?x.requestFullscreen():x.msRequestFullscreen?x.msRequestFullscreen():x.mozRequestFullScreen?x.mozRequestFullScreen():x.webkitRequestFullscreen&&x.webkitRequestFullscreen();break}}function u({action:b,value:p}){var P;let w=e.targetNum==1?e.map1:e.map2,L=w==null?void 0:w.getLayers();switch(b){case"layerMode":if(p.checked){e.layers[p.nodeIndex].group_layers[p.subNodeIndex].single_tiles||(L.getArray().forEach(N=>{N.get("id")&&N.get("id").includes(`node${p.nodeIndex}_subNode${p.subNodeIndex}_nestedSubNode`)&&w.removeLayer(N)}),f("delete",w.getTarget(),p.id));let S=p.nestedSubNodeIndex||e.selectValueTemp,D=i.getLayer(e.layers[p.nodeIndex].group_layers[p.subNodeIndex],S,p.id);if(w.addLayer(D),D.get("label").includes("雷達回波預測")){var I=D.getSource(),x=I.getFeatures()[0];const A=e.layers[p.nodeIndex].group_layers[p.subNodeIndex].image_options.image_extent,N="https://occur55170.github.io/Map_Demo/forecast.gif",ye=gifler(N),je=A[2]-A[0],te=A[3]-A[1];ye.frames(document.createElement("canvas"),function(se,z){const It=je/z.width,Rt=te/z.height,Pt=Math.min(It,Rt),Ot=e.map1.getView().getResolution();x.setStyle(new Ye({image:new Se({img:se.canvas,imgSize:[z.width,z.height],opacity:.8,scale:Pt/Ot})})),se.clearRect(0,0,z.width,z.height),se.drawImage(z.buffer,z.x,z.y),w.render()},!0)}e.layers[p.nodeIndex].group_layers[p.subNodeIndex].layer_type==="WFS"&&(y(w,D.label),_(p)),f("add",w.getTarget(),p.id)}else{let D=function(ye){S.filter(te=>{var se;return(se=te==null?void 0:te.get("id"))==null?void 0:se.includes(ye)}).forEach(te=>{w.removeLayer(te)})},S=L.getArray();const N={node9_subNode0_nestedSubNode:"node9_subNode0_nestedSubNode",node12_subNode1_nestedSubNode:"node12_subNode1_nestedSubNode"}[p.id]||p.id;D(N),e.layers[p.nodeIndex].group_layers[p.subNodeIndex].layer_type==="WFS"&&(_(p),e.popup.popupId=0,e.popup.popupData="",e.popup.overlay&&(w.removeOverlay(e.popup.overlay),e.popup.overlay=null)),f("delete",w.getTarget(),p.id)}break;case"selectLayerMode":if(e.selectLock)return;p.layerName==="all"?L.getArray().filter(A=>A.get("id")!==void 0).forEach(A=>{w.removeLayer(A)}):L.getArray().forEach(D=>{D.get("id")==p.id&&w.removeLayer(D)});break;case"changeOrder":if(e.selectLock)return;let{nodeIndex:G,subNodeIndex:H,nestedSubNodeIndex:j}=i.getLayerIndex(p.id),$=i.getLayer(e.layers[G].group_layers[H],j,p.id);if(p.movement==="up"){if(p.key+1==L.getArray().length)return;let S={checked:!1,nodeIndex:G,subNodeIndex:H,nestedSubNodeIndex:j,id:p.id};u({action:"layerMode",value:S}),L.insertAt(p.key+1,$)}if(p.movement==="down"){if(p.key-1==0)return;let S={checked:!1,nodeIndex:G,subNodeIndex:H,nestedSubNodeIndex:j,id:p.id};u({action:"layerMode",value:S}),L.insertAt(p.key-1,$)}break;case"changeLayerVisible":if(e.selectLock)return;let Me=!L.getArray()[p.key].getVisible();L.getArray()[p.key].setVisible(Me);break;case"baseMap":e.temp[`map${e.targetNum}BaseStatus`]=p.baseId;let kt=new Ne({preload:1/0,name:p.name,label:p.label,type:p.mapType,baseId:p.baseId,source:new ht({url:p.url}),crossOrigin:"anonymous"}),Mt=w==null?void 0:w.getLayers().getArray();L.insertAt(0,kt),Mt.forEach(S=>(S.get("type")=="base"&&S.get("baseId")!==p.baseId&&w.removeLayer(S),!0));break;case"changeMapCount":if(e.mapCount===p.qty)return;let ee=e.targetNum!==1?"map1":"map2";e.mapCount=p.qty;let Et=e[`${ee}LayerStatus`].filter(S=>S!=="3D").map(S=>Le.getLayerIndex(S));if(p.qty===2&&(e[ee]=new we({target:ee,layers:[ve.getBaseMapData(0),...Et.map(S=>i.getLayer(e.layers[S.nodeIndex].group_layers[S.subNodeIndex],S.nestedSubNodeIndex,S.id))],view:r,controls:[]}),((P=e[`${ee}LayerStatus`])==null?void 0:P.indexOf("3D"))!==-1)){s=new de({map:e[ee]}),s.setEnabled(!0),Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0NzM3MWFhYS0xMjNlLTQ3MTMtODFjZS0xZjMzM2I5NGZiYTEiLCJpZCI6MTMwODE4LCJpYXQiOjE2ODQwNzM3Mjl9.UYu4kBialPo19dcvosHzZTpg2BD1zkFQnjCD78YiiYo";let S=s.getCesiumScene({});S.terrainProvider=Cesium.createWorldTerrain({})}if(p.qty===1){e[ee]=null;const S=document.getElementById(ee);for(;S.firstChild;)S.removeChild(S.firstChild)}break;case"changeDimensionMap":let fe=e.targetNum==1?"map1":"map2";if(e.dimensionMap[fe]=p,p==="3D"){const D=L.getArray().find(N=>N.get("label").includes("近年歷史災害82處部落點位"));D&&e[`map${e.targetNum}`].removeLayer(D),s=new de({map:w}),s.setEnabled(!0),Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0NzM3MWFhYS0xMjNlLTQ3MTMtODFjZS0xZjMzM2I5NGZiYTEiLCJpZCI6MTMwODE4LCJpYXQiOjE2ODQwNzM3Mjl9.UYu4kBialPo19dcvosHzZTpg2BD1zkFQnjCD78YiiYo";let A=s.getCesiumScene({});A.terrainProvider=Cesium.createWorldTerrain({}),e[`${fe}LayerStatus`].push("3D")}else s.setEnabled(!1),e[`${fe}LayerStatus`]=e[`${fe}LayerStatus`].filter(S=>S!=="3D"),e[`map${e.targetNum}LayerStatus`].forEach(S=>{let{nodeIndex:D,subNodeIndex:A,nestedSubNodeIndex:N}=i.getLayerIndex(S);return i.getLayer(e.layers[D].group_layers[A],N,p.id).get("label").includes("近年歷史災害82處部落點位")&&u({action:"layerMode",value:{checked:!0,nodeIndex:D,subNodeIndex:A,nestedSubNodeIndex:N,id:S}}),S});break;case"setOpacity":L.getArray()[p.key].setOpacity(Number(p.value));break}h()}function d(b){var w;e.targetNum=b;let p=e.targetNum!==1?"map1":"map2";if(e.mapCount===1){if(!e[`map${b}`]){let L=e[`map${b}LayerStatus`].filter(x=>x!=="3D");L.includes("node0_subNode4_nestedSubNodeundefined")&&(L=[...L.filter(P=>P!=="node0_subNode4_nestedSubNodeundefined"),"node0_subNode4_nestedSubNodeundefined"]);let I=L.map(x=>Le.getLayerIndex(x));e[`map${b}`]=new we({target:`map${b}`,layers:[ve.getBaseMapData(e.temp[`map${e.targetNum}BaseStatus`]),...I.map(x=>i.getLayer(e.layers[x.nodeIndex].group_layers[x.subNodeIndex],x.nestedSubNodeIndex,x.layeredIndex))],view:r,controls:[]}),y(e[`map${b}`]),((w=e[`map${b}LayerStatus`])==null?void 0:w.indexOf("3D"))!==-1&&(s=new de({map:e[`map${b}`]}),s.setEnabled(!0))}if(e[p]){e[p]=null;const L=document.getElementById(p);for(;L.firstChild;)L.removeChild(L.firstChild)}}He(()=>{h()})}function h(){var w;let b=e.targetNum==1?e.map1:e.map2;const p=(w=b==null?void 0:b.getLayers())==null?void 0:w.getArray();e.currentLayers=p==null?void 0:p.map(L=>({label:L.get("label"),id:L.get("id"),visible:L.getVisible()}))}function m(){e.conditionWrap=!e.conditionWrap}function f(b,p,w){if(b==="add")e[`${p}LayerStatus`].push(w);else if(b==="delete"){let L=e[`${p}LayerStatus`].findIndex(I=>I===w);e[`${p}LayerStatus`].splice(L,1)}else console.log("error")}function y(b){var w;let p=new si({layers:(w=b==null?void 0:b.getLayers())==null?void 0:w.getArray(),condition:ni});b.addInteraction(p),p.on("select",L=>{let I=L.selected[0];if(I){e.popup.overlay=new mt({element:e.popup.nodeRef,autoPan:!0,autoPanAnimation:{duration:250}}),e.popup.overlay.setPosition(L.mapBrowserEvent.coordinate),b.addOverlay(e.popup.overlay);let x=I.getId().split(".");e.popup.popupData=x[0],e.popup.coordinate=L.mapBrowserEvent.coordinate,x[0]==="新竹縣原住民部落範圍"&&(e.popup.popupId=I.get("編號")),x[0]==="近年歷史災害82處部落點位"&&(e.popup.popupId=x[1])}else b.removeOverlay(e.popup.overlay),e.popup.overlay=null,e.popup={nodeRef:null,overlay:null,popupId:0,coordinate:[],popupData:""}})}function g(){(e.targetNum==1?e.map1:e.map2).removeOverlay(e.popup.overlay),e.popup.overlay=null}function _(b){const{checked:p,id:w}=b;if(!p){e.selectLayerOption={};return}w==="node4_subNode0_nestedSubNodeundefined"&&re.ajax({url:"https://api.edtest.site/tribeQuery",method:"GET",success:L=>{e.tribeQuery=L},error:L=>{console.log(L)}})}function E(b){let p={action:"moveTo",value:{xAxis:b.WGS84.lng,yAxis:b.WGS84.lat}};l(p)}return Fe(async()=>{let b=re.ajax({url:"https://api.edtest.site/underLayers",method:"GET"}).done(w=>w),p=re.ajax({url:"https://api.edtest.site/layers",method:"GET"}).done(w=>w);Promise.all([b,p]).then(w=>{let L=w[0].data.map((I,x)=>({mapType:"base",baseId:x,onCurrent:!1,...I}));ve.setBaseMapData(L),e.temp.map1BaseStatus=0,e.temp.baseMapList=Zn(),e.layers=w[1].map((I,x)=>(I.group_layers.forEach((P,G)=>{let H=G,j;P.id=`node${x}_subNode${H}_nestedSubNode${j}`,P.single_tiles||P.tiles_list.forEach(($,Me)=>{j=Me,$.id=`node${x}_subNode${H}_nestedSubNode${j}`})}),{...I,value:x})),He(()=>{o(),h()})}),e.comSize.wrapHeight=window.innerHeight,e.comSize.wrapWidth=window.innerWidth,window.onresize=w=>{e.comSize.wrapHeight=w.target.innerHeight,e.comSize.wrapWidth=w.target.innerWidth}}),{state:e,props:n,mapControl:l,layerControl:u,changeTarget:d,conditionWrap:m,closeMapData:g,moveToMap:E}}},Er={class:"w-100 d-flex flex flex-sm-row flex-wrap flex-sm-nowrap mapWrap",id:"mapWrap"},Ir={key:0,class:"middleLine"},Rr={class:"SearchBar d-none d-sm-block position-absolute"},Pr={class:"d-flex align-items-center"},Or=c("img",{src:pt,alt:"",class:"mb-2"},null,-1),Dr={class:"me-2 d-flex align-items-center"},Ar={class:"conditionCom d-none d-sm-block position-absolute"},Fr={class:"mb-2"},Vr={key:1},Nr={key:0,class:"lightWrap w-100 h-100 d-flex justify-content-center align-items-center"},Br={class:"p-4 rounded bg-white",style:{width:"250px"}},Gr=c("p",{class:"text-center fw-bold"},"是否要刪除全部圖層",-1),jr={class:"d-flex justify-content-around"},Wr={class:"m-Navbar d-flex d-sm-none position-fixed bottom-0 start-0 w-100"},Hr={key:1};function $r(n,t,i,e,s,r){var f,y;const o=yr,a=Xo,l=qo,u=bo,d=Yn,h=vn,m=Ri;return C(),v("div",null,[c("div",Er,[c("div",{id:"map1",class:B({"w-100":((f=e.state.map1)==null?void 0:f.getTarget())=="map1","h-100":e.state.mapCount===1,"h-50":e.state.mapCount===2&&e.state.comSize.wrapWidth<600})},null,2),e.state.mapCount===2?(C(),v("div",Ir)):T("",!0),c("div",{id:"map2",class:B({"w-100":((y=e.state.map2)==null?void 0:y.getTarget())=="map2","h-100":e.state.mapCount===1,"h-50":e.state.mapCount===2&&e.state.comSize.wrapWidth<600})},null,2)]),Z(o,{class:"asideTool position-absolute top-50 translate-middle-y",id:"asideTool",onOnMapControl:t[0]||(t[0]=({action:g,value:_})=>{e.mapControl({action:g,value:_})})}),c("div",Rr,[c("div",Pr,[Or,c("ul",null,[c("li",Dr,[Z(a,{class:"mapSourceOption d-none d-sm-block",baseMapList:e.state.temp.baseMapList,onChangeBaseMaps:({action:g,value:_})=>{e.layerControl({action:g,value:_})}},null,8,["baseMapList","onChangeBaseMaps"])])])]),Z(l,_e({dimensionMapStatus:e.state.toSearchDimensionStatus,currentLayers:e.state.currentLayers,mapCount:e.state.mapCount,onChangeBaseMaps:({action:g,value:_})=>{e.layerControl({action:g,value:_})}},{onOnLayerControl:t[1]||(t[1]=({action:g,value:_})=>{e.layerControl({action:g,value:_})}),onOnChangeTarget:t[2]||(t[2]=g=>{e.changeTarget(g)}),onConditionWrap:t[3]||(t[3]=g=>{e.conditionWrap(g)})}),null,16)]),c("div",Ar,[c("div",Fr,[e.state.conditionWrap?T("",!0):(C(),v("button",{key:0,class:"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5",onClick:t[4]||(t[4]=g=>e.state.conditionWrap=!0)}," 圖層選項 ")),e.state.conditionWrap?(C(),v("div",{key:1,class:"mb-4",style:{"max-height":"50%"},ref:g=>{e.state.comSize.conditionCom=g}},[Z(u,_e({tribeQuery:e.state.tribeQuery,mapLayers:e.state.mapLayers,currentLayers:e.state.currentLayers,onClose:()=>{e.state.conditionWrap=!1},showSelectLayerValue:g=>{e.state.selectValueTemp=g},moveToMap:g=>{e.moveToMap(g)}},{onOnLayerControl:t[5]||(t[5]=({action:g,value:_})=>{e.layerControl({action:g,value:_})})}),null,16)],512)):T("",!0)]),c("div",null,[e.state.layerSelect?T("",!0):(C(),v("button",{key:0,class:"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5",onClick:t[6]||(t[6]=g=>e.state.layerSelect=!0)}," 已選擇的圖層 ")),e.state.layerSelect?(C(),v("div",Vr,[Z(d,Dt(At({selectLock:e.state.selectLock,currentLayers:e.state.currentLayers,onClose:()=>{e.state.layerSelect=!1},onLockLayer:()=>{e.state.selectLock=!e.state.selectLock},onDeleteLayer:({action:g,value:_})=>{_.layerName=="all"?e.state.deleteLightbox=!0:e.layerControl({action:g,value:_})},onDeleteLayerAll:()=>{e.state.deleteLightbox=!0},onLayerControl:({action:g,value:_})=>{e.layerControl({action:g,value:_})}})),null,16)])):T("",!0)])]),e.state.deleteLightbox?(C(),v("div",Nr,[c("div",Br,[Gr,c("div",jr,[c("button",{class:"rounded px-3 py-1 bg-steel text-white border-0",onClick:t[7]||(t[7]=()=>{e.layerControl({action:"selectLayerMode",value:{layerName:"all"}}),e.state.deleteLightbox=!1})},"確定"),c("button",{class:"rounded px-3 py-1 bg-secondary bg-gradient text-white border-0",onClick:t[8]||(t[8]=()=>{e.state.deleteLightbox=!1})},"取消")])])])):T("",!0),c("div",{id:"popup",class:"position-absolute bottom-0",ref:g=>{e.state.popup.nodeRef=g}},[e.state.popup.popupId!==0?(C(),$e(h,{key:0,class:"areaData",closeMapData:()=>{e.closeMapData()},popup:e.state.popup,maxHeight:500},null,8,["closeMapData","popup"])):T("",!0)],512),c("div",Wr,[e.state.conditionWrap?(C(),$e(u,_e({key:0,class:"position-absolute bottom-100 w-100"},{mapLayers:e.state.mapLayers,currentLayers:e.state.currentLayers,onClose:()=>{e.state.conditionWrap=!1},showSelectLayerValue:g=>{e.state.selectValueTemp=g}},{onOnLayerControl:t[9]||(t[9]=({action:g,value:_})=>{e.layerControl({action:g,value:_})})}),null,16)):T("",!0),e.state.layerSelect?(C(),v("div",Hr,[Z(d,_e({class:"position-absolute bottom-100 w-100"},{selectLock:e.state.selectLock,currentLayers:e.state.currentLayers,onClose:()=>{e.state.layerSelect=!1},onChangLayerVisible:g=>{e.layerControl(g)},onChangeOrderLayer:({action:g,value:_})=>{e.layerControl({action:g,value:_})},onLockLayer:()=>{e.state.selectLock=!e.state.selectLock},onDeleteLayer:({action:g,value:_})=>{_.layerName=="all"?e.state.deleteLightbox=!0:e.layerControl({action:g,value:_})},onDeleteLayerAll:()=>{e.state.deleteLightbox=!0}},{setOpacity:({action:g,value:_})=>{e.layerControl({action:g,value:_})}}),null,16,["setOpacity"])])):T("",!0),Z(m,{dimensionMapStatus:e.state.toSearchDimensionStatus,currentLayers:e.state.currentLayers,mapCount:e.state.mapCount,openConditionWrap:()=>{e.state.conditionWrap=!e.state.conditionWrap,e.state.layerSelect=!1},openLayerSelect:()=>{e.state.layerSelect=!e.state.layerSelect,e.state.conditionWrap=!1},onLayerControl:({action:g,value:_})=>{e.layerControl({action:g,value:_})},onChangeTarget:g=>{e.changeTarget(g)},onConditionWrap:t[10]||(t[10]=g=>{e.conditionWrap(g)})},null,8,["dimensionMapStatus","currentLayers","mapCount","openConditionWrap","openLayerSelect","onLayerControl","onChangeTarget"])])])}const qr=Y(Mr,[["render",$r]]);export{qr as default};
//# sourceMappingURL=WebMap-ce2fcaf0.js.map
