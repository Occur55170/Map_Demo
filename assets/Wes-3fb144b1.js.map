{"version":3,"file":"Wes-3fb144b1.js","sources":["../../src/view/Wes.vue"],"sourcesContent":["<script>\r\nimport { useSlots, onBeforeMount, onMounted, onBeforeUnmount, ref, reactive, computed, watch, nextTick, defineAsyncComponent, useCssModule, inject, getCurrentInstance } from 'vue'\r\nimport $ from 'jquery'\r\n\r\nimport { Map, View } from 'ol'\r\nimport 'ol/ol.css'\r\nimport { OSM } from 'ol/source.js'\r\nimport { Tile, Tile as TileLayer, Image as ImageLayer, Vector, Vector as VectorLayer } from 'ol/layer.js'\r\n\r\nimport baseMapList, { getBaseMapAll } from '@/config/baseMapList'\r\nimport { toPng } from \"html-to-image\"\r\nimport TileWMS from 'ol/source/TileWMS'\r\nimport ImageWMS from 'ol/source/ImageWMS';\r\nimport ImageStatic from 'ol/source/ImageStatic'\r\n\r\nimport proj4 from 'proj4'\r\nimport { register } from 'ol/proj/proj4.js'\r\nproj4.defs(\r\n    'EPSG:3826',\r\n    '+proj=tmerc +lat_0=0 +lon_0=121 +k=0.9999 +x_0=250000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +type=crs'\r\n)\r\nproj4.defs(\"ESRI:54032\", \"+proj=aeqd +lat_0=52.346900 +lon_0=19.092600 +x_0=800 +y_0=800 +ellps=sphere +datum=WGS84 +units=m +no_defs\");\r\n\r\nregister(proj4)\r\nexport default {\r\n    props: {\r\n    },\r\n    setup(props, { emit }) {\r\n        const state = reactive({\r\n            layerDataList: []\r\n        })\r\n        let map\r\n        onMounted(async () => {\r\n            console.log(1)\r\n            map = new Map({\r\n                target: 'imgMap',\r\n                layers: [\r\n                    new TileLayer({\r\n                        source: new OSM(),\r\n                    }),\r\n                ],\r\n                view: new View({\r\n                    center: [120.971859, 24.801583], // 地圖中心點\r\n                    zoom: 10, // 初始縮放級別\r\n                    projection: 'EPSG:4326'\r\n                })\r\n            })\r\n        })\r\n\r\n\r\n        function getLayerData() {\r\n            return $.ajax({\r\n                url: 'https://api.edtest.site/layers',\r\n                method: \"GET\"\r\n            }).done(res => {\r\n                state.layerDataList = res\r\n            })\r\n        }\r\n\r\n        // 加入即時雷達圖層\r\n        function adLayer() {\r\n            let vectorLayer = new Image({\r\n                source: new ImageStatic({\r\n                    url: state.layerDataList[14].tiles_url,\r\n                    imageExtent: state.layerDataList[14]?.image_options?.image_extent,\r\n                    projection: 'EPSG:3857', // 圖片投影，根據需求更改\r\n                    imageLoadFunction: function (image, src) {\r\n                        var img = new Image();\r\n                        img.onload = function () {\r\n                            // 將圖片資料複製到畫布上\r\n                            var canvas = document.createElement('canvas');\r\n                            canvas.width = img.width;\r\n                            canvas.height = img.height;\r\n                            var context = canvas.getContext('2d');\r\n                            context.drawImage(img, 0, 0);\r\n                            image.getImage().src = canvas.toDataURL('image/png');\r\n                        };\r\n                        img.src = src;\r\n                    }\r\n                })\r\n            })\r\n\r\n            map.addLayer(vectorLayer)\r\n        }\r\n\r\n        function showCurrentLayer() {\r\n            console.log(map.getLayers().getArray())\r\n        }\r\n        onMounted(async () => {\r\n            await getLayerData()\r\n        })\r\n\r\n        return {\r\n            state,\r\n            map,\r\n            adLayer,\r\n            showCurrentLayer\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<template>\r\n    <div>\r\n        <div id=\"imgMap\"></div>\r\n        <button @click=\"adLayer()\">adLayer</button>\r\n        <button @click=\"showCurrentLayer()\">showCurrentLayer</button>\r\n    </div>\r\n</template>\r\n\r\n<style lang=\"sass\" scoped>\r\n#imgMap\r\n    width: 100vw\r\n    height: 1000px\r\n</style>\r\n\r\n"],"names":["proj4","register","_sfc_main","props","emit","state","reactive","onMounted","OSM","adLayer","_b","_a","image","src","img","canvas","context","map","getLayerData","showCurrentLayer","_cache","$event","$setup"],"mappings":"yLAiBAA,EAAA,+IAGA,EACAA,EAAA,KAAA,aAAA,6GAAA,EAEAC,EAAAD,CAAA,EACA,MAAAE,EAAA,CACI,MAAA,GAEA,MAAAC,EAAA,CAAA,KAAAC,GAAA,CACI,MAAAC,EAAAC,EAAA,CACI,cAAA,CAAA,UAGJC,EAAA,SAAA,yBAGQ,OAAA,SACA,OAAA,QAEQ,OAAA,IAAAC,CACJ,CAAA,eAGA,OAAA,CAAA,WAAA,SAAA,EACA,KAAA,GACA,WAAA,8CAQJ,IAAA,4EAKR,CAGA,SAAAC,GAAA,wCAGY,IAAAJ,EAAA,cAAA,EAAA,EAAA,UACA,aAAAK,GAAAC,EAAAN,EAAA,cAAA,EAAA,IAAA,YAAAM,EAAA,gBAAA,YAAAD,EAAA,aACA,WAAA,YACA,kBAAA,SAAAE,EAAAC,EAAA,CACI,IAAAC,EAAA,IAAA,MACAA,EAAA,OAAA,UAAA,CAEI,IAAAC,EAAA,SAAA,cAAA,QAAA,oCAGA,IAAAC,EAAAD,EAAA,WAAA,IAAA,uEAKR,mBAKZ,cAGI,QAAA,IAAAE,EAAA,UAAA,EAAA,SAAA,CAAA,CACJ,CACA,OAAAV,EAAA,SAAA,CACI,MAAAW,EAAA,IAGJ,SAEI,IAAAD,EACA,QAAAR,EACA,iBAAAU,CACJ,CACJ,CACJ,iJAMiB,QAAAC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,GAAAC,EAAA,QAAA,2BACA,QAAAF,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,GAAAC,EAAA,iBAAA"}