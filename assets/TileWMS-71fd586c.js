import{b8 as b,a9 as p,aR as P,t as T,c6 as _,T as E,aS as A,c0 as I,aT as j,a as y,c7 as F,c8 as M,c9 as N}from"./proj4-56d3a803.js";function z(h,e){const s=(""+h).split("."),r=(""+e).split(".");for(let t=0;t<Math.max(s.length,r.length);t++){const u=parseInt(s[t]||"0",10),i=parseInt(r[t]||"0",10);if(u>i)return 1;if(i>u)return-1}return 0}function R(h,e){const s=[];Object.keys(e).forEach(function(t){e[t]!==null&&e[t]!==void 0&&s.push(t+"="+encodeURIComponent(e[t]))});const r=s.join("&");return h=h.replace(/[?&]$/,""),h+=h.includes("?")?"&":"?",h+r}const d="1.3.0";class L extends b{constructor(e){e=e||{};const s=Object.assign({},e.params),r="TRANSPARENT"in s?s.TRANSPARENT:!0;super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,opaque:!r,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.params_=s,this.v13_=!0,this.serverType_=e.serverType,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.tmpExtent_=p(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(e,s,r,t){const u=P(r),i=this.getProjection();let n=this.getTileGrid();n||(n=this.getTileGridForProjection(u));const o=n.getZForResolution(s,this.zDirection),l=n.getTileCoordForCoordAndZ(e,o);if(n.getResolutions().length<=l[0])return;let c=n.getResolution(l[0]),a=n.getTileCoordExtent(l,this.tmpExtent_),f=T(n.getTileSize(l[0]),this.tmpSize);const S=this.gutter_;S!==0&&(f=_(f,S,this.tmpSize),a=E(a,c*S,a)),i&&i!==u&&(c=A(i,u,e,c),a=I(a,u,i),e=j(e,u,i));const g={SERVICE:"WMS",VERSION:d,REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};Object.assign(g,this.params_,t);const m=Math.floor((e[0]-a[0])/c),O=Math.floor((a[3]-e[1])/c);return g[this.v13_?"I":"X"]=m,g[this.v13_?"J":"Y"]=O,this.getRequestUrl_(l,f,a,1,i||u,g)}getLegendUrl(e,s){if(this.urls[0]===void 0)return;const r={SERVICE:"WMS",VERSION:d,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(s===void 0||s.LAYER===void 0){const t=this.params_.LAYERS;if(!(!Array.isArray(t)||t.length===1))return;r.LAYER=t}if(e!==void 0){const t=this.getProjection()?this.getProjection().getMetersPerUnit():1,u=28e-5;r.SCALE=e*t/u}return Object.assign(r,s),R(this.urls[0],r)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(e,s,r,t,u,i){const n=this.urls;if(!n)return;if(i.WIDTH=s[0],i.HEIGHT=s[1],i[this.v13_?"CRS":"SRS"]=u.getCode(),"STYLES"in this.params_||(i.STYLES=""),t!=1)switch(this.serverType_){case"geoserver":const a=90*t+.5|0;"FORMAT_OPTIONS"in i?i.FORMAT_OPTIONS+=";dpi:"+a:i.FORMAT_OPTIONS="dpi:"+a;break;case"mapserver":i.MAP_RESOLUTION=90*t;break;case"carmentaserver":case"qgis":i.DPI=90*t;break;default:y(!1,52);break}const o=u.getAxisOrientation(),l=r;if(this.v13_&&o.substr(0,2)=="ne"){let a;a=r[0],l[0]=r[1],l[1]=a,a=r[2],l[2]=r[3],l[3]=a}i.BBOX=l.join(",");let c;if(n.length==1)c=n[0];else{const a=F(M(e),n.length);c=n[a]}return R(c,i)}getTilePixelRatio(e){return!this.hidpi_||this.serverType_===void 0?1:e}getKeyForParams_(){let e=0;const s=[];for(const r in this.params_)s[e++]=r+"-"+this.params_[r];return s.join("/")}updateParams(e){Object.assign(this.params_,e),this.updateV13_(),this.setKey(this.getKeyForParams_())}updateV13_(){const e=this.params_.VERSION||d;this.v13_=z(e,"1.3")>=0}tileUrlFunction(e,s,r){let t=this.getTileGrid();if(t||(t=this.getTileGridForProjection(r)),t.getResolutions().length<=e[0])return;s!=1&&(!this.hidpi_||this.serverType_===void 0)&&(s=1);const u=t.getResolution(e[0]);let i=t.getTileCoordExtent(e,this.tmpExtent_),n=T(t.getTileSize(e[0]),this.tmpSize);const o=this.gutter_;o!==0&&(n=_(n,o,this.tmpSize),i=E(i,u*o,i)),s!=1&&(n=N(n,s,this.tmpSize));const l={SERVICE:"WMS",VERSION:d,REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};return Object.assign(l,this.params_),this.getRequestUrl_(e,n,i,s,r,l)}}const G=L;export{d as D,G as T,R as a,z as c};
//# sourceMappingURL=TileWMS-71fd586c.js.map
