import{V as q,O as W,m as E,M as P,b as I,S as G,c as Q,a as U,_ as X,d as H,e as K,f as $,g as ee,h as te,i as ae,j as oe,k as re,F as ne,P as se,l as le,I as ie}from"./logo-106387c9.js";import{_ as de,r as ce,c as B,o as ue,$ as me,n as Z,a as h,b as y,d as M,e as Y,f as C,m as ye,g as pe,h as fe,i as ge,j as b}from"./index-6e88b485.js";const be={props:{},setup(R,{emit:d}){const x=E,o=I,e=ce({defaultCenter:[121.326776,24.655499],defaultCenterZoom:14,targetNum:1,conditionWrap:!1,layerSelect:!1,currentLayers:[],layers:[],mapLayers:B(()=>e.layers.map((r,t)=>({label:r.group_title,value:r.value,layers:r.group_layers,groupClass:r.group_class}))),baseMapsOptions:B(()=>I.sourceData()),selectLock:!1,mapCount:1,map1:null,map2:null,map1LayerStatus:[],map2LayerStatus:[],deleteLightbox:!1,dimensionMap:{map1:"2D",map2:"2D"},toSearchDimensionStatus:B(()=>{let r=e.targetNum==1?"map1":"map2";return e.dimensionMap[r]==="2D"}),ol3d:null,selectValueTemp:0,areaData:{nodeRef:null,overlay:null,tribeAreaData:{}}}),D=new q({projection:"EPSG:4326",center:e.defaultCenter,zoom:e.defaultCenterZoom});let f=null;function F(){e.map1=new P({target:"map1",layers:[I.sourceFun("default")],view:D,controls:[]})}function j(r,t){const n=new oe({source:new re({features:[new ne({geometry:new se([r,t]),name:"Null Island",population:4e3,rainfall:500})]}),style:new le({image:new ie({anchor:[.5,100],anchorXUnits:"fraction",anchorYUnits:"pixels",src:"https://www.ockert-cnc.de/wp-content/uploads/2016/12/map-marker-icon-100x100.png"})})});let a=e.targetNum==1?"map1":"map2";e[a].addLayer(n)}function z({action:r,value:t}){var p;let n=((p=e.map1)==null?void 0:p.getTarget())==null?"map2":"map1",a=e[n].getView();switch(r){case"In":a.animate({zoom:a.getZoom()+1});break;case"Out":a.animate({zoom:a.getZoom()-1});break;case"toNorth":a.animate({rotation:0});break;case"moveTo":if(t){const{xAxis:c,yAxis:L}=t;a.animate({center:[c,L],zoom:10,duration:100})}else navigator.geolocation.getCurrentPosition(function(c){a.animate({center:[c.coords.longitude,c.coords.latitude],zoom:17,duration:100}),j(c.coords.longitude,c.coords.latitude)});break;case"fullScreen":let i=document.getElementById(`map${e.targetNum}`);i.requestFullscreen?i.requestFullscreen():i.msRequestFullscreen?i.msRequestFullscreen():i.mozRequestFullScreen?i.mozRequestFullScreen():i.webkitRequestFullscreen&&i.webkitRequestFullscreen();break}}function S({action:r,value:t}){var p;let n=e.targetNum==1?e.map1:e.map2,a=n==null?void 0:n.getLayers();switch(r){case"layerMode":if(console.log(t.id),t.checked){e.layers[t.nodeIndex].group_layers[t.subNodeIndex].single_tiles||(a.getArray().forEach(v=>{v.get("id")&&v.get("id").includes(`node${t.nodeIndex}_subNode${t.subNodeIndex}_nestedSubNode`)&&n.removeLayer(v)}),k("delete",n.getTarget(),t.id));let s=t.nestedSubNodeIndex||e.selectValueTemp,g=x.getLayer(e.layers[t.nodeIndex].group_layers[t.subNodeIndex],s,t.id);n.addLayer(g),t.id==="node0_subNode3_nestedSubNodeundefined"&&S({action:"layerMode",value:{checked:!0,id:"node0_subNode4_nestedSubNodeundefined",nestedSubNode:!1,nestedSubNodeIndex:void 0,nodeIndex:0,subNodeIndex:4}}),t.id==="node0_subNode4_nestedSubNodeundefined"&&l(n),k("add",n.getTarget(),t.id)}else{let s=a.getArray(),g;switch(t.id){case"node0_subNode0_nestedSubNodeundefined":g=s.filter(m=>m.get("id")==="node0_subNode0_nestedSubNodeundefined"),g.forEach(m=>{n.removeLayer(m)});break;case"node3_subNode1_nestedSubNodeundefined":g=s.filter(m=>m.get("id")==="node3_subNode1_nestedSubNodeundefined"),g.forEach(m=>{n.removeLayer(m)});break;default:s.forEach(m=>{m.get("id")==t.id&&n.removeLayer(m)});break}k("delete",n.getTarget(),t.id)}break;case"selectLayerMode":if(e.selectLock)return;t.layerName==="all"?a.getArray().filter(m=>m.get("name")!=="default").forEach(m=>{n.removeLayer(m)}):a.getArray().forEach(g=>{g.get("id")==t.id&&n.removeLayer(g)});break;case"changeOrder":if(e.selectLock)return;let i=E.getLayerIndex(t.id),c=x.getLayer(e.layers[i.nodeIndex].group_layers[i.subNodeIndex],i.nestedSubNodeIndex,t.id);if(t.movement==="up"){if(t.key+1==a.getArray().length)return;t.checked=!1,S({action:"layerMode",value:t}),a.insertAt(t.key+1,c)}if(t.movement==="down"){if(t.key-1==0)return;t.checked=!1,S({action:"layerMode",value:t}),a.insertAt(t.key-1,c)}break;case"changeLayerVisible":if(e.selectLock)return;let L=!a.getArray()[t.key].getVisible();a.getArray()[t.key].setVisible(L);break;case"baseMap":let w=o.sourceFun(t.layerName);a.extend([w]),a.getArray().forEach(s=>{s.get("name")!==t.layerName&&n.removeLayer(s)});break;case"changeMapCount":if(e.mapCount===t)return;let N=e.targetNum!==1?"map1":"map2";e.mapCount=t;let J=e[`${N}LayerStatus`].filter(s=>s!=="3D").map(s=>E.getLayerIndex(s));if(t===2&&(e[N]=new P({target:N,layers:[I.sourceFun("default"),...J.map(s=>x.getLayer(e.layers[s.nodeIndex].group_layers[s.subNodeIndex],s.nestedSubNodeIndex,s.id))],view:D,controls:[]}),((p=e[`${N}LayerStatus`])==null?void 0:p.indexOf("3D"))!==-1)){f=new W({map:e[N]}),f.setEnabled(!0),Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0NzM3MWFhYS0xMjNlLTQ3MTMtODFjZS0xZjMzM2I5NGZiYTEiLCJpZCI6MTMwODE4LCJpYXQiOjE2ODQwNzM3Mjl9.UYu4kBialPo19dcvosHzZTpg2BD1zkFQnjCD78YiiYo";let s=f.getCesiumScene({});s.terrainProvider=Cesium.createWorldTerrain({})}if(t===1){e[N]=null;const s=document.getElementById(N);for(;s.firstChild;)s.removeChild(s.firstChild)}break;case"changeDimensionMap":let A=e.targetNum==1?"map1":"map2";if(e.dimensionMap[A]=t,t==="3D"){f=new W({map:n}),f.setEnabled(!0),Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0NzM3MWFhYS0xMjNlLTQ3MTMtODFjZS0xZjMzM2I5NGZiYTEiLCJpZCI6MTMwODE4LCJpYXQiOjE2ODQwNzM3Mjl9.UYu4kBialPo19dcvosHzZTpg2BD1zkFQnjCD78YiiYo";let s=f.getCesiumScene({});s.terrainProvider=Cesium.createWorldTerrain({}),e[`${A}LayerStatus`].push("3D")}else f.setEnabled(!1),e[`${A}LayerStatus`]=e[`${A}LayerStatus`].filter(s=>s!=="3D");break}_()}function V(r){var n;e.targetNum=r;let t=e.targetNum!==1?"map1":"map2";if(e.mapCount===1){if(!e[`map${r}`]){let a=e[`map${r}LayerStatus`].filter(i=>i!=="3D");a.includes("node0_subNode4_nestedSubNodeundefined")&&(a=[...a.filter(c=>c!=="node0_subNode4_nestedSubNodeundefined"),"node0_subNode4_nestedSubNodeundefined"]);let p=a.map(i=>E.getLayerIndex(i));e[`map${r}`]=new P({target:`map${r}`,layers:[I.sourceFun("default"),...p.map(i=>x.getLayer(e.layers[i.nodeIndex].group_layers[i.subNodeIndex],i.nestedSubNodeIndex,i.layeredIndex))],view:D,controls:[]}),l(e[`map${r}`]),((n=e[`map${r}LayerStatus`])==null?void 0:n.indexOf("3D"))!==-1&&(f=new W({map:e[`map${r}`]}),f.setEnabled(!0))}if(e[t]){e[t]=null;const a=document.getElementById(t);for(;a.firstChild;)a.removeChild(a.firstChild)}}Z(()=>{_()})}function _(){var n;let r=e.targetNum==1?e.map1:e.map2;const t=(n=r==null?void 0:r.getLayers())==null?void 0:n.getArray();e.currentLayers=t==null?void 0:t.map(a=>({label:a.get("label"),id:a.get("id"),visible:a.getVisible()}))}function T(){e.conditionWrap=!e.conditionWrap}function k(r,t,n){if(r==="add")e[`${t}LayerStatus`].push(n);else if(r==="delete"){let a=e[`${t}LayerStatus`].findIndex(p=>p===n);e[`${t}LayerStatus`].splice(a,1)}else console.log("error")}function l(r){var n;let t=new G({layers:(n=r==null?void 0:r.getLayers())==null?void 0:n.getArray(),condition:Q});r.addInteraction(t),t.on("select",a=>{let p=a.selected;a.selected[0]?(e.areaData.overlay=new U({element:e.areaData.nodeRef,autoPan:!0,autoPanAnimation:{duration:250}}),r.addOverlay(e.areaData.overlay),e.areaData.overlay.setPosition(a.mapBrowserEvent.coordinate),p.forEach(i=>{let c=i.getProperties();Object.entries(c).forEach(L=>{const w=L[0],O=L[1];e.areaData.tribeAreaData[w]=O})})):(r.removeOverlay(e.areaData.overlay),e.areaData.overlay=null)})}function u(){(e.targetNum==1?e.map1:e.map2).removeOverlay(e.areaData.overlay),e.areaData.overlay=null}return ue(async()=>{await me.ajax({url:"https://api.edtest.site/layers",method:"GET"}).done(r=>{e.layers=r.map((t,n)=>(t.group_layers.forEach((a,p)=>{let i=p,c;a.id=`node${n}_subNode${i}_nestedSubNode${c}`,["node0_subNode3_nestedSubNodeundefined","node0_subNode4_nestedSubNodeundefined","node0_subNode5_nestedSubNodeundefined"].includes(a.id)&&(a.tiles_url=a.tiles_url.replace(/http:\/\//g,"https://"),console.log(a.tiles_url)),a.single_tiles||a.tiles_list.forEach((w,O)=>{c=O,w.id=`node${n}_subNode${i}_nestedSubNode${c}`})}),{...t,value:n})),Z(()=>{F(),_()})}).fail(r=>{console.log("Fail",r)})}),{state:e,props:R,mapControl:z,layerControl:S,getCurrentLayerNames:_,changeTarget:V,conditionWrap:T,closeMapData:u}}},_e={class:"SearchBar position-absolute"},Le=y("img",{src:X,alt:"",class:"mb-2"},null,-1),Ne={class:"w-100 d-flex flex-nowrap mapWrap",id:"mapWrap"},he={key:0,class:"middleLine"},Ce={class:"condition position-absolute"},Se={class:"mb-2"},ke={key:1,class:"mb-4"},xe={key:1},we={key:0,class:"lightWrap w-100 h-100 d-flex justify-content-center align-items-center"},Ie={class:"p-4 rounded bg-white",style:{width:"250px"}},Me=y("p",{class:"text-center fw-bold"},"是否要刪除全部圖層",-1),De={class:"d-flex justify-content-around"};function Te(R,d,x,o,e,D){var _,T,k;const f=H,F=K,j=$,z=ee,S=te,V=ae;return b(),h("div",null,[y("div",_e,[Le,M(f,{dimensionMapStatus:o.state.toSearchDimensionStatus,currentLayers:o.state.currentLayers,mapCount:o.state.mapCount,onOnLayerControl:d[0]||(d[0]=({action:l,value:u})=>{o.layerControl({action:l,value:u})}),onOnChangeTarget:d[1]||(d[1]=l=>{o.changeTarget(l)}),onConditionWrap:d[2]||(d[2]=l=>{o.conditionWrap(l)})},null,8,["dimensionMapStatus","currentLayers","mapCount"])]),M(F,{class:"mapSourceOption",baseMapsOptions:o.state.baseMapsOptions,onOnChangeBaseMaps:d[3]||(d[3]=({action:l,value:u})=>{o.layerControl({action:l,value:u})})},null,8,["baseMapsOptions"]),M(j,{class:"asideTool position-absolute top-50 translate-middle-y",id:"asideTool",onOnMapControl:d[4]||(d[4]=({action:l,value:u})=>{o.mapControl({action:l,value:u})})}),y("div",Ne,[y("div",{id:"map1",class:Y({"w-100":((_=o.state.map1)==null?void 0:_.getTarget())=="map1"})},null,2),o.state.mapCount===2?(b(),h("div",he)):C("",!0),y("div",{id:"map2",class:Y({"w-100":((T=o.state.map2)==null?void 0:T.getTarget())=="map2"})},null,2)]),y("div",Ce,[y("div",Se,[o.state.conditionWrap?C("",!0):(b(),h("button",{key:0,class:"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5",onClick:d[5]||(d[5]=l=>o.state.conditionWrap=!0)}," 圖層選項 ")),o.state.conditionWrap?(b(),h("div",ke,[M(z,ye({mapLayers:o.state.mapLayers,currentLayers:o.state.currentLayers,onClose:()=>{o.state.conditionWrap=!1},showSelectLayerValue:l=>{o.state.selectValueTemp=l}},{onOnMapControl:d[6]||(d[6]=({action:l,value:u})=>{o.mapControl({action:l,value:u})}),onOnLayerControl:d[7]||(d[7]=({action:l,value:u})=>{o.layerControl({action:l,value:u})})}),null,16)])):C("",!0)]),y("div",null,[o.state.layerSelect?C("",!0):(b(),h("button",{key:0,class:"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5",onClick:d[8]||(d[8]=l=>o.state.layerSelect=!0)}," 已選擇的圖層 ")),o.state.layerSelect?(b(),h("div",xe,[M(S,pe(fe({selectLock:o.state.selectLock,currentLayers:o.state.currentLayers,onClose:()=>{o.state.layerSelect=!1},onChangLayerVisible:l=>{o.layerControl(l)},onChangeOrderLayer:({action:l,value:u})=>{o.layerControl({action:l,value:u})},onLockLayer:()=>{o.state.selectLock=!o.state.selectLock},onDeleteLayer:({action:l,value:u})=>{u.layerName=="all"?o.state.deleteLightbox=!0:o.layerControl({action:l,value:u})},onDeleteLayerAll:()=>{o.state.deleteLightbox=!0}})),null,16)])):C("",!0)])]),o.state.deleteLightbox?(b(),h("div",we,[y("div",Ie,[Me,y("div",De,[y("button",{class:"rounded px-3 py-1 bg-steel text-white border-0",onClick:d[9]||(d[9]=()=>{o.layerControl({action:"selectLayerMode",value:{layerName:"all"}}),o.state.deleteLightbox=!1})},"確定"),y("button",{class:"rounded px-3 py-1 bg-secondary bg-gradient text-white border-0",onClick:d[10]||(d[10]=()=>{o.state.deleteLightbox=!1})},"取消")])])])):C("",!0),y("div",{id:"popup",style:{position:"fixed",top:"100%",left:"100%"},ref:l=>{o.state.areaData.nodeRef=l}},[(k=o.state.areaData)!=null&&k.overlay?(b(),ge(V,{key:0,class:"areaData",closeMapData:()=>{o.closeMapData()},tribeAreaData:o.state.areaData.tribeAreaData,maxHeight:500},null,8,["closeMapData","tribeAreaData"])):C("",!0)],512)])}const Fe=de(be,[["render",Te]]);export{Fe as default};
//# sourceMappingURL=Wes-2c5186ff.js.map
