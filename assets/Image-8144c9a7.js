import{bl as Z,a6 as B,I as K,W as $,bm as ee,O as u,Q as x,R as A,bn as te,p as se,E as Q,u as ie,bo as ne,bp as ae,bq as re,ac as G,aI as oe,ab as ce,b1 as he,K as ge,Y as ue,br as D,bs as U,bt as T,v as X,bu as H,L as le,A as V,bj as de,bv as _e,bw as W,aH as Y,bx as me,aK as Ie,by as Ee,aC as q,bz as Re,bA as fe,N as pe}from"./Tile-cf32733c.js";function Se(h,e){const t=(""+h).split("."),s=(""+e).split(".");for(let n=0;n<Math.max(t.length,s.length);n++){const i=parseInt(t[n]||"0",10),a=parseInt(s[n]||"0",10);if(i>a)return 1;if(a>i)return-1}return 0}class xe extends Z{constructor(e,t,s,n,i,a,o){const r=e.getExtent(),c=t.getExtent(),g=c?B(s,c):s,I=K(g),d=$(e,t,I,n),_=ne,E=new ee(e,t,g,r,d*_,n),L=E.calculateSourceExtent(),m=a(L,d,i),f=m?u.IDLE:u.EMPTY,p=m?m.getPixelRatio():1;super(s,n,p,f),this.targetProj_=t,this.maxSourceExtent_=r,this.triangulation_=E,this.targetResolution_=n,this.targetExtent_=s,this.sourceImage_=m,this.sourcePixelRatio_=p,this.interpolate_=o,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==u.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(e==u.LOADED){const t=x(this.targetExtent_)/this.targetResolution_,s=A(this.targetExtent_)/this.targetResolution_;this.canvas_=te(t,s,this.sourcePixelRatio_,this.sourceImage_.getResolution(),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_)}this.state=e,this.changed()}load(){if(this.state==u.IDLE){this.state=u.LOADING,this.changed();const e=this.sourceImage_.getState();e==u.LOADED||e==u.ERROR?this.reproject_():(this.sourceListenerKey_=se(this.sourceImage_,Q.CHANGE,function(t){const s=this.sourceImage_.getState();(s==u.LOADED||s==u.ERROR)&&(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}}unlistenSource_(){ie(this.sourceListenerKey_),this.sourceListenerKey_=null}}const Ae=xe,P={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class Le extends he{constructor(e,t){super(e),this.image=t}}class ve extends ae{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:e.interpolate!==void 0?e.interpolate:!0}),this.on,this.once,this.un,this.resolutions_=e.resolutions!==void 0?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){const t=this.getResolutions();if(t){const s=re(t,e,0);e=t[s]}return e}getImage(e,t,s,n){const i=this.getProjection();if(!i||!n||G(i,n))return i&&(n=i),this.getImageInternal(e,t,s,n);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&G(this.reprojectedImage_.getProjection(),n)&&this.reprojectedImage_.getResolution()==t&&oe(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new Ae(i,n,e,t,s,(a,o,r)=>this.getImageInternal(a,o,r,i),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,t,s,n){return ce()}handleImageChange(e){const t=e.target;let s;switch(t.getState()){case u.LOADING:this.loading=!0,s=P.IMAGELOADSTART;break;case u.LOADED:this.loading=!1,s=P.IMAGELOADEND;break;case u.ERROR:this.loading=!1,s=P.IMAGELOADERROR;break;default:return}this.hasListener(s)&&this.dispatchEvent(new Le(s,t))}}function Oe(h,e){h.getImage().src=e}const ye=ve;function k(h,e){const t=[];Object.keys(e).forEach(function(n){e[n]!==null&&e[n]!==void 0&&t.push(n+"="+encodeURIComponent(e[n]))});const s=t.join("&");return h=h.replace(/[?&]$/,""),h+=h.includes("?")?"&":"?",h+s}const b="1.3.0",R=4,z=[101,101];class Te extends ye{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:Oe,this.params_=Object.assign({},e.params),this.v13_=!0,this.updateV13_(),this.serverType_=e.serverType,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.image_=null,this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5}getFeatureInfoUrl(e,t,s,n){if(this.url_===void 0)return;const i=ge(s),a=this.getProjection();a&&a!==i&&(t=$(a,i,e,t),e=ue(e,i,a));const o=D(e,t,0,z),r={SERVICE:"WMS",VERSION:b,REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};Object.assign(r,this.params_,n);const c=U((e[0]-o[0])/t,R),g=U((o[3]-e[1])/t,R);return r[this.v13_?"I":"X"]=c,r[this.v13_?"J":"Y"]=g,this.getRequestUrl_(o,z,1,a||i,r)}getLegendUrl(e,t){if(this.url_===void 0)return;const s={SERVICE:"WMS",VERSION:b,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(t===void 0||t.LAYER===void 0){const n=this.params_.LAYERS;if(!(!Array.isArray(n)||n.length===1))return;s.LAYER=n}if(e!==void 0){const n=this.getProjection()?this.getProjection().getMetersPerUnit():1,i=28e-5;s.SCALE=e*n/i}return Object.assign(s,t),k(this.url_,s)}getParams(){return this.params_}getImageInternal(e,t,s,n){if(this.url_===void 0)return null;t=this.findNearestResolution(t),s!=1&&(!this.hidpi_||this.serverType_===void 0)&&(s=1);const i=t/s,a=K(e),o=T(x(e)/i,R),r=T(A(e)/i,R),c=D(a,i,0,[o,r]),g=T(this.ratio_*x(e)/i,R),I=T(this.ratio_*A(e)/i,R),d=D(a,i,0,[g,I]),_=this.image_;if(_&&this.renderedRevision_==this.getRevision()&&_.getResolution()==t&&_.getPixelRatio()==s&&X(_.getExtent(),c))return _;const E={SERVICE:"WMS",VERSION:b,REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};Object.assign(E,this.params_),this.imageSize_[0]=H(x(d)/i,R),this.imageSize_[1]=H(A(d)/i,R);const L=this.getRequestUrl_(d,this.imageSize_,s,n,E);return this.image_=new le(d,t,s,L,this.crossOrigin_,this.imageLoadFunction_),this.renderedRevision_=this.getRevision(),this.image_.addEventListener(Q.CHANGE,this.handleImageChange.bind(this)),this.image_}getImageLoadFunction(){return this.imageLoadFunction_}getRequestUrl_(e,t,s,n,i){if(V(this.url_!==void 0,9),i[this.v13_?"CRS":"SRS"]=n.getCode(),"STYLES"in this.params_||(i.STYLES=""),s!=1)switch(this.serverType_){case"geoserver":const r=90*s+.5|0;"FORMAT_OPTIONS"in i?i.FORMAT_OPTIONS+=";dpi:"+r:i.FORMAT_OPTIONS="dpi:"+r;break;case"mapserver":i.MAP_RESOLUTION=90*s;break;case"carmentaserver":case"qgis":i.DPI=90*s;break;default:V(!1,8);break}i.WIDTH=t[0],i.HEIGHT=t[1];const a=n.getAxisOrientation();let o;return this.v13_&&a.substr(0,2)=="ne"?o=[e[1],e[0],e[3],e[2]]:o=e,i.BBOX=o.join(","),k(this.url_,i)}getUrl(){return this.url_}setImageLoadFunction(e){this.image_=null,this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.image_=null,this.changed())}updateParams(e){Object.assign(this.params_,e),this.updateV13_(),this.image_=null,this.changed()}updateV13_(){const e=this.params_.VERSION||b;this.v13_=Se(e,"1.3")>=0}}const Ne=Te;class be extends de{constructor(e){e=e||{},super(e)}}const je=be;class we extends _e{constructor(e){super(e),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(e){const t=e.layerStatesArray[e.layerIndex],s=e.pixelRatio,n=e.viewState,i=n.resolution,a=this.getLayer().getSource(),o=e.viewHints;let r=e.extent;if(t.extent!==void 0&&(r=B(r,W(t.extent,n.projection))),!o[Y.ANIMATING]&&!o[Y.INTERACTING]&&!me(r))if(a){const c=n.projection,g=a.getImage(r,i,s,c);g&&(this.loadImage(g)?this.image_=g:g.getState()===u.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(e){const t=this.frameState;if(!t)return null;const s=this.getLayer(),n=Ie(t.pixelToCoordinateTransform,e.slice()),i=s.getExtent();if(i&&!Ee(i,n))return null;const a=this.image_.getExtent(),o=this.image_.getImage(),r=x(a),c=Math.floor(o.width*((n[0]-a[0])/r));if(c<0||c>=o.width)return null;const g=A(a),I=Math.floor(o.height*((a[3]-n[1])/g));return I<0||I>=o.height?null:this.getImageData(o,c,I)}renderFrame(e,t){const s=this.image_,n=s.getExtent(),i=s.getResolution(),a=s.getPixelRatio(),o=e.layerStatesArray[e.layerIndex],r=e.pixelRatio,c=e.viewState,g=c.center,I=c.resolution,d=r*i/(I*a),_=e.extent,E=c.resolution,L=c.rotation,m=Math.round(x(_)/E*r),f=Math.round(A(_)/E*r);q(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/r,1/r,L,-m/2,-f/2),Re(this.inversePixelTransform,this.pixelTransform);const p=fe(this.pixelTransform);this.useContainer(t,p,this.getBackground(e));const l=this.context,S=l.canvas;S.width!=m||S.height!=f?(S.width=m,S.height=f):this.containerReused||l.clearRect(0,0,m,f);let j=!1,w=!0;if(o.extent){const O=W(o.extent,c.projection);w=pe(O,e.extent),j=w&&!X(O,e.extent),j&&this.clipUnrotated(l,e,O)}const v=s.getImage(),y=q(this.tempTransform,m/2,f/2,d,d,0,a*(n[0]-g[0])/i,a*(g[1]-n[3])/i);this.renderedResolution=i*r/a;const N=v.width*y[0],F=v.height*y[3];if(this.getLayer().getSource().getInterpolate()||(l.imageSmoothingEnabled=!1),this.preRender(l,e),w&&N>=.5&&F>=.5){const O=y[4],J=y[5],M=o.opacity;let C;M!==1&&(C=l.globalAlpha,l.globalAlpha=M),l.drawImage(v,0,0,+v.width,+v.height,O,J,N,F),M!==1&&(l.globalAlpha=C)}return this.postRender(l,e),j&&l.restore(),l.imageSmoothingEnabled=!0,p!==S.style.transform&&(S.style.transform=p),this.container}}const Me=we;class De extends je{constructor(e){super(e)}createRenderer(){return new Me(this)}getData(e){return super.getData(e)}}const Fe=De;export{b as D,ye as I,k as a,Fe as b,Se as c,Oe as d,Ne as e};
//# sourceMappingURL=Image-8144c9a7.js.map
