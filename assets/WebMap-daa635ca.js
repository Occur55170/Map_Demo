import{_ as F,r as W,o as me,a as ae,b as m,c as y,d as t,t as I,e as Y,F as E,f as A,g as D,$ as re,p as ee,h as te,w as v,n as $,i as _e,j as ie,v as le,u as ye,k as Q,l as se,m as R,q as fe,s as he,x as ge,y as Ce}from"./index-7dc2e559.js";import{o as P,a as ne,V as de,b as ce,c as be,O as X,M as K,d as Z,F as Le,P as ve,S as we,I as xe}from"./OLCesium-5ee2efc6.js";const ke="/Map_Demo/assets/example-AddressData-2d340b55.jpg",Me="/Map_Demo/assets/vector-a2cf21ef.svg";const Se={props:{tribeId:{Type:String,default:0},closeMapData:{Type:Function,default:()=>{}},maxHeight:{Type:Number,default:0}},setup(i,{emit:o}){const c=W({media:"photo",scrollY:!1,tribeData:{}});async function e(s){return await re.ajax({url:`https://api.edtest.site/tribe?tribeCode=${s}`,method:"GET"}).done(n=>n).fail(n=>(console.log("Fail",n),!1))}return me(i.tribeId,()=>{e(i.tribeId).then(s=>{c.tribeData=s})}),ae(()=>{e(i.tribeId).then(s=>{c.tribeData=s})}),{props:i,state:c}}},G=i=>(ee("data-v-e27c9311"),i=i(),te(),i),Ie={class:"bg-white rounded py-2",style:{"overflow-y":"auto"}},De={class:"row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold"},Ne=G(()=>t("svg",{width:"32",height:"32",viewBox:"0 0 24 24"},[t("path",{fill:"currentColor",d:"M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10zm0-11.414L9.172 7.757L7.757 9.172L10.586 12l-2.829 2.828l1.415 1.415L12 13.414l2.828 2.829l1.415-1.415L13.414 12l2.829-2.828l-1.415-1.415L12 10.586z"})],-1)),Te=[Ne],$e=G(()=>t("img",{src:ke,class:"w-100",alt:""},null,-1)),Ve={class:"row mx-0 align-items-center p-2 position-relative"},Oe=G(()=>t("div",{class:"position-absolute w-auto top-0 end-0 mt-2"},"更多資訊",-1)),Be={href:""},Fe=G(()=>t("img",{src:Me,alt:""},null,-1)),ze={class:"border-bottom row flex-nowrap p-2 my-3 cursor-pointer mx-0"},Ee={key:0,class:"py-2 px-4"},Ae={class:"d-flex flex-wrap justify-content-between"},We={class:"w-50 mb-4"},He={class:"mb-0"},Re=["src"],Pe={key:1,class:"py-2 px-4"},Ze=G(()=>t("div",null,"影片影片影片影片影片影片",-1)),je=[Ze];function Ye(i,o,c,e,s,b){var n,f,l,L,p,h,w,N,_,r,a,d,u,S,C,k,O,z,J,T,q;return m(),y("div",Ie,[t("div",De,[t("p",null,"詳細資訊 "+I(e.state.scrollY),1),t("div",{class:"position-absolute col-auto end-0",style:{top:"10px"},onClick:o[0]||(o[0]=(...B)=>c.closeMapData&&c.closeMapData(...B))},Te)]),$e,t("div",Ve,[t("p",null,"title: "+I(e.props.tribeId)+" "+I((l=(f=(n=e.state)==null?void 0:n.tribeData)==null?void 0:f.basicInformation)==null?void 0:l.tribeName),1),t("p",null,"描述: "+I((h=(p=(L=e.state)==null?void 0:L.tribeData)==null?void 0:p.basicInformation)==null?void 0:h.description),1),Oe,t("p",null,I((_=(N=(w=e.state)==null?void 0:w.tribeData)==null?void 0:N.basicInformation)==null?void 0:_.area),1),t("a",Be,[Fe,Y(" "+I((S=(u=(d=(a=(r=e.state)==null?void 0:r.tribeData)==null?void 0:a.basicInformation)==null?void 0:d.coordinates)==null?void 0:u.WGS84)==null?void 0:S.lat)+" , "+I((J=(z=(O=(k=(C=e.state)==null?void 0:C.tribeData)==null?void 0:k.basicInformation)==null?void 0:O.coordinates)==null?void 0:z.WGS84)==null?void 0:J.lng),1)])]),t("div",null,[t("div",ze,[t("div",{class:"col-6 cursor-pointer",onClick:o[1]||(o[1]=B=>e.state.media="photo")},"相片"),t("div",{class:"col-6 cursor-pointer",onClick:o[2]||(o[2]=B=>e.state.media="video")},"影片")]),e.state.media==="photo"?(m(),y("div",Ee,[t("div",Ae,[(m(!0),y(E,null,A((q=(T=e.state)==null?void 0:T.tribeData)==null?void 0:q.culturalLandscape,B=>(m(),y("div",We,[t("p",He,I(B.name),1),t("img",{src:B.image,alt:"",class:"w-100"},null,8,Re)]))),256))])])):D("",!0),e.state.media==="video"?(m(),y("div",Pe,je)):D("",!0)])])}const Ge=F(Se,[["render",Ye],["__scopeId","data-v-e27c9311"]]);const Ue={props:{onClose:{type:Function,default:()=>{}},onChangLayerVisible:{type:Function,default:()=>{}},onDeleteLayer:{type:Function,default:()=>{}},onLockLayer:{type:Function,default:()=>{}},onChangeOrderLayer:{type:Function,default:()=>{}},currentLayers:{type:Array,default:[]},selectLock:{type:Boolean,default:!1}},setup(i,{emit:o}){const c=W({});return{props:i,state:c}}},V=i=>(ee("data-v-b4ac34a6"),i=i(),te(),i),Je={class:"rounded-4 bg-white"},qe={class:"row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold"},Qe=V(()=>t("p",{class:"mb-0 fs-5"},"已選擇的圖層",-1)),Xe=V(()=>t("svg",{width:"32",height:"32",viewBox:"0 0 24 24"},[t("path",{fill:"currentColor",d:"M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10zm0-11.414L9.172 7.757L7.757 9.172L10.586 12l-2.829 2.828l1.415 1.415L12 13.414l2.828 2.829l1.415-1.415L13.414 12l2.829-2.828l-1.415-1.415L12 10.586z"})],-1)),Ke=[Xe],et=V(()=>t("hr",{class:"my-0"},null,-1)),tt={class:"py-3 px-4 content"},ot={class:"allControl d-flex align-items-center justify-content-end mb-0"},st=V(()=>t("svg",{viewBox:"0 0 25 24",fill:"currentColor"},[t("path",{d:"M8.02381 9.33333H14.881V7.80952C14.881 7.1746 14.6587 6.63492 14.2143 6.19048C13.7698 5.74603 13.2302 5.52381 12.5952 5.52381C11.9603 5.52381 11.4206 5.74603 10.9762 6.19048C10.5317 6.63492 10.3095 7.1746 10.3095 7.80952H8.78571C8.78571 6.75556 9.15727 5.85702 9.90038 5.1139C10.643 4.3713 11.5413 4 12.5952 4C13.6492 4 14.5477 4.3713 15.2909 5.1139C16.0335 5.85702 16.4048 6.75556 16.4048 7.80952V9.33333H17.1667C17.5857 9.33333 17.9446 9.48241 18.2432 9.78057C18.5414 10.0792 18.6905 10.4381 18.6905 10.8571V18.4762C18.6905 18.8952 18.5414 19.2541 18.2432 19.5528C17.9446 19.8509 17.5857 20 17.1667 20H8.02381C7.60476 20 7.24616 19.8509 6.948 19.5528C6.64933 19.2541 6.5 18.8952 6.5 18.4762V10.8571C6.5 10.4381 6.64933 10.0792 6.948 9.78057C7.24616 9.48241 7.60476 9.33333 8.02381 9.33333ZM12.5952 16.1905C13.0143 16.1905 13.3731 16.0414 13.6718 15.7432C13.97 15.4446 14.119 15.0857 14.119 14.6667C14.119 14.2476 13.97 13.8888 13.6718 13.5901C13.3731 13.2919 13.0143 13.1429 12.5952 13.1429C12.1762 13.1429 11.8176 13.2919 11.5194 13.5901C11.2208 13.8888 11.0714 14.2476 11.0714 14.6667C11.0714 15.0857 11.2208 15.4446 11.5194 15.7432C11.8176 16.0414 12.1762 16.1905 12.5952 16.1905Z"})],-1)),nt=V(()=>t("svg",{viewBox:"0 0 25 24",fill:"currentColor"},[t("path",{d:"M7.5 21C6.95 21 6.47933 20.8043 6.088 20.413C5.696 20.021 5.5 19.55 5.5 19V6H4.5V4H9.5V3H15.5V4H20.5V6H19.5V19C19.5 19.55 19.3043 20.021 18.913 20.413C18.521 20.8043 18.05 21 17.5 21H7.5ZM9.5 17H11.5V8H9.5V17ZM13.5 17H15.5V8H13.5V17Z"})],-1)),at={class:"list-unstyled d-flex flex-wrap flex-column-reverse"},rt={key:0,class:"d-flex justify-content-between align-items-center border-bottom py-2"},it={class:"tool"},lt=["onClick"],dt=V(()=>t("svg",{viewBox:"0 0 25 24",fill:"currentColor"},[t("path",{d:"M9.49991 19.84H15.4999V11.84H20.3399L12.4999 4.00003L4.65991 11.84H9.49991V19.84Z",fill:"#808080"})],-1)),ct=[dt],pt=["onClick"],ut=V(()=>t("svg",{viewBox:"0 0 25 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M9.49991 4H15.4999V12H20.3399L12.4999 19.84L4.65991 12H9.49991V4Z",fill:"#808080"})],-1)),mt=[ut],_t=["onClick"],yt=V(()=>t("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M12.3333 10C11.8029 10 11.2942 10.2107 10.9191 10.5858C10.544 10.9609 10.3333 11.4696 10.3333 12C10.3333 12.5304 10.544 13.0391 10.9191 13.4142C11.2942 13.7893 11.8029 14 12.3333 14C12.8638 14 13.3725 13.7893 13.7475 13.4142C14.1226 13.0391 14.3333 12.5304 14.3333 12C14.3333 11.4696 14.1226 10.9609 13.7475 10.5858C13.3725 10.2107 12.8638 10 12.3333 10ZM12.3333 15.3333C11.4493 15.3333 10.6014 14.9821 9.97631 14.357C9.35119 13.7319 9 12.8841 9 12C9 11.1159 9.35119 10.2681 9.97631 9.64298C10.6014 9.01786 11.4493 8.66667 12.3333 8.66667C13.2174 8.66667 14.0652 9.01786 14.6904 9.64298C15.3155 10.2681 15.6667 11.1159 15.6667 12C15.6667 12.8841 15.3155 13.7319 14.6904 14.357C14.0652 14.9821 13.2174 15.3333 12.3333 15.3333ZM12.3333 7C9 7 6.15333 9.07333 5 12C6.15333 14.9267 9 17 12.3333 17C15.6667 17 18.5133 14.9267 19.6667 12C18.5133 9.07333 15.6667 7 12.3333 7Z",fill:"#808080"})],-1)),ft=[yt],ht=["onClick"],gt=V(()=>t("svg",{viewBox:"0 0 25 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M7.5 21C6.95 21 6.47933 20.8043 6.088 20.413C5.696 20.021 5.5 19.55 5.5 19V6H4.5V4H9.5V3H15.5V4H20.5V6H19.5V19C19.5 19.55 19.3043 20.021 18.913 20.413C18.521 20.8043 18.05 21 17.5 21H7.5ZM9.5 17H11.5V8H9.5V17ZM13.5 17H15.5V8H13.5V17Z",fill:"#808080"})],-1)),Ct=[gt];function bt(i,o,c,e,s,b){return m(),y("div",Je,[t("div",qe,[Qe,t("a",{href:"",class:"closeBtn position-absolute col-auto",onClick:o[0]||(o[0]=v((...n)=>e.props.onClose&&e.props.onClose(...n),["prevent"]))},Ke)]),et,t("div",tt,[t("div",ot,[t("a",{href:"",class:$(["d-flex align-items-center text-decoration-none me-4",{lockUp:e.props.selectLock,unlock:!e.props.selectLock}]),onClick:o[1]||(o[1]=v(()=>{e.props.onLockLayer()},["prevent"]))},[st,Y(" 鎖定圖層 ")],2),t("a",{href:"",class:$(["d-flex align-items-center text-decoration-none",{disabled:e.props.currentLayers.length<=1}]),onClick:o[2]||(o[2]=v(()=>{e.props.currentLayers.length>0&&e.props.onDeleteLayer({action:"selectLayerMode",value:{layerName:"all"}})},["prevent"]))},[nt,Y(" 全部刪除 ")],2)]),t("ul",at,[(m(!0),y(E,null,A(e.props.currentLayers,(n,f)=>(m(),y("li",null,[n.id?(m(),y("div",rt,[t("div",null,I(n==null?void 0:n.label),1),t("div",it,[t("a",{href:"",onClick:v(l=>e.props.onChangeOrderLayer({action:"changeOrder",value:{movement:"up",id:n.id,key:f}}),["prevent"])},ct,8,lt),t("a",{href:"",onClick:v(l=>e.props.onChangeOrderLayer({action:"changeOrder",value:{movement:"down",id:n.id,key:f}}),["prevent"])},mt,8,pt),t("a",{href:"",class:$({Invisible:!(n!=null&&n.visible)}),onClick:v(()=>{e.props.onChangLayerVisible({action:"changeLayerVisible",value:{key:f}})},["prevent"])},ft,10,_t),t("a",{href:"",onClick:v(l=>e.props.onDeleteLayer({action:"selectLayerMode",value:{id:n==null?void 0:n.id}}),["prevent"])},Ct,8,ht)])])):D("",!0)]))),256))])])])}const Lt=F(Ue,[["render",bt],["__scopeId","data-v-b4ac34a6"]]),j={getLayer:(i,o,c)=>{var f;let e,s,b=i.layer_type,n=i.figure_type;if(b==="WMS"){let l=[];const L=i.single_tiles?i.tiles_url:i.tiles_list[o].tile_url;switch(n){case"Point":if(L){const h=new URL(L),w=h.origin,N=h.pathname,_=h.searchParams,r={};for(const[a,d]of _.entries())r[a]=d;l[0]=w+N,l[1]=r}s=new P({maxzoom:18,minzoom:3,url:l[0],params:l[1],serverType:"mapserver",crossOrigin:"anonymous"});break;case"Surface":if(L){const h=new URL(L),w=h.origin,N=h.pathname,_=h.searchParams,r={};for(const[a,d]of _.entries())r[a]=d;l[0]=w+N,l[1]=r}s=new P({maxzoom:18,minzoom:3,url:l[0],params:l[1],serverType:"mapserver"});break;case"Line":if(L){const h=new URL(L),w=h.origin,N=h.pathname,_=h.searchParams,r={};for(const[a,d]of _.entries())r[a]=d;l[0]=w+N,l[1]=r}s=new P({maxzoom:18,minzoom:3,url:l[0],params:l[1],serverType:"mapserver"});break;default:console.log("otherWMSLayer",n)}let p=i.single_tiles?"":`- ${(f=i.tiles_list[o])==null?void 0:f.title}`;e=new ne({id:c,label:`${i.title} ${p}`,source:new P({name:i.title,url:s.getUrls()[0],params:s.getParams(),serverType:"geoserver",crossOrigin:"anonymous"})})}if(b==="GeoJson")switch(console.log("GeoJsonLayer",n),n){case"Line":e=new de({source:new ce({url:"http://gis.edtest.site:8010/ogc/temp",params:{SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetMap",FORMAT:"image/png",STYLE:"default",SLD_VERSION:"1.1.0"}})});break;case"Point":const l=new P({maxzoom:18,minzoom:3,url:"https://dwgis1.ncdr.nat.gov.tw/server/services/MAP0627/Map2022FloodingPoint1721/MapServer/WMSServer",params:{SERVICE:"WMS",BGCOLOR:"0xFFFFFF",TRANSPARENT:"TRUE",SRS:"EPSG:3826",LAYERS:"0",VERSION:"1.1.1",FORMAT:"image/png"},crossOrigin:"anonymous"});e=new ne({source:l});break;default:console.log(n)}return e},getLayerIndex:i=>{let o,c,e;return i.split("_").forEach((s,b)=>{switch(b){case 0:o=Number(s.split("node")[1]);break;case 1:c=Number(s.split("subNode")[1]);break;case 2:e=s.split("nestedSubNode")[1]!=="undefined"?Number(s.split("nestedSubNode")[1]):"undefined";break}}),{nodeIndex:o,subNodeIndex:c,nestedSubNodeIndex:e,layeredIndex:i}}};const vt={props:{onClose:{type:Function,default:()=>{}},mapLayers:{type:Array,default:[]},currentLayers:{type:Array,default:[]},showSelectLayerValue:{type:Function,default:()=>{}}},setup(i,{emit:o}){const c=j,e=ye(),s=W({DropDown:null,TilesListValue:0});function b(p,h){o("onMapControl",{action:p,value:h})}function n(p,h){o("onLayerControl",{action:p,value:h})}function f(p){s.DropDown!==p?s.DropDown=p:s.DropDown=null}function l(p,h){let w=p.target.checked||typeof p.target.checked>"u";n("layerMode",{checked:w,nodeIndex:h.nodeIndex,subNodeIndex:h.subNodeIndex,nestedSubNodeIndex:String(h.nestedSubNodeIndex)?h.nestedSubNodeIndex:void 0,nestedSubNode:!!String(h.nestedSubNodeIndex),id:h.id})}function L(p){let h=p.target.checked||typeof p.target.checked>"u";n("layerMode",{checked:h})}return _e(()=>s.TilesListValue,(p,h)=>{i.showSelectLayerValue(p)}),{props:i,state:s,router:e,mapLayers:c,onMapControl:b,onLayerControl:n,openLayerList:f,LayerCheckBoxChange:l,checkTribe:L}}},oe=i=>(ee("data-v-1209eb0e"),i=i(),te(),i),wt={class:"rounded-4 bg-white"},xt={class:"row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold border-bottom"},kt=oe(()=>t("p",{class:"mb-0 fs-5"},"圖層選項",-1)),Mt=oe(()=>t("svg",{width:"32",height:"32",viewBox:"0 0 24 24"},[t("path",{fill:"currentColor",d:"M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10zm0-11.414L9.172 7.757L7.757 9.172L10.586 12l-2.829 2.828l1.415 1.415L12 13.414l2.828 2.829l1.415-1.415L13.414 12l2.829-2.828l-1.415-1.415L12 10.586z"})],-1)),St=[Mt],It={class:"py-3 px-4 content"},Dt={class:"mb-2 landBoundary"},Nt={class:"mb-2"},Tt=["onClick"],$t=oe(()=>t("path",{fill:"currentColor",d:"M8 5v14l11-7z"},null,-1)),Vt=[$t],Ot={class:"ms-3 mb-1"},Bt={key:0},Ft=["checked","onChange"],zt={key:1},Et=["checked","onChange"],At=["onChange"],Wt=["value"];function Ht(i,o,c,e,s,b){return m(),y("div",wt,[t("div",xt,[kt,t("a",{href:"",class:"closeBtn position-absolute col-auto",onClick:o[0]||(o[0]=v((...n)=>e.props.onClose&&e.props.onClose(...n),["prevent"]))},St)]),t("div",It,[t("div",Dt,[t("div",{onClick:o[1]||(o[1]=n=>e.router.push({path:"/Map_Demo/detail"})),class:"my-3 fw-bold h5 text-primary cursor-pointer"},"前往地圖細節"),(m(!0),y(E,null,A(e.props.mapLayers,(n,f)=>(m(),y("div",Nt,[t("div",{class:"title d-flex align-items-center fw-bold text-black order-1 mb-1 text-decoration-none",onClick:l=>e.openLayerList(f)},[t("div",{class:$(n.groupClass)},null,2),t("div",null,I(n.label),1),(m(),y("svg",{viewBox:"0 0 24 24",class:$({openTitle:e.state.DropDown==f})},Vt,2))],8,Tt),e.state.DropDown==f?(m(!0),y(E,{key:0},A(n.layers,(l,L)=>(m(),y("div",Ot,[l.single_tiles?(m(),y("div",Bt,[t("input",{type:"checkbox",checked:e.props.currentLayers.some(p=>p.id===l.id),onChange:p=>{e.LayerCheckBoxChange(p,{nodeIndex:f,subNode:l,subNodeIndex:L,nestedSubNodeIndex:"",id:l.id})}},null,40,Ft),Y(" "+I(l.title),1)])):(m(),y("div",zt,[t("input",{type:"checkbox",checked:e.props.currentLayers.some(p=>p.id===l.id),onChange:p=>{e.LayerCheckBoxChange(p,{nodeIndex:f,subNode:l,subNodeIndex:L,nestedSubNodeIndex:"",id:l.id})}},null,40,Et),Y(" "+I(l.title)+" ",1),ie(t("select",{name:"",id:"",class:"ms-3","onUpdate:modelValue":o[2]||(o[2]=p=>e.state.TilesListValue=p),onChange:p=>{e.LayerCheckBoxChange(p,{nodeIndex:f,subNode:l,subNodeIndex:L,nestedSubNodeIndex:e.state.TilesListValue,id:l.id})}},[(m(!0),y(E,null,A(l.tiles_list,(p,h)=>(m(),y("option",{value:h},I(p.title),9,Wt))),256))],40,At),[[le,e.state.TilesListValue]])]))]))),256)):D("",!0)]))),256))])])])}const Rt=F(vt,[["render",Ht],["__scopeId","data-v-1209eb0e"]]),Pt="/Map_Demo/assets/zoomIn-c80b5dd3.svg",Zt="/Map_Demo/assets/zoomOut-88993246.svg",jt="/Map_Demo/assets/compass-1c1efd7a.svg",Yt="/Map_Demo/assets/location-b52d62b2.svg",Gt="/Map_Demo/assets/zoom-8acdf5b3.svg",Ut={props:{id:{Type:String,default:0},map:{}},setup(i,{emit:o}){function c(e){o("onMapControl",{action:e})}return{onMapControl:c}}},Jt={class:"d-flex flex-nowrap flex-column"},qt=t("img",{src:Pt,alt:"zoomIn"},null,-1),Qt=[qt],Xt=t("img",{src:Zt,alt:"zoomOut"},null,-1),Kt=[Xt],eo=t("img",{src:jt,alt:"compass"},null,-1),to=[eo],oo=t("img",{src:Yt,alt:"location"},null,-1),so=[oo],no=t("img",{src:Gt,alt:"zoom"},null,-1),ao=[no];function ro(i,o,c,e,s,b){return m(),y("div",Jt,[t("a",{href:"",class:"asideTool-btn order-1 mb-0",onClick:o[0]||(o[0]=v(n=>e.onMapControl("In"),["prevent"]))},Qt),t("a",{href:"",class:"asideTool-btn order-1 mb-2",onClick:o[1]||(o[1]=v(n=>e.onMapControl("Out"),["prevent"]))},Kt),t("a",{href:"",class:"asideTool-btn order-1 mb-2",onClick:o[2]||(o[2]=v(n=>e.onMapControl("toNorth"),["prevent"]))},to),t("a",{href:"",class:"asideTool-btn order-1 mb-2",onClick:o[3]||(o[3]=v(n=>e.onMapControl("moveTo"),["prevent"]))},so),t("a",{href:"",class:"asideTool-btn order-1 mb-2",onClick:o[4]||(o[4]=v(n=>e.onMapControl("fullScreen"),["prevent"]))},ao)])}const io=F(Ut,[["render",ro]]);const lo={props:{baseMapsOptions:{type:Array,default:[]},onChangeBaseMaps:{type:Function,default:()=>{}}},setup(i,{emit:o}){const c=W({selectMap:i.baseMapsOptions[0]});function e(s){let b="baseMap",n={checked:!0,layerName:c.selectMap};o("onChangeBaseMaps",{action:b,value:n})}return{state:c,props:i,onChangeBaseMaps:e}}},co=["value"];function po(i,o,c,e,s,b){return m(),y("div",null,[ie(t("select",{name:"",id:"","onUpdate:modelValue":o[0]||(o[0]=n=>e.state.selectMap=n),onChange:o[1]||(o[1]=n=>{e.onChangeBaseMaps()})},[(m(!0),y(E,null,A(e.props.baseMapsOptions,(n,f)=>(m(),y("option",{value:n.name},I(n.label),9,co))),256))],544),[[le,e.state.selectMap]])])}const uo=F(lo,[["render",po],["__scopeId","data-v-485263dd"]]),mo="/Map_Demo/assets/twoDimensional-a98be995.svg",_o="/Map_Demo/assets/threeDimensional-53ca5816.svg",yo="/Map_Demo/assets/baseLayer-bfe09163.svg",pe="/Map_Demo/assets/singleWindow-a5fb901a.svg",ue="/Map_Demo/assets/doubleWindows-dfb5c9e8.svg";const fo={props:{currentLayers:{type:Array,default:[]},mapCount:{type:Number,default:1},dimensionMapStatus:{type:Boolean,default:!1}},setup(i,{emit:o}){const c=W({toolSwitch:{threeDimensionalBtn:!1,layerConditionBtn:!1,splitWindowBtn:!1},targetNum:1});function e(f,l){Object.keys(c.toolSwitch).forEach(L=>{L===f?c.toolSwitch[f]?c.toolSwitch[f]=!1:c.toolSwitch[f]=!0:c.toolSwitch[L]=!1})}function s(f,l){f==="changeMapCount"&&(c.toolSwitch.splitWindowBtn=!1),o("onLayerControl",{action:f,value:l})}function b(){o("conditionWrap")}function n(f){c.targetNum=f,o("onChangeTarget",f)}return{props:i,state:c,toolSwitch:e,onLayerControl:s,conditionWrap:b,onChangeTarget:n}}},ho={class:"list-unstyled d-flex align-items-center flex-nowrap w-full"},go={class:"me-4 position-relative"},Co={class:"MapFeatureBtn text-white"},bo=t("img",{src:mo},null,-1),Lo=[bo],vo=t("img",{src:_o},null,-1),wo=[vo],xo={class:"me-4 position-relative"},ko=t("img",{src:yo,alt:""},null,-1),Mo=[ko],So={class:"me-4 position-relative"},Io={key:0,src:pe,alt:""},Do={key:1,src:ue,alt:""},No={key:0,class:"list-unstyled position-absolute start-0 top-100 p-0"},To={class:"mt-2"},$o=t("img",{src:pe,alt:""},null,-1),Vo=[$o],Oo={class:"mt-2"},Bo=t("img",{src:ue,alt:""},null,-1),Fo=[Bo],zo={class:"switchControl d-flex position-fixed rounded-pill translate-middle-x p-2",id:"switchControl",style:{"z-index":"99"}};function Eo(i,o,c,e,s,b){return m(),y("div",null,[t("ul",ho,[t("li",go,[t("div",Co,[e.props.dimensionMapStatus?(m(),y("a",{key:0,href:"",onClick:o[0]||(o[0]=v(n=>(e.toolSwitch("threeDimensionalBtn"),e.onLayerControl("changeDimensionMap","3D")),["prevent"]))},Lo)):(m(),y("a",{key:1,href:"",onClick:o[1]||(o[1]=v(n=>(e.toolSwitch("threeDimensionalBtn"),e.onLayerControl("changeDimensionMap","2D")),["prevent"]))},wo))])]),t("li",xo,[t("a",{href:"",class:"MapFeatureBtn text-white",onClick:o[2]||(o[2]=v(n=>(e.toolSwitch("layerConditionBtn"),e.conditionWrap()),["prevent"]))},Mo)]),t("li",So,[t("a",{href:"",class:"MapFeatureBtn text-white",onClick:o[3]||(o[3]=v(n=>e.toolSwitch("splitWindowBtn"),["prevent"]))},[e.props.mapCount===1?(m(),y("img",Io)):D("",!0),e.props.mapCount===2?(m(),y("img",Do)):D("",!0)]),e.state.toolSwitch.splitWindowBtn?(m(),y("ul",No,[t("li",To,[t("a",{href:"",class:"text-white MapFeatureBtn",onClick:o[4]||(o[4]=v(n=>e.onLayerControl("changeMapCount",1),["prevent"]))},Vo)]),t("li",Oo,[t("a",{href:"",class:"text-white MapFeatureBtn",onClick:o[5]||(o[5]=v(n=>e.onLayerControl("changeMapCount",2),["prevent"]))},Fo)])])):D("",!0)])]),t("div",zo,[t("div",{class:$(["fs-3 text-white rounded-pill",{active:e.state.targetNum===1}]),onClick:o[6]||(o[6]=()=>{e.onChangeTarget(1)})},"左",2),t("div",{class:$(["fs-3 text-white rounded-pill",{active:e.state.targetNum===2}]),onClick:o[7]||(o[7]=()=>{e.onChangeTarget(2)})},"右",2)])])}const Ao=F(fo,[["render",Eo]]),Wo="/Map_Demo/assets/logo-1303f4e5.svg";const Ho={props:{},setup(i,{emit:o}){const c=j,e=Z,s=W({defaultCenter:[121.326776,24.655499],defaultCenterZoom:14,targetNum:1,conditionWrap:!1,layerSelect:!1,currentLayers:[],layers:[],mapLayers:Q(()=>s.layers.map((r,a)=>({label:r.group_title,value:r.value,layers:r.group_layers,groupClass:r.group_class}))),baseMapsOptions:Q(()=>Z.sourceData()),selectLock:!1,mapCount:1,map1:null,map2:null,map1LayerStatus:[],map2LayerStatus:[],deleteLightbox:!1,dimensionMap:{map1:"2D",map2:"2D"},toSearchDimensionStatus:Q(()=>{let r=s.targetNum==1?"map1":"map2";return s.dimensionMap[r]==="2D"}),tribeId:"",ol3d:null,selectValueTemp:0}),b=new be({projection:"EPSG:4326",center:s.defaultCenter,zoom:s.defaultCenterZoom});let n=null;function f(){s.map1=new K({target:"map1",layers:[Z.sourceFun("default")],view:b,controls:[]})}function l(r,a){const d=new de({source:new ce({features:[new Le({geometry:new ve([r,a]),name:"Null Island",population:4e3,rainfall:500})]}),style:new we({image:new xe({anchor:[.5,100],anchorXUnits:"fraction",anchorYUnits:"pixels",src:"https://www.ockert-cnc.de/wp-content/uploads/2016/12/map-marker-icon-100x100.png"})})});let u=s.targetNum==1?"map1":"map2";s[u].addLayer(d)}function L({action:r,value:a}){var S;let d=((S=s.map1)==null?void 0:S.getTarget())==null?"map2":"map1",u=s[d].getView();switch(r){case"In":u.animate({zoom:u.getZoom()+1});break;case"Out":u.animate({zoom:u.getZoom()-1});break;case"toNorth":u.animate({rotation:0});break;case"moveTo":if(a){const{xAxis:k,yAxis:O}=a;u.animate({center:[k,O],zoom:10,duration:100})}else navigator.geolocation.getCurrentPosition(function(k){u.animate({center:[k.coords.longitude,k.coords.latitude],zoom:17,duration:100}),l(k.coords.longitude,k.coords.latitude)});break;case"fullScreen":let C=document.getElementById(`map${s.targetNum}`);C.requestFullscreen?C.requestFullscreen():C.msRequestFullscreen?C.msRequestFullscreen():C.mozRequestFullScreen?C.mozRequestFullScreen():C.webkitRequestFullscreen&&C.webkitRequestFullscreen();break}}function p({action:r,value:a}){var S;console.log({action:r,value:a});let d=s.targetNum==1?s.map1:s.map2,u=d==null?void 0:d.getLayers();switch(r){case"layerMode":if(a.checked){s.layers[a.nodeIndex].group_layers[a.subNodeIndex].single_tiles||(u.getArray().forEach(H=>{H.get("id")&&H.get("id").includes(`node${a.nodeIndex}_subNode${a.subNodeIndex}_nestedSubNode`)&&d.removeLayer(H)}),_("delete",d.getTarget(),a.id));let g=a.nestedSubNodeIndex||s.selectValueTemp,M=c.getLayer(s.layers[a.nodeIndex].group_layers[a.subNodeIndex],g,a.id);d.addLayer(M),a.id==="node0_subNode3_nestedSubNodeundefined"&&d.on("click",x=>{const H=M.getData(x.pixel);console.log(H)}),_("add",d.getTarget(),a.id)}else{let g=u.getArray(),M;switch(a.id){case"node0_subNode0_nestedSubNodeundefined":M=g.filter(x=>x.get("id")==="node0_subNode0_nestedSubNodeundefined"),M.forEach(x=>{d.removeLayer(x)});break;case"node3_subNode1_nestedSubNodeundefined":M=g.filter(x=>x.get("id")==="node3_subNode1_nestedSubNodeundefined"),M.forEach(x=>{d.removeLayer(x)});break;default:g.forEach(x=>{x.get("id")==a.id&&d.removeLayer(x)});break}_("delete",d.getTarget(),a.id)}break;case"selectLayerMode":if(s.selectLock)return;a.layerName==="all"?u.getArray().filter(x=>x.get("name")!=="default").forEach(x=>{d.removeLayer(x)}):u.getArray().forEach(M=>{M.get("id")==a.id&&d.removeLayer(M)});break;case"changeOrder":if(s.selectLock)return;let C=j.getLayerIndex(a.id),k=c.getLayer(s.layers[C.nodeIndex].group_layers[C.subNodeIndex],C.nestedSubNodeIndex,a.id);if(a.movement==="up"){if(a.key+1==u.getArray().length)return;a.checked=!1,p({action:"layerMode",value:a}),u.insertAt(a.key+1,k)}if(a.movement==="down"){if(a.key-1==0)return;a.checked=!1,p({action:"layerMode",value:a}),u.insertAt(a.key-1,k)}break;case"changeLayerVisible":if(s.selectLock)return;let O=!u.getArray()[a.key].getVisible();u.getArray()[a.key].setVisible(O);break;case"baseMap":let z=e.sourceFun(a.layerName);u.extend([z]),u.getArray().forEach(g=>{g.get("name")!==a.layerName&&d.removeLayer(g)});break;case"changeMapCount":if(s.mapCount===a)return;let T=s.targetNum!==1?"map1":"map2";s.mapCount=a;let B=s[`${T}LayerStatus`].filter(g=>g!=="3D").map(g=>j.getLayerIndex(g));if(a===2&&(s[T]=new K({target:T,layers:[Z.sourceFun("default"),...B.map(g=>c.getLayer(s.layers[g.nodeIndex].group_layers[g.subNodeIndex],g.nestedSubNodeIndex,g.id))],view:b,controls:[]}),((S=s[`${T}LayerStatus`])==null?void 0:S.indexOf("3D"))!==-1)){n=new X({map:s[T]}),n.setEnabled(!0);let g="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0NzM3MWFhYS0xMjNlLTQ3MTMtODFjZS0xZjMzM2I5NGZiYTEiLCJpZCI6MTMwODE4LCJpYXQiOjE2ODQwNzM3Mjl9.UYu4kBialPo19dcvosHzZTpg2BD1zkFQnjCD78YiiYo";Cesium.Ion.defaultAccessToken=g;let M=n.getCesiumScene({});M.terrainProvider=Cesium.createWorldTerrain({})}if(a===1){s[T]=null;const g=document.getElementById(T);for(;g.firstChild;)g.removeChild(g.firstChild)}break;case"changeDimensionMap":let U=s.targetNum==1?"map1":"map2";if(s.dimensionMap[U]=a,a==="3D"){n=new X({map:d}),n.setEnabled(!0);let g="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0NzM3MWFhYS0xMjNlLTQ3MTMtODFjZS0xZjMzM2I5NGZiYTEiLCJpZCI6MTMwODE4LCJpYXQiOjE2ODQwNzM3Mjl9.UYu4kBialPo19dcvosHzZTpg2BD1zkFQnjCD78YiiYo";Cesium.Ion.defaultAccessToken=g;let M=n.getCesiumScene({});M.terrainProvider=Cesium.createWorldTerrain({}),s[`${U}LayerStatus`].push("3D")}else n.setEnabled(!1),s[`${U}LayerStatus`]=s[`${U}LayerStatus`].filter(g=>g!=="3D");break}w()}function h(r){var d;s.targetNum=r;let a=s.targetNum!==1?"map1":"map2";if(s.mapCount===1){if(!s[`map${r}`]){let S=s[`map${r}LayerStatus`].filter(C=>C!=="3D").map(C=>j.getLayerIndex(C));s[`map${r}`]=new K({target:`map${r}`,layers:[Z.sourceFun("default"),...S.map(C=>c.getLayer(s.layers[C.nodeIndex].group_layers[C.subNodeIndex],C.nestedSubNodeIndex,C.layeredIndex))],view:b,controls:[]}),((d=s[`map${r}LayerStatus`])==null?void 0:d.indexOf("3D"))!==-1&&(n=new X({map:s[`map${r}`]}),n.setEnabled(!0))}if(s[a]){s[a]=null;const u=document.getElementById(a);for(;u.firstChild;)u.removeChild(u.firstChild)}}se(()=>{w()})}function w(){var d;let r=s.targetNum==1?s.map1:s.map2;const a=(d=r==null?void 0:r.getLayers())==null?void 0:d.getArray();s.currentLayers=a==null?void 0:a.map(u=>({label:u.get("label"),id:u.get("id"),visible:u.getVisible()}))}function N(){s.conditionWrap=!s.conditionWrap}function _(r,a,d){if(r==="add")s[`${a}LayerStatus`].push(d);else if(r==="delete"){let u=s[`${a}LayerStatus`].findIndex(S=>S===d);s[`${a}LayerStatus`].splice(u,1)}else console.log("error")}return ae(async()=>{await re.ajax({url:"https://api.edtest.site/layers",method:"GET"}).done(r=>{s.layers=r.map((a,d)=>(a.group_layers.forEach((u,S)=>{let C,k;C=S,u.id=`node${d}_subNode${C}_nestedSubNode${k}`,u.single_tiles||u.tiles_list.forEach((O,z)=>{k=z,O.id=`node${d}_subNode${C}_nestedSubNode${k}`})}),{...a,value:d})),se(()=>{f(),w()})}).fail(r=>{console.log("Fail",r)})}),{state:s,props:i,mapControl:L,layerControl:p,getCurrentLayerNames:w,changeTarget:h,conditionWrap:N}}},Ro={class:"SearchBar position-absolute"},Po=t("img",{src:Wo,alt:"",class:"mb-2"},null,-1),Zo={class:"w-100 d-flex flex-nowrap mapWrap",id:"mapWrap"},jo={key:0,class:"middleLine"},Yo={class:"condition position-absolute"},Go={class:"mb-2"},Uo={key:1,class:"mb-4"},Jo={key:1},qo={key:0,class:"lightWrap w-100 h-100 d-flex justify-content-center align-items-center"},Qo={class:"p-4 rounded bg-white",style:{width:"250px"}},Xo=t("p",{class:"text-center fw-bold"},"是否要刪除全部圖層",-1),Ko={class:"d-flex justify-content-around"};function es(i,o,c,e,s,b){var w,N;const n=Ao,f=uo,l=io,L=Rt,p=Lt,h=Ge;return m(),y("div",null,[t("div",Ro,[Po,R(n,{dimensionMapStatus:e.state.toSearchDimensionStatus,currentLayers:e.state.currentLayers,mapCount:e.state.mapCount,onOnLayerControl:o[0]||(o[0]=({action:_,value:r})=>{e.layerControl({action:_,value:r})}),onOnChangeTarget:o[1]||(o[1]=_=>{e.changeTarget(_)}),onConditionWrap:o[2]||(o[2]=_=>{e.conditionWrap(_)})},null,8,["dimensionMapStatus","currentLayers","mapCount"])]),R(f,{class:"mapSourceOption",baseMapsOptions:e.state.baseMapsOptions,onOnChangeBaseMaps:o[3]||(o[3]=({action:_,value:r})=>{e.layerControl({action:_,value:r})})},null,8,["baseMapsOptions"]),R(l,{class:"asideTool position-absolute top-50 translate-middle-y",id:"asideTool",onOnMapControl:o[4]||(o[4]=({action:_,value:r})=>{e.mapControl({action:_,value:r})})}),t("div",Zo,[t("div",{id:"map1",class:$({"w-100":((w=e.state.map1)==null?void 0:w.getTarget())=="map1"})},null,2),e.state.mapCount===2?(m(),y("div",jo)):D("",!0),t("div",{id:"map2",class:$({"w-100":((N=e.state.map2)==null?void 0:N.getTarget())=="map2"})},null,2)]),t("div",Yo,[t("div",Go,[e.state.conditionWrap?D("",!0):(m(),y("button",{key:0,class:"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5",onClick:o[5]||(o[5]=_=>e.state.conditionWrap=!0)}," 圖層選項 ")),e.state.conditionWrap?(m(),y("div",Uo,[R(L,fe({mapLayers:e.state.mapLayers,currentLayers:e.state.currentLayers,onClose:()=>{e.state.conditionWrap=!1},showSelectLayerValue:_=>{e.state.selectValueTemp=_}},{onOnMapControl:o[6]||(o[6]=({action:_,value:r})=>{e.mapControl({action:_,value:r})}),onOnLayerControl:o[7]||(o[7]=({action:_,value:r})=>{e.layerControl({action:_,value:r})})}),null,16)])):D("",!0)]),t("div",null,[e.state.layerSelect?D("",!0):(m(),y("button",{key:0,class:"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5",onClick:o[8]||(o[8]=_=>e.state.layerSelect=!0)}," 已選擇的圖層 ")),e.state.layerSelect?(m(),y("div",Jo,[R(p,he(ge({selectLock:e.state.selectLock,currentLayers:e.state.currentLayers,onClose:()=>{e.state.layerSelect=!1},onChangLayerVisible:_=>{e.layerControl(_)},onChangeOrderLayer:({action:_,value:r})=>{e.layerControl({action:_,value:r})},onLockLayer:()=>{e.state.selectLock=!e.state.selectLock},onDeleteLayer:({action:_,value:r})=>{r.layerName=="all"?e.state.deleteLightbox=!0:e.layerControl({action:_,value:r})},onDeleteLayerAll:()=>{e.state.deleteLightbox=!0}})),null,16)])):D("",!0)])]),e.state.deleteLightbox?(m(),y("div",qo,[t("div",Qo,[Xo,t("div",Ko,[t("button",{class:"rounded px-3 py-1 bg-steel text-white border-0",onClick:o[9]||(o[9]=()=>{e.layerControl({action:"selectLayerMode",value:{layerName:"all"}}),e.state.deleteLightbox=!1})},"確定"),t("button",{class:"rounded px-3 py-1 bg-secondary bg-gradient text-white border-0",onClick:o[10]||(o[10]=()=>{e.state.deleteLightbox=!1})},"取消")])])])):D("",!0),e.state.tribeId?(m(),Ce(h,{key:1,class:"areaData",closeMapData:()=>{e.state.tribeId=""},tribeId:e.state.tribeId,maxHeight:500},null,8,["closeMapData","tribeId"])):D("",!0)])}const ss=F(Ho,[["render",es]]);export{ss as default};
//# sourceMappingURL=WebMap-daa635ca.js.map
