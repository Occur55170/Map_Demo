import{_ as Ot,r as $t,o as O,c as A,b as _,n as vt,w as $,f as K,g as bi,h as br,p as Ae,e as Fe,i as an,j as It,t as W,k as Te,F as Nt,l as kt,u as on,$ as te,m as hn,v as ln,q as ds,s as fs,x as Ei,y as wr,z as Sr,A as gs}from"./index-efe0cbe0.js";import{b as Tr,l as cn,o as Ie,e as bt,c as Ne,m as Er,a as Lr,f as Pr,i as un,d as Rr,g as Or,h as dn,D as Ar,s as si,j as Hi,k as fn,C as Fr,r as Ir,n as Nr,u as gn,p as mn,M as kr,q as Dr,t as Gr,v as yn,T as _n,w as Z,x as pn,y as jr,z as B,A as ke,E as ce,B as vn,F as Gt,G as Vr,H as Br,I as De,P as Wt,J as Ki,K as Q,L as $r,N as qt,O as zr,Q as Ur,R as Fi,S as Cn,U as oi,V as ms,W as qr,X as Mn,Y as xn,Z as Wr,_ as Hr,$ as Kr,a0 as Xr,a1 as Yr,a2 as Zr,a3 as Qr,a4 as Jr,a5 as ta,a6 as bn,a7 as ea,a8 as wn,a9 as ia,aa as sa,ab as at,ac as na,ad as ra,ae as aa,af as oa,ag as ha,ah as la,ai as ca,aj as ua,ak as da,al as Sn,am as fa,an as ga,ao as ma,ap as ya,aq as ys,ar as _a,as as Tn,at as pa,au as va,av as hi,aw as Ca,ax as Ma,ay as Ii,az as xa,aA as ba,aB as wa,aC as Sa,aD as Ta,aE as En,aF as Ea,aG as La,aH as Yt,aI as Pa,aJ as Ln,aK as Ra,aL as Oa,aM as Aa,aN as Fa,aO as _s,aP as Ia,aQ as qe,aR as oe,aS as ue,aT as Na,aU as Pn,aV as ka,aW as Da,aX as ps,aY as Ga,aZ as vs,a_ as ja,a$ as We,b0 as Va,b1 as Ba,b2 as $a,b3 as za,b4 as Ua,b5 as qa,b6 as Cs,b7 as Rn,b8 as Wa,b9 as Ms,ba as Ha,bb as xs,bc as Ka,bd as Xa,be as Ya,bf as Dt,bg as Ni,bh as ki,bi as Za,bj as Qa,bk as Ja}from"./Tile-cf32733c.js";import{l as to,C as eo,V as Ht,F as Ee,a as io,b as bs,g as so,c as ws,H as Li,d as no,h as ro,r as Ss,B as ao,e as de,f as oo,i as ho,S as On,j as lo,I as Di}from"./Vector-50673844.js";import{I as co,d as An,D as He,a as Ts,c as uo,b as Xi,e as Fn}from"./Image-8144c9a7.js";const In="/Map_Demo/assets/logo-83a41ce3.svg",fo="/Map_Demo/assets/2D-m-0cdbc246.svg",go="/Map_Demo/assets/3D-m-4ecf18c0.svg",mo="/Map_Demo/assets/vector-m-1fc5cf13.svg",yo="/Map_Demo/assets/selectVector-m-e4f4d97a.svg",_o="/Map_Demo/assets/singleWindow-m-4635df1a.svg",po="/Map_Demo/assets/doubleWindow-m-cccef2df.svg";const vo={props:{currentLayers:{type:Array,default:[]},mapCount:{type:Number,default:1},dimensionMapStatus:{type:Boolean,default:!1},openConditionWrap:{type:Function,default:()=>{}},openLayerSelect:{type:Function,default:()=>{}},onLayerControl:{type:Function,default:()=>{}},onChangeTarget:{type:Function,default:()=>{}}},setup(e,{emit:t}){const i=$t({toolSwitch:{threeDimensionalBtn:!1,layerConditionBtn:!1,splitWindowBtn:!1},targetNum:1});function s(a,o){Object.keys(i.toolSwitch).forEach(h=>{h===a?i.toolSwitch[a]?i.toolSwitch[a]=!1:i.toolSwitch[a]=!0:i.toolSwitch[h]=!1})}function n(a,o){a==="changeMapCount"&&(i.toolSwitch.splitWindowBtn=!1),e.onLayerControl({action:a,value:o})}function r(){t("conditionWrap")}return{props:e,state:i,toolSwitch:s,onLayerControl:n,conditionWrap:r}}},Co={class:"w-100"},Mo={class:"position-fixed top-0 w-100 d-flex justify-content-end flex-wrap"},xo=_("img",{src:In,class:"w-100"},null,-1),bo={class:"switchControl me-2 d-block rounded-4 p-2",id:"switchControl",style:{"z-index":"99"}},wo={class:"list-unstyled d-flex align-items-center justify-content-around py-2 flex-nowrap w-100 bg-white mb-0"},So=_("img",{src:fo},null,-1),To=[So],Eo=_("img",{src:go},null,-1),Lo=[Eo],Po=_("img",{src:mo},null,-1),Ro=[Po],Oo=_("img",{src:yo},null,-1),Ao=[Oo],Fo={class:"text-white"},Io=_("img",{src:_o},null,-1),No=[Io],ko=_("img",{src:po},null,-1),Do=[ko];function Go(e,t,i,s,n,r){return O(),A("div",Co,[_("div",Mo,[xo,_("div",bo,[_("div",{class:vt(["text-white rounded-pill",{active:s.state.targetNum===1}]),onClick:t[0]||(t[0]=()=>{s.state.targetNum=1,s.props.onChangeTarget(1)})},"上",2),_("div",{class:vt(["text-white rounded-pill",{active:s.state.targetNum===2}]),onClick:t[1]||(t[1]=()=>{s.state.targetNum=2,s.props.onChangeTarget(2)})},"下",2)])]),_("ul",wo,[_("li",null,[_("div",null,[s.props.dimensionMapStatus?(O(),A("div",{key:0,class:"navbarBtn",onClick:t[2]||(t[2]=$(a=>(s.toolSwitch("threeDimensionalBtn"),s.onLayerControl("changeDimensionMap","3D")),["prevent"]))},To)):(O(),A("div",{key:1,class:"navbarBtn",onClick:t[3]||(t[3]=$(a=>(s.toolSwitch("threeDimensionalBtn"),s.onLayerControl("changeDimensionMap","2D")),["prevent"]))},Lo))])]),_("li",null,[_("div",{class:"navbarBtn",onClick:t[4]||(t[4]=a=>s.props.openConditionWrap())},Ro)]),_("li",null,[_("div",{class:"navbarBtn",onClick:t[5]||(t[5]=a=>s.props.openLayerSelect())},Ao)]),_("li",null,[_("div",Fo,[s.props.mapCount===1?(O(),A("div",{key:0,class:"navbarBtn",onClick:t[6]||(t[6]=$(a=>s.props.onLayerControl({action:"changeMapCount",value:{qty:2}}),["prevent"]))},No)):K("",!0),s.props.mapCount===2?(O(),A("div",{key:1,class:"navbarBtn",onClick:t[7]||(t[7]=$(a=>s.props.onLayerControl({action:"changeMapCount",value:{qty:1}}),["prevent"]))},Do)):K("",!0)])])])])}const jo=Ot(vo,[["render",Go]]);function li(e,t,i,s,n,r,a){let o,h;const l=(i-t)/s;if(l===1)o=t;else if(l===2)o=t,h=n;else if(l!==0){let c=e[t],u=e[t+1],d=0;const f=[0];for(let m=t+s;m<i;m+=s){const p=e[m],x=e[m+1];d+=Math.sqrt((p-c)*(p-c)+(x-u)*(x-u)),f.push(d),c=p,u=x}const g=n*d,y=Tr(f,g);y<0?(h=(g-f[-y-2])/(f[-y-1]-f[-y-2]),o=t+(-y-2)*s):o=t+y*s}a=a>1?a:2,r=r||new Array(a);for(let c=0;c<a;++c)r[c]=o===void 0?NaN:h===void 0?e[o+c]:cn(e[o+c],e[o+s+c],h);return r}function Gi(e,t,i,s,n,r){if(i==t)return null;let a;if(n<e[t+s-1])return r?(a=e.slice(t,t+s),a[s-1]=n,a):null;if(e[i-1]<n)return r?(a=e.slice(i-s,i),a[s-1]=n,a):null;if(n==e[t+s-1])return e.slice(t,t+s);let o=t/s,h=i/s;for(;o<h;){const d=o+h>>1;n<e[(d+1)*s-1]?h=d:o=d+1}const l=e[o*s-1];if(n==l)return e.slice((o-1)*s,(o-1)*s+s);const c=e[(o+1)*s-1],u=(n-l)/(c-l);a=[];for(let d=0;d<s-1;++d)a.push(cn(e[(o-1)*s+d],e[o*s+d],u));return a.push(n),a}function Vo(e,t,i,s,n,r,a){if(a)return Gi(e,t,i[i.length-1],s,n,r);let o;if(n<e[s-1])return r?(o=e.slice(0,s),o[s-1]=n,o):null;if(e[e.length-1]<n)return r?(o=e.slice(e.length-s),o[s-1]=n,o):null;for(let h=0,l=i.length;h<l;++h){const c=i[h];if(t!=c){if(n<e[t+s-1])return null;if(n<=e[c-1])return Gi(e,t,c,s,n,!1);t=c}}return null}class ci extends Ie{constructor(t,i){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,i!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(i,t):this.setCoordinates(t,i)}appendCoordinate(t){this.flatCoordinates?bt(this.flatCoordinates,t):this.flatCoordinates=t.slice(),this.changed()}clone(){const t=new ci(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,i,s,n){return n<Ne(this.getExtent(),t,i)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Er(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Lr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,i,s,n))}forEachSegment(t){return Pr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,i){return this.layout!="XYM"&&this.layout!="XYZM"?null:(i=i!==void 0?i:!1,Gi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i))}getCoordinates(){return un(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,i){return li(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i,this.stride)}getLength(){return to(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const i=[];return i.length=Rr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i,0),new ci(i,"XY")}getType(){return"LineString"}intersectsExtent(t){return Or(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}setCoordinates(t,i){this.setLayout(i,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=dn(this.flatCoordinates,0,t,this.stride),this.changed()}}const ui=ci;function Bo(e,t){const i=e.canvas;t=t||{};const s=t.pixelRatio||Ar,n=t.size;n&&(i.width=n[0]*s,i.height=n[1]*s,i.style.width=n[0]+"px",i.style.height=n[1]+"px");const r=[0,0,i.width,i.height],a=si(Hi(),s,s);return new eo(e,s,r,a,0)}const st={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class $o extends fn{constructor(t){super(),this.on,this.once,this.un,this.options=t,this.id=t.id,this.insertFirst=t.insertFirst!==void 0?t.insertFirst:!0,this.stopEvent=t.stopEvent!==void 0?t.stopEvent:!0,this.element=document.createElement("div"),this.element.className=t.className!==void 0?t.className:"ol-overlay-container "+Fr,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=t.autoPan===!0?{}:t.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(st.ELEMENT,this.handleElementChanged),this.addChangeListener(st.MAP,this.handleMapChanged),this.addChangeListener(st.OFFSET,this.handleOffsetChanged),this.addChangeListener(st.POSITION,this.handlePositionChanged),this.addChangeListener(st.POSITIONING,this.handlePositioningChanged),t.element!==void 0&&this.setElement(t.element),this.setOffset(t.offset!==void 0?t.offset:[0,0]),this.setPositioning(t.positioning||"top-left"),t.position!==void 0&&this.setPosition(t.position)}getElement(){return this.get(st.ELEMENT)}getId(){return this.id}getMap(){return this.get(st.MAP)||null}getOffset(){return this.get(st.OFFSET)}getPosition(){return this.get(st.POSITION)}getPositioning(){return this.get(st.POSITIONING)}handleElementChanged(){Ir(this.element);const t=this.getElement();t&&this.element.appendChild(t)}handleMapChanged(){this.mapPostrenderListenerKey&&(Nr(this.element),gn(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const t=this.getMap();if(t){this.mapPostrenderListenerKey=mn(t,kr.POSTRENDER,this.render,this),this.updatePixelPosition();const i=this.stopEvent?t.getOverlayContainerStopEvent():t.getOverlayContainer();this.insertFirst?i.insertBefore(this.element,i.childNodes[0]||null):i.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(t){this.set(st.ELEMENT,t)}setMap(t){this.set(st.MAP,t)}setOffset(t){this.set(st.OFFSET,t)}setPosition(t){this.set(st.POSITION,t)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(t){const i=this.getMap();if(!i||!i.getTargetElement()||!this.get(st.POSITION))return;const s=this.getRect(i.getTargetElement(),i.getSize()),n=this.getElement(),r=this.getRect(n,[Dr(n),Gr(n)]);t=t||{};const a=t.margin===void 0?20:t.margin;if(!yn(s,r)){const o=r[0]-s[0],h=s[2]-r[2],l=r[1]-s[1],c=s[3]-r[3],u=[0,0];if(o<0?u[0]=o-a:h<0&&(u[0]=Math.abs(h)+a),l<0?u[1]=l-a:c<0&&(u[1]=Math.abs(c)+a),u[0]!==0||u[1]!==0){const d=i.getView().getCenterInternal(),f=i.getPixelFromCoordinateInternal(d);if(!f)return;const g=[f[0]+u[0],f[1]+u[1]],y=t.animation||{};i.getView().animateInternal({center:i.getCoordinateFromPixelInternal(g),duration:y.duration,easing:y.easing})}}}getRect(t,i){const s=t.getBoundingClientRect(),n=s.left+window.pageXOffset,r=s.top+window.pageYOffset;return[n,r,n+i[0],r+i[1]]}setPositioning(t){this.set(st.POSITIONING,t)}setVisible(t){this.rendered.visible!==t&&(this.element.style.display=t?"":"none",this.rendered.visible=t)}updatePixelPosition(){const t=this.getMap(),i=this.getPosition();if(!t||!t.isRendered()||!i){this.setVisible(!1);return}const s=t.getPixelFromCoordinate(i),n=t.getSize();this.updateRenderedPosition(s,n)}updateRenderedPosition(t,i){const s=this.element.style,n=this.getOffset(),r=this.getPositioning();this.setVisible(!0);const a=Math.round(t[0]+n[0])+"px",o=Math.round(t[1]+n[1])+"px";let h="0%",l="0%";r=="bottom-right"||r=="center-right"||r=="top-right"?h="-100%":(r=="bottom-center"||r=="center-center"||r=="top-center")&&(h="-50%"),r=="bottom-left"||r=="bottom-center"||r=="bottom-right"?l="-100%":(r=="center-left"||r=="center-center"||r=="center-right")&&(l="-50%");const c=`translate(${h}, ${l}) translate(${a}, ${o})`;this.rendered.transform_!=c&&(this.rendered.transform_=c,s.transform=c)}getOptions(){return this.options}}const di=$o,Es=[];class zo extends _n{constructor(t,i,s,n){super(t,i,{transition:0}),this.context_={},this.executorGroups={},this.declutterExecutorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=n.bind(void 0,this),this.wrappedTileCoord=s}getContext(t){const i=Z(t);return i in this.context_||(this.context_[i]=pn(1,1,Es)),this.context_[i]}hasContext(t){return Z(t)in this.context_}getImage(t){return this.hasContext(t)?this.getContext(t).canvas:null}getReplayState(t){const i=Z(t);return i in this.replayState_||(this.replayState_[i]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[i]}load(){this.getSourceTiles()}release(){for(const t in this.context_){const i=this.context_[t];jr(i),Es.push(i.canvas),delete this.context_[t]}super.release()}}const Uo=zo;let qo=class extends _n{constructor(t,i,s,n,r,a){super(t,i,a),this.extent=null,this.format_=n,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=r,this.url_=s,this.key=s}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==B.IDLE&&(this.setState(B.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(t,i){this.setFeatures(t)}onError(){this.setState(B.ERROR)}setFeatures(t){this.features_=t,this.setState(B.LOADED)}setLoader(t){this.loader_=t}};const Wo=qo;class Ho extends Ht{constructor(t){super({attributions:t.attributions,wrapX:t.wrapX}),this.resolution=void 0,this.distance=t.distance!==void 0?t.distance:20,this.minDistance=t.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=t.geometryFunction||function(i){const s=i.getGeometry();return ke(s.getType()=="Point",10),s},this.createCustomCluster_=t.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(t.source||null)}clear(t){this.features.length=0,super.clear(t)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(t,i,s){this.source.loadFeatures(t,i,s),i!==this.resolution&&(this.resolution=i,this.refresh())}setDistance(t){this.updateDistance(t,this.minDistance)}setMinDistance(t){this.updateDistance(this.distance,t)}getMinDistance(){return this.minDistance}setSource(t){this.source&&this.source.removeEventListener(ce.CHANGE,this.boundRefresh_),this.source=t,t&&t.addEventListener(ce.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(t,i){const s=t===0?0:Math.min(i,t)/t,n=t!==this.distance||this.interpolationRatio!==s;this.distance=t,this.minDistance=i,this.interpolationRatio=s,n&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;const t=Ki(),i=this.distance*this.resolution,s=this.source.getFeatures(),n={};for(let r=0,a=s.length;r<a;r++){const o=s[r];if(!(Z(o)in n)){const h=this.geometryFunction(o);if(h){const l=h.getCoordinates();vn(l,t),Gt(t,i,t);const c=this.source.getFeaturesInExtent(t).filter(function(u){const d=Z(u);return d in n?!1:(n[d]=!0,!0)});this.features.push(this.createCluster(c,t))}}}}createCluster(t,i){const s=[0,0];for(let o=t.length-1;o>=0;--o){const h=this.geometryFunction(t[o]);h?Vr(s,h.getCoordinates()):t.splice(o,1)}Br(s,1/t.length);const n=De(i),r=this.interpolationRatio,a=new Wt([s[0]*(1-r)+n[0]*r,s[1]*(1-r)+n[1]*r]);return this.createCustomCluster_?this.createCustomCluster_(a,t):new Ee({geometry:a,features:t})}}const Nn=Ho;class Ko extends co{constructor(t){const i=t.crossOrigin!==void 0?t.crossOrigin:null,s=t.imageLoadFunction!==void 0?t.imageLoadFunction:An;super({attributions:t.attributions,interpolate:t.interpolate,projection:Q(t.projection)}),this.url_=t.url,this.imageExtent_=t.imageExtent,this.image_=new $r(this.imageExtent_,void 0,1,this.url_,i,s),this.imageSize_=t.imageSize?t.imageSize:null,this.image_.addEventListener(ce.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(t,i,s,n){return qt(t,this.image_.getExtent())?this.image_:null}getUrl(){return this.url_}handleImageChange(t){if(this.image_.getState()==zr.LOADED){const i=this.image_.getExtent(),s=this.image_.getImage();let n,r;this.imageSize_?(n=this.imageSize_[0],r=this.imageSize_[1]):(n=s.width,r=s.height);const a=Ur(i),o=Fi(i),h=a/n,l=o/r;let c=n,u=r;if(h>l?c=Math.round(a/l):u=Math.round(o/h),c!==n||u!==r){const d=pn(c,u);this.getInterpolate()||(d.imageSmoothingEnabled=!1);const f=d.canvas;d.drawImage(s,0,0,n,r,0,0,f.width,f.height),this.image_.setImage(f)}}super.handleImageChange(t)}}const Xo=Ko;class Yo extends Cn{constructor(t){t=t||{};const i=Object.assign({},t.params),s="TRANSPARENT"in i?i.TRANSPARENT:!0;super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:!s,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0,this.params_=i,this.v13_=!0,this.serverType_=t.serverType,this.hidpi_=t.hidpi!==void 0?t.hidpi:!0,this.tmpExtent_=Ki(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(t,i,s,n){const r=Q(s),a=this.getProjection();let o=this.getTileGrid();o||(o=this.getTileGridForProjection(r));const h=o.getZForResolution(i,this.zDirection),l=o.getTileCoordForCoordAndZ(t,h);if(o.getResolutions().length<=l[0])return;let c=o.getResolution(l[0]),u=o.getTileCoordExtent(l,this.tmpExtent_),d=oi(o.getTileSize(l[0]),this.tmpSize);const f=this.gutter_;f!==0&&(d=ms(d,f,this.tmpSize),u=Gt(u,c*f,u)),a&&a!==r&&(c=qr(a,r,t,c),u=Mn(u,r,a),t=xn(t,r,a));const g={SERVICE:"WMS",VERSION:He,REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};Object.assign(g,this.params_,n);const y=Math.floor((t[0]-u[0])/c),m=Math.floor((u[3]-t[1])/c);return g[this.v13_?"I":"X"]=y,g[this.v13_?"J":"Y"]=m,this.getRequestUrl_(l,d,u,1,a||r,g)}getLegendUrl(t,i){if(this.urls[0]===void 0)return;const s={SERVICE:"WMS",VERSION:He,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(i===void 0||i.LAYER===void 0){const n=this.params_.LAYERS;if(!(!Array.isArray(n)||n.length===1))return;s.LAYER=n}if(t!==void 0){const n=this.getProjection()?this.getProjection().getMetersPerUnit():1,r=28e-5;s.SCALE=t*n/r}return Object.assign(s,i),Ts(this.urls[0],s)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(t,i,s,n,r,a){const o=this.urls;if(!o)return;if(a.WIDTH=i[0],a.HEIGHT=i[1],a[this.v13_?"CRS":"SRS"]=r.getCode(),"STYLES"in this.params_||(a.STYLES=""),n!=1)switch(this.serverType_){case"geoserver":const u=90*n+.5|0;"FORMAT_OPTIONS"in a?a.FORMAT_OPTIONS+=";dpi:"+u:a.FORMAT_OPTIONS="dpi:"+u;break;case"mapserver":a.MAP_RESOLUTION=90*n;break;case"carmentaserver":case"qgis":a.DPI=90*n;break;default:ke(!1,52);break}const h=r.getAxisOrientation(),l=s;if(this.v13_&&h.substr(0,2)=="ne"){let u;u=s[0],l[0]=s[1],l[1]=u,u=s[2],l[2]=s[3],l[3]=u}a.BBOX=l.join(",");let c;if(o.length==1)c=o[0];else{const u=Wr(Hr(t),o.length);c=o[u]}return Ts(c,a)}getTilePixelRatio(t){return!this.hidpi_||this.serverType_===void 0?1:t}getKeyForParams_(){let t=0;const i=[];for(const s in this.params_)i[t++]=s+"-"+this.params_[s];return i.join("/")}updateParams(t){Object.assign(this.params_,t),this.updateV13_(),this.setKey(this.getKeyForParams_())}updateV13_(){const t=this.params_.VERSION||He;this.v13_=uo(t,"1.3")>=0}tileUrlFunction(t,i,s){let n=this.getTileGrid();if(n||(n=this.getTileGridForProjection(s)),n.getResolutions().length<=t[0])return;i!=1&&(!this.hidpi_||this.serverType_===void 0)&&(i=1);const r=n.getResolution(t[0]);let a=n.getTileCoordExtent(t,this.tmpExtent_),o=oi(n.getTileSize(t[0]),this.tmpSize);const h=this.gutter_;h!==0&&(o=ms(o,h,this.tmpSize),a=Gt(a,r*h,a)),i!=1&&(o=Kr(o,i,this.tmpSize));const l={SERVICE:"WMS",VERSION:He,REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};return Object.assign(l,this.params_),this.getRequestUrl_(t,o,a,i,s,l)}}const Ut=Yo;class Zo extends Xr{constructor(t){const i=t.projection||"EPSG:3857",s=t.extent||Yr(i),n=t.tileGrid||Zr({extent:s,maxResolution:t.maxResolution,maxZoom:t.maxZoom!==void 0?t.maxZoom:22,minZoom:t.minZoom,tileSize:t.tileSize||512});super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,interpolate:!0,opaque:!1,projection:i,state:t.state,tileGrid:n,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:Jo,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX===void 0?!0:t.wrapX,transition:t.transition,zDirection:t.zDirection===void 0?1:t.zDirection}),this.format_=t.format?t.format:null,this.sourceTileCache=new Qr(this.tileCache.highWaterMark),this.overlaps_=t.overlaps==null?!0:t.overlaps,this.tileClass=t.tileClass?t.tileClass:Wo,this.tileGrids_={}}getFeaturesInExtent(t){const i=[],s=this.tileCache;if(s.getCount()===0)return i;const n=Jr(s.peekFirstKey())[0],r=this.tileGrid;return s.forEach(function(a){if(a.tileCoord[0]!==n||a.getState()!==B.LOADED)return;const o=a.getSourceTiles();for(let h=0,l=o.length;h<l;++h){const c=o[h],u=c.tileCoord;if(qt(t,r.getTileCoordExtent(u))){const d=c.getFeatures();if(d)for(let f=0,g=d.length;f<g;++f){const y=d[f],m=y.getGeometry();qt(t,m.getExtent())&&i.push(y)}}}}),i}getOverlaps(){return this.overlaps_}clear(){this.tileCache.clear(),this.sourceTileCache.clear()}expireCache(t,i){const s=this.getTileCacheForProjection(t),n=Object.keys(i).reduce((r,a)=>{const o=ta(a),h=s.peek(o);if(h){const l=h.sourceTiles;for(let c=0,u=l.length;c<u;++c)r[l[c].getKey()]=!0}return r},{});super.expireCache(t,i),this.sourceTileCache.expireCache(n)}getSourceTiles(t,i,s){if(s.getState()===B.IDLE){s.setState(B.LOADING);const n=s.wrappedTileCoord,r=this.getTileGridForProjection(i),a=r.getTileCoordExtent(n),o=n[0],h=r.getResolution(o);Gt(a,-h,a);const l=this.tileGrid,c=l.getExtent();c&&bn(a,c,a);const u=l.getZForResolution(h,this.zDirection);l.forEachTileCoord(a,u,d=>{const f=this.tileUrlFunction(d,t,i),g=this.sourceTileCache.containsKey(f)?this.sourceTileCache.get(f):new this.tileClass(d,f?B.IDLE:B.EMPTY,f,this.format_,this.tileLoadFunction);s.sourceTiles.push(g);const y=g.getState();if(y<B.LOADED){const m=p=>{this.handleTileChange(p);const x=g.getState();if(x===B.LOADED||x===B.ERROR){const b=g.getKey();b in s.errorTileKeys?g.getState()===B.LOADED&&delete s.errorTileKeys[b]:s.loadingSourceTiles--,x===B.ERROR?s.errorTileKeys[b]=!0:g.removeEventListener(ce.CHANGE,m),s.loadingSourceTiles===0&&s.setState(wn(s.errorTileKeys)?B.LOADED:B.ERROR)}};g.addEventListener(ce.CHANGE,m),s.loadingSourceTiles++}y===B.IDLE&&(g.extent=l.getTileCoordExtent(d),g.projection=i,g.resolution=l.getResolution(d[0]),this.sourceTileCache.set(f,g),g.load())}),s.loadingSourceTiles||s.setState(s.sourceTiles.some(d=>d.getState()===B.ERROR)?B.ERROR:B.LOADED)}return s.sourceTiles}getTile(t,i,s,n,r){const a=ia(t,i,s),o=this.getKey();let h;if(this.tileCache.containsKey(a)&&(h=this.tileCache.get(a),h.key===o))return h;const l=[t,i,s];let c=this.getTileCoordForTileUrlFunction(l,r);const u=this.getTileGrid().getExtent(),d=this.getTileGridForProjection(r);if(c&&u){const y=d.getTileCoordExtent(c);Gt(y,-d.getResolution(t),y),qt(u,y)||(c=null)}let f=!0;if(c!==null){const y=this.tileGrid,m=d.getResolution(t),p=y.getZForResolution(m,1),x=d.getTileCoordExtent(c);Gt(x,-m,x),y.forEachTileCoord(x,p,b=>{f=f&&!this.tileUrlFunction(b,n,r)})}const g=new Uo(l,f?B.EMPTY:B.IDLE,c,this.getSourceTiles.bind(this,n,r));return g.key=o,h?(g.interimTile=h,g.refreshInterimChain(),this.tileCache.replace(a,g)):this.tileCache.set(a,g),g}getTileGridForProjection(t){const i=t.getCode();let s=this.tileGrids_[i];if(!s){const n=this.tileGrid,r=n.getResolutions().slice(),a=r.map(function(l,c){return n.getOrigin(c)}),o=r.map(function(l,c){return n.getTileSize(c)}),h=sa+1;for(let l=r.length;l<h;++l)r.push(r[l-1]/2),a.push(a[l-1]),o.push(o[l-1]);s=new ea({extent:n.getExtent(),origins:a,resolutions:r,tileSizes:o}),this.tileGrids_[i]=s}return s}getTilePixelRatio(t){return t}getTilePixelSize(t,i,s){const n=this.getTileGridForProjection(s),r=oi(n.getTileSize(t),this.tmpSize);return[Math.round(r[0]*i),Math.round(r[1]*i)]}updateCacheSize(t,i){super.updateCacheSize(t*2,i),this.sourceTileCache.highWaterMark=this.getTileCacheForProjection(i).highWaterMark}}const Qo=Zo;function Jo(e,t){e.setLoader(function(i,s,n){io(t,e.getFormat(),i,s,n,e.onLoad.bind(e),e.onError.bind(e))})}class th{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.supportedMediaTypes=null}getReadOptions(t,i){if(i){let s=i.dataProjection?Q(i.dataProjection):this.readProjection(t);i.extent&&s&&s.getUnits()==="tile-pixels"&&(s=Q(s),s.setWorldExtent(i.extent)),i={dataProjection:s,featureProjection:i.featureProjection}}return this.adaptOptions(i)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},t)}getType(){return at()}readFeature(t,i){return at()}readFeatures(t,i){return at()}readGeometry(t,i){return at()}readProjection(t){return at()}writeFeature(t,i){return at()}writeFeatures(t,i){return at()}writeGeometry(t,i){return at()}}const kn=th;function Yi(e,t,i){const s=i?Q(i.featureProjection):null,n=i?Q(i.dataProjection):null;let r;if(s&&n&&!na(s,n)?r=(t?e.clone():e).transform(t?s:n,t?n:s):r=e,t&&i&&i.decimals!==void 0){const a=Math.pow(10,i.decimals),o=function(h){for(let l=0,c=h.length;l<c;++l)h[l]=Math.round(h[l]*a)/a;return h};r===e&&(r=e.clone()),r.applyTransform(o)}return r}class fi extends Ie{constructor(t,i,s){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,i);else if(i!==void 0&&s)this.setFlatCoordinates(i,t),this.ends_=s;else{let n=this.getLayout();const r=t,a=[],o=[];for(let h=0,l=r.length;h<l;++h){const c=r[h];h===0&&(n=c.getLayout()),bt(a,c.getFlatCoordinates()),o.push(a.length)}this.setFlatCoordinates(n,a),this.ends_=o}}appendLineString(t){this.flatCoordinates?bt(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new fi(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,i,s,n){return n<Ne(this.getExtent(),t,i)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ra(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),aa(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,i,s,n))}getCoordinateAtM(t,i,s){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(i=i!==void 0?i:!1,s=s!==void 0?s:!1,Vo(this.flatCoordinates,0,this.ends_,this.stride,t,i,s))}getCoordinates(){return oa(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new ui(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,i=this.ends_,s=this.layout,n=[];let r=0;for(let a=0,o=i.length;a<o;++a){const h=i[a],l=new ui(t.slice(r,h),s);n.push(l),r=h}return n}getFlatMidpoints(){const t=[],i=this.flatCoordinates;let s=0;const n=this.ends_,r=this.stride;for(let a=0,o=n.length;a<o;++a){const h=n[a],l=li(i,s,h,r,.5);bt(t,l),s=h}return t}getSimplifiedGeometryInternal(t){const i=[],s=[];return i.length=ha(this.flatCoordinates,0,this.ends_,this.stride,t,i,0,s),new fi(i,"XY",s)}getType(){return"MultiLineString"}intersectsExtent(t){return la(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,i){this.setLayout(i,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const s=ca(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=s.length===0?0:s[s.length-1],this.changed()}}const Dn=fi;class Zi extends Ie{constructor(t,i){super(),i&&!Array.isArray(t[0])?this.setFlatCoordinates(i,t):this.setCoordinates(t,i)}appendPoint(t){this.flatCoordinates?bt(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.changed()}clone(){const t=new Zi(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,i,s,n){if(n<Ne(this.getExtent(),t,i))return n;const r=this.flatCoordinates,a=this.stride;for(let o=0,h=r.length;o<h;o+=a){const l=ua(t,i,r[o],r[o+1]);if(l<n){n=l;for(let c=0;c<a;++c)s[c]=r[o+c];s.length=a}}return n}getCoordinates(){return un(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const i=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return t<0||i<=t?null:new Wt(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,i=this.layout,s=this.stride,n=[];for(let r=0,a=t.length;r<a;r+=s){const o=new Wt(t.slice(r,r+s),i);n.push(o)}return n}getType(){return"MultiPoint"}intersectsExtent(t){const i=this.flatCoordinates,s=this.stride;for(let n=0,r=i.length;n<r;n+=s){const a=i[n],o=i[n+1];if(da(t,a,o))return!0}return!1}setCoordinates(t,i){this.setLayout(i,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=dn(this.flatCoordinates,0,t,this.stride),this.changed()}}const Qi=Zi;function Gn(e,t,i,s){const n=[];let r=Ki();for(let a=0,o=i.length;a<o;++a){const h=i[a];r=Sn(e,t,h[0],s),n.push((r[0]+r[2])/2,(r[1]+r[3])/2),t=h[h.length-1]}return n}class gi extends Ie{constructor(t,i,s){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!s&&!Array.isArray(t[0])){let n=this.getLayout();const r=t,a=[],o=[];for(let h=0,l=r.length;h<l;++h){const c=r[h];h===0&&(n=c.getLayout());const u=a.length,d=c.getEnds();for(let f=0,g=d.length;f<g;++f)d[f]+=u;bt(a,c.getFlatCoordinates()),o.push(d)}i=n,t=a,s=o}i!==void 0&&s?(this.setFlatCoordinates(i,t),this.endss_=s):this.setCoordinates(t,i)}appendPolygon(t){let i;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),i=t.getEnds().slice(),this.endss_.push();else{const s=this.flatCoordinates.length;bt(this.flatCoordinates,t.getFlatCoordinates()),i=t.getEnds().slice();for(let n=0,r=i.length;n<r;++n)i[n]+=s}this.endss_.push(i),this.changed()}clone(){const t=this.endss_.length,i=new Array(t);for(let n=0;n<t;++n)i[n]=this.endss_[n].slice();const s=new gi(this.flatCoordinates.slice(),this.layout,i);return s.applyProperties(this),s}closestPointXY(t,i,s,n){return n<Ne(this.getExtent(),t,i)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(fa(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),ga(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,i,s,n))}containsXY(t,i){return ma(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,i)}getArea(){return ya(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let i;return t!==void 0?(i=this.getOrientedFlatCoordinates().slice(),ys(i,0,this.endss_,this.stride,t)):i=this.flatCoordinates,_a(i,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=Gn(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Tn(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new Qi(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;pa(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=ys(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const i=[],s=[];return i.length=va(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),i,0,s),new gi(i,"XY",s)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let i;if(t===0)i=0;else{const r=this.endss_[t-1];i=r[r.length-1]}const s=this.endss_[t].slice(),n=s[s.length-1];if(i!==0)for(let r=0,a=s.length;r<a;++r)s[r]-=i;return new hi(this.flatCoordinates.slice(i,n),this.layout,s)}getPolygons(){const t=this.layout,i=this.flatCoordinates,s=this.endss_,n=[];let r=0;for(let a=0,o=s.length;a<o;++a){const h=s[a].slice(),l=h[h.length-1];if(r!==0)for(let u=0,d=h.length;u<d;++u)h[u]-=r;const c=new hi(i.slice(r,l),t,h);n.push(c),r=l}return n}getType(){return"MultiPolygon"}intersectsExtent(t){return Ca(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,i){this.setLayout(i,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const s=Ma(this.flatCoordinates,0,t,this.stride,this.endss_);if(s.length===0)this.flatCoordinates.length=0;else{const n=s[s.length-1];this.flatCoordinates.length=n.length===0?0:n[n.length-1]}this.changed()}}const jn=gi;var Ji={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Ji.read=function(e,t,i,s,n){var r,a,o=n*8-s-1,h=(1<<o)-1,l=h>>1,c=-7,u=i?n-1:0,d=i?-1:1,f=e[t+u];for(u+=d,r=f&(1<<-c)-1,f>>=-c,c+=o;c>0;r=r*256+e[t+u],u+=d,c-=8);for(a=r&(1<<-c)-1,r>>=-c,c+=s;c>0;a=a*256+e[t+u],u+=d,c-=8);if(r===0)r=1-l;else{if(r===h)return a?NaN:(f?-1:1)*(1/0);a=a+Math.pow(2,s),r=r-l}return(f?-1:1)*a*Math.pow(2,r-s)};Ji.write=function(e,t,i,s,n,r){var a,o,h,l=r*8-n-1,c=(1<<l)-1,u=c>>1,d=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,f=s?0:r-1,g=s?1:-1,y=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(h=Math.pow(2,-a))<1&&(a--,h*=2),a+u>=1?t+=d/h:t+=d*Math.pow(2,1-u),t*h>=2&&(a++,h/=2),a+u>=c?(o=0,a=c):a+u>=1?(o=(t*h-1)*Math.pow(2,n),a=a+u):(o=t*Math.pow(2,u-1)*Math.pow(2,n),a=0));n>=8;e[i+f]=o&255,f+=g,o/=256,n-=8);for(a=a<<n|o,l+=n;l>0;e[i+f]=a&255,f+=g,a/=256,l-=8);e[i+f-g]|=y*128};var eh=G,Ke=Ji;function G(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}G.Varint=0;G.Fixed64=1;G.Bytes=2;G.Fixed32=5;var ji=(1<<16)*(1<<16),Ls=1/ji,ih=12,Vn=typeof TextDecoder>"u"?null:new TextDecoder("utf8");G.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var s=this.readVarint(),n=s>>3,r=this.pos;this.type=s&7,e(n,t,this),this.pos===r&&this.skip(s)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Xe(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=Rs(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Xe(this.buf,this.pos)+Xe(this.buf,this.pos+4)*ji;return this.pos+=8,e},readSFixed64:function(){var e=Xe(this.buf,this.pos)+Rs(this.buf,this.pos+4)*ji;return this.pos+=8,e},readFloat:function(){var e=Ke.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Ke.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t=this.buf,i,s;return s=t[this.pos++],i=s&127,s<128||(s=t[this.pos++],i|=(s&127)<<7,s<128)||(s=t[this.pos++],i|=(s&127)<<14,s<128)||(s=t[this.pos++],i|=(s&127)<<21,s<128)?i:(s=t[this.pos],i|=(s&15)<<28,sh(i,e,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2===1?(e+1)/-2:e/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=ih&&Vn?_h(this.buf,t,e):yh(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==G.Bytes)return e.push(this.readVarint(t));var i=Pt(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==G.Bytes)return e.push(this.readSVarint());var t=Pt(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==G.Bytes)return e.push(this.readBoolean());var t=Pt(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==G.Bytes)return e.push(this.readFloat());var t=Pt(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==G.Bytes)return e.push(this.readDouble());var t=Pt(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==G.Bytes)return e.push(this.readFixed32());var t=Pt(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==G.Bytes)return e.push(this.readSFixed32());var t=Pt(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==G.Bytes)return e.push(this.readFixed64());var t=Pt(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==G.Bytes)return e.push(this.readSFixed64());var t=Pt(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=e&7;if(t===G.Varint)for(;this.buf[this.pos++]>127;);else if(t===G.Bytes)this.pos=this.readVarint()+this.pos;else if(t===G.Fixed32)this.pos+=4;else if(t===G.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+t)},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Qt(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Qt(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Qt(this.buf,e&-1,this.pos),Qt(this.buf,Math.floor(e*Ls),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Qt(this.buf,e&-1,this.pos),Qt(this.buf,Math.floor(e*Ls),this.pos+4),this.pos+=8},writeVarint:function(e){if(e=+e||0,e>268435455||e<0){nh(e,this);return}this.realloc(4),this.buf[this.pos++]=e&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=e>>>7&127)))},writeSVarint:function(e){this.writeVarint(e<0?-e*2-1:e*2)},writeBoolean:function(e){this.writeVarint(!!e)},writeString:function(e){e=String(e),this.realloc(e.length*4),this.pos++;var t=this.pos;this.pos=ph(this.buf,e,this.pos);var i=this.pos-t;i>=128&&Ps(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),Ke.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),Ke.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var s=this.pos-i;s>=128&&Ps(i,s,this),this.pos=i-1,this.writeVarint(s),this.pos+=s},writeMessage:function(e,t,i){this.writeTag(e,G.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,oh,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,hh,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,uh,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,lh,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,ch,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,dh,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,fh,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,gh,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,mh,t)},writeBytesField:function(e,t){this.writeTag(e,G.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,G.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,G.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,G.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,G.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,G.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,G.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,G.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,G.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,G.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,!!t)}};function sh(e,t,i){var s=i.buf,n,r;if(r=s[i.pos++],n=(r&112)>>4,r<128||(r=s[i.pos++],n|=(r&127)<<3,r<128)||(r=s[i.pos++],n|=(r&127)<<10,r<128)||(r=s[i.pos++],n|=(r&127)<<17,r<128)||(r=s[i.pos++],n|=(r&127)<<24,r<128)||(r=s[i.pos++],n|=(r&1)<<31,r<128))return Zt(e,n,t);throw new Error("Expected varint not more than 10 bytes")}function Pt(e){return e.type===G.Bytes?e.readVarint()+e.pos:e.pos+1}function Zt(e,t,i){return i?t*4294967296+(e>>>0):(t>>>0)*4294967296+(e>>>0)}function nh(e,t){var i,s;if(e>=0?(i=e%4294967296|0,s=e/4294967296|0):(i=~(-e%4294967296),s=~(-e/4294967296),i^4294967295?i=i+1|0:(i=0,s=s+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),rh(i,s,t),ah(s,t)}function rh(e,t,i){i.buf[i.pos++]=e&127|128,e>>>=7,i.buf[i.pos++]=e&127|128,e>>>=7,i.buf[i.pos++]=e&127|128,e>>>=7,i.buf[i.pos++]=e&127|128,e>>>=7,i.buf[i.pos]=e&127}function ah(e,t){var i=(e&7)<<4;t.buf[t.pos++]|=i|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127)))))}function Ps(e,t,i){var s=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(Math.LN2*7));i.realloc(s);for(var n=i.pos-1;n>=e;n--)i.buf[n+s]=i.buf[n]}function oh(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function hh(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function lh(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function ch(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function uh(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function dh(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function fh(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function gh(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function mh(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function Xe(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+e[t+3]*16777216}function Qt(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function Rs(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function yh(e,t,i){for(var s="",n=t;n<i;){var r=e[n],a=null,o=r>239?4:r>223?3:r>191?2:1;if(n+o>i)break;var h,l,c;o===1?r<128&&(a=r):o===2?(h=e[n+1],(h&192)===128&&(a=(r&31)<<6|h&63,a<=127&&(a=null))):o===3?(h=e[n+1],l=e[n+2],(h&192)===128&&(l&192)===128&&(a=(r&15)<<12|(h&63)<<6|l&63,(a<=2047||a>=55296&&a<=57343)&&(a=null))):o===4&&(h=e[n+1],l=e[n+2],c=e[n+3],(h&192)===128&&(l&192)===128&&(c&192)===128&&(a=(r&15)<<18|(h&63)<<12|(l&63)<<6|c&63,(a<=65535||a>=1114112)&&(a=null))),a===null?(a=65533,o=1):a>65535&&(a-=65536,s+=String.fromCharCode(a>>>10&1023|55296),a=56320|a&1023),s+=String.fromCharCode(a),n+=o}return s}function _h(e,t,i){return Vn.decode(e.subarray(t,i))}function ph(e,t,i){for(var s=0,n,r;s<t.length;s++){if(n=t.charCodeAt(s),n>55295&&n<57344)if(r)if(n<56320){e[i++]=239,e[i++]=191,e[i++]=189,r=n;continue}else n=r-55296<<10|n-56320|65536,r=null;else{n>56319||s+1===t.length?(e[i++]=239,e[i++]=191,e[i++]=189):r=n;continue}else r&&(e[i++]=239,e[i++]=191,e[i++]=189,r=null);n<128?e[i++]=n:(n<2048?e[i++]=n>>6|192:(n<65536?e[i++]=n>>12|224:(e[i++]=n>>18|240,e[i++]=n>>12&63|128),e[i++]=n>>6&63|128),e[i++]=n&63|128)}return i}class mi extends Ii{constructor(t){super(),this.geometries_=t||null,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(gn),this.changeEventsKeys_.length=0}listenGeometriesChange_(){if(this.geometries_)for(let t=0,i=this.geometries_.length;t<i;++t)this.changeEventsKeys_.push(mn(this.geometries_[t],ce.CHANGE,this.changed,this))}clone(){const t=new mi(null);return t.setGeometries(this.geometries_),t.applyProperties(this),t}closestPointXY(t,i,s,n){if(n<Ne(this.getExtent(),t,i))return n;const r=this.geometries_;for(let a=0,o=r.length;a<o;++a)n=r[a].closestPointXY(t,i,s,n);return n}containsXY(t,i){const s=this.geometries_;for(let n=0,r=s.length;n<r;++n)if(s[n].containsXY(t,i))return!0;return!1}computeExtent(t){xa(t);const i=this.geometries_;for(let s=0,n=i.length;s<n;++s)ba(t,i[s].getExtent());return t}getGeometries(){return Os(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const i=this.geometries_;for(let s=0,n=i.length;s<n;++s)i[s].getType()===this.getType()?t=t.concat(i[s].getGeometriesArrayRecursive()):t.push(i[s]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const i=[],s=this.geometries_;let n=!1;for(let r=0,a=s.length;r<a;++r){const o=s[r],h=o.getSimplifiedGeometry(t);i.push(h),h!==o&&(n=!0)}if(n){const r=new mi(null);return r.setGeometriesArray(i),r}return this.simplifiedGeometryMaxMinSquaredTolerance=t,this}getType(){return"GeometryCollection"}intersectsExtent(t){const i=this.geometries_;for(let s=0,n=i.length;s<n;++s)if(i[s].intersectsExtent(t))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(t,i){const s=this.geometries_;for(let n=0,r=s.length;n<r;++n)s[n].rotate(t,i);this.changed()}scale(t,i,s){s||(s=De(this.getExtent()));const n=this.geometries_;for(let r=0,a=n.length;r<a;++r)n[r].scale(t,i,s);this.changed()}setGeometries(t){this.setGeometriesArray(Os(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const i=this.geometries_;for(let s=0,n=i.length;s<n;++s)i[s].applyTransform(t);this.changed()}translate(t,i){const s=this.geometries_;for(let n=0,r=s.length;n<r;++n)s[n].translate(t,i);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function Os(e){const t=[];for(let i=0,s=e.length;i<s;++i)t.push(e[i].clone());return t}const vh=mi,As=Hi();class Le{constructor(t,i,s,n,r){this.styleFunction,this.extent_,this.id_=r,this.type_=t,this.flatCoordinates_=i,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=s,this.properties_=n}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?vn(this.flatCoordinates_):Sn(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const t=De(this.getExtent());this.flatInteriorPoints_=wa(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const t=Gn(this.flatCoordinates_,0,this.ends_,2);this.flatInteriorPoints_=Tn(this.flatCoordinates_,0,this.ends_,2,t)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=li(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const t=this.flatCoordinates_;let i=0;const s=this.ends_;for(let n=0,r=s.length;n<r;++n){const a=s[n],o=li(t,i,a,2,.5);bt(this.flatMidpoints_,o),i=a}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,i){return this}getProperties(){return this.properties_}getStride(){return 2}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=Q(t);const i=t.getExtent(),s=t.getWorldExtent();if(i&&s){const n=Fi(s)/Fi(i);Sa(As,s[0],s[3],n,-n,0,0,0),Ta(this.flatCoordinates_,0,this.flatCoordinates_.length,2,As,this.flatCoordinates_)}}getEnds(){return this.ends_}}Le.prototype.getEndss=Le.prototype.getEnds;Le.prototype.getFlatCoordinates=Le.prototype.getOrientedFlatCoordinates;const Fs=Le;class Ch extends kn{constructor(t){super(),t=t||{},this.dataProjection=new En({code:"",units:"tile-pixels"}),this.featureClass_=t.featureClass?t.featureClass:Fs,this.geometryName_=t.geometryName,this.layerName_=t.layerName?t.layerName:"layer",this.layers_=t.layers?t.layers:null,this.idProperty_=t.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(t,i,s,n){t.pos=i.geometry;const r=t.readVarint()+t.pos;let a=1,o=0,h=0,l=0,c=0,u=0;for(;t.pos<r;){if(!o){const d=t.readVarint();a=d&7,o=d>>3}o--,a===1||a===2?(h+=t.readSVarint(),l+=t.readSVarint(),a===1&&c>u&&(n.push(c),u=c),s.push(h,l),c+=2):a===7?c>u&&(s.push(s[u],s[u+1]),c+=2):ke(!1,59)}c>u&&(n.push(c),u=c)}createFeature_(t,i,s){const n=i.type;if(n===0)return null;let r;const a=i.properties;let o;this.idProperty_?(o=a[this.idProperty_],delete a[this.idProperty_]):o=i.id,a[this.layerName_]=i.layer.name;const h=[],l=[];this.readRawGeometry_(t,i,h,l);const c=Sh(n,l.length);if(this.featureClass_===Fs)r=new this.featureClass_(c,h,l,a,o),r.transform(s.dataProjection);else{let u;if(c=="Polygon"){const g=Ea(h,l);u=g.length>1?new jn(h,"XY",g):new hi(h,"XY",l)}else u=c==="Point"?new Wt(h,"XY"):c==="LineString"?new ui(h,"XY"):c==="MultiPoint"?new Qi(h,"XY"):c==="MultiLineString"?new Dn(h,"XY",l):null;const d=this.featureClass_;r=new d,this.geometryName_&&r.setGeometryName(this.geometryName_);const f=Yi(u,!1,s);r.setGeometry(f),o!==void 0&&r.setId(o),r.setProperties(a,!0)}return r}getType(){return"arraybuffer"}readFeatures(t,i){const s=this.layers_;i=this.adaptOptions(i);const n=Q(i.dataProjection);n.setWorldExtent(i.extent),i.dataProjection=n;const r=new eh(t),a=r.readFields(Mh,{}),o=[];for(const h in a){if(s&&!s.includes(h))continue;const l=a[h],c=l?[0,0,l.extent,l.extent]:null;n.setExtent(c);for(let u=0,d=l.length;u<d;++u){const f=wh(r,l,u),g=this.createFeature_(r,f,i);g!==null&&o.push(g)}}return o}readProjection(t){return this.dataProjection}setLayers(t){this.layers_=t}}function Mh(e,t,i){if(e===3){const s={keys:[],values:[],features:[]},n=i.readVarint()+i.pos;i.readFields(xh,s,n),s.length=s.features.length,s.length&&(t[s.name]=s)}}function xh(e,t,i){if(e===15)t.version=i.readVarint();else if(e===1)t.name=i.readString();else if(e===5)t.extent=i.readVarint();else if(e===2)t.features.push(i.pos);else if(e===3)t.keys.push(i.readString());else if(e===4){let s=null;const n=i.readVarint()+i.pos;for(;i.pos<n;)e=i.readVarint()>>3,s=e===1?i.readString():e===2?i.readFloat():e===3?i.readDouble():e===4?i.readVarint64():e===5?i.readVarint():e===6?i.readSVarint():e===7?i.readBoolean():null;t.values.push(s)}}function bh(e,t,i){if(e==1)t.id=i.readVarint();else if(e==2){const s=i.readVarint()+i.pos;for(;i.pos<s;){const n=t.layer.keys[i.readVarint()],r=t.layer.values[i.readVarint()];t.properties[n]=r}}else e==3?t.type=i.readVarint():e==4&&(t.geometry=i.pos)}function wh(e,t,i){e.pos=t.features[i];const s=e.readVarint()+e.pos,n={layer:t,type:0,properties:{}};return e.readFields(bh,n,s),n}function Sh(e,t){let i;return e===1?i=t===1?"Point":"MultiPoint":e===2?i=t===1?"LineString":"MultiLineString":e===3&&(i="Polygon"),i}const Th=Ch,Eh={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},Lh={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class Ph extends La{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.tmpTransform_=Hi()}prepareTile(t,i,s){let n;const r=t.getState();return(r===B.LOADED||r===B.ERROR)&&(this.updateExecutorGroup_(t,i,s),this.tileImageNeedsRender_(t)&&(n=!0)),n}getTile(t,i,s,n){const r=n.pixelRatio,a=n.viewState,o=a.resolution,h=a.projection,l=this.getLayer(),c=l.getSource().getTile(t,i,s,r,h),u=n.viewHints,d=!(u[Yt.ANIMATING]||u[Yt.INTERACTING]);return(d||!c.wantedResolution)&&(c.wantedResolution=o),this.prepareTile(c,r,h)&&(d||Date.now()-n.time<8)&&l.getRenderMode()!=="vector"&&this.renderTileImage_(c,n),super.getTile(t,i,s,n)}isDrawableTile(t){const i=this.getLayer();return super.isDrawableTile(t)&&(i.getRenderMode()==="vector"?Z(i)in t.executorGroups:t.hasContext(i))}getTileImage(t){return t.getImage(this.getLayer())}prepareFrame(t){const i=this.getLayer().getRevision();return this.renderedLayerRevision_!==i&&(this.renderedLayerRevision_=i,this.renderedTiles.length=0),super.prepareFrame(t)}updateExecutorGroup_(t,i,s){const n=this.getLayer(),r=n.getRevision(),a=n.getRenderOrder()||null,o=t.wantedResolution,h=t.getReplayState(n);if(!h.dirty&&h.renderedResolution===o&&h.renderedRevision==r&&h.renderedRenderOrder==a)return;const l=n.getSource(),c=n.getDeclutter(),u=l.getTileGrid(),f=l.getTileGridForProjection(s).getTileCoordExtent(t.wrappedTileCoord),g=l.getSourceTiles(i,s,t),y=Z(n);delete t.hitDetectionImageData[y],t.executorGroups[y]=[],c&&(t.declutterExecutorGroups[y]=[]),h.dirty=!1;for(let m=0,p=g.length;m<p;++m){const x=g[m];if(x.getState()!=B.LOADED)continue;const b=x.tileCoord,M=u.getTileCoordExtent(b),v=bn(f,M),w=Gt(v,n.getRenderBuffer()*o,this.tmpExtent),C=Pa(M,v)?null:w,T=new bs(0,w,o,i),L=c?new bs(0,v,o,i):void 0,k=so(o,i),D=function(lt){let gt;const N=lt.getStyleFunction()||n.getStyleFunction();if(N&&(gt=N(lt,o)),gt){const mt=this.renderFeature(lt,k,gt,T,L);h.dirty=h.dirty||mt}},X=x.getFeatures();a&&a!==h.renderedRenderOrder&&X.sort(a);for(let lt=0,gt=X.length;lt<gt;++lt){const N=X[lt];(!C||qt(C,N.getGeometry().getExtent()))&&D.call(this,N)}const ht=T.finish(),et=n.getRenderMode()!=="vector"&&c&&g.length===1?null:v,zt=new ws(et,o,i,l.getOverlaps(),ht,n.getRenderBuffer());if(t.executorGroups[y].push(zt),L){const lt=new ws(null,o,i,l.getOverlaps(),L.finish(),n.getRenderBuffer());t.declutterExecutorGroups[y].push(lt)}}h.renderedRevision=r,h.renderedRenderOrder=a,h.renderedResolution=o}forEachFeatureAtCoordinate(t,i,s,n,r){const a=i.viewState.resolution,o=i.viewState.rotation;s=s??0;const h=this.getLayer(),c=h.getSource().getTileGridForProjection(i.viewState.projection),u=Ln([t]);Gt(u,a*s,u);const d={},f=function(m,p,x){let b=m.getId();b===void 0&&(b=Z(m));const M=d[b];if(M){if(M!==!0&&x<M.distanceSq){if(x===0)return d[b]=!0,r.splice(r.lastIndexOf(M),1),n(m,h,p);M.geometry=p,M.distanceSq=x}}else{if(x===0)return d[b]=!0,n(m,h,p);r.push(d[b]={feature:m,layer:h,geometry:p,distanceSq:x,callback:n})}},g=this.renderedTiles;let y;for(let m=0,p=g.length;!y&&m<p;++m){const x=g[m],b=c.getTileCoordExtent(x.wrappedTileCoord);if(!qt(b,u))continue;const M=Z(h),v=[x.executorGroups[M]],w=x.declutterExecutorGroups[M];w&&v.push(w),v.some(C=>{const T=C===w?i.declutterTree.all().map(L=>L.value):null;for(let L=0,k=C.length;L<k;++L)if(y=C[L].forEachFeatureAtCoordinate(t,a,o,s,f,T),y)return!0})}return y}getFeatures(t){return new Promise((i,s)=>{const n=this.getLayer(),r=Z(n),a=n.getSource(),o=this.renderedProjection,h=o.getExtent(),l=this.renderedResolution,c=a.getTileGridForProjection(o),u=Ra(this.renderedPixelToCoordinateTransform_,t.slice()),d=c.getTileCoordForCoordAndResolution(u,l);let f;for(let b=0,M=this.renderedTiles.length;b<M;++b)if(d.toString()===this.renderedTiles[b].tileCoord.toString()){if(f=this.renderedTiles[b],f.getState()===B.LOADED){const v=c.getTileCoordExtent(f.tileCoord);a.getWrapX()&&o.canWrapX()&&!yn(h,v)&&Oa(u,o);break}f=void 0}if(!f||f.loadingSourceTiles>0){i([]);return}const g=c.getTileCoordExtent(f.wrappedTileCoord),y=Aa(g),m=[(u[0]-y[0])/l,(y[1]-u[1])/l],p=f.getSourceTiles().reduce(function(b,M){return b.concat(M.getFeatures())},[]);let x=f.hitDetectionImageData[r];if(!x){const b=oi(c.getTileSize(c.getZForResolution(l,a.zDirection))),M=this.renderedRotation_,v=[this.getRenderTransform(c.getTileCoordCenter(f.wrappedTileCoord),l,0,Li,b[0]*Li,b[1]*Li,0)];x=no(b,v,p,n.getStyleFunction(),c.getTileCoordExtent(f.wrappedTileCoord),f.getReplayState(n).renderedResolution,M),f.hitDetectionImageData[r]=x}i(ro(m,p,x))})}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.renderedLayerRevision_!==void 0&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}renderDeclutter(t){const i=this.context,s=i.globalAlpha;i.globalAlpha=this.getLayer().getOpacity();const n=t.viewHints,r=!(n[Yt.ANIMATING]||n[Yt.INTERACTING]),a=this.renderedTiles;for(let o=0,h=a.length;o<h;++o){const l=a[o],c=l.declutterExecutorGroups[Z(this.getLayer())];if(c)for(let u=c.length-1;u>=0;--u)c[u].execute(this.context,1,this.getTileRenderTransform(l,t),t.viewState.rotation,r,void 0,t.declutterTree)}i.globalAlpha=s}getTileRenderTransform(t,i){const s=i.pixelRatio,n=i.viewState,r=n.center,a=n.resolution,o=n.rotation,h=i.size,l=Math.round(h[0]*s),c=Math.round(h[1]*s),d=this.getLayer().getSource().getTileGridForProjection(i.viewState.projection),f=t.tileCoord,g=d.getTileCoordExtent(t.wrappedTileCoord),y=d.getTileCoordExtent(f,this.tmpExtent)[0]-g[0];return Fa(si(this.inversePixelTransform.slice(),1/s,1/s),this.getRenderTransform(r,a,o,s,l,c,y))}postRender(t,i){const s=i.viewHints,n=!(s[Yt.ANIMATING]||s[Yt.INTERACTING]);this.renderedPixelToCoordinateTransform_=i.pixelToCoordinateTransform.slice(),this.renderedRotation_=i.viewState.rotation;const r=this.getLayer(),a=r.getRenderMode(),o=t.globalAlpha;t.globalAlpha=r.getOpacity();const h=Lh[a],l=i.viewState,c=l.rotation,u=r.getSource(),f=u.getTileGridForProjection(l.projection).getZForResolution(l.resolution,u.zDirection),g=this.renderedTiles,y=[],m=[];let p=!0;for(let x=g.length-1;x>=0;--x){const b=g[x];p=p&&!b.getReplayState(r).dirty;const M=b.executorGroups[Z(r)].filter(L=>L.hasExecutors(h));if(M.length===0)continue;const v=this.getTileRenderTransform(b,i),w=b.tileCoord[0];let C=!1;const T=M[0].getClipCoords(v);if(T){for(let L=0,k=y.length;L<k;++L)if(f!==w&&w<m[L]){const D=y[L];qt([T[0],T[3],T[4],T[7]],[D[0],D[3],D[4],D[7]])&&(C||(t.save(),C=!0),t.beginPath(),t.moveTo(T[0],T[1]),t.lineTo(T[2],T[3]),t.lineTo(T[4],T[5]),t.lineTo(T[6],T[7]),t.moveTo(D[6],D[7]),t.lineTo(D[4],D[5]),t.lineTo(D[2],D[3]),t.lineTo(D[0],D[1]),t.clip())}y.push(T),m.push(w)}for(let L=0,k=M.length;L<k;++L)M[L].execute(t,1,v,c,n,h);C&&t.restore()}t.globalAlpha=o,this.ready=p,super.postRender(t,i)}renderFeature(t,i,s,n,r){if(!s)return!1;let a=!1;if(Array.isArray(s))for(let o=0,h=s.length;o<h;++o)a=Ss(n,t,s[o],i,this.boundHandleStyleImageChange_,void 0,r)||a;else a=Ss(n,t,s,i,this.boundHandleStyleImageChange_,void 0,r);return a}tileImageNeedsRender_(t){const i=this.getLayer();if(i.getRenderMode()==="vector")return!1;const s=t.getReplayState(i),n=i.getRevision(),r=t.wantedResolution;return s.renderedTileResolution!==r||s.renderedTileRevision!==n}renderTileImage_(t,i){const s=this.getLayer(),n=t.getReplayState(s),r=s.getRevision(),a=t.executorGroups[Z(s)];n.renderedTileRevision=r;const o=t.wrappedTileCoord,h=o[0],l=s.getSource();let c=i.pixelRatio;const d=i.viewState.projection,f=l.getTileGridForProjection(d),g=f.getResolution(t.tileCoord[0]),y=i.pixelRatio/t.wantedResolution*g,m=f.getResolution(h),p=t.getContext(s);c=Math.round(Math.max(c,y/c));const x=l.getTilePixelSize(h,c,d);p.canvas.width=x[0],p.canvas.height=x[1];const b=c/y;if(b!==1){const C=_s(this.tmpTransform_);si(C,b,b),p.setTransform.apply(p,C)}const M=f.getTileCoordExtent(o,this.tmpExtent),v=y/m,w=_s(this.tmpTransform_);si(w,v,-v),Ia(w,-M[0],-M[3]);for(let C=0,T=a.length;C<T;++C)a[C].execute(p,b,w,0,!0,Eh[s.getRenderMode()]);n.renderedTileResolution=t.wantedResolution}}const Rh=Ph;class Oh extends ao{constructor(t){t=t||{};const i=Object.assign({},t);delete i.preload,delete i.useInterimTilesOnError,super(i),this.on,this.once,this.un;const s=t.renderMode||"hybrid";ke(s=="hybrid"||s=="vector",28),this.renderMode_=s,this.setPreload(t.preload?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new Rh(this)}getFeatures(t){return super.getFeatures(t)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(qe.PRELOAD)}getUseInterimTilesOnError(){return this.get(qe.USE_INTERIM_TILES_ON_ERROR)}setPreload(t){this.set(qe.PRELOAD,t)}setUseInterimTilesOnError(t){this.set(qe.USE_INTERIM_TILES_ON_ERROR,t)}}const Bn=Oh;class Ah extends kn{constructor(){super()}getType(){return"json"}readFeature(t,i){return this.readFeatureFromObject(Ye(t),this.getReadOptions(t,i))}readFeatures(t,i){return this.readFeaturesFromObject(Ye(t),this.getReadOptions(t,i))}readFeatureFromObject(t,i){return at()}readFeaturesFromObject(t,i){return at()}readGeometry(t,i){return this.readGeometryFromObject(Ye(t),this.getReadOptions(t,i))}readGeometryFromObject(t,i){return at()}readProjection(t){return this.readProjectionFromObject(Ye(t))}readProjectionFromObject(t){return at()}writeFeature(t,i){return JSON.stringify(this.writeFeatureObject(t,i))}writeFeatureObject(t,i){return at()}writeFeatures(t,i){return JSON.stringify(this.writeFeaturesObject(t,i))}writeFeaturesObject(t,i){return at()}writeGeometry(t,i){return JSON.stringify(this.writeGeometryObject(t,i))}writeGeometryObject(t,i){return at()}}function Ye(e){if(typeof e=="string"){const t=JSON.parse(e);return t||null}else if(e!==null)return e;return null}const Fh=Ah;class Ih extends Fh{constructor(t){t=t||{},super(),this.dataProjection=Q(t.dataProjection?t.dataProjection:"EPSG:4326"),t.featureProjection&&(this.defaultFeatureProjection=Q(t.featureProjection)),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(t,i){let s=null;t.type==="Feature"?s=t:s={type:"Feature",geometry:t,properties:null};const n=Vi(s.geometry,i),r=new Ee;return this.geometryName_?r.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in s!==void 0&&r.setGeometryName(s.geometry_name),r.setGeometry(n),"id"in s&&r.setId(s.id),s.properties&&r.setProperties(s.properties,!0),r}readFeaturesFromObject(t,i){const s=t;let n=null;if(s.type==="FeatureCollection"){const r=t;n=[];const a=r.features;for(let o=0,h=a.length;o<h;++o)n.push(this.readFeatureFromObject(a[o],i))}else n=[this.readFeatureFromObject(t,i)];return n}readGeometryFromObject(t,i){return Vi(t,i)}readProjectionFromObject(t){const i=t.crs;let s;return i?i.type=="name"?s=Q(i.properties.name):i.type==="EPSG"?s=Q("EPSG:"+i.properties.code):ke(!1,36):s=this.dataProjection,s}writeFeatureObject(t,i){i=this.adaptOptions(i);const s={type:"Feature",geometry:null,properties:null},n=t.getId();if(n!==void 0&&(s.id=n),!t.hasProperties())return s;const r=t.getProperties(),a=t.getGeometry();return a&&(s.geometry=Bi(a,i),delete r[t.getGeometryName()]),wn(r)||(s.properties=r),s}writeFeaturesObject(t,i){i=this.adaptOptions(i);const s=[];for(let n=0,r=t.length;n<r;++n)s.push(this.writeFeatureObject(t[n],i));return{type:"FeatureCollection",features:s}}writeGeometryObject(t,i){return Bi(t,this.adaptOptions(i))}}function Vi(e,t){if(!e)return null;let i;switch(e.type){case"Point":{i=kh(e);break}case"LineString":{i=Dh(e);break}case"Polygon":{i=Bh(e);break}case"MultiPoint":{i=jh(e);break}case"MultiLineString":{i=Gh(e);break}case"MultiPolygon":{i=Vh(e);break}case"GeometryCollection":{i=Nh(e);break}default:throw new Error("Unsupported GeoJSON type: "+e.type)}return Yi(i,!1,t)}function Nh(e,t){const i=e.geometries.map(function(s){return Vi(s,t)});return new vh(i)}function kh(e){return new Wt(e.coordinates)}function Dh(e){return new ui(e.coordinates)}function Gh(e){return new Dn(e.coordinates)}function jh(e){return new Qi(e.coordinates)}function Vh(e){return new jn(e.coordinates)}function Bh(e){return new hi(e.coordinates)}function Bi(e,t){e=Yi(e,!0,t);const i=e.getType();let s;switch(i){case"Point":{s=Hh(e);break}case"LineString":{s=zh(e);break}case"Polygon":{s=Kh(e,t);break}case"MultiPoint":{s=qh(e);break}case"MultiLineString":{s=Uh(e);break}case"MultiPolygon":{s=Wh(e,t);break}case"GeometryCollection":{s=$h(e,t);break}case"Circle":{s={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+i)}return s}function $h(e,t){return t=Object.assign({},t),delete t.featureProjection,{type:"GeometryCollection",geometries:e.getGeometriesArray().map(function(s){return Bi(s,t)})}}function zh(e,t){return{type:"LineString",coordinates:e.getCoordinates()}}function Uh(e,t){return{type:"MultiLineString",coordinates:e.getCoordinates()}}function qh(e,t){return{type:"MultiPoint",coordinates:e.getCoordinates()}}function Wh(e,t){let i;return t&&(i=t.rightHanded),{type:"MultiPolygon",coordinates:e.getCoordinates(i)}}function Hh(e,t){return{type:"Point",coordinates:e.getCoordinates()}}function Kh(e,t){let i;return t&&(i=t.rightHanded),{type:"Polygon",coordinates:e.getCoordinates(i)}}const Xh=Ih;function Yh(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;const i=document.implementation.createHTMLDocument(),s=i.createElement("base"),n=i.createElement("a");return i.head.appendChild(s),i.body.appendChild(n),t&&(s.href=t),n.href=e,n.href}const Zh=(()=>{let e=0;const t=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(e+=1,`u${t()}${e}`)})();function Rt(e){const t=[];for(let i=0,s=e.length;i<s;i++)t.push(e[i]);return t}function yi(e,t){const s=(e.ownerDocument.defaultView||window).getComputedStyle(e).getPropertyValue(t);return s?parseFloat(s.replace("px","")):0}function Qh(e){const t=yi(e,"border-left-width"),i=yi(e,"border-right-width");return e.clientWidth+t+i}function Jh(e){const t=yi(e,"border-top-width"),i=yi(e,"border-bottom-width");return e.clientHeight+t+i}function $n(e,t={}){const i=t.width||Qh(e),s=t.height||Jh(e);return{width:i,height:s}}function tl(){let e,t;try{t=process}catch{}const i=t&&t.env?t.env.devicePixelRatio:null;return i&&(e=parseInt(i,10),Number.isNaN(e)&&(e=1)),e||window.devicePixelRatio||1}const yt=16384;function el(e){(e.width>yt||e.height>yt)&&(e.width>yt&&e.height>yt?e.width>e.height?(e.height*=yt/e.width,e.width=yt):(e.width*=yt/e.height,e.height=yt):e.width>yt?(e.height*=yt/e.width,e.width=yt):(e.width*=yt/e.height,e.height=yt))}function _i(e){return new Promise((t,i)=>{const s=new Image;s.decode=()=>t(s),s.onload=()=>t(s),s.onerror=i,s.crossOrigin="anonymous",s.decoding="async",s.src=e})}async function il(e){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(e)).then(encodeURIComponent).then(t=>`data:image/svg+xml;charset=utf-8,${t}`)}async function sl(e,t,i){const s="http://www.w3.org/2000/svg",n=document.createElementNS(s,"svg"),r=document.createElementNS(s,"foreignObject");return n.setAttribute("width",`${t}`),n.setAttribute("height",`${i}`),n.setAttribute("viewBox",`0 0 ${t} ${i}`),r.setAttribute("width","100%"),r.setAttribute("height","100%"),r.setAttribute("x","0"),r.setAttribute("y","0"),r.setAttribute("externalResourcesRequired","true"),n.appendChild(r),r.appendChild(e),il(n)}const ut=(e,t)=>{if(e instanceof t)return!0;const i=Object.getPrototypeOf(e);return i===null?!1:i.constructor.name===t.name||ut(i,t)};function nl(e){const t=e.getPropertyValue("content");return`${e.cssText} content: '${t.replace(/'|"/g,"")}';`}function rl(e){return Rt(e).map(t=>{const i=e.getPropertyValue(t),s=e.getPropertyPriority(t);return`${t}: ${i}${s?" !important":""};`}).join(" ")}function al(e,t,i){const s=`.${e}:${t}`,n=i.cssText?nl(i):rl(i);return document.createTextNode(`${s}{${n}}`)}function Is(e,t,i){const s=window.getComputedStyle(e,i),n=s.getPropertyValue("content");if(n===""||n==="none")return;const r=Zh();try{t.className=`${t.className} ${r}`}catch{return}const a=document.createElement("style");a.appendChild(al(r,i,s)),t.appendChild(a)}function hl(e,t){Is(e,t,":before"),Is(e,t,":after")}const Ns="application/font-woff",ks="image/jpeg",ll={woff:Ns,woff2:Ns,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:ks,jpeg:ks,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function cl(e){const t=/\.([^./]*?)$/g.exec(e);return t?t[1]:""}function ts(e){const t=cl(e).toLowerCase();return ll[t]||""}function ul(e){return e.split(/,/)[1]}function $i(e){return e.search(/^(data:)/)!==-1}function zn(e,t){return`data:${t};base64,${e}`}async function Un(e,t,i){const s=await fetch(e,t);if(s.status===404)throw new Error(`Resource "${s.url}" not found`);const n=await s.blob();return new Promise((r,a)=>{const o=new FileReader;o.onerror=a,o.onloadend=()=>{try{r(i({res:s,result:o.result}))}catch(h){a(h)}},o.readAsDataURL(n)})}const Pi={};function dl(e,t,i){let s=e.replace(/\?.*/,"");return i&&(s=e),/ttf|otf|eot|woff2?/i.test(s)&&(s=s.replace(/.*\//,"")),t?`[${t}]${s}`:s}async function es(e,t,i){const s=dl(e,t,i.includeQueryParams);if(Pi[s]!=null)return Pi[s];i.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+new Date().getTime());let n;try{const r=await Un(e,i.fetchRequestInit,({res:a,result:o})=>(t||(t=a.headers.get("Content-Type")||""),ul(o)));n=zn(r,t)}catch(r){n=i.imagePlaceholder||"";let a=`Failed to fetch resource: ${e}`;r&&(a=typeof r=="string"?r:r.message),a&&console.warn(a)}return Pi[s]=n,n}async function fl(e){const t=e.toDataURL();return t==="data:,"?e.cloneNode(!1):_i(t)}async function gl(e,t){if(e.currentSrc){const r=document.createElement("canvas"),a=r.getContext("2d");r.width=e.clientWidth,r.height=e.clientHeight,a==null||a.drawImage(e,0,0,r.width,r.height);const o=r.toDataURL();return _i(o)}const i=e.poster,s=ts(i),n=await es(i,s,t);return _i(n)}async function ml(e){var t;try{if(!((t=e==null?void 0:e.contentDocument)===null||t===void 0)&&t.body)return await wi(e.contentDocument.body,{},!0)}catch{}return e.cloneNode(!1)}async function yl(e,t){return ut(e,HTMLCanvasElement)?fl(e):ut(e,HTMLVideoElement)?gl(e,t):ut(e,HTMLIFrameElement)?ml(e):e.cloneNode(!1)}const _l=e=>e.tagName!=null&&e.tagName.toUpperCase()==="SLOT";async function pl(e,t,i){var s,n;let r=[];return _l(e)&&e.assignedNodes?r=Rt(e.assignedNodes()):ut(e,HTMLIFrameElement)&&(!((s=e.contentDocument)===null||s===void 0)&&s.body)?r=Rt(e.contentDocument.body.childNodes):r=Rt(((n=e.shadowRoot)!==null&&n!==void 0?n:e).childNodes),r.length===0||ut(e,HTMLVideoElement)||await r.reduce((a,o)=>a.then(()=>wi(o,i)).then(h=>{h&&t.appendChild(h)}),Promise.resolve()),t}function vl(e,t){const i=t.style;if(!i)return;const s=window.getComputedStyle(e);s.cssText?(i.cssText=s.cssText,i.transformOrigin=s.transformOrigin):Rt(s).forEach(n=>{let r=s.getPropertyValue(n);n==="font-size"&&r.endsWith("px")&&(r=`${Math.floor(parseFloat(r.substring(0,r.length-2)))-.1}px`),ut(e,HTMLIFrameElement)&&n==="display"&&r==="inline"&&(r="block"),n==="d"&&t.getAttribute("d")&&(r=`path(${t.getAttribute("d")})`),i.setProperty(n,r,s.getPropertyPriority(n))})}function Cl(e,t){ut(e,HTMLTextAreaElement)&&(t.innerHTML=e.value),ut(e,HTMLInputElement)&&t.setAttribute("value",e.value)}function Ml(e,t){if(ut(e,HTMLSelectElement)){const i=t,s=Array.from(i.children).find(n=>e.value===n.getAttribute("value"));s&&s.setAttribute("selected","")}}function xl(e,t){return ut(t,Element)&&(vl(e,t),hl(e,t),Cl(e,t),Ml(e,t)),t}async function bl(e,t){const i=e.querySelectorAll?e.querySelectorAll("use"):[];if(i.length===0)return e;const s={};for(let r=0;r<i.length;r++){const o=i[r].getAttribute("xlink:href");if(o){const h=e.querySelector(o),l=document.querySelector(o);!h&&l&&!s[o]&&(s[o]=await wi(l,t,!0))}}const n=Object.values(s);if(n.length){const r="http://www.w3.org/1999/xhtml",a=document.createElementNS(r,"svg");a.setAttribute("xmlns",r),a.style.position="absolute",a.style.width="0",a.style.height="0",a.style.overflow="hidden",a.style.display="none";const o=document.createElementNS(r,"defs");a.appendChild(o);for(let h=0;h<n.length;h++)o.appendChild(n[h]);e.appendChild(a)}return e}async function wi(e,t,i){return!i&&t.filter&&!t.filter(e)?null:Promise.resolve(e).then(s=>yl(s,t)).then(s=>pl(e,s,t)).then(s=>xl(e,s)).then(s=>bl(s,t))}const qn=/url\((['"]?)([^'"]+?)\1\)/g,wl=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,Sl=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function Tl(e){const t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}function El(e){const t=[];return e.replace(qn,(i,s,n)=>(t.push(n),i)),t.filter(i=>!$i(i))}async function Ll(e,t,i,s,n){try{const r=i?Yh(t,i):t,a=ts(t);let o;if(n){const h=await n(r);o=zn(h,a)}else o=await es(r,a,s);return e.replace(Tl(t),`$1${o}$3`)}catch{}return e}function Pl(e,{preferredFontFormat:t}){return t?e.replace(Sl,i=>{for(;;){const[s,,n]=wl.exec(i)||[];if(!n)return"";if(n===t)return`src: ${s};`}}):e}function Wn(e){return e.search(qn)!==-1}async function Hn(e,t,i){if(!Wn(e))return e;const s=Pl(e,i);return El(s).reduce((r,a)=>r.then(o=>Ll(o,a,t,i)),Promise.resolve(s))}async function Ze(e,t,i){var s;const n=(s=t.style)===null||s===void 0?void 0:s.getPropertyValue(e);if(n){const r=await Hn(n,null,i);return t.style.setProperty(e,r,t.style.getPropertyPriority(e)),!0}return!1}async function Rl(e,t){await Ze("background",e,t)||await Ze("background-image",e,t),await Ze("mask",e,t)||await Ze("mask-image",e,t)}async function Ol(e,t){const i=ut(e,HTMLImageElement);if(!(i&&!$i(e.src))&&!(ut(e,SVGImageElement)&&!$i(e.href.baseVal)))return;const s=i?e.src:e.href.baseVal,n=await es(s,ts(s),t);await new Promise((r,a)=>{e.onload=r,e.onerror=a;const o=e;o.decode&&(o.decode=r),o.loading==="lazy"&&(o.loading="eager"),i?(e.srcset="",e.src=n):e.href.baseVal=n})}async function Al(e,t){const s=Rt(e.childNodes).map(n=>Kn(n,t));await Promise.all(s).then(()=>e)}async function Kn(e,t){ut(e,Element)&&(await Rl(e,t),await Ol(e,t),await Al(e,t))}function Fl(e,t){const{style:i}=e;t.backgroundColor&&(i.backgroundColor=t.backgroundColor),t.width&&(i.width=`${t.width}px`),t.height&&(i.height=`${t.height}px`);const s=t.style;return s!=null&&Object.keys(s).forEach(n=>{i[n]=s[n]}),e}const Ds={};async function Gs(e){let t=Ds[e];if(t!=null)return t;const s=await(await fetch(e)).text();return t={url:e,cssText:s},Ds[e]=t,t}async function js(e,t){let i=e.cssText;const s=/url\(["']?([^"')]+)["']?\)/g,r=(i.match(/url\([^)]+\)/g)||[]).map(async a=>{let o=a.replace(s,"$1");return o.startsWith("https://")||(o=new URL(o,e.url).href),Un(o,t.fetchRequestInit,({result:h})=>(i=i.replace(a,`url(${h})`),[a,h]))});return Promise.all(r).then(()=>i)}function Vs(e){if(e==null)return[];const t=[],i=/(\/\*[\s\S]*?\*\/)/gi;let s=e.replace(i,"");const n=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const h=n.exec(s);if(h===null)break;t.push(h[0])}s=s.replace(n,"");const r=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,a="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",o=new RegExp(a,"gi");for(;;){let h=r.exec(s);if(h===null){if(h=o.exec(s),h===null)break;r.lastIndex=o.lastIndex}else o.lastIndex=r.lastIndex;t.push(h[0])}return t}async function Il(e,t){const i=[],s=[];return e.forEach(n=>{if("cssRules"in n)try{Rt(n.cssRules||[]).forEach((r,a)=>{if(r.type===CSSRule.IMPORT_RULE){let o=a+1;const h=r.href,l=Gs(h).then(c=>js(c,t)).then(c=>Vs(c).forEach(u=>{try{n.insertRule(u,u.startsWith("@import")?o+=1:n.cssRules.length)}catch(d){console.error("Error inserting rule from remote css",{rule:u,error:d})}})).catch(c=>{console.error("Error loading remote css",c.toString())});s.push(l)}})}catch(r){const a=e.find(o=>o.href==null)||document.styleSheets[0];n.href!=null&&s.push(Gs(n.href).then(o=>js(o,t)).then(o=>Vs(o).forEach(h=>{a.insertRule(h,n.cssRules.length)})).catch(o=>{console.error("Error loading remote stylesheet",o)})),console.error("Error inlining remote css file",r)}}),Promise.all(s).then(()=>(e.forEach(n=>{if("cssRules"in n)try{Rt(n.cssRules||[]).forEach(r=>{i.push(r)})}catch(r){console.error(`Error while reading CSS rules from ${n.href}`,r)}}),i))}function Nl(e){return e.filter(t=>t.type===CSSRule.FONT_FACE_RULE).filter(t=>Wn(t.style.getPropertyValue("src")))}async function kl(e,t){if(e.ownerDocument==null)throw new Error("Provided element is not within a Document");const i=Rt(e.ownerDocument.styleSheets),s=await Il(i,t);return Nl(s)}async function Dl(e,t){const i=await kl(e,t);return(await Promise.all(i.map(n=>{const r=n.parentStyleSheet?n.parentStyleSheet.href:null;return Hn(n.cssText,r,t)}))).join(`
`)}async function Gl(e,t){const i=t.fontEmbedCSS!=null?t.fontEmbedCSS:t.skipFonts?null:await Dl(e,t);if(i){const s=document.createElement("style"),n=document.createTextNode(i);s.appendChild(n),e.firstChild?e.insertBefore(s,e.firstChild):e.appendChild(s)}}async function jl(e,t={}){const{width:i,height:s}=$n(e,t),n=await wi(e,t,!0);return await Gl(n,t),await Kn(n,t),Fl(n,t),await sl(n,i,s)}async function Vl(e,t={}){const{width:i,height:s}=$n(e,t),n=await jl(e,t),r=await _i(n),a=document.createElement("canvas"),o=a.getContext("2d"),h=t.pixelRatio||tl(),l=t.canvasWidth||i,c=t.canvasHeight||s;return a.width=l*h,a.height=c*h,t.skipAutoScale||el(a),a.style.width=`${l}`,a.style.height=`${c}`,t.backgroundColor&&(o.fillStyle=t.backgroundColor,o.fillRect(0,0,a.width,a.height)),o.drawImage(r,0,0,a.width,a.height),a}async function Bl(e,t={}){return(await Vl(e,t)).toDataURL()}const $l={props:{coordinate:{type:Object,default:{}}},setup(e,{emit:t}){let i;const s=$t({imgSrc:"dddd"});return bi(async()=>{i=new oe({target:"imgMap",layers:[new ue({preload:1/0,crossOrigin:"Anonymous",source:new Na})],view:new Pn({projection:"EPSG:4326",center:e.coordinate,zoom:14})}),i.once("loadend",function(){Bl(i.getTargetElement()).then(function(n){document.getElementById("imgMap").remove(),s.imgSrc=n})})}),{props:e,state:s}}},zl=e=>(Ae("data-v-e063639f"),e=e(),Fe(),e),Ul={class:"position-relative",style:{overflow:"hidden"}},ql=zl(()=>_("div",{id:"imgMap",class:"position-absolute",style:{width:"600px",height:"600px"}},null,-1));function Wl(e,t,i,s,n,r){return O(),A("div",Ul,[ql,_("div",{style:br([{background:`url('${s.state.imgSrc}')`,"background-size":"cover"},{width:"100%",height:"200px"}])},null,4)])}const Hl=Ot($l,[["render",Wl],["__scopeId","data-v-e063639f"]]),Kl="/Map_Demo/assets/vector-a2cf21ef.svg";const Xl={props:{tribeAreaData:{Type:String,default:0},closeMapData:{Type:Function,default:()=>{}},maxHeight:{Type:Number,default:0},coordinate:{type:Object,default:{}}},setup(e,{emit:t}){const i=on(),s=$t({type:1,media:"photo",scrollY:!1,tribeData:{}});async function n(a){return await te.ajax({url:`https://api.edtest.site/tribe?tribeCode=${a}`,method:"GET"}).done(h=>h).fail(h=>(console.log("Fail",h),!1))}async function r(a){return await te.ajax({url:`https://api.edtest.site/historicalDiseaster?id=${a}`,method:"GET"}).done(h=>h).fail(h=>(console.log("Fail",h),!1))}return an(()=>[e.tribeAreaData.編號,e.tribeAreaData.id_],async a=>{a[1]!==void 0?(s.type=2,await r(a[1]).then(o=>{s.tribeData=o.data})):(s.type=1,await n(a[0]).then(o=>{s.tribeData=o}))}),bi(()=>{e.tribeAreaData.id_!==void 0?(s.type=2,r(e.tribeAreaData.id_).then(a=>{s.tribeData=a.data})):(s.type=1,n(e.tribeAreaData.編號||e.tribeAreaData.id_).then(a=>{s.tribeData=a}))}),{router:i,props:e,state:s}}},Tt=e=>(Ae("data-v-6d7a99fa"),e=e(),Fe(),e),Yl={key:0,class:"bg-white rounded py-2",style:{"overflow-y":"auto"}},Zl=Tt(()=>_("div",{class:"row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold"},[_("p",null,"詳細資訊")],-1)),Ql={class:"row mx-0 align-items-center p-2 position-relative"},Jl={class:"d-flex flex-nowrap align-items-center justify-content-between my-2"},tc={class:""},ec={href:""},ic=Tt(()=>_("img",{src:Kl,alt:""},null,-1)),sc={class:"border-bottom row flex-nowrap p-2 my-3 cursor-pointer mx-0"},nc={key:0,class:"py-2 px-4"},rc={class:"d-flex flex-wrap justify-content-between"},ac={class:"w-50 mb-4"},oc={class:"mb-0"},hc=["src"],lc={key:1,class:"py-2 px-4"},cc=Tt(()=>_("div",null,"影片影片影片影片影片影片",-1)),uc=[cc],dc={key:1,class:"bg-white rounded py-2"},fc={class:"row mx-0 align-items-center px-2 py-4 position-relative"},gc={class:"row mx-0 mb-2"},mc=Tt(()=>_("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"事件:",-1)),yc={class:"col-8 py-1 px-2 bg-grey-light text-start"},_c={class:"row mx-0 mb-2"},pc=Tt(()=>_("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"發生時間:",-1)),vc={class:"col-8 py-1 px-2 bg-grey-light text-start"},Cc={class:"row mx-0 mb-2"},Mc=Tt(()=>_("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"鄉鎮: ",-1)),xc={class:"col-8 py-1 px-2 bg-grey-light text-start"},bc={class:"row mx-0 mb-2"},wc=Tt(()=>_("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"地方: ",-1)),Sc={class:"col-8 py-1 px-2 bg-grey-light text-start"},Tc={class:"row mx-0 mb-2"},Ec=Tt(()=>_("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"村落: ",-1)),Lc={class:"col-8 py-1 px-2 bg-grey-light text-start"},Pc={class:"row mx-0 mb-2"},Rc=Tt(()=>_("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"災害種類: ",-1)),Oc={class:"col-8 py-1 px-2 bg-grey-light text-start"},Ac={class:"row mx-0 mb-2"},Fc=Tt(()=>_("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"描述: ",-1)),Ic={class:"col-8 py-1 px-2 bg-grey-light text-start"};function Nc(e,t,i,s,n,r){var o,h,l,c,u,d,f,g,y,m,p,x,b,M,v,w,C,T,L,k,D,X,ht,et,zt,lt,gt,N,mt,it,Lt,Ft,ye,cs,us;const a=Hl;return s.state.type===1?(O(),A("div",Yl,[Zl,It(a,{coordinate:s.props.coordinate},null,8,["coordinate"]),_("div",Ql,[_("div",Jl,[_("span",tc,W((l=(h=(o=s.state)==null?void 0:o.tribeData)==null?void 0:h.basicInformation)==null?void 0:l.tribeName),1),_("div",{class:"p-2 bg-steel w-auto text-white d-inline-block rounded-2 cursor-pointer",onClick:t[0]||(t[0]=()=>{s.router.push({path:`/Map_Demo/mapDetails/${s.props.tribeAreaData.編號}`})})},"更多資訊")]),_("p",null,"描述: "+W((d=(u=(c=s.state)==null?void 0:c.tribeData)==null?void 0:u.basicInformation)==null?void 0:d.description),1),_("p",null,W((y=(g=(f=s.state)==null?void 0:f.tribeData)==null?void 0:g.basicInformation)==null?void 0:y.area),1),_("a",ec,[ic,Te(" "+W((M=(b=(x=(p=(m=s.state)==null?void 0:m.tribeData)==null?void 0:p.basicInformation)==null?void 0:x.coordinates)==null?void 0:b.WGS84)==null?void 0:M.lat)+" , "+W((L=(T=(C=(w=(v=s.state)==null?void 0:v.tribeData)==null?void 0:w.basicInformation)==null?void 0:C.coordinates)==null?void 0:T.WGS84)==null?void 0:L.lng),1)])]),_("div",null,[_("div",sc,[_("div",{class:"col-6 cursor-pointer",onClick:t[1]||(t[1]=Ue=>s.state.media="photo")},"相片"),_("div",{class:"col-6 cursor-pointer",onClick:t[2]||(t[2]=Ue=>s.state.media="video")},"影片")]),s.state.media==="photo"?(O(),A("div",nc,[_("div",rc,[(O(!0),A(Nt,null,kt((D=(k=s.state)==null?void 0:k.tribeData)==null?void 0:D.culturalLandscape,Ue=>(O(),A("div",ac,[_("p",oc,W(Ue.name),1),_("img",{src:Ue.image,alt:"",class:"w-100"},null,8,hc)]))),256))])])):K("",!0),s.state.media==="video"?(O(),A("div",lc,uc)):K("",!0)])])):(O(),A("div",dc,[_("div",fc,[_("div",gc,[mc,_("div",yc,W((ht=(X=s.state)==null?void 0:X.tribeData)==null?void 0:ht.event),1)]),_("div",_c,[pc,_("div",vc,W((zt=(et=s.state)==null?void 0:et.tribeData)==null?void 0:zt.date),1)]),_("div",Cc,[Mc,_("div",xc,W((gt=(lt=s.state)==null?void 0:lt.tribeData)==null?void 0:gt.township),1)]),_("div",bc,[wc,_("div",Sc,W((mt=(N=s.state)==null?void 0:N.tribeData)==null?void 0:mt.village),1)]),_("div",Tc,[Ec,_("div",Lc,W((Lt=(it=s.state)==null?void 0:it.tribeData)==null?void 0:Lt.place),1)]),_("div",Pc,[Rc,_("div",Oc,W((ye=(Ft=s.state)==null?void 0:Ft.tribeData)==null?void 0:ye.category),1)]),_("div",Ac,[Fc,_("div",Ic,W((us=(cs=s.state)==null?void 0:cs.tribeData)==null?void 0:us.description),1)])])]))}const kc=Ot(Xl,[["render",Nc],["__scopeId","data-v-6d7a99fa"]]),Dc="/Map_Demo/assets/vectorOpacity-1fa0a805.svg";const Gc={props:{onClose:{type:Function,default:()=>{}},onDeleteLayer:{type:Function,default:()=>{}},onLockLayer:{type:Function,default:()=>{}},currentLayers:{type:Array,default:[]},selectLock:{type:Boolean,default:!1},onLayerControl:{type:Function,default:()=>{}}},setup(e,{emit:t}){const i=$t({});return{props:e,state:i}}},Et=e=>(Ae("data-v-a9f89f73"),e=e(),Fe(),e),jc={class:"layerSelect bg-white"},Vc={class:"row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold"},Bc=Et(()=>_("p",{class:"mb-0 fs-5"},"已選擇的圖層",-1)),$c=Et(()=>_("svg",{width:"32",height:"32",viewBox:"0 0 24 24"},[_("path",{fill:"currentColor",d:"M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10zm0-11.414L9.172 7.757L7.757 9.172L10.586 12l-2.829 2.828l1.415 1.415L12 13.414l2.828 2.829l1.415-1.415L13.414 12l2.829-2.828l-1.415-1.415L12 10.586z"})],-1)),zc=[$c],Uc=Et(()=>_("hr",{class:"my-0"},null,-1)),qc={class:"py-3 px-4 content"},Wc={class:"allControl d-flex align-items-center justify-content-end mb-0"},Hc=Et(()=>_("svg",{viewBox:"0 0 25 24",fill:"currentColor"},[_("path",{d:"M8.02381 9.33333H14.881V7.80952C14.881 7.1746 14.6587 6.63492 14.2143 6.19048C13.7698 5.74603 13.2302 5.52381 12.5952 5.52381C11.9603 5.52381 11.4206 5.74603 10.9762 6.19048C10.5317 6.63492 10.3095 7.1746 10.3095 7.80952H8.78571C8.78571 6.75556 9.15727 5.85702 9.90038 5.1139C10.643 4.3713 11.5413 4 12.5952 4C13.6492 4 14.5477 4.3713 15.2909 5.1139C16.0335 5.85702 16.4048 6.75556 16.4048 7.80952V9.33333H17.1667C17.5857 9.33333 17.9446 9.48241 18.2432 9.78057C18.5414 10.0792 18.6905 10.4381 18.6905 10.8571V18.4762C18.6905 18.8952 18.5414 19.2541 18.2432 19.5528C17.9446 19.8509 17.5857 20 17.1667 20H8.02381C7.60476 20 7.24616 19.8509 6.948 19.5528C6.64933 19.2541 6.5 18.8952 6.5 18.4762V10.8571C6.5 10.4381 6.64933 10.0792 6.948 9.78057C7.24616 9.48241 7.60476 9.33333 8.02381 9.33333ZM12.5952 16.1905C13.0143 16.1905 13.3731 16.0414 13.6718 15.7432C13.97 15.4446 14.119 15.0857 14.119 14.6667C14.119 14.2476 13.97 13.8888 13.6718 13.5901C13.3731 13.2919 13.0143 13.1429 12.5952 13.1429C12.1762 13.1429 11.8176 13.2919 11.5194 13.5901C11.2208 13.8888 11.0714 14.2476 11.0714 14.6667C11.0714 15.0857 11.2208 15.4446 11.5194 15.7432C11.8176 16.0414 12.1762 16.1905 12.5952 16.1905Z"})],-1)),Kc=Et(()=>_("svg",{viewBox:"0 0 25 24",fill:"currentColor"},[_("path",{d:"M7.5 21C6.95 21 6.47933 20.8043 6.088 20.413C5.696 20.021 5.5 19.55 5.5 19V6H4.5V4H9.5V3H15.5V4H20.5V6H19.5V19C19.5 19.55 19.3043 20.021 18.913 20.413C18.521 20.8043 18.05 21 17.5 21H7.5ZM9.5 17H11.5V8H9.5V17ZM13.5 17H15.5V8H13.5V17Z"})],-1)),Xc={class:"list-unstyled d-flex flex-wrap flex-column-reverse"},Yc={key:0,class:"d-flex justify-content-between align-items-center border-bottom py-2"},Zc={class:"tool"},Qc=["onClick"],Jc=Et(()=>_("img",{src:Dc,alt:""},null,-1)),tu=[Jc],eu=["onClick"],iu=Et(()=>_("svg",{viewBox:"0 0 25 24",fill:"currentColor"},[_("path",{d:"M9.49991 19.84H15.4999V11.84H20.3399L12.4999 4.00003L4.65991 11.84H9.49991V19.84Z",fill:"#808080"})],-1)),su=[iu],nu=["onClick"],ru=Et(()=>_("svg",{viewBox:"0 0 25 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[_("path",{d:"M9.49991 4H15.4999V12H20.3399L12.4999 19.84L4.65991 12H9.49991V4Z",fill:"#808080"})],-1)),au=[ru],ou=["onClick"],hu=Et(()=>_("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[_("path",{d:"M12.3333 10C11.8029 10 11.2942 10.2107 10.9191 10.5858C10.544 10.9609 10.3333 11.4696 10.3333 12C10.3333 12.5304 10.544 13.0391 10.9191 13.4142C11.2942 13.7893 11.8029 14 12.3333 14C12.8638 14 13.3725 13.7893 13.7475 13.4142C14.1226 13.0391 14.3333 12.5304 14.3333 12C14.3333 11.4696 14.1226 10.9609 13.7475 10.5858C13.3725 10.2107 12.8638 10 12.3333 10ZM12.3333 15.3333C11.4493 15.3333 10.6014 14.9821 9.97631 14.357C9.35119 13.7319 9 12.8841 9 12C9 11.1159 9.35119 10.2681 9.97631 9.64298C10.6014 9.01786 11.4493 8.66667 12.3333 8.66667C13.2174 8.66667 14.0652 9.01786 14.6904 9.64298C15.3155 10.2681 15.6667 11.1159 15.6667 12C15.6667 12.8841 15.3155 13.7319 14.6904 14.357C14.0652 14.9821 13.2174 15.3333 12.3333 15.3333ZM12.3333 7C9 7 6.15333 9.07333 5 12C6.15333 14.9267 9 17 12.3333 17C15.6667 17 18.5133 14.9267 19.6667 12C18.5133 9.07333 15.6667 7 12.3333 7Z",fill:"#808080"})],-1)),lu=[hu],cu=["onClick"],uu=Et(()=>_("svg",{viewBox:"0 0 25 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[_("path",{d:"M7.5 21C6.95 21 6.47933 20.8043 6.088 20.413C5.696 20.021 5.5 19.55 5.5 19V6H4.5V4H9.5V3H15.5V4H20.5V6H19.5V19C19.5 19.55 19.3043 20.021 18.913 20.413C18.521 20.8043 18.05 21 17.5 21H7.5ZM9.5 17H11.5V8H9.5V17ZM13.5 17H15.5V8H13.5V17Z",fill:"#808080"})],-1)),du=[uu];function fu(e,t,i,s,n,r){return O(),A("div",jc,[_("div",Vc,[Bc,_("div",{class:"closeBtn position-absolute col-auto",onClick:t[0]||(t[0]=$((...a)=>s.props.onClose&&s.props.onClose(...a),["prevent"]))},zc)]),Uc,_("div",qc,[_("div",Wc,[_("a",{href:"",class:vt(["d-flex align-items-center text-decoration-none me-4",{lockUp:s.props.selectLock,unlock:!s.props.selectLock}]),onClick:t[1]||(t[1]=$(()=>{s.props.onLockLayer()},["prevent"]))},[Hc,Te(" 鎖定圖層 ")],2),_("a",{href:"",class:vt(["d-flex align-items-center text-decoration-none",{disabled:s.props.currentLayers.length<=1}]),onClick:t[2]||(t[2]=$(()=>{s.props.currentLayers.length>0&&s.props.onDeleteLayer({action:"selectLayerMode",value:{layerName:"all"}})},["prevent"]))},[Kc,Te(" 全部刪除 ")],2)]),_("ul",Xc,[(O(!0),A(Nt,null,kt(s.props.currentLayers,(a,o)=>(O(),A("li",null,[a.id?(O(),A("div",Yc,[_("div",null,W(a==null?void 0:a.label),1),_("div",Zc,[_("a",{href:"",onClick:$(h=>s.props.onLayerControl({action:"setOpacity",value:{key:o}}),["prevent"])},tu,8,Qc),_("a",{href:"",onClick:$(h=>s.props.onLayerControl({action:"changeOrder",value:{movement:"up",id:a.id,key:o}}),["prevent"])},su,8,eu),_("a",{href:"",onClick:$(h=>s.props.onLayerControl({action:"changeOrder",value:{movement:"down",id:a.id,key:o}}),["prevent"])},au,8,nu),_("a",{href:"",class:vt({Invisible:!(a!=null&&a.visible)}),onClick:$(()=>{s.props.onLayerControl({action:"changeLayerVisible",value:{key:o}})},["prevent"])},lu,10,ou),_("a",{href:"",onClick:$(h=>s.props.onDeleteLayer({action:"selectLayerMode",value:{id:a==null?void 0:a.id}}),["prevent"])},du,8,cu)])])):K("",!0)]))),256))])])])}const gu=Ot(Gc,[["render",fu],["__scopeId","data-v-a9f89f73"]]),mu={SELECT:"select"};class yu extends Ba{constructor(t,i,s,n){super(t),this.selected=i,this.deselected=s,this.mapBrowserEvent=n}}const Qe={};class is extends ka{constructor(t){super(),this.on,this.once,this.un,t=t||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=t.condition?t.condition:Da,this.addCondition_=t.addCondition?t.addCondition:ps,this.removeCondition_=t.removeCondition?t.removeCondition:ps,this.toggleCondition_=t.toggleCondition?t.toggleCondition:Ga,this.multi_=t.multi?t.multi:!1,this.filter_=t.filter?t.filter:vs,this.hitTolerance_=t.hitTolerance?t.hitTolerance:0,this.style_=t.style!==void 0?t.style:_u(),this.features_=t.features||new ja;let i;if(t.layers)if(typeof t.layers=="function")i=t.layers;else{const s=t.layers;i=function(n){return s.includes(n)}}else i=vs;this.layerFilter_=i,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(t,i){this.featureLayerAssociation_[Z(t)]=i}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(t){return this.featureLayerAssociation_[Z(t)]}setHitTolerance(t){this.hitTolerance_=t}setMap(t){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(t),t?(this.features_.addEventListener(We.ADD,this.boundAddFeature_),this.features_.addEventListener(We.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(We.ADD,this.boundAddFeature_),this.features_.removeEventListener(We.REMOVE,this.boundRemoveFeature_))}addFeature_(t){const i=t.element;if(this.style_&&this.applySelectedStyle_(i),!this.getLayer(i)){const s=this.getMap().getAllLayers().find(function(n){if(n instanceof de&&n.getSource()&&n.getSource().hasFeature(i))return n});s&&this.addFeatureLayerAssociation_(i,s)}}removeFeature_(t){this.style_&&this.restorePreviousStyle_(t.element)}getStyle(){return this.style_}applySelectedStyle_(t){const i=Z(t);i in Qe||(Qe[i]=t.getStyle()),t.setStyle(this.style_)}restorePreviousStyle_(t){const i=this.getMap().getInteractions().getArray();for(let n=i.length-1;n>=0;--n){const r=i[n];if(r!==this&&r instanceof is&&r.getStyle()&&r.getFeatures().getArray().lastIndexOf(t)!==-1){t.setStyle(r.getStyle());return}}const s=Z(t);t.setStyle(Qe[s]),delete Qe[s]}removeFeatureLayerAssociation_(t){delete this.featureLayerAssociation_[Z(t)]}handleEvent(t){if(!this.condition_(t))return!0;const i=this.addCondition_(t),s=this.removeCondition_(t),n=this.toggleCondition_(t),r=!i&&!s&&!n,a=t.map,o=this.getFeatures(),h=[],l=[];if(r){Va(this.featureLayerAssociation_),a.forEachFeatureAtPixel(t.pixel,(c,u)=>{if(!(!(c instanceof Ee)||!this.filter_(c,u)))return this.addFeatureLayerAssociation_(c,u),l.push(c),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let c=o.getLength()-1;c>=0;--c){const u=o.item(c),d=l.indexOf(u);d>-1?l.splice(d,1):(o.remove(u),h.push(u))}l.length!==0&&o.extend(l)}else{a.forEachFeatureAtPixel(t.pixel,(c,u)=>{if(!(!(c instanceof Ee)||!this.filter_(c,u)))return(i||n)&&!o.getArray().includes(c)?(this.addFeatureLayerAssociation_(c,u),l.push(c)):(s||n)&&o.getArray().includes(c)&&(h.push(c),this.removeFeatureLayerAssociation_(c)),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let c=h.length-1;c>=0;--c)o.remove(h[c]);o.extend(l)}return(l.length>0||h.length>0)&&this.dispatchEvent(new yu(mu.SELECT,l,h,t)),!0}}function _u(){const e=oo();return bt(e.Polygon,e.LineString),bt(e.GeometryCollection,e.LineString),function(t){return t.getGeometry()?e[t.getGeometry().getType()]:null}}const pu=is;function vu(e){e("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),e("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),e("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),e.WGS84=e["EPSG:4326"],e["EPSG:3785"]=e["EPSG:3857"],e.GOOGLE=e["EPSG:3857"],e["EPSG:900913"]=e["EPSG:3857"],e["EPSG:102113"]=e["EPSG:3857"]}var Kt=1,Xt=2,he=3,Cu=4,zi=5,Bs=6378137,Mu=6356752314e-3,$s=.0066943799901413165,we=484813681109536e-20,S=Math.PI/2,xu=.16666666666666666,bu=.04722222222222222,wu=.022156084656084655,E=1e-10,tt=.017453292519943295,xt=57.29577951308232,j=Math.PI/4,Pe=Math.PI*2,H=3.14159265359,ft={};ft.greenwich=0;ft.lisbon=-9.131906111111;ft.paris=2.337229166667;ft.bogota=-74.080916666667;ft.madrid=-3.687938888889;ft.rome=12.452333333333;ft.bern=7.439583333333;ft.jakarta=106.807719444444;ft.ferro=-17.666666666667;ft.brussels=4.367975;ft.stockholm=18.058277777778;ft.athens=23.7163375;ft.oslo=10.722916666667;const Su={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var zs=/[\s_\-\/\(\)]/g;function Vt(e,t){if(e[t])return e[t];for(var i=Object.keys(e),s=t.toLowerCase().replace(zs,""),n=-1,r,a;++n<i.length;)if(r=i[n],a=r.toLowerCase().replace(zs,""),a===s)return e[r]}function Ui(e){var t={},i=e.split("+").map(function(o){return o.trim()}).filter(function(o){return o}).reduce(function(o,h){var l=h.split("=");return l.push(!0),o[l[0].toLowerCase()]=l[1],o},{}),s,n,r,a={proj:"projName",datum:"datumCode",rf:function(o){t.rf=parseFloat(o)},lat_0:function(o){t.lat0=o*tt},lat_1:function(o){t.lat1=o*tt},lat_2:function(o){t.lat2=o*tt},lat_ts:function(o){t.lat_ts=o*tt},lon_0:function(o){t.long0=o*tt},lon_1:function(o){t.long1=o*tt},lon_2:function(o){t.long2=o*tt},alpha:function(o){t.alpha=parseFloat(o)*tt},gamma:function(o){t.rectified_grid_angle=parseFloat(o)},lonc:function(o){t.longc=o*tt},x_0:function(o){t.x0=parseFloat(o)},y_0:function(o){t.y0=parseFloat(o)},k_0:function(o){t.k0=parseFloat(o)},k:function(o){t.k0=parseFloat(o)},a:function(o){t.a=parseFloat(o)},b:function(o){t.b=parseFloat(o)},r_a:function(){t.R_A=!0},zone:function(o){t.zone=parseInt(o,10)},south:function(){t.utmSouth=!0},towgs84:function(o){t.datum_params=o.split(",").map(function(h){return parseFloat(h)})},to_meter:function(o){t.to_meter=parseFloat(o)},units:function(o){t.units=o;var h=Vt(Su,o);h&&(t.to_meter=h.to_meter)},from_greenwich:function(o){t.from_greenwich=o*tt},pm:function(o){var h=Vt(ft,o);t.from_greenwich=(h||parseFloat(o))*tt},nadgrids:function(o){o==="@null"?t.datumCode="none":t.nadgrids=o},axis:function(o){var h="ewnsud";o.length===3&&h.indexOf(o.substr(0,1))!==-1&&h.indexOf(o.substr(1,1))!==-1&&h.indexOf(o.substr(2,1))!==-1&&(t.axis=o)},approx:function(){t.approx=!0}};for(s in i)n=i[s],s in a?(r=a[s],typeof r=="function"?r(n):t[r]=n):t[s]=n;return typeof t.datumCode=="string"&&t.datumCode!=="WGS84"&&(t.datumCode=t.datumCode.toLowerCase()),t}var Re=1,Xn=2,Yn=3,pi=4,Zn=5,ss=-1,Tu=/\s/,Eu=/[A-Za-z]/,Lu=/[A-Za-z84_]/,Si=/[,\]]/,Qn=/[\d\.E\-\+]/;function At(e){if(typeof e!="string")throw new Error("not a string");this.text=e.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=Re}At.prototype.readCharicter=function(){var e=this.text[this.place++];if(this.state!==pi)for(;Tu.test(e);){if(this.place>=this.text.length)return;e=this.text[this.place++]}switch(this.state){case Re:return this.neutral(e);case Xn:return this.keyword(e);case pi:return this.quoted(e);case Zn:return this.afterquote(e);case Yn:return this.number(e);case ss:return}};At.prototype.afterquote=function(e){if(e==='"'){this.word+='"',this.state=pi;return}if(Si.test(e)){this.word=this.word.trim(),this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in afterquote yet, index '+this.place)};At.prototype.afterItem=function(e){if(e===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=Re;return}if(e==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=Re,this.currentObject=this.stack.pop(),this.currentObject||(this.state=ss);return}};At.prototype.number=function(e){if(Qn.test(e)){this.word+=e;return}if(Si.test(e)){this.word=parseFloat(this.word),this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in number yet, index '+this.place)};At.prototype.quoted=function(e){if(e==='"'){this.state=Zn;return}this.word+=e};At.prototype.keyword=function(e){if(Lu.test(e)){this.word+=e;return}if(e==="["){var t=[];t.push(this.word),this.level++,this.root===null?this.root=t:this.currentObject.push(t),this.stack.push(this.currentObject),this.currentObject=t,this.state=Re;return}if(Si.test(e)){this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in keyword yet, index '+this.place)};At.prototype.neutral=function(e){if(Eu.test(e)){this.word=e,this.state=Xn;return}if(e==='"'){this.word="",this.state=pi;return}if(Qn.test(e)){this.word=e,this.state=Yn;return}if(Si.test(e)){this.afterItem(e);return}throw new Error(`havn't handled "`+e+'" in neutral yet, index '+this.place)};At.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===ss)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function Pu(e){var t=new At(e);return t.output()}function Us(e,t,i){Array.isArray(t)&&(i.unshift(t),t=null);var s=t?{}:e,n=i.reduce(function(r,a){return ee(a,r),r},s);t&&(e[t]=n)}function ee(e,t){if(!Array.isArray(e)){t[e]=!0;return}var i=e.shift();if(i==="PARAMETER"&&(i=e.shift()),e.length===1){if(Array.isArray(e[0])){t[i]={},ee(e[0],t[i]);return}t[i]=e[0];return}if(!e.length){t[i]=!0;return}if(i==="TOWGS84"){t[i]=e;return}if(i==="AXIS"){i in t||(t[i]=[]),t[i].push(e);return}Array.isArray(i)||(t[i]={});var s;switch(i){case"UNIT":case"PRIMEM":case"VERT_DATUM":t[i]={name:e[0].toLowerCase(),convert:e[1]},e.length===3&&ee(e[2],t[i]);return;case"SPHEROID":case"ELLIPSOID":t[i]={name:e[0],a:e[1],rf:e[2]},e.length===4&&ee(e[3],t[i]);return;case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":e[0]=["name",e[0]],Us(t,i,e);return;default:for(s=-1;++s<e.length;)if(!Array.isArray(e[s]))return ee(e,t[i]);return Us(t,i,e)}}var Ru=.017453292519943295;function Ou(e,t){var i=t[0],s=t[1];!(i in e)&&s in e&&(e[i]=e[s],t.length===3&&(e[i]=t[2](e[i])))}function Mt(e){return e*Ru}function Au(e){if(e.type==="GEOGCS"?e.projName="longlat":e.type==="LOCAL_CS"?(e.projName="identity",e.local=!0):typeof e.PROJECTION=="object"?e.projName=Object.keys(e.PROJECTION)[0]:e.projName=e.PROJECTION,e.AXIS){for(var t="",i=0,s=e.AXIS.length;i<s;++i){var n=[e.AXIS[i][0].toLowerCase(),e.AXIS[i][1].toLowerCase()];n[0].indexOf("north")!==-1||(n[0]==="y"||n[0]==="lat")&&n[1]==="north"?t+="n":n[0].indexOf("south")!==-1||(n[0]==="y"||n[0]==="lat")&&n[1]==="south"?t+="s":n[0].indexOf("east")!==-1||(n[0]==="x"||n[0]==="lon")&&n[1]==="east"?t+="e":(n[0].indexOf("west")!==-1||(n[0]==="x"||n[0]==="lon")&&n[1]==="west")&&(t+="w")}t.length===2&&(t+="u"),t.length===3&&(e.axis=t)}e.UNIT&&(e.units=e.UNIT.name.toLowerCase(),e.units==="metre"&&(e.units="meter"),e.UNIT.convert&&(e.type==="GEOGCS"?e.DATUM&&e.DATUM.SPHEROID&&(e.to_meter=e.UNIT.convert*e.DATUM.SPHEROID.a):e.to_meter=e.UNIT.convert));var r=e.GEOGCS;e.type==="GEOGCS"&&(r=e),r&&(r.DATUM?e.datumCode=r.DATUM.name.toLowerCase():e.datumCode=r.name.toLowerCase(),e.datumCode.slice(0,2)==="d_"&&(e.datumCode=e.datumCode.slice(2)),(e.datumCode==="new_zealand_geodetic_datum_1949"||e.datumCode==="new_zealand_1949")&&(e.datumCode="nzgd49"),(e.datumCode==="wgs_1984"||e.datumCode==="world_geodetic_system_1984")&&(e.PROJECTION==="Mercator_Auxiliary_Sphere"&&(e.sphere=!0),e.datumCode="wgs84"),e.datumCode.slice(-6)==="_ferro"&&(e.datumCode=e.datumCode.slice(0,-6)),e.datumCode.slice(-8)==="_jakarta"&&(e.datumCode=e.datumCode.slice(0,-8)),~e.datumCode.indexOf("belge")&&(e.datumCode="rnb72"),r.DATUM&&r.DATUM.SPHEROID&&(e.ellps=r.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),e.ellps.toLowerCase().slice(0,13)==="international"&&(e.ellps="intl"),e.a=r.DATUM.SPHEROID.a,e.rf=parseFloat(r.DATUM.SPHEROID.rf,10)),r.DATUM&&r.DATUM.TOWGS84&&(e.datum_params=r.DATUM.TOWGS84),~e.datumCode.indexOf("osgb_1936")&&(e.datumCode="osgb36"),~e.datumCode.indexOf("osni_1952")&&(e.datumCode="osni52"),(~e.datumCode.indexOf("tm65")||~e.datumCode.indexOf("geodetic_datum_of_1965"))&&(e.datumCode="ire65"),e.datumCode==="ch1903+"&&(e.datumCode="ch1903"),~e.datumCode.indexOf("israel")&&(e.datumCode="isr93")),e.b&&!isFinite(e.b)&&(e.b=e.a);function a(l){var c=e.to_meter||1;return l*c}var o=function(l){return Ou(e,l)},h=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Mt],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Mt],["x0","false_easting",a],["y0","false_northing",a],["long0","central_meridian",Mt],["lat0","latitude_of_origin",Mt],["lat0","standard_parallel_1",Mt],["lat1","standard_parallel_1",Mt],["lat2","standard_parallel_2",Mt],["azimuth","Azimuth"],["alpha","azimuth",Mt],["srsCode","name"]];h.forEach(o),!e.long0&&e.longc&&(e.projName==="Albers_Conic_Equal_Area"||e.projName==="Lambert_Azimuthal_Equal_Area")&&(e.long0=e.longc),!e.lat_ts&&e.lat1&&(e.projName==="Stereographic_South_Pole"||e.projName==="Polar Stereographic (variant B)")?(e.lat0=Mt(e.lat1>0?90:-90),e.lat_ts=e.lat1):!e.lat_ts&&e.lat0&&e.projName==="Polar_Stereographic"&&(e.lat_ts=e.lat0,e.lat0=Mt(e.lat0>0?90:-90))}function Jn(e){var t=Pu(e),i=t.shift(),s=t.shift();t.unshift(["name",s]),t.unshift(["type",i]);var n={};return ee(t,n),Au(n),n}function rt(e){var t=this;if(arguments.length===2){var i=arguments[1];typeof i=="string"?i.charAt(0)==="+"?rt[e]=Ui(arguments[1]):rt[e]=Jn(arguments[1]):rt[e]=i}else if(arguments.length===1){if(Array.isArray(e))return e.map(function(s){Array.isArray(s)?rt.apply(t,s):rt(s)});if(typeof e=="string"){if(e in rt)return rt[e]}else"EPSG"in e?rt["EPSG:"+e.EPSG]=e:"ESRI"in e?rt["ESRI:"+e.ESRI]=e:"IAU2000"in e?rt["IAU2000:"+e.IAU2000]=e:console.log(e);return}}vu(rt);function Fu(e){return typeof e=="string"}function Iu(e){return e in rt}var Nu=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function ku(e){return Nu.some(function(t){return e.indexOf(t)>-1})}var Du=["3857","900913","3785","102113"];function Gu(e){var t=Vt(e,"authority");if(t){var i=Vt(t,"epsg");return i&&Du.indexOf(i)>-1}}function ju(e){var t=Vt(e,"extension");if(t)return Vt(t,"proj4")}function Vu(e){return e[0]==="+"}function Bu(e){if(Fu(e)){if(Iu(e))return rt[e];if(ku(e)){var t=Jn(e);if(Gu(t))return rt["EPSG:3857"];var i=ju(t);return i?Ui(i):t}if(Vu(e))return Ui(e)}else return e}function qs(e,t){e=e||{};var i,s;if(!t)return e;for(s in t)i=t[s],i!==void 0&&(e[s]=i);return e}function St(e,t,i){var s=e*t;return i/Math.sqrt(1-s*s)}function Ge(e){return e<0?-1:1}function P(e){return Math.abs(e)<=H?e:e-Ge(e)*Pe}function Ct(e,t,i){var s=e*i,n=.5*e;return s=Math.pow((1-s)/(1+s),n),Math.tan(.5*(S-t))/s}function Oe(e,t){for(var i=.5*e,s,n,r=S-2*Math.atan(t),a=0;a<=15;a++)if(s=e*Math.sin(r),n=S-2*Math.atan(t*Math.pow((1-s)/(1+s),i))-r,r+=n,Math.abs(n)<=1e-10)return r;return-9999}function $u(){var e=this.b/this.a;this.es=1-e*e,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=St(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function zu(e){var t=e.x,i=e.y;if(i*xt>90&&i*xt<-90&&t*xt>180&&t*xt<-180)return null;var s,n;if(Math.abs(Math.abs(i)-S)<=E)return null;if(this.sphere)s=this.x0+this.a*this.k0*P(t-this.long0),n=this.y0+this.a*this.k0*Math.log(Math.tan(j+.5*i));else{var r=Math.sin(i),a=Ct(this.e,i,r);s=this.x0+this.a*this.k0*P(t-this.long0),n=this.y0-this.a*this.k0*Math.log(a)}return e.x=s,e.y=n,e}function Uu(e){var t=e.x-this.x0,i=e.y-this.y0,s,n;if(this.sphere)n=S-2*Math.atan(Math.exp(-i/(this.a*this.k0)));else{var r=Math.exp(-i/(this.a*this.k0));if(n=Oe(this.e,r),n===-9999)return null}return s=P(this.long0+t/(this.a*this.k0)),e.x=s,e.y=n,e}var qu=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];const Wu={init:$u,forward:zu,inverse:Uu,names:qu};function Hu(){}function Ws(e){return e}var Ku=["longlat","identity"];const Xu={init:Hu,forward:Ws,inverse:Ws,names:Ku};var Yu=[Wu,Xu],ni={},vi=[];function tr(e,t){var i=vi.length;return e.names?(vi[i]=e,e.names.forEach(function(s){ni[s.toLowerCase()]=i}),this):(console.log(t),!0)}function Zu(e){if(!e)return!1;var t=e.toLowerCase();if(typeof ni[t]<"u"&&vi[ni[t]])return vi[ni[t]]}function Qu(){Yu.forEach(tr)}const Ju={start:Qu,add:tr,get:Zu};var F={};F.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};F.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};F.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};F.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};F.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};F.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};F.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};F.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};F.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};F.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};F.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};F.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};F.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};F.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};F.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};F.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"};F.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};F.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};F.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};F.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};F.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};F.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};F.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};F.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};F.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};F.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};F.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};F.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};F.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};F.hough={a:6378270,rf:297,ellipseName:"Hough"};F.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};F.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};F.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};F.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};F.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};F.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};F.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};F.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};F.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};F.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};F.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};F.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var td=F.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};F.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function ed(e,t,i,s){var n=e*e,r=t*t,a=(n-r)/n,o=0;s?(e*=1-a*(xu+a*(bu+a*wu)),n=e*e,a=0):o=Math.sqrt(a);var h=(n-r)/r;return{es:a,e:o,ep2:h}}function id(e,t,i,s,n){if(!e){var r=Vt(F,s);r||(r=td),e=r.a,t=r.b,i=r.rf}return i&&!t&&(t=(1-1/i)*e),(i===0||Math.abs(e-t)<E)&&(n=!0,t=e),{a:e,b:t,rf:i,sphere:n}}var J={};J.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"};J.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"};J.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"};J.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"};J.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"};J.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"};J.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"};J.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"};J.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"};J.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"};J.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"};J.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"};J.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"};J.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"};J.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"};J.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"};J.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};function sd(e,t,i,s,n,r,a){var o={};return e===void 0||e==="none"?o.datum_type=zi:o.datum_type=Cu,t&&(o.datum_params=t.map(parseFloat),(o.datum_params[0]!==0||o.datum_params[1]!==0||o.datum_params[2]!==0)&&(o.datum_type=Kt),o.datum_params.length>3&&(o.datum_params[3]!==0||o.datum_params[4]!==0||o.datum_params[5]!==0||o.datum_params[6]!==0)&&(o.datum_type=Xt,o.datum_params[3]*=we,o.datum_params[4]*=we,o.datum_params[5]*=we,o.datum_params[6]=o.datum_params[6]/1e6+1)),a&&(o.datum_type=he,o.grids=a),o.a=i,o.b=s,o.es=n,o.ep2=r,o}var er={};function nd(e,t){var i=new DataView(t),s=od(i),n=hd(i,s);n.nSubgrids>1&&console.log("Only single NTv2 subgrids are currently supported, subsequent sub grids are ignored");var r=ld(i,n,s),a={header:n,subgrids:r};return er[e]=a,a}function rd(e){if(e===void 0)return null;var t=e.split(",");return t.map(ad)}function ad(e){if(e.length===0)return null;var t=e[0]==="@";return t&&(e=e.slice(1)),e==="null"?{name:"null",mandatory:!t,grid:null,isNull:!0}:{name:e,mandatory:!t,grid:er[e]||null,isNull:!1}}function ie(e){return e/3600*Math.PI/180}function od(e){var t=e.getInt32(8,!1);return t===11?!1:(t=e.getInt32(8,!0),t!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function hd(e,t){return{nFields:e.getInt32(8,t),nSubgridFields:e.getInt32(24,t),nSubgrids:e.getInt32(40,t),shiftType:qi(e,56,56+8).trim(),fromSemiMajorAxis:e.getFloat64(120,t),fromSemiMinorAxis:e.getFloat64(136,t),toSemiMajorAxis:e.getFloat64(152,t),toSemiMinorAxis:e.getFloat64(168,t)}}function qi(e,t,i){return String.fromCharCode.apply(null,new Uint8Array(e.buffer.slice(t,i)))}function ld(e,t,i){for(var s=176,n=[],r=0;r<t.nSubgrids;r++){var a=ud(e,s,i),o=dd(e,s,a,i),h=Math.round(1+(a.upperLongitude-a.lowerLongitude)/a.longitudeInterval),l=Math.round(1+(a.upperLatitude-a.lowerLatitude)/a.latitudeInterval);n.push({ll:[ie(a.lowerLongitude),ie(a.lowerLatitude)],del:[ie(a.longitudeInterval),ie(a.latitudeInterval)],lim:[h,l],count:a.gridNodeCount,cvs:cd(o)})}return n}function cd(e){return e.map(function(t){return[ie(t.longitudeShift),ie(t.latitudeShift)]})}function ud(e,t,i){return{name:qi(e,t+8,t+16).trim(),parent:qi(e,t+24,t+24+8).trim(),lowerLatitude:e.getFloat64(t+72,i),upperLatitude:e.getFloat64(t+88,i),lowerLongitude:e.getFloat64(t+104,i),upperLongitude:e.getFloat64(t+120,i),latitudeInterval:e.getFloat64(t+136,i),longitudeInterval:e.getFloat64(t+152,i),gridNodeCount:e.getInt32(t+168,i)}}function dd(e,t,i,s){for(var n=t+176,r=16,a=[],o=0;o<i.gridNodeCount;o++){var h={latitudeShift:e.getFloat32(n+o*r,s),longitudeShift:e.getFloat32(n+o*r+4,s),latitudeAccuracy:e.getFloat32(n+o*r+8,s),longitudeAccuracy:e.getFloat32(n+o*r+12,s)};a.push(h)}return a}function wt(e,t){if(!(this instanceof wt))return new wt(e);t=t||function(l){if(l)throw l};var i=Bu(e);if(typeof i!="object"){t(e);return}var s=wt.projections.get(i.projName);if(!s){t(e);return}if(i.datumCode&&i.datumCode!=="none"){var n=Vt(J,i.datumCode);n&&(i.datum_params=i.datum_params||(n.towgs84?n.towgs84.split(","):null),i.ellps=n.ellipse,i.datumName=n.datumName?n.datumName:i.datumCode)}i.k0=i.k0||1,i.axis=i.axis||"enu",i.ellps=i.ellps||"wgs84",i.lat1=i.lat1||i.lat0;var r=id(i.a,i.b,i.rf,i.ellps,i.sphere),a=ed(r.a,r.b,r.rf,i.R_A),o=rd(i.nadgrids),h=i.datum||sd(i.datumCode,i.datum_params,r.a,r.b,a.es,a.ep2,o);qs(this,i),qs(this,s),this.a=r.a,this.b=r.b,this.rf=r.rf,this.sphere=r.sphere,this.es=a.es,this.e=a.e,this.ep2=a.ep2,this.datum=h,this.init(),t(null,this)}wt.projections=Ju;wt.projections.start();function fd(e,t){return e.datum_type!==t.datum_type||e.a!==t.a||Math.abs(e.es-t.es)>5e-11?!1:e.datum_type===Kt?e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]:e.datum_type===Xt?e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]&&e.datum_params[3]===t.datum_params[3]&&e.datum_params[4]===t.datum_params[4]&&e.datum_params[5]===t.datum_params[5]&&e.datum_params[6]===t.datum_params[6]:!0}function ir(e,t,i){var s=e.x,n=e.y,r=e.z?e.z:0,a,o,h,l;if(n<-S&&n>-1.001*S)n=-S;else if(n>S&&n<1.001*S)n=S;else{if(n<-S)return{x:-1/0,y:-1/0,z:e.z};if(n>S)return{x:1/0,y:1/0,z:e.z}}return s>Math.PI&&(s-=2*Math.PI),o=Math.sin(n),l=Math.cos(n),h=o*o,a=i/Math.sqrt(1-t*h),{x:(a+r)*l*Math.cos(s),y:(a+r)*l*Math.sin(s),z:(a*(1-t)+r)*o}}function sr(e,t,i,s){var n=1e-12,r=n*n,a=30,o,h,l,c,u,d,f,g,y,m,p,x,b,M=e.x,v=e.y,w=e.z?e.z:0,C,T,L;if(o=Math.sqrt(M*M+v*v),h=Math.sqrt(M*M+v*v+w*w),o/i<n){if(C=0,h/i<n)return T=S,L=-s,{x:e.x,y:e.y,z:e.z}}else C=Math.atan2(v,M);l=w/h,c=o/h,u=1/Math.sqrt(1-t*(2-t)*c*c),g=c*(1-t)*u,y=l*u,b=0;do b++,f=i/Math.sqrt(1-t*y*y),L=o*g+w*y-f*(1-t*y*y),d=t*f/(f+L),u=1/Math.sqrt(1-d*(2-d)*c*c),m=c*(1-d)*u,p=l*u,x=p*g-m*y,g=m,y=p;while(x*x>r&&b<a);return T=Math.atan(p/Math.abs(m)),{x:C,y:T,z:L}}function gd(e,t,i){if(t===Kt)return{x:e.x+i[0],y:e.y+i[1],z:e.z+i[2]};if(t===Xt){var s=i[0],n=i[1],r=i[2],a=i[3],o=i[4],h=i[5],l=i[6];return{x:l*(e.x-h*e.y+o*e.z)+s,y:l*(h*e.x+e.y-a*e.z)+n,z:l*(-o*e.x+a*e.y+e.z)+r}}}function md(e,t,i){if(t===Kt)return{x:e.x-i[0],y:e.y-i[1],z:e.z-i[2]};if(t===Xt){var s=i[0],n=i[1],r=i[2],a=i[3],o=i[4],h=i[5],l=i[6],c=(e.x-s)/l,u=(e.y-n)/l,d=(e.z-r)/l;return{x:c+h*u-o*d,y:-h*c+u+a*d,z:o*c-a*u+d}}}function Je(e){return e===Kt||e===Xt}function yd(e,t,i){if(fd(e,t)||e.datum_type===zi||t.datum_type===zi)return i;var s=e.a,n=e.es;if(e.datum_type===he){var r=Hs(e,!1,i);if(r!==0)return;s=Bs,n=$s}var a=t.a,o=t.b,h=t.es;if(t.datum_type===he&&(a=Bs,o=Mu,h=$s),n===h&&s===a&&!Je(e.datum_type)&&!Je(t.datum_type))return i;if(i=ir(i,n,s),Je(e.datum_type)&&(i=gd(i,e.datum_type,e.datum_params)),Je(t.datum_type)&&(i=md(i,t.datum_type,t.datum_params)),i=sr(i,h,a,o),t.datum_type===he){var l=Hs(t,!0,i);if(l!==0)return}return i}function Hs(e,t,i){if(e.grids===null||e.grids.length===0)return console.log("Grid shift grids not found"),-1;for(var s={x:-i.x,y:i.y},n={x:Number.NaN,y:Number.NaN},r=[],a=0;a<e.grids.length;a++){var o=e.grids[a];if(r.push(o.name),o.isNull){n=s;break}if(o.mandatory,o.grid===null){if(o.mandatory)return console.log("Unable to find mandatory grid '"+o.name+"'"),-1;continue}var h=o.grid.subgrids[0],l=(Math.abs(h.del[1])+Math.abs(h.del[0]))/1e4,c=h.ll[0]-l,u=h.ll[1]-l,d=h.ll[0]+(h.lim[0]-1)*h.del[0]+l,f=h.ll[1]+(h.lim[1]-1)*h.del[1]+l;if(!(u>s.y||c>s.x||f<s.y||d<s.x)&&(n=_d(s,t,h),!isNaN(n.x)))break}return isNaN(n.x)?(console.log("Failed to find a grid shift table for location '"+-s.x*xt+" "+s.y*xt+" tried: '"+r+"'"),-1):(i.x=-n.x,i.y=n.y,0)}function _d(e,t,i){var s={x:Number.NaN,y:Number.NaN};if(isNaN(e.x))return s;var n={x:e.x,y:e.y};n.x-=i.ll[0],n.y-=i.ll[1],n.x=P(n.x-Math.PI)+Math.PI;var r=Ks(n,i);if(t){if(isNaN(r.x))return s;r.x=n.x-r.x,r.y=n.y-r.y;var a=9,o=1e-12,h,l;do{if(l=Ks(r,i),isNaN(l.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}h={x:n.x-(l.x+r.x),y:n.y-(l.y+r.y)},r.x+=h.x,r.y+=h.y}while(a--&&Math.abs(h.x)>o&&Math.abs(h.y)>o);if(a<0)return console.log("Inverse grid shift iterator failed to converge."),s;s.x=P(r.x+i.ll[0]),s.y=r.y+i.ll[1]}else isNaN(r.x)||(s.x=e.x+r.x,s.y=e.y+r.y);return s}function Ks(e,t){var i={x:e.x/t.del[0],y:e.y/t.del[1]},s={x:Math.floor(i.x),y:Math.floor(i.y)},n={x:i.x-1*s.x,y:i.y-1*s.y},r={x:Number.NaN,y:Number.NaN},a;if(s.x<0||s.x>=t.lim[0]||s.y<0||s.y>=t.lim[1])return r;a=s.y*t.lim[0]+s.x;var o={x:t.cvs[a][0],y:t.cvs[a][1]};a++;var h={x:t.cvs[a][0],y:t.cvs[a][1]};a+=t.lim[0];var l={x:t.cvs[a][0],y:t.cvs[a][1]};a--;var c={x:t.cvs[a][0],y:t.cvs[a][1]},u=n.x*n.y,d=n.x*(1-n.y),f=(1-n.x)*(1-n.y),g=(1-n.x)*n.y;return r.x=f*o.x+d*h.x+g*c.x+u*l.x,r.y=f*o.y+d*h.y+g*c.y+u*l.y,r}function Xs(e,t,i){var s=i.x,n=i.y,r=i.z||0,a,o,h,l={};for(h=0;h<3;h++)if(!(t&&h===2&&i.z===void 0))switch(h===0?(a=s,"ew".indexOf(e.axis[h])!==-1?o="x":o="y"):h===1?(a=n,"ns".indexOf(e.axis[h])!==-1?o="y":o="x"):(a=r,o="z"),e.axis[h]){case"e":l[o]=a;break;case"w":l[o]=-a;break;case"n":l[o]=a;break;case"s":l[o]=-a;break;case"u":i[o]!==void 0&&(l.z=a);break;case"d":i[o]!==void 0&&(l.z=-a);break;default:return null}return l}function nr(e){var t={x:e[0],y:e[1]};return e.length>2&&(t.z=e[2]),e.length>3&&(t.m=e[3]),t}function pd(e){Ys(e.x),Ys(e.y)}function Ys(e){if(typeof Number.isFinite=="function"){if(Number.isFinite(e))return;throw new TypeError("coordinates must be finite numbers")}if(typeof e!="number"||e!==e||!isFinite(e))throw new TypeError("coordinates must be finite numbers")}function vd(e,t){return(e.datum.datum_type===Kt||e.datum.datum_type===Xt||e.datum.datum_type===he)&&t.datumCode!=="WGS84"||(t.datum.datum_type===Kt||t.datum.datum_type===Xt||t.datum.datum_type===he)&&e.datumCode!=="WGS84"}function Ci(e,t,i,s){var n;Array.isArray(i)?i=nr(i):i={x:i.x,y:i.y,z:i.z,m:i.m};var r=i.z!==void 0;if(pd(i),e.datum&&t.datum&&vd(e,t)&&(n=new wt("WGS84"),i=Ci(e,n,i,s),e=n),s&&e.axis!=="enu"&&(i=Xs(e,!1,i)),e.projName==="longlat")i={x:i.x*tt,y:i.y*tt,z:i.z||0};else if(e.to_meter&&(i={x:i.x*e.to_meter,y:i.y*e.to_meter,z:i.z||0}),i=e.inverse(i),!i)return;if(e.from_greenwich&&(i.x+=e.from_greenwich),i=yd(e.datum,t.datum,i),!!i)return t.from_greenwich&&(i={x:i.x-t.from_greenwich,y:i.y,z:i.z||0}),t.projName==="longlat"?i={x:i.x*xt,y:i.y*xt,z:i.z||0}:(i=t.forward(i),t.to_meter&&(i={x:i.x/t.to_meter,y:i.y/t.to_meter,z:i.z||0})),s&&t.axis!=="enu"?Xs(t,!0,i):(r||delete i.z,i)}var Zs=wt("WGS84");function Ri(e,t,i,s){var n,r,a;return Array.isArray(i)?(n=Ci(e,t,i,s)||{x:NaN,y:NaN},i.length>2?typeof e.name<"u"&&e.name==="geocent"||typeof t.name<"u"&&t.name==="geocent"?typeof n.z=="number"?[n.x,n.y,n.z].concat(i.splice(3)):[n.x,n.y,i[2]].concat(i.splice(3)):[n.x,n.y].concat(i.splice(2)):[n.x,n.y]):(r=Ci(e,t,i,s),a=Object.keys(i),a.length===2||a.forEach(function(o){if(typeof e.name<"u"&&e.name==="geocent"||typeof t.name<"u"&&t.name==="geocent"){if(o==="x"||o==="y"||o==="z")return}else if(o==="x"||o==="y")return;r[o]=i[o]}),r)}function Qs(e){return e instanceof wt?e:e.oProj?e.oProj:wt(e)}function dt(e,t,i){e=Qs(e);var s=!1,n;return typeof t>"u"?(t=e,e=Zs,s=!0):(typeof t.x<"u"||Array.isArray(t))&&(i=t,t=e,e=Zs,s=!0),t=Qs(t),i?Ri(e,t,i):(n={forward:function(r,a){return Ri(e,t,r,a)},inverse:function(r,a){return Ri(t,e,r,a)}},s&&(n.oProj=t),n)}var Js=6,rr="AJSAJS",ar="AFAFAF",se=65,ct=73,_t=79,ve=86,Ce=90;const Cd={forward:or,inverse:Md,toPoint:hr};function or(e,t){return t=t||5,wd(xd({lat:e[1],lon:e[0]}),t)}function Md(e){var t=ns(cr(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat,t.lon,t.lat]:[t.left,t.bottom,t.right,t.top]}function hr(e){var t=ns(cr(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function Oi(e){return e*(Math.PI/180)}function tn(e){return 180*(e/Math.PI)}function xd(e){var t=e.lat,i=e.lon,s=6378137,n=.00669438,r=.9996,a,o,h,l,c,u,d,f=Oi(t),g=Oi(i),y,m;m=Math.floor((i+180)/6)+1,i===180&&(m=60),t>=56&&t<64&&i>=3&&i<12&&(m=32),t>=72&&t<84&&(i>=0&&i<9?m=31:i>=9&&i<21?m=33:i>=21&&i<33?m=35:i>=33&&i<42&&(m=37)),a=(m-1)*6-180+3,y=Oi(a),o=n/(1-n),h=s/Math.sqrt(1-n*Math.sin(f)*Math.sin(f)),l=Math.tan(f)*Math.tan(f),c=o*Math.cos(f)*Math.cos(f),u=Math.cos(f)*(g-y),d=s*((1-n/4-3*n*n/64-5*n*n*n/256)*f-(3*n/8+3*n*n/32+45*n*n*n/1024)*Math.sin(2*f)+(15*n*n/256+45*n*n*n/1024)*Math.sin(4*f)-35*n*n*n/3072*Math.sin(6*f));var p=r*h*(u+(1-l+c)*u*u*u/6+(5-18*l+l*l+72*c-58*o)*u*u*u*u*u/120)+5e5,x=r*(d+h*Math.tan(f)*(u*u/2+(5-l+9*c+4*c*c)*u*u*u*u/24+(61-58*l+l*l+600*c-330*o)*u*u*u*u*u*u/720));return t<0&&(x+=1e7),{northing:Math.round(x),easting:Math.round(p),zoneNumber:m,zoneLetter:bd(t)}}function ns(e){var t=e.northing,i=e.easting,s=e.zoneLetter,n=e.zoneNumber;if(n<0||n>60)return null;var r=.9996,a=6378137,o=.00669438,h,l=(1-Math.sqrt(1-o))/(1+Math.sqrt(1-o)),c,u,d,f,g,y,m,p,x,b=i-5e5,M=t;s<"N"&&(M-=1e7),m=(n-1)*6-180+3,h=o/(1-o),y=M/r,p=y/(a*(1-o/4-3*o*o/64-5*o*o*o/256)),x=p+(3*l/2-27*l*l*l/32)*Math.sin(2*p)+(21*l*l/16-55*l*l*l*l/32)*Math.sin(4*p)+151*l*l*l/96*Math.sin(6*p),c=a/Math.sqrt(1-o*Math.sin(x)*Math.sin(x)),u=Math.tan(x)*Math.tan(x),d=h*Math.cos(x)*Math.cos(x),f=a*(1-o)/Math.pow(1-o*Math.sin(x)*Math.sin(x),1.5),g=b/(c*r);var v=x-c*Math.tan(x)/f*(g*g/2-(5+3*u+10*d-4*d*d-9*h)*g*g*g*g/24+(61+90*u+298*d+45*u*u-252*h-3*d*d)*g*g*g*g*g*g/720);v=tn(v);var w=(g-(1+2*u+d)*g*g*g/6+(5-2*d+28*u-3*d*d+8*h+24*u*u)*g*g*g*g*g/120)/Math.cos(x);w=m+tn(w);var C;if(e.accuracy){var T=ns({northing:e.northing+e.accuracy,easting:e.easting+e.accuracy,zoneLetter:e.zoneLetter,zoneNumber:e.zoneNumber});C={top:T.lat,right:T.lon,bottom:v,left:w}}else C={lat:v,lon:w};return C}function bd(e){var t="Z";return 84>=e&&e>=72?t="X":72>e&&e>=64?t="W":64>e&&e>=56?t="V":56>e&&e>=48?t="U":48>e&&e>=40?t="T":40>e&&e>=32?t="S":32>e&&e>=24?t="R":24>e&&e>=16?t="Q":16>e&&e>=8?t="P":8>e&&e>=0?t="N":0>e&&e>=-8?t="M":-8>e&&e>=-16?t="L":-16>e&&e>=-24?t="K":-24>e&&e>=-32?t="J":-32>e&&e>=-40?t="H":-40>e&&e>=-48?t="G":-48>e&&e>=-56?t="F":-56>e&&e>=-64?t="E":-64>e&&e>=-72?t="D":-72>e&&e>=-80&&(t="C"),t}function wd(e,t){var i="00000"+e.easting,s="00000"+e.northing;return e.zoneNumber+e.zoneLetter+Sd(e.easting,e.northing,e.zoneNumber)+i.substr(i.length-5,t)+s.substr(s.length-5,t)}function Sd(e,t,i){var s=lr(i),n=Math.floor(e/1e5),r=Math.floor(t/1e5)%20;return Td(n,r,s)}function lr(e){var t=e%Js;return t===0&&(t=Js),t}function Td(e,t,i){var s=i-1,n=rr.charCodeAt(s),r=ar.charCodeAt(s),a=n+e-1,o=r+t,h=!1;a>Ce&&(a=a-Ce+se-1,h=!0),(a===ct||n<ct&&a>ct||(a>ct||n<ct)&&h)&&a++,(a===_t||n<_t&&a>_t||(a>_t||n<_t)&&h)&&(a++,a===ct&&a++),a>Ce&&(a=a-Ce+se-1),o>ve?(o=o-ve+se-1,h=!0):h=!1,(o===ct||r<ct&&o>ct||(o>ct||r<ct)&&h)&&o++,(o===_t||r<_t&&o>_t||(o>_t||r<_t)&&h)&&(o++,o===ct&&o++),o>ve&&(o=o-ve+se-1);var l=String.fromCharCode(a)+String.fromCharCode(o);return l}function cr(e){if(e&&e.length===0)throw"MGRSPoint coverting from nothing";for(var t=e.length,i=null,s="",n,r=0;!/[A-Z]/.test(n=e.charAt(r));){if(r>=2)throw"MGRSPoint bad conversion from: "+e;s+=n,r++}var a=parseInt(s,10);if(r===0||r+3>t)throw"MGRSPoint bad conversion from: "+e;var o=e.charAt(r++);if(o<="A"||o==="B"||o==="Y"||o>="Z"||o==="I"||o==="O")throw"MGRSPoint zone letter "+o+" not handled: "+e;i=e.substring(r,r+=2);for(var h=lr(a),l=Ed(i.charAt(0),h),c=Ld(i.charAt(1),h);c<Pd(o);)c+=2e6;var u=t-r;if(u%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+e;var d=u/2,f=0,g=0,y,m,p,x,b;return d>0&&(y=1e5/Math.pow(10,d),m=e.substring(r,r+d),f=parseFloat(m)*y,p=e.substring(r+d),g=parseFloat(p)*y),x=f+l,b=g+c,{easting:x,northing:b,zoneLetter:o,zoneNumber:a,accuracy:y}}function Ed(e,t){for(var i=rr.charCodeAt(t-1),s=1e5,n=!1;i!==e.charCodeAt(0);){if(i++,i===ct&&i++,i===_t&&i++,i>Ce){if(n)throw"Bad character: "+e;i=se,n=!0}s+=1e5}return s}function Ld(e,t){if(e>"V")throw"MGRSPoint given invalid Northing "+e;for(var i=ar.charCodeAt(t-1),s=0,n=!1;i!==e.charCodeAt(0);){if(i++,i===ct&&i++,i===_t&&i++,i>ve){if(n)throw"Bad character: "+e;i=se,n=!0}s+=1e5}return s}function Pd(e){var t;switch(e){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+e}function fe(e,t,i){if(!(this instanceof fe))return new fe(e,t,i);if(Array.isArray(e))this.x=e[0],this.y=e[1],this.z=e[2]||0;else if(typeof e=="object")this.x=e.x,this.y=e.y,this.z=e.z||0;else if(typeof e=="string"&&typeof t>"u"){var s=e.split(",");this.x=parseFloat(s[0],10),this.y=parseFloat(s[1],10),this.z=parseFloat(s[2],10)||0}else this.x=e,this.y=t,this.z=i||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}fe.fromMGRS=function(e){return new fe(hr(e))};fe.prototype.toMGRS=function(e){return or([this.x,this.y],e)};var Rd=1,Od=.25,en=.046875,sn=.01953125,nn=.01068115234375,Ad=.75,Fd=.46875,Id=.013020833333333334,Nd=.007120768229166667,kd=.3645833333333333,Dd=.005696614583333333,Gd=.3076171875;function ur(e){var t=[];t[0]=Rd-e*(Od+e*(en+e*(sn+e*nn))),t[1]=e*(Ad-e*(en+e*(sn+e*nn)));var i=e*e;return t[2]=i*(Fd-e*(Id+e*Nd)),i*=e,t[3]=i*(kd-e*Dd),t[4]=i*e*Gd,t}function Ti(e,t,i,s){return i*=t,t*=t,s[0]*e-i*(s[1]+t*(s[2]+t*(s[3]+t*s[4])))}var jd=20;function dr(e,t,i){for(var s=1/(1-t),n=e,r=jd;r;--r){var a=Math.sin(n),o=1-t*a*a;if(o=(Ti(n,a,Math.cos(n),i)-e)*(o*Math.sqrt(o))*s,n-=o,Math.abs(o)<E)return n}return n}function Vd(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=ur(this.es),this.ml0=Ti(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function Bd(e){var t=e.x,i=e.y,s=P(t-this.long0),n,r,a,o=Math.sin(i),h=Math.cos(i);if(this.es){var c=h*s,u=Math.pow(c,2),d=this.ep2*Math.pow(h,2),f=Math.pow(d,2),g=Math.abs(h)>E?Math.tan(i):0,y=Math.pow(g,2),m=Math.pow(y,2);n=1-this.es*Math.pow(o,2),c=c/Math.sqrt(n);var p=Ti(i,o,h,this.en);r=this.a*(this.k0*c*(1+u/6*(1-y+d+u/20*(5-18*y+m+14*d-58*y*d+u/42*(61+179*m-m*y-479*y)))))+this.x0,a=this.a*(this.k0*(p-this.ml0+o*s*c/2*(1+u/12*(5-y+9*d+4*f+u/30*(61+m-58*y+270*d-330*y*d+u/56*(1385+543*m-m*y-3111*y))))))+this.y0}else{var l=h*Math.sin(s);if(Math.abs(Math.abs(l)-1)<E)return 93;if(r=.5*this.a*this.k0*Math.log((1+l)/(1-l))+this.x0,a=h*Math.cos(s)/Math.sqrt(1-Math.pow(l,2)),l=Math.abs(a),l>=1){if(l-1>E)return 93;a=0}else a=Math.acos(a);i<0&&(a=-a),a=this.a*this.k0*(a-this.lat0)+this.y0}return e.x=r,e.y=a,e}function $d(e){var t,i,s,n,r=(e.x-this.x0)*(1/this.a),a=(e.y-this.y0)*(1/this.a);if(this.es)if(t=this.ml0+a/this.k0,i=dr(t,this.es,this.en),Math.abs(i)<S){var u=Math.sin(i),d=Math.cos(i),f=Math.abs(d)>E?Math.tan(i):0,g=this.ep2*Math.pow(d,2),y=Math.pow(g,2),m=Math.pow(f,2),p=Math.pow(m,2);t=1-this.es*Math.pow(u,2);var x=r*Math.sqrt(t)/this.k0,b=Math.pow(x,2);t=t*f,s=i-t*b/(1-this.es)*.5*(1-b/12*(5+3*m-9*g*m+g-4*y-b/30*(61+90*m-252*g*m+45*p+46*g-b/56*(1385+3633*m+4095*p+1574*p*m)))),n=P(this.long0+x*(1-b/6*(1+2*m+g-b/20*(5+28*m+24*p+8*g*m+6*g-b/42*(61+662*m+1320*p+720*p*m))))/d)}else s=S*Ge(a),n=0;else{var o=Math.exp(r/this.k0),h=.5*(o-1/o),l=this.lat0+a/this.k0,c=Math.cos(l);t=Math.sqrt((1-Math.pow(c,2))/(1+Math.pow(h,2))),s=Math.asin(t),a<0&&(s=-s),h===0&&c===0?n=0:n=P(Math.atan2(h,c)+this.long0)}return e.x=n,e.y=s,e}var zd=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const ri={init:Vd,forward:Bd,inverse:$d,names:zd};function fr(e){var t=Math.exp(e);return t=(t-1/t)/2,t}function pt(e,t){e=Math.abs(e),t=Math.abs(t);var i=Math.max(e,t),s=Math.min(e,t)/(i||1);return i*Math.sqrt(1+Math.pow(s,2))}function Ud(e){var t=1+e,i=t-1;return i===0?e:e*Math.log(t)/i}function qd(e){var t=Math.abs(e);return t=Ud(t*(1+t/(pt(1,t)+1))),e<0?-t:t}function rs(e,t){for(var i=2*Math.cos(2*t),s=e.length-1,n=e[s],r=0,a;--s>=0;)a=-r+i*n+e[s],r=n,n=a;return t+a*Math.sin(2*t)}function Wd(e,t){for(var i=2*Math.cos(t),s=e.length-1,n=e[s],r=0,a;--s>=0;)a=-r+i*n+e[s],r=n,n=a;return Math.sin(t)*a}function Hd(e){var t=Math.exp(e);return t=(t+1/t)/2,t}function gr(e,t,i){for(var s=Math.sin(t),n=Math.cos(t),r=fr(i),a=Hd(i),o=2*n*a,h=-2*s*r,l=e.length-1,c=e[l],u=0,d=0,f=0,g,y;--l>=0;)g=d,y=u,d=c,u=f,c=-g+o*d-h*u+e[l],f=-y+h*d+o*u;return o=s*a,h=n*r,[o*c-h*f,o*f+h*c]}function Kd(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(ri.init.apply(this),this.forward=ri.forward,this.inverse=ri.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var e=this.es/(1+Math.sqrt(1-this.es)),t=e/(2-e),i=t;this.cgb[0]=t*(2+t*(-2/3+t*(-2+t*(116/45+t*(26/45+t*(-2854/675)))))),this.cbg[0]=t*(-2+t*(2/3+t*(4/3+t*(-82/45+t*(32/45+t*(4642/4725)))))),i=i*t,this.cgb[1]=i*(7/3+t*(-8/5+t*(-227/45+t*(2704/315+t*(2323/945))))),this.cbg[1]=i*(5/3+t*(-16/15+t*(-13/9+t*(904/315+t*(-1522/945))))),i=i*t,this.cgb[2]=i*(56/15+t*(-136/35+t*(-1262/105+t*(73814/2835)))),this.cbg[2]=i*(-26/15+t*(34/21+t*(8/5+t*(-12686/2835)))),i=i*t,this.cgb[3]=i*(4279/630+t*(-332/35+t*(-399572/14175))),this.cbg[3]=i*(1237/630+t*(-12/5+t*(-24832/14175))),i=i*t,this.cgb[4]=i*(4174/315+t*(-144838/6237)),this.cbg[4]=i*(-734/315+t*(109598/31185)),i=i*t,this.cgb[5]=i*(601676/22275),this.cbg[5]=i*(444337/155925),i=Math.pow(t,2),this.Qn=this.k0/(1+t)*(1+i*(1/4+i*(1/64+i/256))),this.utg[0]=t*(-.5+t*(2/3+t*(-37/96+t*(1/360+t*(81/512+t*(-96199/604800)))))),this.gtu[0]=t*(.5+t*(-2/3+t*(5/16+t*(41/180+t*(-127/288+t*(7891/37800)))))),this.utg[1]=i*(-1/48+t*(-1/15+t*(437/1440+t*(-46/105+t*(1118711/3870720))))),this.gtu[1]=i*(13/48+t*(-3/5+t*(557/1440+t*(281/630+t*(-1983433/1935360))))),i=i*t,this.utg[2]=i*(-17/480+t*(37/840+t*(209/4480+t*(-5569/90720)))),this.gtu[2]=i*(61/240+t*(-103/140+t*(15061/26880+t*(167603/181440)))),i=i*t,this.utg[3]=i*(-4397/161280+t*(11/504+t*(830251/7257600))),this.gtu[3]=i*(49561/161280+t*(-179/168+t*(6601661/7257600))),i=i*t,this.utg[4]=i*(-4583/161280+t*(108847/3991680)),this.gtu[4]=i*(34729/80640+t*(-3418889/1995840)),i=i*t,this.utg[5]=i*(-20648693/638668800),this.gtu[5]=i*(212378941/319334400);var s=rs(this.cbg,this.lat0);this.Zb=-this.Qn*(s+Wd(this.gtu,2*s))}function Xd(e){var t=P(e.x-this.long0),i=e.y;i=rs(this.cbg,i);var s=Math.sin(i),n=Math.cos(i),r=Math.sin(t),a=Math.cos(t);i=Math.atan2(s,a*n),t=Math.atan2(r*n,pt(s,n*a)),t=qd(Math.tan(t));var o=gr(this.gtu,2*i,2*t);i=i+o[0],t=t+o[1];var h,l;return Math.abs(t)<=2.623395162778?(h=this.a*(this.Qn*t)+this.x0,l=this.a*(this.Qn*i+this.Zb)+this.y0):(h=1/0,l=1/0),e.x=h,e.y=l,e}function Yd(e){var t=(e.x-this.x0)*(1/this.a),i=(e.y-this.y0)*(1/this.a);i=(i-this.Zb)/this.Qn,t=t/this.Qn;var s,n;if(Math.abs(t)<=2.623395162778){var r=gr(this.utg,2*i,2*t);i=i+r[0],t=t+r[1],t=Math.atan(fr(t));var a=Math.sin(i),o=Math.cos(i),h=Math.sin(t),l=Math.cos(t);i=Math.atan2(a*l,pt(h,l*o)),t=Math.atan2(h,l*o),s=P(t+this.long0),n=rs(this.cgb,i)}else s=1/0,n=1/0;return e.x=s,e.y=n,e}var Zd=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","tmerc"];const ai={init:Kd,forward:Xd,inverse:Yd,names:Zd};function Qd(e,t){if(e===void 0){if(e=Math.floor((P(t)+Math.PI)*30/Math.PI)+1,e<0)return 0;if(e>60)return 60}return e}var Jd="etmerc";function tf(){var e=Qd(this.zone,this.long0);if(e===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(e)-183)*tt,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,ai.init.apply(this),this.forward=ai.forward,this.inverse=ai.inverse}var ef=["Universal Transverse Mercator System","utm"];const sf={init:tf,names:ef,dependsOn:Jd};function as(e,t){return Math.pow((1-e)/(1+e),t)}var nf=20;function rf(){var e=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*e*e),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(e/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+j)/(Math.pow(Math.tan(.5*this.lat0+j),this.C)*as(this.e*e,this.ratexp))}function af(e){var t=e.x,i=e.y;return e.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*i+j),this.C)*as(this.e*Math.sin(i),this.ratexp))-S,e.x=this.C*t,e}function of(e){for(var t=1e-14,i=e.x/this.C,s=e.y,n=Math.pow(Math.tan(.5*s+j)/this.K,1/this.C),r=nf;r>0&&(s=2*Math.atan(n*as(this.e*Math.sin(e.y),-.5*this.e))-S,!(Math.abs(s-e.y)<t));--r)e.y=s;return r?(e.x=i,e.y=s,e):null}var hf=["gauss"];const os={init:rf,forward:af,inverse:of,names:hf};function lf(){os.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function cf(e){var t,i,s,n;return e.x=P(e.x-this.long0),os.forward.apply(this,[e]),t=Math.sin(e.y),i=Math.cos(e.y),s=Math.cos(e.x),n=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*i*s),e.x=n*i*Math.sin(e.x),e.y=n*(this.cosc0*t-this.sinc0*i*s),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function uf(e){var t,i,s,n,r;if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,r=Math.sqrt(e.x*e.x+e.y*e.y)){var a=2*Math.atan2(r,this.R2);t=Math.sin(a),i=Math.cos(a),n=Math.asin(i*this.sinc0+e.y*t*this.cosc0/r),s=Math.atan2(e.x*t,r*this.cosc0*i-e.y*this.sinc0*t)}else n=this.phic0,s=0;return e.x=s,e.y=n,os.inverse.apply(this,[e]),e.x=P(e.x+this.long0),e}var df=["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const ff={init:lf,forward:cf,inverse:uf,names:df};function gf(e,t,i){return t*=i,Math.tan(.5*(S+e))*Math.pow((1-t)/(1+t),.5*i)}function mf(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=E&&(this.k0=.5*(1+Ge(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=E&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=E&&(this.k0=.5*this.cons*St(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Ct(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=St(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-S,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function yf(e){var t=e.x,i=e.y,s=Math.sin(i),n=Math.cos(i),r,a,o,h,l,c,u=P(t-this.long0);return Math.abs(Math.abs(t-this.long0)-Math.PI)<=E&&Math.abs(i+this.lat0)<=E?(e.x=NaN,e.y=NaN,e):this.sphere?(r=2*this.k0/(1+this.sinlat0*s+this.coslat0*n*Math.cos(u)),e.x=this.a*r*n*Math.sin(u)+this.x0,e.y=this.a*r*(this.coslat0*s-this.sinlat0*n*Math.cos(u))+this.y0,e):(a=2*Math.atan(this.ssfn_(i,s,this.e))-S,h=Math.cos(a),o=Math.sin(a),Math.abs(this.coslat0)<=E?(l=Ct(this.e,i*this.con,this.con*s),c=2*this.a*this.k0*l/this.cons,e.x=this.x0+c*Math.sin(t-this.long0),e.y=this.y0-this.con*c*Math.cos(t-this.long0),e):(Math.abs(this.sinlat0)<E?(r=2*this.a*this.k0/(1+h*Math.cos(u)),e.y=r*o):(r=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*o+this.cosX0*h*Math.cos(u))),e.y=r*(this.cosX0*o-this.sinX0*h*Math.cos(u))+this.y0),e.x=r*h*Math.sin(u)+this.x0,e))}function _f(e){e.x-=this.x0,e.y-=this.y0;var t,i,s,n,r,a=Math.sqrt(e.x*e.x+e.y*e.y);if(this.sphere){var o=2*Math.atan(a/(2*this.a*this.k0));return t=this.long0,i=this.lat0,a<=E?(e.x=t,e.y=i,e):(i=Math.asin(Math.cos(o)*this.sinlat0+e.y*Math.sin(o)*this.coslat0/a),Math.abs(this.coslat0)<E?this.lat0>0?t=P(this.long0+Math.atan2(e.x,-1*e.y)):t=P(this.long0+Math.atan2(e.x,e.y)):t=P(this.long0+Math.atan2(e.x*Math.sin(o),a*this.coslat0*Math.cos(o)-e.y*this.sinlat0*Math.sin(o))),e.x=t,e.y=i,e)}else if(Math.abs(this.coslat0)<=E){if(a<=E)return i=this.lat0,t=this.long0,e.x=t,e.y=i,e;e.x*=this.con,e.y*=this.con,s=a*this.cons/(2*this.a*this.k0),i=this.con*Oe(this.e,s),t=this.con*P(this.con*this.long0+Math.atan2(e.x,-1*e.y))}else n=2*Math.atan(a*this.cosX0/(2*this.a*this.k0*this.ms1)),t=this.long0,a<=E?r=this.X0:(r=Math.asin(Math.cos(n)*this.sinX0+e.y*Math.sin(n)*this.cosX0/a),t=P(this.long0+Math.atan2(e.x*Math.sin(n),a*this.cosX0*Math.cos(n)-e.y*this.sinX0*Math.sin(n)))),i=-1*Oe(this.e,Math.tan(.5*(S+r)));return e.x=t,e.y=i,e}var pf=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"];const vf={init:mf,forward:yf,inverse:_f,names:pf,ssfn_:gf};function Cf(){var e=this.lat0;this.lambda0=this.long0;var t=Math.sin(e),i=this.a,s=this.rf,n=1/s,r=2*n-Math.pow(n,2),a=this.e=Math.sqrt(r);this.R=this.k0*i*Math.sqrt(1-r)/(1-r*Math.pow(t,2)),this.alpha=Math.sqrt(1+r/(1-r)*Math.pow(Math.cos(e),4)),this.b0=Math.asin(t/this.alpha);var o=Math.log(Math.tan(Math.PI/4+this.b0/2)),h=Math.log(Math.tan(Math.PI/4+e/2)),l=Math.log((1+a*t)/(1-a*t));this.K=o-this.alpha*h+this.alpha*a/2*l}function Mf(e){var t=Math.log(Math.tan(Math.PI/4-e.y/2)),i=this.e/2*Math.log((1+this.e*Math.sin(e.y))/(1-this.e*Math.sin(e.y))),s=-this.alpha*(t+i)+this.K,n=2*(Math.atan(Math.exp(s))-Math.PI/4),r=this.alpha*(e.x-this.lambda0),a=Math.atan(Math.sin(r)/(Math.sin(this.b0)*Math.tan(n)+Math.cos(this.b0)*Math.cos(r))),o=Math.asin(Math.cos(this.b0)*Math.sin(n)-Math.sin(this.b0)*Math.cos(n)*Math.cos(r));return e.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0,e.x=this.R*a+this.x0,e}function xf(e){for(var t=e.x-this.x0,i=e.y-this.y0,s=t/this.R,n=2*(Math.atan(Math.exp(i/this.R))-Math.PI/4),r=Math.asin(Math.cos(this.b0)*Math.sin(n)+Math.sin(this.b0)*Math.cos(n)*Math.cos(s)),a=Math.atan(Math.sin(s)/(Math.cos(this.b0)*Math.cos(s)-Math.sin(this.b0)*Math.tan(n))),o=this.lambda0+a/this.alpha,h=0,l=r,c=-1e3,u=0;Math.abs(l-c)>1e-7;){if(++u>20)return;h=1/this.alpha*(Math.log(Math.tan(Math.PI/4+r/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(l))/2)),c=l,l=2*Math.atan(Math.exp(h))-Math.PI/2}return e.x=o,e.y=l,e}var bf=["somerc"];const wf={init:Cf,forward:Mf,inverse:xf,names:bf};var Jt=1e-7;function Sf(e){var t=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],i=typeof e.PROJECTION=="object"?Object.keys(e.PROJECTION)[0]:e.PROJECTION;return"no_uoff"in e||"no_off"in e||t.indexOf(i)!==-1}function Tf(){var e,t,i,s,n,r,a,o,h,l,c=0,u,d=0,f=0,g=0,y=0,m=0,p=0;this.no_off=Sf(this),this.no_rot="no_rot"in this;var x=!1;"alpha"in this&&(x=!0);var b=!1;if("rectified_grid_angle"in this&&(b=!0),x&&(p=this.alpha),b&&(c=this.rectified_grid_angle*tt),x||b)d=this.longc;else if(f=this.long1,y=this.lat1,g=this.long2,m=this.lat2,Math.abs(y-m)<=Jt||(e=Math.abs(y))<=Jt||Math.abs(e-S)<=Jt||Math.abs(Math.abs(this.lat0)-S)<=Jt||Math.abs(Math.abs(m)-S)<=Jt)throw new Error;var M=1-this.es;t=Math.sqrt(M),Math.abs(this.lat0)>E?(o=Math.sin(this.lat0),i=Math.cos(this.lat0),e=1-this.es*o*o,this.B=i*i,this.B=Math.sqrt(1+this.es*this.B*this.B/M),this.A=this.B*this.k0*t/e,s=this.B*t/(i*Math.sqrt(e)),n=s*s-1,n<=0?n=0:(n=Math.sqrt(n),this.lat0<0&&(n=-n)),this.E=n+=s,this.E*=Math.pow(Ct(this.e,this.lat0,o),this.B)):(this.B=1/t,this.A=this.k0,this.E=s=n=1),x||b?(x?(u=Math.asin(Math.sin(p)/s),b||(c=p)):(u=c,p=Math.asin(s*Math.sin(u))),this.lam0=d-Math.asin(.5*(n-1/n)*Math.tan(u))/this.B):(r=Math.pow(Ct(this.e,y,Math.sin(y)),this.B),a=Math.pow(Ct(this.e,m,Math.sin(m)),this.B),n=this.E/r,h=(a-r)/(a+r),l=this.E*this.E,l=(l-a*r)/(l+a*r),e=f-g,e<-Math.pi?g-=Pe:e>Math.pi&&(g+=Pe),this.lam0=P(.5*(f+g)-Math.atan(l*Math.tan(.5*this.B*(f-g))/h)/this.B),u=Math.atan(2*Math.sin(this.B*P(f-this.lam0))/(n-1/n)),c=p=Math.asin(s*Math.sin(u))),this.singam=Math.sin(u),this.cosgam=Math.cos(u),this.sinrot=Math.sin(c),this.cosrot=Math.cos(c),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(s*s-1)/Math.cos(p))),this.lat0<0&&(this.u_0=-this.u_0)),n=.5*u,this.v_pole_n=this.ArB*Math.log(Math.tan(j-n)),this.v_pole_s=this.ArB*Math.log(Math.tan(j+n))}function Ef(e){var t={},i,s,n,r,a,o,h,l;if(e.x=e.x-this.lam0,Math.abs(Math.abs(e.y)-S)>E){if(a=this.E/Math.pow(Ct(this.e,e.y,Math.sin(e.y)),this.B),o=1/a,i=.5*(a-o),s=.5*(a+o),r=Math.sin(this.B*e.x),n=(i*this.singam-r*this.cosgam)/s,Math.abs(Math.abs(n)-1)<E)throw new Error;l=.5*this.ArB*Math.log((1-n)/(1+n)),o=Math.cos(this.B*e.x),Math.abs(o)<Jt?h=this.A*e.x:h=this.ArB*Math.atan2(i*this.cosgam+r*this.singam,o)}else l=e.y>0?this.v_pole_n:this.v_pole_s,h=this.ArB*e.y;return this.no_rot?(t.x=h,t.y=l):(h-=this.u_0,t.x=l*this.cosrot+h*this.sinrot,t.y=h*this.cosrot-l*this.sinrot),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t}function Lf(e){var t,i,s,n,r,a,o,h={};if(e.x=(e.x-this.x0)*(1/this.a),e.y=(e.y-this.y0)*(1/this.a),this.no_rot?(i=e.y,t=e.x):(i=e.x*this.cosrot-e.y*this.sinrot,t=e.y*this.cosrot+e.x*this.sinrot+this.u_0),s=Math.exp(-this.BrA*i),n=.5*(s-1/s),r=.5*(s+1/s),a=Math.sin(this.BrA*t),o=(a*this.cosgam+n*this.singam)/r,Math.abs(Math.abs(o)-1)<E)h.x=0,h.y=o<0?-S:S;else{if(h.y=this.E/Math.sqrt((1+o)/(1-o)),h.y=Oe(this.e,Math.pow(h.y,1/this.B)),h.y===1/0)throw new Error;h.x=-this.rB*Math.atan2(n*this.cosgam-a*this.singam,Math.cos(this.BrA*t))}return h.x+=this.lam0,h}var Pf=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const Rf={init:Tf,forward:Ef,inverse:Lf,names:Pf};function Of(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<E)){var e=this.b/this.a;this.e=Math.sqrt(1-e*e);var t=Math.sin(this.lat1),i=Math.cos(this.lat1),s=St(this.e,t,i),n=Ct(this.e,this.lat1,t),r=Math.sin(this.lat2),a=Math.cos(this.lat2),o=St(this.e,r,a),h=Ct(this.e,this.lat2,r),l=Ct(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>E?this.ns=Math.log(s/o)/Math.log(n/h):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=s/(this.ns*Math.pow(n,this.ns)),this.rh=this.a*this.f0*Math.pow(l,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function Af(e){var t=e.x,i=e.y;Math.abs(2*Math.abs(i)-Math.PI)<=E&&(i=Ge(i)*(S-2*E));var s=Math.abs(Math.abs(i)-S),n,r;if(s>E)n=Ct(this.e,i,Math.sin(i)),r=this.a*this.f0*Math.pow(n,this.ns);else{if(s=i*this.ns,s<=0)return null;r=0}var a=this.ns*P(t-this.long0);return e.x=this.k0*(r*Math.sin(a))+this.x0,e.y=this.k0*(this.rh-r*Math.cos(a))+this.y0,e}function Ff(e){var t,i,s,n,r,a=(e.x-this.x0)/this.k0,o=this.rh-(e.y-this.y0)/this.k0;this.ns>0?(t=Math.sqrt(a*a+o*o),i=1):(t=-Math.sqrt(a*a+o*o),i=-1);var h=0;if(t!==0&&(h=Math.atan2(i*a,i*o)),t!==0||this.ns>0){if(i=1/this.ns,s=Math.pow(t/(this.a*this.f0),i),n=Oe(this.e,s),n===-9999)return null}else n=-S;return r=P(h/this.ns+this.long0),e.x=r,e.y=n,e}var If=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const Nf={init:Of,forward:Af,inverse:Ff,names:If};function kf(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function Df(e){var t,i,s,n,r,a,o,h=e.x,l=e.y,c=P(h-this.long0);return t=Math.pow((1+this.e*Math.sin(l))/(1-this.e*Math.sin(l)),this.alfa*this.e/2),i=2*(Math.atan(this.k*Math.pow(Math.tan(l/2+this.s45),this.alfa)/t)-this.s45),s=-c*this.alfa,n=Math.asin(Math.cos(this.ad)*Math.sin(i)+Math.sin(this.ad)*Math.cos(i)*Math.cos(s)),r=Math.asin(Math.cos(i)*Math.sin(s)/Math.cos(n)),a=this.n*r,o=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(n/2+this.s45),this.n),e.y=o*Math.cos(a)/1,e.x=o*Math.sin(a)/1,this.czech||(e.y*=-1,e.x*=-1),e}function Gf(e){var t,i,s,n,r,a,o,h,l=e.x;e.x=e.y,e.y=l,this.czech||(e.y*=-1,e.x*=-1),a=Math.sqrt(e.x*e.x+e.y*e.y),r=Math.atan2(e.y,e.x),n=r/Math.sin(this.s0),s=2*(Math.atan(Math.pow(this.ro0/a,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(s)-Math.sin(this.ad)*Math.cos(s)*Math.cos(n)),i=Math.asin(Math.cos(s)*Math.sin(n)/Math.cos(t)),e.x=this.long0-i/this.alfa,o=t,h=0;var c=0;do e.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(o))/(1-this.e*Math.sin(o)),this.e/2))-this.s45),Math.abs(o-e.y)<1e-10&&(h=1),o=e.y,c+=1;while(h===0&&c<15);return c>=15?null:e}var jf=["Krovak","krovak"];const Vf={init:kf,forward:Df,inverse:Gf,names:jf};function ot(e,t,i,s,n){return e*n-t*Math.sin(2*n)+i*Math.sin(4*n)-s*Math.sin(6*n)}function je(e){return 1-.25*e*(1+e/16*(3+1.25*e))}function Ve(e){return .375*e*(1+.25*e*(1+.46875*e))}function Be(e){return .05859375*e*e*(1+.75*e)}function $e(e){return e*e*e*(35/3072)}function ge(e,t,i){var s=t*i;return e/Math.sqrt(1-s*s)}function me(e){return Math.abs(e)<S?e:e-Ge(e)*Math.PI}function Mi(e,t,i,s,n){var r,a;r=e/t;for(var o=0;o<15;o++)if(a=(e-(t*r-i*Math.sin(2*r)+s*Math.sin(4*r)-n*Math.sin(6*r)))/(t-2*i*Math.cos(2*r)+4*s*Math.cos(4*r)-6*n*Math.cos(6*r)),r+=a,Math.abs(a)<=1e-10)return r;return NaN}function Bf(){this.sphere||(this.e0=je(this.es),this.e1=Ve(this.es),this.e2=Be(this.es),this.e3=$e(this.es),this.ml0=this.a*ot(this.e0,this.e1,this.e2,this.e3,this.lat0))}function $f(e){var t,i,s=e.x,n=e.y;if(s=P(s-this.long0),this.sphere)t=this.a*Math.asin(Math.cos(n)*Math.sin(s)),i=this.a*(Math.atan2(Math.tan(n),Math.cos(s))-this.lat0);else{var r=Math.sin(n),a=Math.cos(n),o=ge(this.a,this.e,r),h=Math.tan(n)*Math.tan(n),l=s*Math.cos(n),c=l*l,u=this.es*a*a/(1-this.es),d=this.a*ot(this.e0,this.e1,this.e2,this.e3,n);t=o*l*(1-c*h*(1/6-(8-h+8*u)*c/120)),i=d-this.ml0+o*r/a*c*(.5+(5-h+6*u)*c/24)}return e.x=t+this.x0,e.y=i+this.y0,e}function zf(e){e.x-=this.x0,e.y-=this.y0;var t=e.x/this.a,i=e.y/this.a,s,n;if(this.sphere){var r=i+this.lat0;s=Math.asin(Math.sin(r)*Math.cos(t)),n=Math.atan2(Math.tan(t),Math.cos(r))}else{var a=this.ml0/this.a+i,o=Mi(a,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(o)-S)<=E)return e.x=this.long0,e.y=S,i<0&&(e.y*=-1),e;var h=ge(this.a,this.e,Math.sin(o)),l=h*h*h/this.a/this.a*(1-this.es),c=Math.pow(Math.tan(o),2),u=t*this.a/h,d=u*u;s=o-h*Math.tan(o)/l*u*u*(.5-(1+3*c)*u*u/24),n=u*(1-d*(c/3+(1+3*c)*c*d/15))/Math.cos(o)}return e.x=P(n+this.long0),e.y=me(s),e}var Uf=["Cassini","Cassini_Soldner","cass"];const qf={init:Bf,forward:$f,inverse:zf,names:Uf};function jt(e,t){var i;return e>1e-7?(i=e*t,(1-e*e)*(t/(1-i*i)-.5/e*Math.log((1-i)/(1+i)))):2*t}var Wf=1,Hf=2,Kf=3,Xf=4;function Yf(){var e=Math.abs(this.lat0);if(Math.abs(e-S)<E?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<E?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var t;switch(this.qp=jt(this.e,1),this.mmf=.5/(1-this.es),this.apa=r0(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=jt(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function Zf(e){var t,i,s,n,r,a,o,h,l,c,u=e.x,d=e.y;if(u=P(u-this.long0),this.sphere){if(r=Math.sin(d),c=Math.cos(d),s=Math.cos(u),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(i=this.mode===this.EQUIT?1+c*s:1+this.sinph0*r+this.cosph0*c*s,i<=E)return null;i=Math.sqrt(2/i),t=i*c*Math.sin(u),i*=this.mode===this.EQUIT?r:this.cosph0*r-this.sinph0*c*s}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(s=-s),Math.abs(d+this.lat0)<E)return null;i=j-d*.5,i=2*(this.mode===this.S_POLE?Math.cos(i):Math.sin(i)),t=i*Math.sin(u),i*=s}}else{switch(o=0,h=0,l=0,s=Math.cos(u),n=Math.sin(u),r=Math.sin(d),a=jt(this.e,r),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(o=a/this.qp,h=Math.sqrt(1-o*o)),this.mode){case this.OBLIQ:l=1+this.sinb1*o+this.cosb1*h*s;break;case this.EQUIT:l=1+h*s;break;case this.N_POLE:l=S+d,a=this.qp-a;break;case this.S_POLE:l=d-S,a=this.qp+a;break}if(Math.abs(l)<E)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:l=Math.sqrt(2/l),this.mode===this.OBLIQ?i=this.ymf*l*(this.cosb1*o-this.sinb1*h*s):i=(l=Math.sqrt(2/(1+h*s)))*o*this.ymf,t=this.xmf*l*h*n;break;case this.N_POLE:case this.S_POLE:a>=0?(t=(l=Math.sqrt(a))*n,i=s*(this.mode===this.S_POLE?l:-l)):t=i=0;break}}return e.x=this.a*t+this.x0,e.y=this.a*i+this.y0,e}function Qf(e){e.x-=this.x0,e.y-=this.y0;var t=e.x/this.a,i=e.y/this.a,s,n,r,a,o,h,l;if(this.sphere){var c=0,u,d=0;if(u=Math.sqrt(t*t+i*i),n=u*.5,n>1)return null;switch(n=2*Math.asin(n),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(d=Math.sin(n),c=Math.cos(n)),this.mode){case this.EQUIT:n=Math.abs(u)<=E?0:Math.asin(i*d/u),t*=d,i=c*u;break;case this.OBLIQ:n=Math.abs(u)<=E?this.lat0:Math.asin(c*this.sinph0+i*d*this.cosph0/u),t*=d*this.cosph0,i=(c-Math.sin(n)*this.sinph0)*u;break;case this.N_POLE:i=-i,n=S-n;break;case this.S_POLE:n-=S;break}s=i===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(t,i)}else{if(l=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(t/=this.dd,i*=this.dd,h=Math.sqrt(t*t+i*i),h<E)return e.x=this.long0,e.y=this.lat0,e;a=2*Math.asin(.5*h/this.rq),r=Math.cos(a),t*=a=Math.sin(a),this.mode===this.OBLIQ?(l=r*this.sinb1+i*a*this.cosb1/h,o=this.qp*l,i=h*this.cosb1*r-i*this.sinb1*a):(l=i*a/h,o=this.qp*l,i=h*r)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(i=-i),o=t*t+i*i,!o)return e.x=this.long0,e.y=this.lat0,e;l=1-o/this.qp,this.mode===this.S_POLE&&(l=-l)}s=Math.atan2(t,i),n=a0(Math.asin(l),this.apa)}return e.x=P(this.long0+s),e.y=n,e}var Jf=.3333333333333333,t0=.17222222222222222,e0=.10257936507936508,i0=.06388888888888888,s0=.0664021164021164,n0=.016415012942191543;function r0(e){var t,i=[];return i[0]=e*Jf,t=e*e,i[0]+=t*t0,i[1]=t*i0,t*=e,i[0]+=t*e0,i[1]+=t*s0,i[2]=t*n0,i}function a0(e,t){var i=e+e;return e+t[0]*Math.sin(i)+t[1]*Math.sin(i+i)+t[2]*Math.sin(i+i+i)}var o0=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const h0={init:Yf,forward:Zf,inverse:Qf,names:o0,S_POLE:Wf,N_POLE:Hf,EQUIT:Kf,OBLIQ:Xf};function Bt(e){return Math.abs(e)>1&&(e=e>1?1:-1),Math.asin(e)}function l0(){Math.abs(this.lat1+this.lat2)<E||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=St(this.e3,this.sin_po,this.cos_po),this.qs1=jt(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=St(this.e3,this.sin_po,this.cos_po),this.qs2=jt(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=jt(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>E?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function c0(e){var t=e.x,i=e.y;this.sin_phi=Math.sin(i),this.cos_phi=Math.cos(i);var s=jt(this.e3,this.sin_phi),n=this.a*Math.sqrt(this.c-this.ns0*s)/this.ns0,r=this.ns0*P(t-this.long0),a=n*Math.sin(r)+this.x0,o=this.rh-n*Math.cos(r)+this.y0;return e.x=a,e.y=o,e}function u0(e){var t,i,s,n,r,a;return e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns0>=0?(t=Math.sqrt(e.x*e.x+e.y*e.y),s=1):(t=-Math.sqrt(e.x*e.x+e.y*e.y),s=-1),n=0,t!==0&&(n=Math.atan2(s*e.x,s*e.y)),s=t*this.ns0/this.a,this.sphere?a=Math.asin((this.c-s*s)/(2*this.ns0)):(i=(this.c-s*s)/this.ns0,a=this.phi1z(this.e3,i)),r=P(n/this.ns0+this.long0),e.x=r,e.y=a,e}function d0(e,t){var i,s,n,r,a,o=Bt(.5*t);if(e<E)return o;for(var h=e*e,l=1;l<=25;l++)if(i=Math.sin(o),s=Math.cos(o),n=e*i,r=1-n*n,a=.5*r*r/s*(t/(1-h)-i/r+.5/e*Math.log((1-n)/(1+n))),o=o+a,Math.abs(a)<=1e-7)return o;return null}var f0=["Albers_Conic_Equal_Area","Albers","aea"];const g0={init:l0,forward:c0,inverse:u0,names:f0,phi1z:d0};function m0(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function y0(e){var t,i,s,n,r,a,o,h,l=e.x,c=e.y;return s=P(l-this.long0),t=Math.sin(c),i=Math.cos(c),n=Math.cos(s),a=this.sin_p14*t+this.cos_p14*i*n,r=1,a>0||Math.abs(a)<=E?(o=this.x0+this.a*r*i*Math.sin(s)/a,h=this.y0+this.a*r*(this.cos_p14*t-this.sin_p14*i*n)/a):(o=this.x0+this.infinity_dist*i*Math.sin(s),h=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*i*n)),e.x=o,e.y=h,e}function _0(e){var t,i,s,n,r,a;return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,(t=Math.sqrt(e.x*e.x+e.y*e.y))?(n=Math.atan2(t,this.rc),i=Math.sin(n),s=Math.cos(n),a=Bt(s*this.sin_p14+e.y*i*this.cos_p14/t),r=Math.atan2(e.x*i,t*this.cos_p14*s-e.y*this.sin_p14*i),r=P(this.long0+r)):(a=this.phic0,r=0),e.x=r,e.y=a,e}var p0=["gnom"];const v0={init:m0,forward:y0,inverse:_0,names:p0};function C0(e,t){var i=1-(1-e*e)/(2*e)*Math.log((1-e)/(1+e));if(Math.abs(Math.abs(t)-i)<1e-6)return t<0?-1*S:S;for(var s=Math.asin(.5*t),n,r,a,o,h=0;h<30;h++)if(r=Math.sin(s),a=Math.cos(s),o=e*r,n=Math.pow(1-o*o,2)/(2*a)*(t/(1-e*e)-r/(1-o*o)+.5/e*Math.log((1-o)/(1+o))),s+=n,Math.abs(n)<=1e-10)return s;return NaN}function M0(){this.sphere||(this.k0=St(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function x0(e){var t=e.x,i=e.y,s,n,r=P(t-this.long0);if(this.sphere)s=this.x0+this.a*r*Math.cos(this.lat_ts),n=this.y0+this.a*Math.sin(i)/Math.cos(this.lat_ts);else{var a=jt(this.e,Math.sin(i));s=this.x0+this.a*this.k0*r,n=this.y0+this.a*a*.5/this.k0}return e.x=s,e.y=n,e}function b0(e){e.x-=this.x0,e.y-=this.y0;var t,i;return this.sphere?(t=P(this.long0+e.x/this.a/Math.cos(this.lat_ts)),i=Math.asin(e.y/this.a*Math.cos(this.lat_ts))):(i=C0(this.e,2*e.y*this.k0/this.a),t=P(this.long0+e.x/(this.a*this.k0))),e.x=t,e.y=i,e}var w0=["cea"];const S0={init:M0,forward:x0,inverse:b0,names:w0};function T0(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function E0(e){var t=e.x,i=e.y,s=P(t-this.long0),n=me(i-this.lat0);return e.x=this.x0+this.a*s*this.rc,e.y=this.y0+this.a*n,e}function L0(e){var t=e.x,i=e.y;return e.x=P(this.long0+(t-this.x0)/(this.a*this.rc)),e.y=me(this.lat0+(i-this.y0)/this.a),e}var P0=["Equirectangular","Equidistant_Cylindrical","eqc"];const R0={init:T0,forward:E0,inverse:L0,names:P0};var rn=20;function O0(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=je(this.es),this.e1=Ve(this.es),this.e2=Be(this.es),this.e3=$e(this.es),this.ml0=this.a*ot(this.e0,this.e1,this.e2,this.e3,this.lat0)}function A0(e){var t=e.x,i=e.y,s,n,r,a=P(t-this.long0);if(r=a*Math.sin(i),this.sphere)Math.abs(i)<=E?(s=this.a*a,n=-1*this.a*this.lat0):(s=this.a*Math.sin(r)/Math.tan(i),n=this.a*(me(i-this.lat0)+(1-Math.cos(r))/Math.tan(i)));else if(Math.abs(i)<=E)s=this.a*a,n=-1*this.ml0;else{var o=ge(this.a,this.e,Math.sin(i))/Math.tan(i);s=o*Math.sin(r),n=this.a*ot(this.e0,this.e1,this.e2,this.e3,i)-this.ml0+o*(1-Math.cos(r))}return e.x=s+this.x0,e.y=n+this.y0,e}function F0(e){var t,i,s,n,r,a,o,h,l;if(s=e.x-this.x0,n=e.y-this.y0,this.sphere)if(Math.abs(n+this.a*this.lat0)<=E)t=P(s/this.a+this.long0),i=0;else{a=this.lat0+n/this.a,o=s*s/this.a/this.a+a*a,h=a;var c;for(r=rn;r;--r)if(c=Math.tan(h),l=-1*(a*(h*c+1)-h-.5*(h*h+o)*c)/((h-a)/c-1),h+=l,Math.abs(l)<=E){i=h;break}t=P(this.long0+Math.asin(s*Math.tan(h)/this.a)/Math.sin(i))}else if(Math.abs(n+this.ml0)<=E)i=0,t=P(this.long0+s/this.a);else{a=(this.ml0+n)/this.a,o=s*s/this.a/this.a+a*a,h=a;var u,d,f,g,y;for(r=rn;r;--r)if(y=this.e*Math.sin(h),u=Math.sqrt(1-y*y)*Math.tan(h),d=this.a*ot(this.e0,this.e1,this.e2,this.e3,h),f=this.e0-2*this.e1*Math.cos(2*h)+4*this.e2*Math.cos(4*h)-6*this.e3*Math.cos(6*h),g=d/this.a,l=(a*(u*g+1)-g-.5*u*(g*g+o))/(this.es*Math.sin(2*h)*(g*g+o-2*a*g)/(4*u)+(a-g)*(u*f-2/Math.sin(2*h))-f),h-=l,Math.abs(l)<=E){i=h;break}u=Math.sqrt(1-this.es*Math.pow(Math.sin(i),2))*Math.tan(i),t=P(this.long0+Math.asin(s*u/this.a)/Math.sin(i))}return e.x=t,e.y=i,e}var I0=["Polyconic","poly"];const N0={init:O0,forward:A0,inverse:F0,names:I0};function k0(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function D0(e){var t,i=e.x,s=e.y,n=s-this.lat0,r=i-this.long0,a=n/we*1e-5,o=r,h=1,l=0;for(t=1;t<=10;t++)h=h*a,l=l+this.A[t]*h;var c=l,u=o,d=1,f=0,g,y,m=0,p=0;for(t=1;t<=6;t++)g=d*c-f*u,y=f*c+d*u,d=g,f=y,m=m+this.B_re[t]*d-this.B_im[t]*f,p=p+this.B_im[t]*d+this.B_re[t]*f;return e.x=p*this.a+this.x0,e.y=m*this.a+this.y0,e}function G0(e){var t,i=e.x,s=e.y,n=i-this.x0,r=s-this.y0,a=r/this.a,o=n/this.a,h=1,l=0,c,u,d=0,f=0;for(t=1;t<=6;t++)c=h*a-l*o,u=l*a+h*o,h=c,l=u,d=d+this.C_re[t]*h-this.C_im[t]*l,f=f+this.C_im[t]*h+this.C_re[t]*l;for(var g=0;g<this.iterations;g++){var y=d,m=f,p,x,b=a,M=o;for(t=2;t<=6;t++)p=y*d-m*f,x=m*d+y*f,y=p,m=x,b=b+(t-1)*(this.B_re[t]*y-this.B_im[t]*m),M=M+(t-1)*(this.B_im[t]*y+this.B_re[t]*m);y=1,m=0;var v=this.B_re[1],w=this.B_im[1];for(t=2;t<=6;t++)p=y*d-m*f,x=m*d+y*f,y=p,m=x,v=v+t*(this.B_re[t]*y-this.B_im[t]*m),w=w+t*(this.B_im[t]*y+this.B_re[t]*m);var C=v*v+w*w;d=(b*v+M*w)/C,f=(M*v-b*w)/C}var T=d,L=f,k=1,D=0;for(t=1;t<=9;t++)k=k*T,D=D+this.D[t]*k;var X=this.lat0+D*we*1e5,ht=this.long0+L;return e.x=ht,e.y=X,e}var j0=["New_Zealand_Map_Grid","nzmg"];const V0={init:k0,forward:D0,inverse:G0,names:j0};function B0(){}function $0(e){var t=e.x,i=e.y,s=P(t-this.long0),n=this.x0+this.a*s,r=this.y0+this.a*Math.log(Math.tan(Math.PI/4+i/2.5))*1.25;return e.x=n,e.y=r,e}function z0(e){e.x-=this.x0,e.y-=this.y0;var t=P(this.long0+e.x/this.a),i=2.5*(Math.atan(Math.exp(.8*e.y/this.a))-Math.PI/4);return e.x=t,e.y=i,e}var U0=["Miller_Cylindrical","mill"];const q0={init:B0,forward:$0,inverse:z0,names:U0};var W0=20;function H0(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=ur(this.es)}function K0(e){var t,i,s=e.x,n=e.y;if(s=P(s-this.long0),this.sphere){if(!this.m)n=this.n!==1?Math.asin(this.n*Math.sin(n)):n;else for(var r=this.n*Math.sin(n),a=W0;a;--a){var o=(this.m*n+Math.sin(n)-r)/(this.m+Math.cos(n));if(n-=o,Math.abs(o)<E)break}t=this.a*this.C_x*s*(this.m+Math.cos(n)),i=this.a*this.C_y*n}else{var h=Math.sin(n),l=Math.cos(n);i=this.a*Ti(n,h,l,this.en),t=this.a*s*l/Math.sqrt(1-this.es*h*h)}return e.x=t,e.y=i,e}function X0(e){var t,i,s,n;return e.x-=this.x0,s=e.x/this.a,e.y-=this.y0,t=e.y/this.a,this.sphere?(t/=this.C_y,s=s/(this.C_x*(this.m+Math.cos(t))),this.m?t=Bt((this.m*t+Math.sin(t))/this.n):this.n!==1&&(t=Bt(Math.sin(t)/this.n)),s=P(s+this.long0),t=me(t)):(t=dr(e.y/this.a,this.es,this.en),n=Math.abs(t),n<S?(n=Math.sin(t),i=this.long0+e.x*Math.sqrt(1-this.es*n*n)/(this.a*Math.cos(t)),s=P(i)):n-E<S&&(s=this.long0)),e.x=s,e.y=t,e}var Y0=["Sinusoidal","sinu"];const Z0={init:H0,forward:K0,inverse:X0,names:Y0};function Q0(){}function J0(e){for(var t=e.x,i=e.y,s=P(t-this.long0),n=i,r=Math.PI*Math.sin(i);;){var a=-(n+Math.sin(n)-r)/(1+Math.cos(n));if(n+=a,Math.abs(a)<E)break}n/=2,Math.PI/2-Math.abs(i)<E&&(s=0);var o=.900316316158*this.a*s*Math.cos(n)+this.x0,h=1.4142135623731*this.a*Math.sin(n)+this.y0;return e.x=o,e.y=h,e}function tg(e){var t,i;e.x-=this.x0,e.y-=this.y0,i=e.y/(1.4142135623731*this.a),Math.abs(i)>.999999999999&&(i=.999999999999),t=Math.asin(i);var s=P(this.long0+e.x/(.900316316158*this.a*Math.cos(t)));s<-Math.PI&&(s=-Math.PI),s>Math.PI&&(s=Math.PI),i=(2*t+Math.sin(2*t))/Math.PI,Math.abs(i)>1&&(i=1);var n=Math.asin(i);return e.x=s,e.y=n,e}var eg=["Mollweide","moll"];const ig={init:Q0,forward:J0,inverse:tg,names:eg};function sg(){Math.abs(this.lat1+this.lat2)<E||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=je(this.es),this.e1=Ve(this.es),this.e2=Be(this.es),this.e3=$e(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=St(this.e,this.sinphi,this.cosphi),this.ml1=ot(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<E?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=St(this.e,this.sinphi,this.cosphi),this.ml2=ot(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=ot(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function ng(e){var t=e.x,i=e.y,s;if(this.sphere)s=this.a*(this.g-i);else{var n=ot(this.e0,this.e1,this.e2,this.e3,i);s=this.a*(this.g-n)}var r=this.ns*P(t-this.long0),a=this.x0+s*Math.sin(r),o=this.y0+this.rh-s*Math.cos(r);return e.x=a,e.y=o,e}function rg(e){e.x-=this.x0,e.y=this.rh-e.y+this.y0;var t,i,s,n;this.ns>=0?(i=Math.sqrt(e.x*e.x+e.y*e.y),t=1):(i=-Math.sqrt(e.x*e.x+e.y*e.y),t=-1);var r=0;if(i!==0&&(r=Math.atan2(t*e.x,t*e.y)),this.sphere)return n=P(this.long0+r/this.ns),s=me(this.g-i/this.a),e.x=n,e.y=s,e;var a=this.g-i/this.a;return s=Mi(a,this.e0,this.e1,this.e2,this.e3),n=P(this.long0+r/this.ns),e.x=n,e.y=s,e}var ag=["Equidistant_Conic","eqdc"];const og={init:sg,forward:ng,inverse:rg,names:ag};function hg(){this.R=this.a}function lg(e){var t=e.x,i=e.y,s=P(t-this.long0),n,r;Math.abs(i)<=E&&(n=this.x0+this.R*s,r=this.y0);var a=Bt(2*Math.abs(i/Math.PI));(Math.abs(s)<=E||Math.abs(Math.abs(i)-S)<=E)&&(n=this.x0,i>=0?r=this.y0+Math.PI*this.R*Math.tan(.5*a):r=this.y0+Math.PI*this.R*-Math.tan(.5*a));var o=.5*Math.abs(Math.PI/s-s/Math.PI),h=o*o,l=Math.sin(a),c=Math.cos(a),u=c/(l+c-1),d=u*u,f=u*(2/l-1),g=f*f,y=Math.PI*this.R*(o*(u-g)+Math.sqrt(h*(u-g)*(u-g)-(g+h)*(d-g)))/(g+h);s<0&&(y=-y),n=this.x0+y;var m=h+u;return y=Math.PI*this.R*(f*m-o*Math.sqrt((g+h)*(h+1)-m*m))/(g+h),i>=0?r=this.y0+y:r=this.y0-y,e.x=n,e.y=r,e}function cg(e){var t,i,s,n,r,a,o,h,l,c,u,d,f;return e.x-=this.x0,e.y-=this.y0,u=Math.PI*this.R,s=e.x/u,n=e.y/u,r=s*s+n*n,a=-Math.abs(n)*(1+r),o=a-2*n*n+s*s,h=-2*a+1+2*n*n+r*r,f=n*n/h+(2*o*o*o/h/h/h-9*a*o/h/h)/27,l=(a-o*o/3/h)/h,c=2*Math.sqrt(-l/3),u=3*f/l/c,Math.abs(u)>1&&(u>=0?u=1:u=-1),d=Math.acos(u)/3,e.y>=0?i=(-c*Math.cos(d+Math.PI/3)-o/3/h)*Math.PI:i=-(-c*Math.cos(d+Math.PI/3)-o/3/h)*Math.PI,Math.abs(s)<E?t=this.long0:t=P(this.long0+Math.PI*(r-1+Math.sqrt(1+2*(s*s-n*n)+r*r))/2/s),e.x=t,e.y=i,e}var ug=["Van_der_Grinten_I","VanDerGrinten","vandg"];const dg={init:hg,forward:lg,inverse:cg,names:ug};function fg(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function gg(e){var t=e.x,i=e.y,s=Math.sin(e.y),n=Math.cos(e.y),r=P(t-this.long0),a,o,h,l,c,u,d,f,g,y,m,p,x,b,M,v,w,C,T,L,k,D,X;return this.sphere?Math.abs(this.sin_p12-1)<=E?(e.x=this.x0+this.a*(S-i)*Math.sin(r),e.y=this.y0-this.a*(S-i)*Math.cos(r),e):Math.abs(this.sin_p12+1)<=E?(e.x=this.x0+this.a*(S+i)*Math.sin(r),e.y=this.y0+this.a*(S+i)*Math.cos(r),e):(C=this.sin_p12*s+this.cos_p12*n*Math.cos(r),v=Math.acos(C),w=v?v/Math.sin(v):1,e.x=this.x0+this.a*w*n*Math.sin(r),e.y=this.y0+this.a*w*(this.cos_p12*s-this.sin_p12*n*Math.cos(r)),e):(a=je(this.es),o=Ve(this.es),h=Be(this.es),l=$e(this.es),Math.abs(this.sin_p12-1)<=E?(c=this.a*ot(a,o,h,l,S),u=this.a*ot(a,o,h,l,i),e.x=this.x0+(c-u)*Math.sin(r),e.y=this.y0-(c-u)*Math.cos(r),e):Math.abs(this.sin_p12+1)<=E?(c=this.a*ot(a,o,h,l,S),u=this.a*ot(a,o,h,l,i),e.x=this.x0+(c+u)*Math.sin(r),e.y=this.y0+(c+u)*Math.cos(r),e):(d=s/n,f=ge(this.a,this.e,this.sin_p12),g=ge(this.a,this.e,s),y=Math.atan((1-this.es)*d+this.es*f*this.sin_p12/(g*n)),m=Math.atan2(Math.sin(r),this.cos_p12*Math.tan(y)-this.sin_p12*Math.cos(r)),m===0?T=Math.asin(this.cos_p12*Math.sin(y)-this.sin_p12*Math.cos(y)):Math.abs(Math.abs(m)-Math.PI)<=E?T=-Math.asin(this.cos_p12*Math.sin(y)-this.sin_p12*Math.cos(y)):T=Math.asin(Math.sin(r)*Math.cos(y)/Math.sin(m)),p=this.e*this.sin_p12/Math.sqrt(1-this.es),x=this.e*this.cos_p12*Math.cos(m)/Math.sqrt(1-this.es),b=p*x,M=x*x,L=T*T,k=L*T,D=k*T,X=D*T,v=f*T*(1-L*M*(1-M)/6+k/8*b*(1-2*M)+D/120*(M*(4-7*M)-3*p*p*(1-7*M))-X/48*b),e.x=this.x0+v*Math.sin(m),e.y=this.y0+v*Math.cos(m),e))}function mg(e){e.x-=this.x0,e.y-=this.y0;var t,i,s,n,r,a,o,h,l,c,u,d,f,g,y,m,p,x,b,M,v,w,C,T;return this.sphere?(t=Math.sqrt(e.x*e.x+e.y*e.y),t>2*S*this.a?void 0:(i=t/this.a,s=Math.sin(i),n=Math.cos(i),r=this.long0,Math.abs(t)<=E?a=this.lat0:(a=Bt(n*this.sin_p12+e.y*s*this.cos_p12/t),o=Math.abs(this.lat0)-S,Math.abs(o)<=E?this.lat0>=0?r=P(this.long0+Math.atan2(e.x,-e.y)):r=P(this.long0-Math.atan2(-e.x,e.y)):r=P(this.long0+Math.atan2(e.x*s,t*this.cos_p12*n-e.y*this.sin_p12*s))),e.x=r,e.y=a,e)):(h=je(this.es),l=Ve(this.es),c=Be(this.es),u=$e(this.es),Math.abs(this.sin_p12-1)<=E?(d=this.a*ot(h,l,c,u,S),t=Math.sqrt(e.x*e.x+e.y*e.y),f=d-t,a=Mi(f/this.a,h,l,c,u),r=P(this.long0+Math.atan2(e.x,-1*e.y)),e.x=r,e.y=a,e):Math.abs(this.sin_p12+1)<=E?(d=this.a*ot(h,l,c,u,S),t=Math.sqrt(e.x*e.x+e.y*e.y),f=t-d,a=Mi(f/this.a,h,l,c,u),r=P(this.long0+Math.atan2(e.x,e.y)),e.x=r,e.y=a,e):(t=Math.sqrt(e.x*e.x+e.y*e.y),m=Math.atan2(e.x,e.y),g=ge(this.a,this.e,this.sin_p12),p=Math.cos(m),x=this.e*this.cos_p12*p,b=-x*x/(1-this.es),M=3*this.es*(1-b)*this.sin_p12*this.cos_p12*p/(1-this.es),v=t/g,w=v-b*(1+b)*Math.pow(v,3)/6-M*(1+3*b)*Math.pow(v,4)/24,C=1-b*w*w/2-v*w*w*w/6,y=Math.asin(this.sin_p12*Math.cos(w)+this.cos_p12*Math.sin(w)*p),r=P(this.long0+Math.asin(Math.sin(m)*Math.sin(w)/Math.cos(y))),T=Math.sin(y),a=Math.atan2((T-this.es*C*this.sin_p12)*Math.tan(y),T*(1-this.es)),e.x=r,e.y=a,e))}var yg=["Azimuthal_Equidistant","aeqd"];const _g={init:fg,forward:gg,inverse:mg,names:yg};function pg(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function vg(e){var t,i,s,n,r,a,o,h,l=e.x,c=e.y;return s=P(l-this.long0),t=Math.sin(c),i=Math.cos(c),n=Math.cos(s),a=this.sin_p14*t+this.cos_p14*i*n,r=1,(a>0||Math.abs(a)<=E)&&(o=this.a*r*i*Math.sin(s),h=this.y0+this.a*r*(this.cos_p14*t-this.sin_p14*i*n)),e.x=o,e.y=h,e}function Cg(e){var t,i,s,n,r,a,o;return e.x-=this.x0,e.y-=this.y0,t=Math.sqrt(e.x*e.x+e.y*e.y),i=Bt(t/this.a),s=Math.sin(i),n=Math.cos(i),a=this.long0,Math.abs(t)<=E?(o=this.lat0,e.x=a,e.y=o,e):(o=Bt(n*this.sin_p14+e.y*s*this.cos_p14/t),r=Math.abs(this.lat0)-S,Math.abs(r)<=E?(this.lat0>=0?a=P(this.long0+Math.atan2(e.x,-e.y)):a=P(this.long0-Math.atan2(-e.x,e.y)),e.x=a,e.y=o,e):(a=P(this.long0+Math.atan2(e.x*s,t*this.cos_p14*n-e.y*this.sin_p14*s)),e.x=a,e.y=o,e))}var Mg=["ortho"];const xg={init:pg,forward:vg,inverse:Cg,names:Mg};var U={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},V={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function bg(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=S-j/2?this.face=U.TOP:this.lat0<=-(S-j/2)?this.face=U.BOTTOM:Math.abs(this.long0)<=j?this.face=U.FRONT:Math.abs(this.long0)<=S+j?this.face=this.long0>0?U.RIGHT:U.LEFT:this.face=U.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function wg(e){var t={x:0,y:0},i,s,n,r,a,o,h={value:0};if(e.x-=this.long0,this.es!==0?i=Math.atan(this.one_minus_f_squared*Math.tan(e.y)):i=e.y,s=e.x,this.face===U.TOP)r=S-i,s>=j&&s<=S+j?(h.value=V.AREA_0,n=s-S):s>S+j||s<=-(S+j)?(h.value=V.AREA_1,n=s>0?s-H:s+H):s>-(S+j)&&s<=-j?(h.value=V.AREA_2,n=s+S):(h.value=V.AREA_3,n=s);else if(this.face===U.BOTTOM)r=S+i,s>=j&&s<=S+j?(h.value=V.AREA_0,n=-s+S):s<j&&s>=-j?(h.value=V.AREA_1,n=-s):s<-j&&s>=-(S+j)?(h.value=V.AREA_2,n=-s-S):(h.value=V.AREA_3,n=s>0?-s+H:-s-H);else{var l,c,u,d,f,g,y;this.face===U.RIGHT?s=le(s,+S):this.face===U.BACK?s=le(s,+H):this.face===U.LEFT&&(s=le(s,-S)),d=Math.sin(i),f=Math.cos(i),g=Math.sin(s),y=Math.cos(s),l=f*y,c=f*g,u=d,this.face===U.FRONT?(r=Math.acos(l),n=ti(r,u,c,h)):this.face===U.RIGHT?(r=Math.acos(c),n=ti(r,u,-l,h)):this.face===U.BACK?(r=Math.acos(-l),n=ti(r,u,-c,h)):this.face===U.LEFT?(r=Math.acos(-c),n=ti(r,u,l,h)):(r=n=0,h.value=V.AREA_0)}return o=Math.atan(12/H*(n+Math.acos(Math.sin(n)*Math.cos(j))-S)),a=Math.sqrt((1-Math.cos(r))/(Math.cos(o)*Math.cos(o))/(1-Math.cos(Math.atan(1/Math.cos(n))))),h.value===V.AREA_1?o+=S:h.value===V.AREA_2?o+=H:h.value===V.AREA_3&&(o+=1.5*H),t.x=a*Math.cos(o),t.y=a*Math.sin(o),t.x=t.x*this.a+this.x0,t.y=t.y*this.a+this.y0,e.x=t.x,e.y=t.y,e}function Sg(e){var t={lam:0,phi:0},i,s,n,r,a,o,h,l,c,u={value:0};if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,s=Math.atan(Math.sqrt(e.x*e.x+e.y*e.y)),i=Math.atan2(e.y,e.x),e.x>=0&&e.x>=Math.abs(e.y)?u.value=V.AREA_0:e.y>=0&&e.y>=Math.abs(e.x)?(u.value=V.AREA_1,i-=S):e.x<0&&-e.x>=Math.abs(e.y)?(u.value=V.AREA_2,i=i<0?i+H:i-H):(u.value=V.AREA_3,i+=S),c=H/12*Math.tan(i),a=Math.sin(c)/(Math.cos(c)-1/Math.sqrt(2)),o=Math.atan(a),n=Math.cos(i),r=Math.tan(s),h=1-n*n*r*r*(1-Math.cos(Math.atan(1/Math.cos(o)))),h<-1?h=-1:h>1&&(h=1),this.face===U.TOP)l=Math.acos(h),t.phi=S-l,u.value===V.AREA_0?t.lam=o+S:u.value===V.AREA_1?t.lam=o<0?o+H:o-H:u.value===V.AREA_2?t.lam=o-S:t.lam=o;else if(this.face===U.BOTTOM)l=Math.acos(h),t.phi=l-S,u.value===V.AREA_0?t.lam=-o+S:u.value===V.AREA_1?t.lam=-o:u.value===V.AREA_2?t.lam=-o-S:t.lam=o<0?-o-H:-o+H;else{var d,f,g;d=h,c=d*d,c>=1?g=0:g=Math.sqrt(1-c)*Math.sin(o),c+=g*g,c>=1?f=0:f=Math.sqrt(1-c),u.value===V.AREA_1?(c=f,f=-g,g=c):u.value===V.AREA_2?(f=-f,g=-g):u.value===V.AREA_3&&(c=f,f=g,g=-c),this.face===U.RIGHT?(c=d,d=-f,f=c):this.face===U.BACK?(d=-d,f=-f):this.face===U.LEFT&&(c=d,d=f,f=-c),t.phi=Math.acos(-g)-S,t.lam=Math.atan2(f,d),this.face===U.RIGHT?t.lam=le(t.lam,-S):this.face===U.BACK?t.lam=le(t.lam,-H):this.face===U.LEFT&&(t.lam=le(t.lam,+S))}if(this.es!==0){var y,m,p;y=t.phi<0?1:0,m=Math.tan(t.phi),p=this.b/Math.sqrt(m*m+this.one_minus_f_squared),t.phi=Math.atan(Math.sqrt(this.a*this.a-p*p)/(this.one_minus_f*p)),y&&(t.phi=-t.phi)}return t.lam+=this.long0,e.x=t.lam,e.y=t.phi,e}function ti(e,t,i,s){var n;return e<E?(s.value=V.AREA_0,n=0):(n=Math.atan2(t,i),Math.abs(n)<=j?s.value=V.AREA_0:n>j&&n<=S+j?(s.value=V.AREA_1,n-=S):n>S+j||n<=-(S+j)?(s.value=V.AREA_2,n=n>=0?n-H:n+H):(s.value=V.AREA_3,n+=S)),n}function le(e,t){var i=e+t;return i<-H?i+=Pe:i>+H&&(i-=Pe),i}var Tg=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const Eg={init:bg,forward:wg,inverse:Sg,names:Tg};var Wi=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Me=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],mr=.8487,yr=1.3523,_r=xt/5,Lg=1/_r,ne=18,xi=function(e,t){return e[0]+t*(e[1]+t*(e[2]+t*e[3]))},Pg=function(e,t){return e[1]+t*(2*e[2]+t*3*e[3])};function Rg(e,t,i,s){for(var n=t;s;--s){var r=e(n);if(n-=r,Math.abs(r)<i)break}return n}function Og(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function Ag(e){var t=P(e.x-this.long0),i=Math.abs(e.y),s=Math.floor(i*_r);s<0?s=0:s>=ne&&(s=ne-1),i=xt*(i-Lg*s);var n={x:xi(Wi[s],i)*t,y:xi(Me[s],i)};return e.y<0&&(n.y=-n.y),n.x=n.x*this.a*mr+this.x0,n.y=n.y*this.a*yr+this.y0,n}function Fg(e){var t={x:(e.x-this.x0)/(this.a*mr),y:Math.abs(e.y-this.y0)/(this.a*yr)};if(t.y>=1)t.x/=Wi[ne][0],t.y=e.y<0?-S:S;else{var i=Math.floor(t.y*ne);for(i<0?i=0:i>=ne&&(i=ne-1);;)if(Me[i][0]>t.y)--i;else if(Me[i+1][0]<=t.y)++i;else break;var s=Me[i],n=5*(t.y-s[0])/(Me[i+1][0]-s[0]);n=Rg(function(r){return(xi(s,r)-t.y)/Pg(s,r)},n,E,100),t.x/=xi(Wi[i],n),t.y=(5*i+n)*tt,e.y<0&&(t.y=-t.y)}return t.x=P(t.x+this.long0),t}var Ig=["Robinson","robin"];const Ng={init:Og,forward:Ag,inverse:Fg,names:Ig};function kg(){this.name="geocent"}function Dg(e){var t=ir(e,this.es,this.a);return t}function Gg(e){var t=sr(e,this.es,this.a,this.b);return t}var jg=["Geocentric","geocentric","geocent","Geocent"];const Vg={init:kg,forward:Dg,inverse:Gg,names:jg};var nt={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},_e={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function Bg(){if(Object.keys(_e).forEach(function(i){if(typeof this[i]>"u")this[i]=_e[i].def;else{if(_e[i].num&&isNaN(this[i]))throw new Error("Invalid parameter value, must be numeric "+i+" = "+this[i]);_e[i].num&&(this[i]=parseFloat(this[i]))}_e[i].degrees&&(this[i]=this[i]*tt)}.bind(this)),Math.abs(Math.abs(this.lat0)-S)<E?this.mode=this.lat0<0?nt.S_POLE:nt.N_POLE:Math.abs(this.lat0)<E?this.mode=nt.EQUIT:(this.mode=nt.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var e=this.tilt,t=this.azi;this.cg=Math.cos(t),this.sg=Math.sin(t),this.cw=Math.cos(e),this.sw=Math.sin(e)}function $g(e){e.x-=this.long0;var t=Math.sin(e.y),i=Math.cos(e.y),s=Math.cos(e.x),n,r;switch(this.mode){case nt.OBLIQ:r=this.sinph0*t+this.cosph0*i*s;break;case nt.EQUIT:r=i*s;break;case nt.S_POLE:r=-t;break;case nt.N_POLE:r=t;break}switch(r=this.pn1/(this.p-r),n=r*i*Math.sin(e.x),this.mode){case nt.OBLIQ:r*=this.cosph0*t-this.sinph0*i*s;break;case nt.EQUIT:r*=t;break;case nt.N_POLE:r*=-(i*s);break;case nt.S_POLE:r*=i*s;break}var a,o;return a=r*this.cg+n*this.sg,o=1/(a*this.sw*this.h1+this.cw),n=(n*this.cg-r*this.sg)*this.cw*o,r=a*o,e.x=n*this.a,e.y=r*this.a,e}function zg(e){e.x/=this.a,e.y/=this.a;var t={x:e.x,y:e.y},i,s,n;n=1/(this.pn1-e.y*this.sw),i=this.pn1*e.x*n,s=this.pn1*e.y*this.cw*n,e.x=i*this.cg+s*this.sg,e.y=s*this.cg-i*this.sg;var r=pt(e.x,e.y);if(Math.abs(r)<E)t.x=0,t.y=e.y;else{var a,o;switch(o=1-r*r*this.pfact,o=(this.p-Math.sqrt(o))/(this.pn1/r+r/this.pn1),a=Math.sqrt(1-o*o),this.mode){case nt.OBLIQ:t.y=Math.asin(a*this.sinph0+e.y*o*this.cosph0/r),e.y=(a-this.sinph0*Math.sin(t.y))*r,e.x*=o*this.cosph0;break;case nt.EQUIT:t.y=Math.asin(e.y*o/r),e.y=a*r,e.x*=o;break;case nt.N_POLE:t.y=Math.asin(a),e.y=-e.y;break;case nt.S_POLE:t.y=-Math.asin(a);break}t.x=Math.atan2(e.x,e.y)}return e.x=t.x+this.long0,e.y=t.y,e}var Ug=["Tilted_Perspective","tpers"];const qg={init:Bg,forward:$g,inverse:zg,names:Ug};function Wg(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var e=1-this.es,t=1/e;this.radius_p=Math.sqrt(e),this.radius_p2=e,this.radius_p_inv2=t,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function Hg(e){var t=e.x,i=e.y,s,n,r,a;if(t=t-this.long0,this.shape==="ellipse"){i=Math.atan(this.radius_p2*Math.tan(i));var o=this.radius_p/pt(this.radius_p*Math.cos(i),Math.sin(i));if(n=o*Math.cos(t)*Math.cos(i),r=o*Math.sin(t)*Math.cos(i),a=o*Math.sin(i),(this.radius_g-n)*n-r*r-a*a*this.radius_p_inv2<0)return e.x=Number.NaN,e.y=Number.NaN,e;s=this.radius_g-n,this.flip_axis?(e.x=this.radius_g_1*Math.atan(r/pt(a,s)),e.y=this.radius_g_1*Math.atan(a/s)):(e.x=this.radius_g_1*Math.atan(r/s),e.y=this.radius_g_1*Math.atan(a/pt(r,s)))}else this.shape==="sphere"&&(s=Math.cos(i),n=Math.cos(t)*s,r=Math.sin(t)*s,a=Math.sin(i),s=this.radius_g-n,this.flip_axis?(e.x=this.radius_g_1*Math.atan(r/pt(a,s)),e.y=this.radius_g_1*Math.atan(a/s)):(e.x=this.radius_g_1*Math.atan(r/s),e.y=this.radius_g_1*Math.atan(a/pt(r,s))));return e.x=e.x*this.a,e.y=e.y*this.a,e}function Kg(e){var t=-1,i=0,s=0,n,r,a,o;if(e.x=e.x/this.a,e.y=e.y/this.a,this.shape==="ellipse"){this.flip_axis?(s=Math.tan(e.y/this.radius_g_1),i=Math.tan(e.x/this.radius_g_1)*pt(1,s)):(i=Math.tan(e.x/this.radius_g_1),s=Math.tan(e.y/this.radius_g_1)*pt(1,i));var h=s/this.radius_p;if(n=i*i+h*h+t*t,r=2*this.radius_g*t,a=r*r-4*n*this.C,a<0)return e.x=Number.NaN,e.y=Number.NaN,e;o=(-r-Math.sqrt(a))/(2*n),t=this.radius_g+o*t,i*=o,s*=o,e.x=Math.atan2(i,t),e.y=Math.atan(s*Math.cos(e.x)/t),e.y=Math.atan(this.radius_p_inv2*Math.tan(e.y))}else if(this.shape==="sphere"){if(this.flip_axis?(s=Math.tan(e.y/this.radius_g_1),i=Math.tan(e.x/this.radius_g_1)*Math.sqrt(1+s*s)):(i=Math.tan(e.x/this.radius_g_1),s=Math.tan(e.y/this.radius_g_1)*Math.sqrt(1+i*i)),n=i*i+s*s+t*t,r=2*this.radius_g*t,a=r*r-4*n*this.C,a<0)return e.x=Number.NaN,e.y=Number.NaN,e;o=(-r-Math.sqrt(a))/(2*n),t=this.radius_g+o*t,i*=o,s*=o,e.x=Math.atan2(i,t),e.y=Math.atan(s*Math.cos(e.x)/t)}return e.x=e.x+this.long0,e}var Xg=["Geostationary Satellite View","Geostationary_Satellite","geos"];const Yg={init:Wg,forward:Hg,inverse:Kg,names:Xg};function Zg(e){e.Proj.projections.add(ri),e.Proj.projections.add(ai),e.Proj.projections.add(sf),e.Proj.projections.add(ff),e.Proj.projections.add(vf),e.Proj.projections.add(wf),e.Proj.projections.add(Rf),e.Proj.projections.add(Nf),e.Proj.projections.add(Vf),e.Proj.projections.add(qf),e.Proj.projections.add(h0),e.Proj.projections.add(g0),e.Proj.projections.add(v0),e.Proj.projections.add(S0),e.Proj.projections.add(R0),e.Proj.projections.add(N0),e.Proj.projections.add(V0),e.Proj.projections.add(q0),e.Proj.projections.add(Z0),e.Proj.projections.add(ig),e.Proj.projections.add(og),e.Proj.projections.add(dg),e.Proj.projections.add(_g),e.Proj.projections.add(xg),e.Proj.projections.add(Eg),e.Proj.projections.add(Ng),e.Proj.projections.add(Vg),e.Proj.projections.add(qg),e.Proj.projections.add(Yg)}dt.defaultDatum="WGS84";dt.Proj=wt;dt.WGS84=new dt.Proj("WGS84");dt.Point=fe;dt.toPoint=nr;dt.defs=rt;dt.nadgrid=nd;dt.transform=Ci;dt.mgrs=Cd;dt.version="__VERSION__";Zg(dt);let Qg=null;function Jg(e){Qg=e;const t=Object.keys(e.defs),i=t.length;let s,n;for(s=0;s<i;++s){const r=t[s];if(!Q(r)){const a=e.defs(r);let o=a.units;!o&&a.projName==="longlat"&&(o="degrees"),$a(new En({code:r,axisOrientation:a.axis,metersPerUnit:a.to_meter,units:o}))}}for(s=0;s<i;++s){const r=t[s],a=Q(r);for(n=0;n<i;++n){const o=t[n],h=Q(o);if(!za(r,o))if(e.defs[r]===e.defs[o])Ua([a,h]);else{const l=e(r,o);qa(a,h,Cs(a,h,l.forward),Cs(h,a,l.inverse))}}}}dt.defs("EPSG:3826","+proj=tmerc +lat_0=0 +lon_0=121 +k=0.9999 +x_0=250000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +type=crs");Jg(dt);const xe={getLayer:(e,t,i)=>{var l,c,u;let s,n;const r=e.layer_type,a=e.figure_type,o=e.single_tiles?"":`- ${(l=e.tiles_list[t])==null?void 0:l.title}`,h=[];if(r==="WMS"){const d=e.single_tiles?e.tiles_url:e.tiles_list[t].tile_url;switch(a){case"Point":if(d){const f=new URL(d),g=f.origin,y=f.pathname,m=f.searchParams,p={};for(const[x,b]of m.entries())p[x]=b;h[0]=g+y,h[1]=p}n=new Ut({maxzoom:18,minzoom:3,url:h[0],params:h[1],serverType:"mapserver",crossOrigin:"anonymous"});break;case"Surface":if(d){const f=new URL(d),g=f.origin,y=f.pathname,m=f.searchParams,p={};for(const[x,b]of m.entries())p[x]=b;h[0]=g+y,h[1]=p}n=new Ut({maxzoom:18,minzoom:3,url:h[0],params:h[1],serverType:"mapserver"});break;case"Line":if(d){const f=new URL(d),g=f.origin,y=f.pathname,m=f.searchParams,p={};for(const[x,b]of m.entries())p[x]=b;h[0]=g+y,h[1]=p}n=new Ut({maxzoom:18,minzoom:3,url:h[0],params:h[1],serverType:"mapserver"});break;default:console.log("error-otherWMSLayer:",a)}s=new ue({id:i,label:`${e.title} ${o}`,source:new Ut({name:e.title,url:n.getUrls()[0],params:n.getParams(),serverType:"geoserver",crossOrigin:"anonymous",projection:(c=n.getParams())==null?void 0:c.SRS})})}if(r==="WFS"){const d=new Ht({format:new Xh,url:e.tiles_url,strategy:ho});s=new de({id:i,label:`${e.title} ${o}`,source:d})}if(r==="GeoJson"){const d=e.single_tiles?e.tiles_url:e.tiles_list[t].tile_url;switch(a){case"Line":if(d){const f=new URL(d),{origin:g,pathname:y,searchParams:m}=f,p={};for(const[x,b]of m.entries())p[x]=b;h[0]=g+y,h[1]=p}n=new Ut({maxzoom:18,minzoom:3,url:h[0],params:h[1],serverType:"mapserver"});break;case"Point":if(d){const f=new URL(d),{origin:g,pathname:y,searchParams:m}=f,p={};for(const[x,b]of m.entries())p[x]=b;h[0]=g+y,h[1]=p}n=new Ut({maxzoom:18,minzoom:3,url:h[0],params:h[1],serverType:"mapserver"}),s=new ue({source:n});break;default:console.log("error-otherWMSLayer:",a)}s=new de({source:new Ht({url:n.getUrls()[0],params:n.getParams(),serverType:"geoserver",crossOrigin:"anonymous",projection:(u=n.getParams())==null?void 0:u.SRS})})}if(r==="Image")switch(a){case"Surface":s=new Xi({id:i,label:`${e.title} ${o}`,preload:1/0,extent:e.image_options.image_extent,source:new Fn({url:e.tiles_url,imageExtent:e.image_options.image_extent,minzoom:e.minzoom,maxZoom:e.maxzoom,projection:"EPSG:3857"})});break;default:console.log("error-otherWMSLayer:",a)}return s},getLayerIndex:e=>{let t,i,s;return e?(e.split("_").forEach((n,r)=>{switch(r){case 0:t=Number(n.split("node")[1]);break;case 1:i=Number(n.split("subNode")[1]);break;case 2:s=n.split("nestedSubNode")[1]!=="undefined"?Number(n.split("nestedSubNode")[1]):"undefined";break}}),{nodeIndex:t,subNodeIndex:i,nestedSubNodeIndex:s,layeredIndex:e}):{nodeIndex:t,subNodeIndex:i,nestedSubNodeIndex:s,layeredIndex:e}}};let be=[];const ei={getBaseMapData:e=>{let t;return Number.isInteger(e)?t=be[e]:t=e.layer,new ue({preload:1/0,name:t.name,label:t.label,type:t.mapType,baseId:t.baseId,source:new Rn({url:t.url}),crossOrigin:"anonymous"})},setBaseMapData:e=>{be=e},getCurrentBase:()=>be.filter(e=>e.onCurrent),showBaseMapData:()=>{console.log(be)}};function tm(){return be}const em={props:{onClose:{type:Function,default:()=>{}},mapLayers:{type:Array,default:[]},currentLayers:{type:Array,default:[]},showSelectLayerValue:{type:Function,default:()=>{}},selectLayerOption:{type:Object,default:{}},moveToMap:{type:Function,default:()=>{}}},setup(e,{emit:t}){const i=xe,s=on(),n=$t({DropDown:null,TilesListValue:0});function r(c,u){t("onMapControl",{action:c,value:u})}function a(c,u){t("onLayerControl",{action:c,value:u})}function o(c){n.DropDown!==c?n.DropDown=c:n.DropDown=null}function h(c,u){let d=c.target.checked||typeof c.target.checked>"u";a("layerMode",{checked:d,nodeIndex:u.nodeIndex,subNodeIndex:u.subNodeIndex,nestedSubNodeIndex:String(u.nestedSubNodeIndex)?u.nestedSubNodeIndex:void 0,id:u.single_tiles||!c.target.selectedOptions?u.id:c.target.selectedOptions[0].id})}function l(c){let u=c.target.checked||typeof c.target.checked>"u";a("layerMode",{checked:u})}return an(()=>n.TilesListValue,(c,u)=>{e.showSelectLayerValue(c)}),{props:e,state:n,router:s,mapList:i,onMapControl:r,onLayerControl:a,openLayerList:o,LayerCheckBoxChange:h,checkTribe:l}}},hs=e=>(Ae("data-v-c20f9476"),e=e(),Fe(),e),im={class:"condition bg-white"},sm={class:"row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold border-bottom"},nm=hs(()=>_("p",{class:"mb-0 fs-5"},"圖層選項",-1)),rm=hs(()=>_("svg",{width:"32",height:"32",viewBox:"0 0 24 24"},[_("path",{fill:"currentColor",d:"M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10zm0-11.414L9.172 7.757L7.757 9.172L10.586 12l-2.829 2.828l1.415 1.415L12 13.414l2.828 2.829l1.415-1.415L13.414 12l2.829-2.828l-1.415-1.415L12 10.586z"})],-1)),am=[rm],om={class:"py-3 px-4 content"},hm={class:"mb-2 landBoundary"},lm={class:"mb-2"},cm=["onClick"],um=hs(()=>_("path",{fill:"currentColor",d:"M8 5v14l11-7z"},null,-1)),dm=[um],fm={class:"ms-3 mb-1"},gm={key:0},mm=["checked","onChange"],ym={key:0},_m=["value","data-coordinates"],pm={key:1},vm=["value","data-coordinates"],Cm={key:1},Mm=["checked","onChange"],xm=["onChange"],bm=["value","id"];function wm(e,t,i,s,n,r){return O(),A("div",im,[_("div",sm,[nm,_("div",{class:"closeBtn position-absolute col-auto",onClick:t[0]||(t[0]=$((...a)=>s.props.onClose&&s.props.onClose(...a),["prevent"]))},am)]),_("div",om,[_("div",hm,[(O(!0),A(Nt,null,kt(s.props.mapLayers,(a,o)=>(O(),A("div",lm,[_("div",{class:"title d-flex align-items-center fw-bold text-black order-1 mb-1 text-decoration-none",onClick:h=>s.openLayerList(o)},[_("div",{class:vt(a.groupClass)},null,2),_("div",null,W(a.label),1),(O(),A("svg",{viewBox:"0 0 24 24",class:vt({openTitle:s.state.DropDown==o})},dm,2))],8,cm),s.state.DropDown==o?(O(!0),A(Nt,{key:0},kt(a.layers,(h,l)=>(O(),A("div",fm,[h.single_tiles?(O(),A("div",gm,[_("input",{type:"checkbox",checked:s.props.currentLayers.some(c=>c.id===h.id),onChange:c=>{s.LayerCheckBoxChange(c,{nodeIndex:o,subNode:h,subNodeIndex:l,nestedSubNodeIndex:"",single_tiles:h.single_tiles,id:h.id})}},null,40,mm),Te(" "+W(h.title)+" ",1),s.props.selectLayerOption[h.id]!==void 0&&h.id==="node4_subNode0_nestedSubNodeundefined"?(O(),A("div",ym,[_("select",{name:"",id:"",onChange:t[1]||(t[1]=(...c)=>s.props.moveToMap&&s.props.moveToMap(...c))},[(O(!0),A(Nt,null,kt(s.props.selectLayerOption[h.id],(c,u)=>(O(),A("option",{value:u,"data-coordinates":c.tribeCode},W(c.tribeName),9,_m))),256))],32)])):K("",!0),s.props.selectLayerOption[h.id]!==void 0&&h.id==="node7_subNode0_nestedSubNodeundefined"?(O(),A("div",pm,[_("select",{name:"",id:"",onChange:t[2]||(t[2]=(...c)=>s.props.moveToMap&&s.props.moveToMap(...c))},[(O(!0),A(Nt,null,kt(s.props.selectLayerOption[h.id],(c,u)=>(O(),A("option",{value:u,"data-coordinates":c.geometry.coordinates},W(c.properties.事件),9,vm))),256))],32)])):K("",!0)])):(O(),A("div",Cm,[_("input",{type:"checkbox",checked:s.props.currentLayers.some(c=>{let u=s.mapList.getLayerIndex(c.id);return u.nodeIndex==o&&u.subNodeIndex==l}),onChange:c=>{s.LayerCheckBoxChange(c,{nodeIndex:o,subNode:h,subNodeIndex:l,nestedSubNodeIndex:"",single_tiles:h.single_tiles,id:h.id})}},null,40,Mm),Te(" "+W(h.title)+" ",1),hn(_("select",{name:"",id:"",class:"ms-3","onUpdate:modelValue":t[3]||(t[3]=c=>s.state.TilesListValue=c),onChange:c=>{s.LayerCheckBoxChange(c,{nodeIndex:o,subNode:h,subNodeIndex:l,nestedSubNodeIndex:s.state.TilesListValue,single_tiles:h.single_tiles,id:h.id})}},[(O(!0),A(Nt,null,kt(h.tiles_list,(c,u)=>(O(),A("option",{value:u,id:c.id},W(c.title),9,bm))),256))],40,xm),[[ln,s.state.TilesListValue]])]))]))),256)):K("",!0)]))),256))])])])}const Sm=Ot(em,[["render",wm],["__scopeId","data-v-c20f9476"]]),Tm="/Map_Demo/assets/2D-70e1bbad.svg",Em="/Map_Demo/assets/3D-cb71f302.svg",Lm="/Map_Demo/assets/baseLayer-3608307c.svg",pr="/Map_Demo/assets/singleWindow-1afc73e5.svg",vr="/Map_Demo/assets/doubleWindows-82f012fb.svg";const Pm={props:{currentLayers:{type:Array,default:[]},mapCount:{type:Number,default:1},dimensionMapStatus:{type:Boolean,default:!1}},setup(e,{emit:t}){const i=$t({toolSwitch:{threeDimensionalBtn:!1,layerConditionBtn:!1,splitWindowBtn:!1},targetNum:1});function s(o,h){Object.keys(i.toolSwitch).forEach(l=>{l===o?i.toolSwitch[o]?i.toolSwitch[o]=!1:i.toolSwitch[o]=!0:i.toolSwitch[l]=!1})}function n(o,h){o==="changeMapCount"&&(i.toolSwitch.splitWindowBtn=!1),t("onLayerControl",{action:o,value:h})}function r(){t("conditionWrap")}function a(o){i.targetNum=o,t("onChangeTarget",o)}return{props:e,state:i,toolSwitch:s,onLayerControl:n,conditionWrap:r,onChangeTarget:a}}},ze=e=>(Ae("data-v-ad9286bd"),e=e(),Fe(),e),Rm={class:"list-unstyled d-flex align-items-center flex-nowrap w-full"},Om={class:"me-4 position-relative"},Am={class:"MapFeatureBtn text-white"},Fm=ze(()=>_("img",{src:Tm},null,-1)),Im=[Fm],Nm=ze(()=>_("img",{src:Em},null,-1)),km=[Nm],Dm={class:"me-4 position-relative"},Gm=ze(()=>_("img",{src:Lm,alt:""},null,-1)),jm=[Gm],Vm={class:"me-4 position-relative"},Bm={key:0,src:pr,alt:""},$m={key:1,src:vr,alt:""},zm={key:0,class:"list-unstyled position-absolute start-0 top-100 p-0"},Um={class:"mt-2"},qm=ze(()=>_("img",{src:pr,alt:""},null,-1)),Wm=[qm],Hm={class:"mt-2"},Km=ze(()=>_("img",{src:vr,alt:""},null,-1)),Xm=[Km],Ym={class:"switchControl d-flex position-fixed rounded-pill translate-middle-x p-2",id:"switchControl",style:{"z-index":"99"}};function Zm(e,t,i,s,n,r){return O(),A("div",null,[_("ul",Rm,[_("li",Om,[_("div",Am,[s.props.dimensionMapStatus?(O(),A("a",{key:0,href:"",onClick:t[0]||(t[0]=$(a=>(s.toolSwitch("threeDimensionalBtn"),s.onLayerControl("changeDimensionMap","3D")),["prevent"]))},Im)):(O(),A("a",{key:1,href:"",onClick:t[1]||(t[1]=$(a=>(s.toolSwitch("threeDimensionalBtn"),s.onLayerControl("changeDimensionMap","2D")),["prevent"]))},km))])]),_("li",Dm,[_("a",{href:"",class:"MapFeatureBtn text-white",onClick:t[2]||(t[2]=$(a=>(s.toolSwitch("layerConditionBtn"),s.conditionWrap()),["prevent"]))},jm)]),_("li",Vm,[_("a",{href:"",class:"MapFeatureBtn text-white",onClick:t[3]||(t[3]=$(a=>s.toolSwitch("splitWindowBtn"),["prevent"]))},[s.props.mapCount===1?(O(),A("img",Bm)):K("",!0),s.props.mapCount===2?(O(),A("img",$m)):K("",!0)]),s.state.toolSwitch.splitWindowBtn?(O(),A("ul",zm,[_("li",Um,[_("a",{href:"",class:"text-white MapFeatureBtn",onClick:t[4]||(t[4]=$(a=>s.onLayerControl("changeMapCount",{qty:1}),["prevent"]))},Wm)]),_("li",Hm,[_("a",{href:"",class:"text-white MapFeatureBtn",onClick:t[5]||(t[5]=$(a=>s.onLayerControl("changeMapCount",{qty:2}),["prevent"]))},Xm)])])):K("",!0)])]),_("div",Ym,[_("div",{class:vt(["fs-3 text-white rounded-pill",{active:s.state.targetNum===1}]),onClick:t[6]||(t[6]=()=>{s.onChangeTarget(1)})},"左",2),_("div",{class:vt(["fs-3 text-white rounded-pill",{active:s.state.targetNum===2}]),onClick:t[7]||(t[7]=()=>{s.onChangeTarget(2)})},"右",2)])])}const Qm=Ot(Pm,[["render",Zm],["__scopeId","data-v-ad9286bd"]]);const Jm={props:{baseMapList:{type:Array,default:[]},onChangeBaseMaps:{type:Function,default:()=>{}}},setup(e,{emit:t}){const i=$t({selectMap:0,mapSourceList:[]});function s(){let n="baseMap",r=e.baseMapList.find(a=>a.baseId===i.selectMap);e.onChangeBaseMaps({action:n,value:r})}return bi(async()=>{i.selectMap=0}),{state:i,props:e,onChangeBaseMaps:s}}},t1=["value"];function e1(e,t,i,s,n,r){return O(),A("div",null,[hn(_("select",{name:"",id:"","onUpdate:modelValue":t[0]||(t[0]=a=>s.state.selectMap=a),onChange:t[1]||(t[1]=a=>{s.onChangeBaseMaps(a)})},[(O(!0),A(Nt,null,kt(s.props.baseMapList,(a,o)=>(O(),A("option",{key:o,value:a.baseId},W(a.label),9,t1))),128))],544),[[ln,s.state.selectMap]])])}const i1=Ot(Jm,[["render",e1],["__scopeId","data-v-572edea1"]]),s1="/Map_Demo/assets/zoomIn-c80b5dd3.svg",n1="/Map_Demo/assets/zoomOut-88993246.svg",r1="/Map_Demo/assets/compass-1c1efd7a.svg",a1="/Map_Demo/assets/location-b52d62b2.svg",o1="/Map_Demo/assets/zoom-8acdf5b3.svg",h1={props:{id:{Type:String,default:0},map:{}},setup(e,{emit:t}){function i(s){t("onMapControl",{action:s})}return{onMapControl:i}}},l1={class:"d-flex flex-nowrap flex-column"},c1=_("img",{src:s1,alt:"zoomIn"},null,-1),u1=[c1],d1=_("img",{src:n1,alt:"zoomOut"},null,-1),f1=[d1],g1=_("img",{src:r1,alt:"compass"},null,-1),m1=[g1],y1=_("img",{src:a1,alt:"location"},null,-1),_1=[y1],p1=_("img",{src:o1,alt:"zoom"},null,-1),v1=[p1];function C1(e,t,i,s,n,r){return O(),A("div",l1,[_("a",{href:"",class:"d-none d-sm-block order-1 mb-0",onClick:t[0]||(t[0]=$(a=>s.onMapControl("In"),["prevent"]))},u1),_("a",{href:"",class:"d-none d-sm-block order-1 mb-2",onClick:t[1]||(t[1]=$(a=>s.onMapControl("Out"),["prevent"]))},f1),_("a",{href:"",class:"order-1 mb-2",onClick:t[2]||(t[2]=$(a=>s.onMapControl("toNorth"),["prevent"]))},m1),_("a",{href:"",class:"order-1 mb-2",onClick:t[3]||(t[3]=$(a=>s.onMapControl("moveTo"),["prevent"]))},_1),_("a",{href:"",class:"order-1 mb-2",onClick:t[4]||(t[4]=$(a=>s.onMapControl("fullScreen"),["prevent"]))},v1)])}const M1=Ot(h1,[["render",C1]]);window.ol&&ol.ext&&!ol.ext.input&&(ol.ext.input={});var x1=class extends fn{constructor(t){t=t||{},super();var i=this.input=t.input;i||(i=this.input=document.createElement("INPUT"),t.type&&i.setAttribute("type",t.type),t.min!==void 0&&i.setAttribute("min",t.min),t.max!==void 0&&i.setAttribute("max",t.max),t.step!==void 0&&i.setAttribute("step",t.step),t.parent&&t.parent.appendChild(i)),t.disabled&&(i.disabled=!0),t.checked!==void 0&&(i.checked=!!t.checked),t.val!==void 0&&(i.value=t.val),t.hidden&&(i.style.display="none"),i.addEventListener("focus",function(){this.element&&this.element.classList.add("ol-focus")}.bind(this));var s;i.addEventListener("focusout",function(){this.element&&(s&&clearTimeout(s),s=setTimeout(function(){this.element.classList.remove("ol-focus")}.bind(this),0))}.bind(this))}_listenDrag(t,i){var s=function(n){this.moving=!0,this.element.classList.add("ol-moving");var r=function(a){a.type==="pointerup"&&(document.removeEventListener("pointermove",r),document.removeEventListener("pointerup",r),document.removeEventListener("pointercancel",r),setTimeout(function(){this.moving=!1,this.element.classList.remove("ol-moving")}.bind(this))),a.target===t&&i(a),a.stopPropagation(),a.preventDefault()}.bind(this);document.addEventListener("pointermove",r,!1),document.addEventListener("pointerup",r,!1),document.addEventListener("pointercancel",r,!1),n.stopPropagation(),n.preventDefault()}.bind(this);t.addEventListener("mousedown",s,!1),t.addEventListener("touchstart",s,!1)}setValue(t){t!==void 0&&(this.input.value=t),this.input.dispatchEvent(new Event("change"))}getValue(){return this.input.value}getInputElement(){return this.input}},ls=class extends x1{constructor(t){t=t||{},super(t);var i=this.element=document.createElement("LABEL");t.html instanceof Element?i.appendChild(t.html):t.html!==void 0&&(i.innerHTML=t.html),i.className=("ol-ext-check ol-ext-checkbox "+(t.className||"")).trim(),this.input.parentNode&&this.input.parentNode.insertBefore(i,this.input),i.appendChild(this.input),i.appendChild(document.createElement("SPAN")),t.after&&i.appendChild(document.createTextNode(t.after)),this.input.addEventListener("change",function(){this.dispatchEvent({type:"check",checked:this.input.checked,value:this.input.value})}.bind(this))}isChecked(){return this.input.checked}},b1=class extends ls{constructor(t){t=t||{},super(t),this.element.className=("ol-ext-toggle-switch "+(t.className||"")).trim()}},w1=class extends ls{constructor(t){t=t||{},super(t),this.element.className=("ol-ext-check ol-ext-radio "+(t.className||"")).trim()}},I={};I.create=function(e,t){t=t||{};var i;if(e==="TEXT")i=document.createTextNode(t.html||""),t.parent&&t.parent.appendChild(i);else{i=document.createElement(e),/button/i.test(e)&&i.setAttribute("type","button");for(var s in t)switch(s){case"className":{t.className&&t.className.trim&&i.setAttribute("class",t.className.trim());break}case"text":{i.innerText=t.text;break}case"html":{t.html instanceof Element?i.appendChild(t.html):t.html!==void 0&&(i.innerHTML=t.html);break}case"parent":{t.parent&&t.parent.appendChild(i);break}case"options":{if(/select/i.test(e))for(var n in t.options)I.create("OPTION",{html:n,value:t.options[n],parent:i});break}case"style":{I.setStyle(i,t.style);break}case"change":case"click":{I.addListener(i,s,t[s]);break}case"on":{for(var r in t.on)I.addListener(i,r,t.on[r]);break}case"checked":{i.checked=!!t.checked;break}default:{i.setAttribute(s,t[s]);break}}}return i};I.createSwitch=function(e){var t=I.create("INPUT",{type:"checkbox",on:e.on,click:e.click,change:e.change,parent:e.parent}),i=Object.assign({input:t},e||{});return new b1(i),t};I.createCheck=function(e){var t=I.create("INPUT",{name:e.name,type:e.type==="radio"?"radio":"checkbox",on:e.on,parent:e.parent}),i=Object.assign({input:t},e||{});return e.type==="radio"?new w1(i):new ls(i),t};I.setHTML=function(e,t){t instanceof Element?e.appendChild(t):t!==void 0&&(e.innerHTML=t)};I.appendText=function(e,t){e.appendChild(document.createTextNode(t||""))};I.addListener=function(e,t,i,s){typeof t=="string"&&(t=t.split(" ")),t.forEach(function(n){e.addEventListener(n,i,s)})};I.removeListener=function(e,t,i){typeof t=="string"&&(t=t.split(" ")),t.forEach(function(s){e.removeEventListener(s,i)})};I.show=function(e){e.style.display=""};I.hide=function(e){e.style.display="none"};I.hidden=function(e){return I.getStyle(e,"display")==="none"};I.toggle=function(e){e.style.display=e.style.display==="none"?"":"none"};I.setStyle=function(e,t){for(var i in t)switch(i){case"top":case"left":case"bottom":case"right":case"minWidth":case"maxWidth":case"width":case"height":{typeof t[i]=="number"?e.style[i]=t[i]+"px":e.style[i]=t[i];break}default:e.style[i]=t[i]}};I.getStyle=function(e,t){var i,s=(e.ownerDocument||document).defaultView;if(s&&s.getComputedStyle)t=t.replace(/([A-Z])/g,"-$1").toLowerCase(),i=s.getComputedStyle(e,null).getPropertyValue(t);else if(e.currentStyle&&(t=t.replace(/-(\w)/g,function(n,r){return r.toUpperCase()}),i=e.currentStyle[t],/^\d+(em|pt|%|ex)?$/i.test(i)))return function(n){var r=e.style.left,a=e.runtimeStyle.left;return e.runtimeStyle.left=e.currentStyle.left,e.style.left=n||0,n=e.style.pixelLeft+"px",e.style.left=r,e.runtimeStyle.left=a,n}(i);return/px$/.test(i)?parseInt(i):i};I.outerHeight=function(e){return e.offsetHeight+I.getStyle(e,"marginBottom")};I.outerWidth=function(e){return e.offsetWidth+I.getStyle(e,"marginLeft")};I.offsetRect=function(e){var t=e.getBoundingClientRect();return{top:t.top+(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0),left:t.left+(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0),height:t.height||t.bottom-t.top,width:t.width||t.right-t.left}};I.getFixedOffset=function(e){var t={left:0,top:0},i=function(s){if(!s)return t;if(I.getStyle(s,"position")==="absolute"&&I.getStyle(s,"transform")!=="none"){var n=s.getBoundingClientRect();return t.left+=n.left,t.top+=n.top,t}return i(s.offsetParent)};return i(e.offsetParent)};I.positionRect=function(e,t){var i=0,s=0,n=function(r){if(r)return i+=r.offsetLeft,s+=r.offsetTop,n(r.offsetParent);var a={top:e.offsetTop+s,left:e.offsetLeft+i};return t&&(a.top-=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,a.left-=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0),a.bottom=a.top+e.offsetHeight,a.right=a.top+e.offsetWidth,a};return n(e.offsetParent)};I.scrollDiv=function(e,t){t=t||{};var i=!1,s=0,n,r=0,a=typeof t.onmove=="function"?t.onmove:function(){},o=t.vertical?"screenY":"screenX",h=t.vertical?"scrollTop":"scrollLeft",l=!1,c,u,d=0,f=function(){b&&(d++,setTimeout(g))},g=function(){if(b){if(d--,d)return;var C=e.clientHeight,T=e.scrollHeight;c=C/T,b.style.height=c*100+"%",b.style.top=e.scrollTop/T*100+"%",x.style.height=C+"px",C>T-.5?x.classList.add("ol-100pc"):x.classList.remove("ol-100pc")}},y=function(C){C.target.classList.contains("ol-noscroll")||(l=!1,i=C[o],r=new Date,e.classList.add("ol-move"),C.preventDefault(),window.addEventListener("pointermove",m),I.addListener(window,["pointerup","pointercancel"],v))},m=function(C){if(i!==!1){var T=(u?-1/c:1)*(i-C[o]);l=l||Math.round(T),e[h]+=T,n=new Date,n-r&&(s=(s+T/(n-r))/2),i=C[o],r=n,T&&a(!0)}else l=!0},p=function(C){var T=C>0?Math.min(100,C/2):Math.max(-100,C/2);C-=T,e[h]+=T,-1<C&&C<1?(l?setTimeout(function(){e.classList.remove("ol-move")}):e.classList.remove("ol-move"),l=!1,a(!1)):setTimeout(function(){p(C)},40)},x,b;if(t.vertical&&t.minibar){var M=function(C){e.removeEventListener("pointermove",M),e.parentNode.classList.add("ol-miniscroll"),b=I.create("DIV"),x=I.create("DIV",{className:"ol-scroll",html:b}),e.parentNode.insertBefore(x,e),b.addEventListener("pointerdown",function(T){u=!0,y(T)}),t.mousewheel&&(I.addListener(x,["mousewheel","DOMMouseScroll","onmousewheel"],function(T){w(T)}),I.addListener(b,["mousewheel","DOMMouseScroll","onmousewheel"],function(T){w(T)})),e.parentNode.addEventListener("pointerenter",f),window.addEventListener("resize",f),C!==!1&&f()};e.parentNode?M(!1):e.addEventListener("pointermove",M),e.addEventListener("scroll",function(){f()})}e.style["touch-action"]="none",e.style.overflow="hidden",e.classList.add("ol-scrolldiv"),I.addListener(e,["pointerdown"],function(C){u=!1,y(C)}),e.addEventListener("click",function(C){e.classList.contains("ol-move")&&(C.preventDefault(),C.stopPropagation())},!0);var v=function(C){r=new Date-r,r>100||u?s=0:r>0&&(s=((s||0)+(i-C[o])/r)/2),p(t.animate===!1?0:s*200),i=!1,s=0,r=0,e.classList.contains("ol-move")?e.classList.remove("ol-hasClick"):(e.classList.add("ol-hasClick"),setTimeout(function(){e.classList.remove("ol-hasClick")},500)),u=!1,window.removeEventListener("pointermove",m),I.removeListener(window,["pointerup","pointercancel"],v)},w=function(C){var T=Math.max(-1,Math.min(1,C.wheelDelta||-C.detail));return e.classList.add("ol-move"),e[h]-=T*30,e.classList.remove("ol-move"),!1};return t.mousewheel&&I.addListener(e,["mousewheel","DOMMouseScroll","onmousewheel"],w),{refresh:f}};I.dispatchEvent=function(e,t){var i;try{i=new CustomEvent(e)}catch{i=document.createEvent("CustomEvent"),i.initCustomEvent(e,!0,!0,{})}t.dispatchEvent(i)};var q={};q.getTransform=function(e){var t=window.getComputedStyle(e,null),i=t.getPropertyValue("-webkit-transform")||t.getPropertyValue("-moz-transform")||t.getPropertyValue("-ms-transform")||t.getPropertyValue("-o-transform")||t.getPropertyValue("transform"),s=i.split("(")[1].split(")")[0].split(","),n=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],r,a;if(s.length===16)for(r=0;r<4;++r)for(a=0;a<4;++a)n[a][r]=+s[r*4+a];else for(r=0;r<3;++r)for(a=0;a<2;++a)n[a][r]=+s[r*2+a];return n};q.getTransformOrigin=function(e){for(var t=window.getComputedStyle(e,null),i=t.getPropertyValue("-webkit-transform-origin")||t.getPropertyValue("-moz-transform-origin")||t.getPropertyValue("-ms-transform-origin")||t.getPropertyValue("-o-transform-origin")||t.getPropertyValue("transform-origin"),s=i.split(" "),n=[0,0,0,1],r=0;r<s.length;++r)n[r]=parseInt(s[r]);return n};q.translateMatrix=function(e,t,i){return[[1,0,0,e],[0,1,0,t],[0,0,1,i],[0,0,0,1]]};q.identity=function(){return[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]]};q.roundTo=function(e,t){t||(t=1e-10);for(var i=[[],[],[],[]],s=0;s<4;s++)for(var n=0;n<4;n++)i[s][n]=Math.round(e[s][n]/t)*t;return i};q.multiply=function(e,t){for(var i=[[],[],[],[]],s=0;s<4;++s)for(var n=0;n<4;++n){for(var r=0,a=0;a<4;++a)r+=e[a][s]*t[n][a];i[n][s]=r}return i};q.computeTransformMatrix=function(e,t){var i=q.translateMatrix(-t[0],-t[1],-t[2]),s=q.translateMatrix(t[0],t[1],t[2]),n=q.multiply(i,e);return q.multiply(n,s)};q.transformVertex=function(e,t){for(var i=[t[0],t[1],0,1],s=[],n=0;n<4;++n){s[n]=0;for(var r=0;r<4;++r)s[n]+=+e[n][r]*i[r]}return s};q.projectVertex=function(e){for(var t=[],i=0;i<4;++i)t[i]=e[i]/e[3];return t};q.inverse=function(e){var t=e[0][0]*e[1][1]-e[1][0]*e[0][1],i=e[0][0]*e[1][2]-e[1][0]*e[0][2],s=e[0][0]*e[1][3]-e[1][0]*e[0][3],n=e[0][1]*e[1][2]-e[1][1]*e[0][2],r=e[0][1]*e[1][3]-e[1][1]*e[0][3],a=e[0][2]*e[1][3]-e[1][2]*e[0][3],o=e[2][2]*e[3][3]-e[3][2]*e[2][3],h=e[2][1]*e[3][3]-e[3][1]*e[2][3],l=e[2][1]*e[3][2]-e[3][1]*e[2][2],c=e[2][0]*e[3][3]-e[3][0]*e[2][3],u=e[2][0]*e[3][2]-e[3][0]*e[2][2],d=e[2][0]*e[3][1]-e[3][0]*e[2][1],f=1/(t*o-i*h+s*l+n*c-r*u+a*d);if(isNaN(f)||f===1/0)throw new Error("Inverse determinant attempted to divide by zero.");return[[(e[1][1]*o-e[1][2]*h+e[1][3]*l)*f,(-e[0][1]*o+e[0][2]*h-e[0][3]*l)*f,(e[3][1]*a-e[3][2]*r+e[3][3]*n)*f,(-e[2][1]*a+e[2][2]*r-e[2][3]*n)*f],[(-e[1][0]*o+e[1][2]*c-e[1][3]*u)*f,(e[0][0]*o-e[0][2]*c+e[0][3]*u)*f,(-e[3][0]*a+e[3][2]*s-e[3][3]*i)*f,(e[2][0]*a-e[2][2]*s+e[2][3]*i)*f],[(e[1][0]*h-e[1][1]*c+e[1][3]*d)*f,(-e[0][0]*h+e[0][1]*c-e[0][3]*d)*f,(e[3][0]*r-e[3][1]*s+e[3][3]*t)*f,(-e[2][0]*r+e[2][1]*s-e[2][3]*t)*f],[(-e[1][0]*l+e[1][1]*u-e[1][2]*d)*f,(e[0][0]*l-e[0][1]*u+e[0][2]*d)*f,(-e[3][0]*n+e[3][1]*i-e[3][2]*t)*f,(e[2][0]*n-e[2][1]*i+e[2][2]*t)*f]]};var S1=class extends oe{constructor(t){var i=t.target instanceof Element?t.target:document.getElementById(t.target);window.getComputedStyle(i).position!=="absolute"&&(i.style.position="relative"),i.style.overflow="hidden";var s=I.create("DIV",{className:"ol-perspective-map",parent:i}),n={};Object.assign(n,t),n.target=s,super(n),this._tiltCondition=t.tiltCondition||Wa}getPixelRatio(){return window.devicePixelRatio}setPerspective(t,i){i=i||{},t>30?t=30:t<0&&(t=0);var s=this._angle||0,n=Math.round(t*10)/10,r=this.getTarget().querySelector(".ol-layers").style;cancelAnimationFrame(this._animatedPerspective),requestAnimationFrame(function(a){this._animatePerpective(a,a,r,s,n,i.duration,i.easing||Ms)}.bind(this))}_animatePerpective(t,i,s,n,r,a,o){var h,l;a===0?(h=1,l=!0):(h=(i-t)/(a||500),l=h>=1),h=o(h);var c;l?c=this._angle=r:c=this._angle=n+(r-n)*h;var u=c/30;s.transform="translateY(-"+17*u+"%) perspective(200px) rotateX("+c+"deg) scaleY("+(1-u/2)+")",this.getMatrix3D(!0),this.render(),l||requestAnimationFrame(function(d){this._animatePerpective(t,d,s,n,r,a||500,o||Ms)}.bind(this)),this.dispatchEvent({type:"change:perspective",angle:c,animating:!l})}handleMapBrowserEvent(t){if(t.pixel=[t.originalEvent.offsetX/this.getPixelRatio(),t.originalEvent.offsetY/this.getPixelRatio()],t.coordinate=this.getCoordinateFromPixel(t.pixel),oe.prototype.handleMapBrowserEvent.call(this,t),this._tiltCondition(t))switch(t.type){case"pointerdown":{this._dragging=t.originalEvent.offsetY;break}case"pointerup":{this._dragging=!1;break}case"pointerdrag":{if(this._dragging!==!1){var i=t.originalEvent.offsetY>this._dragging?.5:-.5;i&&this.setPerspective((this._angle||0)+i,{duration:0}),this._dragging=t.originalEvent.offsetY}break}}else this._dragging=!1}getMatrix3D(t){if(t){var i=this.getTarget().querySelector(".ol-layers"),s=q.getTransform(i),n=q.getTransformOrigin(i);this._matrixTransform=q.computeTransformMatrix(s,n)}return this._matrixTransform||(this._matrixTransform=q.identity()),this._matrixTransform}getPixelScreenFromCoordinate(t){var i=this.getPixelFromCoordinate(t),s=this.getMatrix3D(),n=q.transformVertex(s,i);return n=q.projectVertex(n),[n[0],n[1]]}getPixelFromPixelScreen(t){var i=q.inverse(this.getMatrix3D()),s=q.transformVertex(i,t);return s=q.projectVertex(s),[s[0],s[1]]}};(function(){var e=di.prototype.updatePixelPosition;di.prototype.updatePixelPosition=function(){var t=this.getMap();if(t&&t instanceof S1){var i=this.getPosition();if(!t||!t.isRendered()||!i){this.setVisible(!1);return}var s=t.getPixelScreenFromCoordinate(i),n=t.getSize();s[0]-=n[0]/4,s[1]-=n[1]/4,this.updateRenderedPosition(s,n)}else e.call(this)}})();const z={};z.obj=function(e){return e};z.supportsImageRenderingPixelatedResult_=void 0;z.imageRenderingValueResult_=void 0;z.supportsImageRenderingPixelated=function(){if(z.supportsImageRenderingPixelatedResult_===void 0){const e=document.createElement("canvas");e.setAttribute("style","image-rendering: -moz-crisp-edges; image-rendering: pixelated;");const t=e.style.imageRendering;z.supportsImageRenderingPixelatedResult_=!!t,z.supportsImageRenderingPixelatedResult_&&(z.imageRenderingValueResult_=t)}return z.supportsImageRenderingPixelatedResult_};z.imageRenderingValue=function(){return z.supportsImageRenderingPixelated(),z.imageRenderingValueResult_||""};z.getSourceProjection=function(e){return e.get("olcs.projection")||e.getProjection()};function re(e,t,i){return e.on(t,i)}let T1=0;function Y(e){return e.olcs_uid||(e.olcs_uid=++T1)}function E1(e,t){const i=e.length,s=Array(e.length);for(let n=0;n<i;n++)s[n]={index:n,value:e[n]};s.sort((n,r)=>t(n.value,r.value)||n.index-r.index);for(let n=0;n<e.length;n++)e[n]=s[n].value}function L1(e){return e&&e.parentNode?e.parentNode.removeChild(e):null}function P1(e){for(;e.lastChild;)e.removeChild(e.lastChild)}function Ai(e){const t=Cesium.GroundPolylinePrimitive;return t&&t.isSupported(e)}const R1=function(){const t=new Ha({projection:"EPSG:3857",wrapX:!0}).getTileCoordForTileUrlFunction([6,-31,22]);return t&&t[1]===33&&t[2]===22}();class Cr{constructor(t,i,s){this.source_=i,this.projection_=null,this.fallbackProj_=s||null,this.ready_=!1,this.tilingScheme_=null,this.rectangle_=null,this.map_=t,this.shouldRequestNextLevel=!1;const n=this.source_.get("olcs.proxy");n&&(typeof n=="function"?this.proxy_={getURL:n}:typeof n=="string"&&(this.proxy_=new Cesium.DefaultProxy(n))),this.errorEvent_=new Cesium.Event,this.emptyCanvas_=document.createElement("canvas"),this.emptyCanvas_.width=1,this.emptyCanvas_.height=1,this.source_.on("change",r=>{this.handleSourceChanged_()}),this.handleSourceChanged_()}handleSourceChanged_(t){if(!this.ready_&&this.source_.getState()=="ready"){this.projection_=z.getSourceProjection(this.source_)||this.fallbackProj_;const i={numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1};if(this.source_.tileGrid!==null&&this.source_.tileGrid.forEachTileCoord(this.projection_.getExtent(),0,([s,n,r])=>{i.numberOfLevelZeroTilesX=n+1,i.numberOfLevelZeroTilesY=r+1}),this.projection_.getCode()==="EPSG:4326")this.shouldRequestNextLevel=i.numberOfLevelZeroTilesX===1&&i.numberOfLevelZeroTilesY===1,this.tilingScheme_=new Cesium.GeographicTilingScheme(i);else if(this.projection_.getCode()==="EPSG:3857")this.shouldRequestNextLevel=!1,this.tilingScheme_=new Cesium.WebMercatorTilingScheme(i);else return;this.rectangle_=this.tilingScheme_.rectangle,this.ready_=!0}}getTileCredits(t,i,s){const n=this.source_.getAttributions();if(!n)return[];const r=this.map_.getView().calculateExtent(this.map_.getSize()),a=this.map_.getView().getCenter(),o=this.shouldRequestNextLevel?s+1:s;return Mr(n,o,a,r)}requestImage(t,i,s){const n=this.source_.getTileUrlFunction();if(n&&this.projection_){const r=this.shouldRequestNextLevel?s+1:s;let a=i;R1||(a=-i-1);let o=n.call(this.source_,[r,t,a],1,this.projection_);return this.proxy_&&(o=this.proxy_.getURL(o)),o?Cesium.ImageryProvider.loadImage(this,o):this.emptyCanvas_}else return this.emptyCanvas_}}Object.defineProperties(Cr.prototype,{ready:{get:function(){return this.ready_}},rectangle:{get:function(){return this.rectangle_}},tileWidth:{get:function(){const e=this.source_.getTileGrid();return e?Array.isArray(e.getTileSize(0))?e.getTileSize(0)[0]:e.getTileSize(0):256}},tileHeight:{get:function(){const e=this.source_.getTileGrid();return e?Array.isArray(e.getTileSize(0))?e.getTileSize(0)[1]:e.getTileSize(0):256}},maximumLevel:{get:function(){const e=this.source_.getTileGrid();return e?e.getMaxZoom():18}},minimumLevel:{get:function(){return 0}},tilingScheme:{get:function(){return this.tilingScheme_}},tileDiscardPolicy:{get:function(){}},errorEvent:{get:function(){return this.errorEvent_}},proxy:{get:function(){return this.proxy_}},hasAlphaChannel:{get:function(){return!0}},pickFeatures:{get:function(){}}});const O1=new Th,A1=[new On({stroke:new lo({color:"blue",width:2})})];class F1{constructor(t){this.urls=t.urls,this.ready=!0,this.readyPromise=Promise.resolve(!0),this.tileWidth=256,this.tileHeight=256,this.maximumLevel=t.maximumLevel||20,this.minimumLevel=t.minimumLevel||0,this.tilingScheme=new Cesium.WebMercatorTilingScheme,this.rectangle=t.rectangle||this.tilingScheme.rectangle,this.errorEvent=new Cesium.Event,this.credit=t.credit,this.hasAlphaChannel=!0,this.styleFunction_=t.styleFunction||(()=>A1),this.projection_=Q("EPSG:3857"),this.emptyCanvas_=document.createElement("canvas"),this.emptyCanvas_.width=1,this.emptyCanvas_.height=1,this.tileRectangle_=new Cesium.Rectangle;const i=t.cacheSize!==void 0?t.cacheSize:50;this.tileCache=new xs(i),this.featureCache=t.featureCache||new xs(i);const s=Ka(this.projection_);this.tileFunction_=Xa(this.urls,s)}getTileCredits(){return[]}pickFeatures(){}getTileFeatures(t,i,s){const n=this.getCacheKey_(t,i,s);let r;if(this.featureCache.containsKey(n)&&(r=this.featureCache.get(n)),!r){const a=this.getUrl_(t,i,s);if(r=fetch(a).then(o=>o.ok?o:Promise.reject(o)).then(o=>o.arrayBuffer()).then(o=>this.readFeaturesFromBuffer(o)),this.featureCache.set(n,r),this.featureCache.getCount()>2*this.featureCache.highWaterMark)for(;this.featureCache.canExpireCache();)this.featureCache.pop()}return r}readFeaturesFromBuffer(t){let i;const s=O1.readFeatures(t,i),n=this.tileWidth/4096;return s.forEach(r=>{const a=r.getFlatCoordinates();for(let o=0;o<a.length;++o)a[o]*=n}),s}getUrl_(t,i,s){return this.tileFunction_([t,i,s])}getCacheKey_(t,i,s){return`${t}_${i}_${s}`}requestImage(t,i,s,n){if(s<this.minimumLevel)return this.emptyCanvas_;try{const r=this.getCacheKey_(s,t,i);let a;if(this.tileCache.containsKey(r)&&(a=this.tileCache.get(r)),!a&&(a=this.getTileFeatures(s,t,i).then(o=>{this.tilingScheme.tileXYToNativeRectangle(t,i,s,this.tileRectangle_);const h=(this.tileRectangle_.east-this.tileRectangle_.west)/this.tileWidth;return this.rasterizeFeatures(o,this.styleFunction_,h)}),this.tileCache.set(r,a),this.tileCache.getCount()>2*this.tileCache.highWaterMark))for(;this.tileCache.canExpireCache();)this.tileCache.pop();return a}catch(r){console.trace(r),this.raiseEvent("could not render pbf to tile",r)}}rasterizeFeatures(t,i,s){const n=document.createElement("canvas"),r=Bo(n.getContext("2d"),{size:[this.tileWidth,this.tileHeight]});return t.forEach(a=>{const o=i(a,s);o&&o.forEach(h=>{r.setStyle(h),r.drawGeometry(a)})}),n}}const R={};R.computePixelSizeAtCoordinate=function(e,t){const i=e.camera,s=e.canvas,n=i.frustum,r=Cesium.Cartesian3.magnitude(Cesium.Cartesian3.subtract(i.position,t,new Cesium.Cartesian3));return n.getPixelDimensions(s.clientWidth,s.clientHeight,r,e.pixelRatio,new Cesium.Cartesian2)};R.computeBoundingBoxAtTarget=function(e,t,i){const s=R.computePixelSizeAtCoordinate(e,t),n=Cesium.Transforms.eastNorthUpToFixedFrame(t),r=Cesium.Matrix4.multiplyByPoint(n,new Cesium.Cartesian3(-s.x*i,-s.y*i,0),new Cesium.Cartesian3),a=Cesium.Matrix4.multiplyByPoint(n,new Cesium.Cartesian3(s.x*i,s.y*i,0),new Cesium.Cartesian3);return Cesium.Ellipsoid.WGS84.cartesianArrayToCartographicArray([r,a])};R.applyHeightOffsetToGeometry=function(e,t){e.applyTransform((i,s,n)=>{if(console.assert(i===s),n!==void 0&&n>=3)for(let r=0;r<s.length;r+=n)s[r+2]=s[r+2]+t;return s})};R.createMatrixAtCoordinates=function(e,t=0,i=Cesium.Cartesian3.ZERO,s=new Cesium.Cartesian3(1,1,1)){const n=R.ol4326CoordinateToCesiumCartesian(e),r=Cesium.Transforms.eastNorthUpToFixedFrame(n),a=Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Z,-t),o=Cesium.Matrix4.fromTranslationQuaternionRotationScale(i,a,s);return Cesium.Matrix4.multiply(r,o,new Cesium.Matrix4)};R.rotateAroundAxis=function(e,t,i,s,n){const r=Cesium.Math.clamp,a=Cesium.defaultValue,o=n||{},h=a(o.duration,500),l=a(o.easing,Ya),c=o.callback;let u=0;const d=new Cesium.Matrix4,f=Date.now(),g=function(){const m=Date.now()-f,p=l(r(m/h,0,1));console.assert(p>=u),e.transform.clone(d);const x=(p-u)*t;u=p,e.lookAtTransform(s),e.rotate(i,x),e.lookAtTransform(d),p<1?window.requestAnimationFrame(g):c&&c()};window.requestAnimationFrame(g)};R.setHeadingUsingBottomCenter=function(e,t,i,s){const n=e.camera,r=R.computeAngleToZenith(e,i),a=n.right,o=Cesium.Quaternion.fromAxisAngle(a,r),h=Cesium.Matrix3.fromQuaternion(o),l=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(n.position,i,l);const c=new Cesium.Cartesian3;Cesium.Matrix3.multiplyByVector(h,l,c),Cesium.Cartesian3.add(c,i,c);const u=Cesium.Matrix4.fromTranslation(c),d=R.rotateAroundAxis;d(n,t,c,u,s)};R.pickOnTerrainOrEllipsoid=function(e,t){const i=e.camera.getPickRay(t);return e.globe.pick(i,e)||e.camera.pickEllipsoid(t)};R.pickBottomPoint=function(e){const t=e.canvas,i=new Cesium.Cartesian2(t.clientWidth/2,t.clientHeight);return R.pickOnTerrainOrEllipsoid(e,i)};R.pickCenterPoint=function(e){const t=e.canvas,i=new Cesium.Cartesian2(t.clientWidth/2,t.clientHeight/2);return R.pickOnTerrainOrEllipsoid(e,i)};R.computeSignedTiltAngleOnGlobe=function(e){const t=e.camera,i=new Cesium.Ray(t.position,t.direction);let s=e.globe.pick(i,e);if(!s){const o=Cesium.Ellipsoid.WGS84,h=Cesium.IntersectionTests.rayEllipsoid(i,o);h&&(s=Cesium.Ray.getPoint(i,h.start))}if(!s)return;const n=new Cesium.Cartesian3;Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(s,n);const r=R.signedAngleBetween,a=r(t.direction,n,t.right)-Math.PI;return Cesium.Math.convertLongitudeRange(a)};R.bottomFovRay=function(e){const t=e.camera,i=t.frustum.fovy/2,s=t.direction,n=Cesium.Quaternion.fromAxisAngle(t.right,i),r=Cesium.Matrix3.fromQuaternion(n),a=new Cesium.Cartesian3;return Cesium.Matrix3.multiplyByVector(r,s,a),new Cesium.Ray(t.position,a)};R.signedAngleBetween=function(e,t,i){const s=new Cesium.Cartesian3,n=new Cesium.Cartesian3,r=new Cesium.Cartesian3;Cesium.Cartesian3.normalize(e,s),Cesium.Cartesian3.normalize(t,n),Cesium.Cartesian3.cross(s,n,r);const a=Cesium.Cartesian3.dot(s,n),o=Cesium.Cartesian3.magnitude(r),h=Cesium.Cartesian3.dot(i,r),l=Math.atan2(o,a);return h>=0?l:-l};R.computeAngleToZenith=function(e,t){const i=e.camera,s=i.frustum.fovy/2,n=R.bottomFovRay(e),r=Cesium.Cartesian3.clone(n.direction);Cesium.Cartesian3.negate(r,r);const a=new Cesium.Cartesian3;Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(t,a);const o=new Cesium.Cartesian3;return Cesium.Cartesian3.negate(i.right,o),R.signedAngleBetween(a,r,o)+s};R.extentToRectangle=function(e,t){if(e&&t){const i=Mn(e,t,"EPSG:4326");return Cesium.Rectangle.fromDegrees(i[0],i[1],i[2],i[3])}else return null};R.sourceToImageryProvider=function(e,t,i,s){const n=t.get("olcs_skip");if(n)return null;let r=null;if(t instanceof Fn&&t.getUrl()&&t.getImageLoadFunction()===An){const a={"olcs.proxy":t.get("olcs.proxy"),"olcs.extent":t.get("olcs.extent"),"olcs.projection":t.get("olcs.projection"),"olcs.imagesource":t};t=new Ut({url:t.getUrl(),attributions:t.getAttributions(),projection:t.getProjection(),params:t.getParams()}),t.setProperties(a)}if(t instanceof Cn){let a=z.getSourceProjection(t);if(a||(a=i),R.isCesiumProjection(a))r=new Cr(e,t,i);else return null}else if(t instanceof Xo){let a=z.getSourceProjection(t);if(a||(a=i),R.isCesiumProjection(a))r=new Cesium.SingleTileImageryProvider({url:t.getUrl(),rectangle:new Cesium.Rectangle.fromDegrees(t.getImageExtent()[0],t.getImageExtent()[1],t.getImageExtent()[2],t.getImageExtent()[3])});else return null}else if(t instanceof Qo){let a=z.getSourceProjection(t);if(a||(a=i),n===!1){const o=a.getCode().split(":")[1],h=t.urls.map(y=>y.replace(o,"3857")),l=s.getExtent(),c=R.extentToRectangle(l,a),u=t.get("olcs_minimumLevel"),d=t.getAttributions(),f=s.getStyleFunction();let g;if(l&&d){const y=De(l);g=Mr(d,0,y,l)[0]}return r=new F1({credit:g,rectangle:c,minimumLevel:u,styleFunction:f,urls:h}),r}return null}else return null;return r};R.tileLayerToImageryLayer=function(e,t,i){if(!(t instanceof ue)&&!(t instanceof Xi)&&!(t instanceof Bn))return null;const s=t.getSource();if(!s)return null;let n=s.get("olcs_provider");if(n||(n=this.sourceToImageryProvider(e,s,i,t)),!n)return null;const r={},o=t.get("olcs.extent")||t.getExtent();return o&&(r.rectangle=R.extentToRectangle(o,i)),new Cesium.ImageryLayer(n,r)};R.updateCesiumLayerProperties=function(e,t){let i=1,s=!0;[e.layer].concat(e.parents).forEach(n=>{const r=n.getOpacity();r!==void 0&&(i*=r);const a=n.getVisible();a!==void 0&&(s&=a)}),t.alpha=i,t.show=s};R.ol4326CoordinateToCesiumCartesian=function(e){const t=e;return t.length>2?Cesium.Cartesian3.fromDegrees(t[0],t[1],t[2]):Cesium.Cartesian3.fromDegrees(t[0],t[1])};R.ol4326CoordinateArrayToCsCartesians=function(e){console.assert(e!==null);const t=R.ol4326CoordinateToCesiumCartesian,i=[];for(let s=0;s<e.length;++s)i.push(t(e[s]));return i};R.olGeometryCloneTo4326=function(e,t){console.assert(t);const i=Q("EPSG:4326"),s=Q(t);if(s.getCode()!==i.getCode()){const n=e.getProperties();e=e.clone(),e.transform(s,i),e.setProperties(n)}return e};R.convertColorToCesium=function(e){if(e=e||"black",Array.isArray(e))return new Cesium.Color(Cesium.Color.byteToFloat(e[0]),Cesium.Color.byteToFloat(e[1]),Cesium.Color.byteToFloat(e[2]),e[3]);if(typeof e=="string")return Cesium.Color.fromCssColorString(e);if(e instanceof CanvasPattern||e instanceof CanvasGradient){const t=document.createElement("canvas"),i=t.getContext("2d");return t.width=t.height=256,i.fillStyle=e,i.fillRect(0,0,t.width,t.height),new Cesium.ImageMaterialProperty({image:t})}console.assert(!1,"impossible")};R.convertUrlToCesium=function(e){let t="";const i=/\{(\d|[a-z])-(\d|[a-z])\}/,s=i.exec(e);if(s){e=e.replace(i,"{s}");const n=s[1].charCodeAt(0),r=s[2].charCodeAt(0);let a;for(a=n;a<=r;++a)t+=String.fromCharCode(a)}return{url:e,subdomains:t}};R.resetToNorthZenith=function(e,t){return new Promise((i,s)=>{const n=t.camera,r=R.pickBottomPoint(t);if(!r){s("Could not get bottom pivot");return}const a=e.getView().getRotation();if(a===void 0){s("The view is not initialized");return}const o=R.computeAngleToZenith(t,r);R.setHeadingUsingBottomCenter(t,a,r);const h=Cesium.Matrix4.fromTranslation(r),l=n.right,c={callback:()=>{const u=e.getView();R.normalizeView(u),i()}};R.rotateAroundAxis(n,-o,l,h,c)})};R.rotateAroundBottomCenter=function(e,t){return new Promise((i,s)=>{const n=e.camera,r=R.pickBottomPoint(e);if(!r){s("could not get bottom pivot");return}const a={callback:i},o=Cesium.Matrix4.fromTranslation(r),h=n.right,l=R.rotateAroundAxis;l(n,-t,h,o,a)})};R.normalizeView=function(e,t=0){const i=e.getResolution();e.setRotation(t),e.constrainResolution?e.setResolution(e.constrainResolution(i)):e.setResolution(e.getConstrainedResolution(i))};R.isCesiumProjection=function(e){const t=e.getCode()==="EPSG:3857",i=e.getCode()==="EPSG:4326";return t||i};function Mr(e,t,i,s){const n={viewState:{zoom:t,center:i},extent:s};if(!e)return[];let r=e(n);return Array.isArray(r)||(r=[r]),r.map(a=>new Cesium.Credit(a,!0))}function I1(e,t,i,s){const n=i.canvas,a=i.camera.frustum.fovy;console.assert(!isNaN(a));const o=s.getMetersPerUnit(),h=e*n.clientHeight,l=Math.cos(Math.abs(t));return h*o*l/2/Math.tan(a/2)}function N1(e,t,i,s){const n=i.canvas,a=i.camera.frustum.fovy;console.assert(!isNaN(a));const o=s.getMetersPerUnit(),h=2*e*Math.tan(a/2),l=Math.cos(Math.abs(t));return h/o/l/n.clientHeight}class k1{constructor(t){this.ol3d=t,this.scene_=t.getCesiumScene(),this.canvas_=this.scene_.canvas,this._boundNotifyRepaintRequired=this.notifyRepaintRequired.bind(this),this.repaintEventNames_=["mousemove","mousedown","mouseup","touchstart","touchend","touchmove","pointerdown","pointerup","pointermove","wheel"],this.enable()}enable(){this.scene_.requestRenderMode=!0,this.scene_.maximumRenderTimeChange=1e3;for(const t of this.repaintEventNames_)this.canvas_.addEventListener(t,this._boundNotifyRepaintRequired,!1);window.addEventListener("resize",this._boundNotifyRepaintRequired,!1),this.ol3d.getOlMap().getLayerGroup().on("change",this._boundNotifyRepaintRequired)}disable(){for(const t of this.repaintEventNames_)this.canvas_.removeEventListener(t,this._boundNotifyRepaintRequired,!1);window.removeEventListener("resize",this._boundNotifyRepaintRequired,!1),this.ol3d.getOlMap().getLayerGroup().un("change",this._boundNotifyRepaintRequired),this.scene_.requestRenderMode=!1}restartRenderLoop(){this.notifyRepaintRequired()}notifyRepaintRequired(){this.scene_.requestRender()}}function ii(e){return e*180/Math.PI}function pe(e){return e*Math.PI/180}class ae{constructor(t,i){this.scene_=t,this.cam_=t.camera,this.map_=i,this.view_=null,this.viewListenKey_=null,this.toLonLat_=ae.identityProjection,this.fromLonLat_=ae.identityProjection,this.tilt_=0,this.distance_=0,this.lastCameraViewMatrix_=null,this.viewUpdateInProgress_=!1,this.map_.on("change:view",s=>{this.setView_(this.map_.getView())}),this.setView_(this.map_.getView())}static identityProjection(t,i,s){const n=s||t.length;if(i)for(let r=0;r<n;++r)i[r]=t[r];return t}setView_(t){if(this.view_&&(Dt(this.viewListenKey_),this.viewListenKey_=null),this.view_=t,t){const i=Ni(t.getProjection(),"EPSG:4326"),s=Ni("EPSG:4326",t.getProjection());console.assert(i&&s),this.toLonLat_=i,this.fromLonLat_=s,this.viewListenKey_=t.on("propertychange",n=>this.handleViewEvent_(n)),this.readFromView()}else this.toLonLat_=ae.identityProjection,this.fromLonLat_=ae.identityProjection}handleViewEvent_(t){this.viewUpdateInProgress_||this.readFromView()}setHeading(t){this.view_&&this.view_.setRotation(t)}getHeading(){return this.view_?this.view_.getRotation()||0:void 0}setTilt(t){this.tilt_=t,this.updateCamera_()}getTilt(){return this.tilt_}setDistance(t){this.distance_=t,this.updateCamera_(),this.updateView()}getDistance(){return this.distance_}setCenter(t){this.view_&&this.view_.setCenter(t)}getCenter(){if(this.view_)return this.view_.getCenter()}setPosition(t){if(!this.toLonLat_)return;const i=this.toLonLat_(t);console.assert(i);const s=new Cesium.Cartographic(pe(i[0]),pe(i[1]),this.getAltitude());this.cam_.setView({destination:Cesium.Ellipsoid.WGS84.cartographicToCartesian(s)}),this.updateView()}getPosition(){if(!this.fromLonLat_)return;const t=Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position),i=this.fromLonLat_([ii(t.longitude),ii(t.latitude)]);return console.assert(i),i}setAltitude(t){const i=Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position);i.height=t,this.cam_.position=Cesium.Ellipsoid.WGS84.cartographicToCartesian(i),this.updateView()}getAltitude(){return Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position).height}updateCamera_(){if(!this.view_||!this.toLonLat_)return;const t=this.view_.getCenter();if(!t)return;const i=this.toLonLat_(t);console.assert(i);const s=new Cesium.Cartographic(pe(i[0]),pe(i[1]));if(this.scene_.globe){const a=this.scene_.globe.getHeight(s);s.height=a||0}const n=Cesium.Ellipsoid.WGS84.cartographicToCartesian(s),r={pitch:this.tilt_-Cesium.Math.PI_OVER_TWO,heading:-this.view_.getRotation(),roll:void 0};this.cam_.setView({destination:n,orientation:r}),this.cam_.moveBackward(this.distance_),this.checkCameraChange(!0)}readFromView(){if(!this.view_||!this.toLonLat_)return;const t=this.view_.getCenter();if(t==null)return;const i=this.toLonLat_(t);console.assert(i);const s=this.view_.getResolution();this.distance_=this.calcDistanceForResolution(s||0,pe(i[1])),this.updateCamera_()}updateView(){if(!this.view_||!this.fromLonLat_)return;this.viewUpdateInProgress_=!0;const t=Cesium.Ellipsoid.WGS84,i=this.scene_,s=R.pickCenterPoint(i);let n=s;if(!n){const a=i.globe,o=this.cam_.positionCartographic.clone(),h=a.getHeight(o);o.height=h||0,n=Cesium.Ellipsoid.WGS84.cartographicToCartesian(o)}this.distance_=Cesium.Cartesian3.distance(n,this.cam_.position);const r=t.cartesianToCartographic(n);if(this.view_.setCenter(this.fromLonLat_([ii(r.longitude),ii(r.latitude)])),this.view_.setResolution(this.calcResolutionForDistance(this.distance_,r?r.latitude:0)),s){const a=this.cam_.position,o=new Cesium.Cartesian3;t.geocentricSurfaceNormal(s,o);const h=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(a,s,h),Cesium.Cartesian3.normalize(h,h);const l=this.cam_.up,c=this.cam_.right,u=new Cesium.Cartesian3(-s.y,s.x,0),d=Cesium.Cartesian3.angleBetween(c,u),g=Cesium.Cartesian3.cross(s,l,new Cesium.Cartesian3).z;this.view_.setRotation(g<0?d:-d);const y=Math.acos(Cesium.Cartesian3.dot(o,h));this.tilt_=isNaN(y)?0:y}else this.view_.setRotation(this.cam_.heading),this.tilt_=-this.cam_.pitch+Math.PI/2;this.viewUpdateInProgress_=!1}checkCameraChange(t){const i=this.lastCameraViewMatrix_,s=this.cam_.viewMatrix;(!i||!Cesium.Matrix4.equalsEpsilon(i,s,1e-5))&&(this.lastCameraViewMatrix_=s.clone(),t!==!0&&this.updateView())}calcDistanceForResolution(t,i){return I1(t,i,this.scene_,this.view_.getProjection())}calcResolutionForDistance(t,i){return N1(t,i,this.scene_,this.view_.getProjection())}}class xr{constructor(t,i){this.map=t,this.view=t.getView(),this.scene=i,this.olLayers=t.getLayerGroup().getLayers(),this.mapLayerGroup=t.getLayerGroup(),this.layerMap={},this.olLayerListenKeys={},this.olGroupListenKeys_={}}synchronize(){this.destroyAll(),this.addLayers_(this.mapLayerGroup)}orderLayers(){}addLayers_(t){const i=[{layer:t,parents:[]}];for(;i.length>0;){const s=i.splice(0,1)[0],n=s.layer,r=Y(n).toString();this.olLayerListenKeys[r]=[],console.assert(!this.layerMap[r]);let a=null;if(n instanceof ki)this.listenForGroupChanges_(n),n!==this.mapLayerGroup&&(a=this.createSingleLayerCounterparts(s)),a||n.getLayers().forEach(o=>{if(o){const h={layer:o,parents:n===this.mapLayerGroup?[]:[s.layer].concat(s.parents)};i.push(h)}});else if(a=this.createSingleLayerCounterparts(s),!a){const o=r,h=s,l=c=>{const u=this.createSingleLayerCounterparts(h);u&&(h.layer.un("change",l),this.addCesiumObjects_(u,o,h.layer),this.orderLayers())};this.olLayerListenKeys[r].push(re(h.layer,"change",l))}a&&this.addCesiumObjects_(a,r,n)}this.orderLayers()}addCesiumObjects_(t,i,s){this.layerMap[i]=t,this.olLayerListenKeys[i].push(re(s,"change:zIndex",()=>this.orderLayers())),t.forEach(n=>{this.addCesiumObject(n)})}removeAndDestroySingleLayer_(t){const i=Y(t).toString(),s=this.layerMap[i];return s&&(s.forEach(n=>{this.removeSingleCesiumObject(n,!1),this.destroyCesiumObject(n)}),this.olLayerListenKeys[i].forEach(Dt),delete this.olLayerListenKeys[i]),delete this.layerMap[i],!!s}unlistenSingleGroup_(t){if(t===this.mapLayerGroup)return;const i=Y(t).toString();this.olGroupListenKeys_[i].forEach(n=>{Dt(n)}),delete this.olGroupListenKeys_[i],delete this.layerMap[i]}removeLayer_(t){if(t){const i=[t];for(;i.length>0;){const s=i.splice(0,1)[0],n=this.removeAndDestroySingleLayer_(s);s instanceof ki&&(this.unlistenSingleGroup_(s),n||s.getLayers().forEach(r=>{i.push(r)}))}}}listenForGroupChanges_(t){const i=Y(t).toString();console.assert(this.olGroupListenKeys_[i]===void 0);const s=[];this.olGroupListenKeys_[i]=s;let n=[];const r=function(){const a=t.getLayers();a&&(n=[a.on("add",o=>{this.addLayers_(o.element)}),a.on("remove",o=>{this.removeLayer_(o.element)})],s.push(...n))}.bind(this);r(),s.push(t.on("change:layers",a=>{n.forEach(o=>{const h=s.indexOf(o);h>=0&&s.splice(h,1),Dt(o)}),r()}))}destroyAll(){this.removeAllCesiumObjects(!0);let t;for(t in this.olGroupListenKeys_)this.olGroupListenKeys_[t].forEach(Dt);for(t in this.olLayerListenKeys)this.olLayerListenKeys[t].forEach(Dt);this.olGroupListenKeys_={},this.olLayerListenKeys={},this.layerMap={}}addCesiumObject(t){}destroyCesiumObject(t){}removeSingleCesiumObject(t,i){}removeAllCesiumObjects(t){}createSingleLayerCounterparts(t){}}class D1 extends xr{constructor(t,i){super(t,i),this.cesiumLayers_=i.imageryLayers,this.ourLayers_=new Cesium.ImageryLayerCollection}addCesiumObject(t){this.cesiumLayers_.add(t),this.ourLayers_.add(t)}destroyCesiumObject(t){t.destroy()}removeSingleCesiumObject(t,i){this.cesiumLayers_.remove(t,i),this.ourLayers_.remove(t,!1)}removeAllCesiumObjects(t){for(let i=0;i<this.ourLayers_.length;++i)this.cesiumLayers_.remove(this.ourLayers_.get(i),t);this.ourLayers_.removeAll(!1)}convertLayerToCesiumImageries(t,i){const s=R.tileLayerToImageryLayer(this.map,t,i);return s?[s]:null}createSingleLayerCounterparts(t){const i=t.layer,s=Y(i).toString(),n=this.view.getProjection();console.assert(n);const r=this.convertLayerToCesiumImageries(i,n);if(r){const a=[];if([t.layer].concat(t.parents).forEach(o=>{a.push(o.on(["change:opacity","change:visible"],()=>{console.assert(r);for(let h=0;h<r.length;++h)R.updateCesiumLayerProperties(t,r[h])}))}),i.getStyleFunction){let o=i.getStyleFunction();a.push(i.on("change",()=>{const h=i.getStyleFunction();if(o!==h){o=h;for(let l=0;l<r.length;++l){const c=r[l];c._imageryCache&&c.imageryProvider.cache_&&(c._imageryCache={},c.imageryProvider.cache_={},c.imageryProvider.styleFunction_=h)}this.scene.requestRender()}}))}for(let o=0;o<r.length;++o)R.updateCesiumLayerProperties(t,r[o]);a.push(i.on("change:extent",o=>{for(let h=0;h<r.length;++h)this.cesiumLayers_.remove(r[h],!0),this.ourLayers_.remove(r[h],!1);delete this.layerMap[Y(i)],this.synchronize()})),a.push(i.on("change",o=>{for(let h=0;h<r.length;++h){const l=this.cesiumLayers_.indexOf(r[h]);l>=0&&(this.cesiumLayers_.remove(r[h],!1),this.cesiumLayers_.add(r[h],l))}})),this.olLayerListenKeys[s].push(...a)}return Array.isArray(r)?r:null}orderLayers(){const t=[],i={},s=[this.mapLayerGroup];for(;s.length>0;){const n=s.splice(0,1)[0];if(t.push(n),i[Y(n)]=n.getZIndex()||0,n instanceof ki){const r=n.getLayers();r&&s.unshift(...r.getArray())}}E1(t,(n,r)=>i[Y(n)]-i[Y(r)]),t.forEach(n=>{const r=Y(n).toString(),a=this.layerMap[r];a&&a.forEach(o=>{this.raiseToTop(o)})})}raiseToTop(t){this.cesiumLayers_.raiseToTop(t)}}class G1{constructor(t,i){const s=new Cesium.BillboardCollection({scene:i}),n=new Cesium.PrimitiveCollection;this.olListenKeys=[],this.rootCollection_=new Cesium.PrimitiveCollection,this.context={projection:t,billboards:s,featureToCesiumMap:{},primitives:n},this.rootCollection_.add(s),this.rootCollection_.add(n)}destroy(){this.olListenKeys.forEach(Dt),this.olListenKeys.length=0}getRootPrimitive(){return this.rootCollection_}}class j1{constructor(t){this.scene=t,this.boundOnRemoveOrClearFeatureListener_=this.onRemoveOrClearFeature_.bind(this),this.defaultBillboardEyeOffset_=new Cesium.Cartesian3(0,0,10)}onRemoveOrClearFeature_(t){const i=t.target;console.assert(i instanceof Ht);const s=z.obj(i).olcs_cancellers;if(s){const n=t.feature;if(n){const r=Y(n),a=s[r];a&&(a(),delete s[r])}else{for(const r in s)s.hasOwnProperty(r)&&s[r]();z.obj(i).olcs_cancellers={}}}}setReferenceForPicking(t,i,s){s.olLayer=t,s.olFeature=i}createColoredPrimitive(t,i,s,n,r,a){const o=function(d,f){const g=new Cesium.GeometryInstance({geometry:d});return f&&!(f instanceof Cesium.ImageMaterialProperty)&&(g.attributes={color:Cesium.ColorGeometryInstanceAttribute.fromColor(f)}),g},h={flat:!0,renderState:{depthTest:{enabled:!0}}};a!==void 0&&(h.renderState||(h.renderState={}),h.renderState.lineWidth=a);const l=o(n,r),c=this.getHeightReference(t,i,s);let u;if(c===Cesium.HeightReference.CLAMP_TO_GROUND){const d=l.geometry.constructor;if(d&&!d.createShadowVolume)return null;u=new Cesium.GroundPrimitive({geometryInstances:l})}else u=new Cesium.Primitive({geometryInstances:l});if(r instanceof Cesium.ImageMaterialProperty){const d=r.image.getValue().toDataURL();u.appearance=new Cesium.MaterialAppearance({flat:!0,renderState:{depthTest:{enabled:!0}},material:new Cesium.Material({fabric:{type:"Image",uniforms:{image:d}}})})}else u.appearance=new Cesium.PerInstanceColorAppearance(h);return this.setReferenceForPicking(t,i,u),u}extractColorFromOlStyle(t,i){const s=t.getFill()?t.getFill().getColor():null,n=t.getStroke()?t.getStroke().getColor():null;let r="black";return n&&i?r=n:s&&(r=s),R.convertColorToCesium(r)}extractLineWidthFromOlStyle(t){const i=t.getStroke()?t.getStroke().getWidth():void 0;return i!==void 0?i:1}wrapFillAndOutlineGeometries(t,i,s,n,r,a){const o=this.extractColorFromOlStyle(a,!1),h=this.extractColorFromOlStyle(a,!0),l=new Cesium.PrimitiveCollection;if(a.getFill()){const c=this.createColoredPrimitive(t,i,s,n,o);console.assert(!!c),l.add(c)}if(a.getStroke()&&r){const c=this.extractLineWidthFromOlStyle(a),u=this.createColoredPrimitive(t,i,s,r,h,c);u&&l.add(u)}return l}addTextStyle(t,i,s,n,r){let a;if(r instanceof Cesium.PrimitiveCollection?a=r:(a=new Cesium.PrimitiveCollection,a.add(r)),!n.getText())return a;const o=n.getText(),h=this.olGeometry4326TextPartToCesium(t,i,s,o);return h&&a.add(h),a}csAddBillboard(t,i,s,n,r,a){i.eyeOffset||(i.eyeOffset=this.defaultBillboardEyeOffset_);const o=t.add(i);return this.setReferenceForPicking(s,n,o),o}olCircleGeometryToCesium(t,i,s,n,r){s=R.olGeometryCloneTo4326(s,n),console.assert(s.getType()=="Circle");let a=s.getCenter();const o=a.length==3?a[2]:0;let h=a.slice();h[0]+=s.getRadius(),a=R.ol4326CoordinateToCesiumCartesian(a),h=R.ol4326CoordinateToCesiumCartesian(h);const l=Cesium.Cartesian3.distance(a,h),c=new Cesium.CircleGeometry({center:a,radius:l,height:o});let u,d;if(this.getHeightReference(t,i,s)===Cesium.HeightReference.CLAMP_TO_GROUND){const g=this.extractLineWidthFromOlStyle(r);if(g){const y=Za(s.getCenter(),l),m=R.ol4326CoordinateArrayToCsCartesians(y.getLinearRing(0).getCoordinates());if(Ai(this.scene))u=new Cesium.GroundPolylinePrimitive({geometryInstances:new Cesium.GeometryInstance({geometry:new Cesium.GroundPolylineGeometry({positions:m,width:g})}),appearance:new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(i,r,!0)}),classificationType:Cesium.ClassificationType.TERRAIN}),u.readyPromise.then(()=>{this.setReferenceForPicking(t,i,u._primitive)});else{const p=this.extractColorFromOlStyle(r,!0);u=this.createStackedGroundCorridors(t,i,g,p,m)}}}else d=new Cesium.CircleOutlineGeometry({center:a,radius:l,extrudedHeight:o,height:o});const f=this.wrapFillAndOutlineGeometries(t,i,s,c,d,r);return u&&f.add(u),this.addTextStyle(t,i,s,r,f)}createStackedGroundCorridors(t,i,s,n,r){Array.isArray(r[0])||(r=[r]),s=Math.max(3,s);const a=[];let o=0;for(const h of[1e3,4e3,16e3,64e3,254e3,1e6,1e7]){s*=2.14;const l={width:s,vertexFormat:Cesium.VertexFormat.POSITION_ONLY};for(const c of r)l.positions=c,a.push(new Cesium.GeometryInstance({geometry:new Cesium.CorridorGeometry(l),attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(n),distanceDisplayCondition:new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(o,h-1)}}));o=h}return new Cesium.GroundPrimitive({geometryInstances:a})}olLineStringGeometryToCesium(t,i,s,n,r){s=R.olGeometryCloneTo4326(s,n),console.assert(s.getType()=="LineString");const a=R.ol4326CoordinateArrayToCsCartesians(s.getCoordinates()),o=this.extractLineWidthFromOlStyle(r);let h;const l=this.getHeightReference(t,i,s);if(l===Cesium.HeightReference.CLAMP_TO_GROUND&&!Ai(this.scene)){const c=this.extractColorFromOlStyle(r,!0);h=this.createStackedGroundCorridors(t,i,o,c,a)}else{const c=new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(i,r,!0)}),u={positions:a,width:o},d={appearance:c};if(l===Cesium.HeightReference.CLAMP_TO_GROUND){const f=new Cesium.GroundPolylineGeometry(u);d.geometryInstances=new Cesium.GeometryInstance({geometry:f}),h=new Cesium.GroundPolylinePrimitive(d),h.readyPromise.then(()=>{this.setReferenceForPicking(t,i,h._primitive)})}else{u.vertexFormat=c.vertexFormat;const f=new Cesium.PolylineGeometry(u);d.geometryInstances=new Cesium.GeometryInstance({geometry:f}),h=new Cesium.Primitive(d)}}return this.setReferenceForPicking(t,i,h),this.addTextStyle(t,i,s,r,h)}olPolygonGeometryToCesium(t,i,s,n,r){s=R.olGeometryCloneTo4326(s,n),console.assert(s.getType()=="Polygon");const a=this.getHeightReference(t,i,s);let o,h,l;if(s.getCoordinates()[0].length==5&&i.getGeometry().get("olcs.polygon_kind")==="rectangle"){const u=s.getCoordinates()[0],d=Ln(u),f=Cesium.Rectangle.fromDegrees(d[0],d[1],d[2],d[3]);let g=0;if(u[0].length==3)for(let y=0;y<u.length;y++)g=Math.max(g,u[y][2]);o=new Cesium.RectangleGeometry({ellipsoid:Cesium.Ellipsoid.WGS84,rectangle:f,height:g}),h=new Cesium.RectangleOutlineGeometry({ellipsoid:Cesium.Ellipsoid.WGS84,rectangle:f,height:g})}else{const u=s.getLinearRings(),d={},f=d;console.assert(u.length>0);for(let g=0;g<u.length;++g){const y=u[g].getCoordinates(),m=R.ol4326CoordinateArrayToCsCartesians(y);console.assert(m&&m.length>0),g==0?d.positions=m:(d.holes||(d.holes=[]),d.holes.push({positions:m}))}if(o=new Cesium.PolygonGeometry({polygonHierarchy:f,perPositionHeight:!0}),a===Cesium.HeightReference.CLAMP_TO_GROUND){const g=this.extractLineWidthFromOlStyle(r);if(g>0){const y=[d.positions];if(d.holes)for(let m=0;m<d.holes.length;++m)y.push(d.holes[m].positions);if(Ai(this.scene)){const m=new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(i,r,!0)}),p=[];for(const b of y){const M=new Cesium.GroundPolylineGeometry({positions:b,width:g});p.push(new Cesium.GeometryInstance({geometry:M}))}const x={appearance:m,geometryInstances:p};l=new Cesium.GroundPolylinePrimitive(x),l.readyPromise.then(()=>{this.setReferenceForPicking(t,i,l._primitive)})}else{const m=this.extractColorFromOlStyle(r,!0);l=this.createStackedGroundCorridors(t,i,g,m,y)}}}else h=new Cesium.PolygonOutlineGeometry({polygonHierarchy:d,perPositionHeight:!0})}const c=this.wrapFillAndOutlineGeometries(t,i,s,o,h,r);return l&&c.add(l),this.addTextStyle(t,i,s,r,c)}getHeightReference(t,i,s){let n=s.get("altitudeMode");n===void 0&&(n=i.get("altitudeMode")),n===void 0&&(n=t.get("altitudeMode"));let r=Cesium.HeightReference.NONE;return n==="clampToGround"?r=Cesium.HeightReference.CLAMP_TO_GROUND:n==="relativeToGround"&&(r=Cesium.HeightReference.RELATIVE_TO_GROUND),r}createBillboardFromImage(t,i,s,n,r,a,o,h){a instanceof Di&&a.load();const l=a.getImage(1),c=function(d){return d.src!=""&&d.naturalHeight!=0&&d.naturalWidth!=0&&d.complete},u=function(){if(!l||!(l instanceof HTMLCanvasElement||l instanceof Image||l instanceof HTMLImageElement))return;const d=s.getCoordinates(),f=R.ol4326CoordinateToCesiumCartesian(d);let g;const y=a.getOpacity();y!==void 0&&(g=new Cesium.Color(1,1,1,y));const m=a.getScale(),p=this.getHeightReference(t,i,s),x={image:l,color:g,scale:m,heightReference:p,position:f};if(Object.assign(x,i.get("cesiumOptions")),a instanceof Di){const M=a.getAnchor();M&&(x.pixelOffset=new Cesium.Cartesian2((l.width/2-M[0])*m,(l.height/2-M[1])*m))}const b=this.csAddBillboard(o,x,t,i,s,r);h&&h(b)}.bind(this);if(l instanceof Image&&!c(l)){let d=!1;const f=t.getSource(),g=function(){d=!0};f.on(["removefeature","clear"],this.boundOnRemoveOrClearFeatureListener_);let y=z.obj(f).olcs_cancellers;y||(y=z.obj(f).olcs_cancellers={});const m=Y(i);y[m]&&y[m](),y[m]=g;const p=function(){l.removeEventListener("load",p),!o.isDestroyed()&&!d&&u()};l.addEventListener("load",p)}else u()}olPointGeometryToCesium(t,i,s,n,r,a,o){console.assert(s.getType()=="Point"),s=R.olGeometryCloneTo4326(s,n);let h=null;const l=r.getImage();if(l){const c=s.get("olcs_model")||i.get("olcs_model");if(c){const u=c(),d=Object.assign({},{scene:this.scene},u.cesiumOptions),f=Cesium.Model.fromGltf(d);h=new Cesium.PrimitiveCollection,h.add(f),u.debugModelMatrix&&h.add(new Cesium.DebugModelMatrixPrimitive({modelMatrix:u.debugModelMatrix}))}else this.createBillboardFromImage(t,i,s,n,r,l,a,o)}return r.getText()?this.addTextStyle(t,i,s,r,h||new Cesium.Primitive):h}olMultiGeometryToCesium(t,i,s,n,r,a,o){const h=function(c,u){const d=new Cesium.PrimitiveCollection;return c.forEach(f=>{d.add(u(t,i,f,n,r))}),d};let l;switch(s.getType()){case"MultiPoint":if(s=s,l=s.getPoints(),r.getText()){const c=new Cesium.PrimitiveCollection;return l.forEach(u=>{console.assert(u);const d=this.olPointGeometryToCesium(t,i,u,n,r,a,o);d&&c.add(d)}),c}else return l.forEach(c=>{console.assert(c),this.olPointGeometryToCesium(t,i,c,n,r,a,o)}),null;case"MultiLineString":return s=s,l=s.getLineStrings(),h(l,this.olLineStringGeometryToCesium.bind(this));case"MultiPolygon":return s=s,l=s.getPolygons(),h(l,this.olPolygonGeometryToCesium.bind(this));default:console.assert(!1,`Unhandled multi geometry type${s.getType()}`)}}olGeometry4326TextPartToCesium(t,i,s,n){const r=n.getText();if(!r)return null;const a=new Cesium.LabelCollection({scene:this.scene}),o=De(s.getExtent());if(s instanceof Ie){const g=s.getFirstCoordinate();o[2]=g.length==3?g[2]:0}const h={};h.position=R.ol4326CoordinateToCesiumCartesian(o),h.text=r,h.heightReference=this.getHeightReference(t,i,s);const l=n.getOffsetX(),c=n.getOffsetY();if(l!=0&&c!=0){const g=new Cesium.Cartesian2(l,c);h.pixelOffset=g}h.font=n.getFont()||"10px sans-serif";let u;n.getFill()&&(h.fillColor=this.extractColorFromOlStyle(n,!1),u=Cesium.LabelStyle.FILL),n.getStroke()&&(h.outlineWidth=this.extractLineWidthFromOlStyle(n),h.outlineColor=this.extractColorFromOlStyle(n,!0),u=Cesium.LabelStyle.OUTLINE),n.getFill()&&n.getStroke()&&(u=Cesium.LabelStyle.FILL_AND_OUTLINE),h.style=u;let d;switch(n.getTextAlign()){case"left":d=Cesium.HorizontalOrigin.LEFT;break;case"right":d=Cesium.HorizontalOrigin.RIGHT;break;case"center":default:d=Cesium.HorizontalOrigin.CENTER}if(h.horizontalOrigin=d,n.getTextBaseline()){let g;switch(n.getTextBaseline()){case"top":g=Cesium.VerticalOrigin.TOP;break;case"middle":g=Cesium.VerticalOrigin.CENTER;break;case"bottom":g=Cesium.VerticalOrigin.BOTTOM;break;case"alphabetic":g=Cesium.VerticalOrigin.TOP;break;case"hanging":g=Cesium.VerticalOrigin.BOTTOM;break;default:console.assert(!1,`unhandled baseline ${n.getTextBaseline()}`)}h.verticalOrigin=g}const f=a.add(h);return this.setReferenceForPicking(t,i,f),a}olStyleToCesium(t,i,s){const n=i.getFill(),r=i.getStroke();if(s&&!r||!s&&!n)return null;let a=s?r.getColor():n.getColor();return a=R.convertColorToCesium(a),s&&r.getLineDash()?Cesium.Material.fromType("Stripe",{horizontal:!1,repeat:500,evenColor:a,oddColor:new Cesium.Color(0,0,0,0)}):Cesium.Material.fromType("Color",{color:a})}computePlainStyle(t,i,s,n){const r=i.getStyleFunction();let a=null;return r&&(a=r(i,n)),!a&&s&&(a=s(i,n)),a?Array.isArray(a)?a:[a]:null}getGeometryFromFeature(t,i,s){if(s)return s;const n=t.get("olcs.3d_geometry");if(n&&n instanceof Ii)return n;if(i){const r=i.getGeometryFunction()(t);if(r instanceof Ii)return r}return t.getGeometry()}olFeatureToCesium(t,i,s,n,r){let a=this.getGeometryFromFeature(i,s,r);if(!a)return null;const o=n.projection,h=function(l){const c=n.featureToCesiumMap[Y(i)];c instanceof Array?c.push(l):n.featureToCesiumMap[Y(i)]=[l]};switch(a.getType()){case"GeometryCollection":const l=new Cesium.PrimitiveCollection;return a.getGeometries().forEach(g=>{if(g){const y=this.olFeatureToCesium(t,i,s,n,g);y&&l.add(y)}}),l;case"Point":a=a;const u=n.billboards,d=this.olPointGeometryToCesium(t,i,a,o,s,u,h);return d||null;case"Circle":return a=a,this.olCircleGeometryToCesium(t,i,a,o,s);case"LineString":return a=a,this.olLineStringGeometryToCesium(t,i,a,o,s);case"Polygon":return a=a,this.olPolygonGeometryToCesium(t,i,a,o,s);case"MultiPoint":case"MultiLineString":case"MultiPolygon":const f=this.olMultiGeometryToCesium(t,i,a,o,s,n.billboards,h);return f||null;case"LinearRing":throw new Error("LinearRing should only be part of polygon.");default:throw new Error(`Ol geom type not handled : ${a.getType()}`)}}olVectorLayerToCesium(t,i,s){const n=i.getProjection(),r=i.getResolution();if(r===void 0||!n)throw console.assert(!1,"View not ready"),new Error("View not ready");let a=t.getSource();a instanceof Nn&&(a=a.getSource()),console.assert(a instanceof Ht);const o=a.getFeatures(),h=new G1(n,this.scene),l=h.context;for(let c=0;c<o.length;++c){const u=o[c];if(!u)continue;const d=t.getStyleFunction(),f=this.computePlainStyle(t,u,d,r);if(!f||!f.length)continue;let g=null;for(let y=0;y<f.length;y++){const m=this.olFeatureToCesium(t,u,f[y],l);if(m){if(!g)g=m;else if(m){let p=0,x;for(;x=m.get(p);)g.add(x),p++}}}g&&(s[Y(u)]=g,h.getRootPrimitive().add(g))}return h}convert(t,i,s,n){const r=i.getProjection(),a=i.getResolution();if(a==null||!r)return null;const o=t.getStyleFunction(),h=this.computePlainStyle(t,s,o,a);if(!h||!h.length)return null;n.projection=r;let l=null;for(let c=0;c<h.length;c++){const u=this.olFeatureToCesium(t,s,h[c],n);if(!l)l=u;else if(u){let d=0,f;for(;f=u.get(d);)l.add(f),d++}}return l}}class V1 extends xr{constructor(t,i,s){super(t,i),this.converter=s||new j1(i),this.csAllPrimitives_=new Cesium.PrimitiveCollection,i.primitives.add(this.csAllPrimitives_),this.csAllPrimitives_.destroyPrimitives=!1}addCesiumObject(t){console.assert(t),t.getRootPrimitive().counterpart=t,this.csAllPrimitives_.add(t.getRootPrimitive())}destroyCesiumObject(t){t.getRootPrimitive().destroy()}removeSingleCesiumObject(t,i){t.destroy(),this.csAllPrimitives_.destroyPrimitives=i,this.csAllPrimitives_.remove(t.getRootPrimitive()),this.csAllPrimitives_.destroyPrimitives=!1}removeAllCesiumObjects(t){if(this.csAllPrimitives_.destroyPrimitives=t,t)for(let i=0;i<this.csAllPrimitives_.length;++i)this.csAllPrimitives_.get(i).counterpart.destroy();this.csAllPrimitives_.removeAll(),this.csAllPrimitives_.destroyPrimitives=!1}updateLayerVisibility(t,i){let s=!0;[t.layer].concat(t.parents).forEach(n=>{const r=n.getVisible();r!==void 0?s&=r:s=!1}),i.show=s}createSingleLayerCounterparts(t){const i=t.layer;if(!(i instanceof de)||i instanceof Bn)return null;console.assert(i instanceof Qa);let s=i.getSource();if(s instanceof Nn&&(s=s.getSource()),!s)return null;console.assert(s instanceof Ht),console.assert(this.view);const n=this.view,r={},a=this.converter.olVectorLayerToCesium(i,n,r),o=a.getRootPrimitive(),h=a.olListenKeys;[t.layer].concat(t.parents).forEach(u=>{h.push(re(u,"change:visible",()=>{this.updateLayerVisibility(t,o)}))}),this.updateLayerVisibility(t,o);const l=function(u){console.assert(i instanceof de||i instanceof Xi);const d=a.context,f=this.converter.convert(i,n,u,d);f&&(r[Y(u)]=f,o.add(f))}.bind(this),c=function(u){const d=Y(u),f=a.context,g=f.featureToCesiumMap[d];g&&(delete f.featureToCesiumMap[d],g.forEach(m=>{m instanceof Cesium.Billboard&&f.billboards.remove(m)}));const y=r[d];delete r[d],y&&o.remove(y)}.bind(this);return h.push(re(s,"addfeature",u=>{console.assert(u.feature),l(u.feature)})),h.push(re(s,"removefeature",u=>{console.assert(u.feature),c(u.feature)})),h.push(re(s,"changefeature",u=>{const d=u.feature;console.assert(d),c(d),l(d)})),a?[a]:null}}class B1 extends di{constructor(t){const i=t.parent;super(i.getOptions()),this.scenePostRenderListenerRemover_=null,this.scene_=t.scene,this.synchronizer_=t.synchronizer,this.parent_=i,this.positionWGS84_=void 0,this.observer_=new MutationObserver(this.handleElementChanged.bind(this)),this.attributeObserver_=[],this.listenerKeys_=[];const s=n=>this.setPropertyFromEvent_(n);this.listenerKeys_.push(this.parent_.on("change:position",s)),this.listenerKeys_.push(this.parent_.on("change:element",s)),this.listenerKeys_.push(this.parent_.on("change:offset",s)),this.listenerKeys_.push(this.parent_.on("change:position",s)),this.listenerKeys_.push(this.parent_.on("change:positioning",s)),this.setProperties(this.parent_.getProperties()),this.handleMapChanged(),this.handleElementChanged()}observeTarget_(t){if(this.observer_){this.observer_.disconnect(),this.observer_.observe(t,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),this.attributeObserver_.forEach(i=>{i.disconnect()}),this.attributeObserver_.length=0;for(let i=0;i<t.childNodes.length;i++){const s=t.childNodes[i];if(s.nodeType===1){const n=new MutationObserver(this.handleElementChanged.bind(this));n.observe(s,{attributes:!0,subtree:!0}),this.attributeObserver_.push(n)}}}}setPropertyFromEvent_(t){t.target&&t.key&&this.set(t.key,t.target.get(t.key))}getScene(){return this.scene_}handleMapChanged(){this.scenePostRenderListenerRemover_&&(this.scenePostRenderListenerRemover_(),L1(this.element)),this.scenePostRenderListenerRemover_=null;const t=this.getScene();if(t){this.scenePostRenderListenerRemover_=t.postRender.addEventListener(this.updatePixelPosition.bind(this)),this.updatePixelPosition();const i=this.stopEvent?this.synchronizer_.getOverlayContainerStopEvent():this.synchronizer_.getOverlayContainer();this.insertFirst?i.insertBefore(this.element,i.childNodes[0]||null):i.appendChild(this.element)}}handlePositionChanged(){const t=this.getPosition();if(t){const i=this.parent_.getMap().getView().getProjection();this.positionWGS84_=xn(t,i,"EPSG:4326")}else this.positionWGS84_=void 0;this.updatePixelPosition()}handleElementChanged(){function t(s,n){const r=s.cloneNode();s.nodeName==="CANVAS"&&r.getContext("2d").drawImage(s,0,0),n&&n.appendChild(r),s.nodeType!=Node.TEXT_NODE&&r.addEventListener("click",o=>{s.dispatchEvent(new MouseEvent("click",o)),o.stopPropagation()});const a=s.childNodes;for(let o=0;o<a.length;o++)a[o]&&t(a[o],r);return r}P1(this.element);const i=this.getElement();if(i&&i.parentNode&&i.parentNode.childNodes)for(const s of i.parentNode.childNodes){const n=t(s,null);this.element.appendChild(n)}i.parentNode&&this.observeTarget_(i.parentNode)}updatePixelPosition(){const t=this.positionWGS84_;if(!this.scene_||!t){this.setVisible(!1);return}let i=0;if(t.length===2){const u=this.scene_.globe.getHeight(Cesium.Cartographic.fromDegrees(t[0],t[1]));u&&this.scene_.globe.tilesLoaded&&(t[2]=u),u&&(i=u)}else i=t[2];const s=Cesium.Cartesian3.fromDegrees(t[0],t[1],i),n=this.scene_.camera,r=new Cesium.BoundingSphere(new Cesium.Cartesian3,6356752);if(!new Cesium.Occluder(r,n.position).isPointVisible(s)){this.setVisible(!1);return}if(n.frustum.computeCullingVolume(n.position,n.direction,n.up).computeVisibility(new Cesium.BoundingSphere(s))!==1){this.setVisible(!1);return}this.setVisible(!0);const h=this.scene_.cartesianToCanvasCoordinates(s),l=[h.x,h.y],c=[this.scene_.canvas.width,this.scene_.canvas.height];this.updateRenderedPosition(l,c)}destroy(){this.scenePostRenderListenerRemover_&&this.scenePostRenderListenerRemover_(),this.observer_&&this.observer_.disconnect(),Dt(this.listenerKeys_),this.listenerKeys_.splice(0),this.element.removeNode?this.element.removeNode(!0):this.element.remove(),this.element=null}}class $1{constructor(t,i){this.map=t,this.overlays_=this.map.getOverlays(),this.scene=i,this.overlayContainerStopEvent_=document.createElement("DIV"),this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",["click","dblclick","mousedown","touchstart","MSPointerDown","pointerdown","mousewheel","wheel"].forEach(n=>{this.overlayContainerStopEvent_.addEventListener(n,r=>r.stopPropagation())}),this.scene.canvas.parentElement.appendChild(this.overlayContainerStopEvent_),this.overlayContainer_=document.createElement("DIV"),this.overlayContainer_.className="ol-overlaycontainer",this.scene.canvas.parentElement.appendChild(this.overlayContainer_),this.overlayMap_={}}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOverlayContainer(){return this.overlayContainer_}synchronize(){this.destroyAll(),this.addOverlays(),this.overlays_.on("add",this.addOverlayFromEvent_.bind(this)),this.overlays_.on("remove",this.removeOverlayFromEvent_.bind(this))}addOverlayFromEvent_(t){const i=t.element;this.addOverlay(i)}addOverlays(){this.overlays_.forEach(t=>{this.addOverlay(t)})}addOverlay(t){if(!t)return;const i=new B1({scene:this.scene,synchronizer:this,parent:t}),s=Y(t).toString();this.overlayMap_[s]=i}removeOverlayFromEvent_(t){const i=t.element;this.removeOverlay(i)}removeOverlay(t){const i=Y(t).toString(),s=this.overlayMap_[i];s&&(s.destroy(),delete this.overlayMap_[i])}destroyAll(){Object.keys(this.overlayMap_).forEach(t=>{this.overlayMap_[t].destroy(),delete this.overlayMap_[t]})}}class Se{constructor(t){this.autoRenderLoop_=null,this.map_=t.map,this.time_=t.time||function(){return Cesium.JulianDate.now()},this.to4326Transform_=Ni(this.map_.getView().getProjection(),"EPSG:4326"),this.resolutionScale_=1,this.canvasClientWidth_=0,this.canvasClientHeight_=0,this.resolutionScaleChanged_=!0;const i="position:absolute;top:0;left:0;width:100%;height:100%;";this.container_=document.createElement("DIV");const s=document.createAttribute("style");s.value=`${i}visibility:hidden;`,this.container_.setAttributeNode(s);let n=t.target||this.map_.getViewport();if(typeof n=="string"&&(n=document.getElementById(n)),n.appendChild(this.container_),this.isOverMap_=!t.target,this.isOverMap_&&t.stopOpenLayersEventsPropagation){const u=["click","dblclick","mousedown","touchstart","MSPointerDown","pointerdown","mousewheel","wheel"];for(let d=0,f=u.length;d<f;++d)this.container_.addEventListener(u[d],g=>g.stopPropagation())}this.canvas_=document.createElement("CANVAS");const r=document.createAttribute("style");r.value=i,this.canvas_.setAttributeNode(r),z.supportsImageRenderingPixelated()&&(this.canvas_.style.imageRendering=z.imageRenderingValue()),this.canvas_.oncontextmenu=function(){return!1},this.canvas_.onselectstart=function(){return!1},this.container_.appendChild(this.canvas_),this.enabled_=!1,this.pausedInteractions_=[],this.hiddenRootGroup_=null;const a=t.sceneOptions!==void 0?t.sceneOptions:{};a.canvas=this.canvas_,a.scene3DOnly=!0,this.scene_=new Cesium.Scene(a);const o=this.scene_.screenSpaceCameraController;o.tiltEventTypes.push({eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.SHIFT}),o.tiltEventTypes.push({eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.ALT}),o.enableLook=!1,this.scene_.camera.constrainedAxis=Cesium.Cartesian3.UNIT_Z,this.camera_=new ae(this.scene_,this.map_),this.globe_=new Cesium.Globe(Cesium.Ellipsoid.WGS84),this.globe_.baseColor=Cesium.Color.WHITE,this.scene_.globe=this.globe_,this.scene_.skyAtmosphere=new Cesium.SkyAtmosphere;const h=new Cesium.SingleTileImageryProvider({url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",rectangle:Cesium.Rectangle.fromDegrees(0,0,1,1)});this.globe_.imageryLayers.addImageryProvider(h,0),this.dataSourceCollection_=new Cesium.DataSourceCollection,this.dataSourceDisplay_=new Cesium.DataSourceDisplay({scene:this.scene_,dataSourceCollection:this.dataSourceCollection_});const l=t.createSynchronizers?t.createSynchronizers(this.map_,this.scene_,this.dataSourceCollection_):[new D1(this.map_,this.scene_),new V1(this.map_,this.scene_),new $1(this.map_,this.scene_)];this.handleResize_();for(let u=l.length-1;u>=0;--u)l[u].synchronize();this.lastFrameTime_=0,this.renderId_=void 0,this.targetFrameRate_=Number.POSITIVE_INFINITY,this.blockCesiumRendering_=!1,this.warmingUp_=!1,this.trackedFeature_=null,this.trackedEntity_=null,this.entityView_=null,this.needTrackedEntityUpdate_=!1,this.boundingSphereScratch_=new Cesium.BoundingSphere,new Cesium.EventHelper().add(this.scene_.postRender,Se.prototype.updateTrackedEntity_,this),Cesium.Camera.enableSuspendTerrainAdjustment=!1}render_(){this.renderId_!==void 0&&(cancelAnimationFrame(this.renderId_),this.renderId_=void 0),(this.enabled_||this.warmingUp_)&&!this.blockCesiumRendering_&&(this.renderId_=requestAnimationFrame(this.onAnimationFrame_.bind(this)))}onAnimationFrame_(t){this.renderId_=void 0;const i=1e3/this.targetFrameRate_;if(t-this.lastFrameTime_<i){this.render_();return}this.lastFrameTime_=t;const n=this.time_();if(this.scene_.initializeFrame(),this.handleResize_(),this.dataSourceDisplay_.update(n),this.entityView_){const r=this.trackedEntity_;this.dataSourceDisplay_.getBoundingSphere(r,!1,this.boundingSphereScratch_)===Cesium.BoundingSphereState.DONE&&(this.boundingSphereScratch_.radius=1,this.entityView_.update(n,this.boundingSphereScratch_))}this.scene_.render(n),this.camera_.checkCameraChange(),this.render_()}updateTrackedEntity_(){if(!this.needTrackedEntityUpdate_)return;const t=this.trackedEntity_,i=this.scene_,s=this.dataSourceDisplay_.getBoundingSphere(t,!1,this.boundingSphereScratch_);if(s===Cesium.BoundingSphereState.PENDING)return;i.screenSpaceCameraController.enableTilt=!1;const n=s!==Cesium.BoundingSphereState.FAILED?this.boundingSphereScratch_:void 0;n&&(n.radius=1),this.entityView_=new Cesium.EntityView(t,i,i.mapProjection.ellipsoid),this.entityView_.update(this.time_(),n),this.needTrackedEntityUpdate_=!1}handleResize_(){let t=this.canvas_.clientWidth,i=this.canvas_.clientHeight;if(t===0|i===0||t===this.canvasClientWidth_&&i===this.canvasClientHeight_&&!this.resolutionScaleChanged_)return;let s=this.resolutionScale_;z.supportsImageRenderingPixelated()||(s*=window.devicePixelRatio||1),this.resolutionScaleChanged_=!1,this.canvasClientWidth_=t,this.canvasClientHeight_=i,t*=s,i*=s,this.canvas_.width=t,this.canvas_.height=i,this.scene_.camera.frustum.aspectRatio=t/i}getCamera(){return this.camera_}getOlMap(){return this.map_}getOlView(){const t=this.map_.getView();return console.assert(t),t}getCesiumScene(){return this.scene_}getDataSources(){return this.dataSourceCollection_}getDataSourceDisplay(){return this.dataSourceDisplay_}getEnabled(){return this.enabled_}setEnabled(t){if(this.enabled_===t)return;this.enabled_=t,this.container_.style.visibility=this.enabled_?"visible":"hidden";let i;if(this.enabled_){if(this.throwOnUnitializedMap_(),this.isOverMap_){i=this.map_.getInteractions(),i.forEach((n,r,a)=>{this.pausedInteractions_.push(n)}),i.clear(),this.map_.addInteraction=n=>this.pausedInteractions_.push(n),this.map_.removeInteraction=n=>this.pausedInteractions_=this.pausedInteractions_.filter(r=>r!==n);const s=this.map_.getLayerGroup();s.getVisible()&&(this.hiddenRootGroup_=s,this.hiddenRootGroup_.setVisible(!1)),this.map_.getOverlayContainer().classList.add("olcs-hideoverlay")}this.camera_.readFromView(),this.render_()}else this.isOverMap_&&(i=this.map_.getInteractions(),this.pausedInteractions_.forEach(s=>{i.push(s)}),this.pausedInteractions_.length=0,this.map_.addInteraction=s=>this.map_.getInteractions().push(s),this.map_.removeInteraction=s=>this.map_.getInteractions().remove(s),this.map_.getOverlayContainer().classList.remove("olcs-hideoverlay"),this.hiddenRootGroup_&&(this.hiddenRootGroup_.setVisible(!0),this.hiddenRootGroup_=null)),this.camera_.updateView()}warmUp(t,i){if(this.enabled_)return;this.throwOnUnitializedMap_(),this.camera_.readFromView();const s=this.globe_.ellipsoid,n=this.scene_.camera,r=s.cartesianToCartographic(n.position);r.height<t&&(r.height=t,n.position=s.cartographicToCartesian(r)),this.warmingUp_=!0,this.render_(),setTimeout(()=>{this.warmingUp_=!1},i)}setBlockCesiumRendering(t){this.blockCesiumRendering_!==t&&(this.blockCesiumRendering_=t,this.render_())}enableAutoRenderLoop(){this.autoRenderLoop_||(this.autoRenderLoop_=new k1(this))}getAutoRenderLoop(){return this.autoRenderLoop_}setResolutionScale(t){t=Math.max(0,t),t!==this.resolutionScale_&&(this.resolutionScale_=Math.max(0,t),this.resolutionScaleChanged_=!0,this.autoRenderLoop_&&this.autoRenderLoop_.restartRenderLoop())}setTargetFrameRate(t){this.targetFrameRate_!==t&&(this.targetFrameRate_=t,this.render_())}throwOnUnitializedMap_(){const i=this.map_.getView(),s=i.getCenter();if(!i.isDef()||isNaN(s[0])||isNaN(s[1]))throw new Error(`The OpenLayers map is not properly initialized: ${s} / ${i.getResolution()}`)}get trackedFeature(){return this.trackedFeature_}set trackedFeature(t){if(this.trackedFeature_!==t){const i=this.scene_;if(!t||!t.getGeometry()){this.needTrackedEntityUpdate_=!1,i.screenSpaceCameraController.enableTilt=!0,this.trackedEntity_&&this.dataSourceDisplay_.defaultDataSource.entities.remove(this.trackedEntity_),this.trackedEntity_=null,this.trackedFeature_=null,this.entityView_=null,i.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);return}this.trackedFeature_=t,this.needTrackedEntityUpdate_=!0;const s=this.to4326Transform_,n=function(){const a=t.getGeometry();console.assert(a instanceof Wt);const o=a.getCoordinates(),h=s(o,void 0,o.length);return R.ol4326CoordinateToCesiumCartesian(h)},r={position:new Cesium.CallbackProperty((a,o)=>n(),!1),point:{pixelSize:1,color:Cesium.Color.TRANSPARENT}};this.trackedEntity_=this.dataSourceDisplay_.defaultDataSource.entities.add(r)}}}const z1={props:{},setup(e,{emit:t}){const i=xe,s=$t({defaultCenter:[121.326776,24.655499],defaultCenterZoom:9,targetNum:1,conditionWrap:!1,layerSelect:!1,currentLayers:[],layers:[],mapLayers:ds(()=>s.layers.map((M,v)=>({label:M.group_title,value:M.value,layers:M.group_layers,groupClass:M.group_class}))),selectLock:!1,mapCount:1,map1:null,map2:null,map1LayerStatus:[],map2LayerStatus:[],temp:{map1BaseStatus:0,map2BaseStatus:0},deleteLightbox:!1,dimensionMap:{map1:"2D",map2:"2D"},toSearchDimensionStatus:ds(()=>{let M=s.targetNum==1?"map1":"map2";return s.dimensionMap[M]==="2D"}),ol3d:null,selectValueTemp:0,areaData:{nodeRef:null,overlay:null,tribeAreaData:{}},comSize:{wrapHeight:"",wrapWidth:"",conditionCom:{}},selectLayerOption:{}});let n=null;const r=new Pn({projection:"EPSG:4326",center:s.defaultCenter,zoom:s.defaultCenterZoom});function a(){s.map1=new oe({target:"map1",layers:[ei.getBaseMapData(0)],view:r,controls:[]})}function o(M,v){const w=new de({source:new Ht({features:[new Ee({geometry:new Wt([M,v]),population:4e3,rainfall:500})]}),style:new On({image:new Di({anchor:[.5,100],anchorXUnits:"fraction",anchorYUnits:"pixels",src:"https://www.ockert-cnc.de/wp-content/uploads/2016/12/map-marker-icon-100x100.png"})})});let C=s.targetNum==1?"map1":"map2";s[C].addLayer(w)}function h({action:M,value:v}){var T;let w=((T=s.map1)==null?void 0:T.getTarget())==null?"map2":"map1",C=s[w].getView();switch(M){case"In":C.animate({zoom:C.getZoom()+1});break;case"Out":C.animate({zoom:C.getZoom()-1});break;case"toNorth":C.animate({rotation:0});break;case"moveTo":if(v){const{xAxis:k,yAxis:D}=v;C.animate({center:[k,D],zoom:17,duration:100})}else navigator.geolocation.getCurrentPosition(function(k){C.animate({center:[k.coords.longitude,k.coords.latitude],zoom:17,duration:100}),o(k.coords.longitude,k.coords.latitude)});break;case"fullScreen":let L=document.getElementById(`map${s.targetNum}`);L.requestFullscreen?L.requestFullscreen():L.msRequestFullscreen?L.msRequestFullscreen():L.mozRequestFullScreen?L.mozRequestFullScreen():L.webkitRequestFullscreen&&L.webkitRequestFullscreen();break}}function l({action:M,value:v}){var T;let w=s.targetNum==1?s.map1:s.map2,C=w==null?void 0:w.getLayers();switch(console.log(v.id),M){case"layerMode":if(v.checked){s.layers[v.nodeIndex].group_layers[v.subNodeIndex].single_tiles||(C.getArray().forEach(Lt=>{Lt.get("id")&&Lt.get("id").includes(`node${v.nodeIndex}_subNode${v.subNodeIndex}_nestedSubNode`)&&w.removeLayer(Lt)}),f("delete",w.getTarget(),v.id));let N=v.nestedSubNodeIndex||s.selectValueTemp;console.log(s.layers[v.nodeIndex].group_layers[v.subNodeIndex]);let mt=i.getLayer(s.layers[v.nodeIndex].group_layers[v.subNodeIndex],N,v.id);w.addLayer(mt),s.layers[v.nodeIndex].group_layers.some(it=>it.layer_type==="WFS")&&(g(w,v.id),m(v)),f("add",w.getTarget(),v.id)}else{let mt=function(it){N.filter(Ft=>{var ye;return(ye=Ft==null?void 0:Ft.get("id"))==null?void 0:ye.includes(it)}).forEach(Ft=>{w.removeLayer(Ft)})},N=C.getArray();if(v.id.includes("node9_subNode0_nestedSubNode"))mt("node9_subNode0_nestedSubNode");else if(v.id.includes("node12_subNode1_nestedSubNode"))mt("node12_subNode1_nestedSubNode");else{const it=N.find(Lt=>Lt.get("id")===v.id);it&&w.removeLayer(it)}s.layers[v.nodeIndex].group_layers.some(it=>it.layer_type==="WFS")&&(m(v),s.areaData.tribeAreaData={},w.removeOverlay(s.areaData.overlay),s.areaData.overlay=null),f("delete",w.getTarget(),v.id)}break;case"selectLayerMode":if(s.selectLock)return;v.layerName==="all"?C.getArray().filter(it=>it.get("id")!==void 0).forEach(it=>{w.removeLayer(it)}):C.getArray().forEach(mt=>{mt.get("id")==v.id&&w.removeLayer(mt)});break;case"changeOrder":if(s.selectLock)return;let L=xe.getLayerIndex(v.id),k=i.getLayer(s.layers[L.nodeIndex].group_layers[L.subNodeIndex],L.nestedSubNodeIndex,v.id);if(v.movement==="up"){if(v.key+1==C.getArray().length)return;v.checked=!1,l({action:"layerMode",value:v}),C.insertAt(v.key+1,k)}if(v.movement==="down"){if(v.key-1==0)return;v.checked=!1,l({action:"layerMode",value:v}),C.insertAt(v.key-1,k)}break;case"changeLayerVisible":if(s.selectLock)return;let D=!C.getArray()[v.key].getVisible();C.getArray()[v.key].setVisible(D);break;case"baseMap":s.temp[`map${s.targetNum}BaseStatus`]=v.baseId;let X=new ue({preload:1/0,name:v.name,label:v.label,type:v.mapType,baseId:v.baseId,source:new Rn({url:v.url}),crossOrigin:"anonymous"}),ht=w==null?void 0:w.getLayers().getArray();C.insertAt(0,X),ht.forEach(N=>(N.get("type")=="base"&&N.get("baseId")!==v.baseId&&w.removeLayer(N),!0));break;case"changeMapCount":if(s.mapCount===v.qty)return;let et=s.targetNum!==1?"map1":"map2";s.mapCount=v.qty;let lt=s[`${et}LayerStatus`].filter(N=>N!=="3D").map(N=>xe.getLayerIndex(N));if(v.qty===2&&(s[et]=new oe({target:et,layers:[ei.getBaseMapData(0),...lt.map(N=>i.getLayer(s.layers[N.nodeIndex].group_layers[N.subNodeIndex],N.nestedSubNodeIndex,N.id))],view:r,controls:[]}),((T=s[`${et}LayerStatus`])==null?void 0:T.indexOf("3D"))!==-1)){n=new Se({map:s[et]}),n.setEnabled(!0),Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0NzM3MWFhYS0xMjNlLTQ3MTMtODFjZS0xZjMzM2I5NGZiYTEiLCJpZCI6MTMwODE4LCJpYXQiOjE2ODQwNzM3Mjl9.UYu4kBialPo19dcvosHzZTpg2BD1zkFQnjCD78YiiYo";let N=n.getCesiumScene({});N.terrainProvider=Cesium.createWorldTerrain({})}if(v.qty===1){s[et]=null;const N=document.getElementById(et);for(;N.firstChild;)N.removeChild(N.firstChild)}break;case"changeDimensionMap":let gt=s.targetNum==1?"map1":"map2";if(s.dimensionMap[gt]=v,v==="3D"){n=new Se({map:w}),n.setEnabled(!0),Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0NzM3MWFhYS0xMjNlLTQ3MTMtODFjZS0xZjMzM2I5NGZiYTEiLCJpZCI6MTMwODE4LCJpYXQiOjE2ODQwNzM3Mjl9.UYu4kBialPo19dcvosHzZTpg2BD1zkFQnjCD78YiiYo";let N=n.getCesiumScene({});N.terrainProvider=Cesium.createWorldTerrain({}),s[`${gt}LayerStatus`].push("3D")}else n.setEnabled(!1),s[`${gt}LayerStatus`]=s[`${gt}LayerStatus`].filter(N=>N!=="3D");break;case"setOpacity":C.getArray()[v.key].getOpacity()!==1?C.getArray()[v.key].setOpacity(1):C.getArray()[v.key].setOpacity(.5);break}u()}function c(M){var w;s.targetNum=M;let v=s.targetNum!==1?"map1":"map2";if(s.mapCount===1){if(!s[`map${M}`]){let C=s[`map${M}LayerStatus`].filter(L=>L!=="3D");C.includes("node0_subNode4_nestedSubNodeundefined")&&(C=[...C.filter(k=>k!=="node0_subNode4_nestedSubNodeundefined"),"node0_subNode4_nestedSubNodeundefined"]);let T=C.map(L=>xe.getLayerIndex(L));s[`map${M}`]=new oe({target:`map${M}`,layers:[ei.getBaseMapData(s.temp[`map${s.targetNum}BaseStatus`]),...T.map(L=>i.getLayer(s.layers[L.nodeIndex].group_layers[L.subNodeIndex],L.nestedSubNodeIndex,L.layeredIndex))],view:r,controls:[]}),g(s[`map${M}`]),((w=s[`map${M}LayerStatus`])==null?void 0:w.indexOf("3D"))!==-1&&(n=new Se({map:s[`map${M}`]}),n.setEnabled(!0))}if(s[v]){s[v]=null;const C=document.getElementById(v);for(;C.firstChild;)C.removeChild(C.firstChild)}}fs(()=>{u()})}function u(){var w;let M=s.targetNum==1?s.map1:s.map2;const v=(w=M==null?void 0:M.getLayers())==null?void 0:w.getArray();s.currentLayers=v==null?void 0:v.map(C=>({label:C.get("label"),id:C.get("id"),visible:C.getVisible()}))}function d(){s.conditionWrap=!s.conditionWrap}function f(M,v,w){if(M==="add")s[`${v}LayerStatus`].push(w);else if(M==="delete"){let C=s[`${v}LayerStatus`].findIndex(T=>T===w);s[`${v}LayerStatus`].splice(C,1)}else console.log("error")}function g(M,v="node0_subNode4_nestedSubNodeundefined"){var C;let w=new pu({layers:(C=M==null?void 0:M.getLayers())==null?void 0:C.getArray(),condition:Ja});M.addInteraction(w),w.on("select",T=>{let L=T.selected;T.selected[0]?(s.areaData.overlay=new di({element:s.areaData.nodeRef,autoPan:!0,autoPanAnimation:{duration:250}}),M.addOverlay(s.areaData.overlay),s.areaData.overlay.setPosition(T.mapBrowserEvent.coordinate),s.areaData.tribeAreaData={},L[0].get("編號")===void 0?s.areaData.tribeAreaData=L[0]:L.forEach(k=>{let D=k.getProperties();Object.entries(D).forEach(X=>{const ht=X[0],et=X[1];s.areaData.tribeAreaData[ht]=et})})):(s.areaData.tribeAreaData={},M.removeOverlay(s.areaData.overlay),s.areaData.overlay=null)})}function y(){(s.targetNum==1?s.map1:s.map2).removeOverlay(s.areaData.overlay),s.areaData.overlay=null}function m(M){const{checked:v,id:w}=M;if(!v){s.selectLayerOption={};return}w==="node4_subNode0_nestedSubNodeundefined"&&te.ajax({url:"https://api.edtest.site/tribes",method:"GET",success:C=>{s.selectLayerOption[w]=C},error:C=>{console.log(C)}}),w==="node7_subNode0_nestedSubNodeundefined"&&te.ajax({url:"https://gis.edtest.site/ogc/temp?VERSION=1.3.0&SERVICE=WFS&REQUEST=GetFeature&OUTPUTFORMAT=application/json&TYPENAME=近年歷史災害82處部落點位&STYLE=default",method:"GET",success:C=>{s.selectLayerOption[w]=C.features},error:C=>{console.log(C.features)}})}function p(M){if(Object.keys(s.selectLayerOption)[0]==="node4_subNode0_nestedSubNodeundefined"&&s.selectLayerOption.node4_subNode0_nestedSubNodeundefined[Number(M.target.value)].coordinates.WGS84!==null){let v={action:"moveTo",value:{xAxis:s.selectLayerOption.node4_subNode0_nestedSubNodeundefined[Number(M.target.value)].coordinates.WGS84.lng,yAxis:s.selectLayerOption.node4_subNode0_nestedSubNodeundefined[Number(M.target.value)].coordinates.WGS84.lat}};h(v)}if(Object.keys(s.selectLayerOption)[0]==="node7_subNode0_nestedSubNodeundefined"&&s.selectLayerOption.node7_subNode0_nestedSubNodeundefined[M.target.value].geometry.coordinates[0]!==null){let v={action:"moveTo",value:{xAxis:s.selectLayerOption.node7_subNode0_nestedSubNodeundefined[M.target.value].geometry.coordinates[0],yAxis:s.selectLayerOption.node7_subNode0_nestedSubNodeundefined[M.target.value].geometry.coordinates[1]}};h(v)}}function x(){return te.ajax({url:"https://api.edtest.site/underLayers",method:"GET"}).done(M=>M)}function b(){return te.ajax({url:"https://api.edtest.site/layers",method:"GET"}).done(M=>M)}return bi(async()=>{let M=x(),v=b();Promise.all([M,v]).then(w=>{let C=w[0].data.map((T,L)=>({mapType:"base",baseId:L,onCurrent:!1,...T}));ei.setBaseMapData(C),s.temp.map1BaseStatus=0,s.temp.baseMapList=tm(),s.layers=w[1].map((T,L)=>(T.group_layers.forEach((k,D)=>{let X=D,ht;k.id=`node${L}_subNode${X}_nestedSubNode${ht}`,k.single_tiles||k.tiles_list.forEach((et,zt)=>{ht=zt,et.id=`node${L}_subNode${X}_nestedSubNode${ht}`})}),{...T,value:L})),fs(()=>{a(),u()})}),s.comSize.wrapHeight=window.innerHeight,s.comSize.wrapWidth=window.innerWidth,window.onresize=w=>{s.comSize.wrapHeight=w.target.innerHeight,s.comSize.wrapWidth=w.target.innerWidth}}),{state:s,props:e,mapControl:h,layerControl:l,changeTarget:c,conditionWrap:d,closeMapData:y,addSelectElement:m,moveToMap:p}}},U1={class:"w-100 d-flex flex flex-sm-row flex-wrap flex-sm-nowrap mapWrap",id:"mapWrap"},q1={key:0,class:"middleLine"},W1={class:"SearchBar d-none d-sm-block position-absolute"},H1={class:"d-flex align-items-center"},K1=_("img",{src:In,alt:"",class:"mb-2"},null,-1),X1={class:"me-2 d-flex align-items-center"},Y1={class:"conditionCom d-none d-sm-block position-absolute"},Z1={class:"mb-2"},Q1={key:1},J1={key:0,class:"lightWrap w-100 h-100 d-flex justify-content-center align-items-center"},ty={class:"p-4 rounded bg-white",style:{width:"250px"}},ey=_("p",{class:"text-center fw-bold"},"是否要刪除全部圖層",-1),iy={class:"d-flex justify-content-around"},sy={class:"m-Navbar d-flex d-sm-none position-fixed bottom-0 start-0 w-100"},ny={key:1};function ry(e,t,i,s,n,r){var f,g,y;const a=M1,o=i1,h=Qm,l=Sm,c=gu,u=kc,d=jo;return O(),A("div",null,[_("div",U1,[_("div",{id:"map1",class:vt({"w-100":((f=s.state.map1)==null?void 0:f.getTarget())=="map1","h-100":s.state.mapCount===1,"h-50":s.state.mapCount===2&&s.state.comSize.wrapWidth<600})},null,2),s.state.mapCount===2?(O(),A("div",q1)):K("",!0),_("div",{id:"map2",class:vt({"w-100":((g=s.state.map2)==null?void 0:g.getTarget())=="map2","h-100":s.state.mapCount===1,"h-50":s.state.mapCount===2&&s.state.comSize.wrapWidth<600})},null,2)]),It(a,{class:"asideTool position-absolute top-50 translate-middle-y",id:"asideTool",onOnMapControl:t[0]||(t[0]=({action:m,value:p})=>{s.mapControl({action:m,value:p})})}),_("div",W1,[_("div",H1,[K1,_("ul",null,[_("li",X1,[It(o,{class:"mapSourceOption d-none d-sm-block",baseMapList:s.state.temp.baseMapList,onChangeBaseMaps:({action:m,value:p})=>{s.layerControl({action:m,value:p})}},null,8,["baseMapList","onChangeBaseMaps"])])])]),It(h,{dimensionMapStatus:s.state.toSearchDimensionStatus,currentLayers:s.state.currentLayers,mapCount:s.state.mapCount,onChangeBaseMaps:({action:m,value:p})=>{s.layerControl({action:m,value:p})},onOnLayerControl:t[1]||(t[1]=({action:m,value:p})=>{s.layerControl({action:m,value:p})}),onOnChangeTarget:t[2]||(t[2]=m=>{s.changeTarget(m)}),onConditionWrap:t[3]||(t[3]=m=>{s.conditionWrap(m)})},null,8,["dimensionMapStatus","currentLayers","mapCount","onChangeBaseMaps"])]),_("div",Y1,[_("div",Z1,[s.state.conditionWrap?K("",!0):(O(),A("button",{key:0,class:"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5",onClick:t[4]||(t[4]=m=>s.state.conditionWrap=!0)}," 圖層選項 ")),s.state.conditionWrap?(O(),A("div",{key:1,class:"mb-4",style:{"max-height":"50%"},ref:m=>{s.state.comSize.conditionCom=m}},[It(l,Ei({selectLayerOption:s.state.selectLayerOption,mapLayers:s.state.mapLayers,currentLayers:s.state.currentLayers,onClose:()=>{s.state.conditionWrap=!1},showSelectLayerValue:m=>{s.state.selectValueTemp=m},moveToMap:m=>{s.moveToMap(m)}},{onOnMapControl:t[5]||(t[5]=({action:m,value:p})=>{s.mapControl({action:m,value:p})}),onOnLayerControl:t[6]||(t[6]=({action:m,value:p})=>{s.layerControl({action:m,value:p})})}),null,16)],512)):K("",!0)]),_("div",null,[s.state.layerSelect?K("",!0):(O(),A("button",{key:0,class:"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5",onClick:t[7]||(t[7]=m=>s.state.layerSelect=!0)}," 已選擇的圖層 ")),s.state.layerSelect?(O(),A("div",Q1,[It(c,wr(Sr({selectLock:s.state.selectLock,currentLayers:s.state.currentLayers,onClose:()=>{s.state.layerSelect=!1},onLockLayer:()=>{s.state.selectLock=!s.state.selectLock},onDeleteLayer:({action:m,value:p})=>{p.layerName=="all"?s.state.deleteLightbox=!0:s.layerControl({action:m,value:p})},onDeleteLayerAll:()=>{s.state.deleteLightbox=!0},onLayerControl:({action:m,value:p})=>{s.layerControl({action:m,value:p})}})),null,16)])):K("",!0)])]),s.state.deleteLightbox?(O(),A("div",J1,[_("div",ty,[ey,_("div",iy,[_("button",{class:"rounded px-3 py-1 bg-steel text-white border-0",onClick:t[8]||(t[8]=()=>{s.layerControl({action:"selectLayerMode",value:{layerName:"all"}}),s.state.deleteLightbox=!1})},"確定"),_("button",{class:"rounded px-3 py-1 bg-secondary bg-gradient text-white border-0",onClick:t[9]||(t[9]=()=>{s.state.deleteLightbox=!1})},"取消")])])])):K("",!0),_("div",{id:"popup",class:"position-absolute bottom-0",ref:m=>{s.state.areaData.nodeRef=m}},[(y=s.state.areaData)!=null&&y.overlay?(O(),gs(u,{key:0,class:"areaData",closeMapData:()=>{s.closeMapData()},tribeAreaData:s.state.areaData.tribeAreaData,maxHeight:500,coordinate:s.state.areaData.overlay.get("position")},null,8,["closeMapData","tribeAreaData","coordinate"])):K("",!0)],512),_("div",sy,[s.state.conditionWrap?(O(),gs(l,Ei({key:0,class:"position-absolute bottom-100 w-100"},{mapLayers:s.state.mapLayers,currentLayers:s.state.currentLayers,onClose:()=>{s.state.conditionWrap=!1},showSelectLayerValue:m=>{s.state.selectValueTemp=m}},{onOnMapControl:t[10]||(t[10]=({action:m,value:p})=>{s.mapControl({action:m,value:p})}),onOnLayerControl:t[11]||(t[11]=({action:m,value:p})=>{s.layerControl({action:m,value:p})})}),null,16)):K("",!0),s.state.layerSelect?(O(),A("div",ny,[It(c,Ei({class:"position-absolute bottom-100 w-100"},{selectLock:s.state.selectLock,currentLayers:s.state.currentLayers,onClose:()=>{s.state.layerSelect=!1},onChangLayerVisible:m=>{s.layerControl(m)},onChangeOrderLayer:({action:m,value:p})=>{s.layerControl({action:m,value:p})},onLockLayer:()=>{s.state.selectLock=!s.state.selectLock},onDeleteLayer:({action:m,value:p})=>{p.layerName=="all"?s.state.deleteLightbox=!0:s.layerControl({action:m,value:p})},onDeleteLayerAll:()=>{s.state.deleteLightbox=!0}},{setOpacity:({action:m,value:p})=>{s.layerControl({action:m,value:p})}}),null,16,["setOpacity"])])):K("",!0),It(d,{dimensionMapStatus:s.state.toSearchDimensionStatus,currentLayers:s.state.currentLayers,mapCount:s.state.mapCount,openConditionWrap:()=>{s.state.conditionWrap=!s.state.conditionWrap,s.state.layerSelect=!1},openLayerSelect:()=>{s.state.layerSelect=!s.state.layerSelect,s.state.conditionWrap=!1},onLayerControl:({action:m,value:p})=>{s.layerControl({action:m,value:p})},onChangeTarget:m=>{s.changeTarget(m)},onConditionWrap:t[12]||(t[12]=m=>{s.conditionWrap(m)})},null,8,["dimensionMapStatus","currentLayers","mapCount","openConditionWrap","openLayerSelect","onLayerControl","onChangeTarget"])])])}const yy=Ot(z1,[["render",ry]]);export{yy as default};
//# sourceMappingURL=WebMap-faa94318.js.map
