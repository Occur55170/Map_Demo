import{$ as je,_ as W,r as ee,w as rt,o as He,a as b,c as L,b as h,t as k,d as le,F as X,e as J,f as E,g as at,p as Se,h as Me,i as x,n as D,u as lt,j as We,v as Ue,k as fe,l as Te,m as Re,q as K,s as ct,x as dt,y as ut}from"./index-6cb95ac8.js";import{V as A,a as Ke,E as Ee,g as Fe,c as ht,b as mt,d as pt,s as gt,e as Ze,P as j,F as Q,f as qe,o as ft,m as yt,h as _t,i as Ct,t as vt,j as wt,k as bt,l as B,n as ke,p as Lt,q as Ye,r as St,u as Mt,v as xt,L as Ie,w as Ot,M as Pt,x as Tt,y as Rt,z as Xe,T as ye,S as Z,A as me,B as Ae,C as Ne,D as Ge,G,H as Je,I as ie,J as z,K as ve,N as P,O as Et,Q as Ft,R as O,U as we,W as q,X as kt,Y as H,Z as It,_ as _e,$ as At,a0 as be,a1 as Nt,a2 as De,a3 as Gt,a4 as Dt,a5 as Vt,a6 as Qe,a7 as $t,a8 as zt,a9 as Bt,aa as jt,ab as Ce,ac as ne}from"./core-014083be.js";class Ht extends A{constructor(e){super({attributions:e.attributions,wrapX:e.wrapX}),this.resolution=void 0,this.distance=e.distance!==void 0?e.distance:20,this.minDistance=e.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=e.geometryFunction||function(s){const t=s.getGeometry();return Ke(t.getType()=="Point",10),t},this.createCustomCluster_=e.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(e.source||null)}clear(e){this.features.length=0,super.clear(e)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(e,s,t){this.source.loadFeatures(e,s,t),s!==this.resolution&&(this.resolution=s,this.refresh())}setDistance(e){this.updateDistance(e,this.minDistance)}setMinDistance(e){this.updateDistance(this.distance,e)}getMinDistance(){return this.minDistance}setSource(e){this.source&&this.source.removeEventListener(Ee.CHANGE,this.boundRefresh_),this.source=e,e&&e.addEventListener(Ee.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(e,s){const t=e===0?0:Math.min(s,e)/e,i=e!==this.distance||this.interpolationRatio!==t;this.distance=e,this.minDistance=s,this.interpolationRatio=t,i&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;const e=qe(),s=this.distance*this.resolution,t=this.source.getFeatures(),i={};for(let o=0,n=t.length;o<n;o++){const a=t[o];if(!(Fe(a)in i)){const r=this.geometryFunction(a);if(r){const d=r.getCoordinates();ht(d,e),mt(e,s,e);const u=this.source.getFeaturesInExtent(e).filter(function(c){const m=Fe(c);return m in i?!1:(i[m]=!0,!0)});this.features.push(this.createCluster(u,e))}}}}createCluster(e,s){const t=[0,0];for(let a=e.length-1;a>=0;--a){const r=this.geometryFunction(e[a]);r?pt(t,r.getCoordinates()):e.splice(a,1)}gt(t,1/e.length);const i=Ze(s),o=this.interpolationRatio,n=new j([t[0]*(1-o)+i[0]*o,t[1]*(1-o)+i[1]*o]);return this.createCustomCluster_?this.createCustomCluster_(n,e):new Q({geometry:n,features:e})}}const et=Ht;class Wt extends ft{constructor(e){e=e||{},super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.params_=e.params||{},this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.tmpExtent_=qe(),this.setKey(this.getKeyForParams_())}getKeyForParams_(){let e=0;const s=[];for(const t in this.params_)s[e++]=t+"-"+this.params_[t];return s.join("/")}getParams(){return this.params_}getRequestUrl_(e,s,t,i,o,n){const a=this.urls;if(!a)return;const r=o.getCode().split(/:(?=\d+$)/).pop();n.SIZE=s[0]+","+s[1],n.BBOX=t.join(","),n.BBOXSR=r,n.IMAGESR=r,n.DPI=Math.round(n.DPI?n.DPI*i:90*i);let d;if(a.length==1)d=a[0];else{const c=yt(_t(e),a.length);d=a[c]}const u=d.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage");return Ct(u,n)}getTilePixelRatio(e){return this.hidpi_?e:1}updateParams(e){Object.assign(this.params_,e),this.setKey(this.getKeyForParams_())}tileUrlFunction(e,s,t){let i=this.getTileGrid();if(i||(i=this.getTileGridForProjection(t)),i.getResolutions().length<=e[0])return;s!=1&&!this.hidpi_&&(s=1);const o=i.getTileCoordExtent(e,this.tmpExtent_);let n=vt(i.getTileSize(e[0]),this.tmpSize);s!=1&&(n=wt(n,s,this.tmpSize));const a={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};return Object.assign(a,this.params_),this.getRequestUrl_(e,n,o,s,t,a)}}const Ut=Wt;class Kt extends bt{constructor(){super()}getType(){return"json"}readFeature(e,s){return this.readFeatureFromObject(ue(e),this.getReadOptions(e,s))}readFeatures(e,s){return this.readFeaturesFromObject(ue(e),this.getReadOptions(e,s))}readFeatureFromObject(e,s){return B()}readFeaturesFromObject(e,s){return B()}readGeometry(e,s){return this.readGeometryFromObject(ue(e),this.getReadOptions(e,s))}readGeometryFromObject(e,s){return B()}readProjection(e){return this.readProjectionFromObject(ue(e))}readProjectionFromObject(e){return B()}writeFeature(e,s){return JSON.stringify(this.writeFeatureObject(e,s))}writeFeatureObject(e,s){return B()}writeFeatures(e,s){return JSON.stringify(this.writeFeaturesObject(e,s))}writeFeaturesObject(e,s){return B()}writeGeometry(e,s){return JSON.stringify(this.writeGeometryObject(e,s))}writeGeometryObject(e,s){return B()}}function ue(l){if(typeof l=="string"){const e=JSON.parse(l);return e||null}else if(l!==null)return l;return null}const Zt=Kt,qt={Point:Qt,LineString:es,Polygon:ns,MultiPoint:ss,MultiLineString:ts,MultiPolygon:is},Yt={Point:os,LineString:rs,Polygon:as,MultiPoint:cs,MultiLineString:ls,MultiPolygon:ds};class Xt extends Zt{constructor(e){e=e||{},super(),this.geometryName_=e.geometryName}readFeatureFromObject(e,s,t){const i=e,o=Ve(i.geometry,s),n=new Q;if(this.geometryName_&&n.setGeometryName(this.geometryName_),n.setGeometry(o),i.attributes){n.setProperties(i.attributes,!0);const a=i.attributes[t];a!==void 0&&n.setId(a)}return n}readFeaturesFromObject(e,s){if(s=s||{},e.features){const t=e,i=[],o=t.features;for(let n=0,a=o.length;n<a;++n)i.push(this.readFeatureFromObject(o[n],s,e.objectIdFieldName));return i}return[this.readFeatureFromObject(e,s)]}readGeometryFromObject(e,s){return Ve(e,s)}readProjectionFromObject(e){if(e.spatialReference&&e.spatialReference.wkid!==void 0){const t=e.spatialReference.wkid;return ke("EPSG:"+t)}return null}writeGeometryObject(e,s){return $e(e,this.adaptOptions(s))}writeFeatureObject(e,s){s=this.adaptOptions(s);const t={};if(!e.hasProperties())return t.attributes={},t;const i=e.getProperties(),o=e.getGeometry();if(o){t.geometry=$e(o,s);const n=s&&(s.dataProjection||s.featureProjection);n&&(t.geometry.spatialReference={wkid:Number(ke(n).getCode().split(":").pop())}),delete i[e.getGeometryName()]}return Lt(i)?t.attributes={}:t.attributes=i,t}writeFeaturesObject(e,s){s=this.adaptOptions(s);const t=[];for(let i=0,o=e.length;i<o;++i)t.push(this.writeFeatureObject(e[i],s));return{features:t}}}function Ve(l,e){if(!l)return null;let s;if(typeof l.x=="number"&&typeof l.y=="number")s="Point";else if(l.points)s="MultiPoint";else if(l.paths)l.paths.length===1?s="LineString":s="MultiLineString";else if(l.rings){const i=l,o=te(i),n=Jt(i.rings,o);n.length===1?(s="Polygon",l=Object.assign({},l,{rings:n[0]})):(s="MultiPolygon",l=Object.assign({},l,{rings:n}))}const t=qt[s];return Ye(t(l),!1,e)}function Jt(l,e){const s=[],t=[],i=[];let o,n;for(o=0,n=l.length;o<n;++o)s.length=0,St(s,0,l[o],e.length),Mt(s,0,s.length,e.length)?t.push([l[o]]):i.push(l[o]);for(;i.length;){const a=i.shift();let r=!1;for(o=t.length-1;o>=0;o--){const d=t[o][0];if(xt(new Ie(d).getExtent(),new Ie(a).getExtent())){t[o].push(a),r=!0;break}}r||t.push([a.reverse()])}return t}function Qt(l){let e;return l.m!==void 0&&l.z!==void 0?e=new j([l.x,l.y,l.z,l.m],"XYZM"):l.z!==void 0?e=new j([l.x,l.y,l.z],"XYZ"):l.m!==void 0?e=new j([l.x,l.y,l.m],"XYM"):e=new j([l.x,l.y]),e}function es(l){const e=te(l);return new Ot(l.paths[0],e)}function ts(l){const e=te(l);return new Pt(l.paths,e)}function te(l){let e="XY";return l.hasZ===!0&&l.hasM===!0?e="XYZM":l.hasZ===!0?e="XYZ":l.hasM===!0&&(e="XYM"),e}function ss(l){const e=te(l);return new Tt(l.points,e)}function is(l){const e=te(l);return new Rt(l.rings,e)}function ns(l){const e=te(l);return new Xe(l.rings,e)}function os(l,e){const s=l.getCoordinates();let t;const i=l.getLayout();return i==="XYZ"?t={x:s[0],y:s[1],z:s[2]}:i==="XYM"?t={x:s[0],y:s[1],m:s[2]}:i==="XYZM"?t={x:s[0],y:s[1],z:s[2],m:s[3]}:i==="XY"?t={x:s[0],y:s[1]}:Ke(!1,34),t}function ce(l){const e=l.getLayout();return{hasZ:e==="XYZ"||e==="XYZM",hasM:e==="XYM"||e==="XYZM"}}function rs(l,e){const s=ce(l);return{hasZ:s.hasZ,hasM:s.hasM,paths:[l.getCoordinates()]}}function as(l,e){const s=ce(l);return{hasZ:s.hasZ,hasM:s.hasM,rings:l.getCoordinates(!1)}}function ls(l,e){const s=ce(l);return{hasZ:s.hasZ,hasM:s.hasM,paths:l.getCoordinates()}}function cs(l,e){const s=ce(l);return{hasZ:s.hasZ,hasM:s.hasM,points:l.getCoordinates()}}function ds(l,e){const s=ce(l),t=l.getCoordinates(!1),i=[];for(let o=0;o<t.length;o++)for(let n=t[o].length-1;n>=0;n--)i.push(t[o][n]);return{hasZ:s.hasZ,hasM:s.hasM,rings:i}}function $e(l,e){const s=Yt[l.getType()];return s(Ye(l,!0,e),e)}const ze=Xt,Be={88:"石磊部",89:"平論文部",90:"抬耀部",91:"帛納外部",133:"河頭部落",118:"十八兒部落",119:"五峰部落",134:"泰平部落"};async function Le(l){return await je.ajax({url:`https://api.edtest.site/tribe?tribeCode=${l}`,method:"GET"}).done(s=>s).fail(s=>(console.log("Fail",s),!1))}const re={america:()=>new ye({name:"america",className:"america",preload:1/0,source:new Ut({url:"https://sampleserver6.arcgisonline.com/ArcGIS/rest/services/USA/MapServer"})}),EsriJSON:()=>{const l="https://services8.arcgis.com/jz4Cju60Wi6R7jAW/arcgis/rest/services/RIVERPOLY_(1)/FeatureServer/0",e=new Z({fill:new me,stroke:new Ae({color:[0,38,115,1],width:.5})}),s=new A({format:new ze,url:function(t,i,o){const n=o.getCode().split(/:(?=\d+$)/).pop();return l+"/query/?f=json&returnGeometry=true&spatialRel=esriSpatialRelIntersects&geometry="+encodeURIComponent(`{"xmin":${t[0]},"ymin":${t[1]},"xmax":${t[2]},"ymax":${t[3]},"spatialReference":{"wkid":${n}}}`)+"&geometryType=esriGeometryEnvelope&inSR="+n+"&outFields=*&outSR="+n},strategy:Ne(Ge({tileSize:512}))});return new G({name:"EsriJSON",source:s,style:function(t){const i=[0,38,115,1];return e.getFill().setColor(i),e},opacity:.7})},BsriJSON:()=>{const l="https://services8.arcgis.com/jz4Cju60Wi6R7jAW/arcgis/rest/services/河川支流/FeatureServer/0",e=new Z({fill:new me,stroke:new Ae({color:[0,0,0,1],width:.5})}),s=new A({format:new ze,url:function(t,i,o){const n=o.getCode().split(/:(?=\d+$)/).pop();return l+"/query/?f=json&returnGeometry=true&spatialRel=esriSpatialRelIntersects&geometry="+encodeURIComponent(`{"xmin":${t[0]},"ymin":${t[1]},"xmax":${t[2]},"ymax":${t[3]},"spatialReference":{"wkid":${n}}}`)+"&geometryType=esriGeometryEnvelope&inSR="+n+"&outFields=*&outSR="+n},strategy:Ne(Ge({tileSize:512}))});return new G({name:"BsriJSON",type:"BsriJSON",source:s,style:function(t){const i=[0,0,0,1];return e.getFill().setColor(i),e},opacity:1})},DimensionMap:()=>{const l=new Q({name:"DimensionMap",title:"DimensionMap",geometry:new Je([120.9984423386347,24.791781619336316],.005)}),e=new Z({renderer(o,n){const[[a,r],[d,u]]=o,c=n.context,m=d-a,f=u-r,p=Math.sqrt(m*m+f*f);c.beginPath(),c.arc(a,r,p,0,2*Math.PI,!0),c.fillStyle="rgba(255,0,0)",c.fill()}}),s=new G({source:new A({features:[l]}),style:e}),t=[[120.971859,24.801583],[120.97,24.809583],[120.985,24.808583],[120.99,24.806583],[120.971859,24.801583]],i=new G({name:"DimensionMap",title:"DimensionMap",source:new A({features:[new Q({name:"areaLineLayer",title:"areaLineLayer",geometry:new Xe([t])})]}),style:new Z({fill:new me({color:"#0f9ce2"})})});return[s,i]},getLayer:(l,e,s)=>{var a;let t,i,o=l.layer_type,n=l.figure_type;if(o==="WMS"){let r=[],d={};const u=isNaN(e)?l.tiles_url:l.tiles_list[e].tile_url;switch(n){case"Point":u&&(r=u.split("WMSServer?"),r[1]=r[1].split("&"),r[1].forEach(m=>{const f=m.split("=");d[f[0]]=f[1]})),i=new ie({maxzoom:18,minzoom:3,url:"https://dwgis1.ncdr.nat.gov.tw/server/services/MAP0627/Map2022FloodingPoint1721/MapServer/WMSServer",params:{SERVICE:"WMS",BGCOLOR:"0xFFFFFF",TRANSPARENT:"TRUE",SRS:"EPSG:3826",LAYERS:"0",VERSION:"1.1.1",FORMAT:"image/png"},serverType:"mapserver",crossOrigin:"anonymous"}),i=new ie({maxzoom:18,minzoom:3,url:r[0]+"WMSServer?",params:d,serverType:"mapserver"});break;case"Surface":u&&(r=u.split("WMSServer?"),r[1]=r[1].split("&"),r[1].forEach(m=>{const f=m.split("=");d[f[0]]=f[1]})),i=new ie({maxzoom:18,minzoom:3,url:r[0]+"WMSServer?",params:d,serverType:"mapserver"});break;case"Line":u&&(r=u.split("WMSServer?"),r[1]=r[1].split("&"),r[1].forEach(m=>{const f=m.split("=");d[f[0]]=f[1]})),i=new ie({maxzoom:18,minzoom:3,url:r[0]+"WMSServer?",params:d,serverType:"mapserver"});break;default:console.log("otherWMSLayer",n)}let c=isNaN(e)?"":`- ${(a=l.tiles_list[e])==null?void 0:a.title}`;t=new ye({id:s,label:`${l.title} ${c}`,source:i})}if(o==="GeoJson")switch(console.log("GeoJsonLayer",n),n){case"Line":console.log("1"),t=new G({source:new A({url:"http://gis.edtest.site:8010/ogc/temp",params:{SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetMap",FORMAT:"image/png",STYLE:"default",SLD_VERSION:"1.1.0"}})});break;case"Point":const r=new ie({maxzoom:18,minzoom:3,url:"https://dwgis1.ncdr.nat.gov.tw/server/services/MAP0627/Map2022FloodingPoint1721/MapServer/WMSServer",params:{SERVICE:"WMS",BGCOLOR:"0xFFFFFF",TRANSPARENT:"TRUE",SRS:"EPSG:3826",LAYERS:"0",VERSION:"1.1.1",FORMAT:"image/png"},crossOrigin:"anonymous"});t=new ye({source:r});break;default:console.log(n)}return t},getLayerIndex:l=>{let e,s,t;return l.split("_").forEach((i,o)=>{switch(o){case 0:e=Number(i.split("node")[1]);break;case 1:s=Number(i.split("subNode")[1]);break;case 2:t=i.split("nestedSubNode")[1]!=="undefined"?Number(i.split("nestedSubNode")[1]):"undefined";break}}),{nodeIndex:e,subNodeIndex:s,nestedSubNodeIndex:t,layeredIndex:l}}},us="/Map_Demo/assets/example-AddressData-2d340b55.jpg",hs="/Map_Demo/assets/vector-20ddd9fb.svg";const ms={props:{id:{Type:String,default:0},closeMapData:{Type:Function,default:()=>{}}},setup(l,{emit:e}){const s=ee({media:"photo",tribeData:()=>Le(l.id)});return rt(()=>{l.id}),He(()=>{Le(l.id).then(t=>{s.tribeData=t})}),{props:l,state:s}}},xe=l=>(Se("data-v-e22ecca8"),l=l(),Me(),l),ps={class:"bg-white rounded py-2"},gs=at('<div class="row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold" data-v-e22ecca8><p data-v-e22ecca8>詳細資訊</p><a href="" class="position-absolute col-auto end-0" style="top:10px;" data-v-e22ecca8><svg width="32" height="32" viewBox="0 0 24 24" data-v-e22ecca8><path fill="currentColor" d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10zm0-11.414L9.172 7.757L7.757 9.172L10.586 12l-2.829 2.828l1.415 1.415L12 13.414l2.828 2.829l1.415-1.415L13.414 12l2.829-2.828l-1.415-1.415L12 10.586z" data-v-e22ecca8></path></svg></a></div><img src="'+us+'" class="w-100" alt="" data-v-e22ecca8>',2),fs={class:"row mx-0 align-items-center p-2 position-relative"},ys=xe(()=>h("div",{class:"position-absolute w-auto top-0 end-0 mt-2"},"更多資訊",-1)),_s={href:""},Cs=xe(()=>h("img",{src:hs,alt:""},null,-1)),vs={class:"border-bottom row flex-nowrap p-2 my-3 cursor-pointer"},ws={key:0,class:"py-2 px-4"},bs={class:"d-flex flex-wrap justify-content-between"},Ls={class:"w-50 mb-4"},Ss={class:"mb-0"},Ms=["src"],xs={key:1,class:"py-2 px-4"},Os=xe(()=>h("div",null,"影片影片影片影片影片影片",-1)),Ps=[Os];function Ts(l,e,s,t,i,o){var n,a,r,d,u,c,m,f,p,y,w,_,g,v,C,F,M,T,$,U,ge,N;return b(),L("div",ps,[gs,h("div",fs,[h("p",null,"title: "+k((n=t.props)==null?void 0:n.id)+" "+k((d=(r=(a=t.state)==null?void 0:a.tribeData)==null?void 0:r.basicInformation)==null?void 0:d.tribeName),1),h("p",null,"描述: "+k((m=(c=(u=t.state)==null?void 0:u.tribeData)==null?void 0:c.basicInformation)==null?void 0:m.description),1),ys,h("p",null,k((y=(p=(f=t.state)==null?void 0:f.tribeData)==null?void 0:p.basicInformation)==null?void 0:y.area),1),h("a",_s,[Cs,le(" "+k((C=(v=(g=(_=(w=t.state)==null?void 0:w.tribeData)==null?void 0:_.basicInformation)==null?void 0:g.coordinates)==null?void 0:v.WGS84)==null?void 0:C.lat)+" , "+k((U=($=(T=(M=(F=t.state)==null?void 0:F.tribeData)==null?void 0:M.basicInformation)==null?void 0:T.coordinates)==null?void 0:$.WGS84)==null?void 0:U.lng),1)])]),h("div",null,[h("div",vs,[h("div",{class:"col-6 cursor-pointer",onClick:e[0]||(e[0]=se=>t.state.media="photo")},"相片"),h("div",{class:"col-6 cursor-pointer",onClick:e[1]||(e[1]=se=>t.state.media="video")},"影片")]),t.state.media==="photo"?(b(),L("div",ws,[h("div",bs,[(b(!0),L(X,null,J((N=(ge=t.state)==null?void 0:ge.tribeData)==null?void 0:N.culturalLandscape,se=>(b(),L("div",Ls,[h("p",Ss,k(se.name),1),h("img",{src:se.image,alt:"",class:"w-100"},null,8,Ms)]))),256))])])):E("",!0),t.state.media==="video"?(b(),L("div",xs,Ps)):E("",!0)])])}const Rs=W(ms,[["render",Ts],["__scopeId","data-v-e22ecca8"]]);const Es={props:{onClose:{type:Function,default:()=>{}},onChangLayerVisible:{type:Function,default:()=>{}},onDeleteLayer:{type:Function,default:()=>{}},onLockLayer:{type:Function,default:()=>{}},onChangeOrderLayer:{type:Function,default:()=>{}},currentLayers:{type:Array,default:[]},selectLock:{type:Boolean,default:!1}},setup(l,{emit:e}){const s=ee({});return{props:l,state:s}}},V=l=>(Se("data-v-b4ac34a6"),l=l(),Me(),l),Fs={class:"rounded-4 bg-white"},ks={class:"row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold"},Is=V(()=>h("p",{class:"mb-0 fs-5"},"已選擇的圖層",-1)),As=V(()=>h("svg",{width:"32",height:"32",viewBox:"0 0 24 24"},[h("path",{fill:"currentColor",d:"M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10zm0-11.414L9.172 7.757L7.757 9.172L10.586 12l-2.829 2.828l1.415 1.415L12 13.414l2.828 2.829l1.415-1.415L13.414 12l2.829-2.828l-1.415-1.415L12 10.586z"})],-1)),Ns=[As],Gs=V(()=>h("hr",{class:"my-0"},null,-1)),Ds={class:"py-3 px-4 content"},Vs={class:"allControl d-flex align-items-center justify-content-end mb-0"},$s=V(()=>h("svg",{viewBox:"0 0 25 24",fill:"currentColor"},[h("path",{d:"M8.02381 9.33333H14.881V7.80952C14.881 7.1746 14.6587 6.63492 14.2143 6.19048C13.7698 5.74603 13.2302 5.52381 12.5952 5.52381C11.9603 5.52381 11.4206 5.74603 10.9762 6.19048C10.5317 6.63492 10.3095 7.1746 10.3095 7.80952H8.78571C8.78571 6.75556 9.15727 5.85702 9.90038 5.1139C10.643 4.3713 11.5413 4 12.5952 4C13.6492 4 14.5477 4.3713 15.2909 5.1139C16.0335 5.85702 16.4048 6.75556 16.4048 7.80952V9.33333H17.1667C17.5857 9.33333 17.9446 9.48241 18.2432 9.78057C18.5414 10.0792 18.6905 10.4381 18.6905 10.8571V18.4762C18.6905 18.8952 18.5414 19.2541 18.2432 19.5528C17.9446 19.8509 17.5857 20 17.1667 20H8.02381C7.60476 20 7.24616 19.8509 6.948 19.5528C6.64933 19.2541 6.5 18.8952 6.5 18.4762V10.8571C6.5 10.4381 6.64933 10.0792 6.948 9.78057C7.24616 9.48241 7.60476 9.33333 8.02381 9.33333ZM12.5952 16.1905C13.0143 16.1905 13.3731 16.0414 13.6718 15.7432C13.97 15.4446 14.119 15.0857 14.119 14.6667C14.119 14.2476 13.97 13.8888 13.6718 13.5901C13.3731 13.2919 13.0143 13.1429 12.5952 13.1429C12.1762 13.1429 11.8176 13.2919 11.5194 13.5901C11.2208 13.8888 11.0714 14.2476 11.0714 14.6667C11.0714 15.0857 11.2208 15.4446 11.5194 15.7432C11.8176 16.0414 12.1762 16.1905 12.5952 16.1905Z"})],-1)),zs=V(()=>h("svg",{viewBox:"0 0 25 24",fill:"currentColor"},[h("path",{d:"M7.5 21C6.95 21 6.47933 20.8043 6.088 20.413C5.696 20.021 5.5 19.55 5.5 19V6H4.5V4H9.5V3H15.5V4H20.5V6H19.5V19C19.5 19.55 19.3043 20.021 18.913 20.413C18.521 20.8043 18.05 21 17.5 21H7.5ZM9.5 17H11.5V8H9.5V17ZM13.5 17H15.5V8H13.5V17Z"})],-1)),Bs={class:"list-unstyled d-flex flex-wrap flex-column-reverse"},js={key:0,class:"d-flex justify-content-between align-items-center border-bottom py-2"},Hs={class:"tool"},Ws=["onClick"],Us=V(()=>h("svg",{viewBox:"0 0 25 24",fill:"currentColor"},[h("path",{d:"M9.49991 19.84H15.4999V11.84H20.3399L12.4999 4.00003L4.65991 11.84H9.49991V19.84Z",fill:"#808080"})],-1)),Ks=[Us],Zs=["onClick"],qs=V(()=>h("svg",{viewBox:"0 0 25 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[h("path",{d:"M9.49991 4H15.4999V12H20.3399L12.4999 19.84L4.65991 12H9.49991V4Z",fill:"#808080"})],-1)),Ys=[qs],Xs=["onClick"],Js=V(()=>h("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[h("path",{d:"M12.3333 10C11.8029 10 11.2942 10.2107 10.9191 10.5858C10.544 10.9609 10.3333 11.4696 10.3333 12C10.3333 12.5304 10.544 13.0391 10.9191 13.4142C11.2942 13.7893 11.8029 14 12.3333 14C12.8638 14 13.3725 13.7893 13.7475 13.4142C14.1226 13.0391 14.3333 12.5304 14.3333 12C14.3333 11.4696 14.1226 10.9609 13.7475 10.5858C13.3725 10.2107 12.8638 10 12.3333 10ZM12.3333 15.3333C11.4493 15.3333 10.6014 14.9821 9.97631 14.357C9.35119 13.7319 9 12.8841 9 12C9 11.1159 9.35119 10.2681 9.97631 9.64298C10.6014 9.01786 11.4493 8.66667 12.3333 8.66667C13.2174 8.66667 14.0652 9.01786 14.6904 9.64298C15.3155 10.2681 15.6667 11.1159 15.6667 12C15.6667 12.8841 15.3155 13.7319 14.6904 14.357C14.0652 14.9821 13.2174 15.3333 12.3333 15.3333ZM12.3333 7C9 7 6.15333 9.07333 5 12C6.15333 14.9267 9 17 12.3333 17C15.6667 17 18.5133 14.9267 19.6667 12C18.5133 9.07333 15.6667 7 12.3333 7Z",fill:"#808080"})],-1)),Qs=[Js],ei=["onClick"],ti=V(()=>h("svg",{viewBox:"0 0 25 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[h("path",{d:"M7.5 21C6.95 21 6.47933 20.8043 6.088 20.413C5.696 20.021 5.5 19.55 5.5 19V6H4.5V4H9.5V3H15.5V4H20.5V6H19.5V19C19.5 19.55 19.3043 20.021 18.913 20.413C18.521 20.8043 18.05 21 17.5 21H7.5ZM9.5 17H11.5V8H9.5V17ZM13.5 17H15.5V8H13.5V17Z",fill:"#808080"})],-1)),si=[ti];function ii(l,e,s,t,i,o){return b(),L("div",Fs,[h("div",ks,[Is,h("a",{href:"",class:"closeBtn position-absolute col-auto",onClick:e[0]||(e[0]=x((...n)=>t.props.onClose&&t.props.onClose(...n),["prevent"]))},Ns)]),Gs,h("div",Ds,[h("div",Vs,[h("a",{href:"",class:D(["d-flex align-items-center text-decoration-none me-4",{lockUp:t.props.selectLock,unlock:!t.props.selectLock}]),onClick:e[1]||(e[1]=x(()=>{t.props.onLockLayer()},["prevent"]))},[$s,le(" 鎖定圖層 ")],2),h("a",{href:"",class:D(["d-flex align-items-center text-decoration-none",{disabled:t.props.currentLayers.length<=1}]),onClick:e[2]||(e[2]=x(()=>{t.props.currentLayers.length>0&&t.props.onDeleteLayer({action:"selectLayerMode",value:{layerName:"all"}})},["prevent"]))},[zs,le(" 全部刪除 ")],2)]),h("ul",Bs,[(b(!0),L(X,null,J(t.props.currentLayers,(n,a)=>(b(),L("li",null,[n.id?(b(),L("div",js,[h("div",null,k(n==null?void 0:n.label),1),h("div",Hs,[h("a",{href:"",onClick:x(r=>t.props.onChangeOrderLayer({action:"changeOrder",value:{movement:"up",id:n.id,key:a}}),["prevent"])},Ks,8,Ws),h("a",{href:"",onClick:x(r=>t.props.onChangeOrderLayer({action:"changeOrder",value:{movement:"down",id:n.id,key:a}}),["prevent"])},Ys,8,Zs),h("a",{href:"",class:D({Invisible:!(n!=null&&n.visible)}),onClick:x(()=>{t.props.onChangLayerVisible({action:"changeLayerVisible",value:{key:a}})},["prevent"])},Qs,10,Xs),h("a",{href:"",onClick:x(r=>t.props.onDeleteLayer({action:"selectLayerMode",value:{id:n==null?void 0:n.id}}),["prevent"])},si,8,ei)])])):E("",!0)]))),256))])])])}const ni=W(Es,[["render",ii],["__scopeId","data-v-b4ac34a6"]]);const oi={props:{onClose:{type:Function,default:()=>{}},mapLayers:{type:Array,default:[]},currentLayers:{type:Array,default:[]},tribeIdList:{type:Object,default:()=>{}}},setup(l,{emit:e}){const s=re,t=lt(),i=ee({DropDown:null,TilesListValue:0});function o(u,c){e("onMapControl",{action:u,value:c})}function n(u,c){e("onLayerControl",{action:u,value:c})}function a(u){i.DropDown!==u?i.DropDown=u:i.DropDown=null,console.log(i.DropDown)}function r(u,c){if(c.subNode.single_tiles||!isNaN(c.nestedSubNodeIndex)){let m=u.target.checked||typeof u.target.checked>"u";n("layerMode",{checked:m,nodeIndex:c.nodeIndex,subNodeIndex:c.subNodeIndex,nestedSubNodeIndex:String(c.nestedSubNodeIndex)?c.nestedSubNodeIndex:void 0,id:c.id})}else console.log("還有子選項")}function d(u){let c=u.target.checked||typeof u.target.checked>"u";n("layerMode",{checked:c,type:"tribe"})}return{props:l,state:i,router:t,mapLayers:s,onMapControl:o,onLayerControl:n,openLayerList:a,LayerCheckBoxChange:r,checkTribe:d}}},pe=l=>(Se("data-v-daa10d2c"),l=l(),Me(),l),ri={class:"rounded-4 bg-white"},ai={class:"row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold border-bottom"},li=pe(()=>h("p",{class:"mb-0 fs-5"},"圖層選項",-1)),ci=pe(()=>h("svg",{width:"32",height:"32",viewBox:"0 0 24 24"},[h("path",{fill:"currentColor",d:"M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10zm0-11.414L9.172 7.757L7.757 9.172L10.586 12l-2.829 2.828l1.415 1.415L12 13.414l2.828 2.829l1.415-1.415L13.414 12l2.829-2.828l-1.415-1.415L12 10.586z"})],-1)),di=[ci],ui={class:"py-3 px-4 content"},hi={class:"mb-2 landBoundary"},mi={class:"mb-2"},pi=["onClick"],gi=pe(()=>h("path",{fill:"currentColor",d:"M8 5v14l11-7z"},null,-1)),fi=[gi],yi={class:"ms-3 mb-1"},_i={key:0},Ci=["checked","onChange"],vi={key:1},wi=["checked","onChange"],bi=["onChange"],Li=["value"],Si={key:0},Mi={class:"title d-flex align-items-center fw-bold text-black order-1 mb-1 text-decoration-none"},xi=pe(()=>h("label",{for:"tribeItem"},"選擇部落",-1));function Oi(l,e,s,t,i,o){return b(),L("div",ri,[h("div",ai,[li,h("a",{href:"",class:"closeBtn position-absolute col-auto",onClick:e[0]||(e[0]=x((...n)=>t.props.onClose&&t.props.onClose(...n),["prevent"]))},di)]),h("div",ui,[h("div",hi,[h("div",{onClick:e[1]||(e[1]=n=>t.router.push({path:"/Map_Demo/detail"})),class:"my-3 fw-bold h5 text-primary cursor-pointer"},"前往地圖細節"),(b(!0),L(X,null,J(t.props.mapLayers,(n,a)=>(b(),L("div",mi,[h("div",{class:"title d-flex align-items-center fw-bold text-black order-1 mb-1 text-decoration-none",onClick:r=>t.openLayerList(a)},[h("div",{class:D(n.groupClass)},null,2),h("div",null,k(n.label),1),(b(),L("svg",{viewBox:"0 0 24 24",class:D({openTitle:t.state.DropDown==a})},fi,2))],8,pi),t.state.DropDown==a?(b(!0),L(X,{key:0},J(n.layers,(r,d)=>(b(),L("div",yi,[r.single_tiles?(b(),L("div",_i,[h("input",{type:"checkbox",checked:t.props.currentLayers.some(u=>u.id===r.id),onChange:u=>{t.LayerCheckBoxChange(u,{nodeIndex:a,subNode:r,subNodeIndex:d,nestedSubNodeIndex:"",id:r.id})}},null,40,Ci),le(" "+k(r.title),1)])):(b(),L("div",vi,[h("input",{type:"checkbox",checked:t.props.currentLayers.some(u=>u.id===r.id),onChange:u=>{t.LayerCheckBoxChange(u,{nodeIndex:a,subNode:r,subNodeIndex:d,nestedSubNodeIndex:"",id:r.id})}},null,40,wi),le(" "+k(r.title)+" ",1),We(h("select",{name:"",id:"",class:"ms-3","onUpdate:modelValue":e[2]||(e[2]=u=>t.state.TilesListValue=u),onChange:u=>{t.LayerCheckBoxChange(u,{nodeIndex:a,subNode:r,subNodeIndex:d,nestedSubNodeIndex:t.state.TilesListValue,id:r.id})}},[(b(!0),L(X,null,J(r.tiles_list,(u,c)=>(b(),L("option",{value:c},k(u.title),9,Li))),256))],40,bi),[[Ue,t.state.TilesListValue]])]))]))),256)):E("",!0)]))),256)),t.props.tribeIdList?(b(),L("div",Si,[h("div",Mi,[h("input",{id:"tribeItem",type:"checkbox",onChange:e[3]||(e[3]=n=>{t.checkTribe(n)})},null,32),xi])])):E("",!0)])])])}const Pi=W(oi,[["render",Oi],["__scopeId","data-v-daa10d2c"]]),Ti="/Map_Demo/assets/zoomIn-c80b5dd3.svg",Ri="/Map_Demo/assets/zoomOut-88993246.svg",Ei="/Map_Demo/assets/compass-1c1efd7a.svg",Fi="/Map_Demo/assets/location-b52d62b2.svg",ki="/Map_Demo/assets/zoom-8acdf5b3.svg",Ii={props:{id:{Type:String,default:0},map:{}},setup(l,{emit:e}){function s(t){e("onMapControl",{action:t})}return{onMapControl:s}}},Ai={class:"d-flex flex-nowrap flex-column"},Ni=h("img",{src:Ti,alt:"zoomIn"},null,-1),Gi=[Ni],Di=h("img",{src:Ri,alt:"zoomOut"},null,-1),Vi=[Di],$i=h("img",{src:Ei,alt:"compass"},null,-1),zi=[$i],Bi=h("img",{src:Fi,alt:"location"},null,-1),ji=[Bi],Hi=h("img",{src:ki,alt:"zoom"},null,-1),Wi=[Hi];function Ui(l,e,s,t,i,o){return b(),L("div",Ai,[h("a",{href:"",class:"asideTool-btn order-1 mb-0",onClick:e[0]||(e[0]=x(n=>t.onMapControl("In"),["prevent"]))},Gi),h("a",{href:"",class:"asideTool-btn order-1 mb-2",onClick:e[1]||(e[1]=x(n=>t.onMapControl("Out"),["prevent"]))},Vi),h("a",{href:"",class:"asideTool-btn order-1 mb-2",onClick:e[2]||(e[2]=x(n=>t.onMapControl("toNorth"),["prevent"]))},zi),h("a",{href:"",class:"asideTool-btn order-1 mb-2",onClick:e[3]||(e[3]=x(n=>t.onMapControl("moveTo"),["prevent"]))},ji),h("a",{href:"",class:"asideTool-btn order-1 mb-2",onClick:e[4]||(e[4]=x(n=>t.onMapControl("fullScreen"),["prevent"]))},Wi)])}const Ki=W(Ii,[["render",Ui]]);const Zi={props:{baseMapsOptions:{type:Array,default:[]},onChangeBaseMaps:{type:Function,default:()=>{}}},setup(l,{emit:e}){const s=ee({selectMap:l.baseMapsOptions[0]});function t(i){let o="baseMap",n={checked:!0,layerName:s.selectMap};e("onChangeBaseMaps",{action:o,value:n})}return{state:s,props:l,onChangeBaseMaps:t}}},qi=["value"];function Yi(l,e,s,t,i,o){return b(),L("div",null,[We(h("select",{name:"",id:"","onUpdate:modelValue":e[0]||(e[0]=n=>t.state.selectMap=n),onChange:e[1]||(e[1]=n=>{t.onChangeBaseMaps()})},[(b(!0),L(X,null,J(t.props.baseMapsOptions,(n,a)=>(b(),L("option",{value:n.name},k(n.label),9,qi))),256))],544),[[Ue,t.state.selectMap]])])}const Xi=W(Zi,[["render",Yi],["__scopeId","data-v-485263dd"]]),Ji="/Map_Demo/assets/twoDimensional-a98be995.svg",Qi="/Map_Demo/assets/threeDimensional-53ca5816.svg",en="/Map_Demo/assets/baseLayer-bfe09163.svg",tt="/Map_Demo/assets/singleWindow-a5fb901a.svg",st="/Map_Demo/assets/doubleWindows-dfb5c9e8.svg";const tn={props:{currentLayers:{type:Array,default:[]},mapCount:{type:Number,default:1},dimensionMapStatus:{type:Boolean,default:!1}},setup(l,{emit:e}){const s=ee({toolSwitch:{threeDimensionalBtn:!1,layerConditionBtn:!1,splitWindowBtn:!1},targetNum:1});function t(a,r){Object.keys(s.toolSwitch).forEach(d=>{d===a?s.toolSwitch[a]?s.toolSwitch[a]=!1:s.toolSwitch[a]=!0:s.toolSwitch[d]=!1})}function i(a,r){a==="changeMapCount"&&(s.toolSwitch.splitWindowBtn=!1),e("onLayerControl",{action:a,value:r})}function o(){e("conditionWrap")}function n(a){s.targetNum=a,e("onChangeTarget",a)}return{props:l,state:s,toolSwitch:t,onLayerControl:i,conditionWrap:o,onChangeTarget:n}}},sn={class:"list-unstyled d-flex align-items-center flex-nowrap w-full"},nn={class:"me-4 position-relative"},on={class:"MapFeatureBtn text-white"},rn=h("img",{src:Ji},null,-1),an=[rn],ln=h("img",{src:Qi},null,-1),cn=[ln],dn={class:"me-4 position-relative"},un=h("img",{src:en,alt:""},null,-1),hn=[un],mn={class:"me-4 position-relative"},pn={key:0,src:tt,alt:""},gn={key:1,src:st,alt:""},fn={key:0,class:"list-unstyled position-absolute start-0 top-100 p-0"},yn={class:"mt-2"},_n=h("img",{src:tt,alt:""},null,-1),Cn=[_n],vn={class:"mt-2"},wn=h("img",{src:st,alt:""},null,-1),bn=[wn],Ln={class:"switchControl d-flex position-fixed rounded-pill translate-middle-x p-2",id:"switchControl",style:{"z-index":"99"}};function Sn(l,e,s,t,i,o){return b(),L("div",null,[h("ul",sn,[h("li",nn,[h("div",on,[t.props.dimensionMapStatus?(b(),L("a",{key:0,href:"",onClick:e[0]||(e[0]=x(n=>(t.toolSwitch("threeDimensionalBtn"),t.onLayerControl("changeDimensionMap","3D")),["prevent"]))},an)):(b(),L("a",{key:1,href:"",onClick:e[1]||(e[1]=x(n=>(t.toolSwitch("threeDimensionalBtn"),t.onLayerControl("changeDimensionMap","2D")),["prevent"]))},cn))])]),h("li",dn,[h("a",{href:"",class:"MapFeatureBtn text-white",onClick:e[2]||(e[2]=x(n=>(t.toolSwitch("layerConditionBtn"),t.conditionWrap()),["prevent"]))},hn)]),h("li",mn,[h("a",{href:"",class:"MapFeatureBtn text-white",onClick:e[3]||(e[3]=x(n=>t.toolSwitch("splitWindowBtn"),["prevent"]))},[t.props.mapCount===1?(b(),L("img",pn)):E("",!0),t.props.mapCount===2?(b(),L("img",gn)):E("",!0)]),t.state.toolSwitch.splitWindowBtn?(b(),L("ul",fn,[h("li",yn,[h("a",{href:"",class:"text-white MapFeatureBtn",onClick:e[4]||(e[4]=x(n=>t.onLayerControl("changeMapCount",1),["prevent"]))},Cn)]),h("li",vn,[h("a",{href:"",class:"text-white MapFeatureBtn",onClick:e[5]||(e[5]=x(n=>t.onLayerControl("changeMapCount",2),["prevent"]))},bn)])])):E("",!0)])]),h("div",Ln,[h("div",{class:D(["fs-3 text-white rounded-pill",{active:t.state.targetNum===1}]),onClick:e[6]||(e[6]=()=>{t.onChangeTarget(1)})},"左",2),h("div",{class:D(["fs-3 text-white rounded-pill",{active:t.state.targetNum===2}]),onClick:e[7]||(e[7]=()=>{t.onChangeTarget(2)})},"右",2)])])}const Mn=W(tn,[["render",Sn]]);class xn{constructor(e){this.ol3d=e,this.scene_=e.getCesiumScene(),this.canvas_=this.scene_.canvas,this._boundNotifyRepaintRequired=this.notifyRepaintRequired.bind(this),this.repaintEventNames_=["mousemove","mousedown","mouseup","touchstart","touchend","touchmove","pointerdown","pointerup","pointermove","wheel"],this.enable()}enable(){this.scene_.requestRenderMode=!0,this.scene_.maximumRenderTimeChange=1e3;for(const e of this.repaintEventNames_)this.canvas_.addEventListener(e,this._boundNotifyRepaintRequired,!1);window.addEventListener("resize",this._boundNotifyRepaintRequired,!1),this.ol3d.getOlMap().getLayerGroup().on("change",this._boundNotifyRepaintRequired)}disable(){for(const e of this.repaintEventNames_)this.canvas_.removeEventListener(e,this._boundNotifyRepaintRequired,!1);window.removeEventListener("resize",this._boundNotifyRepaintRequired,!1),this.ol3d.getOlMap().getLayerGroup().un("change",this._boundNotifyRepaintRequired),this.scene_.requestRenderMode=!1}restartRenderLoop(){this.notifyRepaintRequired()}notifyRepaintRequired(){this.scene_.requestRender()}}function he(l){return l*180/Math.PI}function oe(l){return l*Math.PI/180}class Y{constructor(e,s){this.scene_=e,this.cam_=e.camera,this.map_=s,this.view_=null,this.viewListenKey_=null,this.toLonLat_=Y.identityProjection,this.fromLonLat_=Y.identityProjection,this.tilt_=0,this.distance_=0,this.lastCameraViewMatrix_=null,this.viewUpdateInProgress_=!1,this.map_.on("change:view",t=>{this.setView_(this.map_.getView())}),this.setView_(this.map_.getView())}static identityProjection(e,s,t){const i=t||e.length;if(s)for(let o=0;o<i;++o)s[o]=e[o];return e}setView_(e){if(this.view_&&(z(this.viewListenKey_),this.viewListenKey_=null),this.view_=e,e){const s=ve(e.getProjection(),"EPSG:4326"),t=ve("EPSG:4326",e.getProjection());console.assert(s&&t),this.toLonLat_=s,this.fromLonLat_=t,this.viewListenKey_=e.on("propertychange",i=>this.handleViewEvent_(i)),this.readFromView()}else this.toLonLat_=Y.identityProjection,this.fromLonLat_=Y.identityProjection}handleViewEvent_(e){this.viewUpdateInProgress_||this.readFromView()}setHeading(e){this.view_&&this.view_.setRotation(e)}getHeading(){return this.view_?this.view_.getRotation()||0:void 0}setTilt(e){this.tilt_=e,this.updateCamera_()}getTilt(){return this.tilt_}setDistance(e){this.distance_=e,this.updateCamera_(),this.updateView()}getDistance(){return this.distance_}setCenter(e){this.view_&&this.view_.setCenter(e)}getCenter(){if(this.view_)return this.view_.getCenter()}setPosition(e){if(!this.toLonLat_)return;const s=this.toLonLat_(e);console.assert(s);const t=new Cesium.Cartographic(oe(s[0]),oe(s[1]),this.getAltitude());this.cam_.setView({destination:Cesium.Ellipsoid.WGS84.cartographicToCartesian(t)}),this.updateView()}getPosition(){if(!this.fromLonLat_)return;const e=Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position),s=this.fromLonLat_([he(e.longitude),he(e.latitude)]);return console.assert(s),s}setAltitude(e){const s=Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position);s.height=e,this.cam_.position=Cesium.Ellipsoid.WGS84.cartographicToCartesian(s),this.updateView()}getAltitude(){return Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position).height}updateCamera_(){if(!this.view_||!this.toLonLat_)return;const e=this.view_.getCenter();if(!e)return;const s=this.toLonLat_(e);console.assert(s);const t=new Cesium.Cartographic(oe(s[0]),oe(s[1]));if(this.scene_.globe){const n=this.scene_.globe.getHeight(t);t.height=n||0}const i=Cesium.Ellipsoid.WGS84.cartographicToCartesian(t),o={pitch:this.tilt_-Cesium.Math.PI_OVER_TWO,heading:-this.view_.getRotation(),roll:void 0};this.cam_.setView({destination:i,orientation:o}),this.cam_.moveBackward(this.distance_),this.checkCameraChange(!0)}readFromView(){if(!this.view_||!this.toLonLat_)return;const e=this.view_.getCenter();if(e==null)return;const s=this.toLonLat_(e);console.assert(s);const t=this.view_.getResolution();this.distance_=this.calcDistanceForResolution(t||0,oe(s[1])),this.updateCamera_()}updateView(){if(!this.view_||!this.fromLonLat_)return;this.viewUpdateInProgress_=!0;const e=Cesium.Ellipsoid.WGS84,s=this.scene_,t=P.pickCenterPoint(s);let i=t;if(!i){const n=s.globe,a=this.cam_.positionCartographic.clone(),r=n.getHeight(a);a.height=r||0,i=Cesium.Ellipsoid.WGS84.cartographicToCartesian(a)}this.distance_=Cesium.Cartesian3.distance(i,this.cam_.position);const o=e.cartesianToCartographic(i);if(this.view_.setCenter(this.fromLonLat_([he(o.longitude),he(o.latitude)])),this.view_.setResolution(this.calcResolutionForDistance(this.distance_,o?o.latitude:0)),t){const n=this.cam_.position,a=new Cesium.Cartesian3;e.geocentricSurfaceNormal(t,a);const r=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(n,t,r),Cesium.Cartesian3.normalize(r,r);const d=this.cam_.up,u=this.cam_.right,c=new Cesium.Cartesian3(-t.y,t.x,0),m=Cesium.Cartesian3.angleBetween(u,c),p=Cesium.Cartesian3.cross(t,d,new Cesium.Cartesian3).z;this.view_.setRotation(p<0?m:-m);const y=Math.acos(Cesium.Cartesian3.dot(a,r));this.tilt_=isNaN(y)?0:y}else this.view_.setRotation(this.cam_.heading),this.tilt_=-this.cam_.pitch+Math.PI/2;this.viewUpdateInProgress_=!1}checkCameraChange(e){const s=this.lastCameraViewMatrix_,t=this.cam_.viewMatrix;(!s||!Cesium.Matrix4.equalsEpsilon(s,t,1e-5))&&(this.lastCameraViewMatrix_=t.clone(),e!==!0&&this.updateView())}calcDistanceForResolution(e,s){return Et(e,s,this.scene_,this.view_.getProjection())}calcResolutionForDistance(e,s){return Ft(e,s,this.scene_,this.view_.getProjection())}}class it{constructor(e,s){this.map=e,this.view=e.getView(),this.scene=s,this.olLayers=e.getLayerGroup().getLayers(),this.mapLayerGroup=e.getLayerGroup(),this.layerMap={},this.olLayerListenKeys={},this.olGroupListenKeys_={}}synchronize(){this.destroyAll(),this.addLayers_(this.mapLayerGroup)}orderLayers(){}addLayers_(e){const s=[{layer:e,parents:[]}];for(;s.length>0;){const t=s.splice(0,1)[0],i=t.layer,o=O(i).toString();this.olLayerListenKeys[o]=[],console.assert(!this.layerMap[o]);let n=null;if(i instanceof we)this.listenForGroupChanges_(i),i!==this.mapLayerGroup&&(n=this.createSingleLayerCounterparts(t)),n||i.getLayers().forEach(a=>{if(a){const r={layer:a,parents:i===this.mapLayerGroup?[]:[t.layer].concat(t.parents)};s.push(r)}});else if(n=this.createSingleLayerCounterparts(t),!n){const a=o,r=t,d=u=>{const c=this.createSingleLayerCounterparts(r);c&&(r.layer.un("change",d),this.addCesiumObjects_(c,a,r.layer),this.orderLayers())};this.olLayerListenKeys[o].push(q(r.layer,"change",d))}n&&this.addCesiumObjects_(n,o,i)}this.orderLayers()}addCesiumObjects_(e,s,t){this.layerMap[s]=e,this.olLayerListenKeys[s].push(q(t,"change:zIndex",()=>this.orderLayers())),e.forEach(i=>{this.addCesiumObject(i)})}removeAndDestroySingleLayer_(e){const s=O(e).toString(),t=this.layerMap[s];return t&&(t.forEach(i=>{this.removeSingleCesiumObject(i,!1),this.destroyCesiumObject(i)}),this.olLayerListenKeys[s].forEach(z),delete this.olLayerListenKeys[s]),delete this.layerMap[s],!!t}unlistenSingleGroup_(e){if(e===this.mapLayerGroup)return;const s=O(e).toString();this.olGroupListenKeys_[s].forEach(i=>{z(i)}),delete this.olGroupListenKeys_[s],delete this.layerMap[s]}removeLayer_(e){if(e){const s=[e];for(;s.length>0;){const t=s.splice(0,1)[0],i=this.removeAndDestroySingleLayer_(t);t instanceof we&&(this.unlistenSingleGroup_(t),i||t.getLayers().forEach(o=>{s.push(o)}))}}}listenForGroupChanges_(e){const s=O(e).toString();console.assert(this.olGroupListenKeys_[s]===void 0);const t=[];this.olGroupListenKeys_[s]=t;let i=[];const o=function(){const n=e.getLayers();n&&(i=[n.on("add",a=>{this.addLayers_(a.element)}),n.on("remove",a=>{this.removeLayer_(a.element)})],t.push(...i))}.bind(this);o(),t.push(e.on("change:layers",n=>{i.forEach(a=>{const r=t.indexOf(a);r>=0&&t.splice(r,1),z(a)}),o()}))}destroyAll(){this.removeAllCesiumObjects(!0);let e;for(e in this.olGroupListenKeys_)this.olGroupListenKeys_[e].forEach(z);for(e in this.olLayerListenKeys)this.olLayerListenKeys[e].forEach(z);this.olGroupListenKeys_={},this.olLayerListenKeys={},this.layerMap={}}addCesiumObject(e){}destroyCesiumObject(e){}removeSingleCesiumObject(e,s){}removeAllCesiumObjects(e){}createSingleLayerCounterparts(e){}}class On extends it{constructor(e,s){super(e,s),this.cesiumLayers_=s.imageryLayers,this.ourLayers_=new Cesium.ImageryLayerCollection}addCesiumObject(e){this.cesiumLayers_.add(e),this.ourLayers_.add(e)}destroyCesiumObject(e){e.destroy()}removeSingleCesiumObject(e,s){this.cesiumLayers_.remove(e,s),this.ourLayers_.remove(e,!1)}removeAllCesiumObjects(e){for(let s=0;s<this.ourLayers_.length;++s)this.cesiumLayers_.remove(this.ourLayers_.get(s),e);this.ourLayers_.removeAll(!1)}convertLayerToCesiumImageries(e,s){const t=P.tileLayerToImageryLayer(this.map,e,s);return t?[t]:null}createSingleLayerCounterparts(e){const s=e.layer,t=O(s).toString(),i=this.view.getProjection();console.assert(i);const o=this.convertLayerToCesiumImageries(s,i);if(o){const n=[];if([e.layer].concat(e.parents).forEach(a=>{n.push(a.on(["change:opacity","change:visible"],()=>{console.assert(o);for(let r=0;r<o.length;++r)P.updateCesiumLayerProperties(e,o[r])}))}),s.getStyleFunction){let a=s.getStyleFunction();n.push(s.on("change",()=>{const r=s.getStyleFunction();if(a!==r){a=r;for(let d=0;d<o.length;++d){const u=o[d];u._imageryCache&&u.imageryProvider.cache_&&(u._imageryCache={},u.imageryProvider.cache_={},u.imageryProvider.styleFunction_=r)}this.scene.requestRender()}}))}for(let a=0;a<o.length;++a)P.updateCesiumLayerProperties(e,o[a]);n.push(s.on("change:extent",a=>{for(let r=0;r<o.length;++r)this.cesiumLayers_.remove(o[r],!0),this.ourLayers_.remove(o[r],!1);delete this.layerMap[O(s)],this.synchronize()})),n.push(s.on("change",a=>{for(let r=0;r<o.length;++r){const d=this.cesiumLayers_.indexOf(o[r]);d>=0&&(this.cesiumLayers_.remove(o[r],!1),this.cesiumLayers_.add(o[r],d))}})),this.olLayerListenKeys[t].push(...n)}return Array.isArray(o)?o:null}orderLayers(){const e=[],s={},t=[this.mapLayerGroup];for(;t.length>0;){const i=t.splice(0,1)[0];if(e.push(i),s[O(i)]=i.getZIndex()||0,i instanceof we){const o=i.getLayers();o&&t.unshift(...o.getArray())}}kt(e,(i,o)=>s[O(i)]-s[O(o)]),e.forEach(i=>{const o=O(i).toString(),n=this.layerMap[o];n&&n.forEach(a=>{this.raiseToTop(a)})})}raiseToTop(e){this.cesiumLayers_.raiseToTop(e)}}class Pn{constructor(e,s){const t=new Cesium.BillboardCollection({scene:s}),i=new Cesium.PrimitiveCollection;this.olListenKeys=[],this.rootCollection_=new Cesium.PrimitiveCollection,this.context={projection:e,billboards:t,featureToCesiumMap:{},primitives:i},this.rootCollection_.add(t),this.rootCollection_.add(i)}destroy(){this.olListenKeys.forEach(z),this.olListenKeys.length=0}getRootPrimitive(){return this.rootCollection_}}class Tn{constructor(e){this.scene=e,this.boundOnRemoveOrClearFeatureListener_=this.onRemoveOrClearFeature_.bind(this),this.defaultBillboardEyeOffset_=new Cesium.Cartesian3(0,0,10)}onRemoveOrClearFeature_(e){const s=e.target;console.assert(s instanceof A);const t=H.obj(s).olcs_cancellers;if(t){const i=e.feature;if(i){const o=O(i),n=t[o];n&&(n(),delete t[o])}else{for(const o in t)t.hasOwnProperty(o)&&t[o]();H.obj(s).olcs_cancellers={}}}}setReferenceForPicking(e,s,t){t.olLayer=e,t.olFeature=s}createColoredPrimitive(e,s,t,i,o,n){const a=function(m,f){const p=new Cesium.GeometryInstance({geometry:m});return f&&!(f instanceof Cesium.ImageMaterialProperty)&&(p.attributes={color:Cesium.ColorGeometryInstanceAttribute.fromColor(f)}),p},r={flat:!0,renderState:{depthTest:{enabled:!0}}};n!==void 0&&(r.renderState||(r.renderState={}),r.renderState.lineWidth=n);const d=a(i,o),u=this.getHeightReference(e,s,t);let c;if(u===Cesium.HeightReference.CLAMP_TO_GROUND){const m=d.geometry.constructor;if(m&&!m.createShadowVolume)return null;c=new Cesium.GroundPrimitive({geometryInstances:d})}else c=new Cesium.Primitive({geometryInstances:d});if(o instanceof Cesium.ImageMaterialProperty){const m=o.image.getValue().toDataURL();c.appearance=new Cesium.MaterialAppearance({flat:!0,renderState:{depthTest:{enabled:!0}},material:new Cesium.Material({fabric:{type:"Image",uniforms:{image:m}}})})}else c.appearance=new Cesium.PerInstanceColorAppearance(r);return this.setReferenceForPicking(e,s,c),c}extractColorFromOlStyle(e,s){const t=e.getFill()?e.getFill().getColor():null,i=e.getStroke()?e.getStroke().getColor():null;let o="black";return i&&s?o=i:t&&(o=t),P.convertColorToCesium(o)}extractLineWidthFromOlStyle(e){const s=e.getStroke()?e.getStroke().getWidth():void 0;return s!==void 0?s:1}wrapFillAndOutlineGeometries(e,s,t,i,o,n){const a=this.extractColorFromOlStyle(n,!1),r=this.extractColorFromOlStyle(n,!0),d=new Cesium.PrimitiveCollection;if(n.getFill()){const u=this.createColoredPrimitive(e,s,t,i,a);console.assert(!!u),d.add(u)}if(n.getStroke()&&o){const u=this.extractLineWidthFromOlStyle(n),c=this.createColoredPrimitive(e,s,t,o,r,u);c&&d.add(c)}return d}addTextStyle(e,s,t,i,o){let n;if(o instanceof Cesium.PrimitiveCollection?n=o:(n=new Cesium.PrimitiveCollection,n.add(o)),!i.getText())return n;const a=i.getText(),r=this.olGeometry4326TextPartToCesium(e,s,t,a);return r&&n.add(r),n}csAddBillboard(e,s,t,i,o,n){s.eyeOffset||(s.eyeOffset=this.defaultBillboardEyeOffset_);const a=e.add(s);return this.setReferenceForPicking(t,i,a),a}olCircleGeometryToCesium(e,s,t,i,o){t=P.olGeometryCloneTo4326(t,i),console.assert(t.getType()=="Circle");let n=t.getCenter();const a=n.length==3?n[2]:0;let r=n.slice();r[0]+=t.getRadius(),n=P.ol4326CoordinateToCesiumCartesian(n),r=P.ol4326CoordinateToCesiumCartesian(r);const d=Cesium.Cartesian3.distance(n,r),u=new Cesium.CircleGeometry({center:n,radius:d,height:a});let c,m;if(this.getHeightReference(e,s,t)===Cesium.HeightReference.CLAMP_TO_GROUND){const p=this.extractLineWidthFromOlStyle(o);if(p){const y=It(t.getCenter(),d),w=P.ol4326CoordinateArrayToCsCartesians(y.getLinearRing(0).getCoordinates());if(_e(this.scene))c=new Cesium.GroundPolylinePrimitive({geometryInstances:new Cesium.GeometryInstance({geometry:new Cesium.GroundPolylineGeometry({positions:w,width:p})}),appearance:new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(s,o,!0)}),classificationType:Cesium.ClassificationType.TERRAIN}),c.readyPromise.then(()=>{this.setReferenceForPicking(e,s,c._primitive)});else{const _=this.extractColorFromOlStyle(o,!0);c=this.createStackedGroundCorridors(e,s,p,_,w)}}}else m=new Cesium.CircleOutlineGeometry({center:n,radius:d,extrudedHeight:a,height:a});const f=this.wrapFillAndOutlineGeometries(e,s,t,u,m,o);return c&&f.add(c),this.addTextStyle(e,s,t,o,f)}createStackedGroundCorridors(e,s,t,i,o){Array.isArray(o[0])||(o=[o]),t=Math.max(3,t);const n=[];let a=0;for(const r of[1e3,4e3,16e3,64e3,254e3,1e6,1e7]){t*=2.14;const d={width:t,vertexFormat:Cesium.VertexFormat.POSITION_ONLY};for(const u of o)d.positions=u,n.push(new Cesium.GeometryInstance({geometry:new Cesium.CorridorGeometry(d),attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(i),distanceDisplayCondition:new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(a,r-1)}}));a=r}return new Cesium.GroundPrimitive({geometryInstances:n})}olLineStringGeometryToCesium(e,s,t,i,o){t=P.olGeometryCloneTo4326(t,i),console.assert(t.getType()=="LineString");const n=P.ol4326CoordinateArrayToCsCartesians(t.getCoordinates()),a=this.extractLineWidthFromOlStyle(o);let r;const d=this.getHeightReference(e,s,t);if(d===Cesium.HeightReference.CLAMP_TO_GROUND&&!_e(this.scene)){const u=this.extractColorFromOlStyle(o,!0);r=this.createStackedGroundCorridors(e,s,a,u,n)}else{const u=new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(s,o,!0)}),c={positions:n,width:a},m={appearance:u};if(d===Cesium.HeightReference.CLAMP_TO_GROUND){const f=new Cesium.GroundPolylineGeometry(c);m.geometryInstances=new Cesium.GeometryInstance({geometry:f}),r=new Cesium.GroundPolylinePrimitive(m),r.readyPromise.then(()=>{this.setReferenceForPicking(e,s,r._primitive)})}else{c.vertexFormat=u.vertexFormat;const f=new Cesium.PolylineGeometry(c);m.geometryInstances=new Cesium.GeometryInstance({geometry:f}),r=new Cesium.Primitive(m)}}return this.setReferenceForPicking(e,s,r),this.addTextStyle(e,s,t,o,r)}olPolygonGeometryToCesium(e,s,t,i,o){t=P.olGeometryCloneTo4326(t,i),console.assert(t.getType()=="Polygon");const n=this.getHeightReference(e,s,t);let a,r,d;if(t.getCoordinates()[0].length==5&&s.getGeometry().get("olcs.polygon_kind")==="rectangle"){const c=t.getCoordinates()[0],m=At(c),f=Cesium.Rectangle.fromDegrees(m[0],m[1],m[2],m[3]);let p=0;if(c[0].length==3)for(let y=0;y<c.length;y++)p=Math.max(p,c[y][2]);a=new Cesium.RectangleGeometry({ellipsoid:Cesium.Ellipsoid.WGS84,rectangle:f,height:p}),r=new Cesium.RectangleOutlineGeometry({ellipsoid:Cesium.Ellipsoid.WGS84,rectangle:f,height:p})}else{const c=t.getLinearRings(),m={},f=m;console.assert(c.length>0);for(let p=0;p<c.length;++p){const y=c[p].getCoordinates(),w=P.ol4326CoordinateArrayToCsCartesians(y);console.assert(w&&w.length>0),p==0?m.positions=w:(m.holes||(m.holes=[]),m.holes.push({positions:w}))}if(a=new Cesium.PolygonGeometry({polygonHierarchy:f,perPositionHeight:!0}),n===Cesium.HeightReference.CLAMP_TO_GROUND){const p=this.extractLineWidthFromOlStyle(o);if(p>0){const y=[m.positions];if(m.holes)for(let w=0;w<m.holes.length;++w)y.push(m.holes[w].positions);if(_e(this.scene)){const w=new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(s,o,!0)}),_=[];for(const v of y){const C=new Cesium.GroundPolylineGeometry({positions:v,width:p});_.push(new Cesium.GeometryInstance({geometry:C}))}const g={appearance:w,geometryInstances:_};d=new Cesium.GroundPolylinePrimitive(g),d.readyPromise.then(()=>{this.setReferenceForPicking(e,s,d._primitive)})}else{const w=this.extractColorFromOlStyle(o,!0);d=this.createStackedGroundCorridors(e,s,p,w,y)}}}else r=new Cesium.PolygonOutlineGeometry({polygonHierarchy:m,perPositionHeight:!0})}const u=this.wrapFillAndOutlineGeometries(e,s,t,a,r,o);return d&&u.add(d),this.addTextStyle(e,s,t,o,u)}getHeightReference(e,s,t){let i=t.get("altitudeMode");i===void 0&&(i=s.get("altitudeMode")),i===void 0&&(i=e.get("altitudeMode"));let o=Cesium.HeightReference.NONE;return i==="clampToGround"?o=Cesium.HeightReference.CLAMP_TO_GROUND:i==="relativeToGround"&&(o=Cesium.HeightReference.RELATIVE_TO_GROUND),o}createBillboardFromImage(e,s,t,i,o,n,a,r){n instanceof be&&n.load();const d=n.getImage(1),u=function(m){return m.src!=""&&m.naturalHeight!=0&&m.naturalWidth!=0&&m.complete},c=function(){if(!d||!(d instanceof HTMLCanvasElement||d instanceof Image||d instanceof HTMLImageElement))return;const m=t.getCoordinates(),f=P.ol4326CoordinateToCesiumCartesian(m);let p;const y=n.getOpacity();y!==void 0&&(p=new Cesium.Color(1,1,1,y));const w=n.getScale(),_=this.getHeightReference(e,s,t),g={image:d,color:p,scale:w,heightReference:_,position:f};if(Object.assign(g,s.get("cesiumOptions")),n instanceof be){const C=n.getAnchor();C&&(g.pixelOffset=new Cesium.Cartesian2((d.width/2-C[0])*w,(d.height/2-C[1])*w))}const v=this.csAddBillboard(a,g,e,s,t,o);r&&r(v)}.bind(this);if(d instanceof Image&&!u(d)){let m=!1;const f=e.getSource(),p=function(){m=!0};f.on(["removefeature","clear"],this.boundOnRemoveOrClearFeatureListener_);let y=H.obj(f).olcs_cancellers;y||(y=H.obj(f).olcs_cancellers={});const w=O(s);y[w]&&y[w](),y[w]=p;const _=function(){d.removeEventListener("load",_),!a.isDestroyed()&&!m&&c()};d.addEventListener("load",_)}else c()}olPointGeometryToCesium(e,s,t,i,o,n,a){console.assert(t.getType()=="Point"),t=P.olGeometryCloneTo4326(t,i);let r=null;const d=o.getImage();if(d){const u=t.get("olcs_model")||s.get("olcs_model");if(u){const c=u(),m=Object.assign({},{scene:this.scene},c.cesiumOptions),f=Cesium.Model.fromGltf(m);r=new Cesium.PrimitiveCollection,r.add(f),c.debugModelMatrix&&r.add(new Cesium.DebugModelMatrixPrimitive({modelMatrix:c.debugModelMatrix}))}else this.createBillboardFromImage(e,s,t,i,o,d,n,a)}return o.getText()?this.addTextStyle(e,s,t,o,r||new Cesium.Primitive):r}olMultiGeometryToCesium(e,s,t,i,o,n,a){const r=function(u,c){const m=new Cesium.PrimitiveCollection;return u.forEach(f=>{m.add(c(e,s,f,i,o))}),m};let d;switch(t.getType()){case"MultiPoint":if(t=t,d=t.getPoints(),o.getText()){const u=new Cesium.PrimitiveCollection;return d.forEach(c=>{console.assert(c);const m=this.olPointGeometryToCesium(e,s,c,i,o,n,a);m&&u.add(m)}),u}else return d.forEach(u=>{console.assert(u),this.olPointGeometryToCesium(e,s,u,i,o,n,a)}),null;case"MultiLineString":return t=t,d=t.getLineStrings(),r(d,this.olLineStringGeometryToCesium.bind(this));case"MultiPolygon":return t=t,d=t.getPolygons(),r(d,this.olPolygonGeometryToCesium.bind(this));default:console.assert(!1,`Unhandled multi geometry type${t.getType()}`)}}olGeometry4326TextPartToCesium(e,s,t,i){const o=i.getText();if(!o)return null;const n=new Cesium.LabelCollection({scene:this.scene}),a=Ze(t.getExtent());if(t instanceof Nt){const p=t.getFirstCoordinate();a[2]=p.length==3?p[2]:0}const r={};r.position=P.ol4326CoordinateToCesiumCartesian(a),r.text=o,r.heightReference=this.getHeightReference(e,s,t);const d=i.getOffsetX(),u=i.getOffsetY();if(d!=0&&u!=0){const p=new Cesium.Cartesian2(d,u);r.pixelOffset=p}r.font=i.getFont()||"10px sans-serif";let c;i.getFill()&&(r.fillColor=this.extractColorFromOlStyle(i,!1),c=Cesium.LabelStyle.FILL),i.getStroke()&&(r.outlineWidth=this.extractLineWidthFromOlStyle(i),r.outlineColor=this.extractColorFromOlStyle(i,!0),c=Cesium.LabelStyle.OUTLINE),i.getFill()&&i.getStroke()&&(c=Cesium.LabelStyle.FILL_AND_OUTLINE),r.style=c;let m;switch(i.getTextAlign()){case"left":m=Cesium.HorizontalOrigin.LEFT;break;case"right":m=Cesium.HorizontalOrigin.RIGHT;break;case"center":default:m=Cesium.HorizontalOrigin.CENTER}if(r.horizontalOrigin=m,i.getTextBaseline()){let p;switch(i.getTextBaseline()){case"top":p=Cesium.VerticalOrigin.TOP;break;case"middle":p=Cesium.VerticalOrigin.CENTER;break;case"bottom":p=Cesium.VerticalOrigin.BOTTOM;break;case"alphabetic":p=Cesium.VerticalOrigin.TOP;break;case"hanging":p=Cesium.VerticalOrigin.BOTTOM;break;default:console.assert(!1,`unhandled baseline ${i.getTextBaseline()}`)}r.verticalOrigin=p}const f=n.add(r);return this.setReferenceForPicking(e,s,f),n}olStyleToCesium(e,s,t){const i=s.getFill(),o=s.getStroke();if(t&&!o||!t&&!i)return null;let n=t?o.getColor():i.getColor();return n=P.convertColorToCesium(n),t&&o.getLineDash()?Cesium.Material.fromType("Stripe",{horizontal:!1,repeat:500,evenColor:n,oddColor:new Cesium.Color(0,0,0,0)}):Cesium.Material.fromType("Color",{color:n})}computePlainStyle(e,s,t,i){const o=s.getStyleFunction();let n=null;return o&&(n=o(s,i)),!n&&t&&(n=t(s,i)),n?Array.isArray(n)?n:[n]:null}getGeometryFromFeature(e,s,t){if(t)return t;const i=e.get("olcs.3d_geometry");if(i&&i instanceof De)return i;if(s){const o=s.getGeometryFunction()(e);if(o instanceof De)return o}return e.getGeometry()}olFeatureToCesium(e,s,t,i,o){let n=this.getGeometryFromFeature(s,t,o);if(!n)return null;const a=i.projection,r=function(d){const u=i.featureToCesiumMap[O(s)];u instanceof Array?u.push(d):i.featureToCesiumMap[O(s)]=[d]};switch(n.getType()){case"GeometryCollection":const d=new Cesium.PrimitiveCollection;return n.getGeometries().forEach(p=>{if(p){const y=this.olFeatureToCesium(e,s,t,i,p);y&&d.add(y)}}),d;case"Point":n=n;const c=i.billboards,m=this.olPointGeometryToCesium(e,s,n,a,t,c,r);return m||null;case"Circle":return n=n,this.olCircleGeometryToCesium(e,s,n,a,t);case"LineString":return n=n,this.olLineStringGeometryToCesium(e,s,n,a,t);case"Polygon":return n=n,this.olPolygonGeometryToCesium(e,s,n,a,t);case"MultiPoint":case"MultiLineString":case"MultiPolygon":const f=this.olMultiGeometryToCesium(e,s,n,a,t,i.billboards,r);return f||null;case"LinearRing":throw new Error("LinearRing should only be part of polygon.");default:throw new Error(`Ol geom type not handled : ${n.getType()}`)}}olVectorLayerToCesium(e,s,t){const i=s.getProjection(),o=s.getResolution();if(o===void 0||!i)throw console.assert(!1,"View not ready"),new Error("View not ready");let n=e.getSource();n instanceof et&&(n=n.getSource()),console.assert(n instanceof A);const a=n.getFeatures(),r=new Pn(i,this.scene),d=r.context;for(let u=0;u<a.length;++u){const c=a[u];if(!c)continue;const m=e.getStyleFunction(),f=this.computePlainStyle(e,c,m,o);if(!f||!f.length)continue;let p=null;for(let y=0;y<f.length;y++){const w=this.olFeatureToCesium(e,c,f[y],d);if(w){if(!p)p=w;else if(w){let _=0,g;for(;g=w.get(_);)p.add(g),_++}}}p&&(t[O(c)]=p,r.getRootPrimitive().add(p))}return r}convert(e,s,t,i){const o=s.getProjection(),n=s.getResolution();if(n==null||!o)return null;const a=e.getStyleFunction(),r=this.computePlainStyle(e,t,a,n);if(!r||!r.length)return null;i.projection=o;let d=null;for(let u=0;u<r.length;u++){const c=this.olFeatureToCesium(e,t,r[u],i);if(!d)d=c;else if(c){let m=0,f;for(;f=c.get(m);)d.add(f),m++}}return d}}class Rn extends it{constructor(e,s,t){super(e,s),this.converter=t||new Tn(s),this.csAllPrimitives_=new Cesium.PrimitiveCollection,s.primitives.add(this.csAllPrimitives_),this.csAllPrimitives_.destroyPrimitives=!1}addCesiumObject(e){console.assert(e),e.getRootPrimitive().counterpart=e,this.csAllPrimitives_.add(e.getRootPrimitive())}destroyCesiumObject(e){e.getRootPrimitive().destroy()}removeSingleCesiumObject(e,s){e.destroy(),this.csAllPrimitives_.destroyPrimitives=s,this.csAllPrimitives_.remove(e.getRootPrimitive()),this.csAllPrimitives_.destroyPrimitives=!1}removeAllCesiumObjects(e){if(this.csAllPrimitives_.destroyPrimitives=e,e)for(let s=0;s<this.csAllPrimitives_.length;++s)this.csAllPrimitives_.get(s).counterpart.destroy();this.csAllPrimitives_.removeAll(),this.csAllPrimitives_.destroyPrimitives=!1}updateLayerVisibility(e,s){let t=!0;[e.layer].concat(e.parents).forEach(i=>{const o=i.getVisible();o!==void 0?t&=o:t=!1}),s.show=t}createSingleLayerCounterparts(e){const s=e.layer;if(!(s instanceof G)||s instanceof Gt)return null;console.assert(s instanceof Dt);let t=s.getSource();if(t instanceof et&&(t=t.getSource()),!t)return null;console.assert(t instanceof A),console.assert(this.view);const i=this.view,o={},n=this.converter.olVectorLayerToCesium(s,i,o),a=n.getRootPrimitive(),r=n.olListenKeys;[e.layer].concat(e.parents).forEach(c=>{r.push(q(c,"change:visible",()=>{this.updateLayerVisibility(e,a)}))}),this.updateLayerVisibility(e,a);const d=function(c){console.assert(s instanceof G||s instanceof Vt);const m=n.context,f=this.converter.convert(s,i,c,m);f&&(o[O(c)]=f,a.add(f))}.bind(this),u=function(c){const m=O(c),f=n.context,p=f.featureToCesiumMap[m];p&&(delete f.featureToCesiumMap[m],p.forEach(w=>{w instanceof Cesium.Billboard&&f.billboards.remove(w)}));const y=o[m];delete o[m],y&&a.remove(y)}.bind(this);return r.push(q(t,"addfeature",c=>{console.assert(c.feature),d(c.feature)})),r.push(q(t,"removefeature",c=>{console.assert(c.feature),u(c.feature)})),r.push(q(t,"changefeature",c=>{const m=c.feature;console.assert(m),u(m),d(m)})),n?[n]:null}}class En extends Qe{constructor(e){const s=e.parent;super(s.getOptions()),this.scenePostRenderListenerRemover_=null,this.scene_=e.scene,this.synchronizer_=e.synchronizer,this.parent_=s,this.positionWGS84_=void 0,this.observer_=new MutationObserver(this.handleElementChanged.bind(this)),this.attributeObserver_=[],this.listenerKeys_=[];const t=i=>this.setPropertyFromEvent_(i);this.listenerKeys_.push(this.parent_.on("change:position",t)),this.listenerKeys_.push(this.parent_.on("change:element",t)),this.listenerKeys_.push(this.parent_.on("change:offset",t)),this.listenerKeys_.push(this.parent_.on("change:position",t)),this.listenerKeys_.push(this.parent_.on("change:positioning",t)),this.setProperties(this.parent_.getProperties()),this.handleMapChanged(),this.handleElementChanged()}observeTarget_(e){if(this.observer_){this.observer_.disconnect(),this.observer_.observe(e,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),this.attributeObserver_.forEach(s=>{s.disconnect()}),this.attributeObserver_.length=0;for(let s=0;s<e.childNodes.length;s++){const t=e.childNodes[s];if(t.nodeType===1){const i=new MutationObserver(this.handleElementChanged.bind(this));i.observe(t,{attributes:!0,subtree:!0}),this.attributeObserver_.push(i)}}}}setPropertyFromEvent_(e){e.target&&e.key&&this.set(e.key,e.target.get(e.key))}getScene(){return this.scene_}handleMapChanged(){this.scenePostRenderListenerRemover_&&(this.scenePostRenderListenerRemover_(),$t(this.element)),this.scenePostRenderListenerRemover_=null;const e=this.getScene();if(e){this.scenePostRenderListenerRemover_=e.postRender.addEventListener(this.updatePixelPosition.bind(this)),this.updatePixelPosition();const s=this.stopEvent?this.synchronizer_.getOverlayContainerStopEvent():this.synchronizer_.getOverlayContainer();this.insertFirst?s.insertBefore(this.element,s.childNodes[0]||null):s.appendChild(this.element)}}handlePositionChanged(){const e=this.getPosition();if(e){const s=this.parent_.getMap().getView().getProjection();this.positionWGS84_=zt(e,s,"EPSG:4326")}else this.positionWGS84_=void 0;this.updatePixelPosition()}handleElementChanged(){function e(t,i){const o=t.cloneNode();t.nodeName==="CANVAS"&&o.getContext("2d").drawImage(t,0,0),i&&i.appendChild(o),t.nodeType!=Node.TEXT_NODE&&o.addEventListener("click",a=>{t.dispatchEvent(new MouseEvent("click",a)),a.stopPropagation()});const n=t.childNodes;for(let a=0;a<n.length;a++)n[a]&&e(n[a],o);return o}Bt(this.element);const s=this.getElement();if(s&&s.parentNode&&s.parentNode.childNodes)for(const t of s.parentNode.childNodes){const i=e(t,null);this.element.appendChild(i)}s.parentNode&&this.observeTarget_(s.parentNode)}updatePixelPosition(){const e=this.positionWGS84_;if(!this.scene_||!e){this.setVisible(!1);return}let s=0;if(e.length===2){const c=this.scene_.globe.getHeight(Cesium.Cartographic.fromDegrees(e[0],e[1]));c&&this.scene_.globe.tilesLoaded&&(e[2]=c),c&&(s=c)}else s=e[2];const t=Cesium.Cartesian3.fromDegrees(e[0],e[1],s),i=this.scene_.camera,o=new Cesium.BoundingSphere(new Cesium.Cartesian3,6356752);if(!new Cesium.Occluder(o,i.position).isPointVisible(t)){this.setVisible(!1);return}if(i.frustum.computeCullingVolume(i.position,i.direction,i.up).computeVisibility(new Cesium.BoundingSphere(t))!==1){this.setVisible(!1);return}this.setVisible(!0);const r=this.scene_.cartesianToCanvasCoordinates(t),d=[r.x,r.y],u=[this.scene_.canvas.width,this.scene_.canvas.height];this.updateRenderedPosition(d,u)}destroy(){this.scenePostRenderListenerRemover_&&this.scenePostRenderListenerRemover_(),this.observer_&&this.observer_.disconnect(),z(this.listenerKeys_),this.listenerKeys_.splice(0),this.element.removeNode?this.element.removeNode(!0):this.element.remove(),this.element=null}}class Fn{constructor(e,s){this.map=e,this.overlays_=this.map.getOverlays(),this.scene=s,this.overlayContainerStopEvent_=document.createElement("DIV"),this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",["click","dblclick","mousedown","touchstart","MSPointerDown","pointerdown","mousewheel","wheel"].forEach(i=>{this.overlayContainerStopEvent_.addEventListener(i,o=>o.stopPropagation())}),this.scene.canvas.parentElement.appendChild(this.overlayContainerStopEvent_),this.overlayContainer_=document.createElement("DIV"),this.overlayContainer_.className="ol-overlaycontainer",this.scene.canvas.parentElement.appendChild(this.overlayContainer_),this.overlayMap_={}}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOverlayContainer(){return this.overlayContainer_}synchronize(){this.destroyAll(),this.addOverlays(),this.overlays_.on("add",this.addOverlayFromEvent_.bind(this)),this.overlays_.on("remove",this.removeOverlayFromEvent_.bind(this))}addOverlayFromEvent_(e){const s=e.element;this.addOverlay(s)}addOverlays(){this.overlays_.forEach(e=>{this.addOverlay(e)})}addOverlay(e){if(!e)return;const s=new En({scene:this.scene,synchronizer:this,parent:e}),t=O(e).toString();this.overlayMap_[t]=s}removeOverlayFromEvent_(e){const s=e.element;this.removeOverlay(s)}removeOverlay(e){const s=O(e).toString(),t=this.overlayMap_[s];t&&(t.destroy(),delete this.overlayMap_[s])}destroyAll(){Object.keys(this.overlayMap_).forEach(e=>{this.overlayMap_[e].destroy(),delete this.overlayMap_[e]})}}class ae{constructor(e){this.autoRenderLoop_=null,this.map_=e.map,this.time_=e.time||function(){return Cesium.JulianDate.now()},this.to4326Transform_=ve(this.map_.getView().getProjection(),"EPSG:4326"),this.resolutionScale_=1,this.canvasClientWidth_=0,this.canvasClientHeight_=0,this.resolutionScaleChanged_=!0;const s="position:absolute;top:0;left:0;width:100%;height:100%;";this.container_=document.createElement("DIV");const t=document.createAttribute("style");t.value=`${s}visibility:hidden;`,this.container_.setAttributeNode(t);let i=e.target||this.map_.getViewport();if(typeof i=="string"&&(i=document.getElementById(i)),i.appendChild(this.container_),this.isOverMap_=!e.target,this.isOverMap_&&e.stopOpenLayersEventsPropagation){const c=["click","dblclick","mousedown","touchstart","MSPointerDown","pointerdown","mousewheel","wheel"];for(let m=0,f=c.length;m<f;++m)this.container_.addEventListener(c[m],p=>p.stopPropagation())}this.canvas_=document.createElement("CANVAS");const o=document.createAttribute("style");o.value=s,this.canvas_.setAttributeNode(o),H.supportsImageRenderingPixelated()&&(this.canvas_.style.imageRendering=H.imageRenderingValue()),this.canvas_.oncontextmenu=function(){return!1},this.canvas_.onselectstart=function(){return!1},this.container_.appendChild(this.canvas_),this.enabled_=!1,this.pausedInteractions_=[],this.hiddenRootGroup_=null;const n=e.sceneOptions!==void 0?e.sceneOptions:{};n.canvas=this.canvas_,n.scene3DOnly=!0,this.scene_=new Cesium.Scene(n);const a=this.scene_.screenSpaceCameraController;a.tiltEventTypes.push({eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.SHIFT}),a.tiltEventTypes.push({eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.ALT}),a.enableLook=!1,this.scene_.camera.constrainedAxis=Cesium.Cartesian3.UNIT_Z,this.camera_=new Y(this.scene_,this.map_),this.globe_=new Cesium.Globe(Cesium.Ellipsoid.WGS84),this.globe_.baseColor=Cesium.Color.WHITE,this.scene_.globe=this.globe_,this.scene_.skyAtmosphere=new Cesium.SkyAtmosphere;const r=new Cesium.SingleTileImageryProvider({url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",rectangle:Cesium.Rectangle.fromDegrees(0,0,1,1)});this.globe_.imageryLayers.addImageryProvider(r,0),this.dataSourceCollection_=new Cesium.DataSourceCollection,this.dataSourceDisplay_=new Cesium.DataSourceDisplay({scene:this.scene_,dataSourceCollection:this.dataSourceCollection_});const d=e.createSynchronizers?e.createSynchronizers(this.map_,this.scene_,this.dataSourceCollection_):[new On(this.map_,this.scene_),new Rn(this.map_,this.scene_),new Fn(this.map_,this.scene_)];this.handleResize_();for(let c=d.length-1;c>=0;--c)d[c].synchronize();this.lastFrameTime_=0,this.renderId_=void 0,this.targetFrameRate_=Number.POSITIVE_INFINITY,this.blockCesiumRendering_=!1,this.warmingUp_=!1,this.trackedFeature_=null,this.trackedEntity_=null,this.entityView_=null,this.needTrackedEntityUpdate_=!1,this.boundingSphereScratch_=new Cesium.BoundingSphere,new Cesium.EventHelper().add(this.scene_.postRender,ae.prototype.updateTrackedEntity_,this),Cesium.Camera.enableSuspendTerrainAdjustment=!1}render_(){this.renderId_!==void 0&&(cancelAnimationFrame(this.renderId_),this.renderId_=void 0),(this.enabled_||this.warmingUp_)&&!this.blockCesiumRendering_&&(this.renderId_=requestAnimationFrame(this.onAnimationFrame_.bind(this)))}onAnimationFrame_(e){this.renderId_=void 0;const s=1e3/this.targetFrameRate_;if(e-this.lastFrameTime_<s){this.render_();return}this.lastFrameTime_=e;const i=this.time_();if(this.scene_.initializeFrame(),this.handleResize_(),this.dataSourceDisplay_.update(i),this.entityView_){const o=this.trackedEntity_;this.dataSourceDisplay_.getBoundingSphere(o,!1,this.boundingSphereScratch_)===Cesium.BoundingSphereState.DONE&&(this.boundingSphereScratch_.radius=1,this.entityView_.update(i,this.boundingSphereScratch_))}this.scene_.render(i),this.camera_.checkCameraChange(),this.render_()}updateTrackedEntity_(){if(!this.needTrackedEntityUpdate_)return;const e=this.trackedEntity_,s=this.scene_,t=this.dataSourceDisplay_.getBoundingSphere(e,!1,this.boundingSphereScratch_);if(t===Cesium.BoundingSphereState.PENDING)return;s.screenSpaceCameraController.enableTilt=!1;const i=t!==Cesium.BoundingSphereState.FAILED?this.boundingSphereScratch_:void 0;i&&(i.radius=1),this.entityView_=new Cesium.EntityView(e,s,s.mapProjection.ellipsoid),this.entityView_.update(this.time_(),i),this.needTrackedEntityUpdate_=!1}handleResize_(){let e=this.canvas_.clientWidth,s=this.canvas_.clientHeight;if(e===0|s===0||e===this.canvasClientWidth_&&s===this.canvasClientHeight_&&!this.resolutionScaleChanged_)return;let t=this.resolutionScale_;H.supportsImageRenderingPixelated()||(t*=window.devicePixelRatio||1),this.resolutionScaleChanged_=!1,this.canvasClientWidth_=e,this.canvasClientHeight_=s,e*=t,s*=t,this.canvas_.width=e,this.canvas_.height=s,this.scene_.camera.frustum.aspectRatio=e/s}getCamera(){return this.camera_}getOlMap(){return this.map_}getOlView(){const e=this.map_.getView();return console.assert(e),e}getCesiumScene(){return this.scene_}getDataSources(){return this.dataSourceCollection_}getDataSourceDisplay(){return this.dataSourceDisplay_}getEnabled(){return this.enabled_}setEnabled(e){if(this.enabled_===e)return;this.enabled_=e,this.container_.style.visibility=this.enabled_?"visible":"hidden";let s;if(this.enabled_){if(this.throwOnUnitializedMap_(),this.isOverMap_){s=this.map_.getInteractions(),s.forEach((i,o,n)=>{this.pausedInteractions_.push(i)}),s.clear(),this.map_.addInteraction=i=>this.pausedInteractions_.push(i),this.map_.removeInteraction=i=>this.pausedInteractions_=this.pausedInteractions_.filter(o=>o!==i);const t=this.map_.getLayerGroup();t.getVisible()&&(this.hiddenRootGroup_=t,this.hiddenRootGroup_.setVisible(!1)),this.map_.getOverlayContainer().classList.add("olcs-hideoverlay")}this.camera_.readFromView(),this.render_()}else this.isOverMap_&&(s=this.map_.getInteractions(),this.pausedInteractions_.forEach(t=>{s.push(t)}),this.pausedInteractions_.length=0,this.map_.addInteraction=t=>this.map_.getInteractions().push(t),this.map_.removeInteraction=t=>this.map_.getInteractions().remove(t),this.map_.getOverlayContainer().classList.remove("olcs-hideoverlay"),this.hiddenRootGroup_&&(this.hiddenRootGroup_.setVisible(!0),this.hiddenRootGroup_=null)),this.camera_.updateView()}warmUp(e,s){if(this.enabled_)return;this.throwOnUnitializedMap_(),this.camera_.readFromView();const t=this.globe_.ellipsoid,i=this.scene_.camera,o=t.cartesianToCartographic(i.position);o.height<e&&(o.height=e,i.position=t.cartographicToCartesian(o)),this.warmingUp_=!0,this.render_(),setTimeout(()=>{this.warmingUp_=!1},s)}setBlockCesiumRendering(e){this.blockCesiumRendering_!==e&&(this.blockCesiumRendering_=e,this.render_())}enableAutoRenderLoop(){this.autoRenderLoop_||(this.autoRenderLoop_=new xn(this))}getAutoRenderLoop(){return this.autoRenderLoop_}setResolutionScale(e){e=Math.max(0,e),e!==this.resolutionScale_&&(this.resolutionScale_=Math.max(0,e),this.resolutionScaleChanged_=!0,this.autoRenderLoop_&&this.autoRenderLoop_.restartRenderLoop())}setTargetFrameRate(e){this.targetFrameRate_!==e&&(this.targetFrameRate_=e,this.render_())}throwOnUnitializedMap_(){const s=this.map_.getView(),t=s.getCenter();if(!s.isDef()||isNaN(t[0])||isNaN(t[1]))throw new Error(`The OpenLayers map is not properly initialized: ${t} / ${s.getResolution()}`)}get trackedFeature(){return this.trackedFeature_}set trackedFeature(e){if(this.trackedFeature_!==e){const s=this.scene_;if(!e||!e.getGeometry()){this.needTrackedEntityUpdate_=!1,s.screenSpaceCameraController.enableTilt=!0,this.trackedEntity_&&this.dataSourceDisplay_.defaultDataSource.entities.remove(this.trackedEntity_),this.trackedEntity_=null,this.trackedFeature_=null,this.entityView_=null,s.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);return}this.trackedFeature_=e,this.needTrackedEntityUpdate_=!0;const t=this.to4326Transform_,i=function(){const n=e.getGeometry();console.assert(n instanceof j);const a=n.getCoordinates(),r=t(a,void 0,a.length);return P.ol4326CoordinateToCesiumCartesian(r)},o={position:new Cesium.CallbackProperty((n,a)=>i(),!1),point:{pixelSize:1,color:Cesium.Color.TRANSPARENT}};this.trackedEntity_=this.dataSourceDisplay_.defaultDataSource.entities.add(o)}}}const kn="/Map_Demo/assets/logo-1303f4e5.svg";const In={props:{},setup(l,{emit:e}){const s=re,t=ne,i=ee({defaultCenter:[121.326776,24.655499],defaultCenterZoom:14,targetNum:1,conditionWrap:!1,layerSelect:!1,currentLayers:[],layers:[],mapLayers:fe(()=>i.layers.map((_,g)=>({label:_.group_title,value:_.value,layers:_.group_layers,groupClass:_.group_class}))),baseMapsOptions:fe(()=>ne.sourceData()),selectLock:!1,mapCount:1,map1:null,map2:null,map1LayerStatus:[],map2LayerStatus:[],deleteLightbox:!1,dimensionMap:{map1:"2D",map2:"2D"},toSearchDimensionStatus:fe(()=>{let _=i.targetNum==1?"map1":"map2";return i.dimensionMap[_]==="2D"}),areaDataId:"",ol3d:null}),o=new jt({projection:"EPSG:4326",center:i.defaultCenter,zoom:i.defaultCenterZoom}),n=Te(null),a=Te(null);let r=null;function d(){n.value=new Qe({element:a.value,autoPan:!0,autoPanAnimation:{duration:250}}),i.map1=new Ce({target:"map1",layers:[ne.sourceFun("default")],view:o,controls:[],overlays:[n.value]})}function u(_,g){const v=new G({source:new A({features:[new Q({geometry:new j([_,g]),name:"Null Island",population:4e3,rainfall:500})]}),style:new Z({image:new be({anchor:[.5,100],anchorXUnits:"fraction",anchorYUnits:"pixels",src:"https://www.ockert-cnc.de/wp-content/uploads/2016/12/map-marker-icon-100x100.png"})})});let C=i.targetNum==1?"map1":"map2";i[C].addLayer(v)}function c({action:_,value:g}){var F;let v=((F=i.map1)==null?void 0:F.getTarget())==null?"map2":"map1",C=i[v].getView();switch(_){case"In":C.animate({zoom:C.getZoom()+1});break;case"Out":C.animate({zoom:C.getZoom()-1});break;case"toNorth":C.animate({rotation:0});break;case"moveTo":if(g){const{xAxis:T,yAxis:$}=g;C.animate({center:[T,$],zoom:10,duration:100})}else navigator.geolocation.getCurrentPosition(function(T){C.animate({center:[T.coords.longitude,T.coords.latitude],zoom:17,duration:100}),u(T.coords.longitude,T.coords.latitude)});break;case"fullScreen":let M=document.getElementById(`map${i.targetNum}`);M.requestFullscreen?M.requestFullscreen():M.msRequestFullscreen?M.msRequestFullscreen():M.mozRequestFullScreen?M.mozRequestFullScreen():M.webkitRequestFullscreen&&M.webkitRequestFullscreen();break}}function m({action:_,value:g}){var F;let v=i.targetNum==1?i.map1:i.map2,C=v==null?void 0:v.getLayers();switch(_){case"layerMode":if(g.checked)if(g.type==="tribe")Object.entries(Be).forEach(S=>{Le(S[0]).then(R=>{const{lng:I,lat:Oe,tribeName:Pe}=R.basicInformation.coordinates.WGS84,ot=new G({name:Pe,title:Pe,source:new A({features:[new Q({title:R.basicInformation.tribeName,type:"tribeFeature",tribeValue:S[0],geometry:new Je([I,Oe],.005)})]}),style:new Z({fill:new me({color:"#0f9ce2"})})});v.addLayer(ot)})}),v.on("click",S=>{const R=i.map1.forEachFeatureAtPixel(S.pixel,function(I,Oe){return I});R&&(i.areaDataId=R.get("tribeValue"))}),w("add",v.getTarget(),g.id);else{`${g.nestedSubNodeIndex}`&&(C.getArray().forEach(I=>{I.get("id")&&I.get("id").includes(`node${g.nodeIndex}_subNode${g.subNodeIndex}`)&&v.removeLayer(I)}),w("delete",v.getTarget(),g.id));let S=s.getLayer(i.layers[g.nodeIndex].group_layers[g.subNodeIndex],g.nestedSubNodeIndex,g.id);v.addLayer(S),w("add",v.getTarget(),g.id)}else g.type==="tribe"?C.forEach(S=>{S instanceof G&&S.getSource().getFeatures().forEach(R=>{R.get("type")==="tribeFeature"&&S.getSource().removeFeature(R)})}):(C.getArray().forEach(R=>{R.get("id")==g.id&&v.removeLayer(R)}),w("delete",v.getTarget(),g.id));break;case"selectLayerMode":if(i.selectLock)return;if(g.layerName==="all"){let S=[];C.getArray().forEach(I=>{I.get("name")!=="default"&&S.push(I)}),S.forEach(I=>{v.removeLayer(I)})}else C.getArray().forEach(R=>{R.get("id")==g.id&&v.removeLayer(R)});break;case"changeOrder":if(i.selectLock)return;let M=re.getLayerIndex(g.id),T=s.getLayer(i.layers[M.nodeIndex].group_layers[M.subNodeIndex],M.nestedSubNodeIndex,g.id);if(g.movement==="up"){if(g.key+1==C.getArray().length)return;g.checked=!1,m({action:"layerMode",value:g}),C.insertAt(g.key+1,T)}if(g.movement==="down"){if(g.key-1==0)return;g.checked=!1,m({action:"layerMode",value:g}),C.insertAt(g.key-1,T)}break;case"changeLayerVisible":if(i.selectLock)return;let $=!C.getArray()[g.key].getVisible();C.getArray()[g.key].setVisible($);break;case"baseMap":let U=t.sourceFun(g.layerName);C.extend([U]),C.getArray().forEach(S=>{S.get("name")!==g.layerName&&v.removeLayer(S)});break;case"changeMapCount":if(i.mapCount===g)return;let N=i.targetNum!==1?"map1":"map2";i.mapCount=g;let nt=i[`${N}LayerStatus`].filter(S=>S!=="3D").map(S=>re.getLayerIndex(S));if(g===2&&(i[N]=new Ce({target:N,layers:[ne.sourceFun("default"),...nt.map(S=>s.getLayer(i.layers[S.nodeIndex].group_layers[S.subNodeIndex],S.nestedSubNodeIndex,S.id))],view:o,controls:[]}),((F=i[`${N}LayerStatus`])==null?void 0:F.indexOf("3D"))!==-1&&(r=new ae({map:i[N]}),r.setEnabled(!0))),g===1){i[N]=null;const S=document.getElementById(N);for(;S.firstChild;)S.removeChild(S.firstChild)}break;case"changeDimensionMap":console.log(g);let de=i.targetNum==1?"map1":"map2";i.dimensionMap[de]=g,g==="3D"?(r=new ae({map:v}),r.setEnabled(!0),i[`${de}LayerStatus`].push("3D")):(r.setEnabled(!1),i[`${de}LayerStatus`]=i[`${de}LayerStatus`].filter(S=>S!=="3D"));break}p()}function f(_){var v;i.targetNum=_;let g=i.targetNum!==1?"map1":"map2";if(i.mapCount===1){if(!i[`map${_}`]){let F=i[`map${_}LayerStatus`].filter(M=>M!=="3D").map(M=>re.getLayerIndex(M));i[`map${_}`]=new Ce({target:`map${_}`,layers:[ne.sourceFun("default"),...F.map(M=>s.getLayer(i.layers[M.nodeIndex].group_layers[M.subNodeIndex],M.nestedSubNodeIndex,M.layeredIndex))],view:o,controls:[]}),((v=i[`map${_}LayerStatus`])==null?void 0:v.indexOf("3D"))!==-1&&(r=new ae({map:i[`map${_}`]}),r.setEnabled(!0))}if(i[g]){i[g]=null;const C=document.getElementById(g);for(;C.firstChild;)C.removeChild(C.firstChild)}}Re(()=>{p()})}function p(){var v;let _=i.targetNum==1?i.map1:i.map2;const g=(v=_==null?void 0:_.getLayers())==null?void 0:v.getArray();i.currentLayers=g==null?void 0:g.map(C=>({label:C.get("label"),id:C.get("id"),visible:C.getVisible()}))}function y(){i.conditionWrap=!i.conditionWrap}function w(_,g,v){if(_==="add")i[`${g}LayerStatus`].push(v);else if(_==="delete"){let C=i[`${g}LayerStatus`].findIndex(F=>F===v);i[`${g}LayerStatus`].splice(C,1)}else console.log("error")}return He(async()=>{await je.ajax({url:"https://api.edtest.site/layers",method:"GET"}).done(_=>{i.layers=_.map((g,v)=>(g.group_layers.forEach((C,F)=>{let M,T;M=F,C.id=`node${v}_subNode${M}_nestedSubNode${T}`,C.single_tiles||C.tiles_list.forEach(($,U)=>{T=U,$.id=`node${v}_subNode${M}_nestedSubNode${T}`})}),{...g,value:v})),Re(()=>{d(),p()})}).fail(_=>{console.log("Fail",_)})}),{state:i,props:l,areaCom:a,overlay:n,tribeIdList:Be,mapControl:c,layerControl:m,getCurrentLayerNames:p,changeTarget:f,conditionWrap:y}}},An={class:"SearchBar position-absolute"},Nn=h("img",{src:kn,alt:"",class:"mb-2"},null,-1),Gn={class:"w-100 d-flex flex-nowrap mapWrap",id:"mapWrap"},Dn={key:0,class:"middleLine"},Vn={class:"condition position-absolute"},$n={class:"mb-2"},zn={key:1,class:"mb-4"},Bn={key:1},jn={key:0,class:"lightWrap w-100 h-100 d-flex justify-content-center align-items-center"},Hn={class:"p-4 rounded bg-white",style:{width:"250px"}},Wn=h("p",{class:"text-center fw-bold"},"是否要刪除全部圖層",-1),Un={class:"d-flex justify-content-around"},Kn={key:1,ref:"areaCom",class:"areaData"};function Zn(l,e,s,t,i,o){var m,f;const n=Mn,a=Xi,r=Ki,d=Pi,u=ni,c=Rs;return b(),L("div",null,[h("div",An,[Nn,K(n,{dimensionMapStatus:t.state.toSearchDimensionStatus,currentLayers:t.state.currentLayers,mapCount:t.state.mapCount,onOnLayerControl:e[0]||(e[0]=({action:p,value:y})=>{t.layerControl({action:p,value:y})}),onOnChangeTarget:e[1]||(e[1]=p=>{t.changeTarget(p)}),onConditionWrap:e[2]||(e[2]=p=>{t.conditionWrap(p)})},null,8,["dimensionMapStatus","currentLayers","mapCount"])]),K(a,{class:"mapSourceOption",baseMapsOptions:t.state.baseMapsOptions,onOnChangeBaseMaps:e[3]||(e[3]=({action:p,value:y})=>{t.layerControl({action:p,value:y})})},null,8,["baseMapsOptions"]),K(r,{class:"asideTool position-absolute top-50 translate-middle-y",id:"asideTool",onOnMapControl:e[4]||(e[4]=({action:p,value:y})=>{t.mapControl({action:p,value:y})})}),h("div",Gn,[h("div",{id:"map1",class:D({"w-100":((m=t.state.map1)==null?void 0:m.getTarget())=="map1"})},null,2),t.state.mapCount===2?(b(),L("div",Dn)):E("",!0),h("div",{id:"map2",class:D({"w-100":((f=t.state.map2)==null?void 0:f.getTarget())=="map2"})},null,2)]),h("div",Vn,[h("div",$n,[t.state.conditionWrap?E("",!0):(b(),L("button",{key:0,class:"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5",onClick:e[5]||(e[5]=p=>t.state.conditionWrap=!0)}," 圖層選項 ")),t.state.conditionWrap?(b(),L("div",zn,[K(d,ct({mapLayers:t.state.mapLayers,currentLayers:t.state.currentLayers,tribeIdList:t.tribeIdList,onClose:()=>{t.state.conditionWrap=!1}},{onOnMapControl:e[6]||(e[6]=({action:p,value:y})=>{t.mapControl({action:p,value:y})}),onOnLayerControl:e[7]||(e[7]=({action:p,value:y})=>{t.layerControl({action:p,value:y})})}),null,16)])):E("",!0)]),h("div",null,[t.state.layerSelect?E("",!0):(b(),L("button",{key:0,class:"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5",onClick:e[8]||(e[8]=p=>t.state.layerSelect=!0)}," 已選擇的圖層 ")),t.state.layerSelect?(b(),L("div",Bn,[K(u,dt(ut({selectLock:t.state.selectLock,currentLayers:t.state.currentLayers,onClose:()=>{t.state.layerSelect=!1},onChangLayerVisible:p=>{t.layerControl(p)},onChangeOrderLayer:({action:p,value:y})=>{t.layerControl({action:p,value:y})},onLockLayer:()=>{t.state.selectLock=!t.state.selectLock},onDeleteLayer:({action:p,value:y})=>{y.layerName=="all"?t.state.deleteLightbox=!0:t.layerControl({action:p,value:y})},onDeleteLayerAll:()=>{t.state.deleteLightbox=!0}})),null,16)])):E("",!0)])]),t.state.deleteLightbox?(b(),L("div",jn,[h("div",Hn,[Wn,h("div",Un,[h("button",{class:"rounded px-3 py-1 bg-steel text-white border-0",onClick:e[9]||(e[9]=()=>{t.layerControl({action:"selectLayerMode",value:{layerName:"all"}}),t.state.deleteLightbox=!1})},"確定"),h("button",{class:"rounded px-3 py-1 bg-secondary bg-gradient text-white border-0",onClick:e[10]||(e[10]=()=>{t.state.deleteLightbox=!1})},"取消")])])])):E("",!0),t.state.areaDataId?(b(),L("div",Kn,[K(c,{id:t.state.areaDataId},null,8,["id"])],512)):E("",!0)])}const Xn=W(In,[["render",Zn]]);export{Xn as default};
//# sourceMappingURL=WebMap-6e5646a4.js.map
