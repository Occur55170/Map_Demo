{"version":3,"file":"WebMap-fbc96485.js","sources":["../../src/assets/example-AddressData.jpg","../../src/assets/img/icon/vector.svg","../../src/components/areaData.vue","../../node_modules/ol/Feature.js","../../node_modules/ol/renderer/canvas/VectorLayer.js","../../node_modules/ol/layer/Vector.js","../../node_modules/ol/structs/RBush.js","../../node_modules/ol/source/VectorEventType.js","../../node_modules/ol/loadingstrategy.js","../../node_modules/ol/source/Vector.js","../../node_modules/ol/geom/Circle.js","../../node_modules/ol/format/JSONFeature.js","../../src/components/layerSelect.vue","../../node_modules/ol/source/Cluster.js","../../node_modules/ol/source/TileArcGISRest.js","../../node_modules/ol/format/EsriJSON.js","../../src/config/mapLayerList.js","../../src/components/condition.vue","../../src/assets/img/icon/zoomIn.svg","../../src/assets/img/icon/zoomOut.svg","../../src/assets/img/icon/compass.svg","../../src/assets/img/icon/location.svg","../../src/assets/img/icon/zoom.svg","../../src/components/AsideTool.vue","../../src/components/mapSourceOption.vue","../../src/assets/img/icon/twoDimensional.svg","../../src/assets/img/icon/threeDimensional.svg","../../src/assets/img/icon/baseLayer.svg","../../src/assets/img/icon/singleWindow.svg","../../src/assets/img/icon/doubleWindows.svg","../../src/components/SearchBar.vue","../../node_modules/olcs/AutoRenderLoop.js","../../node_modules/olcs/math.js","../../node_modules/olcs/Camera.js","../../node_modules/olcs/AbstractSynchronizer.js","../../node_modules/olcs/RasterSynchronizer.js","../../node_modules/olcs/core/VectorLayerCounterpart.js","../../node_modules/olcs/FeatureConverter.js","../../node_modules/olcs/VectorSynchronizer.js","../../node_modules/olcs/SynchronizedOverlay.js","../../node_modules/olcs/OverlaySynchronizer.js","../../node_modules/olcs/OLCesium.js","../../src/assets/logo.svg","../../src/view/WebMap.vue"],"sourcesContent":["export default \"__VITE_ASSET__e32a2a13__\"","export default \"__VITE_ASSET__204bf141__\"","<script>\nimport { useSlots, onBeforeMount, onMounted, onUpdated, onBeforeUnmount, ref, reactive, computed, watch, nextTick, defineAsyncComponent, useCssModule, inject } from 'vue'\nimport $ from 'jquery'\nimport { compose } from 'ol/transform'\n\nexport default {\n    props: {\n        tribeId:{\n            Type: String,\n            default: 0\n        },\n        closeMapData: {\n            Type: Function,\n            default: ()=>{}\n        },\n        maxHeight: {\n            Type: Number,\n            default: 0\n        }\n    },\n    setup(props, { emit }){\n        const state = reactive({\n            media: 'photo',\n            scrollY: false,\n            tribeData: {},\n        })\n\n        async function getTribeData (tribeId) {\n            const result = await $.ajax({\n                url: `https://api.edtest.site/tribe?tribeCode=${tribeId}`,\n                method: \"GET\"\n            }).done(res => {\n                return res\n                }).fail(FailMethod => {\n                console.log('Fail', FailMethod)\n                return false\n                })\n            return result\n        }\n\n        onUpdated(props.tribeId, ()=>{\n            getTribeData(props.tribeId).then((result)=>{\n                state.tribeData = result\n            })\n        })\n\n\n        onMounted(()=>{\n            getTribeData(props.tribeId).then((result)=>{\n                state.tribeData = result\n            })\n        })\n\n        return {\n            props,\n            state,\n        }\n    }\n}\n\n</script>\n\n<template>\n    <div class=\"bg-white rounded py-2 \" style=\"overflow-y: auto;\">\n        <div class=\"row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold\">\n            <p>詳細資訊 {{ state.scrollY }}</p>\n            <!-- needfix:尚未加入關閉地圖資訊按鈕事件 -->\n            <div class=\"position-absolute col-auto end-0\" style=\"top: 10px;\" @click=\"closeMapData\">\n                <svg width=\"32\" height=\"32\" viewBox=\"0 0 24 24\">\n                    <path fill=\"currentColor\" d=\"M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10zm0-11.414L9.172 7.757L7.757 9.172L10.586 12l-2.829 2.828l1.415 1.415L12 13.414l2.828 2.829l1.415-1.415L13.414 12l2.829-2.828l-1.415-1.415L12 10.586z\"/>\n                </svg>\n            </div>\n        </div>\n        <img src=\"@/assets/example-AddressData.jpg\" class=\"w-100\" alt=\"\">\n        <div class=\"row mx-0 align-items-center p-2 position-relative\">\n            <p>title: {{ props.tribeId }} {{ state?.tribeData?.basicInformation?.tribeName }} </p>\n            <p>描述: {{ state?.tribeData?.basicInformation?.description }}</p>\n            <div class=\"position-absolute w-auto top-0 end-0 mt-2\">更多資訊</div>\n            <p>{{ state?.tribeData?.basicInformation?.area }}</p>\n            <a href=\"\">\n                <img src=\"@/assets/img/icon/vector.svg\" alt=\"\">\n                {{ state?.tribeData?.basicInformation?.coordinates?.WGS84?.lat}}\n                ,\n                {{state?.tribeData?.basicInformation?.coordinates?.WGS84?.lng }}\n            </a>\n        </div>\n        <div>\n            <div class=\"border-bottom row flex-nowrap p-2 my-3 cursor-pointer mx-0\">\n                <div class=\"col-6 cursor-pointer\" @click=\"state.media = 'photo'\">相片</div>\n                <div class=\"col-6 cursor-pointer\" @click=\"state.media = 'video'\">影片</div>\n            </div>\n            <div class=\"py-2 px-4\" v-if=\"state.media === 'photo'\">\n                <div class=\"d-flex flex-wrap justify-content-between\">\n                    <div class=\"w-50 mb-4\" v-for=\"item in state?.tribeData?.culturalLandscape\">\n                        <p class=\"mb-0\">{{ item.name }}</p>\n                        <img :src=\"item.image\" alt=\"\" class=\"w-100\">\n                    </div>\n                </div>\n            </div>\n            <div class=\"py-2 px-4\" v-if=\"state.media === 'video'\">\n                <div>影片影片影片影片影片影片</div>\n            </div>\n        </div>\n    </div>\n</template>\n\n<style lang=\"sass\" scoped>\n@import '@/assets/styles/all.module.scss'\n\n// .lightbox\n//     top: 20%\n//     left: 50%\n</style>\n","/**\n * @module ol/Feature\n */\nimport BaseObject from './Object.js';\nimport EventType from './events/EventType.js';\nimport {assert} from './asserts.js';\nimport {listen, unlistenByKey} from './events.js';\n\n/**\n * @typedef {typeof Feature|typeof import(\"./render/Feature.js\").default} FeatureClass\n */\n\n/**\n * @typedef {Feature|import(\"./render/Feature.js\").default} FeatureLike\n */\n\n/***\n * @template Return\n * @typedef {import(\"./Observable\").OnSignature<import(\"./Observable\").EventTypes, import(\"./events/Event.js\").default, Return> &\n *   import(\"./Observable\").OnSignature<import(\"./ObjectEventType\").Types|'change:geometry', import(\"./Object\").ObjectEvent, Return> &\n *   import(\"./Observable\").CombinedOnSignature<import(\"./Observable\").EventTypes|import(\"./ObjectEventType\").Types\n *     |'change:geometry', Return>} FeatureOnSignature\n */\n\n/***\n * @template Geometry\n * @typedef {Object<string, *> & { geometry?: Geometry }} ObjectWithGeometry\n */\n\n/**\n * @classdesc\n * A vector object for geographic features with a geometry and other\n * attribute properties, similar to the features in vector file formats like\n * GeoJSON.\n *\n * Features can be styled individually with `setStyle`; otherwise they use the\n * style of their vector layer.\n *\n * Note that attribute properties are set as {@link module:ol/Object~BaseObject} properties on\n * the feature object, so they are observable, and have get/set accessors.\n *\n * Typically, a feature has a single geometry property. You can set the\n * geometry using the `setGeometry` method and get it with `getGeometry`.\n * It is possible to store more than one geometry on a feature using attribute\n * properties. By default, the geometry used for rendering is identified by\n * the property name `geometry`. If you want to use another geometry property\n * for rendering, use the `setGeometryName` method to change the attribute\n * property associated with the geometry for the feature.  For example:\n *\n * ```js\n *\n * import Feature from 'ol/Feature.js';\n * import Polygon from 'ol/geom/Polygon.js';\n * import Point from 'ol/geom/Point.js';\n *\n * const feature = new Feature({\n *   geometry: new Polygon(polyCoords),\n *   labelPoint: new Point(labelCoords),\n *   name: 'My Polygon',\n * });\n *\n * // get the polygon geometry\n * const poly = feature.getGeometry();\n *\n * // Render the feature as a point using the coordinates from labelPoint\n * feature.setGeometryName('labelPoint');\n *\n * // get the point geometry\n * const point = feature.getGeometry();\n * ```\n *\n * @api\n * @template {import(\"./geom/Geometry.js\").default} [Geometry=import(\"./geom/Geometry.js\").default]\n */\nclass Feature extends BaseObject {\n  /**\n   * @param {Geometry|ObjectWithGeometry<Geometry>} [geometryOrProperties]\n   *     You may pass a Geometry object directly, or an object literal containing\n   *     properties. If you pass an object literal, you may include a Geometry\n   *     associated with a `geometry` key.\n   */\n  constructor(geometryOrProperties) {\n    super();\n\n    /***\n     * @type {FeatureOnSignature<import(\"./events\").EventsKey>}\n     */\n    this.on;\n\n    /***\n     * @type {FeatureOnSignature<import(\"./events\").EventsKey>}\n     */\n    this.once;\n\n    /***\n     * @type {FeatureOnSignature<void>}\n     */\n    this.un;\n\n    /**\n     * @private\n     * @type {number|string|undefined}\n     */\n    this.id_ = undefined;\n\n    /**\n     * @type {string}\n     * @private\n     */\n    this.geometryName_ = 'geometry';\n\n    /**\n     * User provided style.\n     * @private\n     * @type {import(\"./style/Style.js\").StyleLike}\n     */\n    this.style_ = null;\n\n    /**\n     * @private\n     * @type {import(\"./style/Style.js\").StyleFunction|undefined}\n     */\n    this.styleFunction_ = undefined;\n\n    /**\n     * @private\n     * @type {?import(\"./events.js\").EventsKey}\n     */\n    this.geometryChangeKey_ = null;\n\n    this.addChangeListener(this.geometryName_, this.handleGeometryChanged_);\n\n    if (geometryOrProperties) {\n      if (\n        typeof (\n          /** @type {?} */ (geometryOrProperties).getSimplifiedGeometry\n        ) === 'function'\n      ) {\n        const geometry = /** @type {Geometry} */ (geometryOrProperties);\n        this.setGeometry(geometry);\n      } else {\n        /** @type {Object<string, *>} */\n        const properties = geometryOrProperties;\n        this.setProperties(properties);\n      }\n    }\n  }\n\n  /**\n   * Clone this feature. If the original feature has a geometry it\n   * is also cloned. The feature id is not set in the clone.\n   * @return {Feature<Geometry>} The clone.\n   * @api\n   */\n  clone() {\n    const clone = /** @type {Feature<Geometry>} */ (\n      new Feature(this.hasProperties() ? this.getProperties() : null)\n    );\n    clone.setGeometryName(this.getGeometryName());\n    const geometry = this.getGeometry();\n    if (geometry) {\n      clone.setGeometry(/** @type {Geometry} */ (geometry.clone()));\n    }\n    const style = this.getStyle();\n    if (style) {\n      clone.setStyle(style);\n    }\n    return clone;\n  }\n\n  /**\n   * Get the feature's default geometry.  A feature may have any number of named\n   * geometries.  The \"default\" geometry (the one that is rendered by default) is\n   * set when calling {@link module:ol/Feature~Feature#setGeometry}.\n   * @return {Geometry|undefined} The default geometry for the feature.\n   * @api\n   * @observable\n   */\n  getGeometry() {\n    return /** @type {Geometry|undefined} */ (this.get(this.geometryName_));\n  }\n\n  /**\n   * Get the feature identifier.  This is a stable identifier for the feature and\n   * is either set when reading data from a remote source or set explicitly by\n   * calling {@link module:ol/Feature~Feature#setId}.\n   * @return {number|string|undefined} Id.\n   * @api\n   */\n  getId() {\n    return this.id_;\n  }\n\n  /**\n   * Get the name of the feature's default geometry.  By default, the default\n   * geometry is named `geometry`.\n   * @return {string} Get the property name associated with the default geometry\n   *     for this feature.\n   * @api\n   */\n  getGeometryName() {\n    return this.geometryName_;\n  }\n\n  /**\n   * Get the feature's style. Will return what was provided to the\n   * {@link module:ol/Feature~Feature#setStyle} method.\n   * @return {import(\"./style/Style.js\").StyleLike|undefined} The feature style.\n   * @api\n   */\n  getStyle() {\n    return this.style_;\n  }\n\n  /**\n   * Get the feature's style function.\n   * @return {import(\"./style/Style.js\").StyleFunction|undefined} Return a function\n   * representing the current style of this feature.\n   * @api\n   */\n  getStyleFunction() {\n    return this.styleFunction_;\n  }\n\n  /**\n   * @private\n   */\n  handleGeometryChange_() {\n    this.changed();\n  }\n\n  /**\n   * @private\n   */\n  handleGeometryChanged_() {\n    if (this.geometryChangeKey_) {\n      unlistenByKey(this.geometryChangeKey_);\n      this.geometryChangeKey_ = null;\n    }\n    const geometry = this.getGeometry();\n    if (geometry) {\n      this.geometryChangeKey_ = listen(\n        geometry,\n        EventType.CHANGE,\n        this.handleGeometryChange_,\n        this\n      );\n    }\n    this.changed();\n  }\n\n  /**\n   * Set the default geometry for the feature.  This will update the property\n   * with the name returned by {@link module:ol/Feature~Feature#getGeometryName}.\n   * @param {Geometry|undefined} geometry The new geometry.\n   * @api\n   * @observable\n   */\n  setGeometry(geometry) {\n    this.set(this.geometryName_, geometry);\n  }\n\n  /**\n   * Set the style for the feature to override the layer style.  This can be a\n   * single style object, an array of styles, or a function that takes a\n   * resolution and returns an array of styles. To unset the feature style, call\n   * `setStyle()` without arguments or a falsey value.\n   * @param {import(\"./style/Style.js\").StyleLike} [style] Style for this feature.\n   * @api\n   * @fires module:ol/events/Event~BaseEvent#event:change\n   */\n  setStyle(style) {\n    this.style_ = style;\n    this.styleFunction_ = !style ? undefined : createStyleFunction(style);\n    this.changed();\n  }\n\n  /**\n   * Set the feature id.  The feature id is considered stable and may be used when\n   * requesting features or comparing identifiers returned from a remote source.\n   * The feature id can be used with the\n   * {@link module:ol/source/Vector~VectorSource#getFeatureById} method.\n   * @param {number|string|undefined} id The feature id.\n   * @api\n   * @fires module:ol/events/Event~BaseEvent#event:change\n   */\n  setId(id) {\n    this.id_ = id;\n    this.changed();\n  }\n\n  /**\n   * Set the property name to be used when getting the feature's default geometry.\n   * When calling {@link module:ol/Feature~Feature#getGeometry}, the value of the property with\n   * this name will be returned.\n   * @param {string} name The property name of the default geometry.\n   * @api\n   */\n  setGeometryName(name) {\n    this.removeChangeListener(this.geometryName_, this.handleGeometryChanged_);\n    this.geometryName_ = name;\n    this.addChangeListener(this.geometryName_, this.handleGeometryChanged_);\n    this.handleGeometryChanged_();\n  }\n}\n\n/**\n * Convert the provided object into a feature style function.  Functions passed\n * through unchanged.  Arrays of Style or single style objects wrapped\n * in a new feature style function.\n * @param {!import(\"./style/Style.js\").StyleFunction|!Array<import(\"./style/Style.js\").default>|!import(\"./style/Style.js\").default} obj\n *     A feature style function, a single style, or an array of styles.\n * @return {import(\"./style/Style.js\").StyleFunction} A style function.\n */\nexport function createStyleFunction(obj) {\n  if (typeof obj === 'function') {\n    return obj;\n  }\n  /**\n   * @type {Array<import(\"./style/Style.js\").default>}\n   */\n  let styles;\n  if (Array.isArray(obj)) {\n    styles = obj;\n  } else {\n    assert(typeof (/** @type {?} */ (obj).getZIndex) === 'function', 41); // Expected an `import(\"./style/Style.js\").Style` or an array of `import(\"./style/Style.js\").Style`\n    const style = /** @type {import(\"./style/Style.js\").default} */ (obj);\n    styles = [style];\n  }\n  return function () {\n    return styles;\n  };\n}\nexport default Feature;\n","/**\n * @module ol/renderer/canvas/VectorLayer\n */\nimport CanvasBuilderGroup from '../../render/canvas/BuilderGroup.js';\nimport CanvasLayerRenderer, {canvasPool} from './Layer.js';\nimport ExecutorGroup from '../../render/canvas/ExecutorGroup.js';\nimport ViewHint from '../../ViewHint.js';\nimport {\n  HIT_DETECT_RESOLUTION,\n  createHitDetectionImageData,\n  hitDetect,\n} from '../../render/canvas/hitdetect.js';\nimport {\n  apply,\n  makeInverse,\n  makeScale,\n  toString as transformToString,\n} from '../../transform.js';\nimport {\n  buffer,\n  containsExtent,\n  createEmpty,\n  getWidth,\n  intersects as intersectsExtent,\n  wrapX as wrapExtentX,\n} from '../../extent.js';\nimport {createCanvasContext2D, releaseCanvas} from '../../dom.js';\nimport {\n  defaultOrder as defaultRenderOrder,\n  getTolerance as getRenderTolerance,\n  getSquaredTolerance as getSquaredRenderTolerance,\n  renderFeature,\n} from '../vector.js';\nimport {equals} from '../../array.js';\nimport {\n  fromUserExtent,\n  getTransformFromProjections,\n  getUserProjection,\n  toUserExtent,\n  toUserResolution,\n} from '../../proj.js';\nimport {getUid} from '../../util.js';\nimport {wrapX as wrapCoordinateX} from '../../coordinate.js';\n\n/**\n * @classdesc\n * Canvas renderer for vector layers.\n * @api\n */\nclass CanvasVectorLayerRenderer extends CanvasLayerRenderer {\n  /**\n   * @param {import(\"../../layer/BaseVector.js\").default} vectorLayer Vector layer.\n   */\n  constructor(vectorLayer) {\n    super(vectorLayer);\n\n    /** @private */\n    this.boundHandleStyleImageChange_ = this.handleStyleImageChange_.bind(this);\n\n    /**\n     * @type {boolean}\n     */\n    this.animatingOrInteracting_;\n\n    /**\n     * @type {ImageData|null}\n     */\n    this.hitDetectionImageData_ = null;\n\n    /**\n     * @type {Array<import(\"../../Feature.js\").default>}\n     */\n    this.renderedFeatures_ = null;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.renderedRevision_ = -1;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.renderedResolution_ = NaN;\n\n    /**\n     * @private\n     * @type {import(\"../../extent.js\").Extent}\n     */\n    this.renderedExtent_ = createEmpty();\n\n    /**\n     * @private\n     * @type {import(\"../../extent.js\").Extent}\n     */\n    this.wrappedRenderedExtent_ = createEmpty();\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.renderedRotation_;\n\n    /**\n     * @private\n     * @type {import(\"../../coordinate\").Coordinate}\n     */\n    this.renderedCenter_ = null;\n\n    /**\n     * @private\n     * @type {import(\"../../proj/Projection\").default}\n     */\n    this.renderedProjection_ = null;\n\n    /**\n     * @private\n     * @type {function(import(\"../../Feature.js\").default, import(\"../../Feature.js\").default): number|null}\n     */\n    this.renderedRenderOrder_ = null;\n\n    /**\n     * @private\n     * @type {import(\"../../render/canvas/ExecutorGroup\").default}\n     */\n    this.replayGroup_ = null;\n\n    /**\n     * A new replay group had to be created by `prepareFrame()`\n     * @type {boolean}\n     */\n    this.replayGroupChanged = true;\n\n    /**\n     * @type {import(\"../../render/canvas/ExecutorGroup\").default}\n     */\n    this.declutterExecutorGroup = null;\n\n    /**\n     * Clipping to be performed by `renderFrame()`\n     * @type {boolean}\n     */\n    this.clipping = true;\n\n    /**\n     * @private\n     * @type {CanvasRenderingContext2D}\n     */\n    this.compositionContext_ = null;\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.opacity_ = 1;\n  }\n\n  /**\n   * @param {ExecutorGroup} executorGroup Executor group.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @param {import(\"rbush\").default} [declutterTree] Declutter tree.\n   */\n  renderWorlds(executorGroup, frameState, declutterTree) {\n    const extent = frameState.extent;\n    const viewState = frameState.viewState;\n    const center = viewState.center;\n    const resolution = viewState.resolution;\n    const projection = viewState.projection;\n    const rotation = viewState.rotation;\n    const projectionExtent = projection.getExtent();\n    const vectorSource = this.getLayer().getSource();\n    const pixelRatio = frameState.pixelRatio;\n    const viewHints = frameState.viewHints;\n    const snapToPixel = !(\n      viewHints[ViewHint.ANIMATING] || viewHints[ViewHint.INTERACTING]\n    );\n    const context = this.compositionContext_;\n    const width = Math.round(frameState.size[0] * pixelRatio);\n    const height = Math.round(frameState.size[1] * pixelRatio);\n\n    const multiWorld = vectorSource.getWrapX() && projection.canWrapX();\n    const worldWidth = multiWorld ? getWidth(projectionExtent) : null;\n    const endWorld = multiWorld\n      ? Math.ceil((extent[2] - projectionExtent[2]) / worldWidth) + 1\n      : 1;\n    let world = multiWorld\n      ? Math.floor((extent[0] - projectionExtent[0]) / worldWidth)\n      : 0;\n    do {\n      const transform = this.getRenderTransform(\n        center,\n        resolution,\n        rotation,\n        pixelRatio,\n        width,\n        height,\n        world * worldWidth\n      );\n      executorGroup.execute(\n        context,\n        1,\n        transform,\n        rotation,\n        snapToPixel,\n        undefined,\n        declutterTree\n      );\n    } while (++world < endWorld);\n  }\n\n  setupCompositionContext_() {\n    if (this.opacity_ !== 1) {\n      const compositionContext = createCanvasContext2D(\n        this.context.canvas.width,\n        this.context.canvas.height,\n        canvasPool\n      );\n      this.compositionContext_ = compositionContext;\n    } else {\n      this.compositionContext_ = this.context;\n    }\n  }\n\n  releaseCompositionContext_() {\n    if (this.opacity_ !== 1) {\n      const alpha = this.context.globalAlpha;\n      this.context.globalAlpha = this.opacity_;\n      this.context.drawImage(this.compositionContext_.canvas, 0, 0);\n      this.context.globalAlpha = alpha;\n      releaseCanvas(this.compositionContext_);\n      canvasPool.push(this.compositionContext_.canvas);\n      this.compositionContext_ = null;\n    }\n  }\n\n  /**\n   * Render declutter items for this layer\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   */\n  renderDeclutter(frameState) {\n    if (this.declutterExecutorGroup) {\n      this.setupCompositionContext_();\n      this.renderWorlds(\n        this.declutterExecutorGroup,\n        frameState,\n        frameState.declutterTree\n      );\n      this.releaseCompositionContext_();\n    }\n  }\n\n  /**\n   * Render the layer.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @param {HTMLElement} target Target that may be used to render content to.\n   * @return {HTMLElement} The rendered element.\n   */\n  renderFrame(frameState, target) {\n    const pixelRatio = frameState.pixelRatio;\n    const layerState = frameState.layerStatesArray[frameState.layerIndex];\n\n    // set forward and inverse pixel transforms\n    makeScale(this.pixelTransform, 1 / pixelRatio, 1 / pixelRatio);\n    makeInverse(this.inversePixelTransform, this.pixelTransform);\n\n    const canvasTransform = transformToString(this.pixelTransform);\n\n    this.useContainer(target, canvasTransform, this.getBackground(frameState));\n    const context = this.context;\n    const canvas = context.canvas;\n\n    const replayGroup = this.replayGroup_;\n    const declutterExecutorGroup = this.declutterExecutorGroup;\n    if (\n      (!replayGroup || replayGroup.isEmpty()) &&\n      (!declutterExecutorGroup || declutterExecutorGroup.isEmpty())\n    ) {\n      return null;\n    }\n\n    // resize and clear\n    const width = Math.round(frameState.size[0] * pixelRatio);\n    const height = Math.round(frameState.size[1] * pixelRatio);\n    if (canvas.width != width || canvas.height != height) {\n      canvas.width = width;\n      canvas.height = height;\n      if (canvas.style.transform !== canvasTransform) {\n        canvas.style.transform = canvasTransform;\n      }\n    } else if (!this.containerReused) {\n      context.clearRect(0, 0, width, height);\n    }\n\n    this.preRender(context, frameState);\n\n    const viewState = frameState.viewState;\n    const projection = viewState.projection;\n\n    this.opacity_ = layerState.opacity;\n    this.setupCompositionContext_();\n\n    // clipped rendering if layer extent is set\n    let clipped = false;\n    let render = true;\n    if (layerState.extent && this.clipping) {\n      const layerExtent = fromUserExtent(layerState.extent, projection);\n      render = intersectsExtent(layerExtent, frameState.extent);\n      clipped = render && !containsExtent(layerExtent, frameState.extent);\n      if (clipped) {\n        this.clipUnrotated(this.compositionContext_, frameState, layerExtent);\n      }\n    }\n\n    if (render) {\n      this.renderWorlds(replayGroup, frameState);\n    }\n\n    if (clipped) {\n      this.compositionContext_.restore();\n    }\n\n    this.releaseCompositionContext_();\n\n    this.postRender(context, frameState);\n\n    if (this.renderedRotation_ !== viewState.rotation) {\n      this.renderedRotation_ = viewState.rotation;\n      this.hitDetectionImageData_ = null;\n    }\n    return this.container;\n  }\n\n  /**\n   * Asynchronous layer level hit detection.\n   * @param {import(\"../../pixel.js\").Pixel} pixel Pixel.\n   * @return {Promise<Array<import(\"../../Feature\").default>>} Promise\n   * that resolves with an array of features.\n   */\n  getFeatures(pixel) {\n    return new Promise((resolve) => {\n      if (!this.hitDetectionImageData_ && !this.animatingOrInteracting_) {\n        const size = [this.context.canvas.width, this.context.canvas.height];\n        apply(this.pixelTransform, size);\n        const center = this.renderedCenter_;\n        const resolution = this.renderedResolution_;\n        const rotation = this.renderedRotation_;\n        const projection = this.renderedProjection_;\n        const extent = this.wrappedRenderedExtent_;\n        const layer = this.getLayer();\n        const transforms = [];\n        const width = size[0] * HIT_DETECT_RESOLUTION;\n        const height = size[1] * HIT_DETECT_RESOLUTION;\n        transforms.push(\n          this.getRenderTransform(\n            center,\n            resolution,\n            rotation,\n            HIT_DETECT_RESOLUTION,\n            width,\n            height,\n            0\n          ).slice()\n        );\n        const source = layer.getSource();\n        const projectionExtent = projection.getExtent();\n        if (\n          source.getWrapX() &&\n          projection.canWrapX() &&\n          !containsExtent(projectionExtent, extent)\n        ) {\n          let startX = extent[0];\n          const worldWidth = getWidth(projectionExtent);\n          let world = 0;\n          let offsetX;\n          while (startX < projectionExtent[0]) {\n            --world;\n            offsetX = worldWidth * world;\n            transforms.push(\n              this.getRenderTransform(\n                center,\n                resolution,\n                rotation,\n                HIT_DETECT_RESOLUTION,\n                width,\n                height,\n                offsetX\n              ).slice()\n            );\n            startX += worldWidth;\n          }\n          world = 0;\n          startX = extent[2];\n          while (startX > projectionExtent[2]) {\n            ++world;\n            offsetX = worldWidth * world;\n            transforms.push(\n              this.getRenderTransform(\n                center,\n                resolution,\n                rotation,\n                HIT_DETECT_RESOLUTION,\n                width,\n                height,\n                offsetX\n              ).slice()\n            );\n            startX -= worldWidth;\n          }\n        }\n\n        this.hitDetectionImageData_ = createHitDetectionImageData(\n          size,\n          transforms,\n          this.renderedFeatures_,\n          layer.getStyleFunction(),\n          extent,\n          resolution,\n          rotation\n        );\n      }\n      resolve(\n        hitDetect(pixel, this.renderedFeatures_, this.hitDetectionImageData_)\n      );\n    });\n  }\n\n  /**\n   * @param {import(\"../../coordinate.js\").Coordinate} coordinate Coordinate.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @param {number} hitTolerance Hit tolerance in pixels.\n   * @param {import(\"../vector.js\").FeatureCallback<T>} callback Feature callback.\n   * @param {Array<import(\"../Map.js\").HitMatch<T>>} matches The hit detected matches with tolerance.\n   * @return {T|undefined} Callback result.\n   * @template T\n   */\n  forEachFeatureAtCoordinate(\n    coordinate,\n    frameState,\n    hitTolerance,\n    callback,\n    matches\n  ) {\n    if (!this.replayGroup_) {\n      return undefined;\n    }\n    const resolution = frameState.viewState.resolution;\n    const rotation = frameState.viewState.rotation;\n    const layer = this.getLayer();\n\n    /** @type {!Object<string, import(\"../Map.js\").HitMatch<T>|true>} */\n    const features = {};\n\n    /**\n     * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n     * @param {import(\"../../geom/SimpleGeometry.js\").default} geometry Geometry.\n     * @param {number} distanceSq The squared distance to the click position\n     * @return {T|undefined} Callback result.\n     */\n    const featureCallback = function (feature, geometry, distanceSq) {\n      const key = getUid(feature);\n      const match = features[key];\n      if (!match) {\n        if (distanceSq === 0) {\n          features[key] = true;\n          return callback(feature, layer, geometry);\n        }\n        matches.push(\n          (features[key] = {\n            feature: feature,\n            layer: layer,\n            geometry: geometry,\n            distanceSq: distanceSq,\n            callback: callback,\n          })\n        );\n      } else if (match !== true && distanceSq < match.distanceSq) {\n        if (distanceSq === 0) {\n          features[key] = true;\n          matches.splice(matches.lastIndexOf(match), 1);\n          return callback(feature, layer, geometry);\n        }\n        match.geometry = geometry;\n        match.distanceSq = distanceSq;\n      }\n      return undefined;\n    };\n\n    let result;\n    const executorGroups = [this.replayGroup_];\n    if (this.declutterExecutorGroup) {\n      executorGroups.push(this.declutterExecutorGroup);\n    }\n    executorGroups.some((executorGroup) => {\n      return (result = executorGroup.forEachFeatureAtCoordinate(\n        coordinate,\n        resolution,\n        rotation,\n        hitTolerance,\n        featureCallback,\n        executorGroup === this.declutterExecutorGroup &&\n          frameState.declutterTree\n          ? frameState.declutterTree.all().map((item) => item.value)\n          : null\n      ));\n    });\n\n    return result;\n  }\n\n  /**\n   * Perform action necessary to get the layer rendered after new fonts have loaded\n   */\n  handleFontsChanged() {\n    const layer = this.getLayer();\n    if (layer.getVisible() && this.replayGroup_) {\n      layer.changed();\n    }\n  }\n\n  /**\n   * Handle changes in image style state.\n   * @param {import(\"../../events/Event.js\").default} event Image style change event.\n   * @private\n   */\n  handleStyleImageChange_(event) {\n    this.renderIfReadyAndVisible();\n  }\n\n  /**\n   * Determine whether render should be called.\n   * @param {import(\"../../Map.js\").FrameState} frameState Frame state.\n   * @return {boolean} Layer is ready to be rendered.\n   */\n  prepareFrame(frameState) {\n    const vectorLayer = this.getLayer();\n    const vectorSource = vectorLayer.getSource();\n    if (!vectorSource) {\n      return false;\n    }\n\n    const animating = frameState.viewHints[ViewHint.ANIMATING];\n    const interacting = frameState.viewHints[ViewHint.INTERACTING];\n    const updateWhileAnimating = vectorLayer.getUpdateWhileAnimating();\n    const updateWhileInteracting = vectorLayer.getUpdateWhileInteracting();\n\n    if (\n      (this.ready && !updateWhileAnimating && animating) ||\n      (!updateWhileInteracting && interacting)\n    ) {\n      this.animatingOrInteracting_ = true;\n      return true;\n    }\n    this.animatingOrInteracting_ = false;\n\n    const frameStateExtent = frameState.extent;\n    const viewState = frameState.viewState;\n    const projection = viewState.projection;\n    const resolution = viewState.resolution;\n    const pixelRatio = frameState.pixelRatio;\n    const vectorLayerRevision = vectorLayer.getRevision();\n    const vectorLayerRenderBuffer = vectorLayer.getRenderBuffer();\n    let vectorLayerRenderOrder = vectorLayer.getRenderOrder();\n\n    if (vectorLayerRenderOrder === undefined) {\n      vectorLayerRenderOrder = defaultRenderOrder;\n    }\n\n    const center = viewState.center.slice();\n    const extent = buffer(\n      frameStateExtent,\n      vectorLayerRenderBuffer * resolution\n    );\n    const renderedExtent = extent.slice();\n    const loadExtents = [extent.slice()];\n    const projectionExtent = projection.getExtent();\n\n    if (\n      vectorSource.getWrapX() &&\n      projection.canWrapX() &&\n      !containsExtent(projectionExtent, frameState.extent)\n    ) {\n      // For the replay group, we need an extent that intersects the real world\n      // (-180° to +180°). To support geometries in a coordinate range from -540°\n      // to +540°, we add at least 1 world width on each side of the projection\n      // extent. If the viewport is wider than the world, we need to add half of\n      // the viewport width to make sure we cover the whole viewport.\n      const worldWidth = getWidth(projectionExtent);\n      const gutter = Math.max(getWidth(extent) / 2, worldWidth);\n      extent[0] = projectionExtent[0] - gutter;\n      extent[2] = projectionExtent[2] + gutter;\n      wrapCoordinateX(center, projection);\n      const loadExtent = wrapExtentX(loadExtents[0], projection);\n      // If the extent crosses the date line, we load data for both edges of the worlds\n      if (\n        loadExtent[0] < projectionExtent[0] &&\n        loadExtent[2] < projectionExtent[2]\n      ) {\n        loadExtents.push([\n          loadExtent[0] + worldWidth,\n          loadExtent[1],\n          loadExtent[2] + worldWidth,\n          loadExtent[3],\n        ]);\n      } else if (\n        loadExtent[0] > projectionExtent[0] &&\n        loadExtent[2] > projectionExtent[2]\n      ) {\n        loadExtents.push([\n          loadExtent[0] - worldWidth,\n          loadExtent[1],\n          loadExtent[2] - worldWidth,\n          loadExtent[3],\n        ]);\n      }\n    }\n\n    if (\n      this.ready &&\n      this.renderedResolution_ == resolution &&\n      this.renderedRevision_ == vectorLayerRevision &&\n      this.renderedRenderOrder_ == vectorLayerRenderOrder &&\n      containsExtent(this.wrappedRenderedExtent_, extent)\n    ) {\n      if (!equals(this.renderedExtent_, renderedExtent)) {\n        this.hitDetectionImageData_ = null;\n        this.renderedExtent_ = renderedExtent;\n      }\n      this.renderedCenter_ = center;\n      this.replayGroupChanged = false;\n      return true;\n    }\n\n    this.replayGroup_ = null;\n\n    const replayGroup = new CanvasBuilderGroup(\n      getRenderTolerance(resolution, pixelRatio),\n      extent,\n      resolution,\n      pixelRatio\n    );\n\n    let declutterBuilderGroup;\n    if (this.getLayer().getDeclutter()) {\n      declutterBuilderGroup = new CanvasBuilderGroup(\n        getRenderTolerance(resolution, pixelRatio),\n        extent,\n        resolution,\n        pixelRatio\n      );\n    }\n\n    const userProjection = getUserProjection();\n    let userTransform;\n    if (userProjection) {\n      for (let i = 0, ii = loadExtents.length; i < ii; ++i) {\n        const extent = loadExtents[i];\n        const userExtent = toUserExtent(extent, projection);\n        vectorSource.loadFeatures(\n          userExtent,\n          toUserResolution(resolution, projection),\n          userProjection\n        );\n      }\n      userTransform = getTransformFromProjections(userProjection, projection);\n    } else {\n      for (let i = 0, ii = loadExtents.length; i < ii; ++i) {\n        vectorSource.loadFeatures(loadExtents[i], resolution, projection);\n      }\n    }\n\n    const squaredTolerance = getSquaredRenderTolerance(resolution, pixelRatio);\n    let ready = true;\n    const render =\n      /**\n       * @param {import(\"../../Feature.js\").default} feature Feature.\n       */\n      (feature) => {\n        let styles;\n        const styleFunction =\n          feature.getStyleFunction() || vectorLayer.getStyleFunction();\n        if (styleFunction) {\n          styles = styleFunction(feature, resolution);\n        }\n        if (styles) {\n          const dirty = this.renderFeature(\n            feature,\n            squaredTolerance,\n            styles,\n            replayGroup,\n            userTransform,\n            declutterBuilderGroup\n          );\n          ready = ready && !dirty;\n        }\n      };\n\n    const userExtent = toUserExtent(extent, projection);\n    /** @type {Array<import(\"../../Feature.js\").default>} */\n    const features = vectorSource.getFeaturesInExtent(userExtent);\n    if (vectorLayerRenderOrder) {\n      features.sort(vectorLayerRenderOrder);\n    }\n    for (let i = 0, ii = features.length; i < ii; ++i) {\n      render(features[i]);\n    }\n    this.renderedFeatures_ = features;\n    this.ready = ready;\n\n    const replayGroupInstructions = replayGroup.finish();\n    const executorGroup = new ExecutorGroup(\n      extent,\n      resolution,\n      pixelRatio,\n      vectorSource.getOverlaps(),\n      replayGroupInstructions,\n      vectorLayer.getRenderBuffer()\n    );\n\n    if (declutterBuilderGroup) {\n      this.declutterExecutorGroup = new ExecutorGroup(\n        extent,\n        resolution,\n        pixelRatio,\n        vectorSource.getOverlaps(),\n        declutterBuilderGroup.finish(),\n        vectorLayer.getRenderBuffer()\n      );\n    }\n\n    this.renderedResolution_ = resolution;\n    this.renderedRevision_ = vectorLayerRevision;\n    this.renderedRenderOrder_ = vectorLayerRenderOrder;\n    this.renderedExtent_ = renderedExtent;\n    this.wrappedRenderedExtent_ = extent;\n    this.renderedCenter_ = center;\n    this.renderedProjection_ = projection;\n    this.replayGroup_ = executorGroup;\n    this.hitDetectionImageData_ = null;\n\n    this.replayGroupChanged = true;\n    return true;\n  }\n\n  /**\n   * @param {import(\"../../Feature.js\").default} feature Feature.\n   * @param {number} squaredTolerance Squared render tolerance.\n   * @param {import(\"../../style/Style.js\").default|Array<import(\"../../style/Style.js\").default>} styles The style or array of styles.\n   * @param {import(\"../../render/canvas/BuilderGroup.js\").default} builderGroup Builder group.\n   * @param {import(\"../../proj.js\").TransformFunction} [transform] Transform from user to view projection.\n   * @param {import(\"../../render/canvas/BuilderGroup.js\").default} [declutterBuilderGroup] Builder for decluttering.\n   * @return {boolean} `true` if an image is loading.\n   */\n  renderFeature(\n    feature,\n    squaredTolerance,\n    styles,\n    builderGroup,\n    transform,\n    declutterBuilderGroup\n  ) {\n    if (!styles) {\n      return false;\n    }\n    let loading = false;\n    if (Array.isArray(styles)) {\n      for (let i = 0, ii = styles.length; i < ii; ++i) {\n        loading =\n          renderFeature(\n            builderGroup,\n            feature,\n            styles[i],\n            squaredTolerance,\n            this.boundHandleStyleImageChange_,\n            transform,\n            declutterBuilderGroup\n          ) || loading;\n      }\n    } else {\n      loading = renderFeature(\n        builderGroup,\n        feature,\n        styles,\n        squaredTolerance,\n        this.boundHandleStyleImageChange_,\n        transform,\n        declutterBuilderGroup\n      );\n    }\n    return loading;\n  }\n}\n\nexport default CanvasVectorLayerRenderer;\n","/**\n * @module ol/layer/Vector\n */\nimport BaseVectorLayer from './BaseVector.js';\nimport CanvasVectorLayerRenderer from '../renderer/canvas/VectorLayer.js';\n\n/**\n * @classdesc\n * Vector data is rendered client-side, as vectors. This layer type provides most accurate rendering\n * even during animations. Points and labels stay upright on rotated views. For very large\n * amounts of vector data, performance may suffer during pan and zoom animations. In this case,\n * try {@link module:ol/layer/VectorImage~VectorImageLayer}.\n *\n * Note that any property set in the options is set as a {@link module:ol/Object~BaseObject}\n * property on the layer object; for example, setting `title: 'My Title'` in the\n * options means that `title` is observable, and has get/set accessors.\n *\n * @template {import(\"../source/Vector.js\").default} VectorSourceType\n * @extends {BaseVectorLayer<VectorSourceType, CanvasVectorLayerRenderer>}\n * @api\n */\nclass VectorLayer extends BaseVectorLayer {\n  /**\n   * @param {import(\"./BaseVector.js\").Options<VectorSourceType>} [options] Options.\n   */\n  constructor(options) {\n    super(options);\n  }\n\n  createRenderer() {\n    return new CanvasVectorLayerRenderer(this);\n  }\n}\n\nexport default VectorLayer;\n","/**\n * @module ol/structs/RBush\n */\nimport RBush_ from 'rbush';\nimport {createOrUpdate, equals} from '../extent.js';\nimport {getUid} from '../util.js';\nimport {isEmpty} from '../obj.js';\n\n/**\n * @typedef {Object} Entry\n * @property {number} minX MinX.\n * @property {number} minY MinY.\n * @property {number} maxX MaxX.\n * @property {number} maxY MaxY.\n * @property {Object} [value] Value.\n */\n\n/**\n * @classdesc\n * Wrapper around the RBush by Vladimir Agafonkin.\n * See https://github.com/mourner/rbush.\n *\n * @template T\n */\nclass RBush {\n  /**\n   * @param {number} [maxEntries] Max entries.\n   */\n  constructor(maxEntries) {\n    /**\n     * @private\n     */\n    this.rbush_ = new RBush_(maxEntries);\n\n    /**\n     * A mapping between the objects added to this rbush wrapper\n     * and the objects that are actually added to the internal rbush.\n     * @private\n     * @type {Object<string, Entry>}\n     */\n    this.items_ = {};\n  }\n\n  /**\n   * Insert a value into the RBush.\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {T} value Value.\n   */\n  insert(extent, value) {\n    /** @type {Entry} */\n    const item = {\n      minX: extent[0],\n      minY: extent[1],\n      maxX: extent[2],\n      maxY: extent[3],\n      value: value,\n    };\n\n    this.rbush_.insert(item);\n    this.items_[getUid(value)] = item;\n  }\n\n  /**\n   * Bulk-insert values into the RBush.\n   * @param {Array<import(\"../extent.js\").Extent>} extents Extents.\n   * @param {Array<T>} values Values.\n   */\n  load(extents, values) {\n    const items = new Array(values.length);\n    for (let i = 0, l = values.length; i < l; i++) {\n      const extent = extents[i];\n      const value = values[i];\n\n      /** @type {Entry} */\n      const item = {\n        minX: extent[0],\n        minY: extent[1],\n        maxX: extent[2],\n        maxY: extent[3],\n        value: value,\n      };\n      items[i] = item;\n      this.items_[getUid(value)] = item;\n    }\n    this.rbush_.load(items);\n  }\n\n  /**\n   * Remove a value from the RBush.\n   * @param {T} value Value.\n   * @return {boolean} Removed.\n   */\n  remove(value) {\n    const uid = getUid(value);\n\n    // get the object in which the value was wrapped when adding to the\n    // internal rbush. then use that object to do the removal.\n    const item = this.items_[uid];\n    delete this.items_[uid];\n    return this.rbush_.remove(item) !== null;\n  }\n\n  /**\n   * Update the extent of a value in the RBush.\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {T} value Value.\n   */\n  update(extent, value) {\n    const item = this.items_[getUid(value)];\n    const bbox = [item.minX, item.minY, item.maxX, item.maxY];\n    if (!equals(bbox, extent)) {\n      this.remove(value);\n      this.insert(extent, value);\n    }\n  }\n\n  /**\n   * Return all values in the RBush.\n   * @return {Array<T>} All.\n   */\n  getAll() {\n    const items = this.rbush_.all();\n    return items.map(function (item) {\n      return item.value;\n    });\n  }\n\n  /**\n   * Return all values in the given extent.\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @return {Array<T>} All in extent.\n   */\n  getInExtent(extent) {\n    /** @type {Entry} */\n    const bbox = {\n      minX: extent[0],\n      minY: extent[1],\n      maxX: extent[2],\n      maxY: extent[3],\n    };\n    const items = this.rbush_.search(bbox);\n    return items.map(function (item) {\n      return item.value;\n    });\n  }\n\n  /**\n   * Calls a callback function with each value in the tree.\n   * If the callback returns a truthy value, this value is returned without\n   * checking the rest of the tree.\n   * @param {function(T): *} callback Callback.\n   * @return {*} Callback return value.\n   */\n  forEach(callback) {\n    return this.forEach_(this.getAll(), callback);\n  }\n\n  /**\n   * Calls a callback function with each value in the provided extent.\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {function(T): *} callback Callback.\n   * @return {*} Callback return value.\n   */\n  forEachInExtent(extent, callback) {\n    return this.forEach_(this.getInExtent(extent), callback);\n  }\n\n  /**\n   * @param {Array<T>} values Values.\n   * @param {function(T): *} callback Callback.\n   * @private\n   * @return {*} Callback return value.\n   */\n  forEach_(values, callback) {\n    let result;\n    for (let i = 0, l = values.length; i < l; i++) {\n      result = callback(values[i]);\n      if (result) {\n        return result;\n      }\n    }\n    return result;\n  }\n\n  /**\n   * @return {boolean} Is empty.\n   */\n  isEmpty() {\n    return isEmpty(this.items_);\n  }\n\n  /**\n   * Remove all values from the RBush.\n   */\n  clear() {\n    this.rbush_.clear();\n    this.items_ = {};\n  }\n\n  /**\n   * @param {import(\"../extent.js\").Extent} [extent] Extent.\n   * @return {import(\"../extent.js\").Extent} Extent.\n   */\n  getExtent(extent) {\n    const data = this.rbush_.toJSON();\n    return createOrUpdate(data.minX, data.minY, data.maxX, data.maxY, extent);\n  }\n\n  /**\n   * @param {RBush} rbush R-Tree.\n   */\n  concat(rbush) {\n    this.rbush_.load(rbush.rbush_.all());\n    for (const i in rbush.items_) {\n      this.items_[i] = rbush.items_[i];\n    }\n  }\n}\n\nexport default RBush;\n","/**\n * @module ol/source/VectorEventType\n */\n\n/**\n * @enum {string}\n */\nexport default {\n  /**\n   * Triggered when a feature is added to the source.\n   * @event module:ol/source/Vector.VectorSourceEvent#addfeature\n   * @api\n   */\n  ADDFEATURE: 'addfeature',\n\n  /**\n   * Triggered when a feature is updated.\n   * @event module:ol/source/Vector.VectorSourceEvent#changefeature\n   * @api\n   */\n  CHANGEFEATURE: 'changefeature',\n\n  /**\n   * Triggered when the clear method is called on the source.\n   * @event module:ol/source/Vector.VectorSourceEvent#clear\n   * @api\n   */\n  CLEAR: 'clear',\n\n  /**\n   * Triggered when a feature is removed from the source.\n   * See {@link module:ol/source/Vector~VectorSource#clear source.clear()} for exceptions.\n   * @event module:ol/source/Vector.VectorSourceEvent#removefeature\n   * @api\n   */\n  REMOVEFEATURE: 'removefeature',\n\n  /**\n   * Triggered when features starts loading.\n   * @event module:ol/source/Vector.VectorSourceEvent#featuresloadstart\n   * @api\n   */\n  FEATURESLOADSTART: 'featuresloadstart',\n\n  /**\n   * Triggered when features finishes loading.\n   * @event module:ol/source/Vector.VectorSourceEvent#featuresloadend\n   * @api\n   */\n  FEATURESLOADEND: 'featuresloadend',\n\n  /**\n   * Triggered if feature loading results in an error.\n   * @event module:ol/source/Vector.VectorSourceEvent#featuresloaderror\n   * @api\n   */\n  FEATURESLOADERROR: 'featuresloaderror',\n};\n\n/**\n * @typedef {'addfeature'|'changefeature'|'clear'|'removefeature'|'featuresloadstart'|'featuresloadend'|'featuresloaderror'} VectorSourceEventTypes\n */\n","/**\n * @module ol/loadingstrategy\n */\n\nimport {fromUserExtent, fromUserResolution, toUserExtent} from './proj.js';\n\n/**\n * Strategy function for loading all features with a single request.\n * @param {import(\"./extent.js\").Extent} extent Extent.\n * @param {number} resolution Resolution.\n * @return {Array<import(\"./extent.js\").Extent>} Extents.\n * @api\n */\nexport function all(extent, resolution) {\n  return [[-Infinity, -Infinity, Infinity, Infinity]];\n}\n\n/**\n * Strategy function for loading features based on the view's extent and\n * resolution.\n * @param {import(\"./extent.js\").Extent} extent Extent.\n * @param {number} resolution Resolution.\n * @return {Array<import(\"./extent.js\").Extent>} Extents.\n * @api\n */\nexport function bbox(extent, resolution) {\n  return [extent];\n}\n\n/**\n * Creates a strategy function for loading features based on a tile grid.\n * @param {import(\"./tilegrid/TileGrid.js\").default} tileGrid Tile grid.\n * @return {function(import(\"./extent.js\").Extent, number, import(\"./proj.js\").Projection): Array<import(\"./extent.js\").Extent>} Loading strategy.\n * @api\n */\nexport function tile(tileGrid) {\n  return (\n    /**\n     * @param {import(\"./extent.js\").Extent} extent Extent.\n     * @param {number} resolution Resolution.\n     * @param {import(\"./proj.js\").Projection} projection Projection.\n     * @return {Array<import(\"./extent.js\").Extent>} Extents.\n     */\n    function (extent, resolution, projection) {\n      const z = tileGrid.getZForResolution(\n        fromUserResolution(resolution, projection)\n      );\n      const tileRange = tileGrid.getTileRangeForExtentAndZ(\n        fromUserExtent(extent, projection),\n        z\n      );\n      /** @type {Array<import(\"./extent.js\").Extent>} */\n      const extents = [];\n      /** @type {import(\"./tilecoord.js\").TileCoord} */\n      const tileCoord = [z, 0, 0];\n      for (\n        tileCoord[1] = tileRange.minX;\n        tileCoord[1] <= tileRange.maxX;\n        ++tileCoord[1]\n      ) {\n        for (\n          tileCoord[2] = tileRange.minY;\n          tileCoord[2] <= tileRange.maxY;\n          ++tileCoord[2]\n        ) {\n          extents.push(\n            toUserExtent(tileGrid.getTileCoordExtent(tileCoord), projection)\n          );\n        }\n      }\n      return extents;\n    }\n  );\n}\n","/**\n * @module ol/source/Vector\n */\n\nimport Collection from '../Collection.js';\nimport CollectionEventType from '../CollectionEventType.js';\nimport Event from '../events/Event.js';\nimport EventType from '../events/EventType.js';\nimport ObjectEventType from '../ObjectEventType.js';\nimport RBush from '../structs/RBush.js';\nimport Source from './Source.js';\nimport VectorEventType from './VectorEventType.js';\nimport {TRUE, VOID} from '../functions.js';\nimport {all as allStrategy} from '../loadingstrategy.js';\nimport {assert} from '../asserts.js';\nimport {containsExtent, equals, wrapAndSliceX} from '../extent.js';\nimport {extend} from '../array.js';\nimport {getUid} from '../util.js';\nimport {isEmpty} from '../obj.js';\nimport {listen, unlistenByKey} from '../events.js';\nimport {xhr} from '../featureloader.js';\n\n/**\n * A function that takes an {@link module:ol/extent~Extent} and a resolution as arguments, and\n * returns an array of {@link module:ol/extent~Extent} with the extents to load. Usually this\n * is one of the standard {@link module:ol/loadingstrategy} strategies.\n *\n * @typedef {function(import(\"../extent.js\").Extent, number, import(\"../proj/Projection.js\").default): Array<import(\"../extent.js\").Extent>} LoadingStrategy\n * @api\n */\n\n/**\n * @classdesc\n * Events emitted by {@link module:ol/source/Vector~VectorSource} instances are instances of this\n * type.\n * @template {import(\"../geom/Geometry.js\").default} [Geometry=import(\"../geom/Geometry.js\").default]\n */\nexport class VectorSourceEvent extends Event {\n  /**\n   * @param {string} type Type.\n   * @param {import(\"../Feature.js\").default<Geometry>} [feature] Feature.\n   * @param {Array<import(\"../Feature.js\").default<Geometry>>} [features] Features.\n   */\n  constructor(type, feature, features) {\n    super(type);\n\n    /**\n     * The added or removed feature for the `ADDFEATURE` and `REMOVEFEATURE` events, `undefined` otherwise.\n     * @type {import(\"../Feature.js\").default<Geometry>|undefined}\n     * @api\n     */\n    this.feature = feature;\n\n    /**\n     * The loaded features for the `FEATURESLOADED` event, `undefined` otherwise.\n     * @type {Array<import(\"../Feature.js\").default<Geometry>>|undefined}\n     * @api\n     */\n    this.features = features;\n  }\n}\n\n/***\n * @template Return\n * @typedef {import(\"../Observable\").OnSignature<import(\"../Observable\").EventTypes, import(\"../events/Event.js\").default, Return> &\n *   import(\"../Observable\").OnSignature<import(\"../ObjectEventType\").Types, import(\"../Object\").ObjectEvent, Return> &\n *   import(\"../Observable\").OnSignature<import(\"./VectorEventType\").VectorSourceEventTypes, VectorSourceEvent, Return> &\n *   import(\"../Observable\").CombinedOnSignature<import(\"../Observable\").EventTypes|import(\"../ObjectEventType\").Types|\n *     import(\"./VectorEventType\").VectorSourceEventTypes, Return>} VectorSourceOnSignature\n */\n\n/**\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {Array<import(\"../Feature.js\").default<Geometry>>|Collection<import(\"../Feature.js\").default<Geometry>>} [features]\n * Features. If provided as {@link module:ol/Collection~Collection}, the features in the source\n * and the collection will stay in sync.\n * @property {import(\"../format/Feature.js\").default} [format] The feature format used by the XHR\n * feature loader when `url` is set. Required if `url` is set, otherwise ignored.\n * @property {import(\"../featureloader.js\").FeatureLoader} [loader]\n * The loader function used to load features, from a remote source for example.\n * If this is not set and `url` is set, the source will create and use an XHR\n * feature loader. The `'featuresloadend'` and `'featuresloaderror'` events\n * will only fire if the `success` and `failure` callbacks are used.\n *\n * Example:\n *\n * ```js\n * import Vector from 'ol/source/Vector.js';\n * import GeoJSON from 'ol/format/GeoJSON.js';\n * import {bbox} from 'ol/loadingstrategy.js';\n *\n * const vectorSource = new Vector({\n *   format: new GeoJSON(),\n *   loader: function(extent, resolution, projection, success, failure) {\n *      const proj = projection.getCode();\n *      const url = 'https://ahocevar.com/geoserver/wfs?service=WFS&' +\n *          'version=1.1.0&request=GetFeature&typename=osm:water_areas&' +\n *          'outputFormat=application/json&srsname=' + proj + '&' +\n *          'bbox=' + extent.join(',') + ',' + proj;\n *      const xhr = new XMLHttpRequest();\n *      xhr.open('GET', url);\n *      const onError = function() {\n *        vectorSource.removeLoadedExtent(extent);\n *        failure();\n *      }\n *      xhr.onerror = onError;\n *      xhr.onload = function() {\n *        if (xhr.status == 200) {\n *          const features = vectorSource.getFormat().readFeatures(xhr.responseText);\n *          vectorSource.addFeatures(features);\n *          success(features);\n *        } else {\n *          onError();\n *        }\n *      }\n *      xhr.send();\n *    },\n *    strategy: bbox,\n *  });\n * ```\n * @property {boolean} [overlaps=true] This source may have overlapping geometries.\n * Setting this to `false` (e.g. for sources with polygons that represent administrative\n * boundaries or TopoJSON sources) allows the renderer to optimise fill and\n * stroke operations.\n * @property {LoadingStrategy} [strategy] The loading strategy to use.\n * By default an {@link module:ol/loadingstrategy.all}\n * strategy is used, a one-off strategy which loads all features at once.\n * @property {string|import(\"../featureloader.js\").FeatureUrlFunction} [url]\n * Setting this option instructs the source to load features using an XHR loader\n * (see {@link module:ol/featureloader.xhr}). Use a `string` and an\n * {@link module:ol/loadingstrategy.all} for a one-off download of all features from\n * the given URL. Use a {@link module:ol/featureloader~FeatureUrlFunction} to generate the url with\n * other loading strategies.\n * Requires `format` to be set as well.\n * When default XHR feature loader is provided, the features will\n * be transformed from the data projection to the view projection\n * during parsing. If your remote data source does not advertise its projection\n * properly, this transformation will be incorrect. For some formats, the\n * default projection (usually EPSG:4326) can be overridden by setting the\n * dataProjection constructor option on the format.\n * Note that if a source contains non-feature data, such as a GeoJSON geometry\n * or a KML NetworkLink, these will be ignored. Use a custom loader to load these.\n * @property {boolean} [useSpatialIndex=true]\n * By default, an RTree is used as spatial index. When features are removed and\n * added frequently, and the total number of features is low, setting this to\n * `false` may improve performance.\n *\n * Note that\n * {@link module:ol/source/Vector~VectorSource#getFeaturesInExtent},\n * {@link module:ol/source/Vector~VectorSource#getClosestFeatureToCoordinate} and\n * {@link module:ol/source/Vector~VectorSource#getExtent} cannot be used when `useSpatialIndex` is\n * set to `false`, and {@link module:ol/source/Vector~VectorSource#forEachFeatureInExtent} will loop\n * through all features.\n *\n * When set to `false`, the features will be maintained in an\n * {@link module:ol/Collection~Collection}, which can be retrieved through\n * {@link module:ol/source/Vector~VectorSource#getFeaturesCollection}.\n * @property {boolean} [wrapX=true] Wrap the world horizontally. For vector editing across the\n * -180° and 180° meridians to work properly, this should be set to `false`. The\n * resulting geometry coordinates will then exceed the world bounds.\n * @template {import(\"../geom/Geometry.js\").default} [Geometry=import(\"../geom/Geometry.js\").default]\n */\n\n/**\n * @classdesc\n * Provides a source of features for vector layers. Vector features provided\n * by this source are suitable for editing. See {@link module:ol/source/VectorTile~VectorTile} for\n * vector data that is optimized for rendering.\n *\n * @fires VectorSourceEvent\n * @api\n * @template {import(\"../geom/Geometry.js\").default} [Geometry=import(\"../geom/Geometry.js\").default]\n */\nclass VectorSource extends Source {\n  /**\n   * @param {Options<Geometry>} [options] Vector source options.\n   */\n  constructor(options) {\n    options = options || {};\n\n    super({\n      attributions: options.attributions,\n      interpolate: true,\n      projection: undefined,\n      state: 'ready',\n      wrapX: options.wrapX !== undefined ? options.wrapX : true,\n    });\n\n    /***\n     * @type {VectorSourceOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.on;\n\n    /***\n     * @type {VectorSourceOnSignature<import(\"../events\").EventsKey>}\n     */\n    this.once;\n\n    /***\n     * @type {VectorSourceOnSignature<void>}\n     */\n    this.un;\n\n    /**\n     * @private\n     * @type {import(\"../featureloader.js\").FeatureLoader}\n     */\n    this.loader_ = VOID;\n\n    /**\n     * @private\n     * @type {import(\"../format/Feature.js\").default|undefined}\n     */\n    this.format_ = options.format;\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.overlaps_ = options.overlaps === undefined ? true : options.overlaps;\n\n    /**\n     * @private\n     * @type {string|import(\"../featureloader.js\").FeatureUrlFunction|undefined}\n     */\n    this.url_ = options.url;\n\n    if (options.loader !== undefined) {\n      this.loader_ = options.loader;\n    } else if (this.url_ !== undefined) {\n      assert(this.format_, 7); // `format` must be set when `url` is set\n      // create a XHR feature loader for \"url\" and \"format\"\n      this.loader_ = xhr(\n        this.url_,\n        /** @type {import(\"../format/Feature.js\").default} */ (this.format_)\n      );\n    }\n\n    /**\n     * @private\n     * @type {LoadingStrategy}\n     */\n    this.strategy_ =\n      options.strategy !== undefined ? options.strategy : allStrategy;\n\n    const useSpatialIndex =\n      options.useSpatialIndex !== undefined ? options.useSpatialIndex : true;\n\n    /**\n     * @private\n     * @type {RBush<import(\"../Feature.js\").default<Geometry>>}\n     */\n    this.featuresRtree_ = useSpatialIndex ? new RBush() : null;\n\n    /**\n     * @private\n     * @type {RBush<{extent: import(\"../extent.js\").Extent}>}\n     */\n    this.loadedExtentsRtree_ = new RBush();\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.loadingExtentsCount_ = 0;\n\n    /**\n     * @private\n     * @type {!Object<string, import(\"../Feature.js\").default<Geometry>>}\n     */\n    this.nullGeometryFeatures_ = {};\n\n    /**\n     * A lookup of features by id (the return from feature.getId()).\n     * @private\n     * @type {!Object<string, import(\"../Feature.js\").default<Geometry>>}\n     */\n    this.idIndex_ = {};\n\n    /**\n     * A lookup of features by uid (using getUid(feature)).\n     * @private\n     * @type {!Object<string, import(\"../Feature.js\").default<Geometry>>}\n     */\n    this.uidIndex_ = {};\n\n    /**\n     * @private\n     * @type {Object<string, Array<import(\"../events.js\").EventsKey>>}\n     */\n    this.featureChangeKeys_ = {};\n\n    /**\n     * @private\n     * @type {Collection<import(\"../Feature.js\").default<Geometry>>|null}\n     */\n    this.featuresCollection_ = null;\n\n    /** @type {Collection<import(\"../Feature.js\").default<Geometry>>} */\n    let collection;\n    /** @type {Array<import(\"../Feature.js\").default<Geometry>>} */\n    let features;\n    if (Array.isArray(options.features)) {\n      features = options.features;\n    } else if (options.features) {\n      collection = options.features;\n      features = collection.getArray();\n    }\n    if (!useSpatialIndex && collection === undefined) {\n      collection = new Collection(features);\n    }\n    if (features !== undefined) {\n      this.addFeaturesInternal(features);\n    }\n    if (collection !== undefined) {\n      this.bindFeaturesCollection_(collection);\n    }\n  }\n\n  /**\n   * Add a single feature to the source.  If you want to add a batch of features\n   * at once, call {@link module:ol/source/Vector~VectorSource#addFeatures #addFeatures()}\n   * instead. A feature will not be added to the source if feature with\n   * the same id is already there. The reason for this behavior is to avoid\n   * feature duplication when using bbox or tile loading strategies.\n   * Note: this also applies if an {@link module:ol/Collection~Collection} is used for features,\n   * meaning that if a feature with a duplicate id is added in the collection, it will\n   * be removed from it right away.\n   * @param {import(\"../Feature.js\").default<Geometry>} feature Feature to add.\n   * @api\n   */\n  addFeature(feature) {\n    this.addFeatureInternal(feature);\n    this.changed();\n  }\n\n  /**\n   * Add a feature without firing a `change` event.\n   * @param {import(\"../Feature.js\").default<Geometry>} feature Feature.\n   * @protected\n   */\n  addFeatureInternal(feature) {\n    const featureKey = getUid(feature);\n\n    if (!this.addToIndex_(featureKey, feature)) {\n      if (this.featuresCollection_) {\n        this.featuresCollection_.remove(feature);\n      }\n      return;\n    }\n\n    this.setupChangeEvents_(featureKey, feature);\n\n    const geometry = feature.getGeometry();\n    if (geometry) {\n      const extent = geometry.getExtent();\n      if (this.featuresRtree_) {\n        this.featuresRtree_.insert(extent, feature);\n      }\n    } else {\n      this.nullGeometryFeatures_[featureKey] = feature;\n    }\n\n    this.dispatchEvent(\n      new VectorSourceEvent(VectorEventType.ADDFEATURE, feature)\n    );\n  }\n\n  /**\n   * @param {string} featureKey Unique identifier for the feature.\n   * @param {import(\"../Feature.js\").default<Geometry>} feature The feature.\n   * @private\n   */\n  setupChangeEvents_(featureKey, feature) {\n    this.featureChangeKeys_[featureKey] = [\n      listen(feature, EventType.CHANGE, this.handleFeatureChange_, this),\n      listen(\n        feature,\n        ObjectEventType.PROPERTYCHANGE,\n        this.handleFeatureChange_,\n        this\n      ),\n    ];\n  }\n\n  /**\n   * @param {string} featureKey Unique identifier for the feature.\n   * @param {import(\"../Feature.js\").default<Geometry>} feature The feature.\n   * @return {boolean} The feature is \"valid\", in the sense that it is also a\n   *     candidate for insertion into the Rtree.\n   * @private\n   */\n  addToIndex_(featureKey, feature) {\n    let valid = true;\n    const id = feature.getId();\n    if (id !== undefined) {\n      if (!(id.toString() in this.idIndex_)) {\n        this.idIndex_[id.toString()] = feature;\n      } else {\n        valid = false;\n      }\n    }\n    if (valid) {\n      assert(!(featureKey in this.uidIndex_), 30); // The passed `feature` was already added to the source\n      this.uidIndex_[featureKey] = feature;\n    }\n    return valid;\n  }\n\n  /**\n   * Add a batch of features to the source.\n   * @param {Array<import(\"../Feature.js\").default<Geometry>>} features Features to add.\n   * @api\n   */\n  addFeatures(features) {\n    this.addFeaturesInternal(features);\n    this.changed();\n  }\n\n  /**\n   * Add features without firing a `change` event.\n   * @param {Array<import(\"../Feature.js\").default<Geometry>>} features Features.\n   * @protected\n   */\n  addFeaturesInternal(features) {\n    const extents = [];\n    const newFeatures = [];\n    const geometryFeatures = [];\n\n    for (let i = 0, length = features.length; i < length; i++) {\n      const feature = features[i];\n      const featureKey = getUid(feature);\n      if (this.addToIndex_(featureKey, feature)) {\n        newFeatures.push(feature);\n      }\n    }\n\n    for (let i = 0, length = newFeatures.length; i < length; i++) {\n      const feature = newFeatures[i];\n      const featureKey = getUid(feature);\n      this.setupChangeEvents_(featureKey, feature);\n\n      const geometry = feature.getGeometry();\n      if (geometry) {\n        const extent = geometry.getExtent();\n        extents.push(extent);\n        geometryFeatures.push(feature);\n      } else {\n        this.nullGeometryFeatures_[featureKey] = feature;\n      }\n    }\n    if (this.featuresRtree_) {\n      this.featuresRtree_.load(extents, geometryFeatures);\n    }\n\n    if (this.hasListener(VectorEventType.ADDFEATURE)) {\n      for (let i = 0, length = newFeatures.length; i < length; i++) {\n        this.dispatchEvent(\n          new VectorSourceEvent(VectorEventType.ADDFEATURE, newFeatures[i])\n        );\n      }\n    }\n  }\n\n  /**\n   * @param {!Collection<import(\"../Feature.js\").default<Geometry>>} collection Collection.\n   * @private\n   */\n  bindFeaturesCollection_(collection) {\n    let modifyingCollection = false;\n    this.addEventListener(\n      VectorEventType.ADDFEATURE,\n      /**\n       * @param {VectorSourceEvent<Geometry>} evt The vector source event\n       */\n      function (evt) {\n        if (!modifyingCollection) {\n          modifyingCollection = true;\n          collection.push(evt.feature);\n          modifyingCollection = false;\n        }\n      }\n    );\n    this.addEventListener(\n      VectorEventType.REMOVEFEATURE,\n      /**\n       * @param {VectorSourceEvent<Geometry>} evt The vector source event\n       */\n      function (evt) {\n        if (!modifyingCollection) {\n          modifyingCollection = true;\n          collection.remove(evt.feature);\n          modifyingCollection = false;\n        }\n      }\n    );\n    collection.addEventListener(\n      CollectionEventType.ADD,\n      /**\n       * @param {import(\"../Collection.js\").CollectionEvent<import(\"../Feature.js\").default<Geometry>>} evt The collection event\n       */\n      (evt) => {\n        if (!modifyingCollection) {\n          modifyingCollection = true;\n          this.addFeature(evt.element);\n          modifyingCollection = false;\n        }\n      }\n    );\n    collection.addEventListener(\n      CollectionEventType.REMOVE,\n      /**\n       * @param {import(\"../Collection.js\").CollectionEvent<import(\"../Feature.js\").default<Geometry>>} evt The collection event\n       */\n      (evt) => {\n        if (!modifyingCollection) {\n          modifyingCollection = true;\n          this.removeFeature(evt.element);\n          modifyingCollection = false;\n        }\n      }\n    );\n    this.featuresCollection_ = collection;\n  }\n\n  /**\n   * Remove all features from the source.\n   * @param {boolean} [fast] Skip dispatching of {@link module:ol/source/Vector.VectorSourceEvent#event:removefeature} events.\n   * @api\n   */\n  clear(fast) {\n    if (fast) {\n      for (const featureId in this.featureChangeKeys_) {\n        const keys = this.featureChangeKeys_[featureId];\n        keys.forEach(unlistenByKey);\n      }\n      if (!this.featuresCollection_) {\n        this.featureChangeKeys_ = {};\n        this.idIndex_ = {};\n        this.uidIndex_ = {};\n      }\n    } else {\n      if (this.featuresRtree_) {\n        const removeAndIgnoreReturn = (feature) => {\n          this.removeFeatureInternal(feature);\n        };\n        this.featuresRtree_.forEach(removeAndIgnoreReturn);\n        for (const id in this.nullGeometryFeatures_) {\n          this.removeFeatureInternal(this.nullGeometryFeatures_[id]);\n        }\n      }\n    }\n    if (this.featuresCollection_) {\n      this.featuresCollection_.clear();\n    }\n\n    if (this.featuresRtree_) {\n      this.featuresRtree_.clear();\n    }\n    this.nullGeometryFeatures_ = {};\n\n    const clearEvent = new VectorSourceEvent(VectorEventType.CLEAR);\n    this.dispatchEvent(clearEvent);\n    this.changed();\n  }\n\n  /**\n   * Iterate through all features on the source, calling the provided callback\n   * with each one.  If the callback returns any \"truthy\" value, iteration will\n   * stop and the function will return the same value.\n   * Note: this function only iterate through the feature that have a defined geometry.\n   *\n   * @param {function(import(\"../Feature.js\").default<Geometry>): T} callback Called with each feature\n   *     on the source.  Return a truthy value to stop iteration.\n   * @return {T|undefined} The return value from the last call to the callback.\n   * @template T\n   * @api\n   */\n  forEachFeature(callback) {\n    if (this.featuresRtree_) {\n      return this.featuresRtree_.forEach(callback);\n    } else if (this.featuresCollection_) {\n      this.featuresCollection_.forEach(callback);\n    }\n  }\n\n  /**\n   * Iterate through all features whose geometries contain the provided\n   * coordinate, calling the callback with each feature.  If the callback returns\n   * a \"truthy\" value, iteration will stop and the function will return the same\n   * value.\n   *\n   * @param {import(\"../coordinate.js\").Coordinate} coordinate Coordinate.\n   * @param {function(import(\"../Feature.js\").default<Geometry>): T} callback Called with each feature\n   *     whose goemetry contains the provided coordinate.\n   * @return {T|undefined} The return value from the last call to the callback.\n   * @template T\n   */\n  forEachFeatureAtCoordinateDirect(coordinate, callback) {\n    const extent = [coordinate[0], coordinate[1], coordinate[0], coordinate[1]];\n    return this.forEachFeatureInExtent(extent, function (feature) {\n      const geometry = feature.getGeometry();\n      if (geometry.intersectsCoordinate(coordinate)) {\n        return callback(feature);\n      }\n      return undefined;\n    });\n  }\n\n  /**\n   * Iterate through all features whose bounding box intersects the provided\n   * extent (note that the feature's geometry may not intersect the extent),\n   * calling the callback with each feature.  If the callback returns a \"truthy\"\n   * value, iteration will stop and the function will return the same value.\n   *\n   * If you are interested in features whose geometry intersects an extent, call\n   * the {@link module:ol/source/Vector~VectorSource#forEachFeatureIntersectingExtent #forEachFeatureIntersectingExtent()} method instead.\n   *\n   * When `useSpatialIndex` is set to false, this method will loop through all\n   * features, equivalent to {@link module:ol/source/Vector~VectorSource#forEachFeature #forEachFeature()}.\n   *\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {function(import(\"../Feature.js\").default<Geometry>): T} callback Called with each feature\n   *     whose bounding box intersects the provided extent.\n   * @return {T|undefined} The return value from the last call to the callback.\n   * @template T\n   * @api\n   */\n  forEachFeatureInExtent(extent, callback) {\n    if (this.featuresRtree_) {\n      return this.featuresRtree_.forEachInExtent(extent, callback);\n    } else if (this.featuresCollection_) {\n      this.featuresCollection_.forEach(callback);\n    }\n  }\n\n  /**\n   * Iterate through all features whose geometry intersects the provided extent,\n   * calling the callback with each feature.  If the callback returns a \"truthy\"\n   * value, iteration will stop and the function will return the same value.\n   *\n   * If you only want to test for bounding box intersection, call the\n   * {@link module:ol/source/Vector~VectorSource#forEachFeatureInExtent #forEachFeatureInExtent()} method instead.\n   *\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {function(import(\"../Feature.js\").default<Geometry>): T} callback Called with each feature\n   *     whose geometry intersects the provided extent.\n   * @return {T|undefined} The return value from the last call to the callback.\n   * @template T\n   * @api\n   */\n  forEachFeatureIntersectingExtent(extent, callback) {\n    return this.forEachFeatureInExtent(\n      extent,\n      /**\n       * @param {import(\"../Feature.js\").default<Geometry>} feature Feature.\n       * @return {T|undefined} The return value from the last call to the callback.\n       */\n      function (feature) {\n        const geometry = feature.getGeometry();\n        if (geometry.intersectsExtent(extent)) {\n          const result = callback(feature);\n          if (result) {\n            return result;\n          }\n        }\n      }\n    );\n  }\n\n  /**\n   * Get the features collection associated with this source. Will be `null`\n   * unless the source was configured with `useSpatialIndex` set to `false`, or\n   * with an {@link module:ol/Collection~Collection} as `features`.\n   * @return {Collection<import(\"../Feature.js\").default<Geometry>>|null} The collection of features.\n   * @api\n   */\n  getFeaturesCollection() {\n    return this.featuresCollection_;\n  }\n\n  /**\n   * Get a snapshot of the features currently on the source in random order. The returned array\n   * is a copy, the features are references to the features in the source.\n   * @return {Array<import(\"../Feature.js\").default<Geometry>>} Features.\n   * @api\n   */\n  getFeatures() {\n    let features;\n    if (this.featuresCollection_) {\n      features = this.featuresCollection_.getArray().slice(0);\n    } else if (this.featuresRtree_) {\n      features = this.featuresRtree_.getAll();\n      if (!isEmpty(this.nullGeometryFeatures_)) {\n        extend(features, Object.values(this.nullGeometryFeatures_));\n      }\n    }\n    return /** @type {Array<import(\"../Feature.js\").default<Geometry>>} */ (\n      features\n    );\n  }\n\n  /**\n   * Get all features whose geometry intersects the provided coordinate.\n   * @param {import(\"../coordinate.js\").Coordinate} coordinate Coordinate.\n   * @return {Array<import(\"../Feature.js\").default<Geometry>>} Features.\n   * @api\n   */\n  getFeaturesAtCoordinate(coordinate) {\n    const features = [];\n    this.forEachFeatureAtCoordinateDirect(coordinate, function (feature) {\n      features.push(feature);\n    });\n    return features;\n  }\n\n  /**\n   * Get all features whose bounding box intersects the provided extent.  Note that this returns an array of\n   * all features intersecting the given extent in random order (so it may include\n   * features whose geometries do not intersect the extent).\n   *\n   * When `useSpatialIndex` is set to false, this method will return all\n   * features.\n   *\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {import(\"../proj/Projection.js\").default} [projection] Include features\n   * where `extent` exceeds the x-axis bounds of `projection` and wraps around the world.\n   * @return {Array<import(\"../Feature.js\").default<Geometry>>} Features.\n   * @api\n   */\n  getFeaturesInExtent(extent, projection) {\n    if (this.featuresRtree_) {\n      const multiWorld = projection && projection.canWrapX() && this.getWrapX();\n\n      if (!multiWorld) {\n        return this.featuresRtree_.getInExtent(extent);\n      }\n\n      const extents = wrapAndSliceX(extent, projection);\n\n      return [].concat(\n        ...extents.map((anExtent) => this.featuresRtree_.getInExtent(anExtent))\n      );\n    } else if (this.featuresCollection_) {\n      return this.featuresCollection_.getArray().slice(0);\n    }\n    return [];\n  }\n\n  /**\n   * Get the closest feature to the provided coordinate.\n   *\n   * This method is not available when the source is configured with\n   * `useSpatialIndex` set to `false`.\n   * @param {import(\"../coordinate.js\").Coordinate} coordinate Coordinate.\n   * @param {function(import(\"../Feature.js\").default<Geometry>):boolean} [filter] Feature filter function.\n   *     The filter function will receive one argument, the {@link module:ol/Feature~Feature feature}\n   *     and it should return a boolean value. By default, no filtering is made.\n   * @return {import(\"../Feature.js\").default<Geometry>} Closest feature.\n   * @api\n   */\n  getClosestFeatureToCoordinate(coordinate, filter) {\n    // Find the closest feature using branch and bound.  We start searching an\n    // infinite extent, and find the distance from the first feature found.  This\n    // becomes the closest feature.  We then compute a smaller extent which any\n    // closer feature must intersect.  We continue searching with this smaller\n    // extent, trying to find a closer feature.  Every time we find a closer\n    // feature, we update the extent being searched so that any even closer\n    // feature must intersect it.  We continue until we run out of features.\n    const x = coordinate[0];\n    const y = coordinate[1];\n    let closestFeature = null;\n    const closestPoint = [NaN, NaN];\n    let minSquaredDistance = Infinity;\n    const extent = [-Infinity, -Infinity, Infinity, Infinity];\n    filter = filter ? filter : TRUE;\n    this.featuresRtree_.forEachInExtent(\n      extent,\n      /**\n       * @param {import(\"../Feature.js\").default<Geometry>} feature Feature.\n       */\n      function (feature) {\n        if (filter(feature)) {\n          const geometry = feature.getGeometry();\n          const previousMinSquaredDistance = minSquaredDistance;\n          minSquaredDistance = geometry.closestPointXY(\n            x,\n            y,\n            closestPoint,\n            minSquaredDistance\n          );\n          if (minSquaredDistance < previousMinSquaredDistance) {\n            closestFeature = feature;\n            // This is sneaky.  Reduce the extent that it is currently being\n            // searched while the R-Tree traversal using this same extent object\n            // is still in progress.  This is safe because the new extent is\n            // strictly contained by the old extent.\n            const minDistance = Math.sqrt(minSquaredDistance);\n            extent[0] = x - minDistance;\n            extent[1] = y - minDistance;\n            extent[2] = x + minDistance;\n            extent[3] = y + minDistance;\n          }\n        }\n      }\n    );\n    return closestFeature;\n  }\n\n  /**\n   * Get the extent of the features currently in the source.\n   *\n   * This method is not available when the source is configured with\n   * `useSpatialIndex` set to `false`.\n   * @param {import(\"../extent.js\").Extent} [extent] Destination extent. If provided, no new extent\n   *     will be created. Instead, that extent's coordinates will be overwritten.\n   * @return {import(\"../extent.js\").Extent} Extent.\n   * @api\n   */\n  getExtent(extent) {\n    return this.featuresRtree_.getExtent(extent);\n  }\n\n  /**\n   * Get a feature by its identifier (the value returned by feature.getId()).\n   * Note that the index treats string and numeric identifiers as the same.  So\n   * `source.getFeatureById(2)` will return a feature with id `'2'` or `2`.\n   *\n   * @param {string|number} id Feature identifier.\n   * @return {import(\"../Feature.js\").default<Geometry>|null} The feature (or `null` if not found).\n   * @api\n   */\n  getFeatureById(id) {\n    const feature = this.idIndex_[id.toString()];\n    return feature !== undefined ? feature : null;\n  }\n\n  /**\n   * Get a feature by its internal unique identifier (using `getUid`).\n   *\n   * @param {string} uid Feature identifier.\n   * @return {import(\"../Feature.js\").default<Geometry>|null} The feature (or `null` if not found).\n   */\n  getFeatureByUid(uid) {\n    const feature = this.uidIndex_[uid];\n    return feature !== undefined ? feature : null;\n  }\n\n  /**\n   * Get the format associated with this source.\n   *\n   * @return {import(\"../format/Feature.js\").default|undefined} The feature format.\n   * @api\n   */\n  getFormat() {\n    return this.format_;\n  }\n\n  /**\n   * @return {boolean} The source can have overlapping geometries.\n   */\n  getOverlaps() {\n    return this.overlaps_;\n  }\n\n  /**\n   * Get the url associated with this source.\n   *\n   * @return {string|import(\"../featureloader.js\").FeatureUrlFunction|undefined} The url.\n   * @api\n   */\n  getUrl() {\n    return this.url_;\n  }\n\n  /**\n   * @param {Event} event Event.\n   * @private\n   */\n  handleFeatureChange_(event) {\n    const feature = /** @type {import(\"../Feature.js\").default<Geometry>} */ (\n      event.target\n    );\n    const featureKey = getUid(feature);\n    const geometry = feature.getGeometry();\n    if (!geometry) {\n      if (!(featureKey in this.nullGeometryFeatures_)) {\n        if (this.featuresRtree_) {\n          this.featuresRtree_.remove(feature);\n        }\n        this.nullGeometryFeatures_[featureKey] = feature;\n      }\n    } else {\n      const extent = geometry.getExtent();\n      if (featureKey in this.nullGeometryFeatures_) {\n        delete this.nullGeometryFeatures_[featureKey];\n        if (this.featuresRtree_) {\n          this.featuresRtree_.insert(extent, feature);\n        }\n      } else {\n        if (this.featuresRtree_) {\n          this.featuresRtree_.update(extent, feature);\n        }\n      }\n    }\n    const id = feature.getId();\n    if (id !== undefined) {\n      const sid = id.toString();\n      if (this.idIndex_[sid] !== feature) {\n        this.removeFromIdIndex_(feature);\n        this.idIndex_[sid] = feature;\n      }\n    } else {\n      this.removeFromIdIndex_(feature);\n      this.uidIndex_[featureKey] = feature;\n    }\n    this.changed();\n    this.dispatchEvent(\n      new VectorSourceEvent(VectorEventType.CHANGEFEATURE, feature)\n    );\n  }\n\n  /**\n   * Returns true if the feature is contained within the source.\n   * @param {import(\"../Feature.js\").default<Geometry>} feature Feature.\n   * @return {boolean} Has feature.\n   * @api\n   */\n  hasFeature(feature) {\n    const id = feature.getId();\n    if (id !== undefined) {\n      return id in this.idIndex_;\n    }\n    return getUid(feature) in this.uidIndex_;\n  }\n\n  /**\n   * @return {boolean} Is empty.\n   */\n  isEmpty() {\n    if (this.featuresRtree_) {\n      return (\n        this.featuresRtree_.isEmpty() && isEmpty(this.nullGeometryFeatures_)\n      );\n    }\n    if (this.featuresCollection_) {\n      return this.featuresCollection_.getLength() === 0;\n    }\n    return true;\n  }\n\n  /**\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {number} resolution Resolution.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   */\n  loadFeatures(extent, resolution, projection) {\n    const loadedExtentsRtree = this.loadedExtentsRtree_;\n    const extentsToLoad = this.strategy_(extent, resolution, projection);\n    for (let i = 0, ii = extentsToLoad.length; i < ii; ++i) {\n      const extentToLoad = extentsToLoad[i];\n      const alreadyLoaded = loadedExtentsRtree.forEachInExtent(\n        extentToLoad,\n        /**\n         * @param {{extent: import(\"../extent.js\").Extent}} object Object.\n         * @return {boolean} Contains.\n         */\n        function (object) {\n          return containsExtent(object.extent, extentToLoad);\n        }\n      );\n      if (!alreadyLoaded) {\n        ++this.loadingExtentsCount_;\n        this.dispatchEvent(\n          new VectorSourceEvent(VectorEventType.FEATURESLOADSTART)\n        );\n        this.loader_.call(\n          this,\n          extentToLoad,\n          resolution,\n          projection,\n          (features) => {\n            --this.loadingExtentsCount_;\n            this.dispatchEvent(\n              new VectorSourceEvent(\n                VectorEventType.FEATURESLOADEND,\n                undefined,\n                features\n              )\n            );\n          },\n          () => {\n            --this.loadingExtentsCount_;\n            this.dispatchEvent(\n              new VectorSourceEvent(VectorEventType.FEATURESLOADERROR)\n            );\n          }\n        );\n        loadedExtentsRtree.insert(extentToLoad, {extent: extentToLoad.slice()});\n      }\n    }\n    this.loading =\n      this.loader_.length < 4 ? false : this.loadingExtentsCount_ > 0;\n  }\n\n  refresh() {\n    this.clear(true);\n    this.loadedExtentsRtree_.clear();\n    super.refresh();\n  }\n\n  /**\n   * Remove an extent from the list of loaded extents.\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @api\n   */\n  removeLoadedExtent(extent) {\n    const loadedExtentsRtree = this.loadedExtentsRtree_;\n    let obj;\n    loadedExtentsRtree.forEachInExtent(extent, function (object) {\n      if (equals(object.extent, extent)) {\n        obj = object;\n        return true;\n      }\n    });\n    if (obj) {\n      loadedExtentsRtree.remove(obj);\n    }\n  }\n\n  /**\n   * Remove a single feature from the source.  If you want to remove all features\n   * at once, use the {@link module:ol/source/Vector~VectorSource#clear #clear()} method\n   * instead.\n   * @param {import(\"../Feature.js\").default<Geometry>} feature Feature to remove.\n   * @api\n   */\n  removeFeature(feature) {\n    if (!feature) {\n      return;\n    }\n    const featureKey = getUid(feature);\n    if (featureKey in this.nullGeometryFeatures_) {\n      delete this.nullGeometryFeatures_[featureKey];\n    } else {\n      if (this.featuresRtree_) {\n        this.featuresRtree_.remove(feature);\n      }\n    }\n    const result = this.removeFeatureInternal(feature);\n    if (result) {\n      this.changed();\n    }\n  }\n\n  /**\n   * Remove feature without firing a `change` event.\n   * @param {import(\"../Feature.js\").default<Geometry>} feature Feature.\n   * @return {import(\"../Feature.js\").default<Geometry>|undefined} The removed feature\n   *     (or undefined if the feature was not found).\n   * @protected\n   */\n  removeFeatureInternal(feature) {\n    const featureKey = getUid(feature);\n    const featureChangeKeys = this.featureChangeKeys_[featureKey];\n    if (!featureChangeKeys) {\n      return;\n    }\n    featureChangeKeys.forEach(unlistenByKey);\n    delete this.featureChangeKeys_[featureKey];\n    const id = feature.getId();\n    if (id !== undefined) {\n      delete this.idIndex_[id.toString()];\n    }\n    delete this.uidIndex_[featureKey];\n    this.dispatchEvent(\n      new VectorSourceEvent(VectorEventType.REMOVEFEATURE, feature)\n    );\n    return feature;\n  }\n\n  /**\n   * Remove a feature from the id index.  Called internally when the feature id\n   * may have changed.\n   * @param {import(\"../Feature.js\").default<Geometry>} feature The feature.\n   * @return {boolean} Removed the feature from the index.\n   * @private\n   */\n  removeFromIdIndex_(feature) {\n    let removed = false;\n    for (const id in this.idIndex_) {\n      if (this.idIndex_[id] === feature) {\n        delete this.idIndex_[id];\n        removed = true;\n        break;\n      }\n    }\n    return removed;\n  }\n\n  /**\n   * Set the new loader of the source. The next render cycle will use the\n   * new loader.\n   * @param {import(\"../featureloader.js\").FeatureLoader} loader The loader to set.\n   * @api\n   */\n  setLoader(loader) {\n    this.loader_ = loader;\n  }\n\n  /**\n   * Points the source to a new url. The next render cycle will use the new url.\n   * @param {string|import(\"../featureloader.js\").FeatureUrlFunction} url Url.\n   * @api\n   */\n  setUrl(url) {\n    assert(this.format_, 7); // `format` must be set when `url` is set\n    this.url_ = url;\n    this.setLoader(xhr(url, this.format_));\n  }\n}\n\nexport default VectorSource;\n","/**\n * @module ol/geom/Circle\n */\nimport SimpleGeometry from './SimpleGeometry.js';\nimport {createOrUpdate, forEachCorner, intersects} from '../extent.js';\nimport {deflateCoordinate} from './flat/deflate.js';\nimport {rotate, translate} from './flat/transform.js';\n\n/**\n * @classdesc\n * Circle geometry.\n *\n * @api\n */\nclass Circle extends SimpleGeometry {\n  /**\n   * @param {!import(\"../coordinate.js\").Coordinate} center Center.\n   *     For internal use, flat coordinates in combination with `layout` and no\n   *     `radius` are also accepted.\n   * @param {number} [radius] Radius.\n   * @param {import(\"./Geometry.js\").GeometryLayout} [layout] Layout.\n   */\n  constructor(center, radius, layout) {\n    super();\n    if (layout !== undefined && radius === undefined) {\n      this.setFlatCoordinates(layout, center);\n    } else {\n      radius = radius ? radius : 0;\n      this.setCenterAndRadius(center, radius, layout);\n    }\n  }\n\n  /**\n   * Make a complete copy of the geometry.\n   * @return {!Circle} Clone.\n   * @api\n   */\n  clone() {\n    const circle = new Circle(\n      this.flatCoordinates.slice(),\n      undefined,\n      this.layout\n    );\n    circle.applyProperties(this);\n    return circle;\n  }\n\n  /**\n   * @param {number} x X.\n   * @param {number} y Y.\n   * @param {import(\"../coordinate.js\").Coordinate} closestPoint Closest point.\n   * @param {number} minSquaredDistance Minimum squared distance.\n   * @return {number} Minimum squared distance.\n   */\n  closestPointXY(x, y, closestPoint, minSquaredDistance) {\n    const flatCoordinates = this.flatCoordinates;\n    const dx = x - flatCoordinates[0];\n    const dy = y - flatCoordinates[1];\n    const squaredDistance = dx * dx + dy * dy;\n    if (squaredDistance < minSquaredDistance) {\n      if (squaredDistance === 0) {\n        for (let i = 0; i < this.stride; ++i) {\n          closestPoint[i] = flatCoordinates[i];\n        }\n      } else {\n        const delta = this.getRadius() / Math.sqrt(squaredDistance);\n        closestPoint[0] = flatCoordinates[0] + delta * dx;\n        closestPoint[1] = flatCoordinates[1] + delta * dy;\n        for (let i = 2; i < this.stride; ++i) {\n          closestPoint[i] = flatCoordinates[i];\n        }\n      }\n      closestPoint.length = this.stride;\n      return squaredDistance;\n    }\n    return minSquaredDistance;\n  }\n\n  /**\n   * @param {number} x X.\n   * @param {number} y Y.\n   * @return {boolean} Contains (x, y).\n   */\n  containsXY(x, y) {\n    const flatCoordinates = this.flatCoordinates;\n    const dx = x - flatCoordinates[0];\n    const dy = y - flatCoordinates[1];\n    return dx * dx + dy * dy <= this.getRadiusSquared_();\n  }\n\n  /**\n   * Return the center of the circle as {@link module:ol/coordinate~Coordinate coordinate}.\n   * @return {import(\"../coordinate.js\").Coordinate} Center.\n   * @api\n   */\n  getCenter() {\n    return this.flatCoordinates.slice(0, this.stride);\n  }\n\n  /**\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @protected\n   * @return {import(\"../extent.js\").Extent} extent Extent.\n   */\n  computeExtent(extent) {\n    const flatCoordinates = this.flatCoordinates;\n    const radius = flatCoordinates[this.stride] - flatCoordinates[0];\n    return createOrUpdate(\n      flatCoordinates[0] - radius,\n      flatCoordinates[1] - radius,\n      flatCoordinates[0] + radius,\n      flatCoordinates[1] + radius,\n      extent\n    );\n  }\n\n  /**\n   * Return the radius of the circle.\n   * @return {number} Radius.\n   * @api\n   */\n  getRadius() {\n    return Math.sqrt(this.getRadiusSquared_());\n  }\n\n  /**\n   * @private\n   * @return {number} Radius squared.\n   */\n  getRadiusSquared_() {\n    const dx = this.flatCoordinates[this.stride] - this.flatCoordinates[0];\n    const dy = this.flatCoordinates[this.stride + 1] - this.flatCoordinates[1];\n    return dx * dx + dy * dy;\n  }\n\n  /**\n   * Get the type of this geometry.\n   * @return {import(\"./Geometry.js\").Type} Geometry type.\n   * @api\n   */\n  getType() {\n    return 'Circle';\n  }\n\n  /**\n   * Test if the geometry and the passed extent intersect.\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @return {boolean} `true` if the geometry and the extent intersect.\n   * @api\n   */\n  intersectsExtent(extent) {\n    const circleExtent = this.getExtent();\n    if (intersects(extent, circleExtent)) {\n      const center = this.getCenter();\n\n      if (extent[0] <= center[0] && extent[2] >= center[0]) {\n        return true;\n      }\n      if (extent[1] <= center[1] && extent[3] >= center[1]) {\n        return true;\n      }\n\n      return forEachCorner(extent, this.intersectsCoordinate.bind(this));\n    }\n    return false;\n  }\n\n  /**\n   * Set the center of the circle as {@link module:ol/coordinate~Coordinate coordinate}.\n   * @param {import(\"../coordinate.js\").Coordinate} center Center.\n   * @api\n   */\n  setCenter(center) {\n    const stride = this.stride;\n    const radius = this.flatCoordinates[stride] - this.flatCoordinates[0];\n    const flatCoordinates = center.slice();\n    flatCoordinates[stride] = flatCoordinates[0] + radius;\n    for (let i = 1; i < stride; ++i) {\n      flatCoordinates[stride + i] = center[i];\n    }\n    this.setFlatCoordinates(this.layout, flatCoordinates);\n    this.changed();\n  }\n\n  /**\n   * Set the center (as {@link module:ol/coordinate~Coordinate coordinate}) and the radius (as\n   * number) of the circle.\n   * @param {!import(\"../coordinate.js\").Coordinate} center Center.\n   * @param {number} radius Radius.\n   * @param {import(\"./Geometry.js\").GeometryLayout} [layout] Layout.\n   * @api\n   */\n  setCenterAndRadius(center, radius, layout) {\n    this.setLayout(layout, center, 0);\n    if (!this.flatCoordinates) {\n      this.flatCoordinates = [];\n    }\n    /** @type {Array<number>} */\n    const flatCoordinates = this.flatCoordinates;\n    let offset = deflateCoordinate(flatCoordinates, 0, center, this.stride);\n    flatCoordinates[offset++] = flatCoordinates[0] + radius;\n    for (let i = 1, ii = this.stride; i < ii; ++i) {\n      flatCoordinates[offset++] = flatCoordinates[i];\n    }\n    flatCoordinates.length = offset;\n    this.changed();\n  }\n\n  getCoordinates() {\n    return null;\n  }\n\n  setCoordinates(coordinates, layout) {}\n\n  /**\n   * Set the radius of the circle. The radius is in the units of the projection.\n   * @param {number} radius Radius.\n   * @api\n   */\n  setRadius(radius) {\n    this.flatCoordinates[this.stride] = this.flatCoordinates[0] + radius;\n    this.changed();\n  }\n\n  /**\n   * Rotate the geometry around a given coordinate. This modifies the geometry\n   * coordinates in place.\n   * @param {number} angle Rotation angle in counter-clockwise radians.\n   * @param {import(\"../coordinate.js\").Coordinate} anchor The rotation center.\n   * @api\n   */\n  rotate(angle, anchor) {\n    const center = this.getCenter();\n    const stride = this.getStride();\n    this.setCenter(\n      rotate(center, 0, center.length, stride, angle, anchor, center)\n    );\n    this.changed();\n  }\n\n  /**\n   * Translate the geometry.  This modifies the geometry coordinates in place.  If\n   * instead you want a new geometry, first `clone()` this geometry.\n   * @param {number} deltaX Delta X.\n   * @param {number} deltaY Delta Y.\n   * @api\n   */\n  translate(deltaX, deltaY) {\n    const center = this.getCenter();\n    const stride = this.getStride();\n    this.setCenter(\n      translate(center, 0, center.length, stride, deltaX, deltaY, center)\n    );\n    this.changed();\n  }\n}\n\n/**\n * Transform each coordinate of the circle from one coordinate reference system\n * to another. The geometry is modified in place.\n * If you do not want the geometry modified in place, first clone() it and\n * then use this function on the clone.\n *\n * Internally a circle is currently represented by two points: the center of\n * the circle `[cx, cy]`, and the point to the right of the circle\n * `[cx + r, cy]`. This `transform` function just transforms these two points.\n * So the resulting geometry is also a circle, and that circle does not\n * correspond to the shape that would be obtained by transforming every point\n * of the original circle.\n *\n * @param {import(\"../proj.js\").ProjectionLike} source The current projection.  Can be a\n *     string identifier or a {@link module:ol/proj/Projection~Projection} object.\n * @param {import(\"../proj.js\").ProjectionLike} destination The desired projection.  Can be a\n *     string identifier or a {@link module:ol/proj/Projection~Projection} object.\n * @return {Circle} This geometry.  Note that original geometry is\n *     modified in place.\n * @function\n * @api\n */\nCircle.prototype.transform;\nexport default Circle;\n","/**\n * @module ol/format/JSONFeature\n */\nimport FeatureFormat from './Feature.js';\nimport {abstract} from '../util.js';\n\n/**\n * @classdesc\n * Abstract base class; normally only used for creating subclasses and not\n * instantiated in apps.\n * Base class for JSON feature formats.\n *\n * @abstract\n */\nclass JSONFeature extends FeatureFormat {\n  constructor() {\n    super();\n  }\n\n  /**\n   * @return {import(\"./Feature.js\").Type} Format.\n   */\n  getType() {\n    return 'json';\n  }\n\n  /**\n   * Read a feature.  Only works for a single feature. Use `readFeatures` to\n   * read a feature collection.\n   *\n   * @param {ArrayBuffer|Document|Element|Object|string} source Source.\n   * @param {import(\"./Feature.js\").ReadOptions} [options] Read options.\n   * @return {import(\"../Feature.js\").default} Feature.\n   * @api\n   */\n  readFeature(source, options) {\n    return this.readFeatureFromObject(\n      getObject(source),\n      this.getReadOptions(source, options)\n    );\n  }\n\n  /**\n   * Read all features.  Works with both a single feature and a feature\n   * collection.\n   *\n   * @param {ArrayBuffer|Document|Element|Object|string} source Source.\n   * @param {import(\"./Feature.js\").ReadOptions} [options] Read options.\n   * @return {Array<import(\"../Feature.js\").default>} Features.\n   * @api\n   */\n  readFeatures(source, options) {\n    return this.readFeaturesFromObject(\n      getObject(source),\n      this.getReadOptions(source, options)\n    );\n  }\n\n  /**\n   * @abstract\n   * @param {Object} object Object.\n   * @param {import(\"./Feature.js\").ReadOptions} [options] Read options.\n   * @protected\n   * @return {import(\"../Feature.js\").default} Feature.\n   */\n  readFeatureFromObject(object, options) {\n    return abstract();\n  }\n\n  /**\n   * @abstract\n   * @param {Object} object Object.\n   * @param {import(\"./Feature.js\").ReadOptions} [options] Read options.\n   * @protected\n   * @return {Array<import(\"../Feature.js\").default>} Features.\n   */\n  readFeaturesFromObject(object, options) {\n    return abstract();\n  }\n\n  /**\n   * Read a geometry.\n   *\n   * @param {ArrayBuffer|Document|Element|Object|string} source Source.\n   * @param {import(\"./Feature.js\").ReadOptions} [options] Read options.\n   * @return {import(\"../geom/Geometry.js\").default} Geometry.\n   * @api\n   */\n  readGeometry(source, options) {\n    return this.readGeometryFromObject(\n      getObject(source),\n      this.getReadOptions(source, options)\n    );\n  }\n\n  /**\n   * @abstract\n   * @param {Object} object Object.\n   * @param {import(\"./Feature.js\").ReadOptions} [options] Read options.\n   * @protected\n   * @return {import(\"../geom/Geometry.js\").default} Geometry.\n   */\n  readGeometryFromObject(object, options) {\n    return abstract();\n  }\n\n  /**\n   * Read the projection.\n   *\n   * @param {ArrayBuffer|Document|Element|Object|string} source Source.\n   * @return {import(\"../proj/Projection.js\").default} Projection.\n   * @api\n   */\n  readProjection(source) {\n    return this.readProjectionFromObject(getObject(source));\n  }\n\n  /**\n   * @abstract\n   * @param {Object} object Object.\n   * @protected\n   * @return {import(\"../proj/Projection.js\").default} Projection.\n   */\n  readProjectionFromObject(object) {\n    return abstract();\n  }\n\n  /**\n   * Encode a feature as string.\n   *\n   * @param {import(\"../Feature.js\").default} feature Feature.\n   * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n   * @return {string} Encoded feature.\n   * @api\n   */\n  writeFeature(feature, options) {\n    return JSON.stringify(this.writeFeatureObject(feature, options));\n  }\n\n  /**\n   * @abstract\n   * @param {import(\"../Feature.js\").default} feature Feature.\n   * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n   * @return {Object} Object.\n   */\n  writeFeatureObject(feature, options) {\n    return abstract();\n  }\n\n  /**\n   * Encode an array of features as string.\n   *\n   * @param {Array<import(\"../Feature.js\").default>} features Features.\n   * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n   * @return {string} Encoded features.\n   * @api\n   */\n  writeFeatures(features, options) {\n    return JSON.stringify(this.writeFeaturesObject(features, options));\n  }\n\n  /**\n   * @abstract\n   * @param {Array<import(\"../Feature.js\").default>} features Features.\n   * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n   * @return {Object} Object.\n   */\n  writeFeaturesObject(features, options) {\n    return abstract();\n  }\n\n  /**\n   * Encode a geometry as string.\n   *\n   * @param {import(\"../geom/Geometry.js\").default} geometry Geometry.\n   * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n   * @return {string} Encoded geometry.\n   * @api\n   */\n  writeGeometry(geometry, options) {\n    return JSON.stringify(this.writeGeometryObject(geometry, options));\n  }\n\n  /**\n   * @abstract\n   * @param {import(\"../geom/Geometry.js\").default} geometry Geometry.\n   * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n   * @return {Object} Object.\n   */\n  writeGeometryObject(geometry, options) {\n    return abstract();\n  }\n}\n\n/**\n * @param {Document|Element|Object|string} source Source.\n * @return {Object} Object.\n */\nfunction getObject(source) {\n  if (typeof source === 'string') {\n    const object = JSON.parse(source);\n    return object ? /** @type {Object} */ (object) : null;\n  } else if (source !== null) {\n    return source;\n  }\n  return null;\n}\n\nexport default JSONFeature;\n","<script>\nimport { useSlots, onBeforeMount, onMounted, onBeforeUnmount, ref, reactive, computed, watch, nextTick, defineAsyncComponent, useCssModule, inject } from 'vue'\nimport $ from 'jquery'\nimport { Layer } from 'ol/layer'\n\nexport default {\n    props: {\n        onClose: {\n            type: Function,\n            default: ()=>{}\n        },\n        onChangLayerVisible: {\n            type: Function,\n            default: ()=>{}\n        },\n        onDeleteLayer: {\n            type: Function,\n            default: ()=>{}\n        },\n        onLockLayer: {\n            type: Function,\n            default: ()=>{}\n        },\n        onChangeOrderLayer: {\n            type: Function,\n            default: ()=>{}\n        },\n        currentLayers: {\n            type: Array,\n            default: []\n        },\n        selectLock: {\n            type: Boolean,\n            default: false\n        }\n    },\n    setup(props, { emit }) {\n        const state = reactive({\n        })\n\n        return {\n            props,\n            state,\n        }\n    }\n}\n</script>\n\n<template>\n    <div class=\"rounded-4 bg-white\">\n        <div class=\"row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold\">\n            <p class=\"mb-0 fs-5\">已選擇的圖層</p>\n            <a href=\"\" class=\"closeBtn position-absolute col-auto\" @click.prevent=\"props.onClose\">\n                <svg width=\"32\" height=\"32\" viewBox=\"0 0 24 24\"><path fill=\"currentColor\" d=\"M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10zm0-11.414L9.172 7.757L7.757 9.172L10.586 12l-2.829 2.828l1.415 1.415L12 13.414l2.828 2.829l1.415-1.415L13.414 12l2.829-2.828l-1.415-1.415L12 10.586z\"/></svg>\n            </a>\n        </div>\n        <hr class=\"my-0\">\n        <div class=\"py-3 px-4 content\">\n            <div class=\"allControl d-flex align-items-center justify-content-end mb-0\">\n                <a href=\"\" class=\"d-flex align-items-center text-decoration-none me-4\"\n                :class=\"{'lockUp': props.selectLock, 'unlock': !props.selectLock}\"\n                @click.prevent=\"()=>{\n                    props.onLockLayer()\n                }\">\n                    <svg viewBox=\"0 0 25 24\" fill=\"currentColor\">\n                        <path d=\"M8.02381 9.33333H14.881V7.80952C14.881 7.1746 14.6587 6.63492 14.2143 6.19048C13.7698 5.74603 13.2302 5.52381 12.5952 5.52381C11.9603 5.52381 11.4206 5.74603 10.9762 6.19048C10.5317 6.63492 10.3095 7.1746 10.3095 7.80952H8.78571C8.78571 6.75556 9.15727 5.85702 9.90038 5.1139C10.643 4.3713 11.5413 4 12.5952 4C13.6492 4 14.5477 4.3713 15.2909 5.1139C16.0335 5.85702 16.4048 6.75556 16.4048 7.80952V9.33333H17.1667C17.5857 9.33333 17.9446 9.48241 18.2432 9.78057C18.5414 10.0792 18.6905 10.4381 18.6905 10.8571V18.4762C18.6905 18.8952 18.5414 19.2541 18.2432 19.5528C17.9446 19.8509 17.5857 20 17.1667 20H8.02381C7.60476 20 7.24616 19.8509 6.948 19.5528C6.64933 19.2541 6.5 18.8952 6.5 18.4762V10.8571C6.5 10.4381 6.64933 10.0792 6.948 9.78057C7.24616 9.48241 7.60476 9.33333 8.02381 9.33333ZM12.5952 16.1905C13.0143 16.1905 13.3731 16.0414 13.6718 15.7432C13.97 15.4446 14.119 15.0857 14.119 14.6667C14.119 14.2476 13.97 13.8888 13.6718 13.5901C13.3731 13.2919 13.0143 13.1429 12.5952 13.1429C12.1762 13.1429 11.8176 13.2919 11.5194 13.5901C11.2208 13.8888 11.0714 14.2476 11.0714 14.6667C11.0714 15.0857 11.2208 15.4446 11.5194 15.7432C11.8176 16.0414 12.1762 16.1905 12.5952 16.1905Z\" />\n                    </svg>\n                    鎖定圖層\n                </a>\n                <a href=\"\" class=\"d-flex align-items-center text-decoration-none\"\n                :class=\"{'disabled':props.currentLayers.length <= 1}\"\n                @click.prevent=\"()=>{\n                    if (props.currentLayers.length > 0) {\n                        props.onDeleteLayer({\n                            action: 'selectLayerMode',\n                            value: {\n                                layerName: 'all'\n                            }\n                        })\n                    }\n                }\">\n                    <svg viewBox=\"0 0 25 24\" fill=\"currentColor\">\n                        <path d=\"M7.5 21C6.95 21 6.47933 20.8043 6.088 20.413C5.696 20.021 5.5 19.55 5.5 19V6H4.5V4H9.5V3H15.5V4H20.5V6H19.5V19C19.5 19.55 19.3043 20.021 18.913 20.413C18.521 20.8043 18.05 21 17.5 21H7.5ZM9.5 17H11.5V8H9.5V17ZM13.5 17H15.5V8H13.5V17Z\" />\n                    </svg>\n                    全部刪除\n                </a>\n            </div>\n            <ul class=\"list-unstyled d-flex flex-wrap flex-column-reverse\">\n                <li v-for=\"(node, nodeIndex) in props.currentLayers\">\n                    <div class=\"d-flex justify-content-between align-items-center border-bottom py-2\" v-if=\"node.id\">\n                        <div>\n                            {{ node?.label }}\n                        </div>\n                        <div class=\"tool\">\n                            <a href=\"\"\n                            @click.prevent=\"props.onChangeOrderLayer({\n                                action: 'changeOrder',\n                                value: {\n                                    movement:'up',\n                                    id: node.id,\n                                    key: nodeIndex\n                                },\n                            })\">\n                                <svg viewBox=\"0 0 25 24\" fill=\"currentColor\">\n                                    <path d=\"M9.49991 19.84H15.4999V11.84H20.3399L12.4999 4.00003L4.65991 11.84H9.49991V19.84Z\" fill=\"#808080\" />\n                                </svg>\n                            </a>\n                            <a href=\"\"\n                            @click.prevent=\"props.onChangeOrderLayer({\n                                action: 'changeOrder',\n                                value: {\n                                    movement: 'down',\n                                    id: node.id,\n                                    key: nodeIndex\n                                }\n                            })\">\n                                <svg viewBox=\"0 0 25 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                                    <path d=\"M9.49991 4H15.4999V12H20.3399L12.4999 19.84L4.65991 12H9.49991V4Z\" fill=\"#808080\"/>\n                                </svg>\n                            </a>\n                            <a href=\"\"\n                            :class=\"{\n                                'Invisible': !node?.visible\n                            }\"\n                            @click.prevent=\"()=>{\n                                props.onChangLayerVisible({\n                                    action: 'changeLayerVisible',\n                                    value: {\n                                        key: nodeIndex,\n                                    }\n                                })\n                            }\">\n                                <svg viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                                    <path d=\"M12.3333 10C11.8029 10 11.2942 10.2107 10.9191 10.5858C10.544 10.9609 10.3333 11.4696 10.3333 12C10.3333 12.5304 10.544 13.0391 10.9191 13.4142C11.2942 13.7893 11.8029 14 12.3333 14C12.8638 14 13.3725 13.7893 13.7475 13.4142C14.1226 13.0391 14.3333 12.5304 14.3333 12C14.3333 11.4696 14.1226 10.9609 13.7475 10.5858C13.3725 10.2107 12.8638 10 12.3333 10ZM12.3333 15.3333C11.4493 15.3333 10.6014 14.9821 9.97631 14.357C9.35119 13.7319 9 12.8841 9 12C9 11.1159 9.35119 10.2681 9.97631 9.64298C10.6014 9.01786 11.4493 8.66667 12.3333 8.66667C13.2174 8.66667 14.0652 9.01786 14.6904 9.64298C15.3155 10.2681 15.6667 11.1159 15.6667 12C15.6667 12.8841 15.3155 13.7319 14.6904 14.357C14.0652 14.9821 13.2174 15.3333 12.3333 15.3333ZM12.3333 7C9 7 6.15333 9.07333 5 12C6.15333 14.9267 9 17 12.3333 17C15.6667 17 18.5133 14.9267 19.6667 12C18.5133 9.07333 15.6667 7 12.3333 7Z\" fill=\"#808080\"/>\n                                </svg>\n                            </a>\n                            <a href=\"\"\n                            @click.prevent=\"props.onDeleteLayer({\n                                action: 'selectLayerMode',\n                                value: {\n                                    id: node?.id,\n                                }\n                            })\">\n                                <svg viewBox=\"0 0 25 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                                    <path d=\"M7.5 21C6.95 21 6.47933 20.8043 6.088 20.413C5.696 20.021 5.5 19.55 5.5 19V6H4.5V4H9.5V3H15.5V4H20.5V6H19.5V19C19.5 19.55 19.3043 20.021 18.913 20.413C18.521 20.8043 18.05 21 17.5 21H7.5ZM9.5 17H11.5V8H9.5V17ZM13.5 17H15.5V8H13.5V17Z\" fill=\"#808080\"/>\n                                </svg>\n                            </a>\n                        </div>\n                    </div>\n                </li>\n            </ul>\n        </div>\n    </div>\n</template>\n\n<style lang=\"sass\" scoped>\n@import '@/assets/styles/all.module.scss'\n.closeBtn\n    right:10px\n    svg\n        width: 20px\n        height: 20px\n.content\n    .title\n        cursor: pointer\n        svg\n            transform: rotateZ(0)\n        .openTitle\n            transform: rotateZ(90deg)\n    svg\n        width: 28px\n        height: 28px\n    img\n        width: 16px\n        height: 16px\n.tool\n    a\n        padding: 5px 0\n    .visible\n        color: red\n    .Invisible\n        color: blue\n        position: relative\n        &::after\n            content: ''\n            position: absolute\n            top: 55%\n            left: 20%\n            width: 60%\n            height: 2px\n            background: $grey\n            transform-origin: 50% 50%\n            transform: rotateZ(45deg)\n            display: block\n.allControl\n    a\n        color: $grey\n    .lockUp\n        color: #247BA0\n    .unlock\n        color: $grey\n</style>\n","/**\n * @module ol/source/Cluster\n */\n\nimport EventType from '../events/EventType.js';\nimport Feature from '../Feature.js';\nimport Point from '../geom/Point.js';\nimport VectorSource from './Vector.js';\nimport {add as addCoordinate, scale as scaleCoordinate} from '../coordinate.js';\nimport {assert} from '../asserts.js';\nimport {\n  buffer,\n  createEmpty,\n  createOrUpdateFromCoordinate,\n  getCenter,\n} from '../extent.js';\nimport {getUid} from '../util.js';\n\n/**\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {number} [distance=20] Distance in pixels within which features will\n * be clustered together.\n * @property {number} [minDistance=0] Minimum distance in pixels between clusters.\n * Will be capped at the configured distance.\n * By default no minimum distance is guaranteed. This config can be used to avoid\n * overlapping icons. As a tradoff, the cluster feature's position will no longer be\n * the center of all its features.\n * @property {function(Feature):Point} [geometryFunction]\n * Function that takes an {@link module:ol/Feature~Feature} as argument and returns an\n * {@link module:ol/geom/Point~Point} as cluster calculation point for the feature. When a\n * feature should not be considered for clustering, the function should return\n * `null`. The default, which works when the underlying source contains point\n * features only, is\n * ```js\n * function(feature) {\n *   return feature.getGeometry();\n * }\n * ```\n * See {@link module:ol/geom/Polygon~Polygon#getInteriorPoint} for a way to get a cluster\n * calculation point for polygons.\n * @property {function(Point, Array<Feature>):Feature} [createCluster]\n * Function that takes the cluster's center {@link module:ol/geom/Point~Point} and an array\n * of {@link module:ol/Feature~Feature} included in this cluster. Must return a\n * {@link module:ol/Feature~Feature} that will be used to render. Default implementation is:\n * ```js\n * function(point, features) {\n *   return new Feature({\n *     geometry: point,\n *     features: features\n *   });\n * }\n * ```\n * @property {VectorSource} [source=null] Source.\n * @property {boolean} [wrapX=true] Whether to wrap the world horizontally.\n */\n\n/**\n * @classdesc\n * Layer source to cluster vector data. Works out of the box with point\n * geometries. For other geometry types, or if not all geometries should be\n * considered for clustering, a custom `geometryFunction` can be defined.\n *\n * If the instance is disposed without also disposing the underlying\n * source `setSource(null)` has to be called to remove the listener reference\n * from the wrapped source.\n * @api\n */\nclass Cluster extends VectorSource {\n  /**\n   * @param {Options} options Cluster options.\n   */\n  constructor(options) {\n    super({\n      attributions: options.attributions,\n      wrapX: options.wrapX,\n    });\n\n    /**\n     * @type {number|undefined}\n     * @protected\n     */\n    this.resolution = undefined;\n\n    /**\n     * @type {number}\n     * @protected\n     */\n    this.distance = options.distance !== undefined ? options.distance : 20;\n\n    /**\n     * @type {number}\n     * @protected\n     */\n    this.minDistance = options.minDistance || 0;\n\n    /**\n     * @type {number}\n     * @protected\n     */\n    this.interpolationRatio = 0;\n\n    /**\n     * @type {Array<Feature>}\n     * @protected\n     */\n    this.features = [];\n\n    /**\n     * @param {Feature} feature Feature.\n     * @return {Point} Cluster calculation point.\n     * @protected\n     */\n    this.geometryFunction =\n      options.geometryFunction ||\n      function (feature) {\n        const geometry = /** @type {Point} */ (feature.getGeometry());\n        assert(geometry.getType() == 'Point', 10); // The default `geometryFunction` can only handle `Point` geometries\n        return geometry;\n      };\n\n    /**\n     * @type {function(Point, Array<Feature>):Feature}\n     * @private\n     */\n    this.createCustomCluster_ = options.createCluster;\n\n    /**\n     * @type {VectorSource|null}\n     * @protected\n     */\n    this.source = null;\n\n    /**\n     * @private\n     */\n    this.boundRefresh_ = this.refresh.bind(this);\n\n    this.updateDistance(this.distance, this.minDistance);\n    this.setSource(options.source || null);\n  }\n\n  /**\n   * Remove all features from the source.\n   * @param {boolean} [fast] Skip dispatching of {@link module:ol/source/VectorEventType~VectorEventType#removefeature} events.\n   * @api\n   */\n  clear(fast) {\n    this.features.length = 0;\n    super.clear(fast);\n  }\n\n  /**\n   * Get the distance in pixels between clusters.\n   * @return {number} Distance.\n   * @api\n   */\n  getDistance() {\n    return this.distance;\n  }\n\n  /**\n   * Get a reference to the wrapped source.\n   * @return {VectorSource|null} Source.\n   * @api\n   */\n  getSource() {\n    return this.source;\n  }\n\n  /**\n   * @param {import(\"../extent.js\").Extent} extent Extent.\n   * @param {number} resolution Resolution.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   */\n  loadFeatures(extent, resolution, projection) {\n    this.source.loadFeatures(extent, resolution, projection);\n    if (resolution !== this.resolution) {\n      this.resolution = resolution;\n      this.refresh();\n    }\n  }\n\n  /**\n   * Set the distance within which features will be clusterd together.\n   * @param {number} distance The distance in pixels.\n   * @api\n   */\n  setDistance(distance) {\n    this.updateDistance(distance, this.minDistance);\n  }\n\n  /**\n   * Set the minimum distance between clusters. Will be capped at the\n   * configured distance.\n   * @param {number} minDistance The minimum distance in pixels.\n   * @api\n   */\n  setMinDistance(minDistance) {\n    this.updateDistance(this.distance, minDistance);\n  }\n\n  /**\n   * The configured minimum distance between clusters.\n   * @return {number} The minimum distance in pixels.\n   * @api\n   */\n  getMinDistance() {\n    return this.minDistance;\n  }\n\n  /**\n   * Replace the wrapped source.\n   * @param {VectorSource|null} source The new source for this instance.\n   * @api\n   */\n  setSource(source) {\n    if (this.source) {\n      this.source.removeEventListener(EventType.CHANGE, this.boundRefresh_);\n    }\n    this.source = source;\n    if (source) {\n      source.addEventListener(EventType.CHANGE, this.boundRefresh_);\n    }\n    this.refresh();\n  }\n\n  /**\n   * Handle the source changing.\n   */\n  refresh() {\n    this.clear();\n    this.cluster();\n    this.addFeatures(this.features);\n  }\n\n  /**\n   * Update the distances and refresh the source if necessary.\n   * @param {number} distance The new distance.\n   * @param {number} minDistance The new minimum distance.\n   */\n  updateDistance(distance, minDistance) {\n    const ratio =\n      distance === 0 ? 0 : Math.min(minDistance, distance) / distance;\n    const changed =\n      distance !== this.distance || this.interpolationRatio !== ratio;\n    this.distance = distance;\n    this.minDistance = minDistance;\n    this.interpolationRatio = ratio;\n    if (changed) {\n      this.refresh();\n    }\n  }\n\n  /**\n   * @protected\n   */\n  cluster() {\n    if (this.resolution === undefined || !this.source) {\n      return;\n    }\n    const extent = createEmpty();\n    const mapDistance = this.distance * this.resolution;\n    const features = this.source.getFeatures();\n\n    /** @type {Object<string, true>} */\n    const clustered = {};\n\n    for (let i = 0, ii = features.length; i < ii; i++) {\n      const feature = features[i];\n      if (!(getUid(feature) in clustered)) {\n        const geometry = this.geometryFunction(feature);\n        if (geometry) {\n          const coordinates = geometry.getCoordinates();\n          createOrUpdateFromCoordinate(coordinates, extent);\n          buffer(extent, mapDistance, extent);\n\n          const neighbors = this.source\n            .getFeaturesInExtent(extent)\n            .filter(function (neighbor) {\n              const uid = getUid(neighbor);\n              if (uid in clustered) {\n                return false;\n              }\n              clustered[uid] = true;\n              return true;\n            });\n          this.features.push(this.createCluster(neighbors, extent));\n        }\n      }\n    }\n  }\n\n  /**\n   * @param {Array<Feature>} features Features\n   * @param {import(\"../extent.js\").Extent} extent The searched extent for these features.\n   * @return {Feature} The cluster feature.\n   * @protected\n   */\n  createCluster(features, extent) {\n    const centroid = [0, 0];\n    for (let i = features.length - 1; i >= 0; --i) {\n      const geometry = this.geometryFunction(features[i]);\n      if (geometry) {\n        addCoordinate(centroid, geometry.getCoordinates());\n      } else {\n        features.splice(i, 1);\n      }\n    }\n    scaleCoordinate(centroid, 1 / features.length);\n    const searchCenter = getCenter(extent);\n    const ratio = this.interpolationRatio;\n    const geometry = new Point([\n      centroid[0] * (1 - ratio) + searchCenter[0] * ratio,\n      centroid[1] * (1 - ratio) + searchCenter[1] * ratio,\n    ]);\n    if (this.createCustomCluster_) {\n      return this.createCustomCluster_(geometry, features);\n    }\n    return new Feature({\n      geometry,\n      features,\n    });\n  }\n}\n\nexport default Cluster;\n","/**\n * @module ol/source/TileArcGISRest\n */\n\nimport TileImage from './TileImage.js';\nimport {appendParams} from '../uri.js';\nimport {createEmpty} from '../extent.js';\nimport {modulo} from '../math.js';\nimport {scale as scaleSize, toSize} from '../size.js';\nimport {hash as tileCoordHash} from '../tilecoord.js';\n\n/**\n * @typedef {Object} Options\n * @property {import(\"./Source.js\").AttributionLike} [attributions] Attributions.\n * @property {number} [cacheSize] Initial tile cache size. Will auto-grow to hold at least the number of tiles in the viewport.\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\n * you must provide a `crossOrigin` value if you want to access pixel data with the Canvas renderer.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image for more detail.\n * @property {boolean} [interpolate=true] Use interpolated values when resampling.  By default,\n * linear interpolation is used when resampling.  Set to false to use the nearest neighbor instead.\n * @property {Object<string,*>} [params] ArcGIS Rest parameters. This field is optional. Service defaults will be\n * used for any fields not specified. `FORMAT` is `PNG32` by default. `F` is `IMAGE` by\n * default. `TRANSPARENT` is `true` by default.  `BBOX`, `SIZE`, `BBOXSR`,\n * and `IMAGESR` will be set dynamically. Set `LAYERS` to\n * override the default service layer visibility. See\n * https://developers.arcgis.com/rest/services-reference/export-map.htm\n * for further reference.\n * @property {boolean} [hidpi=true] Use the `ol/Map#pixelRatio` value when requesting\n * the image from the remote server.\n * @property {import(\"../tilegrid/TileGrid.js\").default} [tileGrid] Tile grid. Base this on the resolutions,\n * tilesize and extent supported by the server.\n * If this is not defined, a default grid will be used: if there is a projection\n * extent, the grid will be based on that; if not, a grid based on a global\n * extent with origin at 0,0 will be used.\n * @property {import(\"../proj.js\").ProjectionLike} [projection] Projection. Default is the view projection.\n * The projection code must contain a numeric end portion separated by :\n * or the entire code must form a valid ArcGIS SpatialReference definition.\n * @property {number} [reprojectionErrorThreshold=0.5] Maximum allowed reprojection error (in pixels).\n * Higher values can increase reprojection performance, but decrease precision.\n * @property {import(\"../Tile.js\").LoadFunction} [tileLoadFunction] Optional function to load a tile given a URL.\n * The default is\n * ```js\n * function(imageTile, src) {\n *   imageTile.getImage().src = src;\n * };\n * ```\n * @property {string} [url] ArcGIS Rest service URL for a Map Service or Image Service. The\n * url should include /MapServer or /ImageServer.\n * @property {boolean} [wrapX=true] Whether to wrap the world horizontally.\n * @property {number} [transition] Duration of the opacity transition for rendering.  To disable the opacity\n * transition, pass `transition: 0`.\n * @property {Array<string>} [urls] ArcGIS Rest service urls. Use this instead of `url` when the ArcGIS\n * Service supports multiple urls for export requests.\n * @property {number|import(\"../array.js\").NearestDirectionFunction} [zDirection=0]\n * Choose whether to use tiles with a higher or lower zoom level when between integer\n * zoom levels. See {@link module:ol/tilegrid/TileGrid~TileGrid#getZForResolution}.\n */\n\n/**\n * @classdesc\n * Layer source for tile data from ArcGIS Rest services. Map and Image\n * Services are supported.\n *\n * For cached ArcGIS services, better performance is available using the\n * {@link module:ol/source/XYZ~XYZ} data source.\n * @api\n */\nclass TileArcGISRest extends TileImage {\n  /**\n   * @param {Options} [options] Tile ArcGIS Rest options.\n   */\n  constructor(options) {\n    options = options ? options : {};\n\n    super({\n      attributions: options.attributions,\n      cacheSize: options.cacheSize,\n      crossOrigin: options.crossOrigin,\n      interpolate: options.interpolate,\n      projection: options.projection,\n      reprojectionErrorThreshold: options.reprojectionErrorThreshold,\n      tileGrid: options.tileGrid,\n      tileLoadFunction: options.tileLoadFunction,\n      url: options.url,\n      urls: options.urls,\n      wrapX: options.wrapX !== undefined ? options.wrapX : true,\n      transition: options.transition,\n      zDirection: options.zDirection,\n    });\n\n    /**\n     * @private\n     * @type {!Object}\n     */\n    this.params_ = options.params || {};\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.hidpi_ = options.hidpi !== undefined ? options.hidpi : true;\n\n    /**\n     * @private\n     * @type {import(\"../extent.js\").Extent}\n     */\n    this.tmpExtent_ = createEmpty();\n\n    this.setKey(this.getKeyForParams_());\n  }\n\n  /**\n   * @private\n   * @return {string} The key for the current params.\n   */\n  getKeyForParams_() {\n    let i = 0;\n    const res = [];\n    for (const key in this.params_) {\n      res[i++] = key + '-' + this.params_[key];\n    }\n    return res.join('/');\n  }\n\n  /**\n   * Get the user-provided params, i.e. those passed to the constructor through\n   * the \"params\" option, and possibly updated using the updateParams method.\n   * @return {Object} Params.\n   * @api\n   */\n  getParams() {\n    return this.params_;\n  }\n\n  /**\n   * @param {import(\"../tilecoord.js\").TileCoord} tileCoord Tile coordinate.\n   * @param {import(\"../size.js\").Size} tileSize Tile size.\n   * @param {import(\"../extent.js\").Extent} tileExtent Tile extent.\n   * @param {number} pixelRatio Pixel ratio.\n   * @param {import(\"../proj/Projection.js\").default} projection Projection.\n   * @param {Object} params Params.\n   * @return {string|undefined} Request URL.\n   * @private\n   */\n  getRequestUrl_(\n    tileCoord,\n    tileSize,\n    tileExtent,\n    pixelRatio,\n    projection,\n    params\n  ) {\n    const urls = this.urls;\n    if (!urls) {\n      return undefined;\n    }\n\n    // ArcGIS Server only wants the numeric portion of the projection ID.\n    // (if there is no numeric portion the entire projection code must\n    // form a valid ArcGIS SpatialReference definition).\n    const srid = projection\n      .getCode()\n      .split(/:(?=\\d+$)/)\n      .pop();\n\n    params['SIZE'] = tileSize[0] + ',' + tileSize[1];\n    params['BBOX'] = tileExtent.join(',');\n    params['BBOXSR'] = srid;\n    params['IMAGESR'] = srid;\n    params['DPI'] = Math.round(\n      params['DPI'] ? params['DPI'] * pixelRatio : 90 * pixelRatio\n    );\n\n    let url;\n    if (urls.length == 1) {\n      url = urls[0];\n    } else {\n      const index = modulo(tileCoordHash(tileCoord), urls.length);\n      url = urls[index];\n    }\n\n    const modifiedUrl = url\n      .replace(/MapServer\\/?$/, 'MapServer/export')\n      .replace(/ImageServer\\/?$/, 'ImageServer/exportImage');\n    return appendParams(modifiedUrl, params);\n  }\n\n  /**\n   * Get the tile pixel ratio for this source.\n   * @param {number} pixelRatio Pixel ratio.\n   * @return {number} Tile pixel ratio.\n   */\n  getTilePixelRatio(pixelRatio) {\n    return this.hidpi_ ? pixelRatio : 1;\n  }\n\n  /**\n   * Update the user-provided params.\n   * @param {Object} params Params.\n   * @api\n   */\n  updateParams(params) {\n    Object.assign(this.params_, params);\n    this.setKey(this.getKeyForParams_());\n  }\n\n  /**\n   * @param {import(\"../tilecoord.js\").TileCoord} tileCoord The tile coordinate\n   * @param {number} pixelRatio The pixel ratio\n   * @param {import(\"../proj/Projection.js\").default} projection The projection\n   * @return {string|undefined} The tile URL\n   * @override\n   */\n  tileUrlFunction(tileCoord, pixelRatio, projection) {\n    let tileGrid = this.getTileGrid();\n    if (!tileGrid) {\n      tileGrid = this.getTileGridForProjection(projection);\n    }\n\n    if (tileGrid.getResolutions().length <= tileCoord[0]) {\n      return undefined;\n    }\n\n    if (pixelRatio != 1 && !this.hidpi_) {\n      pixelRatio = 1;\n    }\n\n    const tileExtent = tileGrid.getTileCoordExtent(tileCoord, this.tmpExtent_);\n    let tileSize = toSize(tileGrid.getTileSize(tileCoord[0]), this.tmpSize);\n\n    if (pixelRatio != 1) {\n      tileSize = scaleSize(tileSize, pixelRatio, this.tmpSize);\n    }\n\n    // Apply default params and override with user specified values.\n    const baseParams = {\n      'F': 'image',\n      'FORMAT': 'PNG32',\n      'TRANSPARENT': true,\n    };\n    Object.assign(baseParams, this.params_);\n\n    return this.getRequestUrl_(\n      tileCoord,\n      tileSize,\n      tileExtent,\n      pixelRatio,\n      projection,\n      baseParams\n    );\n  }\n}\n\nexport default TileArcGISRest;\n","/**\n * @module ol/format/EsriJSON\n */\nimport Feature from '../Feature.js';\nimport JSONFeature from './JSONFeature.js';\nimport LineString from '../geom/LineString.js';\nimport LinearRing from '../geom/LinearRing.js';\nimport MultiLineString from '../geom/MultiLineString.js';\nimport MultiPoint from '../geom/MultiPoint.js';\nimport MultiPolygon from '../geom/MultiPolygon.js';\nimport Point from '../geom/Point.js';\nimport Polygon from '../geom/Polygon.js';\nimport {assert} from '../asserts.js';\nimport {containsExtent} from '../extent.js';\nimport {deflateCoordinates} from '../geom/flat/deflate.js';\nimport {get as getProjection} from '../proj.js';\nimport {isEmpty} from '../obj.js';\nimport {linearRingIsClockwise} from '../geom/flat/orient.js';\nimport {transformGeometryWithOptions} from './Feature.js';\n\n/**\n * @typedef {import(\"arcgis-rest-api\").Feature} EsriJSONFeature\n * @typedef {import(\"arcgis-rest-api\").FeatureSet} EsriJSONFeatureSet\n * @typedef {import(\"arcgis-rest-api\").Geometry} EsriJSONGeometry\n * @typedef {import(\"arcgis-rest-api\").Point} EsriJSONPoint\n * @typedef {import(\"arcgis-rest-api\").Polyline} EsriJSONPolyline\n * @typedef {import(\"arcgis-rest-api\").Polygon} EsriJSONPolygon\n * @typedef {import(\"arcgis-rest-api\").Multipoint} EsriJSONMultipoint\n * @typedef {import(\"arcgis-rest-api\").HasZM} EsriJSONHasZM\n * @typedef {import(\"arcgis-rest-api\").Position} EsriJSONPosition\n * @typedef {import(\"arcgis-rest-api\").SpatialReferenceWkid} EsriJSONSpatialReferenceWkid\n */\n\n/**\n * @typedef {Object} EsriJSONMultiPolygon\n * @property {Array<Array<Array<Array<number>>>>} rings Rings for the MultiPolygon.\n * @property {boolean} [hasM] If the polygon coordinates have an M value.\n * @property {boolean} [hasZ] If the polygon coordinates have a Z value.\n * @property {EsriJSONSpatialReferenceWkid} [spatialReference] The coordinate reference system.\n */\n\n/**\n * @const\n * @type {Object<import(\"../geom/Geometry.js\").Type, function(EsriJSONGeometry): import(\"../geom/Geometry.js\").default>}\n */\nconst GEOMETRY_READERS = {\n  Point: readPointGeometry,\n  LineString: readLineStringGeometry,\n  Polygon: readPolygonGeometry,\n  MultiPoint: readMultiPointGeometry,\n  MultiLineString: readMultiLineStringGeometry,\n  MultiPolygon: readMultiPolygonGeometry,\n};\n\n/**\n * @const\n * @type {Object<import(\"../geom/Geometry.js\").Type, function(import(\"../geom/Geometry.js\").default, import(\"./Feature.js\").WriteOptions=): (EsriJSONGeometry)>}\n */\nconst GEOMETRY_WRITERS = {\n  Point: writePointGeometry,\n  LineString: writeLineStringGeometry,\n  Polygon: writePolygonGeometry,\n  MultiPoint: writeMultiPointGeometry,\n  MultiLineString: writeMultiLineStringGeometry,\n  MultiPolygon: writeMultiPolygonGeometry,\n};\n\n/**\n * @typedef {Object} Options\n * @property {string} [geometryName] Geometry name to use when creating features.\n */\n\n/**\n * @classdesc\n * Feature format for reading and writing data in the EsriJSON format.\n *\n * @api\n */\nclass EsriJSON extends JSONFeature {\n  /**\n   * @param {Options} [options] Options.\n   */\n  constructor(options) {\n    options = options ? options : {};\n\n    super();\n\n    /**\n     * Name of the geometry attribute for features.\n     * @type {string|undefined}\n     * @private\n     */\n    this.geometryName_ = options.geometryName;\n  }\n\n  /**\n   * @param {Object} object Object.\n   * @param {import(\"./Feature.js\").ReadOptions} [options] Read options.\n   * @param {string} [idField] Name of the field where to get the id from.\n   * @protected\n   * @return {import(\"../Feature.js\").default} Feature.\n   */\n  readFeatureFromObject(object, options, idField) {\n    const esriJSONFeature = /** @type {EsriJSONFeature} */ (object);\n    const geometry = readGeometry(esriJSONFeature.geometry, options);\n    const feature = new Feature();\n    if (this.geometryName_) {\n      feature.setGeometryName(this.geometryName_);\n    }\n    feature.setGeometry(geometry);\n    if (esriJSONFeature.attributes) {\n      feature.setProperties(esriJSONFeature.attributes, true);\n      const id = esriJSONFeature.attributes[idField];\n      if (id !== undefined) {\n        feature.setId(/** @type {number} */ (id));\n      }\n    }\n    return feature;\n  }\n\n  /**\n   * @param {Object} object Object.\n   * @param {import(\"./Feature.js\").ReadOptions} [options] Read options.\n   * @protected\n   * @return {Array<Feature>} Features.\n   */\n  readFeaturesFromObject(object, options) {\n    options = options ? options : {};\n    if (object['features']) {\n      const esriJSONFeatureSet = /** @type {EsriJSONFeatureSet} */ (object);\n      /** @type {Array<import(\"../Feature.js\").default>} */\n      const features = [];\n      const esriJSONFeatures = esriJSONFeatureSet.features;\n      for (let i = 0, ii = esriJSONFeatures.length; i < ii; ++i) {\n        features.push(\n          this.readFeatureFromObject(\n            esriJSONFeatures[i],\n            options,\n            object.objectIdFieldName\n          )\n        );\n      }\n      return features;\n    }\n    return [this.readFeatureFromObject(object, options)];\n  }\n\n  /**\n   * @param {EsriJSONGeometry} object Object.\n   * @param {import(\"./Feature.js\").ReadOptions} [options] Read options.\n   * @protected\n   * @return {import(\"../geom/Geometry.js\").default} Geometry.\n   */\n  readGeometryFromObject(object, options) {\n    return readGeometry(object, options);\n  }\n\n  /**\n   * @param {Object} object Object.\n   * @protected\n   * @return {import(\"../proj/Projection.js\").default} Projection.\n   */\n  readProjectionFromObject(object) {\n    if (\n      object['spatialReference'] &&\n      object['spatialReference']['wkid'] !== undefined\n    ) {\n      const spatialReference = /** @type {EsriJSONSpatialReferenceWkid} */ (\n        object['spatialReference']\n      );\n      const crs = spatialReference.wkid;\n      return getProjection('EPSG:' + crs);\n    }\n    return null;\n  }\n\n  /**\n   * Encode a geometry as a EsriJSON object.\n   *\n   * @param {import(\"../geom/Geometry.js\").default} geometry Geometry.\n   * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n   * @return {EsriJSONGeometry} Object.\n   * @api\n   */\n  writeGeometryObject(geometry, options) {\n    return writeGeometry(geometry, this.adaptOptions(options));\n  }\n\n  /**\n   * Encode a feature as a esriJSON Feature object.\n   *\n   * @param {import(\"../Feature.js\").default} feature Feature.\n   * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n   * @return {Object} Object.\n   * @api\n   */\n  writeFeatureObject(feature, options) {\n    options = this.adaptOptions(options);\n    const object = {};\n    if (!feature.hasProperties()) {\n      object['attributes'] = {};\n      return object;\n    }\n    const properties = feature.getProperties();\n    const geometry = feature.getGeometry();\n    if (geometry) {\n      object['geometry'] = writeGeometry(geometry, options);\n      const projection =\n        options && (options.dataProjection || options.featureProjection);\n      if (projection) {\n        object['geometry']['spatialReference'] =\n          /** @type {EsriJSONSpatialReferenceWkid} */ ({\n            wkid: Number(getProjection(projection).getCode().split(':').pop()),\n          });\n      }\n      delete properties[feature.getGeometryName()];\n    }\n    if (!isEmpty(properties)) {\n      object['attributes'] = properties;\n    } else {\n      object['attributes'] = {};\n    }\n    return object;\n  }\n\n  /**\n   * Encode an array of features as a EsriJSON object.\n   *\n   * @param {Array<import(\"../Feature.js\").default>} features Features.\n   * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n   * @return {EsriJSONFeatureSet} EsriJSON Object.\n   * @api\n   */\n  writeFeaturesObject(features, options) {\n    options = this.adaptOptions(options);\n    const objects = [];\n    for (let i = 0, ii = features.length; i < ii; ++i) {\n      objects.push(this.writeFeatureObject(features[i], options));\n    }\n    return {\n      'features': objects,\n    };\n  }\n}\n\n/**\n * @param {EsriJSONGeometry} object Object.\n * @param {import(\"./Feature.js\").ReadOptions} [options] Read options.\n * @return {import(\"../geom/Geometry.js\").default} Geometry.\n */\nfunction readGeometry(object, options) {\n  if (!object) {\n    return null;\n  }\n  /** @type {import(\"../geom/Geometry.js\").Type} */\n  let type;\n  if (typeof object['x'] === 'number' && typeof object['y'] === 'number') {\n    type = 'Point';\n  } else if (object['points']) {\n    type = 'MultiPoint';\n  } else if (object['paths']) {\n    const esriJSONPolyline = /** @type {EsriJSONPolyline} */ (object);\n    if (esriJSONPolyline.paths.length === 1) {\n      type = 'LineString';\n    } else {\n      type = 'MultiLineString';\n    }\n  } else if (object['rings']) {\n    const esriJSONPolygon = /** @type {EsriJSONPolygon} */ (object);\n    const layout = getGeometryLayout(esriJSONPolygon);\n    const rings = convertRings(esriJSONPolygon.rings, layout);\n    if (rings.length === 1) {\n      type = 'Polygon';\n      object = Object.assign({}, object, {['rings']: rings[0]});\n    } else {\n      type = 'MultiPolygon';\n      object = Object.assign({}, object, {['rings']: rings});\n    }\n  }\n  const geometryReader = GEOMETRY_READERS[type];\n  return transformGeometryWithOptions(geometryReader(object), false, options);\n}\n\n/**\n * Determines inner and outer rings.\n * Checks if any polygons in this array contain any other polygons in this\n * array. It is used for checking for holes.\n * Logic inspired by: https://github.com/Esri/terraformer-arcgis-parser\n * @param {Array<!Array<!Array<number>>>} rings Rings.\n * @param {import(\"../geom/Geometry.js\").GeometryLayout} layout Geometry layout.\n * @return {Array<!Array<!Array<!Array<number>>>>} Transformed rings.\n */\nfunction convertRings(rings, layout) {\n  const flatRing = [];\n  const outerRings = [];\n  const holes = [];\n  let i, ii;\n  for (i = 0, ii = rings.length; i < ii; ++i) {\n    flatRing.length = 0;\n    deflateCoordinates(flatRing, 0, rings[i], layout.length);\n    // is this ring an outer ring? is it clockwise?\n    const clockwise = linearRingIsClockwise(\n      flatRing,\n      0,\n      flatRing.length,\n      layout.length\n    );\n    if (clockwise) {\n      outerRings.push([rings[i]]);\n    } else {\n      holes.push(rings[i]);\n    }\n  }\n  while (holes.length) {\n    const hole = holes.shift();\n    let matched = false;\n    // loop over all outer rings and see if they contain our hole.\n    for (i = outerRings.length - 1; i >= 0; i--) {\n      const outerRing = outerRings[i][0];\n      const containsHole = containsExtent(\n        new LinearRing(outerRing).getExtent(),\n        new LinearRing(hole).getExtent()\n      );\n      if (containsHole) {\n        // the hole is contained push it into our polygon\n        outerRings[i].push(hole);\n        matched = true;\n        break;\n      }\n    }\n    if (!matched) {\n      // no outer rings contain this hole turn it into and outer\n      // ring (reverse it)\n      outerRings.push([hole.reverse()]);\n    }\n  }\n  return outerRings;\n}\n\n/**\n * @param {EsriJSONPoint} object Object.\n * @return {import(\"../geom/Geometry.js\").default} Point.\n */\nfunction readPointGeometry(object) {\n  let point;\n  if (object.m !== undefined && object.z !== undefined) {\n    point = new Point([object.x, object.y, object.z, object.m], 'XYZM');\n  } else if (object.z !== undefined) {\n    point = new Point([object.x, object.y, object.z], 'XYZ');\n  } else if (object.m !== undefined) {\n    point = new Point([object.x, object.y, object.m], 'XYM');\n  } else {\n    point = new Point([object.x, object.y]);\n  }\n  return point;\n}\n\n/**\n * @param {EsriJSONPolyline} object Object.\n * @return {import(\"../geom/Geometry.js\").default} LineString.\n */\nfunction readLineStringGeometry(object) {\n  const layout = getGeometryLayout(object);\n  return new LineString(object.paths[0], layout);\n}\n\n/**\n * @param {EsriJSONPolyline} object Object.\n * @return {import(\"../geom/Geometry.js\").default} MultiLineString.\n */\nfunction readMultiLineStringGeometry(object) {\n  const layout = getGeometryLayout(object);\n  return new MultiLineString(object.paths, layout);\n}\n\n/**\n * @param {EsriJSONHasZM} object Object.\n * @return {import(\"../geom/Geometry.js\").GeometryLayout} The geometry layout to use.\n */\nfunction getGeometryLayout(object) {\n  /** @type {import(\"../geom/Geometry.js\").GeometryLayout} */\n  let layout = 'XY';\n  if (object.hasZ === true && object.hasM === true) {\n    layout = 'XYZM';\n  } else if (object.hasZ === true) {\n    layout = 'XYZ';\n  } else if (object.hasM === true) {\n    layout = 'XYM';\n  }\n  return layout;\n}\n\n/**\n * @param {EsriJSONMultipoint} object Object.\n * @return {import(\"../geom/Geometry.js\").default} MultiPoint.\n */\nfunction readMultiPointGeometry(object) {\n  const layout = getGeometryLayout(object);\n  return new MultiPoint(object.points, layout);\n}\n\n/**\n * @param {EsriJSONMultiPolygon} object Object.\n * @return {import(\"../geom/Geometry.js\").default} MultiPolygon.\n */\nfunction readMultiPolygonGeometry(object) {\n  const layout = getGeometryLayout(object);\n  return new MultiPolygon(object.rings, layout);\n}\n\n/**\n * @param {EsriJSONPolygon} object Object.\n * @return {import(\"../geom/Geometry.js\").default} Polygon.\n */\nfunction readPolygonGeometry(object) {\n  const layout = getGeometryLayout(object);\n  return new Polygon(object.rings, layout);\n}\n\n/**\n * @param {import(\"../geom/Point.js\").default} geometry Geometry.\n * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n * @return {EsriJSONPoint} EsriJSON geometry.\n */\nfunction writePointGeometry(geometry, options) {\n  const coordinates = geometry.getCoordinates();\n  /** @type {EsriJSONPoint} */\n  let esriJSON;\n  const layout = geometry.getLayout();\n  if (layout === 'XYZ') {\n    esriJSON = {\n      x: coordinates[0],\n      y: coordinates[1],\n      z: coordinates[2],\n    };\n  } else if (layout === 'XYM') {\n    esriJSON = {\n      x: coordinates[0],\n      y: coordinates[1],\n      m: coordinates[2],\n    };\n  } else if (layout === 'XYZM') {\n    esriJSON = {\n      x: coordinates[0],\n      y: coordinates[1],\n      z: coordinates[2],\n      m: coordinates[3],\n    };\n  } else if (layout === 'XY') {\n    esriJSON = {\n      x: coordinates[0],\n      y: coordinates[1],\n    };\n  } else {\n    assert(false, 34); // Invalid geometry layout\n  }\n  return esriJSON;\n}\n\n/**\n * @param {import(\"../geom/SimpleGeometry.js\").default} geometry Geometry.\n * @return {Object} Object with boolean hasZ and hasM keys.\n */\nfunction getHasZM(geometry) {\n  const layout = geometry.getLayout();\n  return {\n    hasZ: layout === 'XYZ' || layout === 'XYZM',\n    hasM: layout === 'XYM' || layout === 'XYZM',\n  };\n}\n\n/**\n * @param {import(\"../geom/LineString.js\").default} lineString Geometry.\n * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n * @return {EsriJSONPolyline} EsriJSON geometry.\n */\nfunction writeLineStringGeometry(lineString, options) {\n  const hasZM = getHasZM(lineString);\n  return {\n    hasZ: hasZM.hasZ,\n    hasM: hasZM.hasM,\n    paths: [\n      /** @type {Array<EsriJSONPosition>} */ (lineString.getCoordinates()),\n    ],\n  };\n}\n\n/**\n * @param {import(\"../geom/Polygon.js\").default} polygon Geometry.\n * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n * @return {EsriJSONPolygon} EsriJSON geometry.\n */\nfunction writePolygonGeometry(polygon, options) {\n  // Esri geometries use the left-hand rule\n  const hasZM = getHasZM(polygon);\n  return {\n    hasZ: hasZM.hasZ,\n    hasM: hasZM.hasM,\n    rings: /** @type {Array<Array<EsriJSONPosition>>} */ (\n      polygon.getCoordinates(false)\n    ),\n  };\n}\n\n/**\n * @param {import(\"../geom/MultiLineString.js\").default} multiLineString Geometry.\n * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n * @return {EsriJSONPolyline} EsriJSON geometry.\n */\nfunction writeMultiLineStringGeometry(multiLineString, options) {\n  const hasZM = getHasZM(multiLineString);\n  return {\n    hasZ: hasZM.hasZ,\n    hasM: hasZM.hasM,\n    paths: /** @type {Array<Array<EsriJSONPosition>>} */ (\n      multiLineString.getCoordinates()\n    ),\n  };\n}\n\n/**\n * @param {import(\"../geom/MultiPoint.js\").default} multiPoint Geometry.\n * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n * @return {EsriJSONMultipoint} EsriJSON geometry.\n */\nfunction writeMultiPointGeometry(multiPoint, options) {\n  const hasZM = getHasZM(multiPoint);\n  return {\n    hasZ: hasZM.hasZ,\n    hasM: hasZM.hasM,\n    points: /** @type {Array<EsriJSONPosition>} */ (\n      multiPoint.getCoordinates()\n    ),\n  };\n}\n\n/**\n * @param {import(\"../geom/MultiPolygon.js\").default} geometry Geometry.\n * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n * @return {EsriJSONPolygon} EsriJSON geometry.\n */\nfunction writeMultiPolygonGeometry(geometry, options) {\n  const hasZM = getHasZM(geometry);\n  const coordinates = geometry.getCoordinates(false);\n  const output = [];\n  for (let i = 0; i < coordinates.length; i++) {\n    for (let x = coordinates[i].length - 1; x >= 0; x--) {\n      output.push(coordinates[i][x]);\n    }\n  }\n  return {\n    hasZ: hasZM.hasZ,\n    hasM: hasZM.hasM,\n    rings: /** @type {Array<Array<EsriJSONPosition>>} */ (output),\n  };\n}\n\n/**\n * @param {import(\"../geom/Geometry.js\").default} geometry Geometry.\n * @param {import(\"./Feature.js\").WriteOptions} [options] Write options.\n * @return {EsriJSONGeometry} EsriJSON geometry.\n */\nfunction writeGeometry(geometry, options) {\n  const geometryWriter = GEOMETRY_WRITERS[geometry.getType()];\n  return geometryWriter(\n    transformGeometryWithOptions(geometry, true, options),\n    options\n  );\n}\n\nexport default EsriJSON;\n","import { useSlots, onBeforeMount, onMounted, onBeforeUnmount, ref, reactive, computed, watch, nextTick, defineAsyncComponent, useCssModule, inject, getCurrentInstance } from 'vue'\nimport $ from 'jquery'\n\nimport { Map, View, Feature } from 'ol' // 引入容器绑定模塊和視圖模塊\n\nimport { TileArcGISRest } from 'ol/source.js'\n\nimport XYZ from 'ol/source/XYZ' // 引入XYZ地圖格式\nimport VectorSource from 'ol/source/Vector.js'\nimport { Fill, Stroke, Style, Icon } from 'ol/style.js'\nimport { Tile, Tile as TileLayer, Image as ImageLayer, Vector, Vector as VectorLayer } from 'ol/layer.js'\nimport TileWMS from 'ol/source/TileWMS.js'\nimport ImageWMS from 'ol/source/ImageWMS.js'\nimport TileGrid from 'ol/tilegrid/TileGrid.js'\nimport * as olTilegrid from 'ol/tilegrid'\nimport * as olProj from 'ol/proj'\n\nimport { ImageArcGISRest, OSM } from 'ol/source.js'\nimport PerspectiveMap from \"ol-ext/map/PerspectiveMap\"\n\nimport WFS from 'ol/format/WFS.js'\nimport EsriJSON from 'ol/format/EsriJSON.js'\nimport { createXYZ } from 'ol/tilegrid.js'\nimport { tile as tileStrategy } from 'ol/loadingstrategy.js'\nimport { Circle, Polygon, Point } from 'ol/geom.js'\nimport Projection from 'ol/proj/Projection.js'\nimport GeoJSON from 'ol/format/GeoJSON.js'\n\nimport 'ol/ol.css' // ol提供的css样式\nimport { format } from 'ol/coordinate'\nimport { get as getProjection, transformExtent } from 'ol/proj.js'\nimport { getTopLeft, getWidth } from 'ol/extent.js'\n\nexport const initLayers = async function() {\n    const obj = await $.ajax({\n        url: 'https://api.edtest.site/layers',\n        method: 'GET'\n    })\n    return obj\n}\n\nexport async function getTribeData (tribeId) {\n    const result = await $.ajax({\n        url: `https://api.edtest.site/tribe?tribeCode=${tribeId}`,\n        method: \"GET\"\n    }).done(res => {\n        return res\n        }).fail(FailMethod => {\n        console.log('Fail', FailMethod)\n        return false\n        })\n    return result\n}\n\nexport default {\n    america: () => {\n        return new TileLayer({\n            name: 'america',\n            className: 'america',\n            preload: Infinity,\n            source: new TileArcGISRest({\n                url: 'https://sampleserver6.arcgisonline.com/ArcGIS/rest/services/' + 'USA/MapServer',\n            }),\n        })\n    },\n    EsriJSON: () => {\n        const serviceUrl = 'https://services8.arcgis.com/jz4Cju60Wi6R7jAW/arcgis/rest/services/' + 'RIVERPOLY_(1)/FeatureServer/0'\n        const style = new Style({\n            fill: new Fill(),\n            stroke: new Stroke({\n                color: [0, 38, 115, 1],\n                width: 0.5,\n            }),\n        });\n\n        const newVectorSource = new VectorSource({\n            format: new EsriJSON(),\n            url: function (extent, resolution, projection) {\n                const srid = projection.getCode().split(/:(?=\\d+$)/).pop();\n                const url = serviceUrl + '/query/?f=json&' + 'returnGeometry=true&spatialRel=esriSpatialRelIntersects&geometry=' +\n                    encodeURIComponent(`{\"xmin\":${extent[0]},\"ymin\":${extent[1]},\"xmax\":${extent[2]},\"ymax\":${extent[3]},\"spatialReference\":{\"wkid\":${srid}}}`) +\n                    '&geometryType=esriGeometryEnvelope&inSR=' + srid + '&outFields=*' + '&outSR=' + srid;\n                return url;\n            },\n            strategy: tileStrategy(\n                createXYZ({\n                    tileSize: 512,\n                })\n            ),\n        });\n\n        return new VectorLayer({\n            name: 'EsriJSON',\n            source: newVectorSource,\n            style: function (feature) {\n                const color = [0, 38, 115, 1];\n                style.getFill().setColor(color);\n                return style;\n            },\n            opacity: 0.7,\n        });\n    },\n    BsriJSON: () => {\n        const serviceUrl = 'https://services8.arcgis.com/jz4Cju60Wi6R7jAW/arcgis/rest/services/' + '河川支流/FeatureServer/0'\n        const style = new Style({\n            fill: new Fill(),\n            stroke: new Stroke({\n                color: [0, 0, 0, 1],\n                width: 0.5,\n            }),\n        });\n\n        const newVectorSource = new VectorSource({\n            format: new EsriJSON(),\n            url: function (extent, resolution, projection) {\n                const srid = projection.getCode().split(/:(?=\\d+$)/).pop();\n                const url = serviceUrl + '/query/?f=json&' + 'returnGeometry=true&spatialRel=esriSpatialRelIntersects&geometry=' +\n                    encodeURIComponent(`{\"xmin\":${extent[0]},\"ymin\":${extent[1]},\"xmax\":${extent[2]},\"ymax\":${extent[3]},\"spatialReference\":{\"wkid\":${srid}}}`) +\n                    '&geometryType=esriGeometryEnvelope&inSR=' + srid + '&outFields=*' + '&outSR=' + srid;\n                return url;\n            },\n            strategy: tileStrategy(\n                createXYZ({\n                    tileSize: 512,\n                })\n            ),\n        });\n\n        return new VectorLayer({\n            name: 'BsriJSON',\n            type: 'BsriJSON',\n            source: newVectorSource,\n            style: function (feature) {\n                const color = [0, 0, 0, 1];\n                style.getFill().setColor(color);\n                return style;\n            },\n            opacity: 1,\n        });\n    },\n    DimensionMap: () => {\n        const circleFeature = new Feature({\n            name: 'DimensionMap',\n            title: 'DimensionMap',\n            geometry: new Circle([120.9984423386347, 24.791781619336316], 0.005),\n        })\n\n        const circleStyle = new Style({\n            renderer(coordinates, state) {\n                const [[x, y], [x1, y1]] = coordinates;\n                const ctx = state.context;\n                const dx = x1 - x;\n                const dy = y1 - y;\n                const radius = Math.sqrt(dx * dx + dy * dy);\n                ctx.beginPath();\n                ctx.arc(x, y, radius, 0, 2 * Math.PI, true);\n                ctx.fillStyle = 'rgba(255,0,0)';\n                ctx.fill();\n            },\n        })\n        const raster = new VectorLayer({\n            source: new VectorSource({\n                features: [circleFeature],\n            }),\n            style: circleStyle\n        })\n\n        const coordinates = [\n            [120.971859, 24.801583],\n            [120.970000, 24.809583],\n            [120.985000, 24.808583],\n            [120.990000, 24.806583],\n            [120.971859, 24.801583]\n        ]\n\n\n        const areaLineLayer = new Vector({\n            name: 'DimensionMap',\n            title: 'DimensionMap',\n            source: new VectorSource({\n                features: [new Feature({\n                    name: 'areaLineLayer',\n                    title: 'areaLineLayer',\n                    geometry: new Polygon([coordinates]),\n                })],\n            }),\n            style: new Style({\n                fill: new Fill({\n                    color: '#0f9ce2'\n                }),\n            })\n        })\n\n        return [raster, areaLineLayer]\n        // 關閉地圖細節事件\n    },\n    getLayer: (layer, nestedSubNodeIndex, id) => {\n        let result, layerSource\n        let layerType = layer.layer_type\n        let figureType = layer.figure_type\n        if (layerType === 'WMS') {\n            let request = []\n            const url = layer.single_tiles ? layer.tiles_url : layer.tiles_list[nestedSubNodeIndex].tile_url\n            switch (figureType) {\n                case 'Point':\n                    if ( url ) {\n                        const api = new URL(url)\n                        // 取得網址部分\n                        const origin = api.origin\n                        const pathname = api.pathname\n\n                        // 取得query參數\n                        const searchParams = api.searchParams;\n                        const searchParamsObject = {};\n                        for (const [key, value] of searchParams.entries()) {\n                            searchParamsObject[key] = value;\n                        }\n                        request[0] = origin + pathname\n                        request[1] = searchParamsObject\n                    }\n                    layerSource = new TileWMS({\n                        maxzoom: 18,\n                        minzoom: 3,\n                        url: request[0],\n                        params: request[1],\n                        serverType: 'mapserver',\n                        crossOrigin: 'anonymous',\n                    })\n                    break;\n                case 'Surface':\n                    if ( url ) {\n                        const api = new URL(url)\n                        // 取得網址部分\n                        const origin = api.origin\n                        const pathname = api.pathname\n\n                        // 取得query參數\n                        const searchParams = api.searchParams;\n                        const searchParamsObject = {};\n                        for (const [key, value] of searchParams.entries()) {\n                            searchParamsObject[key] = value;\n                        }\n                        request[0] = origin + pathname\n                        request[1] = searchParamsObject\n                    }\n                    layerSource = new TileWMS({\n                        maxzoom: 18,\n                        minzoom: 3,\n                        url: request[0],\n                        params:  request[1],\n                        serverType: 'mapserver'\n                    })\n                    break;\n                    case 'Line':\n                        // 活動斷層\n                        if ( url ) {\n                            const api = new URL(url)\n                            // 取得網址部分\n                            const origin = api.origin\n                            const pathname = api.pathname\n\n                            // 取得query參數\n                            const searchParams = api.searchParams;\n                            const searchParamsObject = {};\n                            for (const [key, value] of searchParams.entries()) {\n                                searchParamsObject[key] = value;\n                            }\n                            request[0] = origin + pathname\n                            request[1] = searchParamsObject\n                        }\n                        layerSource = new TileWMS({\n                            maxzoom: 18,\n                            minzoom: 3,\n                            url: request[0],\n                            params: request[1],\n                            serverType: 'mapserver'\n                        })\n                        break;\n                default:\n                    console.log('otherWMSLayer', figureType)\n            }\n            let tileTitle = layer.single_tiles ? '' : `- ${ layer.tiles_list[nestedSubNodeIndex]?.title }`\n            result = new TileLayer({\n                id: id,\n                label: `${ layer.title } ${ tileTitle }`,\n                source: new TileWMS({\n                    name: layer.title,\n                    url: layerSource.getUrls()[0],\n                    params: layerSource.getParams(),\n                    serverType: 'geoserver',\n                    crossOrigin: 'anonymous',\n                }),\n            })\n        }\n        // needfix: 結構混亂\n        if (layerType === 'GeoJson') {\n            console.log('GeoJsonLayer', figureType)\n            switch (figureType) {\n                case 'Line':\n                    result = new VectorLayer({\n                        source: new VectorSource({\n                            url: 'http://gis.edtest.site:8010/ogc/temp',\n                            params: {\n                                // http://gis.edtest.site:8010/ogc/temp\n                                SERVICE: 'WMS',\n                                VERSION: '1.3.0',\n                                REQUEST: 'GetMap',\n                                FORMAT: 'image/png',\n                                STYLE: 'default',\n                                SLD_VERSION: '1.1.0'\n                                // LAYER: '%E6%96%B0%E7%AB%B9%E7%B8%A3%E5%8E%9F%E4%BD%8F%E6%B0%91%E9%83%A8%E8%90%BD%E7%AF%84%E5%9C%8D',\n                            }\n                            // url: 'https://dmap.ncdr.nat.gov.tw/GeoJson/土石流潛勢溪流.geojson',\n                            // url: 'https://openlyersbook.github.io/openlayers_book_samples/assets/data/countries.geojson',\n                            // format: new GeoJSON(),\n                        }),\n                    });\n                    break;\n                case 'Point':\n                    const wmsSource = new TileWMS({\n                        maxzoom: 18,\n                        minzoom: 3,\n                        url: 'https://dwgis1.ncdr.nat.gov.tw/server/services/MAP0627/Map2022FloodingPoint1721/MapServer/WMSServer',\n                        params: {\n                            'SERVICE': 'WMS',\n                            'BGCOLOR': '0xFFFFFF',\n                            'TRANSPARENT': 'TRUE',\n                            'SRS': 'EPSG:3826',\n                            'LAYERS': '0',\n                            'VERSION': '1.1.1',\n                            'FORMAT': 'image/png',\n                        },\n                        crossOrigin: 'anonymous',\n                    })\n                    result = new TileLayer({\n                        source: wmsSource,\n                    })\n\n                    // help_btn_display:true\n                    // help_memo:\"<p>資料來源:國家災害防救科技中心</p>\\n<p>收整水利署、新聞、媒體及現勘資料2017年~2021年</p>\"\n                    break;\n                default:\n                    console.log(figureType)\n            }\n        }\n\n        return result\n    },\n    getLayerIndex: (layeredIndex) => {\n        let nodeIndex, subNodeIndex = undefined, nestedSubNodeIndex = undefined\n        layeredIndex.split('_').forEach((element, key)=>{\n            switch(key) {\n                case 0:\n                    nodeIndex = Number(element.split('node')[1])\n                    break;\n                case 1:\n                    subNodeIndex = Number(element.split('subNode')[1])\n                    break;\n                case 2:\n                    nestedSubNodeIndex = element.split('nestedSubNode')[1] !== 'undefined' ? Number(element.split('nestedSubNode')[1]) : 'undefined'\n                    break;\n            }\n        })\n        return {nodeIndex, subNodeIndex, nestedSubNodeIndex, layeredIndex}\n    },\n}\n\n\n// [230, 0, 0, 1] 紅色\n// [104, 104, 104, 1] 灰色\n// [115, 76, 0, 1] 土黃色","<script>\nimport { useSlots, onBeforeMount, onMounted, onBeforeUnmount, ref, reactive, computed, watch, nextTick, defineAsyncComponent, useCssModule, inject } from 'vue'\nimport $ from 'jquery'\n\nimport mapLayerList, { initLayers } from '@/config/mapLayerList'\nimport baseMapList from '@/config/baseMapList'\nimport VectorImageLayer from 'ol/layer/VectorImage.js'\nimport TileState from 'ol/TileState.js'\nimport { useRouter } from 'vue-router'\n\n\nimport 'ol-ext/dist/ol-ext.css'\n\nexport default {\n    props: {\n        onClose: {\n            type: Function,\n            default: () => {}\n        },\n        mapLayers: {\n            type: Array,\n            default: []\n        },\n        currentLayers: {\n            type: Array,\n            default: []\n        },\n        showSelectLayerValue: {\n            type: Function,\n            default: () => {}\n        },\n    },\n    setup(props, { emit }) {\n        const mapLayers = mapLayerList\n        const router = useRouter()\n        const state = reactive({\n            DropDown: null,\n            TilesListValue: 0\n        })\n\n        function onMapControl(action, value) {\n            emit('onMapControl', { action, value })\n        }\n\n        function onLayerControl(action, value) {\n            emit('onLayerControl', { action, value })\n        }\n        function openLayerList(value) {\n            if (state.DropDown !== value) {\n                state.DropDown = value\n            } else {\n                state.DropDown = null\n            }\n        }\n        function LayerCheckBoxChange(e, item) {\n            let defaultChecked = e.target.checked || ((typeof e.target.checked == 'undefined') ? true : false )\n            onLayerControl('layerMode', {\n                checked: defaultChecked,\n                nodeIndex: item.nodeIndex,\n                subNodeIndex: item.subNodeIndex,\n                nestedSubNodeIndex: String(item.nestedSubNodeIndex) ? item.nestedSubNodeIndex : undefined,\n                nestedSubNode: String(item.nestedSubNodeIndex) ? true : false,\n                id: item.id\n            })\n        }\n\n        function checkTribe(e) {\n            let defaultChecked = e.target.checked || ((typeof e.target.checked == 'undefined') ? true : false )\n            onLayerControl('layerMode', {\n                checked: defaultChecked,\n            })\n        }\n\n        watch(()=>state.TilesListValue, (newVal , oldVal)=>{\n            props.showSelectLayerValue(newVal)\n        })\n\n        return {\n            props,\n            state,\n            router,\n            mapLayers,\n            onMapControl,\n            onLayerControl,\n            openLayerList,\n            LayerCheckBoxChange,\n            checkTribe\n        }\n    }\n}\n</script>\n\n<template>\n    <div class=\"rounded-4 bg-white\">\n        <div class=\"row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold border-bottom\">\n            <p class=\"mb-0 fs-5\">圖層選項</p>\n            {{ state.TilesListValue }}\n            <a href=\"\" class=\"closeBtn position-absolute col-auto\" @click.prevent=\"props.onClose\">\n                <svg width=\"32\" height=\"32\" viewBox=\"0 0 24 24\">\n                    <path fill=\"currentColor\"\n                        d=\"M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10zm0-11.414L9.172 7.757L7.757 9.172L10.586 12l-2.829 2.828l1.415 1.415L12 13.414l2.828 2.829l1.415-1.415L13.414 12l2.829-2.828l-1.415-1.415L12 10.586z\" />\n                </svg>\n            </a>\n        </div>\n        <div class=\"py-3 px-4 content\">\n            <div class=\"mb-2 landBoundary\">\n                <div @click=\"router.push({ path: '/Map_Demo/detail' })\" class=\"my-3 fw-bold h5 text-primary cursor-pointer\">前往地圖細節</div>\n                <div v-for=\"(node, nodeIndex) in props.mapLayers\" class=\"mb-2\">\n                    <div class=\"title d-flex align-items-center fw-bold text-black order-1 mb-1 text-decoration-none\"\n                        @click=\"openLayerList(nodeIndex)\">\n                        <div :class=\"node.groupClass\"></div>\n                        <div>{{ node.label }}</div>\n                        <svg viewBox=\"0 0 24 24\" :class=\"{ 'openTitle': state.DropDown == nodeIndex }\">\n                            <path fill=\"currentColor\" d=\"M8 5v14l11-7z\" />\n                        </svg>\n                    </div>\n                    <div class=\"ms-3 mb-1\" v-for=\"(subNode, subNodeIndex) in node.layers\" v-if=\"state.DropDown == nodeIndex\">\n                        <div v-if=\"subNode.single_tiles\">\n                            <input type=\"checkbox\"\n                            :checked=\"props.currentLayers.some(node=> node.id === subNode.id)\"\n                            @change=\"(e) => {\n                                LayerCheckBoxChange(e, {\n                                    nodeIndex: nodeIndex,\n                                    subNode: subNode,\n                                    subNodeIndex: subNodeIndex,\n                                    nestedSubNodeIndex: '',\n                                    id: subNode.id\n                                })\n                            }\">\n                            {{ subNode.title }}\n                        </div>\n                        <div v-else>\n                            <input type=\"checkbox\"\n                            :checked=\"props.currentLayers.some(node=> node.id === subNode.id)\"\n                            @change=\"(e) => {\n                                LayerCheckBoxChange(e, {\n                                    nodeIndex: nodeIndex,\n                                    subNode: subNode,\n                                    subNodeIndex: subNodeIndex,\n                                    nestedSubNodeIndex: '',\n                                    id: subNode.id\n                                })\n                            }\">\n                            {{ subNode.title }}\n                                <select name=\"\" id=\"\" class=\"ms-3\"\n                                v-model=\"state.TilesListValue\"\n                                @change=\"(e) => {\n                                    LayerCheckBoxChange(e, {\n                                        nodeIndex: nodeIndex,\n                                        subNode: subNode,\n                                        subNodeIndex: subNodeIndex,\n                                        nestedSubNodeIndex: state.TilesListValue,\n                                        id: subNode.id\n                                    })\n                                }\">\n                                    <option :value=\"key\" v-for=\"(item, key) in subNode.tiles_list\">{{ item.title }}</option>\n                                </select>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</template>\n\n<style lang=\"sass\" scoped>\n// @import '@/assets/styles/all.module.scss'\n.closeBtn\n    right:10px\n    svg\n        width: 20px\n        height: 20px\n.content\n    .title\n        cursor: pointer\n        svg\n            transform: rotateZ(0)\n        .openTitle\n            transform: rotateZ(90deg)\n    svg\n        width: 20px\n        height: 20px\n    img\n        width: 16px\n        height: 16px\n    .wrap\n        display: none\n</style>","export default \"__VITE_ASSET__a8c0f6d0__\"","export default \"__VITE_ASSET__630fe15b__\"","export default \"__VITE_ASSET__7e8d4017__\"","export default \"__VITE_ASSET__0ebcb08a__\"","export default \"__VITE_ASSET__185ae262__\"","<script>\nimport { useSlots, onBeforeMount, onMounted, onBeforeUnmount, ref, reactive, computed, watch, nextTick, defineAsyncComponent, useCssModule, inject } from 'vue'\nexport default {\n    props: {\n        id:{\n            Type: String,\n            default: 0\n        },\n        map:{}\n    },\n    setup(props, { emit }){\n\n        function onMapControl(action) {\n            emit('onMapControl', {action})\n        }\n\n        return {\n            onMapControl\n        }\n    }\n}\n\n</script>\n\n<template>\n    <div class=\"d-flex flex-nowrap flex-column\">\n        <a href=\"\" class=\"asideTool-btn order-1 mb-0\" @click.prevent=\"onMapControl('In')\">\n            <img src=\"@/assets/img/icon/zoomIn.svg\" alt=\"zoomIn\">\n        </a>\n        <a href=\"\" class=\"asideTool-btn order-1 mb-2\" @click.prevent=\"onMapControl('Out')\">\n            <img src=\"@/assets/img/icon/zoomOut.svg\" alt=\"zoomOut\">\n        </a>\n        <a href=\"\" class=\"asideTool-btn order-1 mb-2\" @click.prevent=\"onMapControl('toNorth')\">\n            <img src=\"@/assets/img/icon/compass.svg\" alt=\"compass\">\n        </a>\n        <a href=\"\" class=\"asideTool-btn order-1 mb-2\" @click.prevent=\"onMapControl('moveTo')\">\n            <img src=\"@/assets/img/icon/location.svg\" alt=\"location\">\n        </a>\n        <a href=\"\" class=\"asideTool-btn order-1 mb-2\" @click.prevent=\"onMapControl('fullScreen')\">\n            <img src=\"@/assets/img/icon/zoom.svg\" alt=\"zoom\">\n        </a>\n    </div>\n</template>\n\n<style lang=\"sass\">\n\n</style>\n","<script>\nimport { useSlots, onBeforeMount, onMounted, onBeforeUnmount, ref, reactive, computed, watch, nextTick, defineAsyncComponent, useCssModule, inject, getCurrentInstance } from 'vue'\nexport default {\n    props: {\n        baseMapsOptions: {\n            type: Array,\n            default: []\n        },\n        onChangeBaseMaps: {\n            type: Function,\n            default: ()=>{}\n        }\n    },\n    setup(props, { emit }) {\n        const state = reactive({\n            selectMap: props.baseMapsOptions[0]\n        })\n        function onChangeBaseMaps(name){\n            let action = 'baseMap'\n            let value = {\n                checked: true,\n                layerName: state.selectMap\n            }\n            emit('onChangeBaseMaps', { action, value })\n        }\n        return {\n            state,\n            props,\n            onChangeBaseMaps\n        }\n    }\n}\n</script>\n\n<template>\n    <div>\n        <select name=\"\" id=\"\" v-model=\"state.selectMap\"\n        @change=\"(e) => {\n            onChangeBaseMaps()\n        }\">\n            <option :value=\"node.name\" v-for=\"(node, node_i) in props.baseMapsOptions\">{{ node.label }}</option>\n        </select>\n    </div>\n</template>\n\n<style lang=\"sass\" scoped>\nselect\n    border: 0\n    box-shadow: 0px 4px 4px #999\n    border-radius: 5px\n    padding: 8px 20px\n    option\n        padding: 8px 20px\n</style>\n","export default \"__VITE_ASSET__4d1de3c5__\"","export default \"__VITE_ASSET__e0369fb4__\"","export default \"__VITE_ASSET__9216d299__\"","export default \"__VITE_ASSET__f20fa25d__\"","export default \"__VITE_ASSET__62f11e0f__\"","<script>\nimport { useSlots, onBeforeMount, onMounted, onBeforeUnmount, ref, reactive, computed, watch, nextTick, defineAsyncComponent, useCssModule, inject } from 'vue'\nimport $ from 'jquery'\n\nexport default {\n    props: {\n        currentLayers: {\n            type: Array,\n            default: []\n        },\n        mapCount: {\n            type: Number,\n            default: 1\n        },\n        dimensionMapStatus: {\n            type: Boolean,\n            default: false\n        }\n    },\n    setup(props, { emit }) {\n        const state = reactive({\n            toolSwitch: {\n                threeDimensionalBtn: false,\n                layerConditionBtn: false,\n                splitWindowBtn: false,\n            },\n            targetNum: 1,\n        })\n\n        function toolSwitch(target, value) {\n            // 其他全部關掉\n            Object.keys(state.toolSwitch).forEach(node => {\n                if (node === target) {\n                    if(state.toolSwitch[target]) {\n                        state.toolSwitch[target] = false\n                    } else {\n                        state.toolSwitch[target] = true\n                    }\n                } else {\n                    state.toolSwitch[node] = false\n                }\n            })\n        }\n        function onLayerControl(action, value) {\n            if (action === 'changeMapCount') {\n                state.toolSwitch['splitWindowBtn'] = false\n            }\n            emit('onLayerControl', { action, value })\n        }\n\n        function conditionWrap() {\n            emit('conditionWrap')\n        }\n\n        function onChangeTarget(value) {\n            state.targetNum = value\n            emit('onChangeTarget', value)\n        }\n\n        return {\n            props,\n            state,\n            toolSwitch,\n            onLayerControl,\n            conditionWrap,\n            onChangeTarget\n        }\n    }\n}\n</script>\n\n<template>\n    <div>\n        <ul class=\"list-unstyled d-flex align-items-center flex-nowrap w-full\">\n            <li class=\"me-4 position-relative\">\n                <div class=\"MapFeatureBtn text-white\">\n                    <a href=\"\" v-if=\"props.dimensionMapStatus\"\n                    @click.prevent=\"toolSwitch('threeDimensionalBtn'), onLayerControl('changeDimensionMap', '3D')\">\n                        <img src=\"@/assets/img/icon/twoDimensional.svg\">\n                    </a>\n                    <a href=\"\" v-else\n                    @click.prevent=\"toolSwitch('threeDimensionalBtn'), onLayerControl('changeDimensionMap', '2D')\">\n                        <img src=\"@/assets/img/icon/threeDimensional.svg\">\n                    </a>\n                </div>\n            </li>\n            <li class=\"me-4 position-relative\">\n                <a href=\"\" class=\"MapFeatureBtn text-white\"\n                    @click.prevent=\"toolSwitch('layerConditionBtn'), conditionWrap()\">\n                    <img src=\"@/assets/img/icon/baseLayer.svg\" alt=\"\">\n                </a>\n            </li>\n            <li class=\"me-4 position-relative\">\n                <a href=\"\" class=\"MapFeatureBtn text-white\" @click.prevent=\"toolSwitch('splitWindowBtn')\">\n                    <img src=\"@/assets/img/icon/singleWindow.svg\" alt=\"\" v-if=\"props.mapCount === 1\">\n                    <img src=\"@/assets/img/icon/doubleWindows.svg\" alt=\"\" v-if=\"props.mapCount === 2\">\n                </a>\n                <ul class=\"list-unstyled position-absolute start-0 top-100 p-0\" v-if=\"state.toolSwitch.splitWindowBtn\">\n                    <li class=\"mt-2\">\n                        <a href=\"\" class=\"text-white MapFeatureBtn\" @click.prevent=\"onLayerControl('changeMapCount', 1)\">\n                            <img src=\"@/assets/img/icon/singleWindow.svg\" alt=\"\">\n                        </a>\n                    </li>\n                    <li class=\"mt-2\">\n                        <a href=\"\" class=\"text-white MapFeatureBtn\" @click.prevent=\"onLayerControl('changeMapCount', 2)\">\n                            <img src=\"@/assets/img/icon/doubleWindows.svg\" alt=\"\">\n                        </a>\n                    </li>\n                </ul>\n            </li>\n        </ul>\n\n        <div class=\"switchControl d-flex position-fixed rounded-pill translate-middle-x p-2\" id=\"switchControl\" style=\"z-index: 99;\">\n            <div class=\"fs-3 text-white rounded-pill\" :class=\"{ 'active': state.targetNum === 1 }\" @click=\"() => {\n                onChangeTarget(1)\n            }\">左</div>\n            <div class=\"fs-3 text-white rounded-pill\" :class=\"{ 'active': state.targetNum === 2 }\" @click=\"() => {\n                onChangeTarget(2)\n            }\">右</div>\n        </div>\n    </div>\n</template>\n\n<style lang=\"sass\">\n.MapFeatureBtn\n    display: block\n    border-radius: 10px\n    width: 68px\n    height: 68px\n    box-sizing: border-box\n    img\n        width: 100%\n        height: 100%\n        &:hover\n            filter: brightness(0.5)\n    svg\n        font-size: 24px\n        width: 100%\n        height: 100%\n\n.switchControl\n    top: 10px\n    left: 50%\n    background: rgba(30, 30, 30, 0.9)\n    box-sizing: border-box\n    div\n        padding:5px 28px\n        cursor: pointer\n        box-sizing: border-box\n    .active\n        background: #247BA0\n\n</style>","/**\n * @module olcs.AutoRenderLoop\n */\n\nclass AutoRenderLoop {\n  /**\n   * @constructor\n   * @param {olcs.OLCesium} ol3d\n   */\n  constructor(ol3d) {\n    this.ol3d = ol3d;\n    this.scene_ = ol3d.getCesiumScene();\n    this.canvas_ = this.scene_.canvas;\n    this._boundNotifyRepaintRequired = this.notifyRepaintRequired.bind(this);\n\n    this.repaintEventNames_ = [\n      'mousemove', 'mousedown', 'mouseup',\n      'touchstart', 'touchend', 'touchmove',\n      'pointerdown', 'pointerup', 'pointermove',\n      'wheel'\n    ];\n\n    this.enable();\n  }\n\n  /**\n   * Enable.\n   */\n  enable() {\n    this.scene_.requestRenderMode = true;\n    this.scene_.maximumRenderTimeChange = 1000;\n    for (const repaintKey of this.repaintEventNames_) {\n      this.canvas_.addEventListener(repaintKey, this._boundNotifyRepaintRequired, false);\n    }\n\n    window.addEventListener('resize', this._boundNotifyRepaintRequired, false);\n\n    // Listen for changes on the layer group\n    this.ol3d.getOlMap().getLayerGroup().on('change', this._boundNotifyRepaintRequired);\n  }\n\n  /**\n   * Disable.\n   */\n  disable() {\n    for (const repaintKey of this.repaintEventNames_) {\n      this.canvas_.removeEventListener(repaintKey, this._boundNotifyRepaintRequired, false);\n    }\n\n    window.removeEventListener('resize', this._boundNotifyRepaintRequired, false);\n\n    this.ol3d.getOlMap().getLayerGroup().un('change', this._boundNotifyRepaintRequired);\n    this.scene_.requestRenderMode = false;\n  }\n\n  /**\n   * Restart render loop.\n   * Force a restart of the render loop.\n   * @api\n   */\n  restartRenderLoop() {\n    this.notifyRepaintRequired();\n  }\n\n  notifyRepaintRequired() {\n    this.scene_.requestRender();\n  }\n}\n\n\nexport default AutoRenderLoop;\n","/**\n * Converts radians to to degrees.\n *\n * @param {number} angleInRadians Angle in radians.\n * @return {number} Angle in degrees.\n */\nexport function toDegrees(angleInRadians) {\n  return angleInRadians * 180 / Math.PI;\n}\n\n\n/**\n * Converts degrees to radians.\n *\n * @param {number} angleInDegrees Angle in degrees.\n * @return {number} Angle in radians.\n */\nexport function toRadians(angleInDegrees) {\n  return angleInDegrees * Math.PI / 180;\n}\n","/**\n * @module olcs.Camera\n */\n\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\nimport {toRadians, toDegrees} from './math.js';\nimport {getTransform} from 'ol/proj.js';\nimport olcsCore, {calcDistanceForResolution, calcResolutionForDistance} from './core.js';\n\nclass Camera {\n  /**\n   * This object takes care of additional 3d-specific properties of the view and\n   * ensures proper synchronization with the underlying raw Cesium.Camera object.\n   * @param {!Cesium.Scene} scene\n   * @param {!ol.Map} map\n   * @api\n   */\n  constructor(scene, map) {\n    /**\n     * @type {!Cesium.Scene}\n     * @private\n     */\n    this.scene_ = scene;\n\n    /**\n     * @type {!Cesium.Camera}\n     * @private\n     */\n    this.cam_ = scene.camera;\n\n    /**\n     * @type {!ol.Map}\n     * @private\n     */\n    this.map_ = map;\n\n    /**\n     * @type {?ol.View}\n     * @private\n     */\n    this.view_ = null;\n\n    /**\n     * @type {?ol.EventsKey}\n     * @private\n     */\n    this.viewListenKey_ = null;\n\n    /**\n     * @type {!ol.TransformFunction}\n     * @private\n     */\n    this.toLonLat_ = Camera.identityProjection;\n\n    /**\n     * @type {!ol.TransformFunction}\n     * @private\n     */\n    this.fromLonLat_ = Camera.identityProjection;\n\n    /**\n     * 0 -- topdown, PI/2 -- the horizon\n     * @type {number}\n     * @private\n     */\n    this.tilt_ = 0;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.distance_ = 0;\n\n    /**\n     * @type {?Cesium.Matrix4}\n     * @private\n     */\n    this.lastCameraViewMatrix_ = null;\n\n    /**\n     * This is used to discard change events on view caused by updateView method.\n     * @type {boolean}\n     * @private\n     */\n    this.viewUpdateInProgress_ = false;\n\n    this.map_.on('change:view', (e) => {\n      this.setView_(this.map_.getView());\n    });\n    this.setView_(this.map_.getView());\n  }\n\n  /**\n   * @param {Array.<number>} input Input coordinate array.\n   * @param {Array.<number>=} opt_output Output array of coordinate values.\n   * @param {number=} opt_dimension Dimension.\n   * @return {Array.<number>} Input coordinate array (same array as input).\n   */\n  static identityProjection(input, opt_output, opt_dimension) {\n    const dim = opt_dimension || input.length;\n    if (opt_output) {\n      for (let i = 0; i < dim; ++i) {\n        opt_output[i] = input[i];\n      }\n    }\n    return input;\n  }\n\n  /**\n   * @param {?ol.View} view New view to use.\n   * @private\n   */\n  setView_(view) {\n    if (this.view_) {\n      olObservableUnByKey(this.viewListenKey_);\n      this.viewListenKey_ = null;\n    }\n\n    this.view_ = view;\n    if (view) {\n      const toLonLat = getTransform(view.getProjection(), 'EPSG:4326');\n      const fromLonLat = getTransform('EPSG:4326', view.getProjection());\n      console.assert(toLonLat && fromLonLat);\n\n      this.toLonLat_ = toLonLat;\n      this.fromLonLat_ = fromLonLat;\n\n      this.viewListenKey_ = view.on('propertychange', e => this.handleViewEvent_(e));\n\n      this.readFromView();\n    } else {\n      this.toLonLat_ = Camera.identityProjection;\n      this.fromLonLat_ = Camera.identityProjection;\n    }\n  }\n\n  /**\n   * @param {?} e\n   * @private\n   */\n  handleViewEvent_(e) {\n    if (!this.viewUpdateInProgress_) {\n      this.readFromView();\n    }\n  }\n\n  /**\n   * @param {number} heading In radians.\n   * @api\n   */\n  setHeading(heading) {\n    if (!this.view_) {\n      return;\n    }\n\n    this.view_.setRotation(heading);\n  }\n\n  /**\n   * @return {number|undefined} Heading in radians.\n   * @api\n   */\n  getHeading() {\n    if (!this.view_) {\n      return undefined;\n    }\n    const rotation = this.view_.getRotation();\n    return rotation || 0;\n  }\n\n  /**\n   * @param {number} tilt In radians.\n   * @api\n   */\n  setTilt(tilt) {\n    this.tilt_ = tilt;\n    this.updateCamera_();\n  }\n\n  /**\n   * @return {number} Tilt in radians.\n   * @api\n   */\n  getTilt() {\n    return this.tilt_;\n  }\n\n  /**\n   * @param {number} distance In meters.\n   * @api\n   */\n  setDistance(distance) {\n    this.distance_ = distance;\n    this.updateCamera_();\n    this.updateView();\n  }\n\n  /**\n   * @return {number} Distance in meters.\n   * @api\n   */\n  getDistance() {\n    return this.distance_;\n  }\n\n  /**\n   * Shortcut for ol.View.setCenter().\n   * @param {!ol.Coordinate} center Same projection as the ol.View.\n   * @api\n   */\n  setCenter(center) {\n    if (!this.view_) {\n      return;\n    }\n    this.view_.setCenter(center);\n  }\n\n  /**\n   * Shortcut for ol.View.getCenter().\n   * @return {ol.Coordinate|undefined} Same projection as the ol.View.\n   * @api\n   */\n  getCenter() {\n    if (!this.view_) {\n      return undefined;\n    }\n    return this.view_.getCenter();\n  }\n\n  /**\n   * Sets the position of the camera.\n   * @param {!ol.Coordinate} position Same projection as the ol.View.\n   * @api\n   */\n  setPosition(position) {\n    if (!this.toLonLat_) {\n      return;\n    }\n    const ll = this.toLonLat_(position);\n    console.assert(ll);\n\n    const carto = new Cesium.Cartographic(\n        toRadians(ll[0]),\n        toRadians(ll[1]),\n        this.getAltitude());\n\n    this.cam_.setView({\n      destination: Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto)\n    });\n    this.updateView();\n  }\n\n  /**\n   * Calculates position under the camera.\n   * @return {!ol.Coordinate|undefined} Same projection as the ol.View.\n   * @api\n   */\n  getPosition() {\n    if (!this.fromLonLat_) {\n      return undefined;\n    }\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position);\n\n    const pos = this.fromLonLat_([\n      toDegrees(carto.longitude),\n      toDegrees(carto.latitude)\n    ]);\n    console.assert(pos);\n    return pos;\n  }\n\n  /**\n   * @param {number} altitude In meters.\n   * @api\n   */\n  setAltitude(altitude) {\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(\n        this.cam_.position);\n    carto.height = altitude;\n    this.cam_.position = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n\n    this.updateView();\n  }\n\n  /**\n   * @return {number} Altitude in meters.\n   * @api\n   */\n  getAltitude() {\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(\n        this.cam_.position);\n\n    return carto.height;\n  }\n\n  /**\n   * Updates the state of the underlying Cesium.Camera\n   * according to the current values of the properties.\n   * @private\n   */\n  updateCamera_() {\n    if (!this.view_ || !this.toLonLat_) {\n      return;\n    }\n    const center = this.view_.getCenter();\n    if (!center) {\n      return;\n    }\n    const ll = this.toLonLat_(center);\n    console.assert(ll);\n\n    const carto = new Cesium.Cartographic(toRadians(ll[0]),\n        toRadians(ll[1]));\n    if (this.scene_.globe) {\n      const height = this.scene_.globe.getHeight(carto);\n      carto.height = height || 0;\n    }\n\n    const destination = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n\n    /** @type {Cesium.optionsOrientation} */\n    const orientation = {\n      pitch: this.tilt_ - Cesium.Math.PI_OVER_TWO,\n      heading: -this.view_.getRotation(),\n      roll: undefined\n    };\n    this.cam_.setView({\n      destination,\n      orientation\n    });\n\n    this.cam_.moveBackward(this.distance_);\n\n    this.checkCameraChange(true);\n  }\n\n  /**\n   * Calculates the values of the properties from the current ol.View state.\n   * @api\n   */\n  readFromView() {\n    if (!this.view_ || !this.toLonLat_) {\n      return;\n    }\n    const center = this.view_.getCenter();\n    if (center === undefined || center === null) {\n      return;\n    }\n    const ll = this.toLonLat_(center);\n    console.assert(ll);\n\n    const resolution = this.view_.getResolution();\n    this.distance_ = this.calcDistanceForResolution(\n        resolution || 0, toRadians(ll[1]));\n\n    this.updateCamera_();\n  }\n\n  /**\n   * Calculates the values of the properties from the current Cesium.Camera state.\n   * Modifies the center, resolution and rotation properties of the view.\n   * @api\n   */\n  updateView() {\n    if (!this.view_ || !this.fromLonLat_) {\n      return;\n    }\n    this.viewUpdateInProgress_ = true;\n\n    // target & distance\n    const ellipsoid = Cesium.Ellipsoid.WGS84;\n    const scene = this.scene_;\n    const target = olcsCore.pickCenterPoint(scene);\n\n    let bestTarget = target;\n    if (!bestTarget) {\n      //TODO: how to handle this properly ?\n      const globe = scene.globe;\n      const carto = this.cam_.positionCartographic.clone();\n      const height = globe.getHeight(carto);\n      carto.height = height || 0;\n      bestTarget = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n    }\n    this.distance_ = Cesium.Cartesian3.distance(bestTarget, this.cam_.position);\n    const bestTargetCartographic = ellipsoid.cartesianToCartographic(bestTarget);\n    this.view_.setCenter(this.fromLonLat_([\n      toDegrees(bestTargetCartographic.longitude),\n      toDegrees(bestTargetCartographic.latitude)]));\n\n    // resolution\n    this.view_.setResolution(\n        this.calcResolutionForDistance(this.distance_,\n            bestTargetCartographic ? bestTargetCartographic.latitude : 0));\n\n\n    /*\n     * Since we are positioning the target, the values of heading and tilt\n     * need to be calculated _at the target_.\n     */\n    if (target) {\n      const pos = this.cam_.position;\n\n      // normal to the ellipsoid at the target\n      const targetNormal = new Cesium.Cartesian3();\n      ellipsoid.geocentricSurfaceNormal(target, targetNormal);\n\n      // vector from the target to the camera\n      const targetToCamera = new Cesium.Cartesian3();\n      Cesium.Cartesian3.subtract(pos, target, targetToCamera);\n      Cesium.Cartesian3.normalize(targetToCamera, targetToCamera);\n\n\n      // HEADING\n      const up = this.cam_.up;\n      const right = this.cam_.right;\n      const normal = new Cesium.Cartesian3(-target.y, target.x, 0); // what is it?\n      const heading = Cesium.Cartesian3.angleBetween(right, normal);\n      const cross = Cesium.Cartesian3.cross(target, up, new Cesium.Cartesian3());\n      const orientation = cross.z;\n\n      this.view_.setRotation((orientation < 0 ? heading : -heading));\n\n      // TILT\n      const tiltAngle = Math.acos(\n          Cesium.Cartesian3.dot(targetNormal, targetToCamera));\n      this.tilt_ = isNaN(tiltAngle) ? 0 : tiltAngle;\n    } else {\n      // fallback when there is no target\n      this.view_.setRotation(this.cam_.heading);\n      this.tilt_ = -this.cam_.pitch + Math.PI / 2;\n    }\n\n    this.viewUpdateInProgress_ = false;\n  }\n\n  /**\n   * Check if the underlying camera state has changed and ensure synchronization.\n   * @param {boolean=} opt_dontSync Do not synchronize the view.\n   */\n  checkCameraChange(opt_dontSync) {\n    const old = this.lastCameraViewMatrix_;\n    const current = this.cam_.viewMatrix;\n\n    if (!old || !Cesium.Matrix4.equalsEpsilon(old, current, 1e-5)) {\n      this.lastCameraViewMatrix_ = current.clone();\n      if (opt_dontSync !== true) {\n        this.updateView();\n      }\n    }\n  }\n\n  /**\n   * calculate the distance between camera and centerpoint based on the resolution and latitude value\n   * @param {number} resolution Number of map units per pixel.\n   * @param {number} latitude Latitude in radians.\n   * @return {number} The calculated distance.\n   * @api\n   */\n  calcDistanceForResolution(resolution, latitude) {\n    return calcDistanceForResolution(resolution, latitude, this.scene_, this.view_.getProjection());\n  }\n\n  /**\n   * calculate the resolution based on a distance(camera to position) and latitude value\n   * @param {number} distance\n   * @param {number} latitude\n   * @return {number} The calculated resolution.\n   * @api\n   */\n  calcResolutionForDistance(distance, latitude) {\n    return calcResolutionForDistance(distance, latitude, this.scene_, this.view_.getProjection());\n  }\n}\n\n\nexport default Camera;\n","/**\n * @module olcs.AbstractSynchronizer\n */\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\nimport olLayerGroup from 'ol/layer/Group.js';\nimport {olcsListen, getUid} from './util.js';\n\n\nclass AbstractSynchronizer {\n  /**\n   * @param {!ol.Map} map\n   * @param {!Cesium.Scene} scene\n   * @template T\n   * @abstract\n   * @api\n   */\n  constructor(map, scene) {\n    /**\n     * @type {!ol.Map}\n     * @protected\n     */\n    this.map = map;\n\n    /**\n     * @type {ol.View}\n     * @protected\n     */\n    this.view = map.getView();\n\n    /**\n     * @type {!Cesium.Scene}\n     * @protected\n     */\n    this.scene = scene;\n\n    /**\n     * @type {ol.Collection.<ol.layer.Base>}\n     * @protected\n     */\n    this.olLayers = map.getLayerGroup().getLayers();\n\n    /**\n     * @type {ol.layer.Group}\n     */\n    this.mapLayerGroup = map.getLayerGroup();\n\n    /**\n     * Map of OpenLayers layer ids (from getUid) to the Cesium ImageryLayers.\n     * Null value means, that we are unable to create equivalent layers.\n     * @type {Object.<string, ?Array.<T>>}\n     * @protected\n     */\n    this.layerMap = {};\n\n    /**\n     * Map of listen keys for OpenLayers layer layers ids (from getUid).\n     * @type {!Object.<string, Array<ol.EventsKey>>}\n     * @protected\n     */\n    this.olLayerListenKeys = {};\n\n    /**\n     * Map of listen keys for OpenLayers layer groups ids (from getUid).\n     * @type {!Object.<string, !Array.<ol.EventsKey>>}\n     * @private\n     */\n    this.olGroupListenKeys_ = {};\n  }\n\n  /**\n   * Destroy all and perform complete synchronization of the layers.\n   * @api\n   */\n  synchronize() {\n    this.destroyAll();\n    this.addLayers_(this.mapLayerGroup);\n  }\n\n  /**\n   * Order counterparts using the same algorithm as the Openlayers renderer:\n   * z-index then original sequence order.\n   * @protected\n   */\n  orderLayers() {\n    // Ordering logics is handled in subclasses.\n  }\n\n  /**\n   * Add a layer hierarchy.\n   * @param {ol.layer.Base} root\n   * @private\n   */\n  addLayers_(root) {\n    /** @type {Array<import('olsc/core.js').LayerWithParents>} */\n    const fifo = [{\n      layer: root,\n      parents: []\n    }];\n    while (fifo.length > 0) {\n      const olLayerWithParents = fifo.splice(0, 1)[0];\n      const olLayer = olLayerWithParents.layer;\n      const olLayerId = getUid(olLayer).toString();\n      this.olLayerListenKeys[olLayerId] = [];\n      console.assert(!this.layerMap[olLayerId]);\n\n      let cesiumObjects = null;\n      if (olLayer instanceof olLayerGroup) {\n        this.listenForGroupChanges_(olLayer);\n        if (olLayer !== this.mapLayerGroup) {\n          cesiumObjects = this.createSingleLayerCounterparts(olLayerWithParents);\n        }\n        if (!cesiumObjects) {\n          olLayer.getLayers().forEach((l) => {\n            if (l) {\n              const newOlLayerWithParents = {\n                layer: l,\n                parents: olLayer === this.mapLayerGroup ?\n                  [] :\n                  [olLayerWithParents.layer].concat(olLayerWithParents.parents)\n              };\n              fifo.push(newOlLayerWithParents);\n            }\n          });\n        }\n      } else {\n        cesiumObjects = this.createSingleLayerCounterparts(olLayerWithParents);\n        if (!cesiumObjects) {\n          // keep an eye on the layers that once failed to be added (might work when the layer is updated)\n          // for example when a source is set after the layer is added to the map\n          const layerId = olLayerId;\n          const layerWithParents = olLayerWithParents;\n          const onLayerChange = (e) => {\n            const cesiumObjs = this.createSingleLayerCounterparts(layerWithParents);\n            if (cesiumObjs) {\n              // unsubscribe event listener\n              layerWithParents.layer.un('change', onLayerChange);\n              this.addCesiumObjects_(cesiumObjs, layerId, layerWithParents.layer);\n              this.orderLayers();\n            }\n          };\n          this.olLayerListenKeys[olLayerId].push(olcsListen(layerWithParents.layer, 'change', onLayerChange));\n        }\n      }\n      // add Cesium layers\n      if (cesiumObjects) {\n        this.addCesiumObjects_(cesiumObjects, olLayerId, olLayer);\n      }\n    }\n\n    this.orderLayers();\n  }\n\n  /**\n   * Add Cesium objects.\n   * @param {Array.<T>} cesiumObjects\n   * @param {string} layerId\n   * @param {ol.layer.Base} layer\n   * @private\n   */\n  addCesiumObjects_(cesiumObjects, layerId, layer) {\n    this.layerMap[layerId] = cesiumObjects;\n    this.olLayerListenKeys[layerId].push(olcsListen(layer, 'change:zIndex', () => this.orderLayers()));\n    cesiumObjects.forEach((cesiumObject) => {\n      this.addCesiumObject(cesiumObject);\n    });\n  }\n\n  /**\n   * Remove and destroy a single layer.\n   * @param {ol.layer.Layer} layer\n   * @return {boolean} counterpart destroyed\n   * @private\n   */\n  removeAndDestroySingleLayer_(layer) {\n    const uid = getUid(layer).toString();\n    const counterparts = this.layerMap[uid];\n    if (!!counterparts) {\n      counterparts.forEach((counterpart) => {\n        this.removeSingleCesiumObject(counterpart, false);\n        this.destroyCesiumObject(counterpart);\n      });\n      this.olLayerListenKeys[uid].forEach(olObservableUnByKey);\n      delete this.olLayerListenKeys[uid];\n    }\n    delete this.layerMap[uid];\n    return !!counterparts;\n  }\n\n  /**\n   * Unlisten a single layer group.\n   * @param {ol.layer.Group} group\n   * @private\n   */\n  unlistenSingleGroup_(group) {\n    if (group === this.mapLayerGroup) {\n      return;\n    }\n    const uid = getUid(group).toString();\n    const keys = this.olGroupListenKeys_[uid];\n    keys.forEach((key) => {\n      olObservableUnByKey(key);\n    });\n    delete this.olGroupListenKeys_[uid];\n    delete this.layerMap[uid];\n  }\n\n  /**\n   * Remove layer hierarchy.\n   * @param {ol.layer.Base} root\n   * @private\n   */\n  removeLayer_(root) {\n    if (!!root) {\n      const fifo = [root];\n      while (fifo.length > 0) {\n        const olLayer = fifo.splice(0, 1)[0];\n        const done = this.removeAndDestroySingleLayer_(olLayer);\n        if (olLayer instanceof olLayerGroup) {\n          this.unlistenSingleGroup_(olLayer);\n          if (!done) {\n            // No counterpart for the group itself so removing\n            // each of the child layers.\n            olLayer.getLayers().forEach((l) => {\n              fifo.push(l);\n            });\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Register listeners for single layer group change.\n   * @param {ol.layer.Group} group\n   * @private\n   */\n  listenForGroupChanges_(group) {\n    const uuid = getUid(group).toString();\n\n    console.assert(this.olGroupListenKeys_[uuid] === undefined);\n\n    const listenKeyArray = [];\n    this.olGroupListenKeys_[uuid] = listenKeyArray;\n\n    // only the keys that need to be relistened when collection changes\n    let contentKeys = [];\n    const listenAddRemove = (function() {\n      const collection = group.getLayers();\n      if (collection) {\n        contentKeys = [\n          collection.on('add', (event) => {\n            this.addLayers_(event.element);\n          }),\n          collection.on('remove', (event) => {\n            this.removeLayer_(event.element);\n          })\n        ];\n        listenKeyArray.push(...contentKeys);\n      }\n    }).bind(this);\n\n    listenAddRemove();\n\n    listenKeyArray.push(group.on('change:layers', (e) => {\n      contentKeys.forEach((el) => {\n        const i = listenKeyArray.indexOf(el);\n        if (i >= 0) {\n          listenKeyArray.splice(i, 1);\n        }\n        olObservableUnByKey(el);\n      });\n      listenAddRemove();\n    }));\n  }\n\n  /**\n   * Destroys all the created Cesium objects.\n   * @protected\n   */\n  destroyAll() {\n    this.removeAllCesiumObjects(true); // destroy\n    let objKey;\n    for (objKey in this.olGroupListenKeys_) {\n      const keys = this.olGroupListenKeys_[objKey];\n      keys.forEach(olObservableUnByKey);\n    }\n    for (objKey in this.olLayerListenKeys) {\n      this.olLayerListenKeys[objKey].forEach(olObservableUnByKey);\n    }\n    this.olGroupListenKeys_ = {};\n    this.olLayerListenKeys = {};\n    this.layerMap = {};\n  }\n\n  /**\n   * Adds a single Cesium object to the collection.\n   * @param {!T} object\n   * @abstract\n   * @protected\n   */\n  addCesiumObject(object) {}\n\n  /**\n   * @param {!T} object\n   * @abstract\n   * @protected\n   */\n  destroyCesiumObject(object) {}\n\n  /**\n   * Remove single Cesium object from the collection.\n   * @param {!T} object\n   * @param {boolean} destroy\n   * @abstract\n   * @protected\n   */\n  removeSingleCesiumObject(object, destroy) {}\n\n  /**\n   * Remove all Cesium objects from the collection.\n   * @param {boolean} destroy\n   * @abstract\n   * @protected\n   */\n  removeAllCesiumObjects(destroy) {}\n\n  /**\n   * @param {import('olsc/core.js').LayerWithParents} olLayerWithParents\n   * @return {?Array.<T>}\n   * @abstract\n   * @protected\n   */\n  createSingleLayerCounterparts(olLayerWithParents) {}\n}\n\n\nexport default AbstractSynchronizer;\n","/**\n * @module olcs.RasterSynchronizer\n */\nimport olLayerGroup from 'ol/layer/Group.js';\nimport {getUid, stableSort} from './util.js';\nimport olcsAbstractSynchronizer from './AbstractSynchronizer.js';\nimport olcsCore from './core.js';\n\nclass RasterSynchronizer extends olcsAbstractSynchronizer {\n  /**\n   * This object takes care of one-directional synchronization of\n   * Openlayers raster layers to the given Cesium globe.\n   * @param {!ol.Map} map\n   * @param {!Cesium.Scene} scene\n   * @constructor\n   * @extends {olcsAbstractSynchronizer.<Cesium.ImageryLayer>}\n   * @api\n   */\n  constructor(map, scene) {\n    super(map, scene);\n\n    /**\n     * @type {!Cesium.ImageryLayerCollection}\n     * @private\n     */\n    this.cesiumLayers_ = scene.imageryLayers;\n\n    /**\n     * @type {!Cesium.ImageryLayerCollection}\n     * @private\n     */\n    this.ourLayers_ = new Cesium.ImageryLayerCollection();\n  }\n\n  /**\n   * @inheritDoc\n   */\n  addCesiumObject(object) {\n    this.cesiumLayers_.add(object);\n    this.ourLayers_.add(object);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  destroyCesiumObject(object) {\n    object.destroy();\n  }\n\n  /**\n   * @inheritDoc\n   */\n  removeSingleCesiumObject(object, destroy) {\n    this.cesiumLayers_.remove(object, destroy);\n    this.ourLayers_.remove(object, false);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  removeAllCesiumObjects(destroy) {\n    for (let i = 0; i < this.ourLayers_.length; ++i) {\n      this.cesiumLayers_.remove(this.ourLayers_.get(i), destroy);\n    }\n    this.ourLayers_.removeAll(false);\n  }\n\n  /**\n   * Creates an array of Cesium.ImageryLayer.\n   * May be overriden by child classes to implement custom behavior.\n   * The default implementation handles tiled imageries in EPSG:4326 or\n   * EPSG:3859.\n   * @param {!ol.layer.Base} olLayer\n   * @param {!ol.proj.Projection} viewProj Projection of the view.\n   * @return {?Array.<!Cesium.ImageryLayer>} array or null if not possible\n   * (or supported)\n   * @protected\n   */\n  convertLayerToCesiumImageries(olLayer, viewProj) {\n    const result = olcsCore.tileLayerToImageryLayer(this.map, olLayer, viewProj);\n    return result ? [result] : null;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  createSingleLayerCounterparts(olLayerWithParents) {\n    const olLayer = olLayerWithParents.layer;\n    const uid = getUid(olLayer).toString();\n    const viewProj = this.view.getProjection();\n    console.assert(viewProj);\n    const cesiumObjects = this.convertLayerToCesiumImageries(olLayer, viewProj);\n    if (cesiumObjects) {\n      const listenKeyArray = [];\n      [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayerItem) => {\n        listenKeyArray.push(olLayerItem.on(['change:opacity', 'change:visible'], () => {\n          // the compiler does not seem to be able to infer this\n          console.assert(cesiumObjects);\n          for (let i = 0; i < cesiumObjects.length; ++i) {\n            olcsCore.updateCesiumLayerProperties(olLayerWithParents, cesiumObjects[i]);\n          }\n        }));\n      });\n\n      if (olLayer.getStyleFunction) {\n        let previousStyleFunction = olLayer.getStyleFunction();\n        // there is no convenient way to detect a style function change in OL\n        listenKeyArray.push(olLayer.on('change', () => {\n          const currentStyleFunction = olLayer.getStyleFunction();\n          if (previousStyleFunction === currentStyleFunction) {\n            return;\n          }\n          previousStyleFunction = currentStyleFunction;\n          for (let i = 0; i < cesiumObjects.length; ++i) {\n            const csObj = cesiumObjects[i];\n            // clear cache and set new style\n            if (csObj._imageryCache && csObj.imageryProvider.cache_) {\n              csObj._imageryCache = {};\n              csObj.imageryProvider.cache_ = {};\n              csObj.imageryProvider.styleFunction_ = currentStyleFunction;\n            }\n          }\n          this.scene.requestRender();\n        }));\n      }\n\n      for (let i = 0; i < cesiumObjects.length; ++i) {\n        olcsCore.updateCesiumLayerProperties(olLayerWithParents, cesiumObjects[i]);\n      }\n\n      // there is no way to modify Cesium layer extent,\n      // we have to recreate when OpenLayers layer extent changes:\n      listenKeyArray.push(olLayer.on('change:extent', (e) => {\n        for (let i = 0; i < cesiumObjects.length; ++i) {\n          this.cesiumLayers_.remove(cesiumObjects[i], true); // destroy\n          this.ourLayers_.remove(cesiumObjects[i], false);\n        }\n        delete this.layerMap[getUid(olLayer)]; // invalidate the map entry\n        this.synchronize();\n      }));\n\n      listenKeyArray.push(olLayer.on('change', (e) => {\n        // when the source changes, re-add the layer to force update\n        for (let i = 0; i < cesiumObjects.length; ++i) {\n          const position = this.cesiumLayers_.indexOf(cesiumObjects[i]);\n          if (position >= 0) {\n            this.cesiumLayers_.remove(cesiumObjects[i], false);\n            this.cesiumLayers_.add(cesiumObjects[i], position);\n          }\n        }\n      }));\n\n      this.olLayerListenKeys[uid].push(...listenKeyArray);\n    }\n\n    return Array.isArray(cesiumObjects) ? cesiumObjects : null;\n  }\n\n  /**\n   * Order counterparts using the same algorithm as the Openlayers renderer:\n   * z-index then original sequence order.\n   * @override\n   * @protected\n   */\n  orderLayers() {\n    const layers = [];\n    const zIndices = {};\n    const queue = [this.mapLayerGroup];\n\n    while (queue.length > 0) {\n      const olLayer = queue.splice(0, 1)[0];\n      layers.push(olLayer);\n      zIndices[getUid(olLayer)] = olLayer.getZIndex() || 0;\n\n      if (olLayer instanceof olLayerGroup) {\n        const sublayers = olLayer.getLayers();\n        if (sublayers) {\n          // Prepend queue with sublayers in order\n          queue.unshift(...sublayers.getArray());\n        }\n      }\n    }\n\n    stableSort(layers, (layer1, layer2) =>\n      zIndices[getUid(layer1)] - zIndices[getUid(layer2)]\n    );\n\n    layers.forEach((olLayer) => {\n      const olLayerId = getUid(olLayer).toString();\n      const cesiumObjects = this.layerMap[olLayerId];\n      if (cesiumObjects) {\n        cesiumObjects.forEach((cesiumObject) => { this.raiseToTop(cesiumObject); });\n      }\n    });\n  }\n\n  /**\n   * @param {Cesium.ImageryLayer} counterpart\n   */\n  raiseToTop(counterpart) {\n    this.cesiumLayers_.raiseToTop(counterpart);\n  }\n}\n\n\nexport default RasterSynchronizer;\n","/**\n * @module olcs.core.VectorLayerCounterpart\n */\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\n\n\n/**\n * Context for feature conversion.\n * @typedef {Object} OlFeatureToCesiumContext\n * @property {!(import('ol/Projection.js').default|string)} projection\n * @property {!Cesium.PrimitiveCollection} primitives\n * @property {Object<number, Array<!Cesium.Primitive|!Cesium.Billboard>>} featureToCesiumMap\n * @property {!Cesium.BillboardCollection} billboards\n */\n\n\nclass VectorLayerCounterpart {\n  /**\n  * Result of the conversion of an OpenLayers layer to Cesium.\n  * @param {!(ol.proj.Projection|string)} layerProjection\n  * @param {!Cesium.Scene} scene\n  */\n  constructor(layerProjection, scene) {\n    const billboards = new Cesium.BillboardCollection({scene});\n    const primitives = new Cesium.PrimitiveCollection();\n\n    /**\n    * @type {!Array.<ol.EventsKey>}\n    */\n    this.olListenKeys = [];\n\n    this.rootCollection_ = new Cesium.PrimitiveCollection();\n    /**\n    * @type {!OlFeatureToCesiumContext}\n    */\n    this.context = {\n      projection: layerProjection,\n      billboards,\n      featureToCesiumMap: {},\n      primitives\n    };\n\n    this.rootCollection_.add(billboards);\n    this.rootCollection_.add(primitives);\n  }\n\n  /**\n  * Unlisten.\n  */\n  destroy() {\n    this.olListenKeys.forEach(olObservableUnByKey);\n    this.olListenKeys.length = 0;\n  }\n\n  /**\n  * @return {!Cesium.Primitive}\n  */\n  getRootPrimitive() {\n    return this.rootCollection_;\n  }\n}\n\n\nexport default VectorLayerCounterpart;\n","/**\n * @module olcs.FeatureConverter\n */\nimport olGeomGeometry from 'ol/geom/Geometry.js';\nimport olStyleIcon from 'ol/style/Icon.js';\nimport olSourceVector from 'ol/source/Vector.js';\nimport olSourceCluster from 'ol/source/Cluster.js';\nimport {circular as olCreateCircularPolygon} from 'ol/geom/Polygon.js';\nimport {boundingExtent, getCenter} from 'ol/extent.js';\nimport olGeomSimpleGeometry from 'ol/geom/SimpleGeometry.js';\nimport olcsCore from './core.js';\nimport olcsCoreVectorLayerCounterpart from './core/VectorLayerCounterpart.js';\nimport olcsUtil, {getUid, isGroundPolylinePrimitiveSupported} from './util.js';\n\n\n/**\n * @typedef {Object} ModelStyle\n * @property {Cesium.Matrix4} [debugModelMatrix]\n * @property {Cesium.ModelFromGltfOptions} cesiumOptions\n */\n\n\nclass FeatureConverter {\n  /**\n   * Concrete base class for converting from OpenLayers3 vectors to Cesium\n   * primitives.\n   * Extending this class is possible provided that the extending class and\n   * the library are compiled together by the closure compiler.\n   * @param {!Cesium.Scene} scene Cesium scene.\n   * @constructor\n   * @api\n   */\n  constructor(scene) {\n\n    /**\n     * @protected\n     */\n    this.scene = scene;\n\n    /**\n     * Bind once to have a unique function for using as a listener\n     * @type {function(ol.source.Vector.Event)}\n     * @private\n     */\n    this.boundOnRemoveOrClearFeatureListener_ = this.onRemoveOrClearFeature_.bind(this);\n\n    /**\n     * @type {Cesium.Cartesian3}\n     * @private\n     */\n    this.defaultBillboardEyeOffset_ = new Cesium.Cartesian3(0, 0, 10);\n  }\n\n  /**\n   * @param {ol.source.Vector.Event} evt\n   * @private\n   */\n  onRemoveOrClearFeature_(evt) {\n    const source = evt.target;\n    console.assert(source instanceof olSourceVector);\n\n    const cancellers = olcsUtil.obj(source)['olcs_cancellers'];\n    if (cancellers) {\n      const feature = evt.feature;\n      if (feature) {\n        // remove\n        const id = getUid(feature);\n        const canceller = cancellers[id];\n        if (canceller) {\n          canceller();\n          delete cancellers[id];\n        }\n      } else {\n        // clear\n        for (const key in cancellers) {\n          if (cancellers.hasOwnProperty(key)) {\n            cancellers[key]();\n          }\n        }\n        olcsUtil.obj(source)['olcs_cancellers'] = {};\n      }\n    }\n  }\n\n  /**\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!Cesium.Primitive|Cesium.Label|Cesium.Billboard} primitive\n   * @protected\n   */\n  setReferenceForPicking(layer, feature, primitive) {\n    primitive.olLayer = layer;\n    primitive.olFeature = feature;\n  }\n\n  /**\n   * Basics primitive creation using a color attribute.\n   * Note that Cesium has 'interior' and outline geometries.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!ol.geom.Geometry} olGeometry OpenLayers geometry.\n   * @param {!Cesium.Geometry} geometry\n   * @param {!Cesium.Color} color\n   * @param {number=} opt_lineWidth\n   * @return {Cesium.Primitive}\n   * @protected\n   */\n  createColoredPrimitive(layer, feature, olGeometry, geometry, color, opt_lineWidth) {\n    const createInstance = function(geometry, color) {\n      const instance = new Cesium.GeometryInstance({\n        // always update Cesium externs before adding a property\n        geometry\n      });\n      if (color && !(color instanceof Cesium.ImageMaterialProperty)) {\n        instance.attributes = {\n          color: Cesium.ColorGeometryInstanceAttribute.fromColor(color)\n        };\n      }\n      return instance;\n    };\n\n    const options = {\n      // always update Cesium externs before adding a property\n      flat: true, // work with all geometries\n      renderState: {\n        depthTest: {\n          enabled: true\n        }\n      }\n    };\n\n    if (opt_lineWidth !== undefined) {\n      if (!options.renderState) {\n        options.renderState = {};\n      }\n      options.renderState.lineWidth = opt_lineWidth;\n    }\n\n    const instances = createInstance(geometry, color);\n\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    let primitive;\n\n    if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n      const ctor = instances.geometry.constructor;\n      if (ctor && !ctor['createShadowVolume']) {\n        return null;\n      }\n      primitive = new Cesium.GroundPrimitive({\n        geometryInstances: instances\n      });\n    } else {\n      primitive = new Cesium.Primitive({\n        geometryInstances: instances\n      });\n    }\n\n    if (color instanceof Cesium.ImageMaterialProperty) {\n      const dataUri = color.image.getValue().toDataURL();\n\n      primitive.appearance = new Cesium.MaterialAppearance({\n        flat: true,\n        renderState: {\n          depthTest: {\n            enabled: true\n          }\n        },\n        material: new Cesium.Material({\n          fabric: {\n            type: 'Image',\n            uniforms: {\n              image: dataUri\n            }\n          }\n        })\n      });\n    } else {\n      primitive.appearance = new Cesium.PerInstanceColorAppearance(options);\n    }\n\n    this.setReferenceForPicking(layer, feature, primitive);\n    return primitive;\n  }\n\n  /**\n   * Return the fill or stroke color from a plain ol style.\n   * @param {!ol.style.Style|ol.style.Text} style\n   * @param {boolean} outline\n   * @return {!Cesium.Color}\n   * @protected\n   */\n  extractColorFromOlStyle(style, outline) {\n    const fillColor = style.getFill() ? style.getFill().getColor() : null;\n    const strokeColor = style.getStroke() ? style.getStroke().getColor() : null;\n\n    let olColor = 'black';\n    if (strokeColor && outline) {\n      olColor = strokeColor;\n    } else if (fillColor) {\n      olColor = fillColor;\n    }\n\n    return olcsCore.convertColorToCesium(olColor);\n  }\n\n  /**\n   * Return the width of stroke from a plain ol style.\n   * @param {!ol.style.Style|ol.style.Text} style\n   * @return {number}\n   * @protected\n   */\n  extractLineWidthFromOlStyle(style) {\n    // Handling of line width WebGL limitations is handled by Cesium.\n    const width = style.getStroke() ? style.getStroke().getWidth() : undefined;\n    return width !== undefined ? width : 1;\n  }\n\n  /**\n   * Create a primitive collection out of two Cesium geometries.\n   * Only the OpenLayers style colors will be used.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!ol.geom.Geometry} olGeometry OpenLayers geometry.\n   * @param {!Cesium.Geometry} fillGeometry\n   * @param {!Cesium.Geometry} outlineGeometry\n   * @param {!ol.style.Style} olStyle\n   * @return {!Cesium.PrimitiveCollection}\n   * @protected\n   */\n  wrapFillAndOutlineGeometries(layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle) {\n    const fillColor = this.extractColorFromOlStyle(olStyle, false);\n    const outlineColor = this.extractColorFromOlStyle(olStyle, true);\n\n    const primitives = new Cesium.PrimitiveCollection();\n    if (olStyle.getFill()) {\n      const p1 = this.createColoredPrimitive(layer, feature, olGeometry,\n          fillGeometry, fillColor);\n      console.assert(!!p1);\n      primitives.add(p1);\n    }\n\n    if (olStyle.getStroke() && outlineGeometry) {\n      const width = this.extractLineWidthFromOlStyle(olStyle);\n      const p2 = this.createColoredPrimitive(layer, feature, olGeometry,\n          outlineGeometry, outlineColor, width);\n      if (p2) {\n        // Some outline geometries are not supported by Cesium in clamp to ground\n        // mode. These primitives are skipped.\n        primitives.add(p2);\n      }\n    }\n\n    return primitives;\n  }\n\n  // Geometry converters\n  /**\n   * Create a Cesium primitive if style has a text component.\n   * Eventually return a PrimitiveCollection including current primitive.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry\n   * @param {!ol.style.Style} style\n   * @param {!Cesium.Primitive} primitive current primitive\n   * @return {!Cesium.PrimitiveCollection}\n   * @protected\n   */\n  addTextStyle(layer, feature, geometry, style, primitive) {\n    let primitives;\n    if (!(primitive instanceof Cesium.PrimitiveCollection)) {\n      primitives = new Cesium.PrimitiveCollection();\n      primitives.add(primitive);\n    } else {\n      primitives = primitive;\n    }\n\n    if (!style.getText()) {\n      return primitives;\n    }\n\n    const text = /** @type {!ol.style.Text} */ (style.getText());\n    const label = this.olGeometry4326TextPartToCesium(layer, feature, geometry,\n        text);\n    if (label) {\n      primitives.add(label);\n    }\n    return primitives;\n  }\n\n  /**\n   * Add a billboard to a Cesium.BillboardCollection.\n   * Overriding this wrapper allows manipulating the billboard options.\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {!Cesium.optionsBillboardCollectionAdd} bbOptions\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!ol.geom.Geometry} geometry\n   * @param {!ol.style.Style} style\n   * @return {!Cesium.Billboard} newly created billboard\n   * @api\n   */\n  csAddBillboard(billboards, bbOptions, layer, feature, geometry, style) {\n    if (!bbOptions.eyeOffset) {\n      bbOptions.eyeOffset = this.defaultBillboardEyeOffset_;\n    }\n    const bb = billboards.add(bbOptions);\n    this.setReferenceForPicking(layer, feature, bb);\n    return bb;\n  }\n\n  /**\n   * Convert an OpenLayers circle geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Circle} olGeometry OpenLayers circle geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @return {!Cesium.PrimitiveCollection} primitives\n   * @api\n   */\n  olCircleGeometryToCesium(layer, feature, olGeometry, projection, olStyle) {\n\n    olGeometry = olcsCore.olGeometryCloneTo4326(olGeometry, projection);\n    console.assert(olGeometry.getType() == 'Circle');\n\n    // ol.Coordinate\n    let center = olGeometry.getCenter();\n    const height = center.length == 3 ? center[2] : 0.0;\n    let point = center.slice();\n    point[0] += olGeometry.getRadius();\n\n    // Cesium\n    center = olcsCore.ol4326CoordinateToCesiumCartesian(center);\n    point = olcsCore.ol4326CoordinateToCesiumCartesian(point);\n\n    // Accurate computation of straight distance\n    const radius = Cesium.Cartesian3.distance(center, point);\n\n    const fillGeometry = new Cesium.CircleGeometry({\n      // always update Cesium externs before adding a property\n      center,\n      radius,\n      height\n    });\n\n    let outlinePrimitive, outlineGeometry;\n    if (this.getHeightReference(layer, feature, olGeometry) === Cesium.HeightReference.CLAMP_TO_GROUND) {\n      const width = this.extractLineWidthFromOlStyle(olStyle);\n      if (width) {\n        const circlePolygon = olCreateCircularPolygon(olGeometry.getCenter(), radius);\n        const positions = olcsCore.ol4326CoordinateArrayToCsCartesians(circlePolygon.getLinearRing(0).getCoordinates());\n        if (!isGroundPolylinePrimitiveSupported(this.scene)) {\n          const color = this.extractColorFromOlStyle(olStyle, true);\n          outlinePrimitive = this.createStackedGroundCorridors(layer, feature, width, color, positions);\n        } else {\n          outlinePrimitive = new Cesium.GroundPolylinePrimitive({\n            geometryInstances: new Cesium.GeometryInstance({\n              geometry: new Cesium.GroundPolylineGeometry({positions, width}),\n            }),\n            appearance: new Cesium.PolylineMaterialAppearance({\n              material: this.olStyleToCesium(feature, olStyle, true),\n            }),\n            classificationType: Cesium.ClassificationType.TERRAIN,\n          });\n          outlinePrimitive.readyPromise.then(() => {\n            this.setReferenceForPicking(layer, feature, outlinePrimitive._primitive);\n          });\n        }\n      }\n    } else {\n      outlineGeometry = new Cesium.CircleOutlineGeometry({\n        // always update Cesium externs before adding a property\n        center,\n        radius,\n        extrudedHeight: height,\n        height\n      });\n    }\n\n    const primitives = this.wrapFillAndOutlineGeometries(\n        layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle);\n\n    if (outlinePrimitive) {\n      primitives.add(outlinePrimitive);\n    }\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, primitives);\n  }\n\n  /**\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!number} width The width of the line.\n   * @param {!Cesium.Color} color The color of the line.\n   * @param {!Array<Cesium.Cartesian3>|Array<Array<Cesium.Cartesian3>>} positions The vertices of the line(s).\n   * @return {!Cesium.GroundPrimitive} primitive\n   */\n  createStackedGroundCorridors(layer, feature, width, color, positions) {\n    // Convert positions to an Array if it isn't\n    if (!Array.isArray(positions[0])) {\n      positions = [positions];\n    }\n    width = Math.max(3, width); // A <3px width is too small for ground primitives\n    const geometryInstances = [];\n    let previousDistance = 0;\n    // A stack of ground lines with increasing width (in meters) are created.\n    // Only one of these lines is displayed at any time giving a feeling of continuity.\n    // The values for the distance and width factor are more or less arbitrary.\n    // Applications can override this logics by subclassing the FeatureConverter class.\n    for (const distance of [1000, 4000, 16000, 64000, 254000, 1000000, 10000000]) {\n      width *= 2.14;\n      const geometryOptions = {\n        // always update Cesium externs before adding a property\n        width,\n        vertexFormat: Cesium.VertexFormat.POSITION_ONLY\n      };\n      for (const linePositions of positions) {\n        geometryOptions.positions = linePositions;\n        geometryInstances.push(new Cesium.GeometryInstance({\n          geometry: new Cesium.CorridorGeometry(geometryOptions),\n          attributes: {\n            color: Cesium.ColorGeometryInstanceAttribute.fromColor(color),\n            distanceDisplayCondition: new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(previousDistance, distance - 1)\n          }\n        }));\n      }\n      previousDistance = distance;\n    }\n    return new Cesium.GroundPrimitive({\n      // always update Cesium externs before adding a property\n      geometryInstances\n    });\n  }\n\n  /**\n   * Convert an OpenLayers line string geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.LineString} olGeometry OpenLayers line string geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @return {!Cesium.PrimitiveCollection} primitives\n   * @api\n   */\n  olLineStringGeometryToCesium(layer, feature, olGeometry, projection, olStyle) {\n\n    olGeometry = olcsCore.olGeometryCloneTo4326(olGeometry, projection);\n    console.assert(olGeometry.getType() == 'LineString');\n\n    const positions = olcsCore.ol4326CoordinateArrayToCsCartesians(olGeometry.getCoordinates());\n    const width = this.extractLineWidthFromOlStyle(olStyle);\n\n    let outlinePrimitive;\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND && !isGroundPolylinePrimitiveSupported(this.scene)) {\n      const color = this.extractColorFromOlStyle(olStyle, true);\n      outlinePrimitive = this.createStackedGroundCorridors(layer, feature, width, color, positions);\n    } else {\n      const appearance = new Cesium.PolylineMaterialAppearance({\n        // always update Cesium externs before adding a property\n        material: this.olStyleToCesium(feature, olStyle, true)\n      });\n      const geometryOptions = {\n        // always update Cesium externs before adding a property\n        positions,\n        width,\n      };\n      const primitiveOptions = {\n        // always update Cesium externs before adding a property\n        appearance\n      };\n      if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n        const geometry = new Cesium.GroundPolylineGeometry(geometryOptions);\n        primitiveOptions.geometryInstances = new Cesium.GeometryInstance({\n          geometry\n        }),\n        outlinePrimitive = new Cesium.GroundPolylinePrimitive(primitiveOptions);\n        outlinePrimitive.readyPromise.then(() => {\n          this.setReferenceForPicking(layer, feature, outlinePrimitive._primitive);\n        });\n      } else {\n        geometryOptions.vertexFormat = appearance.vertexFormat;\n        const geometry = new Cesium.PolylineGeometry(geometryOptions);\n        primitiveOptions.geometryInstances = new Cesium.GeometryInstance({\n          geometry\n        }),\n        outlinePrimitive = new Cesium.Primitive(primitiveOptions);\n      }\n    }\n\n    this.setReferenceForPicking(layer, feature, outlinePrimitive);\n\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, outlinePrimitive);\n  }\n\n  /**\n   * Convert an OpenLayers polygon geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Polygon} olGeometry OpenLayers polygon geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @return {!Cesium.PrimitiveCollection} primitives\n   * @api\n   */\n  olPolygonGeometryToCesium(layer, feature, olGeometry, projection, olStyle) {\n\n    olGeometry = olcsCore.olGeometryCloneTo4326(olGeometry, projection);\n    console.assert(olGeometry.getType() == 'Polygon');\n\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    let fillGeometry, outlineGeometry, outlinePrimitive;\n    if ((olGeometry.getCoordinates()[0].length == 5) &&\n        (feature.getGeometry().get('olcs.polygon_kind') === 'rectangle')) {\n      // Create a rectangle according to the longitude and latitude curves\n      const coordinates = olGeometry.getCoordinates()[0];\n      // Extract the West, South, East, North coordinates\n      const extent = boundingExtent(coordinates);\n      const rectangle = Cesium.Rectangle.fromDegrees(extent[0], extent[1],\n          extent[2], extent[3]);\n\n      // Extract the average height of the vertices\n      let maxHeight = 0.0;\n      if (coordinates[0].length == 3) {\n        for (let c = 0; c < coordinates.length; c++) {\n          maxHeight = Math.max(maxHeight, coordinates[c][2]);\n        }\n      }\n\n      // Render the cartographic rectangle\n      fillGeometry = new Cesium.RectangleGeometry({\n        ellipsoid: Cesium.Ellipsoid.WGS84,\n        rectangle,\n        height: maxHeight\n      });\n\n      outlineGeometry = new Cesium.RectangleOutlineGeometry({\n        ellipsoid: Cesium.Ellipsoid.WGS84,\n        rectangle,\n        height: maxHeight\n      });\n    } else {\n      const rings = olGeometry.getLinearRings();\n      // always update Cesium externs before adding a property\n      const hierarchy = {};\n      const polygonHierarchy = hierarchy;\n      console.assert(rings.length > 0);\n\n      for (let i = 0; i < rings.length; ++i) {\n        const olPos = rings[i].getCoordinates();\n        const positions = olcsCore.ol4326CoordinateArrayToCsCartesians(olPos);\n        console.assert(positions && positions.length > 0);\n        if (i == 0) {\n          hierarchy.positions = positions;\n        } else {\n          if (!hierarchy.holes) {\n            hierarchy.holes = [];\n          }\n          hierarchy.holes.push({\n            positions\n          });\n        }\n      }\n\n      fillGeometry = new Cesium.PolygonGeometry({\n        // always update Cesium externs before adding a property\n        polygonHierarchy,\n        perPositionHeight: true\n      });\n\n      // Since Cesium doesn't yet support Polygon outlines on terrain yet (coming soon...?)\n      // we don't create an outline geometry if clamped, but instead do the polyline method\n      // for each ring. Most of this code should be removeable when Cesium adds\n      // support for Polygon outlines on terrain.\n      if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n        const width = this.extractLineWidthFromOlStyle(olStyle);\n        if (width > 0) {\n          const positions = [hierarchy.positions];\n          if (hierarchy.holes) {\n            for (let i = 0; i < hierarchy.holes.length; ++i) {\n              positions.push(hierarchy.holes[i].positions);\n            }\n          }\n          if (!isGroundPolylinePrimitiveSupported(this.scene)) {\n            const color = this.extractColorFromOlStyle(olStyle, true);\n            outlinePrimitive = this.createStackedGroundCorridors(layer, feature, width, color, positions);\n          } else {\n            const appearance = new Cesium.PolylineMaterialAppearance({\n              // always update Cesium externs before adding a property\n              material: this.olStyleToCesium(feature, olStyle, true)\n            });\n            const geometryInstances = [];\n            for (const linePositions of positions) {\n              const polylineGeometry = new Cesium.GroundPolylineGeometry({positions: linePositions, width});\n              geometryInstances.push(new Cesium.GeometryInstance({\n                geometry: polylineGeometry\n              }));\n            }\n            const primitiveOptions = {\n              // always update Cesium externs before adding a property\n              appearance,\n              geometryInstances\n            };\n            outlinePrimitive = new Cesium.GroundPolylinePrimitive(primitiveOptions);\n            outlinePrimitive.readyPromise.then(() => {\n              this.setReferenceForPicking(layer, feature, outlinePrimitive._primitive);\n            });\n          }\n        }\n      } else {\n        // Actually do the normal polygon thing. This should end the removable\n        // section of code described above.\n        outlineGeometry = new Cesium.PolygonOutlineGeometry({\n          // always update Cesium externs before adding a property\n          polygonHierarchy: hierarchy,\n          perPositionHeight: true\n        });\n      }\n    }\n\n    const primitives = this.wrapFillAndOutlineGeometries(\n        layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle);\n\n    if (outlinePrimitive) {\n      primitives.add(outlinePrimitive);\n    }\n\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, primitives);\n  }\n\n  /**\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry\n   * @return {!Cesium.HeightReference}\n   * @api\n   */\n  getHeightReference(layer, feature, geometry) {\n\n    // Read from the geometry\n    let altitudeMode = geometry.get('altitudeMode');\n\n    // Or from the feature\n    if (altitudeMode === undefined) {\n      altitudeMode = feature.get('altitudeMode');\n    }\n\n    // Or from the layer\n    if (altitudeMode === undefined) {\n      altitudeMode = layer.get('altitudeMode');\n    }\n\n    let heightReference = Cesium.HeightReference.NONE;\n    if (altitudeMode === 'clampToGround') {\n      heightReference = Cesium.HeightReference.CLAMP_TO_GROUND;\n    } else if (altitudeMode === 'relativeToGround') {\n      heightReference = Cesium.HeightReference.RELATIVE_TO_GROUND;\n    }\n\n    return heightReference;\n  }\n\n  /**\n   * Convert a point geometry to a Cesium BillboardCollection.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Point} olGeometry OpenLayers point geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} style\n   * @param {!ol.style.Image} imageStyle\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when the new billboard is added.\n   * @api\n   */\n  createBillboardFromImage(\n      layer,\n      feature,\n      olGeometry,\n      projection,\n      style,\n      imageStyle,\n      billboards,\n      opt_newBillboardCallback\n  ) {\n\n    if (imageStyle instanceof olStyleIcon) {\n      // make sure the image is scheduled for load\n      imageStyle.load();\n    }\n\n    const image = imageStyle.getImage(1); // get normal density\n    const isImageLoaded = function(image) {\n      return image.src != '' &&\n          image.naturalHeight != 0 &&\n          image.naturalWidth != 0 &&\n          image.complete;\n    };\n    const reallyCreateBillboard = (function() {\n      if (!image) {\n        return;\n      }\n      if (!(image instanceof HTMLCanvasElement ||\n          image instanceof Image ||\n          image instanceof HTMLImageElement)) {\n        return;\n      }\n      const center = olGeometry.getCoordinates();\n      const position = olcsCore.ol4326CoordinateToCesiumCartesian(center);\n      let color;\n      const opacity = imageStyle.getOpacity();\n      if (opacity !== undefined) {\n        color = new Cesium.Color(1.0, 1.0, 1.0, opacity);\n      }\n\n      const scale = imageStyle.getScale();\n      const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n      const bbOptions = /** @type {Cesium.optionsBillboardCollectionAdd} */ ({\n        // always update Cesium externs before adding a property\n        image,\n        color,\n        scale,\n        heightReference,\n        position\n      });\n\n      // merge in cesium options from openlayers feature\n      Object.assign(bbOptions, feature.get('cesiumOptions'));\n\n      if (imageStyle instanceof olStyleIcon) {\n        const anchor = imageStyle.getAnchor();\n        if (anchor) {\n          bbOptions.pixelOffset = new Cesium.Cartesian2((image.width / 2 - anchor[0]) * scale, (image.height / 2 - anchor[1]) * scale);\n        }\n      }\n\n      const bb = this.csAddBillboard(billboards, bbOptions, layer, feature, olGeometry, style);\n      if (opt_newBillboardCallback) {\n        opt_newBillboardCallback(bb);\n      }\n    }).bind(this);\n\n    if (image instanceof Image && !isImageLoaded(image)) {\n      // Cesium requires the image to be loaded\n      let cancelled = false;\n      const source = layer.getSource();\n      const canceller = function() {\n        cancelled = true;\n      };\n      source.on(['removefeature', 'clear'],\n          this.boundOnRemoveOrClearFeatureListener_);\n      let cancellers = olcsUtil.obj(source)['olcs_cancellers'];\n      if (!cancellers) {\n        cancellers = olcsUtil.obj(source)['olcs_cancellers'] = {};\n      }\n\n      const fuid = getUid(feature);\n      if (cancellers[fuid]) {\n        // When the feature change quickly, a canceller may still be present so\n        // we cancel it here to prevent creation of a billboard.\n        cancellers[fuid]();\n      }\n      cancellers[fuid] = canceller;\n\n      const listener = function() {\n        image.removeEventListener('load', listener);\n        if (!billboards.isDestroyed() && !cancelled) {\n          // Create billboard if the feature is still displayed on the map.\n          reallyCreateBillboard();\n        }\n      };\n\n      image.addEventListener('load', listener);\n    } else {\n      reallyCreateBillboard();\n    }\n  }\n\n  /**\n   * Convert a point geometry to a Cesium BillboardCollection.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Point} olGeometry OpenLayers point geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} style\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when\n   * the new billboard is added.\n   * @return {Cesium.Primitive} primitives\n   * @api\n   */\n  olPointGeometryToCesium(\n      layer,\n      feature,\n      olGeometry,\n      projection,\n      style,\n      billboards,\n      opt_newBillboardCallback\n  ) {\n    console.assert(olGeometry.getType() == 'Point');\n    olGeometry = olcsCore.olGeometryCloneTo4326(olGeometry, projection);\n\n    let modelPrimitive = null;\n    const imageStyle = style.getImage();\n    if (imageStyle) {\n      const olcsModelFunction = /** @type {function():olcsx.ModelStyle} */ (olGeometry.get('olcs_model') || feature.get('olcs_model'));\n      if (olcsModelFunction) {\n        const olcsModel = olcsModelFunction();\n        const options = /** @type {Cesium.ModelFromGltfOptions} */ (Object.assign({}, {scene: this.scene}, olcsModel.cesiumOptions));\n        const model = Cesium.Model.fromGltf(options);\n        modelPrimitive = new Cesium.PrimitiveCollection();\n        modelPrimitive.add(model);\n        if (olcsModel.debugModelMatrix) {\n          modelPrimitive.add(new Cesium.DebugModelMatrixPrimitive({\n            modelMatrix: olcsModel.debugModelMatrix\n          }));\n        }\n      } else {\n        this.createBillboardFromImage(layer, feature, olGeometry, projection, style, imageStyle, billboards, opt_newBillboardCallback);\n      }\n    }\n\n    if (style.getText()) {\n      return this.addTextStyle(layer, feature, olGeometry, style, modelPrimitive || new Cesium.Primitive());\n    } else {\n      return modelPrimitive;\n    }\n  }\n\n  /**\n   * Convert an OpenLayers multi-something geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry OpenLayers geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when\n   * the new billboard is added.\n   * @return {Cesium.Primitive} primitives\n   * @api\n   */\n  olMultiGeometryToCesium(\n      layer,\n      feature,\n      geometry,\n      projection,\n      olStyle,\n      billboards,\n      opt_newBillboardCallback\n  ) {\n    // Do not reproject to 4326 now because it will be done later.\n\n    // FIXME: would be better to combine all child geometries in one primitive\n    // instead we create n primitives for simplicity.\n    const accumulate = function(geometries, functor) {\n      const primitives = new Cesium.PrimitiveCollection();\n      geometries.forEach((geometry) => {\n        primitives.add(functor(layer, feature, geometry, projection, olStyle));\n      });\n      return primitives;\n    };\n\n    let subgeos;\n    switch (geometry.getType()) {\n      case 'MultiPoint':\n        geometry = /** @type {!ol.geom.MultiPoint} */ (geometry);\n        subgeos = geometry.getPoints();\n        if (olStyle.getText()) {\n          const primitives = new Cesium.PrimitiveCollection();\n          subgeos.forEach((geometry) => {\n            console.assert(geometry);\n            const result = this.olPointGeometryToCesium(layer, feature, geometry,\n                projection, olStyle, billboards, opt_newBillboardCallback);\n            if (result) {\n              primitives.add(result);\n            }\n          });\n          return primitives;\n        } else {\n          subgeos.forEach((geometry) => {\n            console.assert(geometry);\n            this.olPointGeometryToCesium(layer, feature, geometry, projection,\n                olStyle, billboards, opt_newBillboardCallback);\n          });\n          return null;\n        }\n      case 'MultiLineString':\n        geometry = /** @type {!ol.geom.MultiLineString} */ (geometry);\n        subgeos = geometry.getLineStrings();\n        return accumulate(subgeos, this.olLineStringGeometryToCesium.bind(this));\n      case 'MultiPolygon':\n        geometry = /** @type {!ol.geom.MultiPolygon} */ (geometry);\n        subgeos = geometry.getPolygons();\n        return accumulate(subgeos, this.olPolygonGeometryToCesium.bind(this));\n      default:\n        console.assert(false, `Unhandled multi geometry type${geometry.getType()}`);\n    }\n  }\n\n  /**\n   * Convert an OpenLayers text style to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry\n   * @param {!ol.style.Text} style\n   * @return {Cesium.LabelCollection} Cesium primitive\n   * @api\n   */\n  olGeometry4326TextPartToCesium(layer, feature, geometry, style) {\n    const text = style.getText();\n    if (!text) {\n      return null;\n    }\n\n    const labels = new Cesium.LabelCollection({scene: this.scene});\n    // TODO: export and use the text draw position from OpenLayers .\n    // See src/ol/render/vector.js\n    const extentCenter = getCenter(geometry.getExtent());\n    if (geometry instanceof olGeomSimpleGeometry) {\n      const first = geometry.getFirstCoordinate();\n      extentCenter[2] = first.length == 3 ? first[2] : 0.0;\n    }\n    const options = /** @type {Cesium.optionsLabelCollection} */ ({});\n\n    options.position = olcsCore.ol4326CoordinateToCesiumCartesian(extentCenter);\n\n    options.text = text;\n\n    options.heightReference = this.getHeightReference(layer, feature, geometry);\n\n    const offsetX = style.getOffsetX();\n    const offsetY = style.getOffsetY();\n    if (offsetX != 0 && offsetY != 0) {\n      const offset = new Cesium.Cartesian2(offsetX, offsetY);\n      options.pixelOffset = offset;\n    }\n\n    options.font = style.getFont() || '10px sans-serif'; // OpenLayers default\n\n    let labelStyle = undefined;\n    if (style.getFill()) {\n      options.fillColor = this.extractColorFromOlStyle(style, false);\n      labelStyle = Cesium.LabelStyle.FILL;\n    }\n    if (style.getStroke()) {\n      options.outlineWidth = this.extractLineWidthFromOlStyle(style);\n      options.outlineColor = this.extractColorFromOlStyle(style, true);\n      labelStyle = Cesium.LabelStyle.OUTLINE;\n    }\n    if (style.getFill() && style.getStroke()) {\n      labelStyle = Cesium.LabelStyle.FILL_AND_OUTLINE;\n    }\n    options.style = labelStyle;\n\n    let horizontalOrigin;\n    switch (style.getTextAlign()) {\n      case 'left':\n        horizontalOrigin = Cesium.HorizontalOrigin.LEFT;\n        break;\n      case 'right':\n        horizontalOrigin = Cesium.HorizontalOrigin.RIGHT;\n        break;\n      case 'center':\n      default:\n        horizontalOrigin = Cesium.HorizontalOrigin.CENTER;\n    }\n    options.horizontalOrigin = horizontalOrigin;\n\n    if (style.getTextBaseline()) {\n      let verticalOrigin;\n      switch (style.getTextBaseline()) {\n        case 'top':\n          verticalOrigin = Cesium.VerticalOrigin.TOP;\n          break;\n        case 'middle':\n          verticalOrigin = Cesium.VerticalOrigin.CENTER;\n          break;\n        case 'bottom':\n          verticalOrigin = Cesium.VerticalOrigin.BOTTOM;\n          break;\n        case 'alphabetic':\n          verticalOrigin = Cesium.VerticalOrigin.TOP;\n          break;\n        case 'hanging':\n          verticalOrigin = Cesium.VerticalOrigin.BOTTOM;\n          break;\n        default:\n          console.assert(false, `unhandled baseline ${style.getTextBaseline()}`);\n      }\n      options.verticalOrigin = verticalOrigin;\n    }\n\n\n    const l = labels.add(options);\n    this.setReferenceForPicking(layer, feature, l);\n    return labels;\n  }\n\n  /**\n   * Convert an OpenLayers style to a Cesium Material.\n   * @param {ol.Feature} feature OpenLayers feature..\n   * @param {!ol.style.Style} style\n   * @param {boolean} outline\n   * @return {Cesium.Material}\n   * @api\n   */\n  olStyleToCesium(feature, style, outline) {\n    const fill = style.getFill();\n    const stroke = style.getStroke();\n    if ((outline && !stroke) || (!outline && !fill)) {\n      return null; // FIXME use a default style? Developer error?\n    }\n\n    let color = outline ? stroke.getColor() : fill.getColor();\n    color = olcsCore.convertColorToCesium(color);\n\n    if (outline && stroke.getLineDash()) {\n      return Cesium.Material.fromType('Stripe', {\n        // always update Cesium externs before adding a property\n        horizontal: false,\n        repeat: 500, // TODO how to calculate this?\n        evenColor: color,\n        oddColor: new Cesium.Color(0, 0, 0, 0) // transparent\n      });\n    } else {\n      return Cesium.Material.fromType('Color', {\n        // always update Cesium externs before adding a property\n        color\n      });\n    }\n\n  }\n\n  /**\n   * Compute OpenLayers plain style.\n   * Evaluates style function, blend arrays, get default style.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature\n   * @param {ol.StyleFunction|undefined} fallbackStyleFunction\n   * @param {number} resolution\n   * @return {Array.<!ol.style.Style>} null if no style is available\n   * @api\n   */\n  computePlainStyle(layer, feature, fallbackStyleFunction, resolution) {\n    /**\n     * @type {ol.FeatureStyleFunction|undefined}\n     */\n    const featureStyleFunction = feature.getStyleFunction();\n\n    /**\n     * @type {ol.style.Style|Array.<ol.style.Style>}\n     */\n    let style = null;\n\n    if (featureStyleFunction) {\n      style = featureStyleFunction(feature, resolution);\n    }\n\n    if (!style && fallbackStyleFunction) {\n      style = fallbackStyleFunction(feature, resolution);\n    }\n\n    if (!style) {\n      // The feature must not be displayed\n      return null;\n    }\n\n    // FIXME combine materials as in cesium-materials-pack?\n    // then this function must return a custom material\n    // More simply, could blend the colors like described in\n    // http://en.wikipedia.org/wiki/Alpha_compositing\n    return Array.isArray(style) ? style : [style];\n  }\n\n  /**\n   * @protected\n   * @param {!ol.Feature} feature\n   * @param {!ol.style.Style} style\n   * @param {!ol.geom.Geometry=} opt_geom Geometry to be converted.\n   * @return {ol.geom.Geometry|undefined}\n   */\n  getGeometryFromFeature(feature, style, opt_geom) {\n    if (opt_geom) {\n      return opt_geom;\n    }\n\n    const geom3d = /** @type {!ol.geom.Geometry} */(feature.get('olcs.3d_geometry'));\n    if (geom3d && geom3d instanceof olGeomGeometry) {\n      return geom3d;\n    }\n\n    if (style) {\n      const geomFuncRes = style.getGeometryFunction()(feature);\n      if (geomFuncRes instanceof olGeomGeometry) {\n        return geomFuncRes;\n      }\n    }\n\n    return feature.getGeometry();\n  }\n\n  /**\n   * Convert one OpenLayers feature up to a collection of Cesium primitives.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!ol.style.Style} style\n   * @param {!import('olcs/core/VectorLayerConterpart.js').OlFeatureToCesiumContext} context\n   * @param {!ol.geom.Geometry=} opt_geom Geometry to be converted.\n   * @return {Cesium.Primitive} primitives\n   * @api\n   */\n  olFeatureToCesium(layer, feature, style, context, opt_geom) {\n    let geom = this.getGeometryFromFeature(feature, style, opt_geom);\n\n    if (!geom) {\n      // OpenLayers features may not have a geometry\n      // See http://geojson.org/geojson-spec.html#feature-objects\n      return null;\n    }\n\n    const proj = context.projection;\n    const newBillboardAddedCallback = function(bb) {\n      const featureBb = context.featureToCesiumMap[getUid(feature)];\n      if (featureBb instanceof Array) {\n        featureBb.push(bb);\n      }\n      else {\n        context.featureToCesiumMap[getUid(feature)] = [bb];\n      }\n    };\n\n    switch (geom.getType()) {\n      case 'GeometryCollection':\n        const primitives = new Cesium.PrimitiveCollection();\n        const collection = /** @type {!ol.geom.GeometryCollection} */ (geom);\n        // TODO: use getGeometriesArray() instead\n        collection.getGeometries().forEach((geom) => {\n          if (geom) {\n            const prims = this.olFeatureToCesium(layer, feature, style, context,\n                geom);\n            if (prims) {\n              primitives.add(prims);\n            }\n          }\n        });\n        return primitives;\n      case 'Point':\n        geom = /** @type {!ol.geom.Point} */ (geom);\n        const bbs = context.billboards;\n        const result = this.olPointGeometryToCesium(layer, feature, geom, proj,\n            style, bbs, newBillboardAddedCallback);\n        if (!result) {\n          // no wrapping primitive\n          return null;\n        } else {\n          return result;\n        }\n      case 'Circle':\n        geom = /** @type {!ol.geom.Circle} */ (geom);\n        return this.olCircleGeometryToCesium(layer, feature, geom, proj,\n            style);\n      case 'LineString':\n        geom = /** @type {!ol.geom.LineString} */ (geom);\n        return this.olLineStringGeometryToCesium(layer, feature, geom, proj,\n            style);\n      case 'Polygon':\n        geom = /** @type {!ol.geom.Polygon} */ (geom);\n        return this.olPolygonGeometryToCesium(layer, feature, geom, proj,\n            style);\n      case 'MultiPoint':\n      case 'MultiLineString':\n      case 'MultiPolygon':\n        const result2 = this.olMultiGeometryToCesium(layer, feature, geom, proj,\n            style, context.billboards, newBillboardAddedCallback);\n        if (!result2) {\n          // no wrapping primitive\n          return null;\n        } else {\n          return result2;\n        }\n      case 'LinearRing':\n        throw new Error('LinearRing should only be part of polygon.');\n      default:\n        throw new Error(`Ol geom type not handled : ${geom.getType()}`);\n    }\n  }\n\n  /**\n   * Convert an OpenLayers vector layer to Cesium primitive collection.\n   * For each feature, the associated primitive will be stored in\n   * `featurePrimitiveMap`.\n   * @param {!(ol.layer.Vector|ol.layer.Image)} olLayer\n   * @param {!ol.View} olView\n   * @param {!Object.<number, !Cesium.Primitive>} featurePrimitiveMap\n   * @return {!olcs.core.VectorLayerCounterpart}\n   * @api\n   */\n  olVectorLayerToCesium(olLayer, olView, featurePrimitiveMap) {\n    const proj = olView.getProjection();\n    const resolution = olView.getResolution();\n\n    if (resolution === undefined || !proj) {\n      console.assert(false, 'View not ready');\n      // an assertion is not enough for closure to assume resolution and proj\n      // are defined\n      throw new Error('View not ready');\n    }\n\n    let source = olLayer.getSource();\n    if (source instanceof olSourceCluster) {\n      source = source.getSource();\n    }\n\n    console.assert(source instanceof olSourceVector);\n    const features = source.getFeatures();\n    const counterpart = new olcsCoreVectorLayerCounterpart(proj, this.scene);\n    const context = counterpart.context;\n    for (let i = 0; i < features.length; ++i) {\n      const feature = features[i];\n      if (!feature) {\n        continue;\n      }\n      /**\n       * @type {ol.StyleFunction|undefined}\n       */\n      const layerStyle = olLayer.getStyleFunction();\n      const styles = this.computePlainStyle(olLayer, feature, layerStyle,\n          resolution);\n      if (!styles || !styles.length) {\n        // only 'render' features with a style\n        continue;\n      }\n\n      /**\n       * @type {Cesium.Primitive|null}\n       */\n      let primitives = null;\n      for (let i = 0; i < styles.length; i++) {\n        const prims = this.olFeatureToCesium(olLayer, feature, styles[i], context);\n        if (prims) {\n          if (!primitives) {\n            primitives = prims;\n          } else if (prims) {\n            let i = 0, prim;\n            while ((prim = prims.get(i))) {\n              primitives.add(prim);\n              i++;\n            }\n          }\n        }\n      }\n      if (!primitives) {\n        continue;\n      }\n      featurePrimitiveMap[getUid(feature)] = primitives;\n      counterpart.getRootPrimitive().add(primitives);\n    }\n\n    return counterpart;\n  }\n\n  /**\n   * Convert an OpenLayers feature to Cesium primitive collection.\n   * @param {!(ol.layer.Vector|ol.layer.Image)} layer\n   * @param {!ol.View} view\n   * @param {!ol.Feature} feature\n   * @param {!import('olcs/core/VectorLayerConterpart.js').OlFeatureToCesiumContext} context\n   * @return {Cesium.Primitive}\n   * @api\n   */\n  convert(layer, view, feature, context) {\n    const proj = view.getProjection();\n    const resolution = view.getResolution();\n\n    if (resolution == undefined || !proj) {\n      return null;\n    }\n\n    /**\n     * @type {ol.StyleFunction|undefined}\n     */\n    const layerStyle = layer.getStyleFunction();\n\n    const styles = this.computePlainStyle(layer, feature, layerStyle, resolution);\n\n    if (!styles || !styles.length) {\n      // only 'render' features with a style\n      return null;\n    }\n\n    context.projection = proj;\n\n    /**\n     * @type {Cesium.Primitive|null}\n     */\n    let primitives = null;\n    for (let i = 0; i < styles.length; i++) {\n      const prims = this.olFeatureToCesium(layer, feature, styles[i], context);\n      if (!primitives) {\n        primitives = prims;\n      } else if (prims) {\n        let i = 0, prim;\n        while ((prim = prims.get(i))) {\n          primitives.add(prim);\n          i++;\n        }\n      }\n    }\n    return primitives;\n  }\n}\n\n\nexport default FeatureConverter;\n","/**\n * @module olcs.VectorSynchronizer\n */\nimport olSourceVector from 'ol/source/Vector.js';\nimport olLayerLayer from 'ol/layer/Layer.js';\nimport olSourceCluster from 'ol/source/Cluster.js';\nimport olLayerImage from 'ol/layer/Image.js';\nimport {olcsListen, getUid} from './util.js';\nimport olLayerVector from 'ol/layer/Vector.js';\nimport olLayerVectorTile from 'ol/layer/VectorTile.js';\nimport olcsAbstractSynchronizer from './AbstractSynchronizer.js';\nimport olcsFeatureConverter from './FeatureConverter.js';\n\nclass VectorSynchronizer extends olcsAbstractSynchronizer {\n  /**\n   * Unidirectionally synchronize OpenLayers vector layers to Cesium.\n   * @param {!ol.Map} map\n   * @param {!Cesium.Scene} scene\n   * @param {olcs.FeatureConverter=} opt_converter\n   * @extends {olcs.AbstractSynchronizer.<olcs.core.VectorLayerCounterpart>}\n   * @api\n   */\n  constructor(map, scene, opt_converter) {\n    super(map, scene);\n\n    /**\n     * @protected\n     */\n    this.converter = opt_converter || new olcsFeatureConverter(scene);\n\n    /**\n     * @private\n     */\n    this.csAllPrimitives_ = new Cesium.PrimitiveCollection();\n    scene.primitives.add(this.csAllPrimitives_);\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  addCesiumObject(counterpart) {\n    console.assert(counterpart);\n    counterpart.getRootPrimitive()['counterpart'] = counterpart;\n    this.csAllPrimitives_.add(counterpart.getRootPrimitive());\n  }\n\n  /**\n   * @inheritDoc\n   */\n  destroyCesiumObject(object) {\n    object.getRootPrimitive().destroy();\n  }\n\n  /**\n   * @inheritDoc\n   */\n  removeSingleCesiumObject(object, destroy) {\n    object.destroy();\n    this.csAllPrimitives_.destroyPrimitives = destroy;\n    this.csAllPrimitives_.remove(object.getRootPrimitive());\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  removeAllCesiumObjects(destroy) {\n    this.csAllPrimitives_.destroyPrimitives = destroy;\n    if (destroy) {\n      for (let i = 0; i < this.csAllPrimitives_.length; ++i) {\n        this.csAllPrimitives_.get(i)['counterpart'].destroy();\n      }\n    }\n    this.csAllPrimitives_.removeAll();\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  /**\n   * Synchronizes the layer visibility properties\n   * to the given Cesium Primitive.\n   * @param {import('olsc/core.js').LayerWithParents} olLayerWithParents\n   * @param {!Cesium.Primitive} csPrimitive\n   */\n  updateLayerVisibility(olLayerWithParents, csPrimitive) {\n    let visible = true;\n    [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayer) => {\n      const layerVisible = olLayer.getVisible();\n      if (layerVisible !== undefined) {\n        visible &= layerVisible;\n      } else {\n        visible = false;\n      }\n    });\n    csPrimitive.show = visible;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  createSingleLayerCounterparts(olLayerWithParents) {\n    const olLayer = olLayerWithParents.layer;\n    if (!(olLayer instanceof olLayerVector) || olLayer instanceof olLayerVectorTile) {\n      return null;\n    }\n    console.assert(olLayer instanceof olLayerLayer);\n\n    let source = olLayer.getSource();\n    if (source instanceof olSourceCluster) {\n      source = source.getSource();\n    }\n\n    if (!source) {\n      return null;\n    }\n\n    console.assert(source instanceof olSourceVector);\n    console.assert(this.view);\n\n    const view = this.view;\n    const featurePrimitiveMap = {};\n    const counterpart = this.converter.olVectorLayerToCesium(olLayer, view,\n        featurePrimitiveMap);\n    const csPrimitives = counterpart.getRootPrimitive();\n    const olListenKeys = counterpart.olListenKeys;\n\n    [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayerItem) => {\n      olListenKeys.push(olcsListen(olLayerItem, 'change:visible', () => {\n        this.updateLayerVisibility(olLayerWithParents, csPrimitives);\n      }));\n    });\n    this.updateLayerVisibility(olLayerWithParents, csPrimitives);\n\n    const onAddFeature = (function(feature) {\n      console.assert(\n          (olLayer instanceof olLayerVector) ||\n          (olLayer instanceof olLayerImage)\n      );\n      const context = counterpart.context;\n      const prim = this.converter.convert(olLayer, view, feature, context);\n      if (prim) {\n        featurePrimitiveMap[getUid(feature)] = prim;\n        csPrimitives.add(prim);\n      }\n    }).bind(this);\n\n    const onRemoveFeature = (function(feature) {\n      const id = getUid(feature);\n      const context = counterpart.context;\n      const bbs = context.featureToCesiumMap[id];\n      if (bbs) {\n        delete context.featureToCesiumMap[id];\n        bbs.forEach((bb) => {\n          if (bb instanceof Cesium.Billboard) {\n            context.billboards.remove(bb);\n          }\n        });\n      }\n      const csPrimitive = featurePrimitiveMap[id];\n      delete featurePrimitiveMap[id];\n      if (csPrimitive) {\n        csPrimitives.remove(csPrimitive);\n      }\n    }).bind(this);\n\n    olListenKeys.push(olcsListen(source, 'addfeature', (e) => {\n      console.assert(e.feature);\n      onAddFeature(e.feature);\n    }, this));\n\n    olListenKeys.push(olcsListen(source, 'removefeature', (e) => {\n      console.assert(e.feature);\n      onRemoveFeature(e.feature);\n    }, this));\n\n    olListenKeys.push(olcsListen(source, 'changefeature', (e) => {\n      const feature = e.feature;\n      console.assert(feature);\n      onRemoveFeature(feature);\n      onAddFeature(feature);\n    }, this));\n\n    return counterpart ? [counterpart] : null;\n  }\n}\n\nexport default VectorSynchronizer;\n","/**\n * @module olcs.SynchronizedOverlay\n */\nimport olOverlay from 'ol/Overlay.js';\nimport {transform} from 'ol/proj.js';\nimport {removeNode, removeChildren} from './util.js';\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\n\n\n/**\n * Options for SynchronizedOverlay\n * @typedef {Object} SynchronizedOverlayOptions\n * @property {!Cesium.Scene} scene\n * @property {olOverlay} parent\n * @property {!import('olsc/OverlaySynchronizer.js').default} synchronizer\n */\n\n\nclass SynchronizedOverlay extends olOverlay {\n  /**\n   * @param {olcsx.SynchronizedOverlayOptions} options SynchronizedOverlay Options.\n   * @api\n   */\n  constructor(options) {\n    const parent = options.parent;\n    super(parent.getOptions());\n\n    /**\n     * @private\n     * @type {?Function}\n     */\n    this.scenePostRenderListenerRemover_ = null;\n\n    /**\n     * @private\n     * @type {!Cesium.Scene}\n     */\n    this.scene_ = options.scene;\n\n    /**\n     * @private\n     * @type {!olcs.OverlaySynchronizer}\n     */\n    this.synchronizer_ = options.synchronizer;\n\n    /**\n     * @private\n     * @type {!ol.Overlay}\n     */\n    this.parent_ = parent;\n\n    /**\n     * @private\n     * @type {ol.Coordinate|undefined}\n     */\n    this.positionWGS84_ = undefined;\n\n    /**\n     * @private\n     * @type {MutationObserver}\n     */\n    this.observer_ = new MutationObserver(this.handleElementChanged.bind(this));\n\n    /**\n     * @private\n     * @type {Array.<MutationObserver>}\n     */\n    this.attributeObserver_ = [];\n\n    /**\n     * @private\n     * @type {Array<ol.EventsKey>}\n     */\n    this.listenerKeys_ = [];\n    // synchronize our Overlay with the parent Overlay\n    const setPropertyFromEvent = event => this.setPropertyFromEvent_(event);\n    this.listenerKeys_.push(this.parent_.on('change:position', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:element', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:offset', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:position', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:positioning', setPropertyFromEvent));\n\n    this.setProperties(this.parent_.getProperties());\n\n    this.handleMapChanged();\n    this.handleElementChanged();\n  }\n\n  /**\n   * @param {Node} target\n   * @private\n   */\n  observeTarget_(target) {\n    if (!this.observer_) {\n      // not ready, skip the event (this occurs on construction)\n      return;\n    }\n    this.observer_.disconnect();\n    this.observer_.observe(target, {\n      attributes: false,\n      childList: true,\n      characterData: true,\n      subtree: true\n    });\n    this.attributeObserver_.forEach((observer) => {\n      observer.disconnect();\n    });\n    this.attributeObserver_.length = 0;\n    for (let i = 0; i < target.childNodes.length; i++) {\n      const node = target.childNodes[i];\n      if (node.nodeType === 1) {\n        const observer = new MutationObserver(this.handleElementChanged.bind(this));\n        observer.observe(node, {\n          attributes: true,\n          subtree: true\n        });\n        this.attributeObserver_.push(observer);\n      }\n    }\n  }\n\n  /**\n   *\n   * @param {ol.Object.Event} event\n   * @private\n   */\n  setPropertyFromEvent_(event) {\n    if (event.target && event.key) {\n      this.set(event.key, event.target.get(event.key));\n    }\n  }\n\n  /**\n   * Get the scene associated with this overlay.\n   * @see ol.Overlay.prototype.getMap\n   * @return {!Cesium.Scene} The scene that the overlay is part of.\n   * @api\n   */\n  getScene() {\n    return this.scene_;\n  }\n\n  /**\n   * @override\n   */\n  handleMapChanged() {\n    if (this.scenePostRenderListenerRemover_) {\n      this.scenePostRenderListenerRemover_();\n      removeNode(this.element);\n    }\n    this.scenePostRenderListenerRemover_ = null;\n    const scene = this.getScene();\n    if (scene) {\n      this.scenePostRenderListenerRemover_ = scene.postRender.addEventListener(this.updatePixelPosition.bind(this));\n      this.updatePixelPosition();\n      const container = this.stopEvent ?\n        this.synchronizer_.getOverlayContainerStopEvent() : this.synchronizer_.getOverlayContainer();\n      if (this.insertFirst) {\n        container.insertBefore(this.element, container.childNodes[0] || null);\n      } else {\n        container.appendChild(this.element);\n      }\n    }\n  }\n\n  /**\n   * @override\n   */\n  handlePositionChanged() {\n    // transform position to WGS84\n    const position = this.getPosition();\n    if (position) {\n      const sourceProjection = this.parent_.getMap().getView().getProjection();\n      this.positionWGS84_ = transform(position, sourceProjection, 'EPSG:4326');\n    } else {\n      this.positionWGS84_ = undefined;\n    }\n    this.updatePixelPosition();\n  }\n\n  /**\n   * @override\n   */\n  handleElementChanged() {\n    function cloneNode(node, parent) {\n      const clone = node.cloneNode();\n      if (node.nodeName === 'CANVAS') {\n        const ctx = clone.getContext('2d');\n        ctx.drawImage(node, 0, 0);\n      }\n      if (parent) {\n        parent.appendChild(clone);\n      }\n      if (node.nodeType != Node.TEXT_NODE) {\n        clone.addEventListener('click', (event) => {\n          node.dispatchEvent(new MouseEvent('click', event));\n          event.stopPropagation();\n        });\n      }\n      const nodes = node.childNodes;\n      for (let i = 0; i < nodes.length; i++) {\n        if (!nodes[i]) {\n          continue;\n        }\n        cloneNode(nodes[i], clone);\n      }\n      return clone;\n    }\n    removeChildren(this.element);\n    const element = this.getElement();\n    if (element) {\n      if (element.parentNode && element.parentNode.childNodes) {\n        for (const node of element.parentNode.childNodes) {\n          const clonedNode = cloneNode(node, null);\n          this.element.appendChild(clonedNode);\n        }\n      }\n    }\n    if (element.parentNode) {\n      // set new Observer\n      this.observeTarget_(element.parentNode);\n    }\n  }\n\n  /**\n   * @override\n   */\n  updatePixelPosition() {\n    const position = this.positionWGS84_;\n    if (!this.scene_ || !position) {\n      this.setVisible(false);\n      return;\n    }\n    let height = 0;\n    if (position.length === 2) {\n      const globeHeight = this.scene_.globe.getHeight(Cesium.Cartographic.fromDegrees(position[0], position[1]));\n      if (globeHeight && this.scene_.globe.tilesLoaded) {\n        position[2] = globeHeight;\n      }\n      if (globeHeight) {\n        height = globeHeight;\n      }\n    } else {\n      height = position[2];\n    }\n    const cartesian = Cesium.Cartesian3.fromDegrees(position[0], position[1], height);\n    const camera = this.scene_.camera;\n    const ellipsoidBoundingSphere = new Cesium.BoundingSphere(new Cesium.Cartesian3(), 6356752);\n    const occluder = new Cesium.Occluder(ellipsoidBoundingSphere, camera.position);\n    // check if overlay position is behind the horizon\n    if (!occluder.isPointVisible(cartesian)) {\n      this.setVisible(false);\n      return;\n    }\n    const cullingVolume = camera.frustum.computeCullingVolume(camera.position, camera.direction, camera.up);\n    // check if overlay position is visible from the camera\n    if (cullingVolume.computeVisibility(new Cesium.BoundingSphere(cartesian)) !== 1) {\n      this.setVisible(false);\n      return;\n    }\n    this.setVisible(true);\n\n    const pixelCartesian = this.scene_.cartesianToCanvasCoordinates(cartesian);\n    const pixel = [pixelCartesian.x, pixelCartesian.y];\n    const mapSize = [this.scene_.canvas.width, this.scene_.canvas.height];\n    this.updateRenderedPosition(pixel, mapSize);\n  }\n\n  /**\n   * Destroys the overlay, removing all its listeners and elements\n   * @api\n   */\n  destroy() {\n    if (this.scenePostRenderListenerRemover_) {\n      this.scenePostRenderListenerRemover_();\n    }\n    if (this.observer_) {\n      this.observer_.disconnect();\n    }\n    olObservableUnByKey(this.listenerKeys_);\n    this.listenerKeys_.splice(0);\n    if (this.element.removeNode) {\n      this.element.removeNode(true);\n    } else {\n      this.element.remove();\n    }\n    this.element = null;\n  }\n}\n\nexport default SynchronizedOverlay;\n","/**\n * @module olcs.OverlaySynchronizer\n */\nimport olcsSynchronizedOverlay from './SynchronizedOverlay.js';\nimport {getUid} from './util.js';\n\nclass OverlaySynchronizer {\n  /**\n  * @param {!ol.Map} map\n  * @param {!Cesium.Scene} scene\n  * @constructor\n  * @template T\n  * @api\n  */\n  constructor(map, scene) {\n    /**\n    * @type {!ol.Map}\n    * @protected\n    */\n    this.map = map;\n\n    /**\n    * @type {ol.Collection.<ol.Overlay>}\n    * @private\n    */\n    this.overlays_ = this.map.getOverlays();\n\n    /**\n    * @type {!Cesium.Scene}\n    * @protected\n    */\n    this.scene = scene;\n\n    /**\n    * @private\n    * @type {!Element}\n    */\n    this.overlayContainerStopEvent_ = document.createElement('DIV');\n    this.overlayContainerStopEvent_.className = 'ol-overlaycontainer-stopevent';\n    const overlayEvents = ['click', 'dblclick', 'mousedown', 'touchstart', 'MSPointerDown', 'pointerdown', 'mousewheel', 'wheel'];\n    overlayEvents.forEach((event) => {\n      this.overlayContainerStopEvent_.addEventListener(event, evt => evt.stopPropagation());\n    });\n    this.scene.canvas.parentElement.appendChild(this.overlayContainerStopEvent_);\n\n    /**\n    * @private\n    * @type {!Element}\n    */\n    this.overlayContainer_ = document.createElement('DIV');\n    this.overlayContainer_.className = 'ol-overlaycontainer';\n    this.scene.canvas.parentElement.appendChild(this.overlayContainer_);\n\n\n    /**\n    * @type {!Object<?,olcs.SynchronizedOverlay>}\n    * @private\n    */\n    this.overlayMap_ = {};\n  }\n\n  /**\n  * Get the element that serves as a container for overlays that don't allow\n  * event propagation. Elements added to this container won't let mousedown and\n  * touchstart events through to the map, so clicks and gestures on an overlay\n  * don't trigger any {@link ol.MapBrowserEvent}.\n  * @return {!Element} The map's overlay container that stops events.\n  */\n  getOverlayContainerStopEvent() {\n    return this.overlayContainerStopEvent_;\n  }\n\n  /**\n  * Get the element that serves as a container for overlays.\n  * @return {!Element} The map's overlay container.\n  */\n  getOverlayContainer() {\n    return this.overlayContainer_;\n  }\n\n  /**\n  * Destroy all and perform complete synchronization of the overlays.\n  * @api\n  */\n  synchronize() {\n    this.destroyAll();\n    this.addOverlays();\n    this.overlays_.on('add', this.addOverlayFromEvent_.bind(this));\n    this.overlays_.on('remove', this.removeOverlayFromEvent_.bind(this));\n  }\n\n  /**\n  * @param {ol.Collection.Event} event\n  * @private\n  */\n  addOverlayFromEvent_(event) {\n    const overlay = /** @type {ol.Overlay} */ (event.element);\n    this.addOverlay(overlay);\n  }\n\n  /**\n  * @api\n  */\n  addOverlays() {\n    this.overlays_.forEach((overlay) => { this.addOverlay(overlay); });\n  }\n\n  /**\n  * @param {ol.Overlay} overlay\n  * @api\n  */\n  addOverlay(overlay) {\n    if (!overlay) {\n      return;\n    }\n    const cesiumOverlay = new olcsSynchronizedOverlay({\n      scene: this.scene,\n      synchronizer: this,\n      parent: overlay\n    });\n\n    const overlayId = getUid(overlay).toString();\n    this.overlayMap_[overlayId] = cesiumOverlay;\n  }\n\n  /**\n  * @param {ol.Collection.Event} event\n  * @private\n  */\n  removeOverlayFromEvent_(event) {\n    const removedOverlay = /** @type {ol.Overlay} */ (event.element);\n    this.removeOverlay(removedOverlay);\n  }\n\n  /**\n  * Removes an overlay from the scene\n  * @param {ol.Overlay} overlay\n  * @api\n  */\n  removeOverlay(overlay) {\n    const overlayId = getUid(overlay).toString();\n    const csOverlay = this.overlayMap_[overlayId];\n    if (csOverlay) {\n      csOverlay.destroy();\n      delete this.overlayMap_[overlayId];\n    }\n  }\n\n  /**\n  * Destroys all the created Cesium objects.\n  * @protected\n  */\n  destroyAll() {\n    Object.keys(this.overlayMap_).forEach((key) => {\n      const overlay = this.overlayMap_[key];\n      overlay.destroy();\n      delete this.overlayMap_[key];\n    });\n  }\n}\n\n\nexport default OverlaySynchronizer;\n","/**\n * @module olcs.OLCesium\n */\nimport olGeomPoint from 'ol/geom/Point.js';\nimport {getTransform} from 'ol/proj.js';\nimport olcsUtil from './util.js';\nimport olcsCore from './core.js';\nimport olcsAutoRenderLoop from './AutoRenderLoop.js';\nimport olcsCamera from './Camera.js';\nimport olcsRasterSynchronizer from './RasterSynchronizer.js';\nimport olcsVectorSynchronizer from './VectorSynchronizer.js';\nimport olcsOverlaySynchronizer from './OverlaySynchronizer.js';\n\n\n/**\n * @typedef {Object} OLCesiumOptions\n * @property {import('ol/Map.js').default} map The OpenLayers map we want to show on a Cesium scene.\n * @property {Element|string} [target] Target element for the Cesium scene.\n * @property {function(!import('ol/Map.js').default, !Cesium.Scene, !Cesium.DataSourceCollection): Array<import('olcs/AbstractSynchronizer.js').default>}\n *      [createSynchronizers] Callback function which will be called by the {@link olcs.OLCesium}\n *      constructor to create custom synchronizers. Receives an `ol.Map` and a `Cesium.Scene` as arguments,\n *      and needs to return an array of {@link import('olcs/AbstractSynchronizer.js').default}.\n * @property {function(): Cesium.JulianDate} [time] Control the current time used by Cesium.\n * @property {boolean} [stopOpenLayersEventsPropagation] Prevent propagation of mouse/touch events to\n *      OpenLayers when Cesium is active.\n * @property {Cesium.SceneOptions} [sceneOptions] Allows the passing of property value to the\n *      `Cesium.Scene`.\n */\n\n\nclass OLCesium {\n  /**\n   * @param {!OLCesiumOptions} options Options.\n   * @constructor\n   * @api\n   */\n  constructor(options) {\n\n    /**\n     * @type {olcs.AutoRenderLoop}\n     * @private\n     */\n    this.autoRenderLoop_ = null;\n\n    /**\n     * @type {!ol.Map}\n     * @private\n     */\n    this.map_ = options.map;\n\n    /**\n     * @type {!function(): Cesium.JulianDate}\n     * @private\n     */\n    this.time_ = options.time || function() {\n      return Cesium.JulianDate.now();\n    };\n\n    /**\n     * No change of the view projection.\n     * @private\n     */\n    this.to4326Transform_ = getTransform(this.map_.getView().getProjection(), 'EPSG:4326');\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.resolutionScale_ = 1.0;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.canvasClientWidth_ = 0.0;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.canvasClientHeight_ = 0.0;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.resolutionScaleChanged_ = true; // force resize\n\n    const fillArea = 'position:absolute;top:0;left:0;width:100%;height:100%;';\n\n    /**\n     * @type {!Element}\n     * @private\n     */\n    this.container_ = document.createElement('DIV');\n    const containerAttribute = document.createAttribute('style');\n    containerAttribute.value = `${fillArea}visibility:hidden;`;\n    this.container_.setAttributeNode(containerAttribute);\n\n    let targetElement = options.target || this.map_.getViewport();\n    if (typeof targetElement === 'string') {\n      targetElement = document.getElementById(targetElement);\n    }\n    targetElement.appendChild(this.container_);\n\n    /**\n     * Whether the Cesium container is placed over the ol map.\n     * a target => side by side mode\n     * no target => over map mode\n     * @type {boolean}\n     * @private\n     */\n    this.isOverMap_ = !options.target;\n\n\n    if (this.isOverMap_ && options.stopOpenLayersEventsPropagation) {\n      const overlayEvents = ['click', 'dblclick', 'mousedown', 'touchstart', 'MSPointerDown', 'pointerdown', 'mousewheel', 'wheel'];\n      for (let i = 0, ii = overlayEvents.length; i < ii; ++i) {\n        this.container_.addEventListener(overlayEvents[i], evt => evt.stopPropagation());\n      }\n    }\n\n\n    /**\n     * @type {!HTMLCanvasElement}\n     * @private\n     */\n    this.canvas_ = /** @type {!HTMLCanvasElement} */ (document.createElement('CANVAS'));\n    const canvasAttribute = document.createAttribute('style');\n    canvasAttribute.value = fillArea;\n    this.canvas_.setAttributeNode(canvasAttribute);\n\n    if (olcsUtil.supportsImageRenderingPixelated()) {\n      // non standard CSS4\n      this.canvas_.style['imageRendering'] = olcsUtil.imageRenderingValue();\n    }\n\n    this.canvas_.oncontextmenu = function() { return false; };\n    this.canvas_.onselectstart = function() { return false; };\n\n    this.container_.appendChild(this.canvas_);\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.enabled_ = false;\n\n    /**\n     * @type {!Array.<ol.interaction.Interaction>}\n     * @private\n     */\n    this.pausedInteractions_ = [];\n\n    /**\n     * @type {?ol.layer.Group}\n     * @private\n     */\n    this.hiddenRootGroup_ = null;\n\n    const sceneOptions = options.sceneOptions !== undefined ? options.sceneOptions :\n      /** @type {Cesium.SceneOptions} */ ({});\n    sceneOptions.canvas = this.canvas_;\n    sceneOptions.scene3DOnly = true;\n\n    /**\n     * @type {!Cesium.Scene}\n     * @private\n     */\n    this.scene_ = new Cesium.Scene(sceneOptions);\n\n    const sscc = this.scene_.screenSpaceCameraController;\n\n    sscc.tiltEventTypes.push({\n      'eventType': Cesium.CameraEventType.LEFT_DRAG,\n      'modifier': Cesium.KeyboardEventModifier.SHIFT\n    });\n\n    sscc.tiltEventTypes.push({\n      'eventType': Cesium.CameraEventType.LEFT_DRAG,\n      'modifier': Cesium.KeyboardEventModifier.ALT\n    });\n\n    sscc.enableLook = false;\n\n    this.scene_.camera.constrainedAxis = Cesium.Cartesian3.UNIT_Z;\n\n    /**\n     * @type {!olcs.Camera}\n     * @private\n     */\n    this.camera_ = new olcsCamera(this.scene_, this.map_);\n\n    /**\n     * @type {!Cesium.Globe}\n     * @private\n     */\n    this.globe_ = new Cesium.Globe(Cesium.Ellipsoid.WGS84);\n    this.globe_.baseColor = Cesium.Color.WHITE;\n    this.scene_.globe = this.globe_;\n    this.scene_.skyAtmosphere = new Cesium.SkyAtmosphere();\n\n    // The first layer of Cesium is special; using a 1x1 transparent image to workaround it.\n    // See https://github.com/AnalyticalGraphicsInc/cesium/issues/1323 for details.\n    const firstImageryProvider = new Cesium.SingleTileImageryProvider({\n      url: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=',\n      rectangle: Cesium.Rectangle.fromDegrees(0, 0, 1, 1) // the Rectangle dimensions are arbitrary\n    });\n    this.globe_.imageryLayers.addImageryProvider(firstImageryProvider, 0);\n\n    this.dataSourceCollection_ = new Cesium.DataSourceCollection();\n    this.dataSourceDisplay_ = new Cesium.DataSourceDisplay({\n      scene: this.scene_,\n      dataSourceCollection: this.dataSourceCollection_\n    });\n\n    const synchronizers = options.createSynchronizers ?\n      options.createSynchronizers(this.map_, this.scene_, this.dataSourceCollection_) : [\n        new olcsRasterSynchronizer(this.map_, this.scene_),\n        new olcsVectorSynchronizer(this.map_, this.scene_),\n        new olcsOverlaySynchronizer(this.map_, this.scene_)\n      ];\n\n    // Assures correct canvas size after initialisation\n    this.handleResize_();\n\n    for (let i = synchronizers.length - 1; i >= 0; --i) {\n      synchronizers[i].synchronize();\n    }\n\n    /**\n     * Time of the last rendered frame, as returned by `performance.now()`.\n     * @type {number}\n     * @private\n     */\n    this.lastFrameTime_ = 0;\n\n    /**\n     * The identifier returned by `requestAnimationFrame`.\n     * @type {number|undefined}\n     * @private\n     */\n    this.renderId_ = undefined;\n\n    /**\n     * Target frame rate for the render loop.\n     * @type {number}\n     * @private\n     */\n    this.targetFrameRate_ = Number.POSITIVE_INFINITY;\n\n    /**\n     * If the Cesium render loop is being blocked.\n     * @type {boolean}\n     * @private\n     */\n    this.blockCesiumRendering_ = false;\n\n    /**\n     * If the warmup routine is active.\n     * @type {boolean}\n     * @private\n     */\n    this.warmingUp_ = false;\n\n    /**\n     * @type {ol.Feature}\n     * @private\n     */\n    this.trackedFeature_ = null;\n\n    /**\n     * @type {Cesium.Entity}\n     * @private\n     */\n    this.trackedEntity_ = null;\n\n    /**\n     * @type {Cesium.EntityView}\n     * @private\n     */\n    this.entityView_ = null;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.needTrackedEntityUpdate_ = false;\n\n    /**\n     * @type {!Cesium.BoundingSphere}\n     */\n    this.boundingSphereScratch_ = new Cesium.BoundingSphere();\n\n    const eventHelper = new Cesium.EventHelper();\n    eventHelper.add(this.scene_.postRender, OLCesium.prototype.updateTrackedEntity_, this);\n\n    // Cesium has a mechanism to prevent the camera to go under the terrain.\n    // Unfortunately, it is only active when all the terrain has been loaded, which:\n    // - does not prevent the camera to sink under terrain anymore;\n    // - introduce a jumping effect once all terrain has been loaded and the position of the camera is finally fixed.\n    // The property below enables a workaround found in the Camptocamp Cesium fork.\n    // See also https://github.com/AnalyticalGraphicsInc/cesium/issues/5999.\n    Cesium.Camera.enableSuspendTerrainAdjustment = false;\n  }\n\n  /**\n   * Render the Cesium scene.\n   * @private\n   */\n  render_() {\n    // if a call to `requestAnimationFrame` is pending, cancel it\n    if (this.renderId_ !== undefined) {\n      cancelAnimationFrame(this.renderId_);\n      this.renderId_ = undefined;\n    }\n\n    // only render if Cesium is enabled/warming and rendering hasn't been blocked\n    if ((this.enabled_ || this.warmingUp_) && !this.blockCesiumRendering_) {\n      this.renderId_ = requestAnimationFrame(this.onAnimationFrame_.bind(this));\n    }\n  }\n\n  /**\n   * Callback for `requestAnimationFrame`.\n   * @param {number} frameTime The frame time, from `performance.now()`.\n   * @private\n   */\n  onAnimationFrame_(frameTime) {\n    this.renderId_ = undefined;\n\n    // check if a frame was rendered within the target frame rate\n    const interval = 1000.0 / this.targetFrameRate_;\n    const delta = frameTime - this.lastFrameTime_;\n    if (delta < interval) {\n      // too soon, don't render yet\n      this.render_();\n      return;\n    }\n\n    // time to render a frame, save the time\n    this.lastFrameTime_ = frameTime;\n\n    const julianDate = this.time_();\n    this.scene_.initializeFrame();\n    this.handleResize_();\n    this.dataSourceDisplay_.update(julianDate);\n\n    // Update tracked entity\n    if (this.entityView_) {\n      const trackedEntity = this.trackedEntity_;\n      const trackedState = this.dataSourceDisplay_.getBoundingSphere(trackedEntity, false, this.boundingSphereScratch_);\n      if (trackedState === Cesium.BoundingSphereState.DONE) {\n        this.boundingSphereScratch_.radius = 1; // a radius of 1 is enough for tracking points\n        this.entityView_.update(julianDate, this.boundingSphereScratch_);\n      }\n    }\n\n    this.scene_.render(julianDate);\n    this.camera_.checkCameraChange();\n\n    // request the next render call after this one completes to ensure the browser doesn't get backed up\n    this.render_();\n  }\n\n  /**\n   * @private\n   */\n  updateTrackedEntity_() {\n    if (!this.needTrackedEntityUpdate_) {\n      return;\n    }\n\n    const trackedEntity = this.trackedEntity_;\n    const scene = this.scene_;\n\n    const state = this.dataSourceDisplay_.getBoundingSphere(trackedEntity, false, this.boundingSphereScratch_);\n    if (state === Cesium.BoundingSphereState.PENDING) {\n      return;\n    }\n\n    scene.screenSpaceCameraController.enableTilt = false;\n\n    const bs = state !== Cesium.BoundingSphereState.FAILED ? this.boundingSphereScratch_ : undefined;\n    if (bs) {\n      bs.radius = 1;\n    }\n    this.entityView_ = new Cesium.EntityView(trackedEntity, scene, scene.mapProjection.ellipsoid);\n    this.entityView_.update(this.time_(), bs);\n    this.needTrackedEntityUpdate_ = false;\n  }\n\n  /**\n   * @private\n   */\n  handleResize_() {\n    let width = this.canvas_.clientWidth;\n    let height = this.canvas_.clientHeight;\n\n    if (width === 0 | height === 0) {\n      // The canvas DOM element is not ready yet.\n      return;\n    }\n\n    if (width === this.canvasClientWidth_ &&\n        height === this.canvasClientHeight_ &&\n        !this.resolutionScaleChanged_) {\n      return;\n    }\n\n    let resolutionScale = this.resolutionScale_;\n    if (!olcsUtil.supportsImageRenderingPixelated()) {\n      resolutionScale *= window.devicePixelRatio || 1.0;\n    }\n    this.resolutionScaleChanged_ = false;\n\n    this.canvasClientWidth_ = width;\n    this.canvasClientHeight_ = height;\n\n    width *= resolutionScale;\n    height *= resolutionScale;\n\n    this.canvas_.width = width;\n    this.canvas_.height = height;\n    this.scene_.camera.frustum.aspectRatio = width / height;\n  }\n\n  /**\n   * @return {!olcs.Camera}\n   * @api\n   */\n  getCamera() {\n    return this.camera_;\n  }\n\n  /**\n   * @return {!ol.Map}\n   * @api\n   */\n  getOlMap() {\n    return this.map_;\n  }\n\n  /**\n   * @return {!ol.View}\n   * @api\n   */\n  getOlView() {\n    const view = this.map_.getView();\n    console.assert(view);\n    return view;\n  }\n\n  /**\n   * @return {!Cesium.Scene}\n   * @api\n   */\n  getCesiumScene() {\n    return this.scene_;\n  }\n\n  /**\n   * @return {!Cesium.DataSourceCollection}\n   * @api\n   */\n  getDataSources() {\n    return this.dataSourceCollection_;\n  }\n\n  /**\n   * @return {!Cesium.DataSourceDisplay}\n   * @api\n   */\n  getDataSourceDisplay() {\n    return this.dataSourceDisplay_;\n  }\n\n  /**\n   * @return {boolean}\n   * @api\n   */\n  getEnabled() {\n    return this.enabled_;\n  }\n\n  /**\n   * Enables/disables the Cesium.\n   * This modifies the visibility style of the container element.\n   * @param {boolean} enable\n   * @api\n   */\n  setEnabled(enable) {\n    if (this.enabled_ === enable) {\n      return;\n    }\n    this.enabled_ = enable;\n\n    // some Cesium operations are operating with canvas.clientWidth,\n    // so we can't remove it from DOM or even make display:none;\n    this.container_.style.visibility = this.enabled_ ? 'visible' : 'hidden';\n    let interactions;\n    if (this.enabled_) {\n      this.throwOnUnitializedMap_();\n      if (this.isOverMap_) {\n        interactions = this.map_.getInteractions();\n        interactions.forEach((el, i, arr) => {\n          this.pausedInteractions_.push(el);\n        });\n        interactions.clear();\n\n        this.map_.addInteraction = interaction => this.pausedInteractions_.push(interaction);\n        this.map_.removeInteraction = interaction =>\n          this.pausedInteractions_ = this.pausedInteractions_.filter(i => i !== interaction);\n\n        const rootGroup = this.map_.getLayerGroup();\n        if (rootGroup.getVisible()) {\n          this.hiddenRootGroup_ = rootGroup;\n          this.hiddenRootGroup_.setVisible(false);\n        }\n\n        this.map_.getOverlayContainer().classList.add('olcs-hideoverlay');\n      }\n\n      this.camera_.readFromView();\n      this.render_();\n    } else {\n      if (this.isOverMap_) {\n        interactions = this.map_.getInteractions();\n        this.pausedInteractions_.forEach((interaction) => {\n          interactions.push(interaction);\n        });\n        this.pausedInteractions_.length = 0;\n\n        this.map_.addInteraction = interaction => this.map_.getInteractions().push(interaction);\n        this.map_.removeInteraction = interaction => this.map_.getInteractions().remove(interaction);\n\n        this.map_.getOverlayContainer().classList.remove('olcs-hideoverlay');\n        if (this.hiddenRootGroup_) {\n          this.hiddenRootGroup_.setVisible(true);\n          this.hiddenRootGroup_ = null;\n        }\n      }\n\n      this.camera_.updateView();\n    }\n  }\n\n  /**\n   * Preload Cesium so that it is ready when transitioning from 2D to 3D.\n   * @param {number} height Target height of the camera\n   * @param {number} timeout Milliseconds after which the warming will stop\n   * @api\n  */\n  warmUp(height, timeout) {\n    if (this.enabled_) {\n      // already enabled\n      return;\n    }\n    this.throwOnUnitializedMap_();\n    this.camera_.readFromView();\n    const ellipsoid = this.globe_.ellipsoid;\n    const csCamera = this.scene_.camera;\n    const position = ellipsoid.cartesianToCartographic(csCamera.position);\n    if (position.height < height) {\n      position.height = height;\n      csCamera.position = ellipsoid.cartographicToCartesian(position);\n    }\n\n    this.warmingUp_ = true;\n    this.render_();\n\n    setTimeout(() => {\n      this.warmingUp_ = false;\n    }, timeout);\n  }\n\n  /**\n   * Block Cesium rendering to save resources.\n   * @param {boolean} block True to block.\n   * @api\n  */\n  setBlockCesiumRendering(block) {\n    if (this.blockCesiumRendering_ !== block) {\n      this.blockCesiumRendering_ = block;\n\n      // reset the render loop\n      this.render_();\n    }\n  }\n\n  /**\n   * Render the globe only when necessary in order to save resources.\n   * Experimental.\n   * @api\n   */\n  enableAutoRenderLoop() {\n    if (!this.autoRenderLoop_) {\n      this.autoRenderLoop_ = new olcsAutoRenderLoop(this);\n    }\n  }\n\n  /**\n   * Get the autorender loop.\n   * @return {?olcs.AutoRenderLoop}\n   * @api\n  */\n  getAutoRenderLoop() {\n    return this.autoRenderLoop_;\n  }\n\n  /**\n   * The 3D Cesium globe is rendered in a canvas with two different dimensions:\n   * clientWidth and clientHeight which are the dimension on the screen and\n   * width and height which are the dimensions of the drawing buffer.\n   *\n   * By using a resolution scale lower than 1.0, it is possible to render the\n   * globe in a buffer smaller than the canvas client dimensions and improve\n   * performance, at the cost of quality.\n   *\n   * Pixel ratio should also be taken into account; by default, a device with\n   * pixel ratio of 2.0 will have a buffer surface 4 times bigger than the client\n   * surface.\n   *\n   * @param {number} value\n   * @this {olcs.OLCesium}\n   * @api\n   */\n  setResolutionScale(value) {\n    value = Math.max(0, value);\n    if (value !== this.resolutionScale_) {\n      this.resolutionScale_ = Math.max(0, value);\n      this.resolutionScaleChanged_ = true;\n      if (this.autoRenderLoop_) {\n        this.autoRenderLoop_.restartRenderLoop();\n      }\n    }\n  }\n\n  /**\n   * Set the target frame rate for the renderer. Set to `Number.POSITIVE_INFINITY`\n   * to render as quickly as possible.\n   * @param {number} value The frame rate, in frames per second.\n   * @api\n   */\n  setTargetFrameRate(value) {\n    if (this.targetFrameRate_ !== value) {\n      this.targetFrameRate_ = value;\n\n      // reset the render loop\n      this.render_();\n    }\n  }\n\n  /**\n   * Check if OpenLayers map is not properly initialized.\n   * @private\n   */\n  throwOnUnitializedMap_() {\n    const map = this.map_;\n    const view = map.getView();\n    const center = view.getCenter();\n    if (!view.isDef() || isNaN(center[0]) || isNaN(center[1])) {\n      throw new Error(`The OpenLayers map is not properly initialized: ${center} / ${view.getResolution()}`);\n    }\n  }\n\n  /**\n   * @type {ol.Feature}\n   */\n  get trackedFeature() {\n    return this.trackedFeature_;\n  }\n\n  /**\n   * @param {ol.Feature} feature\n   */\n  set trackedFeature(feature) {\n    if (this.trackedFeature_ !== feature) {\n\n      const scene = this.scene_;\n\n      //Stop tracking\n      if (!feature || !feature.getGeometry()) {\n        this.needTrackedEntityUpdate_ = false;\n        scene.screenSpaceCameraController.enableTilt = true;\n\n        if (this.trackedEntity_) {\n          this.dataSourceDisplay_.defaultDataSource.entities.remove(this.trackedEntity_);\n        }\n        this.trackedEntity_ = null;\n        this.trackedFeature_ = null;\n        this.entityView_ = null;\n        scene.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);\n        return;\n      }\n\n      this.trackedFeature_ = feature;\n\n      //We can't start tracking immediately, so we set a flag and start tracking\n      //when the bounding sphere is ready (most likely next frame).\n      this.needTrackedEntityUpdate_ = true;\n\n      const to4326Transform = this.to4326Transform_;\n      const toCesiumPosition = function() {\n        const geometry = feature.getGeometry();\n        console.assert(geometry instanceof olGeomPoint);\n        const coo = geometry.getCoordinates();\n        const coo4326 = to4326Transform(coo, undefined, coo.length);\n        return olcsCore.ol4326CoordinateToCesiumCartesian(coo4326);\n      };\n\n      // Create an invisible point entity for tracking.\n      // It is independant from the primitive/geometry created by the vector synchronizer.\n      const options = {\n        'position': new Cesium.CallbackProperty((time, result) => toCesiumPosition(), false),\n        'point': {\n          'pixelSize': 1,\n          'color': Cesium.Color.TRANSPARENT\n        }\n      };\n\n      this.trackedEntity_ = this.dataSourceDisplay_.defaultDataSource.entities.add(options);\n    }\n  }\n}\n\nexport default OLCesium;\n","export default \"__VITE_ASSET__c2b3a5f0__\"","<script>\nimport { useSlots, onBeforeMount, onMounted, onBeforeUnmount, ref, reactive, computed, watch, nextTick, defineAsyncComponent, useCssModule, inject, getCurrentInstance } from 'vue'\nimport $ from 'jquery'\n\nimport { Map, View, Feature } from 'ol'\nimport { ImageArcGISRest, OSM } from 'ol/source.js'\nimport TileWMS from 'ol/source/TileWMS'\nimport Overlay from 'ol/Overlay'// 引入覆蓋物模塊\n\nimport { TileArcGISRest } from 'ol/source.js'\n\nimport XYZ from 'ol/source/XYZ'\nimport VectorSource from 'ol/source/Vector.js'\nimport { Icon, Fill, Stroke, Style } from 'ol/style.js'\nimport { Tile, Tile as TileLayer, Image as ImageLayer, Vector, Vector as VectorLayer } from 'ol/layer.js'\nimport ImageWMS from 'ol/source/ImageWMS.js';\nimport TileGrid from 'ol/layer/Tile.js';\n\nimport PerspectiveMap from \"ol-ext/map/PerspectiveMap\"\n\nimport EsriJSON from 'ol/format/EsriJSON.js'\nimport { createXYZ } from 'ol/tilegrid.js'\nimport { tile as tileStrategy } from 'ol/loadingstrategy.js'\nimport { Circle, Polygon, Point } from 'ol/geom.js'\nimport Projection from 'ol/proj/Projection.js'\nimport GeoJSON from 'ol/format/GeoJSON.js'\n\nimport OLCesium from 'olcs/OLCesium.js';\nimport VectorImageLayer from 'ol/layer/VectorImage.js';\nimport TileState from 'ol/TileState.js';\n\nimport 'ol/ol.css'\n\nimport mapLayerList, { initLayers, getTribeData } from '@/config/mapLayerList'\nimport baseMapList from '@/config/baseMapList'\n\nimport 'ol-ext/dist/ol-ext.css'\n\nimport { get as getProjection } from 'ol/proj';\n\nexport default {\n    props: {},\n    setup(props, { emit }) {\n        const mapLayers = mapLayerList\n        const baseMaps = baseMapList\n        const state = reactive({\n            // defaultCenter: [120.971859, 24.801583],\n            defaultCenter: [121.326776, 24.655499],\n            defaultCenterZoom: 14,\n            targetNum: 1,\n            conditionWrap: false,\n            layerSelect: false,\n            currentLayers: [],\n            layers: [],\n            mapLayers: computed(() => {\n                return state.layers.map((node, index) => {\n                    return {\n                        label: node.group_title,\n                        value: node.value,\n                        layers: node.group_layers,\n                        groupClass: node.group_class\n                    }\n                })\n            }),\n            baseMapsOptions: computed(() => baseMapList.sourceData()),\n            selectLock: false,\n            mapCount: 1,\n            map1: null,\n            map2: null,\n            map1LayerStatus: [],\n            map2LayerStatus: [],\n            deleteLightbox: false,\n            // 目前地圖狀態為2D or 3D\n            dimensionMap: {\n                map1: '2D',\n                map2: '2D'\n            },\n            toSearchDimensionStatus: computed(() => {\n                let target = state.targetNum == 1 ? 'map1' : 'map2'\n                return state.dimensionMap[target] === '2D'\n            }),\n            tribeId: '',\n            ol3d: null,\n            selectValueTemp: 0,\n        })\n\n        const defaultView = new View({\n            projection: 'EPSG:4326',\n            center: state.defaultCenter,\n            zoom: state.defaultCenterZoom,\n        })\n\n        const overlay = ref(null)\n        const mapDetailsPopup = ref(null) // 地圖細節小窗\n        let ol3d = null\n\n        // 初始化地圖\n        function initMap() {\n            // overlay.value = new Overlay({\n            //     element: mapDetailsPopup.value,\n            //     autoPan: true,\n            //     autoPanAnimation: {\n            //         duration: 250\n            //     }\n            // })\n            state.map1 = new Map({\n                target: 'map1',\n                layers: [baseMapList.sourceFun('default')],\n                view: defaultView,\n                controls: [],\n                // fix: !!!!有overlays，3D圖層無法使用\n                // overlays: [overlay.value]\n            })\n        }\n\n        function addPoint(targetLng, targetLat) {\n            const marker = new Vector({\n                source: new VectorSource({\n                    features: [\n                        new Feature({\n                            geometry: new Point([targetLng, targetLat]),\n                            name: 'Null Island',\n                            population: 4000,\n                            rainfall: 500,\n                        })\n                    ]\n                }),\n                style: new Style({\n                    image: new Icon({\n                        anchor: [0.5, 100],\n                        anchorXUnits: 'fraction',\n                        anchorYUnits: 'pixels',\n                        // 圖片連結需修改\n                        src: 'https://www.ockert-cnc.de/wp-content/uploads/2016/12/map-marker-icon-100x100.png',\n                    }),\n                })\n            })\n\n            let target = state.targetNum == 1 ? 'map1' : 'map2'\n            state[target].addLayer(marker)\n        }\n\n        function mapControl({ action, value }) {\n            let mainMap = state.map1?.getTarget() == null ? 'map2' : 'map1'\n            let View = state[mainMap].getView()\n            switch (action) {\n                case 'In':\n                    View.animate({\n                        zoom: View.getZoom() + 1,\n                    })\n                    break;\n                case 'Out':\n                    View.animate({\n                        zoom: View.getZoom() - 1,\n                    })\n                    break;\n                case 'toNorth':\n                    View.animate({\n                        rotation: 0,\n                    })\n                    break;\n                case 'moveTo':\n                    if (value) {\n                        const { xAxis, yAxis } = value\n                        View.animate({\n                            center: [xAxis, yAxis],\n                            zoom: 10,\n                            duration: 100,\n                        });\n                    } else {\n                        navigator.geolocation.getCurrentPosition(function (pos) {\n                            View.animate({\n                                center: [pos.coords.longitude, pos.coords.latitude],\n                                zoom: 17,\n                                duration: 100,\n                            });\n                            addPoint(pos.coords.longitude, pos.coords.latitude)\n                        })\n                    }\n                    break;\n                case 'fullScreen':\n                    let target = document.getElementById(`map${state.targetNum}`)\n                    if (target.requestFullscreen) {\n                        target.requestFullscreen()\n                    } else if (target.msRequestFullscreen) {\n                        target.msRequestFullscreen()\n                    } else if (target.mozRequestFullScreen) {\n                        target.mozRequestFullScreen()\n                    } else if (target.webkitRequestFullscreen) {\n                        target.webkitRequestFullscreen()\n                    }\n                    break;\n            }\n        }\n\n        function layerControl({ action, value }) {\n            let target = state.targetNum == 1 ? state.map1 : state.map2\n            let targetLayers = target?.getLayers()\n            switch (action) {\n                case 'layerMode':\n                    if (value.checked) {\n                        if (!(state.layers[value.nodeIndex].group_layers[value.subNodeIndex].single_tiles)) {\n                            let layersAry = targetLayers.getArray()\n                            layersAry.forEach(element => {\n                                if(!(element.get('id'))){return}\n                                if (element.get('id').includes(`node${value.nodeIndex}_subNode${value.subNodeIndex}_nestedSubNode`)) {\n                                    target.removeLayer(element)\n                                }\n                            })\n                            onMapLayerStatus('delete', target.getTarget(), value.id)\n                        }\n\n                        let nestedSubNodeIndex = value.nestedSubNodeIndex || state.selectValueTemp\n                        let targetLayer = mapLayers.getLayer(state.layers[value.nodeIndex].group_layers[value.subNodeIndex], nestedSubNodeIndex, value.id)\n                        target.addLayer(targetLayer)\n\n                        // 部落圖層點擊事件\n                        if (value.id === 'node0_subNode3_nestedSubNodeundefined') {\n                            target.on('click', (evt)=>{\n                                // const data = targetLayer.getData(evt.pixel)\n\n                                // // needfix: 已抓入圖層.需要加入後續事件小視窗及後續另開連結事件\n                                // if (data[0]) {\n\n                                // }\n\n                                // var coordinate = evt.coordinate;\n                                // var pixel = target.getPixelFromCoordinate(coordinate);\n                                // var features = targetLayer.getSource().getFeaturesAtCoordinate(coordinate);\n                                // if (features.length > 0) {\n                                //     var properties = features[0].getProperties();\n                                //     console.log(properties)\n                                //     // 在這裡對要素的屬性進行處理\n                                // }\n                            })\n                        }\n\n                        onMapLayerStatus('add', target.getTarget(), value.id)\n\n                    } else {\n                        let layersAry = targetLayers.getArray()\n                        let toRemoveLayerId\n                        // needfix: 此處寫死 淹水.台灣近岸海域風浪危害圖 兩個圖層，看之後是否可以改成以single_tiles判斷\n                        switch(value.id){\n                            case 'node0_subNode0_nestedSubNodeundefined':\n                                toRemoveLayerId = layersAry.filter(element => element.get('id') === 'node0_subNode0_nestedSubNodeundefined')\n                                toRemoveLayerId.forEach((node) => {\n                                    target.removeLayer(node)\n                                })\n                                break\n                            case 'node3_subNode1_nestedSubNodeundefined':\n                                toRemoveLayerId = layersAry.filter(element => element.get('id') === 'node3_subNode1_nestedSubNodeundefined')\n                                toRemoveLayerId.forEach((node) => {\n                                    target.removeLayer(node)\n                                })\n                                break\n                            default:\n                                layersAry.forEach(element => {\n                                    if (element.get('id') == value.id) {\n                                        target.removeLayer(element)\n                                    }\n                                })\n                                break\n                        }\n                        onMapLayerStatus('delete', target.getTarget(), value.id)\n                    }\n                    break;\n                case 'selectLayerMode':\n                    if (state.selectLock) { return }\n                    if (value.layerName === 'all') {\n                        let layersAry = targetLayers.getArray()\n                        let layersToRemove = layersAry.filter(node=> node.get('name') !== 'default')\n                        layersToRemove.forEach((node) => {\n                            target.removeLayer(node)\n                        })\n                    } else {\n                        let layersAry = targetLayers.getArray()\n                        layersAry.forEach(element => {\n                            if (element.get('id') == value.id) {\n                                target.removeLayer(element)\n                            }\n                        })\n                    }\n                    break;\n                case 'changeOrder':\n                    if (state.selectLock) { return }\n                    let layeredIndex = mapLayerList.getLayerIndex(value.id)\n                    let nowTileLayer = mapLayers.getLayer(state.layers[layeredIndex.nodeIndex].group_layers[layeredIndex.subNodeIndex], layeredIndex.nestedSubNodeIndex, value.id)\n                    if (value.movement === 'up') {\n                        if (value.key +1 == targetLayers.getArray().length) { return }\n                        value.checked = false\n                        layerControl({action: 'layerMode', value: value})\n                        targetLayers.insertAt(value.key + 1, nowTileLayer)\n                    }\n                    if (value.movement === 'down') {\n                        if (value.key - 1 == 0) { return }\n                        value.checked = false\n                        layerControl({action: 'layerMode', value: value})\n                        targetLayers.insertAt(value.key - 1, nowTileLayer)\n                    }\n                    break;\n                case 'changeLayerVisible':\n                    if (state.selectLock) { return }\n                    let visibleStatus = !(targetLayers.getArray()[value.key].getVisible())\n                    targetLayers.getArray()[value.key].setVisible(visibleStatus)\n                    break;\n                case 'baseMap':\n                    let newTileLayer = baseMaps.sourceFun(value.layerName)\n                    targetLayers.extend([newTileLayer])\n\n                    let layersAry = targetLayers.getArray()\n                    layersAry.forEach(element => {\n                        if (element.get('name') !== value.layerName) {\n                            target.removeLayer(element)\n                        }\n                    })\n                    break;\n                case 'changeMapCount':\n                    if (state.mapCount === value) { return }\n                    let otherMap = state.targetNum !== 1 ? 'map1' : 'map2'\n                    state.mapCount = value\n                    let otherLayers = state[`${otherMap}LayerStatus`].filter(node => node !== '3D')\n                    let otherLayersData = otherLayers.map(item=> mapLayerList.getLayerIndex(item))\n                    if (value === 2) {\n                        state[otherMap] = new Map({\n                            target: otherMap,\n                            layers: [\n                                baseMapList.sourceFun('default'),\n                                ...otherLayersData.map(node => mapLayers.getLayer(state.layers[node.nodeIndex].group_layers[node.subNodeIndex], node.nestedSubNodeIndex, node.id))\n                            ],\n                            view: defaultView,\n                            controls: [],\n                        })\n                        if (state[`${otherMap}LayerStatus`]?.indexOf('3D') !== -1) {\n                            ol3d = new OLCesium({\n                                map: state[otherMap],\n                            })\n                            ol3d.setEnabled(true)\n                        }\n                    }\n                    if (value === 1) {\n                        state[otherMap] = null\n                        const element = document.getElementById(otherMap)\n                        while (element.firstChild) {\n                            element.removeChild(element.firstChild)\n                        }\n                    }\n                    break;\n                case 'changeDimensionMap':\n                    let ta = state.targetNum == 1 ? 'map1' : 'map2'\n                    state.dimensionMap[ta] = value\n                    if (value === '3D') {\n                        ol3d = new OLCesium({\n                            map: target,\n                        })\n                        ol3d.setEnabled(true)\n                        state[`${ta}LayerStatus`].push('3D')\n                    } else {\n                        ol3d.setEnabled(false)\n                        state[`${ta}LayerStatus`] = state[`${ta}LayerStatus`].filter(node => node !== '3D')\n                    }\n                    break;\n            }\n            getCurrentLayerNames()\n        }\n\n        function changeTarget(value) {\n            state.targetNum = value\n            let delToMap = state.targetNum !== 1 ? 'map1' : 'map2'\n            if (state.mapCount === 1) {\n                // 目標地圖為空\n                if (!state[`map${value}`]) {\n                    let otherLayers = state[`map${value}LayerStatus`].filter(node => node !== '3D')\n                    let otherLayersData = otherLayers.map(item=> mapLayerList.getLayerIndex(item))\n\n                    state[`map${value}`] = new Map({\n                        target: `map${value}`,\n                        layers: [\n                            baseMapList.sourceFun('default'),\n                            ...otherLayersData.map(node => mapLayers.getLayer(state.layers[node.nodeIndex].group_layers[node.subNodeIndex], node.nestedSubNodeIndex, node.layeredIndex))\n                        ],\n                        view: defaultView,\n                        controls: [],\n                    })\n                    if (state[`map${value}LayerStatus`]?.indexOf('3D') !== -1) {\n                        ol3d = new OLCesium({\n                            map: state[`map${value}`],\n                        })\n                        ol3d.setEnabled(true)\n                    }\n\n                }\n                // 非目標地圖的刪除\n                if (state[delToMap]) {\n                    state[delToMap] = null\n                    const element = document.getElementById(delToMap)\n                    while (element.firstChild) {\n                        element.removeChild(element.firstChild)\n                    }\n                }\n            }\n            nextTick(() => {\n                getCurrentLayerNames()\n            })\n        }\n\n        function getCurrentLayerNames() {\n            let target = state.targetNum == 1 ? state.map1 : state.map2\n            const layers = target?.getLayers()?.getArray()\n            state.currentLayers = layers?.map(layer => {\n                return {\n                    label: layer.get('label'),\n                    id: layer.get('id'),\n                    visible: layer.getVisible(),\n                }\n            })\n        }\n\n        function conditionWrap() {\n            state.conditionWrap = !state.conditionWrap\n        }\n\n        function onMapLayerStatus(action, target, id) {\n            if (action === 'add') {\n                state[`${target}LayerStatus`].push(id)\n            } else if (action === 'delete') {\n                let a = state[`${target}LayerStatus`].findIndex(node => node === id)\n                state[`${target}LayerStatus`].splice(a, 1)\n            } else {\n                console.log('error')\n            }\n        }\n\n        function closeMapData() {\n            // overlay.value.setPosition(undefined)\n            state.tribeId = ''\n        }\n\n        // function switchMapDetail(id) {\n        //     if (feature) {\n        //         const coordinate = evt.coordinate\n        //         state.tribeId = feature.get('name')\n        //         overlay.value.setPosition(coordinate)\n        //     } else {\n        //         overlay.value.setPosition(undefined)\n        //     }\n        // }\n\n        function tileLoadFunction(tile, src) {\n            var client = new XMLHttpRequest();\n            client.open('GET', src);\n            //client.setRequestHeader(\"Authorization\", \"Basic \" + window.btoa(user + \":\" + pass));\n            client.onload = function () {\n                client.setRequestHeader('Content-type','image/png');\n                tile.getImage().src = src;\n            };\n            client.send();\n        }\n\n        function addTest() {\n\n            const SurfaceSource = new TileWMS({\n                maxzoom: 18,\n                minzoom: 3,\n                url: 'https://dwgis1.ncdr.nat.gov.tw/server/services/MAP0627/Map2022FloodingArea1721/MapServer/WMSServer?REQUEST=GetMap&SERVICE=WMS&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:4326&LAYERS=0&VERSION=1.1.1&FORMAT=image/png&STYLES=',\n                params: {},\n                tileLoadFunction: tileLoadFunction,\n            })\n            const wmsLayer = new TileLayer({\n                source: SurfaceSource,\n            })\n            state.map1.addLayer(wmsLayer)\n            // onMapLayerStatus('add', state.map1.getTarget(), value.layerName)\n        }\n\n        onMounted(async () => {\n            await $.ajax({\n                url: 'https://api.edtest.site/layers',\n                method: \"GET\"\n            }).done(res => {\n                state.layers = res.map((node, index) => {\n                    node.group_layers.forEach((sub, subIndex) => {\n                        let subNodeIndex = undefined, nestedSubNodeIndex = undefined\n                        subNodeIndex = subIndex\n                        sub.id = `node${index}_subNode${subNodeIndex}_nestedSubNode${nestedSubNodeIndex}`\n                        if (!(sub.single_tiles)) {\n                            sub.tiles_list.forEach((nestedSub, nestedSubIndex)=>{\n                                nestedSubNodeIndex = nestedSubIndex\n                                nestedSub.id = `node${index}_subNode${subNodeIndex}_nestedSubNode${nestedSubNodeIndex}`\n                            })\n                        }\n                    })\n                    return {\n                        ...node,\n                        value: index,\n                    }\n                })\n                nextTick(()=>{\n                    initMap()\n                    getCurrentLayerNames()\n                })\n            }).fail(FailMethod => {\n                console.log('Fail', FailMethod)\n            })\n        })\n\n        return {\n            state,\n            props,\n            mapDetailsPopup,\n            overlay,\n            mapControl,\n            layerControl,\n            getCurrentLayerNames,\n            changeTarget,\n            conditionWrap,\n        }\n    }\n}\n</script>\n\n<template>\n    <div>\n        <div class=\"btn\" @click=\"state.tribeId = '88'\">88</div>\n        <div class=\"SearchBar position-absolute\">\n            <img src=\"@/assets/logo.svg\" alt=\"\" class=\"mb-2\">\n            <SearchBar :dimensionMapStatus=\"state.toSearchDimensionStatus\" :currentLayers=\"state.currentLayers\"\n                :mapCount=\"state.mapCount\" @onLayerControl=\"({ action, value }) => { layerControl({ action, value }) }\"\n                @onChangeTarget=\"(value) => { changeTarget(value) }\" @conditionWrap=\"(value) => { conditionWrap(value) }\" />\n        </div>\n        <mapSourceOption\n        class=\"mapSourceOption\"\n        :baseMapsOptions=\"state.baseMapsOptions\"\n        @onChangeBaseMaps=\"({ action, value }) => { layerControl({ action, value }) }\" />\n\n        <asideTool\n        class=\"asideTool position-absolute top-50 translate-middle-y\" id=\"asideTool\"\n        @onMapControl=\"({ action, value }) => { mapControl({ action, value }) }\" />\n\n        <div class=\"w-100 d-flex flex-nowrap mapWrap\" id=\"mapWrap\">\n            <!-- needFix 寬度設定是否調整 -->\n            <div id=\"map1\" :class=\"{ 'w-100': state.map1?.getTarget() == 'map1' }\"></div>\n            <div class=\"middleLine\" v-if=\"state.mapCount === 2\"></div>\n            <div id=\"map2\" :class=\"{ 'w-100': state.map2?.getTarget() == 'map2' }\"></div>\n        </div>\n        <div class=\"condition position-absolute\">\n            <div class=\"mb-2\">\n                <button class=\"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5\"\n                    v-if=\"!state.conditionWrap\" @click=\"state.conditionWrap = true\">\n                    圖層選項\n                </button>\n                <div class=\"mb-4\" v-if=\"state.conditionWrap\">\n                    <condition\n                    v-bind=\"{\n                        mapLayers: state.mapLayers,\n                        currentLayers: state.currentLayers,\n                        onClose: () => {\n                            state.conditionWrap = false\n                        },\n                        showSelectLayerValue: (val) => {\n                            state.selectValueTemp = val\n                        }\n                    }\"\n                    @onMapControl=\"({ action, value }) => { mapControl({ action, value }) }\"\n                    @onLayerControl=\"({ action, value }) => { layerControl({ action, value }) }\" />\n                    <!-- need continue -->\n                </div>\n            </div>\n\n            <div>\n                <button class=\"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5\"\n                    v-if=\"!state.layerSelect\" @click=\"state.layerSelect = true\">\n                    已選擇的圖層\n                </button>\n                <div v-if=\"state.layerSelect\">\n                    <layerSelect v-bind=\"{\n                        selectLock: state.selectLock,\n                        currentLayers: state.currentLayers,\n                        onClose: () => {\n                            state.layerSelect = false\n                        },\n                        onChangLayerVisible: (action) => {\n                            layerControl(action)\n                        },\n                        onChangeOrderLayer: ({ action, value }) => {\n                            layerControl({ action, value })\n                        },\n                        onLockLayer: () => {\n                            state.selectLock = !state.selectLock\n                        },\n                        onDeleteLayer: ({ action, value }) => {\n                            if (value.layerName == 'all') {\n                                state.deleteLightbox = true\n                            } else {\n                                layerControl({ action, value })\n                            }\n                        },\n                        onDeleteLayerAll: () => {\n                            state.deleteLightbox = true\n                        }\n                    }\" />\n                </div>\n            </div>\n        </div>\n        <div class=\"lightWrap w-100 h-100 d-flex justify-content-center align-items-center\" v-if=\"state.deleteLightbox\">\n            <div class=\"p-4 rounded bg-white\" style=\"width: 250px;\">\n                <p class=\"text-center fw-bold\">是否要刪除全部圖層</p>\n                <div class=\" d-flex justify-content-around\">\n                    <button class=\"rounded px-3 py-1 bg-steel text-white border-0\" @click=\"() => {\n                        layerControl({\n                            action: 'selectLayerMode',\n                            value: {\n                                layerName: 'all'\n                            }\n                        })\n                        state.deleteLightbox = false\n                    }\">確定</button>\n                    <button class=\"rounded px-3 py-1 bg-secondary bg-gradient text-white border-0\" @click=\"() => {\n                        state.deleteLightbox = false\n                    }\">取消</button>\n                </div>\n            </div>\n        </div>\n\n        <!-- 地圖細節小窗 -->\n        <areaData ref=\"mapDetailsPopup\" class=\"areaData\"\n        v-if=\"state.tribeId\"\n        :closeMapData=\"()=>{\n            state.tribeId = ''\n        }\"\n        :tribeId=\"state.tribeId\"\n        :maxHeight=\"500\" />\n    </div>\n</template>\n\n<style lang=\"sass\">\n@import '@/assets/styles/all.module.scss'\n.mapWrap\n    justify-content: space-between\n    height: 100vh\n\n.mapWrap .ol-viewport\n    height: 100vh\n    width: 100vw\n\n\n.asideTool\n    z-index: 220\n    left: 5px\n.SearchBar\n    position: absolute\n    top: 20px\n    left: 20px\n    z-index: 220\n.condition\n    width: 480px\n    right: 1%\n    bottom: 5%\n\n.mapSourceOption\n    position: fixed\n    top: 20px\n    right: 20px\n    z-index: 220\n\n.middleLine\n    width: 5px\n    background: $blue-steel\n\n\n.areaData\n    width: 450px\n    max-height: 500px\n    background: #fff\n    position: absolute\n    top: 0\n    right: 0\n    box-sizing: border-box\n</style>\n"],"names":["_imports_0$3","_imports_1$2","_sfc_main","props","emit","state","reactive","getTribeData","tribeId","res","FailMethod","result","onMounted","_hoisted_2","_imports_0","_hoisted_6","_hoisted_7","_withScopeId","_createElementVNode","_hoisted_8","_imports_1","_hoisted_10","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_17","_openBlock","_createElementBlock","_hoisted_1","_toDisplayString","$setup","_cache","args","$props","_c","_b","_a","_i","_h","_g","_hoisted_11","_Fragment","_renderList","_u","_t","item","_hoisted_16","_hoisted_18","Feature","BaseObject","geometryOrProperties","geometry","properties","clone","style","unlistenByKey","listen","EventType","createStyleFunction","id","name","obj","styles","assert","Feature$1","CanvasVectorLayerRenderer","CanvasLayerRenderer","vectorLayer","createEmpty","executorGroup","frameState","declutterTree","extent","viewState","center","resolution","projection","rotation","projectionExtent","vectorSource","pixelRatio","viewHints","snapToPixel","ViewHint","context","width","height","multiWorld","worldWidth","getWidth","endWorld","world","transform","compositionContext","createCanvasContext2D","canvasPool","alpha","releaseCanvas","target","layerState","makeScale","makeInverse","canvasTransform","transformToString","canvas","replayGroup","declutterExecutorGroup","clipped","render","layerExtent","fromUserExtent","intersectsExtent","containsExtent","pixel","resolve","size","apply","layer","transforms","HIT_DETECT_RESOLUTION","source","startX","offsetX","createHitDetectionImageData","hitDetect","coordinate","hitTolerance","callback","matches","features","featureCallback","feature","distanceSq","key","getUid","match","executorGroups","event","animating","interacting","updateWhileAnimating","updateWhileInteracting","frameStateExtent","vectorLayerRevision","vectorLayerRenderBuffer","vectorLayerRenderOrder","defaultRenderOrder","buffer","renderedExtent","loadExtents","gutter","wrapCoordinateX","loadExtent","wrapExtentX","equals","CanvasBuilderGroup","getRenderTolerance","declutterBuilderGroup","userTransform","i","ii","squaredTolerance","getSquaredRenderTolerance","ready","styleFunction","dirty","userExtent","toUserExtent","replayGroupInstructions","ExecutorGroup","builderGroup","loading","renderFeature","CanvasVectorLayerRenderer$1","VectorLayer","BaseVectorLayer","options","Vector","RBush","maxEntries","RBush_","value","extents","values","items","l","uid","bbox","isEmpty","data","createOrUpdate","rbush","RBush$1","VectorEventType","all","tile","tileGrid","z","fromUserResolution","tileRange","tileCoord","VectorSourceEvent","Event","type","VectorSource","Source","VOID","xhr","allStrategy","useSpatialIndex","collection","Collection","featureKey","ObjectEventType","valid","newFeatures","geometryFeatures","length","modifyingCollection","evt","CollectionEventType","fast","featureId","removeAndIgnoreReturn","clearEvent","extend","wrapAndSliceX","anExtent","filter","x","y","closestFeature","closestPoint","minSquaredDistance","TRUE","previousMinSquaredDistance","minDistance","sid","loadedExtentsRtree","extentsToLoad","extentToLoad","object","featureChangeKeys","removed","loader","url","VectorSource$1","Circle","SimpleGeometry","radius","layout","circle","flatCoordinates","dx","dy","squaredDistance","delta","circleExtent","intersects","forEachCorner","stride","offset","deflateCoordinate","coordinates","angle","anchor","rotate","deltaX","deltaY","translate","Circle$1","JSONFeature","FeatureFormat","getObject","abstract","JSONFeature$1","_hoisted_3","_withModifiers","_normalizeClass","node","nodeIndex","Cluster","distance","ratio","changed","mapDistance","clustered","createOrUpdateFromCoordinate","neighbors","neighbor","centroid","addCoordinate","scaleCoordinate","searchCenter","getCenter","Point","olSourceCluster","TileArcGISRest","TileImage","tileSize","tileExtent","params","urls","srid","index","modulo","tileCoordHash","modifiedUrl","appendParams","toSize","scaleSize","baseParams","TileArcGISRest$1","GEOMETRY_READERS","readPointGeometry","readLineStringGeometry","readPolygonGeometry","readMultiPointGeometry","readMultiLineStringGeometry","readMultiPolygonGeometry","GEOMETRY_WRITERS","writePointGeometry","writeLineStringGeometry","writePolygonGeometry","writeMultiPointGeometry","writeMultiLineStringGeometry","writeMultiPolygonGeometry","EsriJSON","idField","esriJSONFeature","readGeometry","esriJSONFeatureSet","esriJSONFeatures","crs","getProjection","writeGeometry","objects","esriJSONPolygon","getGeometryLayout","rings","convertRings","geometryReader","transformGeometryWithOptions","flatRing","outerRings","holes","deflateCoordinates","linearRingIsClockwise","hole","matched","outerRing","LinearRing","point","LineString","MultiLineString","MultiPoint","MultiPolygon","Polygon","esriJSON","getHasZM","lineString","hasZM","polygon","multiLineString","multiPoint","output","geometryWriter","EsriJSON$1","mapLayerList","TileLayer","serviceUrl","Style","Fill","Stroke","newVectorSource","tileStrategy","createXYZ","color","circleFeature","circleStyle","x1","y1","ctx","raster","areaLineLayer","nestedSubNodeIndex","layerSource","layerType","figureType","request","api","origin","pathname","searchParams","searchParamsObject","TileWMS","tileTitle","wmsSource","layeredIndex","subNodeIndex","element","onMapControl","action","onLayerControl","LayerCheckBoxChange","e","defaultChecked","checkTribe","newVal","router","mapLayers","_createTextVNode","subNode","$event","_vModelSelect","_imports_0$2","_imports_1$1","_imports_2$1","_imports_3$1","_imports_4$1","_imports_2","_imports_3","_imports_4","onChangeBaseMaps","node_i","_imports_0$1","toolSwitch","_hoisted_15","_hoisted_21","AutoRenderLoop","ol3d","repaintKey","toDegrees","angleInRadians","toRadians","angleInDegrees","Camera","scene","map","input","opt_output","opt_dimension","dim","view","olObservableUnByKey","toLonLat","getTransform","fromLonLat","heading","tilt","position","ll","carto","pos","altitude","destination","orientation","ellipsoid","olcsCore","bestTarget","globe","bestTargetCartographic","targetNormal","targetToCamera","up","right","normal","tiltAngle","opt_dontSync","old","current","latitude","calcDistanceForResolution","calcResolutionForDistance","AbstractSynchronizer","root","fifo","olLayerWithParents","olLayer","olLayerId","cesiumObjects","olLayerGroup","newOlLayerWithParents","layerId","layerWithParents","onLayerChange","cesiumObjs","olcsListen","cesiumObject","counterparts","counterpart","group","done","uuid","listenKeyArray","contentKeys","listenAddRemove","el","objKey","destroy","RasterSynchronizer","olcsAbstractSynchronizer","viewProj","olLayerItem","previousStyleFunction","currentStyleFunction","csObj","layers","zIndices","queue","sublayers","stableSort","layer1","layer2","VectorLayerCounterpart","layerProjection","billboards","primitives","FeatureConverter","olSourceVector","cancellers","olcsUtil","canceller","primitive","olGeometry","opt_lineWidth","createInstance","instance","instances","heightReference","ctor","dataUri","outline","fillColor","strokeColor","olColor","fillGeometry","outlineGeometry","olStyle","outlineColor","p1","p2","text","label","bbOptions","bb","outlinePrimitive","circlePolygon","olCreateCircularPolygon","positions","isGroundPolylinePrimitiveSupported","geometryInstances","previousDistance","geometryOptions","linePositions","appearance","primitiveOptions","boundingExtent","rectangle","maxHeight","c","hierarchy","polygonHierarchy","olPos","polylineGeometry","altitudeMode","imageStyle","opt_newBillboardCallback","olStyleIcon","image","isImageLoaded","reallyCreateBillboard","opacity","scale","cancelled","fuid","listener","modelPrimitive","olcsModelFunction","olcsModel","model","accumulate","geometries","functor","subgeos","labels","extentCenter","olGeomSimpleGeometry","first","offsetY","labelStyle","horizontalOrigin","verticalOrigin","fill","stroke","fallbackStyleFunction","featureStyleFunction","opt_geom","geom3d","olGeomGeometry","geomFuncRes","geom","proj","newBillboardAddedCallback","featureBb","prims","bbs","result2","olView","featurePrimitiveMap","olcsCoreVectorLayerCounterpart","layerStyle","prim","VectorSynchronizer","opt_converter","olcsFeatureConverter","csPrimitive","visible","layerVisible","olLayerVector","olLayerVectorTile","olLayerLayer","csPrimitives","olListenKeys","onAddFeature","olLayerImage","onRemoveFeature","SynchronizedOverlay","olOverlay","parent","setPropertyFromEvent","observer","removeNode","container","sourceProjection","cloneNode","nodes","removeChildren","clonedNode","globeHeight","cartesian","camera","ellipsoidBoundingSphere","pixelCartesian","mapSize","OverlaySynchronizer","overlay","cesiumOverlay","olcsSynchronizedOverlay","overlayId","removedOverlay","csOverlay","OLCesium","fillArea","containerAttribute","targetElement","overlayEvents","canvasAttribute","sceneOptions","sscc","olcsCamera","firstImageryProvider","synchronizers","olcsRasterSynchronizer","olcsVectorSynchronizer","olcsOverlaySynchronizer","frameTime","interval","julianDate","trackedEntity","bs","resolutionScale","enable","interactions","arr","interaction","rootGroup","timeout","csCamera","block","olcsAutoRenderLoop","to4326Transform","toCesiumPosition","olGeomPoint","coo","coo4326","time","computed","ref","mapDetailsPopup","initMap","Map","baseMapList","defaultView","addPoint","targetLng","targetLat","Icon","mapControl","View","mainMap","xAxis","yAxis","layerControl","targetLayers","layersAry","toRemoveLayerId","nowTileLayer","visibleStatus","newTileLayer","otherMap","otherLayersData","ta","getCurrentLayerNames","delToMap","onMapLayerStatus","a","sub","subIndex","nestedSubIndex","nestedSub","_hoisted_5","_hoisted_4","_createVNode","_component_condition","_mergeProps","_hoisted_9"],"mappings":"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","x_google_ignoreList":[3,4,5,6,7,8,9,10,11,13,14,15,31,32,33,34,35,36,37,38,39,40,41]}