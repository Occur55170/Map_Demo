import{V as me,a as rt,E as Ue,g as Ke,c as Nt,b as Bt,d as Gt,s as Wt,e as at,P as We,F as lt,f as jt,M as xe,T as je,O as Ht,h as ct,X as dt,m as Te,C as $t,i as zt,j as qe,k as Ut,u as X,l as Ve,n as O,o as Kt,p as qt,q as R,r as Ne,t as re,v as Yt,w as ie,x as Zt,y as De,z as Qt,I as Me,S as Xt,A as Ye,B as Be,D as Jt,G as es,H as ts,J as ut,K as ss,L as is,N as ns,Q as Ze,R as os,U as rs}from"./core-f7ad9921.js";import{_ as H,r as Q,e as Re,o as _,c as C,a as c,n as ke,p as ge,d as fe,f as ne,g as ht,h as V,t as k,i as pe,F as q,j as Y,k as M,u as mt,$ as J,l as j,w as E,m as pt,q as as,b as ls,s as gt,v as ft,x as Qe,y as be,z as cs,A as ds,B as Xe}from"./index-7b5854fe.js";class us extends me{constructor(e){super({attributions:e.attributions,wrapX:e.wrapX}),this.resolution=void 0,this.distance=e.distance!==void 0?e.distance:20,this.minDistance=e.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=e.geometryFunction||function(s){const t=s.getGeometry();return rt(t.getType()=="Point",10),t},this.createCustomCluster_=e.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(e.source||null)}clear(e){this.features.length=0,super.clear(e)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(e,s,t){this.source.loadFeatures(e,s,t),s!==this.resolution&&(this.resolution=s,this.refresh())}setDistance(e){this.updateDistance(e,this.minDistance)}setMinDistance(e){this.updateDistance(this.distance,e)}getMinDistance(){return this.minDistance}setSource(e){this.source&&this.source.removeEventListener(Ue.CHANGE,this.boundRefresh_),this.source=e,e&&e.addEventListener(Ue.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(e,s){const t=e===0?0:Math.min(s,e)/e,i=e!==this.distance||this.interpolationRatio!==t;this.distance=e,this.minDistance=s,this.interpolationRatio=t,i&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;const e=jt(),s=this.distance*this.resolution,t=this.source.getFeatures(),i={};for(let r=0,o=t.length;r<o;r++){const a=t[r];if(!(Ke(a)in i)){const l=this.geometryFunction(a);if(l){const u=l.getCoordinates();Nt(u,e),Bt(e,s,e);const d=this.source.getFeaturesInExtent(e).filter(function(m){const h=Ke(m);return h in i?!1:(i[h]=!0,!0)});this.features.push(this.createCluster(d,e))}}}}createCluster(e,s){const t=[0,0];for(let a=e.length-1;a>=0;--a){const l=this.geometryFunction(e[a]);l?Gt(t,l.getCoordinates()):e.splice(a,1)}Wt(t,1/e.length);const i=at(s),r=this.interpolationRatio,o=new We([t[0]*(1-r)+i[0]*r,t[1]*(1-r)+i[1]*r]);return this.createCustomCluster_?this.createCustomCluster_(o,e):new lt({geometry:o,features:e})}}const yt=us;function hs(n,e){if(n.match(/^[a-z]+:\/\//i))return n;if(n.match(/^\/\//))return window.location.protocol+n;if(n.match(/^[a-z]+:/i))return n;const s=document.implementation.createHTMLDocument(),t=s.createElement("base"),i=s.createElement("a");return s.head.appendChild(t),s.body.appendChild(i),e&&(t.href=e),i.href=n,i.href}const ms=(()=>{let n=0;const e=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(n+=1,`u${e()}${n}`)})();function Z(n){const e=[];for(let s=0,t=n.length;s<t;s++)e.push(n[s]);return e}function Ee(n,e){const t=(n.ownerDocument.defaultView||window).getComputedStyle(n).getPropertyValue(e);return t?parseFloat(t.replace("px","")):0}function ps(n){const e=Ee(n,"border-left-width"),s=Ee(n,"border-right-width");return n.clientWidth+e+s}function gs(n){const e=Ee(n,"border-top-width"),s=Ee(n,"border-bottom-width");return n.clientHeight+e+s}function _t(n,e={}){const s=e.width||ps(n),t=e.height||gs(n);return{width:s,height:t}}function fs(){let n,e;try{e=process}catch{}const s=e&&e.env?e.env.devicePixelRatio:null;return s&&(n=parseInt(s,10),Number.isNaN(n)&&(n=1)),n||window.devicePixelRatio||1}const B=16384;function ys(n){(n.width>B||n.height>B)&&(n.width>B&&n.height>B?n.width>n.height?(n.height*=B/n.width,n.width=B):(n.width*=B/n.height,n.height=B):n.width>B?(n.height*=B/n.width,n.width=B):(n.width*=B/n.height,n.height=B))}function Ie(n){return new Promise((e,s)=>{const t=new Image;t.decode=()=>e(t),t.onload=()=>e(t),t.onerror=s,t.crossOrigin="anonymous",t.decoding="async",t.src=n})}async function _s(n){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(n)).then(encodeURIComponent).then(e=>`data:image/svg+xml;charset=utf-8,${e}`)}async function Cs(n,e,s){const t="http://www.w3.org/2000/svg",i=document.createElementNS(t,"svg"),r=document.createElementNS(t,"foreignObject");return i.setAttribute("width",`${e}`),i.setAttribute("height",`${s}`),i.setAttribute("viewBox",`0 0 ${e} ${s}`),r.setAttribute("width","100%"),r.setAttribute("height","100%"),r.setAttribute("x","0"),r.setAttribute("y","0"),r.setAttribute("externalResourcesRequired","true"),i.appendChild(r),r.appendChild(n),_s(i)}const N=(n,e)=>{if(n instanceof e)return!0;const s=Object.getPrototypeOf(n);return s===null?!1:s.constructor.name===e.name||N(s,e)};function vs(n){const e=n.getPropertyValue("content");return`${n.cssText} content: '${e.replace(/'|"/g,"")}';`}function bs(n){return Z(n).map(e=>{const s=n.getPropertyValue(e),t=n.getPropertyPriority(e);return`${e}: ${s}${t?" !important":""};`}).join(" ")}function ws(n,e,s){const t=`.${n}:${e}`,i=s.cssText?vs(s):bs(s);return document.createTextNode(`${t}{${i}}`)}function Je(n,e,s){const t=window.getComputedStyle(n,s),i=t.getPropertyValue("content");if(i===""||i==="none")return;const r=ms();try{e.className=`${e.className} ${r}`}catch{return}const o=document.createElement("style");o.appendChild(ws(r,s,t)),e.appendChild(o)}function Ls(n,e){Je(n,e,":before"),Je(n,e,":after")}const et="application/font-woff",tt="image/jpeg",Ss={woff:et,woff2:et,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:tt,jpeg:tt,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function xs(n){const e=/\.([^./]*?)$/g.exec(n);return e?e[1]:""}function He(n){const e=xs(n).toLowerCase();return Ss[e]||""}function Ts(n){return n.split(/,/)[1]}function Ge(n){return n.search(/^(data:)/)!==-1}function Ct(n,e){return`data:${e};base64,${n}`}async function vt(n,e,s){const t=await fetch(n,e);if(t.status===404)throw new Error(`Resource "${t.url}" not found`);const i=await t.blob();return new Promise((r,o)=>{const a=new FileReader;a.onerror=o,a.onloadend=()=>{try{r(s({res:t,result:a.result}))}catch(l){o(l)}},a.readAsDataURL(i)})}const Ae={};function Ms(n,e,s){let t=n.replace(/\?.*/,"");return s&&(t=n),/ttf|otf|eot|woff2?/i.test(t)&&(t=t.replace(/.*\//,"")),e?`[${e}]${t}`:t}async function $e(n,e,s){const t=Ms(n,e,s.includeQueryParams);if(Ae[t]!=null)return Ae[t];s.cacheBust&&(n+=(/\?/.test(n)?"&":"?")+new Date().getTime());let i;try{const r=await vt(n,s.fetchRequestInit,({res:o,result:a})=>(e||(e=o.headers.get("Content-Type")||""),Ts(a)));i=Ct(r,e)}catch(r){i=s.imagePlaceholder||"";let o=`Failed to fetch resource: ${n}`;r&&(o=typeof r=="string"?r:r.message),o&&console.warn(o)}return Ae[t]=i,i}async function ks(n){const e=n.toDataURL();return e==="data:,"?n.cloneNode(!1):Ie(e)}async function Es(n,e){if(n.currentSrc){const r=document.createElement("canvas"),o=r.getContext("2d");r.width=n.clientWidth,r.height=n.clientHeight,o==null||o.drawImage(n,0,0,r.width,r.height);const a=r.toDataURL();return Ie(a)}const s=n.poster,t=He(s),i=await $e(s,t,e);return Ie(i)}async function Is(n){var e;try{if(!((e=n==null?void 0:n.contentDocument)===null||e===void 0)&&e.body)return await Pe(n.contentDocument.body,{},!0)}catch{}return n.cloneNode(!1)}async function Rs(n,e){return N(n,HTMLCanvasElement)?ks(n):N(n,HTMLVideoElement)?Es(n,e):N(n,HTMLIFrameElement)?Is(n):n.cloneNode(!1)}const Ps=n=>n.tagName!=null&&n.tagName.toUpperCase()==="SLOT";async function Os(n,e,s){var t,i;let r=[];return Ps(n)&&n.assignedNodes?r=Z(n.assignedNodes()):N(n,HTMLIFrameElement)&&(!((t=n.contentDocument)===null||t===void 0)&&t.body)?r=Z(n.contentDocument.body.childNodes):r=Z(((i=n.shadowRoot)!==null&&i!==void 0?i:n).childNodes),r.length===0||N(n,HTMLVideoElement)||await r.reduce((o,a)=>o.then(()=>Pe(a,s)).then(l=>{l&&e.appendChild(l)}),Promise.resolve()),e}function Ds(n,e){const s=e.style;if(!s)return;const t=window.getComputedStyle(n);t.cssText?(s.cssText=t.cssText,s.transformOrigin=t.transformOrigin):Z(t).forEach(i=>{let r=t.getPropertyValue(i);i==="font-size"&&r.endsWith("px")&&(r=`${Math.floor(parseFloat(r.substring(0,r.length-2)))-.1}px`),N(n,HTMLIFrameElement)&&i==="display"&&r==="inline"&&(r="block"),i==="d"&&e.getAttribute("d")&&(r=`path(${e.getAttribute("d")})`),s.setProperty(i,r,t.getPropertyPriority(i))})}function As(n,e){N(n,HTMLTextAreaElement)&&(e.innerHTML=n.value),N(n,HTMLInputElement)&&e.setAttribute("value",n.value)}function Fs(n,e){if(N(n,HTMLSelectElement)){const s=e,t=Array.from(s.children).find(i=>n.value===i.getAttribute("value"));t&&t.setAttribute("selected","")}}function Vs(n,e){return N(e,Element)&&(Ds(n,e),Ls(n,e),As(n,e),Fs(n,e)),e}async function Ns(n,e){const s=n.querySelectorAll?n.querySelectorAll("use"):[];if(s.length===0)return n;const t={};for(let r=0;r<s.length;r++){const a=s[r].getAttribute("xlink:href");if(a){const l=n.querySelector(a),u=document.querySelector(a);!l&&u&&!t[a]&&(t[a]=await Pe(u,e,!0))}}const i=Object.values(t);if(i.length){const r="http://www.w3.org/1999/xhtml",o=document.createElementNS(r,"svg");o.setAttribute("xmlns",r),o.style.position="absolute",o.style.width="0",o.style.height="0",o.style.overflow="hidden",o.style.display="none";const a=document.createElementNS(r,"defs");o.appendChild(a);for(let l=0;l<i.length;l++)a.appendChild(i[l]);n.appendChild(o)}return n}async function Pe(n,e,s){return!s&&e.filter&&!e.filter(n)?null:Promise.resolve(n).then(t=>Rs(t,e)).then(t=>Os(n,t,e)).then(t=>Vs(n,t)).then(t=>Ns(t,e))}const bt=/url\((['"]?)([^'"]+?)\1\)/g,Bs=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,Gs=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function Ws(n){const e=n.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${e})(['"]?\\))`,"g")}function js(n){const e=[];return n.replace(bt,(s,t,i)=>(e.push(i),s)),e.filter(s=>!Ge(s))}async function Hs(n,e,s,t,i){try{const r=s?hs(e,s):e,o=He(e);let a;if(i){const l=await i(r);a=Ct(l,o)}else a=await $e(r,o,t);return n.replace(Ws(e),`$1${a}$3`)}catch{}return n}function $s(n,{preferredFontFormat:e}){return e?n.replace(Gs,s=>{for(;;){const[t,,i]=Bs.exec(s)||[];if(!i)return"";if(i===e)return`src: ${t};`}}):n}function wt(n){return n.search(bt)!==-1}async function Lt(n,e,s){if(!wt(n))return n;const t=$s(n,s);return js(t).reduce((r,o)=>r.then(a=>Hs(a,o,e,s)),Promise.resolve(t))}async function we(n,e,s){var t;const i=(t=e.style)===null||t===void 0?void 0:t.getPropertyValue(n);if(i){const r=await Lt(i,null,s);return e.style.setProperty(n,r,e.style.getPropertyPriority(n)),!0}return!1}async function zs(n,e){await we("background",n,e)||await we("background-image",n,e),await we("mask",n,e)||await we("mask-image",n,e)}async function Us(n,e){const s=N(n,HTMLImageElement);if(!(s&&!Ge(n.src))&&!(N(n,SVGImageElement)&&!Ge(n.href.baseVal)))return;const t=s?n.src:n.href.baseVal,i=await $e(t,He(t),e);await new Promise((r,o)=>{n.onload=r,n.onerror=o;const a=n;a.decode&&(a.decode=r),a.loading==="lazy"&&(a.loading="eager"),s?(n.srcset="",n.src=i):n.href.baseVal=i})}async function Ks(n,e){const t=Z(n.childNodes).map(i=>St(i,e));await Promise.all(t).then(()=>n)}async function St(n,e){N(n,Element)&&(await zs(n,e),await Us(n,e),await Ks(n,e))}function qs(n,e){const{style:s}=n;e.backgroundColor&&(s.backgroundColor=e.backgroundColor),e.width&&(s.width=`${e.width}px`),e.height&&(s.height=`${e.height}px`);const t=e.style;return t!=null&&Object.keys(t).forEach(i=>{s[i]=t[i]}),n}const st={};async function it(n){let e=st[n];if(e!=null)return e;const t=await(await fetch(n)).text();return e={url:n,cssText:t},st[n]=e,e}async function nt(n,e){let s=n.cssText;const t=/url\(["']?([^"')]+)["']?\)/g,r=(s.match(/url\([^)]+\)/g)||[]).map(async o=>{let a=o.replace(t,"$1");return a.startsWith("https://")||(a=new URL(a,n.url).href),vt(a,e.fetchRequestInit,({result:l})=>(s=s.replace(o,`url(${l})`),[o,l]))});return Promise.all(r).then(()=>s)}function ot(n){if(n==null)return[];const e=[],s=/(\/\*[\s\S]*?\*\/)/gi;let t=n.replace(s,"");const i=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const l=i.exec(t);if(l===null)break;e.push(l[0])}t=t.replace(i,"");const r=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,o="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",a=new RegExp(o,"gi");for(;;){let l=r.exec(t);if(l===null){if(l=a.exec(t),l===null)break;r.lastIndex=a.lastIndex}else a.lastIndex=r.lastIndex;e.push(l[0])}return e}async function Ys(n,e){const s=[],t=[];return n.forEach(i=>{if("cssRules"in i)try{Z(i.cssRules||[]).forEach((r,o)=>{if(r.type===CSSRule.IMPORT_RULE){let a=o+1;const l=r.href,u=it(l).then(d=>nt(d,e)).then(d=>ot(d).forEach(m=>{try{i.insertRule(m,m.startsWith("@import")?a+=1:i.cssRules.length)}catch(h){console.error("Error inserting rule from remote css",{rule:m,error:h})}})).catch(d=>{console.error("Error loading remote css",d.toString())});t.push(u)}})}catch(r){const o=n.find(a=>a.href==null)||document.styleSheets[0];i.href!=null&&t.push(it(i.href).then(a=>nt(a,e)).then(a=>ot(a).forEach(l=>{o.insertRule(l,i.cssRules.length)})).catch(a=>{console.error("Error loading remote stylesheet",a)})),console.error("Error inlining remote css file",r)}}),Promise.all(t).then(()=>(n.forEach(i=>{if("cssRules"in i)try{Z(i.cssRules||[]).forEach(r=>{s.push(r)})}catch(r){console.error(`Error while reading CSS rules from ${i.href}`,r)}}),s))}function Zs(n){return n.filter(e=>e.type===CSSRule.FONT_FACE_RULE).filter(e=>wt(e.style.getPropertyValue("src")))}async function Qs(n,e){if(n.ownerDocument==null)throw new Error("Provided element is not within a Document");const s=Z(n.ownerDocument.styleSheets),t=await Ys(s,e);return Zs(t)}async function Xs(n,e){const s=await Qs(n,e);return(await Promise.all(s.map(i=>{const r=i.parentStyleSheet?i.parentStyleSheet.href:null;return Lt(i.cssText,r,e)}))).join(`
`)}async function Js(n,e){const s=e.fontEmbedCSS!=null?e.fontEmbedCSS:e.skipFonts?null:await Xs(n,e);if(s){const t=document.createElement("style"),i=document.createTextNode(s);t.appendChild(i),n.firstChild?n.insertBefore(t,n.firstChild):n.appendChild(t)}}async function ei(n,e={}){const{width:s,height:t}=_t(n,e),i=await Pe(n,e,!0);return await Js(i,e),await St(i,e),qs(i,e),await Cs(i,s,t)}async function ti(n,e={}){const{width:s,height:t}=_t(n,e),i=await ei(n,e),r=await Ie(i),o=document.createElement("canvas"),a=o.getContext("2d"),l=e.pixelRatio||fs(),u=e.canvasWidth||s,d=e.canvasHeight||t;return o.width=u*l,o.height=d*l,e.skipAutoScale||ys(o),o.style.width=`${u}`,o.style.height=`${d}`,e.backgroundColor&&(a.fillStyle=e.backgroundColor,a.fillRect(0,0,o.width,o.height)),a.drawImage(r,0,0,o.width,o.height),o}async function si(n,e={}){return(await ti(n,e)).toDataURL()}const ii="/Map_Demo/assets/currentPosition-33b00a21.svg";const ni={props:{coordinate:{type:Object,default:{}}},setup(n,{emit:e}){let s;const t=Q({imgSrc:"dddd"});return Re(async()=>{s=new xe({target:"imgMap",layers:[new je({preload:1/0,crossOrigin:"Anonymous",source:new Ht})],view:new ct({projection:"EPSG:4326",center:n.coordinate,zoom:14})}),s.once("loadend",function(){si(s.getTargetElement()).then(function(i){document.getElementById("imgMap")!==null&&(document.getElementById("imgMap").remove(),t.imgSrc=i)})})}),{props:n,state:t}}},oi=n=>(ge("data-v-6ba1c373"),n=n(),fe(),n),ri={class:"position-relative",style:{overflow:"hidden"}},ai=oi(()=>c("div",{id:"imgMap",class:"position-absolute",style:{width:"600px",height:"600px"}},null,-1));function li(n,e,s,t,i,r){return _(),C("div",ri,[ai,c("div",{style:ke([{background:`url('${t.state.imgSrc}')`,"background-size":"cover"},{width:"100%",height:"200px"}])},null,4)])}const ci=H(ni,[["render",li],["__scopeId","data-v-6ba1c373"]]),di="/Map_Demo/assets/vector-a2cf21ef.svg";const ui={props:{popup:{type:Object,default:{}},closeMapData:{Type:Function,default:()=>{}},maxHeight:{Type:Number,default:0},coordinate:{type:Object,default:{}}},setup(n,{emit:e}){const s=mt(),t=Q({type:0,media:"photo",scrollY:!1,tribeData:{data:{}},currentWindowWidth:ne(()=>(console.log(document),1))});async function i(o){return await J.ajax({url:`https://api.edtest.site/tribe?tribeCode=${o}`,method:"GET"}).done(l=>l).fail(l=>(console.log("Fail",l),!1))}async function r(o){return await J.ajax({url:`https://api.edtest.site/historicalDiseaster?id=${o}`,method:"GET"}).done(l=>l).fail(l=>(console.log("Fail",l),!1))}return ht(n.popup,async o=>{if(o.popupData=="新竹縣原住民部落範圍"){i(o.popupId).then(a=>{t.type=1,t.tribeData=a});return}if(n.popup.popupData=="近年歷史災害82處部落點位"){r(`近年歷史災害82處部落點位.${n.popup.popupId}`).then(a=>{t.type=2,t.tribeData=a.data});return}}),Re(async()=>{if(n.popup.popupData=="新竹縣原住民部落範圍"){i(n.popup.popupId).then(o=>{t.type=1,t.tribeData=o});return}if(n.popup.popupData=="近年歷史災害82處部落點位"){r(`近年歷史災害82處部落點位.${n.popup.popupId}`).then(o=>{t.type=2,t.tribeData=o.data});return}}),{router:s,props:n,state:t}}},$=n=>(ge("data-v-0943fc50"),n=n(),fe(),n),hi={key:0},mi=$(()=>c("div",{class:"row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold"},[c("p",null,"詳細資訊")],-1)),pi={class:"row mx-0 align-items-center p-2 position-relative"},gi={class:"d-flex flex-nowrap align-items-center justify-content-between my-2"},fi={class:""},yi={href:"#"},_i=$(()=>c("img",{src:di,alt:""},null,-1)),Ci={class:"border-bottom row flex-nowrap p-2 my-3 cursor-pointer mx-0"},vi={key:0,class:"py-2 px-4"},bi={class:"d-flex flex-wrap justify-content-between"},wi={class:"w-50 mb-4"},Li={class:"mb-0"},Si=["src"],xi={key:1,class:"py-2 px-4"},Ti=$(()=>c("div",null,"尚無影片",-1)),Mi=[Ti],ki={key:1},Ei={class:"row mx-0 align-items-center px-2 py-4 position-relative"},Ii={key:0,class:"row mx-0 mb-2"},Ri=$(()=>c("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"事件:",-1)),Pi={class:"col-8 py-1 px-2 bg-grey-light text-start"},Oi={key:1,class:"row mx-0 mb-2"},Di=$(()=>c("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"發生時間:",-1)),Ai={class:"col-8 py-1 px-2 bg-grey-light text-start"},Fi={key:2,class:"row mx-0 mb-2"},Vi=$(()=>c("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"鄉鎮: ",-1)),Ni={class:"col-8 py-1 px-2 bg-grey-light text-start"},Bi={key:3,class:"row mx-0 mb-2"},Gi=$(()=>c("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"地方: ",-1)),Wi={class:"col-8 py-1 px-2 bg-grey-light text-start"},ji={key:4,class:"row mx-0 mb-2"},Hi=$(()=>c("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"村落: ",-1)),$i={class:"col-8 py-1 px-2 bg-grey-light text-start"},zi={key:5,class:"row mx-0 mb-2"},Ui=$(()=>c("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"災害種類: ",-1)),Ki={class:"col-8 py-1 px-2 bg-grey-light text-start"},qi={key:6,class:"row mx-0 mb-2"},Yi=$(()=>c("div",{class:"col-4 p-1 bg-red-light text-white d-flex justify-content-center align-items-center"},"描述: ",-1)),Zi={class:"col-8 py-1 px-2 bg-grey-light text-start"};function Qi(n,e,s,t,i,r){var a,l,u,d,m,h,f,y,S,g,L,D,v,p,b,w,I,T,P,z,U;const o=ci;return _(),C("div",{class:"bg-white rounded py-2",style:ke([{"overflow-y":"auto"},{"max-height":t.props.maxHeight+"px",width:"480px"}])},[t.state.type===1?(_(),C("div",hi,[mi,V(o,{coordinate:t.props.popup.coordinate,type:t.state.type},null,8,["coordinate","type"]),c("div",pi,[c("div",gi,[c("span",fi,k((u=(l=(a=t.state)==null?void 0:a.tribeData)==null?void 0:l.basicInformation)==null?void 0:u.tribeName),1),c("div",{class:"p-2 bg-steel w-auto text-white d-inline-block rounded-2 cursor-pointer",onClick:e[0]||(e[0]=()=>{t.router.push({name:"detail",params:{id:t.props.popup.popupId}})})},"更多資訊")]),c("p",null,"描述: "+k((h=(m=(d=t.state)==null?void 0:d.tribeData)==null?void 0:m.basicInformation)==null?void 0:h.description),1),c("p",null,k((S=(y=(f=t.state)==null?void 0:f.tribeData)==null?void 0:y.basicInformation)==null?void 0:S.area),1),c("a",yi,[_i,pe(" "+k((p=(v=(D=(L=(g=t.state)==null?void 0:g.tribeData)==null?void 0:L.basicInformation)==null?void 0:D.coordinates)==null?void 0:v.WGS84)==null?void 0:p.lat)+" , "+k((P=(T=(I=(w=(b=t.state)==null?void 0:b.tribeData)==null?void 0:w.basicInformation)==null?void 0:I.coordinates)==null?void 0:T.WGS84)==null?void 0:P.lng),1)])]),c("div",null,[c("div",Ci,[c("div",{class:"col-6 cursor-pointer",onClick:e[1]||(e[1]=G=>t.state.media="photo")},"相片"),c("div",{class:"col-6 cursor-pointer",onClick:e[2]||(e[2]=G=>t.state.media="video")},"影片")]),t.state.media==="photo"?(_(),C("div",vi,[c("div",bi,[(_(!0),C(q,null,Y((U=(z=t.state)==null?void 0:z.tribeData)==null?void 0:U.culturalLandscape,G=>(_(),C("div",wi,[c("p",Li,k(G.name),1),c("img",{src:G.image,alt:"",class:"w-100"},null,8,Si)]))),256))])])):M("",!0),t.state.media==="video"?(_(),C("div",xi,Mi)):M("",!0)])])):M("",!0),t.state.type===2?(_(),C("div",ki,[c("div",Ei,[t.state.tribeData.event?(_(),C("div",Ii,[Ri,c("div",Pi,k(t.state.tribeData.event),1)])):M("",!0),t.state.tribeData.date?(_(),C("div",Oi,[Di,c("div",Ai,k(t.state.tribeData.date),1)])):M("",!0),t.state.tribeData.township?(_(),C("div",Fi,[Vi,c("div",Ni,k(t.state.tribeData.township),1)])):M("",!0),t.state.tribeData.village?(_(),C("div",Bi,[Gi,c("div",Wi,k(t.state.tribeData.village),1)])):M("",!0),t.state.tribeData.place?(_(),C("div",ji,[Hi,c("div",$i,k(t.state.tribeData.place),1)])):M("",!0),t.state.tribeData.category?(_(),C("div",zi,[Ui,c("div",Ki,k(t.state.tribeData.category),1)])):M("",!0),t.state.tribeData.description?(_(),C("div",qi,[Yi,c("div",Zi,k(t.state.tribeData.description),1)])):M("",!0)])])):M("",!0)],4)}const Xi=H(ui,[["render",Qi],["__scopeId","data-v-0943fc50"]]),xt="/Map_Demo/assets/logo-83a41ce3.svg",Ji="/Map_Demo/assets/2D-m-0cdbc246.svg",en="/Map_Demo/assets/3D-m-4ecf18c0.svg",tn="/Map_Demo/assets/vector-m-1fc5cf13.svg",sn="/Map_Demo/assets/selectVector-m-e4f4d97a.svg",nn="/Map_Demo/assets/singleWindow-m-4635df1a.svg",on="/Map_Demo/assets/doubleWindow-m-cccef2df.svg";const rn={props:{currentLayers:{type:Array,default:[]},mapCount:{type:Number,default:1},dimensionMapStatus:{type:Boolean,default:!1},openConditionWrap:{type:Function,default:()=>{}},openLayerSelect:{type:Function,default:()=>{}},onLayerControl:{type:Function,default:()=>{}},onChangeTarget:{type:Function,default:()=>{}}},setup(n,{emit:e}){const s=Q({toolSwitch:{threeDimensionalBtn:!1,layerConditionBtn:!1,splitWindowBtn:!1},targetNum:1});function t(o,a){Object.keys(s.toolSwitch).forEach(l=>{l===o?s.toolSwitch[o]?s.toolSwitch[o]=!1:s.toolSwitch[o]=!0:s.toolSwitch[l]=!1})}function i(o,a){o==="changeMapCount"&&(s.toolSwitch.splitWindowBtn=!1),n.onLayerControl({action:o,value:a})}function r(){e("conditionWrap")}return{props:n,state:s,toolSwitch:t,onLayerControl:i,conditionWrap:r}}},an={class:"w-100"},ln={class:"position-fixed top-0 w-100 px-3 d-flex justify-content-between justify-content-sm-end flex-wrap"},cn=c("img",{src:xt,class:"w-50 w-lg-100"},null,-1),dn={class:"switchControl mt-2 me-0 me-sm-2 d-block rounded-4 p-2",id:"switchControl",style:{"z-index":"99"}},un={class:"list-unstyled d-flex align-items-center justify-content-around py-2 flex-nowrap w-100 bg-white mb-0"},hn=c("img",{src:Ji},null,-1),mn=[hn],pn=c("img",{src:en},null,-1),gn=[pn],fn=c("img",{src:tn},null,-1),yn=[fn],_n=c("img",{src:sn},null,-1),Cn=[_n],vn={class:"text-white"},bn=c("img",{src:nn},null,-1),wn=[bn],Ln=c("img",{src:on},null,-1),Sn=[Ln];function xn(n,e,s,t,i,r){return _(),C("div",an,[c("div",ln,[cn,c("div",dn,[c("div",{class:j(["text-white rounded-pill",{active:t.state.targetNum===1}]),onClick:e[0]||(e[0]=()=>{t.state.targetNum=1,t.props.onChangeTarget(1)})},"上",2),c("div",{class:j(["text-white rounded-pill",{active:t.state.targetNum===2}]),onClick:e[1]||(e[1]=()=>{t.state.targetNum=2,t.props.onChangeTarget(2)})},"下",2)])]),c("ul",un,[c("li",null,[c("div",null,[t.props.dimensionMapStatus?(_(),C("div",{key:0,class:"navbarBtn",onClick:e[2]||(e[2]=E(o=>(t.toolSwitch("threeDimensionalBtn"),t.onLayerControl("changeDimensionMap","3D")),["prevent"]))},mn)):(_(),C("div",{key:1,class:"navbarBtn",onClick:e[3]||(e[3]=E(o=>(t.toolSwitch("threeDimensionalBtn"),t.onLayerControl("changeDimensionMap","2D")),["prevent"]))},gn))])]),c("li",null,[c("div",{class:"navbarBtn",onClick:e[4]||(e[4]=o=>t.props.openConditionWrap())},yn)]),c("li",null,[c("div",{class:"navbarBtn",onClick:e[5]||(e[5]=o=>t.props.openLayerSelect())},Cn)]),c("li",null,[c("div",vn,[t.props.mapCount===1?(_(),C("div",{key:0,class:"navbarBtn",onClick:e[6]||(e[6]=E(o=>t.props.onLayerControl({action:"changeMapCount",value:{qty:2}}),["prevent"]))},wn)):M("",!0),t.props.mapCount===2?(_(),C("div",{key:1,class:"navbarBtn",onClick:e[7]||(e[7]=E(o=>t.props.onLayerControl({action:"changeMapCount",value:{qty:1}}),["prevent"]))},Sn)):M("",!0)])])])])}const Tn=H(rn,[["render",xn]]);const Mn={props:{onClose:{type:Function,default:()=>{}},onDeleteLayer:{type:Function,default:()=>{}},onLockLayer:{type:Function,default:()=>{}},currentLayers:{type:Array,default:[]},selectLock:{type:Boolean,default:!1},onLayerControl:{type:Function,default:()=>{}}},setup(n,{emit:e}){const s=Q({});function t(i){n.onLayerControl({action:"setOpacity",value:{key:i.target.getAttribute("nodeindex"),value:i.target.value}});const r=parseFloat(Number(i.target.value));document.getElementById(`opacityControl${i.target.getAttribute("nodeindex")}`).innerText=r.toFixed(2)}return{props:n,state:s,updateOpacity:t}}},ee=n=>(ge("data-v-865e1213"),n=n(),fe(),n),kn={class:"layerSelect bg-white"},En={class:"row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold"},In=ee(()=>c("p",{class:"mb-0 fs-5"},"已選擇的圖層",-1)),Rn=ee(()=>c("hr",{class:"my-0"},null,-1)),Pn={class:"py-3 px-4 content",style:{"overflow-y":"scroll","max-height":"40vh"}},On={class:"allControl d-flex align-items-center justify-content-end mb-0"},Dn=ee(()=>c("svg",{viewBox:"0 0 25 24",fill:"currentColor"},[c("path",{d:"M8.02381 9.33333H14.881V7.80952C14.881 7.1746 14.6587 6.63492 14.2143 6.19048C13.7698 5.74603 13.2302 5.52381 12.5952 5.52381C11.9603 5.52381 11.4206 5.74603 10.9762 6.19048C10.5317 6.63492 10.3095 7.1746 10.3095 7.80952H8.78571C8.78571 6.75556 9.15727 5.85702 9.90038 5.1139C10.643 4.3713 11.5413 4 12.5952 4C13.6492 4 14.5477 4.3713 15.2909 5.1139C16.0335 5.85702 16.4048 6.75556 16.4048 7.80952V9.33333H17.1667C17.5857 9.33333 17.9446 9.48241 18.2432 9.78057C18.5414 10.0792 18.6905 10.4381 18.6905 10.8571V18.4762C18.6905 18.8952 18.5414 19.2541 18.2432 19.5528C17.9446 19.8509 17.5857 20 17.1667 20H8.02381C7.60476 20 7.24616 19.8509 6.948 19.5528C6.64933 19.2541 6.5 18.8952 6.5 18.4762V10.8571C6.5 10.4381 6.64933 10.0792 6.948 9.78057C7.24616 9.48241 7.60476 9.33333 8.02381 9.33333ZM12.5952 16.1905C13.0143 16.1905 13.3731 16.0414 13.6718 15.7432C13.97 15.4446 14.119 15.0857 14.119 14.6667C14.119 14.2476 13.97 13.8888 13.6718 13.5901C13.3731 13.2919 13.0143 13.1429 12.5952 13.1429C12.1762 13.1429 11.8176 13.2919 11.5194 13.5901C11.2208 13.8888 11.0714 14.2476 11.0714 14.6667C11.0714 15.0857 11.2208 15.4446 11.5194 15.7432C11.8176 16.0414 12.1762 16.1905 12.5952 16.1905Z"})],-1)),An=ee(()=>c("svg",{viewBox:"0 0 25 24",fill:"currentColor"},[c("path",{d:"M7.5 21C6.95 21 6.47933 20.8043 6.088 20.413C5.696 20.021 5.5 19.55 5.5 19V6H4.5V4H9.5V3H15.5V4H20.5V6H19.5V19C19.5 19.55 19.3043 20.021 18.913 20.413C18.521 20.8043 18.05 21 17.5 21H7.5ZM9.5 17H11.5V8H9.5V17ZM13.5 17H15.5V8H13.5V17Z"})],-1)),Fn={class:"list-unstyled d-flex flex-wrap flex-column-reverse"},Vn={key:0,class:"d-flex justify-content-between align-items-center border-bottom py-2 flex-wrap"},Nn={class:"tool"},Bn=["onClick"],Gn=ee(()=>c("svg",{viewBox:"0 0 25 24",fill:"currentColor"},[c("path",{d:"M9.49991 19.84H15.4999V11.84H20.3399L12.4999 4.00003L4.65991 11.84H9.49991V19.84Z",fill:"#808080"})],-1)),Wn=[Gn],jn=["onClick"],Hn=ee(()=>c("svg",{viewBox:"0 0 25 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[c("path",{d:"M9.49991 4H15.4999V12H20.3399L12.4999 19.84L4.65991 12H9.49991V4Z",fill:"#808080"})],-1)),$n=[Hn],zn=["onClick"],Un=ee(()=>c("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[c("path",{d:"M12.3333 10C11.8029 10 11.2942 10.2107 10.9191 10.5858C10.544 10.9609 10.3333 11.4696 10.3333 12C10.3333 12.5304 10.544 13.0391 10.9191 13.4142C11.2942 13.7893 11.8029 14 12.3333 14C12.8638 14 13.3725 13.7893 13.7475 13.4142C14.1226 13.0391 14.3333 12.5304 14.3333 12C14.3333 11.4696 14.1226 10.9609 13.7475 10.5858C13.3725 10.2107 12.8638 10 12.3333 10ZM12.3333 15.3333C11.4493 15.3333 10.6014 14.9821 9.97631 14.357C9.35119 13.7319 9 12.8841 9 12C9 11.1159 9.35119 10.2681 9.97631 9.64298C10.6014 9.01786 11.4493 8.66667 12.3333 8.66667C13.2174 8.66667 14.0652 9.01786 14.6904 9.64298C15.3155 10.2681 15.6667 11.1159 15.6667 12C15.6667 12.8841 15.3155 13.7319 14.6904 14.357C14.0652 14.9821 13.2174 15.3333 12.3333 15.3333ZM12.3333 7C9 7 6.15333 9.07333 5 12C6.15333 14.9267 9 17 12.3333 17C15.6667 17 18.5133 14.9267 19.6667 12C18.5133 9.07333 15.6667 7 12.3333 7Z",fill:"#808080"})],-1)),Kn=[Un],qn=["onClick"],Yn=ee(()=>c("svg",{viewBox:"0 0 25 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[c("path",{d:"M7.5 21C6.95 21 6.47933 20.8043 6.088 20.413C5.696 20.021 5.5 19.55 5.5 19V6H4.5V4H9.5V3H15.5V4H20.5V6H19.5V19C19.5 19.55 19.3043 20.021 18.913 20.413C18.521 20.8043 18.05 21 17.5 21H7.5ZM9.5 17H11.5V8H9.5V17ZM13.5 17H15.5V8H13.5V17Z",fill:"#808080"})],-1)),Zn=[Yn],Qn={class:"w-100 mt-2 d-flex align-items-center"},Xn=["nodeIndex"],Jn=["id"];function eo(n,e,s,t,i,r){return _(),C("div",kn,[c("div",En,[In,c("a",{href:"#",class:"closeBtn bg-dark text-decoration-none rounded-circle position-absolute d-flex align-items-center justify-content-center",onClick:e[0]||(e[0]=E((...o)=>t.props.onClose&&t.props.onClose(...o),["prevent"]))})]),Rn,c("div",Pn,[c("div",On,[c("a",{href:"",class:j(["d-flex align-items-center text-decoration-none me-4",{lockUp:t.props.selectLock,unlock:!t.props.selectLock}]),onClick:e[1]||(e[1]=E(()=>{t.props.onLockLayer()},["prevent"]))},[Dn,pe(" 鎖定圖層 ")],2),c("a",{href:"",class:j(["d-flex align-items-center text-decoration-none",{disabled:t.props.currentLayers.length<=1}]),onClick:e[2]||(e[2]=E(()=>{t.props.currentLayers.length>0&&t.props.onDeleteLayer({action:"selectLayerMode",value:{layerName:"all"}})},["prevent"]))},[An,pe(" 全部刪除 ")],2)]),c("ul",Fn,[(_(!0),C(q,null,Y(t.props.currentLayers,(o,a)=>(_(),C("li",null,[o.id?(_(),C("div",Vn,[c("div",null,k(o==null?void 0:o.label),1),c("div",Nn,[c("a",{href:"",onClick:E(l=>t.props.onLayerControl({action:"changeOrder",value:{movement:"up",id:o.id,key:a}}),["prevent"])},Wn,8,Bn),c("a",{href:"",onClick:E(l=>t.props.onLayerControl({action:"changeOrder",value:{movement:"down",id:o.id,key:a}}),["prevent"])},$n,8,jn),c("a",{href:"",class:j({Invisible:!(o!=null&&o.visible)}),onClick:E(()=>{t.props.onLayerControl({action:"changeLayerVisible",value:{key:a}})},["prevent"])},Kn,10,zn),c("a",{href:"",onClick:E(l=>t.props.onDeleteLayer({action:"selectLayerMode",value:{id:o==null?void 0:o.id}}),["prevent"])},Zn,8,qn)]),c("label",Qn,[c("input",{id:"opacity-input",class:"w-75 me-2",type:"range",min:"0",max:"1",step:"0.01",value:"1",nodeIndex:a,onInput:e[3]||(e[3]=(...l)=>t.updateOpacity&&t.updateOpacity(...l))},null,40,Xn),c("span",{id:`opacityControl${a}`},"1",8,Jn)])])):M("",!0)]))),256))])])])}const to=H(Mn,[["render",eo],["__scopeId","data-v-865e1213"]]);const so={props:{text:{type:String,default:"測試"},styles:{type:String,default:""},status:{type:Boolean,default:!0}},setup(n,{emit:e}){const s=pt(),t=ls,i=as(null),r=Q({overLayerHeight:ne(()=>{var a;return((a=i==null?void 0:i.value)==null?void 0:a.offsetHeight)+10}),overLayerWidth:ne(()=>{var a;return((a=i==null?void 0:i.value)==null?void 0:a.offsetWidth)+10}),accordionListRef:null,accordionListRefHeight:ne(()=>{var a;return(a=r.accordionListRef)==null?void 0:a.offsetHeight}),accordionListRefWidth:ne(()=>{var a;return(a=r.accordionListRef)==null?void 0:a.offsetWidth})});function o(a){console.log(J(".initOverLay").parent()),console.log(r.accordionListRefHeight),console.log(r.accordionListRefWidth)}return Re(()=>{J(".initOverLay").parent().addClass("position-relative")}),{state:r,props:n,store:s,route:t,overLayCom:i,showClick:o}}};function io(n,e,s,t,i,r){return t.store.state.isInit?(_(),C("div",{key:0,class:"initOverLay",onClick:e[0]||(e[0]=o=>t.store.dispatch("updateLayerStatus",!1)),style:ke({height:t.state.overLayerHeight+"px",width:t.state.overLayerWidth+"px"}),ref:o=>{t.state.accordionListRef=o}},[c("div",{class:"tipText text-white fw-bold fs-3",style:ke(t.props.styles)},k(t.props.text),5)],4)):M("",!0)}const Oe=H(so,[["render",io]]);let ue=[];const Le={getBaseMapData:n=>{let e;return Number.isInteger(n)?e=ue[n]:e=n.layer,new je({preload:1/0,name:e.name,label:e.label,type:e.mapType,baseId:e.baseId,source:new dt({url:e.url}),crossOrigin:"anonymous"})},setBaseMapData:n=>{ue=n},getCurrentBase:()=>ue.filter(n=>n.onCurrent),showBaseMapData:()=>{console.log(ue)}};function no(){return ue}const oo={props:{onClose:{type:Function,default:()=>{}},mapLayers:{type:Array,default:[]},currentLayers:{type:Array,default:[]},showSelectLayerValue:{type:Function,default:()=>{}},selectLayerOption:{type:Object,default:{}},tribeQuery:{type:Object,default:{}},moveToMap:{type:Function,default:()=>{}}},setup(n,{emit:e}){const s=Te,t=mt(),i=Q({DropDown:null,TilesListValue:0,conditionYear:"",conditionTown:"",selectLayerOption:[]});function r(h,f){e("onLayerControl",{action:h,value:f})}function o(h){i.DropDown!==h?i.DropDown=h:i.DropDown=null}function a(h,f){let y=h.target.checked||typeof h.target.checked==" ";r("layerMode",{checked:y,nodeIndex:f.nodeIndex,subNodeIndex:f.subNodeIndex,nestedSubNodeIndex:String(f.nestedSubNodeIndex)?f.nestedSubNodeIndex:void 0,id:f.single_tiles||!h.target.selectedOptions?f.id:h.target.selectedOptions[0].id})}function l(h){i.conditionYear=h.target.value,d()}function u(h){i.conditionTown=h.target.value,d()}async function d(){const h=await J.ajax(`https://api.edtest.site/tribes?${"years="+i.conditionYear}&${"township="+i.conditionTown}`,"GET");i.selectLayerOption=h}function m(h){let f=i.selectLayerOption.find(y=>y.tribeCode===h.target.value);n.moveToMap(f.coordinates)}return ht(()=>i.TilesListValue,(h,f)=>{n.showSelectLayerValue(h)}),{props:n,state:i,router:t,mapList:s,onLayerControl:r,openLayerList:o,LayerCheckBoxChange:a,tribeYear:l,tribeTown:u,moveMap:m}}},Tt=n=>(ge("data-v-d92534be"),n=n(),fe(),n),ro={class:"condition bg-white"},ao={class:"row mx-0 align-items-center flex-nowrap text-center p-2 fw-bold border-bottom"},lo=Tt(()=>c("p",{class:"mb-0 fs-5"},"圖層選項",-1)),co={class:"py-3 px-4 content",style:{"max-height":"40vh","overflow-y":"scroll"}},uo={class:"mb-2 landBoundary"},ho={class:"mb-2"},mo=["onClick"],po=Tt(()=>c("path",{fill:"currentColor",d:"M8 5v14l11-7z"},null,-1)),go=[po],fo={class:"ms-3 mb-1"},yo={key:0},_o=["checked","onChange"],Co={key:0},vo={key:0},bo=["value"],wo=["value"],Lo=["value"],So={key:1},xo=["checked","onChange"],To=["onChange"],Mo=["value","id"];function ko(n,e,s,t,i,r){return _(),C("div",ro,[c("div",ao,[lo,c("a",{href:"#",class:"closeBtn bg-dark text-decoration-none rounded-circle position-absolute d-flex align-items-center justify-content-center",onClick:e[0]||(e[0]=E((...o)=>t.props.onClose&&t.props.onClose(...o),["prevent"]))})]),c("div",co,[c("div",uo,[(_(!0),C(q,null,Y(t.props.mapLayers,(o,a)=>(_(),C("div",ho,[c("div",{class:"title d-flex align-items-center fw-bold text-black order-1 mb-1 text-decoration-none",onClick:l=>t.openLayerList(a)},[c("div",{class:j(o.groupClass)},null,2),c("div",null,k(o.label),1),(_(),C("svg",{viewBox:"0 0 24 24",class:j({openTitle:t.state.DropDown==a})},go,2))],8,mo),t.state.DropDown==a?(_(!0),C(q,{key:0},Y(o.layers,(l,u)=>(_(),C("div",fo,[l.single_tiles?(_(),C("div",yo,[c("input",{type:"checkbox",checked:t.props.currentLayers.some(d=>d.id===l.id),onChange:d=>{t.LayerCheckBoxChange(d,{nodeIndex:a,subNode:l,subNodeIndex:u,nestedSubNodeIndex:"",single_tiles:l.single_tiles,id:l.id})}},null,40,_o),pe(" "+k(l.title)+" ",1),(_(),C("div",Co,[l.id==="node4_subNode0_nestedSubNodeundefined"?(_(),C("div",vo,[t.props.tribeQuery.years!==void 0?(_(),C("select",{key:0,class:"me-2",onChange:e[1]||(e[1]=(...d)=>t.tribeYear&&t.tribeYear(...d)),placeholder:"請選擇年度"},[(_(!0),C(q,null,Y(t.props.tribeQuery.years,(d,m)=>(_(),C("option",{value:d},k(d),9,bo))),256))],32)):M("",!0),t.props.tribeQuery.township!==void 0?(_(),C("select",{key:1,class:"me-2",onChange:e[2]||(e[2]=(...d)=>t.tribeTown&&t.tribeTown(...d)),placeholder:"請選擇鄉鎮"},[(_(!0),C(q,null,Y(t.props.tribeQuery.township,(d,m)=>(_(),C("option",{value:d},k(d),9,wo))),256))],32)):M("",!0),t.state.selectLayerOption.length!==0?(_(),C("select",{key:2,class:"me-2",onChange:e[3]||(e[3]=(...d)=>t.moveMap&&t.moveMap(...d))},[(_(!0),C(q,null,Y(t.state.selectLayerOption,(d,m)=>(_(),C("option",{value:d.tribeCode},k(d.tribeName),9,Lo))),256))],32)):M("",!0)])):M("",!0)]))])):(_(),C("div",So,[c("input",{type:"checkbox",checked:t.props.currentLayers.some(d=>{let m=t.mapList.getLayerIndex(d.id);return m.nodeIndex==a&&m.subNodeIndex==u}),onChange:d=>{t.LayerCheckBoxChange(d,{nodeIndex:a,subNode:l,subNodeIndex:u,nestedSubNodeIndex:"",single_tiles:l.single_tiles,id:l.id})}},null,40,xo),pe(" "+k(l.title)+" ",1),gt(c("select",{name:"",id:"",class:"ms-3","onUpdate:modelValue":e[4]||(e[4]=d=>t.state.TilesListValue=d),onChange:d=>{t.LayerCheckBoxChange(d,{nodeIndex:a,subNode:l,subNodeIndex:u,nestedSubNodeIndex:t.state.TilesListValue,single_tiles:l.single_tiles,id:l.id})}},[(_(!0),C(q,null,Y(l.tiles_list,(d,m)=>(_(),C("option",{value:m,id:d.id},k(d.title),9,Mo))),256))],40,To),[[ft,t.state.TilesListValue]])]))]))),256)):M("",!0)]))),256))])])])}const Eo=H(oo,[["render",ko],["__scopeId","data-v-d92534be"]]),Io="/Map_Demo/assets/2D-70e1bbad.svg",Ro="/Map_Demo/assets/3D-cb71f302.svg",Po="/Map_Demo/assets/baseLayer-3608307c.svg",Mt="/Map_Demo/assets/singleWindow-1afc73e5.svg",kt="/Map_Demo/assets/doubleWindows-82f012fb.svg";const Oo={props:{currentLayers:{type:Array,default:[]},mapCount:{type:Number,default:1},dimensionMapStatus:{type:Boolean,default:!1}},setup(n,{emit:e}){const s=Q({toolSwitch:{threeDimensionalBtn:!1,layerConditionBtn:!1,splitWindowBtn:!1},targetNum:1});function t(a,l){Object.keys(s.toolSwitch).forEach(u=>{u===a?s.toolSwitch[a]?s.toolSwitch[a]=!1:s.toolSwitch[a]=!0:s.toolSwitch[u]=!1})}function i(a,l){a==="changeMapCount"&&(s.toolSwitch.splitWindowBtn=!1),e("onLayerControl",{action:a,value:l})}function r(){e("conditionWrap")}function o(a){s.targetNum=a,e("onChangeTarget",a)}return{props:n,state:s,toolSwitch:t,onLayerControl:i,conditionWrap:r,onChangeTarget:o}}},ye=n=>(ge("data-v-611b1502"),n=n(),fe(),n),Do={class:"list-unstyled d-inline-flex align-items-center flex-nowrap w-full"},Ao={class:"me-4 position-relative"},Fo={class:"MapFeatureBtn text-white"},Vo=ye(()=>c("img",{src:Io},null,-1)),No=[Vo],Bo=ye(()=>c("img",{src:Ro},null,-1)),Go=[Bo],Wo={class:"me-4 position-relative"},jo=ye(()=>c("img",{src:Po,alt:""},null,-1)),Ho=[jo],$o={class:"position-relative"},zo={key:0,src:Mt,alt:""},Uo={key:1,src:kt,alt:""},Ko={key:0,class:"list-unstyled position-absolute start-0 top-100 p-0"},qo={class:"mt-2"},Yo=ye(()=>c("img",{src:Mt,alt:""},null,-1)),Zo=[Yo],Qo={class:"mt-2"},Xo=ye(()=>c("img",{src:kt,alt:""},null,-1)),Jo=[Xo],er={class:"switchControl d-flex position-fixed rounded-pill translate-middle-x p-2",id:"switchControl",style:{"z-index":"99"}};function tr(n,e,s,t,i,r){const o=Oe;return _(),C("div",null,[c("ul",Do,[V(o,{text:"圖層操控工具"}),c("li",Ao,[c("div",Fo,[t.props.dimensionMapStatus?(_(),C("a",{key:0,href:"",onClick:e[0]||(e[0]=E(a=>(t.toolSwitch("threeDimensionalBtn"),t.onLayerControl("changeDimensionMap","3D")),["prevent"]))},No)):(_(),C("a",{key:1,href:"",onClick:e[1]||(e[1]=E(a=>(t.toolSwitch("threeDimensionalBtn"),t.onLayerControl("changeDimensionMap","2D")),["prevent"]))},Go))])]),c("li",Wo,[c("a",{href:"",class:"MapFeatureBtn text-white",onClick:e[2]||(e[2]=E(a=>(t.toolSwitch("layerConditionBtn"),t.conditionWrap()),["prevent"]))},Ho)]),c("li",$o,[c("a",{href:"",class:"MapFeatureBtn text-white",onClick:e[3]||(e[3]=E(a=>t.toolSwitch("splitWindowBtn"),["prevent"]))},[t.props.mapCount===1?(_(),C("img",zo)):M("",!0),t.props.mapCount===2?(_(),C("img",Uo)):M("",!0)]),t.state.toolSwitch.splitWindowBtn?(_(),C("ul",Ko,[c("li",qo,[c("a",{href:"",class:"text-white MapFeatureBtn",onClick:e[4]||(e[4]=E(a=>t.onLayerControl("changeMapCount",{qty:1}),["prevent"]))},Zo)]),c("li",Qo,[c("a",{href:"",class:"text-white MapFeatureBtn",onClick:e[5]||(e[5]=E(a=>t.onLayerControl("changeMapCount",{qty:2}),["prevent"]))},Jo)])])):M("",!0)])]),c("div",er,[V(o,{text:"左右視窗切換工具"}),c("div",{class:j(["fs-3 text-white rounded-pill",{active:t.state.targetNum===1}]),onClick:e[6]||(e[6]=()=>{t.onChangeTarget(1)})},"左",2),c("div",{class:j(["fs-3 text-white rounded-pill",{active:t.state.targetNum===2}]),onClick:e[7]||(e[7]=()=>{t.onChangeTarget(2)})},"右",2)])])}const sr=H(Oo,[["render",tr],["__scopeId","data-v-611b1502"]]);const ir={props:{baseMapList:{type:Array,default:[]},onChangeBaseMaps:{type:Function,default:()=>{}}},setup(n,{emit:e}){const s=Q({selectMap:0,mapSourceList:[]});function t(){let i="baseMap",r=n.baseMapList.find(o=>o.baseId===s.selectMap);n.onChangeBaseMaps({action:i,value:r})}return{state:s,props:n,onChangeBaseMaps:t}}},nr=["value"];function or(n,e,s,t,i,r){const o=Oe;return _(),C("div",null,[V(o,{text:"底圖切換工具"}),gt(c("select",{name:"",id:"","onUpdate:modelValue":e[0]||(e[0]=a=>t.state.selectMap=a),onChange:e[1]||(e[1]=a=>{t.onChangeBaseMaps(a)})},[(_(!0),C(q,null,Y(t.props.baseMapList,(a,l)=>(_(),C("option",{key:l,value:a.baseId},k(a.label),9,nr))),128))],544),[[ft,t.state.selectMap]])])}const rr=H(ir,[["render",or],["__scopeId","data-v-cebf3faa"]]),ar="/Map_Demo/assets/zoomIn-c80b5dd3.svg",lr="/Map_Demo/assets/zoomOut-88993246.svg",cr="/Map_Demo/assets/compass-1c1efd7a.svg",dr="/Map_Demo/assets/location-b52d62b2.svg",ur="/Map_Demo/assets/zoom-8acdf5b3.svg",hr={props:{id:{Type:String,default:0},map:{}},setup(n,{emit:e}){function s(t){e("onMapControl",{action:t})}return{props:n,onMapControl:s}}},mr={class:"d-flex flex-nowrap flex-column"},pr=c("img",{src:ar,alt:"zoomIn"},null,-1),gr=[pr],fr=c("img",{src:lr,alt:"zoomOut"},null,-1),yr=[fr],_r=c("img",{src:cr,alt:"compass"},null,-1),Cr=[_r],vr=c("img",{src:dr,alt:"location"},null,-1),br=[vr],wr=c("img",{src:ur,alt:"zoom"},null,-1),Lr=[wr];function Sr(n,e,s,t,i,r){const o=Oe;return _(),C("div",mr,[V(o,{text:"地圖操控工具"}),c("a",{href:"#",class:"d-none d-sm-block order-1 mb-0",onClick:e[0]||(e[0]=E(a=>t.onMapControl("In"),["prevent"]))},gr),c("a",{href:"#",class:"d-none d-sm-block order-1 mb-2",onClick:e[1]||(e[1]=E(a=>t.onMapControl("Out"),["prevent"]))},yr),c("a",{href:"#",class:"order-1 mb-2",onClick:e[2]||(e[2]=E(a=>t.onMapControl("toNorth"),["prevent"]))},Cr),c("a",{href:"#",class:"order-1 mb-2",onClick:e[3]||(e[3]=E(a=>t.onMapControl("moveTo"),["prevent"]))},br),c("a",{href:"#",class:"order-1",onClick:e[4]||(e[4]=E(a=>t.onMapControl("fullScreen"),["prevent"]))},Lr)])}const xr=H(hr,[["render",Sr]]),Fe="units",Tr=[1,2,5],ce=25.4/.28;class Mr extends $t{constructor(e){e=e||{};const s=document.createElement("div");s.style.pointerEvents="none",super({element:s,render:e.render,target:e.target}),this.on,this.once,this.un;const t=e.className!==void 0?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=t+"-inner",this.element.className=t+" "+zt,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth!==void 0?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(Fe,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(Fe)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(Fe,e)}setDpi(e){this.dpi_=e}updateElement_(){const e=this.viewState_;if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const s=e.center,t=e.projection,i=this.getUnits(),r=i=="degrees"?"degrees":"m";let o=qe(t,e.resolution,s,r);const a=this.minWidth_*(this.dpi_||ce)/ce,l=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||ce)/ce:void 0;let u=a*o,d="";if(i=="degrees"){const v=Ut.degrees;u*=v,u<v/60?(d="″",o*=3600):u<v?(d="′",o*=60):d="°"}else i=="imperial"?u<.9144?(d="in",o/=.0254):u<1609.344?(d="ft",o/=.3048):(d="mi",o/=1609.344):i=="nautical"?(o/=1852,d="NM"):i=="metric"?u<.001?(d="μm",o*=1e6):u<1?(d="mm",o*=1e3):u<1e3?d="m":(d="km",o/=1e3):i=="us"?u<.9144?(d="in",o*=39.37):u<1609.344?(d="ft",o/=.30480061):(d="mi",o/=1609.3472):rt(!1,33);let m=3*Math.floor(Math.log(a*o)/Math.log(10)),h,f,y,S,g,L;for(;;){y=Math.floor(m/3);const v=Math.pow(10,y);if(h=Tr[(m%3+3)%3]*v,f=Math.round(h/o),isNaN(f)){this.element.style.display="none",this.renderedVisible_=!1;return}if(l!==void 0&&f>=l){h=S,f=g,y=L;break}else if(f>=a)break;S=h,g=f,L=y,++m}const D=this.scaleBar_?this.createScaleBar(f,h,d):h.toFixed(y<0?-y:0)+" "+d;this.renderedHTML_!=D&&(this.innerElement_.innerHTML=D,this.renderedHTML_=D),this.renderedWidth_!=f&&(this.innerElement_.style.width=f+"px",this.renderedWidth_=f),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,s,t){const i=this.getScaleForResolution(),r=i<1?Math.round(1/i).toLocaleString()+" : 1":"1 : "+Math.round(i).toLocaleString(),o=this.scaleBarSteps_,a=e/o,l=[this.createMarker("absolute")];for(let d=0;d<o;++d){const m=d%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";l.push(`<div><div class="ol-scale-singlebar ${m}" style="width: ${a}px;"></div>`+this.createMarker("relative")+(d%2===0||o===2?this.createStepText(d,e,!1,s,t):"")+"</div>")}return l.push(this.createStepText(o,e,!0,s,t)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+r+"</div>":"")+l.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e==="absolute"?3:-10}px;"></div>`}createStepText(e,s,t,i,r){const a=(e===0?0:Math.round(i/this.scaleBarSteps_*e*100)/100)+(e===0?"":" "+r),l=e===0?-3:s/this.scaleBarSteps_*-1,u=e===0?0:s/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${l}px;text-align: ${e===0?"left":"center"};min-width: ${u}px;left: ${t?s+"px":"unset"};">`+a+"</div>"}getScaleForResolution(){const e=qe(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),s=this.dpi_||ce,t=1e3/25.4;return e*t*s}render(e){const s=e.frameState;s?this.viewState_=s.viewState:this.viewState_=null,this.updateElement_()}}const kr=Mr;class Er{constructor(e){this.ol3d=e,this.scene_=e.getCesiumScene(),this.canvas_=this.scene_.canvas,this._boundNotifyRepaintRequired=this.notifyRepaintRequired.bind(this),this.repaintEventNames_=["mousemove","mousedown","mouseup","touchstart","touchend","touchmove","pointerdown","pointerup","pointermove","wheel"],this.enable()}enable(){this.scene_.requestRenderMode=!0,this.scene_.maximumRenderTimeChange=1e3;for(const e of this.repaintEventNames_)this.canvas_.addEventListener(e,this._boundNotifyRepaintRequired,!1);window.addEventListener("resize",this._boundNotifyRepaintRequired,!1),this.ol3d.getOlMap().getLayerGroup().on("change",this._boundNotifyRepaintRequired)}disable(){for(const e of this.repaintEventNames_)this.canvas_.removeEventListener(e,this._boundNotifyRepaintRequired,!1);window.removeEventListener("resize",this._boundNotifyRepaintRequired,!1),this.ol3d.getOlMap().getLayerGroup().un("change",this._boundNotifyRepaintRequired),this.scene_.requestRenderMode=!1}restartRenderLoop(){this.notifyRepaintRequired()}notifyRepaintRequired(){this.scene_.requestRender()}}function Se(n){return n*180/Math.PI}function de(n){return n*Math.PI/180}class ae{constructor(e,s){this.scene_=e,this.cam_=e.camera,this.map_=s,this.view_=null,this.viewListenKey_=null,this.toLonLat_=ae.identityProjection,this.fromLonLat_=ae.identityProjection,this.tilt_=0,this.distance_=0,this.lastCameraViewMatrix_=null,this.viewUpdateInProgress_=!1,this.map_.on("change:view",t=>{this.setView_(this.map_.getView())}),this.setView_(this.map_.getView())}static identityProjection(e,s,t){const i=t||e.length;if(s)for(let r=0;r<i;++r)s[r]=e[r];return e}setView_(e){if(this.view_&&(X(this.viewListenKey_),this.viewListenKey_=null),this.view_=e,e){const s=Ve(e.getProjection(),"EPSG:4326"),t=Ve("EPSG:4326",e.getProjection());console.assert(s&&t),this.toLonLat_=s,this.fromLonLat_=t,this.viewListenKey_=e.on("propertychange",i=>this.handleViewEvent_(i)),this.readFromView()}else this.toLonLat_=ae.identityProjection,this.fromLonLat_=ae.identityProjection}handleViewEvent_(e){this.viewUpdateInProgress_||this.readFromView()}setHeading(e){this.view_&&this.view_.setRotation(e)}getHeading(){return this.view_?this.view_.getRotation()||0:void 0}setTilt(e){this.tilt_=e,this.updateCamera_()}getTilt(){return this.tilt_}setDistance(e){this.distance_=e,this.updateCamera_(),this.updateView()}getDistance(){return this.distance_}setCenter(e){this.view_&&this.view_.setCenter(e)}getCenter(){if(this.view_)return this.view_.getCenter()}setPosition(e){if(!this.toLonLat_)return;const s=this.toLonLat_(e);console.assert(s);const t=new Cesium.Cartographic(de(s[0]),de(s[1]),this.getAltitude());this.cam_.setView({destination:Cesium.Ellipsoid.WGS84.cartographicToCartesian(t)}),this.updateView()}getPosition(){if(!this.fromLonLat_)return;const e=Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position),s=this.fromLonLat_([Se(e.longitude),Se(e.latitude)]);return console.assert(s),s}setAltitude(e){const s=Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position);s.height=e,this.cam_.position=Cesium.Ellipsoid.WGS84.cartographicToCartesian(s),this.updateView()}getAltitude(){return Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position).height}updateCamera_(){if(!this.view_||!this.toLonLat_)return;const e=this.view_.getCenter();if(!e)return;const s=this.toLonLat_(e);console.assert(s);const t=new Cesium.Cartographic(de(s[0]),de(s[1]));if(this.scene_.globe){const o=this.scene_.globe.getHeight(t);t.height=o||0}const i=Cesium.Ellipsoid.WGS84.cartographicToCartesian(t),r={pitch:this.tilt_-Cesium.Math.PI_OVER_TWO,heading:-this.view_.getRotation(),roll:void 0};this.cam_.setView({destination:i,orientation:r}),this.cam_.moveBackward(this.distance_),this.checkCameraChange(!0)}readFromView(){if(!this.view_||!this.toLonLat_)return;const e=this.view_.getCenter();if(e==null)return;const s=this.toLonLat_(e);console.assert(s);const t=this.view_.getResolution();this.distance_=this.calcDistanceForResolution(t||0,de(s[1])),this.updateCamera_()}updateView(){if(!this.view_||!this.fromLonLat_)return;this.viewUpdateInProgress_=!0;const e=Cesium.Ellipsoid.WGS84,s=this.scene_,t=O.pickCenterPoint(s);let i=t;if(!i){const o=s.globe,a=this.cam_.positionCartographic.clone(),l=o.getHeight(a);a.height=l||0,i=Cesium.Ellipsoid.WGS84.cartographicToCartesian(a)}this.distance_=Cesium.Cartesian3.distance(i,this.cam_.position);const r=e.cartesianToCartographic(i);if(this.view_.setCenter(this.fromLonLat_([Se(r.longitude),Se(r.latitude)])),this.view_.setResolution(this.calcResolutionForDistance(this.distance_,r?r.latitude:0)),t){const o=this.cam_.position,a=new Cesium.Cartesian3;e.geocentricSurfaceNormal(t,a);const l=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(o,t,l),Cesium.Cartesian3.normalize(l,l);const u=this.cam_.up,d=this.cam_.right,m=new Cesium.Cartesian3(-t.y,t.x,0),h=Cesium.Cartesian3.angleBetween(d,m),y=Cesium.Cartesian3.cross(t,u,new Cesium.Cartesian3).z;this.view_.setRotation(y<0?h:-h);const S=Math.acos(Cesium.Cartesian3.dot(a,l));this.tilt_=isNaN(S)?0:S}else this.view_.setRotation(this.cam_.heading),this.tilt_=-this.cam_.pitch+Math.PI/2;this.viewUpdateInProgress_=!1}checkCameraChange(e){const s=this.lastCameraViewMatrix_,t=this.cam_.viewMatrix;(!s||!Cesium.Matrix4.equalsEpsilon(s,t,1e-5))&&(this.lastCameraViewMatrix_=t.clone(),e!==!0&&this.updateView())}calcDistanceForResolution(e,s){return Kt(e,s,this.scene_,this.view_.getProjection())}calcResolutionForDistance(e,s){return qt(e,s,this.scene_,this.view_.getProjection())}}class Et{constructor(e,s){this.map=e,this.view=e.getView(),this.scene=s,this.olLayers=e.getLayerGroup().getLayers(),this.mapLayerGroup=e.getLayerGroup(),this.layerMap={},this.olLayerListenKeys={},this.olGroupListenKeys_={}}synchronize(){this.destroyAll(),this.addLayers_(this.mapLayerGroup)}orderLayers(){}addLayers_(e){const s=[{layer:e,parents:[]}];for(;s.length>0;){const t=s.splice(0,1)[0],i=t.layer,r=R(i).toString();this.olLayerListenKeys[r]=[],console.assert(!this.layerMap[r]);let o=null;if(i instanceof Ne)this.listenForGroupChanges_(i),i!==this.mapLayerGroup&&(o=this.createSingleLayerCounterparts(t)),o||i.getLayers().forEach(a=>{if(a){const l={layer:a,parents:i===this.mapLayerGroup?[]:[t.layer].concat(t.parents)};s.push(l)}});else if(o=this.createSingleLayerCounterparts(t),!o){const a=r,l=t,u=d=>{const m=this.createSingleLayerCounterparts(l);m&&(l.layer.un("change",u),this.addCesiumObjects_(m,a,l.layer),this.orderLayers())};this.olLayerListenKeys[r].push(re(l.layer,"change",u))}o&&this.addCesiumObjects_(o,r,i)}this.orderLayers()}addCesiumObjects_(e,s,t){this.layerMap[s]=e,this.olLayerListenKeys[s].push(re(t,"change:zIndex",()=>this.orderLayers())),e.forEach(i=>{this.addCesiumObject(i)})}removeAndDestroySingleLayer_(e){const s=R(e).toString(),t=this.layerMap[s];return t&&(t.forEach(i=>{this.removeSingleCesiumObject(i,!1),this.destroyCesiumObject(i)}),this.olLayerListenKeys[s].forEach(X),delete this.olLayerListenKeys[s]),delete this.layerMap[s],!!t}unlistenSingleGroup_(e){if(e===this.mapLayerGroup)return;const s=R(e).toString();this.olGroupListenKeys_[s].forEach(i=>{X(i)}),delete this.olGroupListenKeys_[s],delete this.layerMap[s]}removeLayer_(e){if(e){const s=[e];for(;s.length>0;){const t=s.splice(0,1)[0],i=this.removeAndDestroySingleLayer_(t);t instanceof Ne&&(this.unlistenSingleGroup_(t),i||t.getLayers().forEach(r=>{s.push(r)}))}}}listenForGroupChanges_(e){const s=R(e).toString();console.assert(this.olGroupListenKeys_[s]===void 0);const t=[];this.olGroupListenKeys_[s]=t;let i=[];const r=(function(){const o=e.getLayers();o&&(i=[o.on("add",a=>{this.addLayers_(a.element)}),o.on("remove",a=>{this.removeLayer_(a.element)})],t.push(...i))}).bind(this);r(),t.push(e.on("change:layers",o=>{i.forEach(a=>{const l=t.indexOf(a);l>=0&&t.splice(l,1),X(a)}),r()}))}destroyAll(){this.removeAllCesiumObjects(!0);let e;for(e in this.olGroupListenKeys_)this.olGroupListenKeys_[e].forEach(X);for(e in this.olLayerListenKeys)this.olLayerListenKeys[e].forEach(X);this.olGroupListenKeys_={},this.olLayerListenKeys={},this.layerMap={}}addCesiumObject(e){}destroyCesiumObject(e){}removeSingleCesiumObject(e,s){}removeAllCesiumObjects(e){}createSingleLayerCounterparts(e){}}class Ir extends Et{constructor(e,s){super(e,s),this.cesiumLayers_=s.imageryLayers,this.ourLayers_=new Cesium.ImageryLayerCollection}addCesiumObject(e){this.cesiumLayers_.add(e),this.ourLayers_.add(e)}destroyCesiumObject(e){e.destroy()}removeSingleCesiumObject(e,s){this.cesiumLayers_.remove(e,s),this.ourLayers_.remove(e,!1)}removeAllCesiumObjects(e){for(let s=0;s<this.ourLayers_.length;++s)this.cesiumLayers_.remove(this.ourLayers_.get(s),e);this.ourLayers_.removeAll(!1)}convertLayerToCesiumImageries(e,s){const t=O.tileLayerToImageryLayer(this.map,e,s);return t?[t]:null}createSingleLayerCounterparts(e){const s=e.layer,t=R(s).toString(),i=this.view.getProjection();console.assert(i);const r=this.convertLayerToCesiumImageries(s,i);if(r){const o=[];if([e.layer].concat(e.parents).forEach(a=>{o.push(a.on(["change:opacity","change:visible"],()=>{console.assert(r);for(let l=0;l<r.length;++l)O.updateCesiumLayerProperties(e,r[l])}))}),s.getStyleFunction){let a=s.getStyleFunction();o.push(s.on("change",()=>{const l=s.getStyleFunction();if(a!==l){a=l;for(let u=0;u<r.length;++u){const d=r[u];d._imageryCache&&d.imageryProvider.cache_&&(d._imageryCache={},d.imageryProvider.cache_={},d.imageryProvider.styleFunction_=l)}this.scene.requestRender()}}))}for(let a=0;a<r.length;++a)O.updateCesiumLayerProperties(e,r[a]);o.push(s.on("change:extent",a=>{for(let l=0;l<r.length;++l)this.cesiumLayers_.remove(r[l],!0),this.ourLayers_.remove(r[l],!1);delete this.layerMap[R(s)],this.synchronize()})),o.push(s.on("change",a=>{for(let l=0;l<r.length;++l){const u=this.cesiumLayers_.indexOf(r[l]);u>=0&&(this.cesiumLayers_.remove(r[l],!1),this.cesiumLayers_.add(r[l],u))}})),this.olLayerListenKeys[t].push(...o)}return Array.isArray(r)?r:null}orderLayers(){const e=[],s={},t=[this.mapLayerGroup];for(;t.length>0;){const i=t.splice(0,1)[0];if(e.push(i),s[R(i)]=i.getZIndex()||0,i instanceof Ne){const r=i.getLayers();r&&t.unshift(...r.getArray())}}Yt(e,(i,r)=>s[R(i)]-s[R(r)]),e.forEach(i=>{const r=R(i).toString(),o=this.layerMap[r];o&&o.forEach(a=>{this.raiseToTop(a)})})}raiseToTop(e){this.cesiumLayers_.raiseToTop(e)}}class Rr{constructor(e,s){const t=new Cesium.BillboardCollection({scene:s}),i=new Cesium.PrimitiveCollection;this.olListenKeys=[],this.rootCollection_=new Cesium.PrimitiveCollection,this.context={projection:e,billboards:t,featureToCesiumMap:{},primitives:i},this.rootCollection_.add(t),this.rootCollection_.add(i)}destroy(){this.olListenKeys.forEach(X),this.olListenKeys.length=0}getRootPrimitive(){return this.rootCollection_}}class Pr{constructor(e){this.scene=e,this.boundOnRemoveOrClearFeatureListener_=this.onRemoveOrClearFeature_.bind(this),this.defaultBillboardEyeOffset_=new Cesium.Cartesian3(0,0,10)}onRemoveOrClearFeature_(e){const s=e.target;console.assert(s instanceof me);const t=ie.obj(s).olcs_cancellers;if(t){const i=e.feature;if(i){const r=R(i),o=t[r];o&&(o(),delete t[r])}else{for(const r in t)t.hasOwnProperty(r)&&t[r]();ie.obj(s).olcs_cancellers={}}}}setReferenceForPicking(e,s,t){t.olLayer=e,t.olFeature=s}createColoredPrimitive(e,s,t,i,r,o){const a=function(h,f){const y=new Cesium.GeometryInstance({geometry:h});return f&&!(f instanceof Cesium.ImageMaterialProperty)&&(y.attributes={color:Cesium.ColorGeometryInstanceAttribute.fromColor(f)}),y},l={flat:!0,renderState:{depthTest:{enabled:!0}}};o!==void 0&&(l.renderState||(l.renderState={}),l.renderState.lineWidth=o);const u=a(i,r),d=this.getHeightReference(e,s,t);let m;if(d===Cesium.HeightReference.CLAMP_TO_GROUND){const h=u.geometry.constructor;if(h&&!h.createShadowVolume)return null;m=new Cesium.GroundPrimitive({geometryInstances:u})}else m=new Cesium.Primitive({geometryInstances:u});if(r instanceof Cesium.ImageMaterialProperty){const h=r.image.getValue().toDataURL();m.appearance=new Cesium.MaterialAppearance({flat:!0,renderState:{depthTest:{enabled:!0}},material:new Cesium.Material({fabric:{type:"Image",uniforms:{image:h}}})})}else m.appearance=new Cesium.PerInstanceColorAppearance(l);return this.setReferenceForPicking(e,s,m),m}extractColorFromOlStyle(e,s){const t=e.getFill()?e.getFill().getColor():null,i=e.getStroke()?e.getStroke().getColor():null;let r="black";return i&&s?r=i:t&&(r=t),O.convertColorToCesium(r)}extractLineWidthFromOlStyle(e){const s=e.getStroke()?e.getStroke().getWidth():void 0;return s!==void 0?s:1}wrapFillAndOutlineGeometries(e,s,t,i,r,o){const a=this.extractColorFromOlStyle(o,!1),l=this.extractColorFromOlStyle(o,!0),u=new Cesium.PrimitiveCollection;if(o.getFill()){const d=this.createColoredPrimitive(e,s,t,i,a);console.assert(!!d),u.add(d)}if(o.getStroke()&&r){const d=this.extractLineWidthFromOlStyle(o),m=this.createColoredPrimitive(e,s,t,r,l,d);m&&u.add(m)}return u}addTextStyle(e,s,t,i,r){let o;if(r instanceof Cesium.PrimitiveCollection?o=r:(o=new Cesium.PrimitiveCollection,o.add(r)),!i.getText())return o;const a=i.getText(),l=this.olGeometry4326TextPartToCesium(e,s,t,a);return l&&o.add(l),o}csAddBillboard(e,s,t,i,r,o){s.eyeOffset||(s.eyeOffset=this.defaultBillboardEyeOffset_);const a=e.add(s);return this.setReferenceForPicking(t,i,a),a}olCircleGeometryToCesium(e,s,t,i,r){t=O.olGeometryCloneTo4326(t,i),console.assert(t.getType()=="Circle");let o=t.getCenter();const a=o.length==3?o[2]:0;let l=o.slice();l[0]+=t.getRadius(),o=O.ol4326CoordinateToCesiumCartesian(o),l=O.ol4326CoordinateToCesiumCartesian(l);const u=Cesium.Cartesian3.distance(o,l),d=new Cesium.CircleGeometry({center:o,radius:u,height:a});let m,h;if(this.getHeightReference(e,s,t)===Cesium.HeightReference.CLAMP_TO_GROUND){const y=this.extractLineWidthFromOlStyle(r);if(y){const S=Zt(t.getCenter(),u),g=O.ol4326CoordinateArrayToCsCartesians(S.getLinearRing(0).getCoordinates());if(De(this.scene))m=new Cesium.GroundPolylinePrimitive({geometryInstances:new Cesium.GeometryInstance({geometry:new Cesium.GroundPolylineGeometry({positions:g,width:y})}),appearance:new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(s,r,!0)}),classificationType:Cesium.ClassificationType.TERRAIN}),m.readyPromise.then(()=>{this.setReferenceForPicking(e,s,m._primitive)});else{const L=this.extractColorFromOlStyle(r,!0);m=this.createStackedGroundCorridors(e,s,y,L,g)}}}else h=new Cesium.CircleOutlineGeometry({center:o,radius:u,extrudedHeight:a,height:a});const f=this.wrapFillAndOutlineGeometries(e,s,t,d,h,r);return m&&f.add(m),this.addTextStyle(e,s,t,r,f)}createStackedGroundCorridors(e,s,t,i,r){Array.isArray(r[0])||(r=[r]),t=Math.max(3,t);const o=[];let a=0;for(const l of[1e3,4e3,16e3,64e3,254e3,1e6,1e7]){t*=2.14;const u={width:t,vertexFormat:Cesium.VertexFormat.POSITION_ONLY};for(const d of r)u.positions=d,o.push(new Cesium.GeometryInstance({geometry:new Cesium.CorridorGeometry(u),attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(i),distanceDisplayCondition:new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(a,l-1)}}));a=l}return new Cesium.GroundPrimitive({geometryInstances:o})}olLineStringGeometryToCesium(e,s,t,i,r){t=O.olGeometryCloneTo4326(t,i),console.assert(t.getType()=="LineString");const o=O.ol4326CoordinateArrayToCsCartesians(t.getCoordinates()),a=this.extractLineWidthFromOlStyle(r);let l;const u=this.getHeightReference(e,s,t);if(u===Cesium.HeightReference.CLAMP_TO_GROUND&&!De(this.scene)){const d=this.extractColorFromOlStyle(r,!0);l=this.createStackedGroundCorridors(e,s,a,d,o)}else{const d=new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(s,r,!0)}),m={positions:o,width:a},h={appearance:d};if(u===Cesium.HeightReference.CLAMP_TO_GROUND){const f=new Cesium.GroundPolylineGeometry(m);h.geometryInstances=new Cesium.GeometryInstance({geometry:f}),l=new Cesium.GroundPolylinePrimitive(h),l.readyPromise.then(()=>{this.setReferenceForPicking(e,s,l._primitive)})}else{m.vertexFormat=d.vertexFormat;const f=new Cesium.PolylineGeometry(m);h.geometryInstances=new Cesium.GeometryInstance({geometry:f}),l=new Cesium.Primitive(h)}}return this.setReferenceForPicking(e,s,l),this.addTextStyle(e,s,t,r,l)}olPolygonGeometryToCesium(e,s,t,i,r){t=O.olGeometryCloneTo4326(t,i),console.assert(t.getType()=="Polygon");const o=this.getHeightReference(e,s,t);let a,l,u;if(t.getCoordinates()[0].length==5&&s.getGeometry().get("olcs.polygon_kind")==="rectangle"){const m=t.getCoordinates()[0],h=Qt(m),f=Cesium.Rectangle.fromDegrees(h[0],h[1],h[2],h[3]);let y=0;if(m[0].length==3)for(let S=0;S<m.length;S++)y=Math.max(y,m[S][2]);a=new Cesium.RectangleGeometry({ellipsoid:Cesium.Ellipsoid.WGS84,rectangle:f,height:y}),l=new Cesium.RectangleOutlineGeometry({ellipsoid:Cesium.Ellipsoid.WGS84,rectangle:f,height:y})}else{const m=t.getLinearRings(),h={},f=h;console.assert(m.length>0);for(let y=0;y<m.length;++y){const S=m[y].getCoordinates(),g=O.ol4326CoordinateArrayToCsCartesians(S);console.assert(g&&g.length>0),y==0?h.positions=g:(h.holes||(h.holes=[]),h.holes.push({positions:g}))}if(a=new Cesium.PolygonGeometry({polygonHierarchy:f,perPositionHeight:!0}),o===Cesium.HeightReference.CLAMP_TO_GROUND){const y=this.extractLineWidthFromOlStyle(r);if(y>0){const S=[h.positions];if(h.holes)for(let g=0;g<h.holes.length;++g)S.push(h.holes[g].positions);if(De(this.scene)){const g=new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(s,r,!0)}),L=[];for(const v of S){const p=new Cesium.GroundPolylineGeometry({positions:v,width:y});L.push(new Cesium.GeometryInstance({geometry:p}))}const D={appearance:g,geometryInstances:L};u=new Cesium.GroundPolylinePrimitive(D),u.readyPromise.then(()=>{this.setReferenceForPicking(e,s,u._primitive)})}else{const g=this.extractColorFromOlStyle(r,!0);u=this.createStackedGroundCorridors(e,s,y,g,S)}}}else l=new Cesium.PolygonOutlineGeometry({polygonHierarchy:h,perPositionHeight:!0})}const d=this.wrapFillAndOutlineGeometries(e,s,t,a,l,r);return u&&d.add(u),this.addTextStyle(e,s,t,r,d)}getHeightReference(e,s,t){let i=t.get("altitudeMode");i===void 0&&(i=s.get("altitudeMode")),i===void 0&&(i=e.get("altitudeMode"));let r=Cesium.HeightReference.NONE;return i==="clampToGround"?r=Cesium.HeightReference.CLAMP_TO_GROUND:i==="relativeToGround"&&(r=Cesium.HeightReference.RELATIVE_TO_GROUND),r}createBillboardFromImage(e,s,t,i,r,o,a,l){o instanceof Me&&o.load();const u=o.getImage(1),d=function(h){return h.src!=""&&h.naturalHeight!=0&&h.naturalWidth!=0&&h.complete},m=(function(){if(!u||!(u instanceof HTMLCanvasElement||u instanceof Image||u instanceof HTMLImageElement))return;const h=t.getCoordinates(),f=O.ol4326CoordinateToCesiumCartesian(h);let y;const S=o.getOpacity();S!==void 0&&(y=new Cesium.Color(1,1,1,S));const g=o.getScale(),L=this.getHeightReference(e,s,t),D={image:u,color:y,scale:g,heightReference:L,position:f};if(Object.assign(D,s.get("cesiumOptions")),o instanceof Me){const p=o.getAnchor();p&&(D.pixelOffset=new Cesium.Cartesian2((u.width/2-p[0])*g,(u.height/2-p[1])*g))}const v=this.csAddBillboard(a,D,e,s,t,r);l&&l(v)}).bind(this);if(u instanceof Image&&!d(u)){let h=!1;const f=e.getSource(),y=function(){h=!0};f.on(["removefeature","clear"],this.boundOnRemoveOrClearFeatureListener_);let S=ie.obj(f).olcs_cancellers;S||(S=ie.obj(f).olcs_cancellers={});const g=R(s);S[g]&&S[g](),S[g]=y;const L=function(){u.removeEventListener("load",L),!a.isDestroyed()&&!h&&m()};u.addEventListener("load",L)}else m()}olPointGeometryToCesium(e,s,t,i,r,o,a){console.assert(t.getType()=="Point"),t=O.olGeometryCloneTo4326(t,i);let l=null;const u=r.getImage();if(u){const d=t.get("olcs_model")||s.get("olcs_model");if(d){const m=d(),h=Object.assign({},{scene:this.scene},m.cesiumOptions),f=Cesium.Model.fromGltf(h);l=new Cesium.PrimitiveCollection,l.add(f),m.debugModelMatrix&&l.add(new Cesium.DebugModelMatrixPrimitive({modelMatrix:m.debugModelMatrix}))}else this.createBillboardFromImage(e,s,t,i,r,u,o,a)}return r.getText()?this.addTextStyle(e,s,t,r,l||new Cesium.Primitive):l}olMultiGeometryToCesium(e,s,t,i,r,o,a){const l=function(d,m){const h=new Cesium.PrimitiveCollection;return d.forEach(f=>{h.add(m(e,s,f,i,r))}),h};let u;switch(t.getType()){case"MultiPoint":if(t=t,u=t.getPoints(),r.getText()){const d=new Cesium.PrimitiveCollection;return u.forEach(m=>{console.assert(m);const h=this.olPointGeometryToCesium(e,s,m,i,r,o,a);h&&d.add(h)}),d}else return u.forEach(d=>{console.assert(d),this.olPointGeometryToCesium(e,s,d,i,r,o,a)}),null;case"MultiLineString":return t=t,u=t.getLineStrings(),l(u,this.olLineStringGeometryToCesium.bind(this));case"MultiPolygon":return t=t,u=t.getPolygons(),l(u,this.olPolygonGeometryToCesium.bind(this));default:console.assert(!1,`Unhandled multi geometry type${t.getType()}`)}}olGeometry4326TextPartToCesium(e,s,t,i){const r=i.getText();if(!r)return null;const o=new Cesium.LabelCollection({scene:this.scene}),a=at(t.getExtent());if(t instanceof Xt){const y=t.getFirstCoordinate();a[2]=y.length==3?y[2]:0}const l={};l.position=O.ol4326CoordinateToCesiumCartesian(a),l.text=r,l.heightReference=this.getHeightReference(e,s,t);const u=i.getOffsetX(),d=i.getOffsetY();if(u!=0&&d!=0){const y=new Cesium.Cartesian2(u,d);l.pixelOffset=y}l.font=i.getFont()||"10px sans-serif";let m;i.getFill()&&(l.fillColor=this.extractColorFromOlStyle(i,!1),m=Cesium.LabelStyle.FILL),i.getStroke()&&(l.outlineWidth=this.extractLineWidthFromOlStyle(i),l.outlineColor=this.extractColorFromOlStyle(i,!0),m=Cesium.LabelStyle.OUTLINE),i.getFill()&&i.getStroke()&&(m=Cesium.LabelStyle.FILL_AND_OUTLINE),l.style=m;let h;switch(i.getTextAlign()){case"left":h=Cesium.HorizontalOrigin.LEFT;break;case"right":h=Cesium.HorizontalOrigin.RIGHT;break;case"center":default:h=Cesium.HorizontalOrigin.CENTER}if(l.horizontalOrigin=h,i.getTextBaseline()){let y;switch(i.getTextBaseline()){case"top":y=Cesium.VerticalOrigin.TOP;break;case"middle":y=Cesium.VerticalOrigin.CENTER;break;case"bottom":y=Cesium.VerticalOrigin.BOTTOM;break;case"alphabetic":y=Cesium.VerticalOrigin.TOP;break;case"hanging":y=Cesium.VerticalOrigin.BOTTOM;break;default:console.assert(!1,`unhandled baseline ${i.getTextBaseline()}`)}l.verticalOrigin=y}const f=o.add(l);return this.setReferenceForPicking(e,s,f),o}olStyleToCesium(e,s,t){const i=s.getFill(),r=s.getStroke();if(t&&!r||!t&&!i)return null;let o=t?r.getColor():i.getColor();return o=O.convertColorToCesium(o),t&&r.getLineDash()?Cesium.Material.fromType("Stripe",{horizontal:!1,repeat:500,evenColor:o,oddColor:new Cesium.Color(0,0,0,0)}):Cesium.Material.fromType("Color",{color:o})}computePlainStyle(e,s,t,i){const r=s.getStyleFunction();let o=null;return r&&(o=r(s,i)),!o&&t&&(o=t(s,i)),o?Array.isArray(o)?o:[o]:null}getGeometryFromFeature(e,s,t){if(t)return t;const i=e.get("olcs.3d_geometry");if(i&&i instanceof Ye)return i;if(s){const r=s.getGeometryFunction()(e);if(r instanceof Ye)return r}return e.getGeometry()}olFeatureToCesium(e,s,t,i,r){let o=this.getGeometryFromFeature(s,t,r);if(!o)return null;const a=i.projection,l=function(u){const d=i.featureToCesiumMap[R(s)];d instanceof Array?d.push(u):i.featureToCesiumMap[R(s)]=[u]};switch(o.getType()){case"GeometryCollection":const u=new Cesium.PrimitiveCollection;return o.getGeometries().forEach(y=>{if(y){const S=this.olFeatureToCesium(e,s,t,i,y);S&&u.add(S)}}),u;case"Point":o=o;const m=i.billboards,h=this.olPointGeometryToCesium(e,s,o,a,t,m,l);return h||null;case"Circle":return o=o,this.olCircleGeometryToCesium(e,s,o,a,t);case"LineString":return o=o,this.olLineStringGeometryToCesium(e,s,o,a,t);case"Polygon":return o=o,this.olPolygonGeometryToCesium(e,s,o,a,t);case"MultiPoint":case"MultiLineString":case"MultiPolygon":const f=this.olMultiGeometryToCesium(e,s,o,a,t,i.billboards,l);return f||null;case"LinearRing":throw new Error("LinearRing should only be part of polygon.");default:throw new Error(`Ol geom type not handled : ${o.getType()}`)}}olVectorLayerToCesium(e,s,t){const i=s.getProjection(),r=s.getResolution();if(r===void 0||!i)throw console.assert(!1,"View not ready"),new Error("View not ready");let o=e.getSource();o instanceof yt&&(o=o.getSource()),console.assert(o instanceof me);const a=o.getFeatures(),l=new Rr(i,this.scene),u=l.context;for(let d=0;d<a.length;++d){const m=a[d];if(!m)continue;const h=e.getStyleFunction(),f=this.computePlainStyle(e,m,h,r);if(!f||!f.length)continue;let y=null;for(let S=0;S<f.length;S++){const g=this.olFeatureToCesium(e,m,f[S],u);if(g){if(!y)y=g;else if(g){let L=0,D;for(;D=g.get(L);)y.add(D),L++}}}y&&(t[R(m)]=y,l.getRootPrimitive().add(y))}return l}convert(e,s,t,i){const r=s.getProjection(),o=s.getResolution();if(o==null||!r)return null;const a=e.getStyleFunction(),l=this.computePlainStyle(e,t,a,o);if(!l||!l.length)return null;i.projection=r;let u=null;for(let d=0;d<l.length;d++){const m=this.olFeatureToCesium(e,t,l[d],i);if(!u)u=m;else if(m){let h=0,f;for(;f=m.get(h);)u.add(f),h++}}return u}}class Or extends Et{constructor(e,s,t){super(e,s),this.converter=t||new Pr(s),this.csAllPrimitives_=new Cesium.PrimitiveCollection,s.primitives.add(this.csAllPrimitives_),this.csAllPrimitives_.destroyPrimitives=!1}addCesiumObject(e){console.assert(e),e.getRootPrimitive().counterpart=e,this.csAllPrimitives_.add(e.getRootPrimitive())}destroyCesiumObject(e){e.getRootPrimitive().destroy()}removeSingleCesiumObject(e,s){e.destroy(),this.csAllPrimitives_.destroyPrimitives=s,this.csAllPrimitives_.remove(e.getRootPrimitive()),this.csAllPrimitives_.destroyPrimitives=!1}removeAllCesiumObjects(e){if(this.csAllPrimitives_.destroyPrimitives=e,e)for(let s=0;s<this.csAllPrimitives_.length;++s)this.csAllPrimitives_.get(s).counterpart.destroy();this.csAllPrimitives_.removeAll(),this.csAllPrimitives_.destroyPrimitives=!1}updateLayerVisibility(e,s){let t=!0;[e.layer].concat(e.parents).forEach(i=>{const r=i.getVisible();r!==void 0?t&=r:t=!1}),s.show=t}createSingleLayerCounterparts(e){const s=e.layer;if(!(s instanceof Be)||s instanceof Jt)return null;console.assert(s instanceof es);let t=s.getSource();if(t instanceof yt&&(t=t.getSource()),!t)return null;console.assert(t instanceof me),console.assert(this.view);const i=this.view,r={},o=this.converter.olVectorLayerToCesium(s,i,r),a=o.getRootPrimitive(),l=o.olListenKeys;[e.layer].concat(e.parents).forEach(m=>{l.push(re(m,"change:visible",()=>{this.updateLayerVisibility(e,a)}))}),this.updateLayerVisibility(e,a);const u=(function(m){console.assert(s instanceof Be||s instanceof ts);const h=o.context,f=this.converter.convert(s,i,m,h);f&&(r[R(m)]=f,a.add(f))}).bind(this),d=(function(m){const h=R(m),f=o.context,y=f.featureToCesiumMap[h];y&&(delete f.featureToCesiumMap[h],y.forEach(g=>{g instanceof Cesium.Billboard&&f.billboards.remove(g)}));const S=r[h];delete r[h],S&&a.remove(S)}).bind(this);return l.push(re(t,"addfeature",m=>{console.assert(m.feature),u(m.feature)})),l.push(re(t,"removefeature",m=>{console.assert(m.feature),d(m.feature)})),l.push(re(t,"changefeature",m=>{const h=m.feature;console.assert(h),d(h),u(h)})),o?[o]:null}}class Dr extends ut{constructor(e){const s=e.parent;super(s.getOptions()),this.scenePostRenderListenerRemover_=null,this.scene_=e.scene,this.synchronizer_=e.synchronizer,this.parent_=s,this.positionWGS84_=void 0,this.observer_=new MutationObserver(this.handleElementChanged.bind(this)),this.attributeObserver_=[],this.listenerKeys_=[];const t=i=>this.setPropertyFromEvent_(i);this.listenerKeys_.push(this.parent_.on("change:position",t)),this.listenerKeys_.push(this.parent_.on("change:element",t)),this.listenerKeys_.push(this.parent_.on("change:offset",t)),this.listenerKeys_.push(this.parent_.on("change:position",t)),this.listenerKeys_.push(this.parent_.on("change:positioning",t)),this.setProperties(this.parent_.getProperties()),this.handleMapChanged(),this.handleElementChanged()}observeTarget_(e){if(this.observer_){this.observer_.disconnect(),this.observer_.observe(e,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),this.attributeObserver_.forEach(s=>{s.disconnect()}),this.attributeObserver_.length=0;for(let s=0;s<e.childNodes.length;s++){const t=e.childNodes[s];if(t.nodeType===1){const i=new MutationObserver(this.handleElementChanged.bind(this));i.observe(t,{attributes:!0,subtree:!0}),this.attributeObserver_.push(i)}}}}setPropertyFromEvent_(e){e.target&&e.key&&this.set(e.key,e.target.get(e.key))}getScene(){return this.scene_}handleMapChanged(){this.scenePostRenderListenerRemover_&&(this.scenePostRenderListenerRemover_(),ss(this.element)),this.scenePostRenderListenerRemover_=null;const e=this.getScene();if(e){this.scenePostRenderListenerRemover_=e.postRender.addEventListener(this.updatePixelPosition.bind(this)),this.updatePixelPosition();const s=this.stopEvent?this.synchronizer_.getOverlayContainerStopEvent():this.synchronizer_.getOverlayContainer();this.insertFirst?s.insertBefore(this.element,s.childNodes[0]||null):s.appendChild(this.element)}}handlePositionChanged(){const e=this.getPosition();if(e){const s=this.parent_.getMap().getView().getProjection();this.positionWGS84_=is(e,s,"EPSG:4326")}else this.positionWGS84_=void 0;this.updatePixelPosition()}handleElementChanged(){function e(t,i){const r=t.cloneNode();t.nodeName==="CANVAS"&&r.getContext("2d").drawImage(t,0,0),i&&i.appendChild(r),t.nodeType!=Node.TEXT_NODE&&r.addEventListener("click",a=>{t.dispatchEvent(new MouseEvent("click",a)),a.stopPropagation()});const o=t.childNodes;for(let a=0;a<o.length;a++)o[a]&&e(o[a],r);return r}ns(this.element);const s=this.getElement();if(s&&s.parentNode&&s.parentNode.childNodes)for(const t of s.parentNode.childNodes){const i=e(t,null);this.element.appendChild(i)}s.parentNode&&this.observeTarget_(s.parentNode)}updatePixelPosition(){const e=this.positionWGS84_;if(!this.scene_||!e){this.setVisible(!1);return}let s=0;if(e.length===2){const m=this.scene_.globe.getHeight(Cesium.Cartographic.fromDegrees(e[0],e[1]));m&&this.scene_.globe.tilesLoaded&&(e[2]=m),m&&(s=m)}else s=e[2];const t=Cesium.Cartesian3.fromDegrees(e[0],e[1],s),i=this.scene_.camera,r=new Cesium.BoundingSphere(new Cesium.Cartesian3,6356752);if(!new Cesium.Occluder(r,i.position).isPointVisible(t)){this.setVisible(!1);return}if(i.frustum.computeCullingVolume(i.position,i.direction,i.up).computeVisibility(new Cesium.BoundingSphere(t))!==1){this.setVisible(!1);return}this.setVisible(!0);const l=this.scene_.cartesianToCanvasCoordinates(t),u=[l.x,l.y],d=[this.scene_.canvas.width,this.scene_.canvas.height];this.updateRenderedPosition(u,d)}destroy(){this.scenePostRenderListenerRemover_&&this.scenePostRenderListenerRemover_(),this.observer_&&this.observer_.disconnect(),X(this.listenerKeys_),this.listenerKeys_.splice(0),this.element.removeNode?this.element.removeNode(!0):this.element.remove(),this.element=null}}class Ar{constructor(e,s){this.map=e,this.overlays_=this.map.getOverlays(),this.scene=s,this.overlayContainerStopEvent_=document.createElement("DIV"),this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",["click","dblclick","mousedown","touchstart","MSPointerDown","pointerdown","mousewheel","wheel"].forEach(i=>{this.overlayContainerStopEvent_.addEventListener(i,r=>r.stopPropagation())}),this.scene.canvas.parentElement.appendChild(this.overlayContainerStopEvent_),this.overlayContainer_=document.createElement("DIV"),this.overlayContainer_.className="ol-overlaycontainer",this.scene.canvas.parentElement.appendChild(this.overlayContainer_),this.overlayMap_={}}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOverlayContainer(){return this.overlayContainer_}synchronize(){this.destroyAll(),this.addOverlays(),this.overlays_.on("add",this.addOverlayFromEvent_.bind(this)),this.overlays_.on("remove",this.removeOverlayFromEvent_.bind(this))}addOverlayFromEvent_(e){const s=e.element;this.addOverlay(s)}addOverlays(){this.overlays_.forEach(e=>{this.addOverlay(e)})}addOverlay(e){if(!e)return;const s=new Dr({scene:this.scene,synchronizer:this,parent:e}),t=R(e).toString();this.overlayMap_[t]=s}removeOverlayFromEvent_(e){const s=e.element;this.removeOverlay(s)}removeOverlay(e){const s=R(e).toString(),t=this.overlayMap_[s];t&&(t.destroy(),delete this.overlayMap_[s])}destroyAll(){Object.keys(this.overlayMap_).forEach(e=>{this.overlayMap_[e].destroy(),delete this.overlayMap_[e]})}}class he{constructor(e){this.autoRenderLoop_=null,this.map_=e.map,this.time_=e.time||function(){return Cesium.JulianDate.now()},this.to4326Transform_=Ve(this.map_.getView().getProjection(),"EPSG:4326"),this.resolutionScale_=1,this.canvasClientWidth_=0,this.canvasClientHeight_=0,this.resolutionScaleChanged_=!0;const s="position:absolute;top:0;left:0;width:100%;height:100%;";this.container_=document.createElement("DIV");const t=document.createAttribute("style");t.value=`${s}visibility:hidden;`,this.container_.setAttributeNode(t);let i=e.target||this.map_.getViewport();if(typeof i=="string"&&(i=document.getElementById(i)),i.appendChild(this.container_),this.isOverMap_=!e.target,this.isOverMap_&&e.stopOpenLayersEventsPropagation){const m=["click","dblclick","mousedown","touchstart","MSPointerDown","pointerdown","mousewheel","wheel"];for(let h=0,f=m.length;h<f;++h)this.container_.addEventListener(m[h],y=>y.stopPropagation())}this.canvas_=document.createElement("CANVAS");const r=document.createAttribute("style");r.value=s,this.canvas_.setAttributeNode(r),ie.supportsImageRenderingPixelated()&&(this.canvas_.style.imageRendering=ie.imageRenderingValue()),this.canvas_.oncontextmenu=function(){return!1},this.canvas_.onselectstart=function(){return!1},this.container_.appendChild(this.canvas_),this.enabled_=!1,this.pausedInteractions_=[],this.hiddenRootGroup_=null;const o=e.sceneOptions!==void 0?e.sceneOptions:{};o.canvas=this.canvas_,o.scene3DOnly=!0,this.scene_=new Cesium.Scene(o);const a=this.scene_.screenSpaceCameraController;a.tiltEventTypes.push({eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.SHIFT}),a.tiltEventTypes.push({eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.ALT}),a.enableLook=!1,this.scene_.camera.constrainedAxis=Cesium.Cartesian3.UNIT_Z,this.camera_=new ae(this.scene_,this.map_),this.globe_=new Cesium.Globe(Cesium.Ellipsoid.WGS84),this.globe_.baseColor=Cesium.Color.WHITE,this.scene_.globe=this.globe_,this.scene_.skyAtmosphere=new Cesium.SkyAtmosphere;const l=new Cesium.SingleTileImageryProvider({url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",rectangle:Cesium.Rectangle.fromDegrees(0,0,1,1)});this.globe_.imageryLayers.addImageryProvider(l,0),this.dataSourceCollection_=new Cesium.DataSourceCollection,this.dataSourceDisplay_=new Cesium.DataSourceDisplay({scene:this.scene_,dataSourceCollection:this.dataSourceCollection_});const u=e.createSynchronizers?e.createSynchronizers(this.map_,this.scene_,this.dataSourceCollection_):[new Ir(this.map_,this.scene_),new Or(this.map_,this.scene_),new Ar(this.map_,this.scene_)];this.handleResize_();for(let m=u.length-1;m>=0;--m)u[m].synchronize();this.lastFrameTime_=0,this.renderId_=void 0,this.targetFrameRate_=Number.POSITIVE_INFINITY,this.blockCesiumRendering_=!1,this.warmingUp_=!1,this.trackedFeature_=null,this.trackedEntity_=null,this.entityView_=null,this.needTrackedEntityUpdate_=!1,this.boundingSphereScratch_=new Cesium.BoundingSphere,new Cesium.EventHelper().add(this.scene_.postRender,he.prototype.updateTrackedEntity_,this),Cesium.Camera.enableSuspendTerrainAdjustment=!1}render_(){this.renderId_!==void 0&&(cancelAnimationFrame(this.renderId_),this.renderId_=void 0),(this.enabled_||this.warmingUp_)&&!this.blockCesiumRendering_&&(this.renderId_=requestAnimationFrame(this.onAnimationFrame_.bind(this)))}onAnimationFrame_(e){this.renderId_=void 0;const s=1e3/this.targetFrameRate_;if(e-this.lastFrameTime_<s){this.render_();return}this.lastFrameTime_=e;const i=this.time_();if(this.scene_.initializeFrame(),this.handleResize_(),this.dataSourceDisplay_.update(i),this.entityView_){const r=this.trackedEntity_;this.dataSourceDisplay_.getBoundingSphere(r,!1,this.boundingSphereScratch_)===Cesium.BoundingSphereState.DONE&&(this.boundingSphereScratch_.radius=1,this.entityView_.update(i,this.boundingSphereScratch_))}this.scene_.render(i),this.camera_.checkCameraChange(),this.render_()}updateTrackedEntity_(){if(!this.needTrackedEntityUpdate_)return;const e=this.trackedEntity_,s=this.scene_,t=this.dataSourceDisplay_.getBoundingSphere(e,!1,this.boundingSphereScratch_);if(t===Cesium.BoundingSphereState.PENDING)return;s.screenSpaceCameraController.enableTilt=!1;const i=t!==Cesium.BoundingSphereState.FAILED?this.boundingSphereScratch_:void 0;i&&(i.radius=1),this.entityView_=new Cesium.EntityView(e,s,s.mapProjection.ellipsoid),this.entityView_.update(this.time_(),i),this.needTrackedEntityUpdate_=!1}handleResize_(){let e=this.canvas_.clientWidth,s=this.canvas_.clientHeight;if(e===0|s===0||e===this.canvasClientWidth_&&s===this.canvasClientHeight_&&!this.resolutionScaleChanged_)return;let t=this.resolutionScale_;ie.supportsImageRenderingPixelated()||(t*=window.devicePixelRatio||1),this.resolutionScaleChanged_=!1,this.canvasClientWidth_=e,this.canvasClientHeight_=s,e*=t,s*=t,this.canvas_.width=e,this.canvas_.height=s,this.scene_.camera.frustum.aspectRatio=e/s}getCamera(){return this.camera_}getOlMap(){return this.map_}getOlView(){const e=this.map_.getView();return console.assert(e),e}getCesiumScene(){return this.scene_}getDataSources(){return this.dataSourceCollection_}getDataSourceDisplay(){return this.dataSourceDisplay_}getEnabled(){return this.enabled_}setEnabled(e){if(this.enabled_===e)return;this.enabled_=e,this.container_.style.visibility=this.enabled_?"visible":"hidden";let s;if(this.enabled_){if(this.throwOnUnitializedMap_(),this.isOverMap_){s=this.map_.getInteractions(),s.forEach((i,r,o)=>{this.pausedInteractions_.push(i)}),s.clear(),this.map_.addInteraction=i=>this.pausedInteractions_.push(i),this.map_.removeInteraction=i=>this.pausedInteractions_=this.pausedInteractions_.filter(r=>r!==i);const t=this.map_.getLayerGroup();t.getVisible()&&(this.hiddenRootGroup_=t,this.hiddenRootGroup_.setVisible(!1)),this.map_.getOverlayContainer().classList.add("olcs-hideoverlay")}this.camera_.readFromView(),this.render_()}else this.isOverMap_&&(s=this.map_.getInteractions(),this.pausedInteractions_.forEach(t=>{s.push(t)}),this.pausedInteractions_.length=0,this.map_.addInteraction=t=>this.map_.getInteractions().push(t),this.map_.removeInteraction=t=>this.map_.getInteractions().remove(t),this.map_.getOverlayContainer().classList.remove("olcs-hideoverlay"),this.hiddenRootGroup_&&(this.hiddenRootGroup_.setVisible(!0),this.hiddenRootGroup_=null)),this.camera_.updateView()}warmUp(e,s){if(this.enabled_)return;this.throwOnUnitializedMap_(),this.camera_.readFromView();const t=this.globe_.ellipsoid,i=this.scene_.camera,r=t.cartesianToCartographic(i.position);r.height<e&&(r.height=e,i.position=t.cartographicToCartesian(r)),this.warmingUp_=!0,this.render_(),setTimeout(()=>{this.warmingUp_=!1},s)}setBlockCesiumRendering(e){this.blockCesiumRendering_!==e&&(this.blockCesiumRendering_=e,this.render_())}enableAutoRenderLoop(){this.autoRenderLoop_||(this.autoRenderLoop_=new Er(this))}getAutoRenderLoop(){return this.autoRenderLoop_}setResolutionScale(e){e=Math.max(0,e),e!==this.resolutionScale_&&(this.resolutionScale_=Math.max(0,e),this.resolutionScaleChanged_=!0,this.autoRenderLoop_&&this.autoRenderLoop_.restartRenderLoop())}setTargetFrameRate(e){this.targetFrameRate_!==e&&(this.targetFrameRate_=e,this.render_())}throwOnUnitializedMap_(){const s=this.map_.getView(),t=s.getCenter();if(!s.isDef()||isNaN(t[0])||isNaN(t[1]))throw new Error(`The OpenLayers map is not properly initialized: ${t} / ${s.getResolution()}`)}get trackedFeature(){return this.trackedFeature_}set trackedFeature(e){if(this.trackedFeature_!==e){const s=this.scene_;if(!e||!e.getGeometry()){this.needTrackedEntityUpdate_=!1,s.screenSpaceCameraController.enableTilt=!0,this.trackedEntity_&&this.dataSourceDisplay_.defaultDataSource.entities.remove(this.trackedEntity_),this.trackedEntity_=null,this.trackedFeature_=null,this.entityView_=null,s.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);return}this.trackedFeature_=e,this.needTrackedEntityUpdate_=!0;const t=this.to4326Transform_,i=function(){const o=e.getGeometry();console.assert(o instanceof We);const a=o.getCoordinates(),l=t(a,void 0,a.length);return O.ol4326CoordinateToCesiumCartesian(l)},r={position:new Cesium.CallbackProperty((o,a)=>i(),!1),point:{pixelSize:1,color:Cesium.Color.TRANSPARENT}};this.trackedEntity_=this.dataSourceDisplay_.defaultDataSource.entities.add(r)}}}const Fr={props:{},setup(n,{emit:e}){const s=Te,t=pt(),i=Q({defaultCenter:[121.326776,24.655499],defaultCenterZoom:14,targetNum:1,conditionWrap:!1,layerSelect:!1,currentLayers:[],layers:[],mapLayers:ne(()=>i.layers.map((v,p)=>({label:v.group_title,value:v.value,layers:v.group_layers,groupClass:v.group_class}))),selectLock:!1,mapCount:1,map1:null,map2:null,map1LayerStatus:[],map2LayerStatus:[],temp:{map1BaseStatus:0,map2BaseStatus:0},deleteLightbox:!1,dimensionMap:{map1:"2D",map2:"2D"},toSearchDimensionStatus:ne(()=>{let v=i.targetNum==1?"map1":"map2";return i.dimensionMap[v]==="2D"}),ol3d:null,selectValueTemp:0,popup:{nodeRef:null,overlay:null,popupId:0,coordinate:[],popupData:""},comSize:{wrapHeight:"",wrapWidth:""},tribeQuery:{}});let r=null;const o=new ct({projection:"EPSG:4326",center:i.defaultCenter,zoom:i.defaultCenterZoom});function a(){i.map1=new xe({target:"map1",layers:[Le.getBaseMapData(0)],view:o,controls:[]}),i.map1.addControl(new kr({units:"metric"}))}function l(v,p){const b=new Be({source:new me({features:[new lt({geometry:new We([v,p]),population:4e3,rainfall:500})]}),style:new Ze({image:new Me({anchor:[.5,100],anchorXUnits:"fraction",anchorYUnits:"pixels",src:ii})})});let w=i.targetNum==1?"map1":"map2";i[w].addLayer(b)}function u({action:v,value:p}){var I;let b=((I=i.map1)==null?void 0:I.getTarget())==null?"map2":"map1",w=i[b].getView();switch(v){case"In":w.animate({zoom:w.getZoom()+1});break;case"Out":w.animate({zoom:w.getZoom()-1});break;case"toNorth":w.animate({rotation:0});break;case"moveTo":if(p){const{xAxis:P,yAxis:z}=p;w.animate({center:[P,z],zoom:17,duration:100})}else navigator.geolocation.getCurrentPosition(function(P){w.animate({center:[P.coords.longitude,P.coords.latitude],zoom:17,duration:100}),l(P.coords.longitude,P.coords.latitude)});break;case"fullScreen":let T=document.getElementById(`map${i.targetNum}`);T.requestFullscreen?T.requestFullscreen():T.msRequestFullscreen?T.msRequestFullscreen():T.mozRequestFullScreen?T.mozRequestFullScreen():T.webkitRequestFullscreen&&T.webkitRequestFullscreen();break}}function d({action:v,value:p}){var P,z;let b=i.targetNum==1?i.map1:i.map2,w=b==null?void 0:b.getLayers();switch(v){case"layerMode":if(p.checked){i.layers[p.nodeIndex].group_layers[p.subNodeIndex].single_tiles||(w.getArray().forEach(W=>{W.get("id")&&W.get("id").includes(`node${p.nodeIndex}_subNode${p.subNodeIndex}_nestedSubNode`)&&b.removeLayer(W)}),y("delete",b.getTarget(),p.id));let x=p.nestedSubNodeIndex||i.selectValueTemp,A=s.getLayer(i.layers[p.nodeIndex].group_layers[p.subNodeIndex],x,p.id);if(b.addLayer(A),(P=A.get("label"))!=null&&P.includes("雷達回波預測")){var I=A.getSource(),T=I.getFeatures()[0];const F=i.layers[p.nodeIndex].group_layers[p.subNodeIndex].image_options.image_extent,W=A.get("extra").url,ve=gifler(W),ze=F[2]-F[0],se=F[3]-F[1];ve.frames(document.createElement("canvas"),function(oe,K){const Dt=ze/K.width,At=se/K.height,Ft=Math.min(Dt,At),Vt=i.map1.getView().getResolution();T.setStyle(new Ze({image:new Me({img:oe.canvas,imgSize:[K.width,K.height],opacity:.8,scale:Ft/Vt})})),oe.clearRect(0,0,K.width,K.height),oe.drawImage(K.buffer,K.x,K.y),b.render()},!0)}i.layers[p.nodeIndex].group_layers[p.subNodeIndex].layer_type==="WFS"&&(S(b,A.label),L(p)),y("add",b.getTarget(),p.id)}else{let A=function(ve){x.filter(se=>{var oe;return(oe=se==null?void 0:se.get("id"))==null?void 0:oe.includes(ve)}).forEach(se=>{b.removeLayer(se)})},x=w.getArray();const W={node9_subNode0_nestedSubNode:"node9_subNode0_nestedSubNode",node12_subNode1_nestedSubNode:"node12_subNode1_nestedSubNode"}[p.id]||p.id;A(W),i.layers[p.nodeIndex].group_layers[p.subNodeIndex].layer_type==="WFS"&&(L(p),i.popup.popupId=0,i.popup.popupData="",i.popup.overlay&&(b.removeOverlay(i.popup.overlay),i.popup.overlay=null)),y("delete",b.getTarget(),p.id)}break;case"selectLayerMode":if(i.selectLock)return;p.layerName==="all"?w.getArray().filter(F=>F.get("id")!==void 0).forEach(F=>{b.removeLayer(F)}):w.getArray().forEach(A=>{A.get("id")==p.id&&b.removeLayer(A)});break;case"changeOrder":if(i.selectLock)return;let{nodeIndex:U,subNodeIndex:G,nestedSubNodeIndex:le}=s.getLayerIndex(p.id),_e=s.getLayer(i.layers[U].group_layers[G],le,p.id);if(p.movement==="up"){if(p.key+1==w.getArray().length)return;let x={checked:!1,nodeIndex:U,subNodeIndex:G,nestedSubNodeIndex:le,id:p.id};d({action:"layerMode",value:x}),w.insertAt(p.key+1,_e)}if(p.movement==="down"){if(p.key-1==0)return;let x={checked:!1,nodeIndex:U,subNodeIndex:G,nestedSubNodeIndex:le,id:p.id};d({action:"layerMode",value:x}),w.insertAt(p.key-1,_e)}break;case"changeLayerVisible":if(i.selectLock)return;let It=!w.getArray()[p.key].getVisible();w.getArray()[p.key].setVisible(It);break;case"baseMap":i.temp[`map${i.targetNum}BaseStatus`]=p.baseId;let Rt=new je({preload:1/0,name:p.name,label:p.label,type:p.mapType,baseId:p.baseId,source:new dt({url:p.url}),crossOrigin:"anonymous"}),Pt=b==null?void 0:b.getLayers().getArray();w.insertAt(0,Rt),Pt.forEach(x=>(x.get("type")=="base"&&x.get("baseId")!==p.baseId&&b.removeLayer(x),!0));break;case"changeMapCount":if(i.mapCount===p.qty)return;let te=i.targetNum!==1?"map1":"map2";i.mapCount=p.qty;let Ot=i[`${te}LayerStatus`].filter(x=>x!=="3D").map(x=>Te.getLayerIndex(x));if(p.qty===2&&(i[te]=new xe({target:te,layers:[Le.getBaseMapData(0),...Ot.map(x=>s.getLayer(i.layers[x.nodeIndex].group_layers[x.subNodeIndex],x.nestedSubNodeIndex,x.id))],view:o,controls:[]}),((z=i[`${te}LayerStatus`])==null?void 0:z.indexOf("3D"))!==-1)){r=new he({map:i[te]}),r.setEnabled(!0),Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0NzM3MWFhYS0xMjNlLTQ3MTMtODFjZS0xZjMzM2I5NGZiYTEiLCJpZCI6MTMwODE4LCJpYXQiOjE2ODQwNzM3Mjl9.UYu4kBialPo19dcvosHzZTpg2BD1zkFQnjCD78YiiYo";let x=r.getCesiumScene({});x.terrainProvider=Cesium.createWorldTerrain({})}if(p.qty===1){i[te]=null;const x=document.getElementById(te);for(;x.firstChild;)x.removeChild(x.firstChild)}break;case"changeDimensionMap":let Ce=i.targetNum==1?"map1":"map2";if(i.dimensionMap[Ce]=p,p==="3D"){const A=w.getArray().find(W=>W.get("label").includes("近年歷史災害82處部落點位"));A&&i[`map${i.targetNum}`].removeLayer(A),r=new he({map:b}),r.setEnabled(!0),Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0NzM3MWFhYS0xMjNlLTQ3MTMtODFjZS0xZjMzM2I5NGZiYTEiLCJpZCI6MTMwODE4LCJpYXQiOjE2ODQwNzM3Mjl9.UYu4kBialPo19dcvosHzZTpg2BD1zkFQnjCD78YiiYo";let F=r.getCesiumScene({});F.terrainProvider=Cesium.createWorldTerrain({}),i[`${Ce}LayerStatus`].push("3D")}else r.setEnabled(!1),i[`${Ce}LayerStatus`]=i[`${Ce}LayerStatus`].filter(x=>x!=="3D"),i[`map${i.targetNum}LayerStatus`].forEach(x=>{let{nodeIndex:A,subNodeIndex:F,nestedSubNodeIndex:W}=s.getLayerIndex(x);return s.getLayer(i.layers[A].group_layers[F],W,p.id).get("label").includes("近年歷史災害82處部落點位")&&d({action:"layerMode",value:{checked:!0,nodeIndex:A,subNodeIndex:F,nestedSubNodeIndex:W,id:x}}),x});break;case"setOpacity":w.getArray()[p.key].setOpacity(Number(p.value));break}h()}function m(v){var b;i.targetNum=v;let p=i.targetNum!==1?"map1":"map2";if(i.mapCount===1){if(!i[`map${v}`]){let w=i[`map${v}LayerStatus`].filter(T=>T!=="3D");w.includes("node0_subNode4_nestedSubNodeundefined")&&(w=[...w.filter(P=>P!=="node0_subNode4_nestedSubNodeundefined"),"node0_subNode4_nestedSubNodeundefined"]);let I=w.map(T=>Te.getLayerIndex(T));i[`map${v}`]=new xe({target:`map${v}`,layers:[Le.getBaseMapData(i.temp[`map${i.targetNum}BaseStatus`]),...I.map(T=>s.getLayer(i.layers[T.nodeIndex].group_layers[T.subNodeIndex],T.nestedSubNodeIndex,T.layeredIndex))],view:o,controls:[]}),S(i[`map${v}`]),((b=i[`map${v}LayerStatus`])==null?void 0:b.indexOf("3D"))!==-1&&(r=new he({map:i[`map${v}`]}),r.setEnabled(!0))}if(i[p]){i[p]=null;const w=document.getElementById(p);for(;w.firstChild;)w.removeChild(w.firstChild)}}Qe(()=>{h()})}function h(){var b;let v=i.targetNum==1?i.map1:i.map2;const p=(b=v==null?void 0:v.getLayers())==null?void 0:b.getArray();i.currentLayers=p==null?void 0:p.map(w=>({label:w.get("label"),id:w.get("id"),visible:w.getVisible()}))}function f(){i.conditionWrap=!i.conditionWrap}function y(v,p,b){if(v==="add")i[`${p}LayerStatus`].push(b);else if(v==="delete"){let w=i[`${p}LayerStatus`].findIndex(I=>I===b);i[`${p}LayerStatus`].splice(w,1)}else console.log("error")}function S(v){var b;let p=new os({layers:(b=v==null?void 0:v.getLayers())==null?void 0:b.getArray(),condition:rs});v.addInteraction(p),p.on("select",w=>{let I=w.selected[0];if(I){i.popup.overlay=new ut({element:i.popup.nodeRef,autoPan:!0,autoPanAnimation:{duration:250}}),i.popup.overlay.setPosition(w.mapBrowserEvent.coordinate),v.addOverlay(i.popup.overlay);let T=I.getId().split(".");i.popup.popupData=T[0],i.popup.coordinate=w.mapBrowserEvent.coordinate,T[0]==="新竹縣原住民部落範圍"&&(i.popup.popupId=I.get("編號")),T[0]==="近年歷史災害82處部落點位"&&(i.popup.popupId=T[1])}else v.removeOverlay(i.popup.overlay),i.popup.overlay=null,i.popup={nodeRef:null,overlay:null,popupId:0,coordinate:[],popupData:""}})}function g(){(i.targetNum==1?i.map1:i.map2).removeOverlay(i.popup.overlay),i.popup.overlay=null}function L(v){const{checked:p,id:b}=v;if(!p){i.selectLayerOption={};return}b==="node4_subNode0_nestedSubNodeundefined"&&J.ajax({url:"https://api.edtest.site/tribeQuery",method:"GET",success:w=>{i.tribeQuery=w},error:w=>{console.log(w)}})}function D(v){let p={action:"moveTo",value:{xAxis:v.WGS84.lng,yAxis:v.WGS84.lat}};u(p)}return Re(async()=>{let v=J.ajax({url:"https://api.edtest.site/underLayers",method:"GET"}).done(b=>b),p=J.ajax({url:"https://api.edtest.site/layers",method:"GET"}).done(b=>b);Promise.all([v,p]).then(b=>{let w=b[0].data.map((I,T)=>({mapType:"base",baseId:T,onCurrent:!1,...I}));Le.setBaseMapData(w),i.temp.map1BaseStatus=0,i.temp.baseMapList=no(),i.layers=b[1].map((I,T)=>(I.group_layers.forEach((P,z)=>{let U=z,G;P.id=`node${T}_subNode${U}_nestedSubNode${G}`,P.single_tiles||P.tiles_list.forEach((le,_e)=>{G=_e,le.id=`node${T}_subNode${U}_nestedSubNode${G}`})}),{...I,value:T})),Qe(()=>{a(),h()})}),i.comSize.wrapHeight=window.innerHeight,i.comSize.wrapWidth=window.innerWidth,window.onresize=b=>{i.comSize.wrapHeight=b.target.innerHeight,i.comSize.wrapWidth=b.target.innerWidth}}),{state:i,props:n,store:t,mapControl:u,layerControl:d,changeTarget:m,conditionWrap:f,closeMapData:g,moveToMap:D}}},Vr={class:"w-100 d-flex justify-content-between flex-sm-row flex-wrap flex-sm-nowrap mapWrap",id:"mapWrap"},Nr={key:0,class:"middleLine"},Br={class:"SearchBar d-none d-sm-block position-absolute"},Gr={class:"d-flex align-items-center"},Wr=c("img",{src:xt,alt:"",class:"me-5"},null,-1),jr={class:"conditionCom d-none d-sm-block position-absolute"},Hr={class:"mb-4"},$r={key:1},zr={class:"m-Navbar d-flex d-sm-none position-fixed bottom-0 start-0 w-100"},Ur={class:"position-absolute bottom-100 w-100",style:{"max-height":"70vh","overflow-y":"scroll"}},Kr={key:0},qr={key:0,class:"lightWrap w-100 h-100 d-flex justify-content-center align-items-center"},Yr={class:"p-4 rounded bg-white",style:{width:"250px"}},Zr=c("p",{class:"text-center fw-bold"},"是否要刪除全部圖層",-1),Qr={class:"d-flex justify-content-around"};function Xr(n,e,s,t,i,r){var y,S;const o=xr,a=rr,l=sr,u=Eo,d=Oe,m=to,h=Tn,f=Xi;return _(),C("div",null,[c("div",Vr,[c("div",{id:"map1",class:j({"w-100":((y=t.state.map1)==null?void 0:y.getTarget())=="map1","h-100":t.state.mapCount===1,"h-50":t.state.mapCount===2&&t.state.comSize.wrapWidth<600})},null,2),t.state.mapCount===2?(_(),C("div",Nr)):M("",!0),c("div",{id:"map2",class:j({"w-100":((S=t.state.map2)==null?void 0:S.getTarget())=="map2","h-100":t.state.mapCount===1,"h-50":t.state.mapCount===2&&t.state.comSize.wrapWidth<600})},null,2)]),V(o,{class:"asideTool position-absolute top-50 translate-middle-y",id:"asideTool",onOnMapControl:e[0]||(e[0]=({action:g,value:L})=>{t.mapControl({action:g,value:L})})}),c("div",Br,[c("div",Gr,[Wr,V(a,{class:"mapSourceOption d-none d-sm-block",baseMapList:t.state.temp.baseMapList,onChangeBaseMaps:({action:g,value:L})=>{t.layerControl({action:g,value:L})}},null,8,["baseMapList","onChangeBaseMaps"])]),V(l,be({class:"mt-4"},{dimensionMapStatus:t.state.toSearchDimensionStatus,currentLayers:t.state.currentLayers,mapCount:t.state.mapCount,onChangeBaseMaps:({action:g,value:L})=>{t.layerControl({action:g,value:L})}},{onOnLayerControl:e[1]||(e[1]=({action:g,value:L})=>{t.layerControl({action:g,value:L})}),onOnChangeTarget:e[2]||(e[2]=g=>{t.changeTarget(g)}),onConditionWrap:e[3]||(e[3]=g=>{t.conditionWrap(g)})}),null,16)]),c("div",jr,[c("div",Hr,[t.state.conditionWrap?M("",!0):(_(),C("button",{key:0,class:"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5",onClick:e[4]||(e[4]=g=>t.state.conditionWrap=!0)}," 圖層選項 ")),t.state.conditionWrap?(_(),C("div",{key:1,class:"mb-4","on:onLayerControl":e[6]||(e[6]=({action:g,value:L})=>{t.layerControl({action:g,value:L})})},[V(u,be({tribeQuery:t.state.tribeQuery,mapLayers:t.state.mapLayers,currentLayers:t.state.currentLayers,onClose:()=>{t.state.conditionWrap=!1},showSelectLayerValue:g=>{t.state.selectValueTemp=g},moveToMap:g=>{t.moveToMap(g)}},{onOnLayerControl:e[5]||(e[5]=({action:g,value:L})=>{t.layerControl({action:g,value:L})})}),null,16)],32)):M("",!0),V(d,{text:"可選擇要加入的圖層",styles:"right: 105%;top: 0;text-align: right;"})]),c("div",null,[t.state.layerSelect?M("",!0):(_(),C("button",{key:0,class:"border-0 w-100 rounded-4 bg-steel text-white text-center p-2 fw-bold fs-5",onClick:e[7]||(e[7]=g=>t.state.layerSelect=!0)}," 已選擇的圖層 ")),t.state.layerSelect?(_(),C("div",$r,[V(m,cs(ds({selectLock:t.state.selectLock,currentLayers:t.state.currentLayers,onClose:()=>{t.state.layerSelect=!1},onLockLayer:()=>{t.state.selectLock=!t.state.selectLock},onDeleteLayer:({action:g,value:L})=>{L.layerName=="all"?t.state.deleteLightbox=!0:t.layerControl({action:g,value:L})},onDeleteLayerAll:()=>{t.state.deleteLightbox=!0},onLayerControl:({action:g,value:L})=>{t.layerControl({action:g,value:L})}})),null,16)])):M("",!0),V(d,{text:"顯示已經選擇的圖層",styles:"right: 105%;top: 0;text-align: right;"})])]),c("div",zr,[c("div",Ur,[t.state.conditionWrap?(_(),Xe(u,be({key:0,class:"w-100"},{mapLayers:t.state.mapLayers,currentLayers:t.state.currentLayers,onClose:()=>{t.state.conditionWrap=!1},showSelectLayerValue:g=>{t.state.selectValueTemp=g}},{onOnLayerControl:e[8]||(e[8]=({action:g,value:L})=>{t.layerControl({action:g,value:L})})}),null,16)):M("",!0)]),t.state.layerSelect?(_(),C("div",Kr,[V(m,be({class:"position-absolute bottom-100 w-100"},{selectLock:t.state.selectLock,currentLayers:t.state.currentLayers,onClose:()=>{t.state.layerSelect=!1},onChangLayerVisible:g=>{t.layerControl(g)},onChangeOrderLayer:({action:g,value:L})=>{t.layerControl({action:g,value:L})},onLockLayer:()=>{t.state.selectLock=!t.state.selectLock},onDeleteLayer:({action:g,value:L})=>{L.layerName=="all"?t.state.deleteLightbox=!0:t.layerControl({action:g,value:L})},onDeleteLayerAll:()=>{t.state.deleteLightbox=!0}},{setOpacity:({action:g,value:L})=>{t.layerControl({action:g,value:L})}}),null,16,["setOpacity"])])):M("",!0),V(h,{dimensionMapStatus:t.state.toSearchDimensionStatus,currentLayers:t.state.currentLayers,mapCount:t.state.mapCount,openConditionWrap:()=>{t.state.conditionWrap=!t.state.conditionWrap,t.state.layerSelect=!1},openLayerSelect:()=>{t.state.layerSelect=!t.state.layerSelect,t.state.conditionWrap=!1},onLayerControl:({action:g,value:L})=>{t.layerControl({action:g,value:L})},onChangeTarget:g=>{t.changeTarget(g)},onConditionWrap:e[9]||(e[9]=g=>{t.conditionWrap(g)})},null,8,["dimensionMapStatus","currentLayers","mapCount","openConditionWrap","openLayerSelect","onLayerControl","onChangeTarget"])]),t.state.deleteLightbox?(_(),C("div",qr,[c("div",Yr,[Zr,c("div",Qr,[c("button",{class:"rounded px-3 py-1 bg-steel text-white border-0",onClick:e[10]||(e[10]=()=>{t.layerControl({action:"selectLayerMode",value:{layerName:"all"}}),t.state.deleteLightbox=!1})},"確定"),c("button",{class:"rounded px-3 py-1 bg-secondary bg-gradient text-white border-0",onClick:e[11]||(e[11]=()=>{t.state.deleteLightbox=!1})},"取消")])])])):M("",!0),c("div",{id:"popup",class:"position-absolute bottom-0",ref:g=>{t.state.popup.nodeRef=g}},[t.state.popup.popupId!==0?(_(),Xe(f,{key:0,class:"areaData",closeMapData:()=>{t.closeMapData()},popup:t.state.popup,maxHeight:500},null,8,["closeMapData","popup"])):M("",!0)],512),t.store.state.isInit?(_(),C("div",{key:1,class:"stepOverLayer",id:"firstEnter",onClick:e[12]||(e[12]=()=>{t.store.dispatch("updateLayerStatus",!1)})})):M("",!0)])}const sa=H(Fr,[["render",Xr]]);export{sa as default};
//# sourceMappingURL=WebMap-83389392.js.map
